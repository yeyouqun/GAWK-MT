\input texinfo   @c -*-texinfo-*-
@c vim: filetype=texinfo
@c %**start of header (This is for running Texinfo on a region.)
@setfilename gawk.info
@settitle The GNU Awk User's Guide
@c %**end of header (This is for running Texinfo on a region.)

@dircategory Text creation and manipulation
@direntry
* Gawk: (gawk).                 A text scanning and processing language.
@end direntry
@dircategory Individual utilities
@direntry
* awk: (gawk)Invoking gawk.                     Text scanning and processing.
@end direntry

@c Enable better indexing, requires texindex from Texinfo 6 or later.
@tex
\global\usebracesinindexestrue
@end tex

@ifset FOR_PRINT
@tex
\gdef\xrefprintnodename#1{``#1''}
@end tex
@end ifset

@ifclear FOR_PRINT
@c With early 2014 texinfo.tex, restore PDF links and colors
@tex
\gdef\linkcolor{0.5 0.09 0.12} % Dark Red
\gdef\urlcolor{0.5 0.09 0.12} % Also
\global\urefurlonlylinktrue
@end tex
@end ifclear

@ifnotdocbook
@set BULLET @bullet{}
@set MINUS @minus{}
@end ifnotdocbook

@ifdocbook
@set BULLET
@set MINUS
@end ifdocbook

@set xref-automatic-section-title

@c The following information should be updated here only!
@c This sets the edition of the document, the version of gawk it
@c applies to and all the info about who's publishing this edition

@c These apply across the board.
@set UPDATE-MONTH August, 2016
@set VERSION 4.1
@set PATCHLEVEL 4

@set GAWKINETTITLE TCP/IP Internetworking with @command{gawk}
@ifset FOR_PRINT
@set TITLE Effective awk Programming
@end ifset
@ifclear FOR_PRINT
@set TITLE GAWK: Effective AWK Programming
@end ifclear
@set SUBTITLE A User's Guide for GNU Awk
@set EDITION 4.1

@iftex
@set DOCUMENT ä¹¦
@set CHAPTER ç« 
@set APPENDIX é™„å½•
@set SECTION å°èŠ‚
@set SUBSECTION å­å°èŠ‚
@set DARKCORNER @inmargin{@image{lflashlight,1cm}, @image{rflashlight,1cm}}
@set COMMONEXT (c.e.)
@set PAGE page
@end iftex
@ifinfo
@set DOCUMENT Info file
@set CHAPTER major node
@set APPENDIX major node
@set SECTION minor node
@set SUBSECTION node
@set DARKCORNER (d.c.)
@set COMMONEXT (c.e.)
@set PAGE screen
@end ifinfo
@ifhtml
@set DOCUMENT ç½‘é¡µ
@set CHAPTER ç« 
@set APPENDIX é™„å½•
@set SECTION å°èŠ‚
@set SUBSECTION å­å°èŠ‚
@set DARKCORNER (d.c.)
@set COMMONEXT (c.e.)
@set PAGE screen
@end ifhtml
@ifdocbook
@set DOCUMENT book
@set CHAPTER ç« 
@set APPENDIX é™„å½•
@set SECTION å°èŠ‚
@set SUBSECTION å­å°èŠ‚
@set DARKCORNER (d.c.)
@set COMMONEXT (c.e.)
@set PAGE page
@end ifdocbook
@ifxml
@set DOCUMENT ğŸŒ²
@set CHAPTER ç« 
@set APPENDIX é™„å½•
@set SECTION å°èŠ‚
@set SUBSECTION å­å°èŠ‚
@set DARKCORNER (d.c.)
@set COMMONEXT (c.e.)
@set PAGE page
@end ifxml
@ifplaintext
@set DOCUMENT book
@set CHAPTER ç« 
@set APPENDIX é™„å½•
@set SECTION å°èŠ‚
@set SUBSECTION å­å°èŠ‚
@set DARKCORNER (d.c.)
@set COMMONEXT (c.e.)
@set PAGE page
@end ifplaintext

@ifdocbook
@c empty on purpose
@set PART1
@set PART2
@set PART3
@set PART4
@end ifdocbook

@ifnotdocbook
@set PART1 ç¬¬ä¸€éƒ¨åˆ†:@*
@set PART2 ç¬¬äºŒéƒ¨åˆ†:@*
@set PART3 ç¬¬ä¸‰éƒ¨åˆ†:@*
@set PART4 ç¬¬å››éƒ¨åˆ†:@*
@end ifnotdocbook

@c some special symbols
@iftex
@set LEQ @math{@leq}
@set PI @math{@pi}
@end iftex
@ifdocbook
@set LEQ @inlineraw{docbook, &le;}
@set PI @inlineraw{docbook, &pgr;}
@end ifdocbook
@ifnottex
@ifnotdocbook
@set LEQ <=
@set PI @i{pi}
@end ifnotdocbook
@end ifnottex

@ifnottex
@ifnotdocbook
@macro ii{text}
@i{\text\}
@end macro
@end ifnotdocbook
@end ifnottex

@ifdocbook
@macro ii{text}
@inlineraw{docbook,<lineannotation>\text\</lineannotation>}
@end macro
@end ifdocbook

@ifclear FOR_PRINT
@set FN æ–‡ä»¶å
@set FFN æ–‡ä»¶å
@set DF æ•°æ®æ–‡ä»¶
@set DDF æ•°æ®æ–‡ä»¶
@set PVERSION ç‰ˆæœ¬
@end ifclear
@ifset FOR_PRINT
@set FN æ–‡ä»¶å
@set FFN æ–‡ä»¶å
@set DF æ•°æ®æ–‡ä»¶
@set DDF Datafile
@set PVERSION ç‰ˆæœ¬
@end ifset

@c For HTML, spell out email addresses, to avoid problems with
@c address harvesters for spammers.
@ifhtml
@macro EMAIL{real,spelled}
``\spelled\''
@end macro
@end ifhtml
@ifnothtml
@macro EMAIL{real,spelled}
@email{\real\}
@end macro
@end ifnothtml

@c Indexing macros
@ifinfo

@macro cindexawkfunc{name}
@cindex @code{\name\}
@end macro

@macro cindexgawkfunc{name}
@cindex @code{\name\}
@end macro

@end ifinfo

@ifnotinfo

@macro cindexawkfunc{name}
@cindex @code{\name\()} function
@end macro

@macro cindexgawkfunc{name}
@cindex @code{\name\()} function (@command{gawk})
@end macro
@end ifnotinfo

@ignore
Some comments on the layout for TeX.
1. Use at least texinfo.tex 2016-02-05.07.
@end ignore

@c merge the function and variable indexes into the concept index
@ifinfo
@synindex fn cp
@synindex vr cp
@end ifinfo
@iftex
@syncodeindex fn cp
@syncodeindex vr cp
@end iftex
@ifxml
@syncodeindex fn cp
@syncodeindex vr cp
@end ifxml
@ifdocbook
@synindex fn cp
@synindex vr cp
@end ifdocbook

@c If "finalout" is commented out, the printed output will show
@c black boxes that mark lines that are too long.  Thus, it is
@c unwise to comment it out when running a master in case there are
@c overfulls which are deemed okay.

@iftex
@finalout
@end iftex

@copying
@docbook
<para>
&ldquo;To boldly go where no man has gone before&rdquo; is a
Registered Trademark of Paramount Pictures Corporation.</para>

<para>Published by:</para>

<literallayout class="normal">Free Software Foundation
51 Franklin Street, Fifth Floor
Boston, MA  02110-1301 USA
Phone: +1-617-542-5942
Fax: +1-617-542-2652
Email: <email>gnu@@gnu.org</email>
URL: <ulink url="http://www.gnu.org">http://www.gnu.org/</ulink></literallayout>

<literallayout class="normal">Copyright &copy; 1989, 1991, 1992, 1993, 1996&ndash;2005, 2007, 2009&ndash;2016
Free Software Foundation, Inc.
All Rights Reserved.</literallayout>
@end docbook

@ifnotdocbook
Copyright @copyright{} 1989, 1991, 1992, 1993, 1996--2005, 2007, 2009--2016 @*
Free Software Foundation, Inc.
@end ifnotdocbook
@sp 2

This is Edition @value{EDITION} of @cite{@value{TITLE}: @value{SUBTITLE}},
for the @value{VERSION}.@value{PATCHLEVEL} (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', with the
Front-Cover Texts being ``A GNU Manual'', and with the Back-Cover Texts
as in (a) below.
@ifclear FOR_PRINT
A copy of the license is included in the section entitled
``GNU Free Documentation License''.
@end ifclear
@ifset FOR_PRINT
A copy of the license
may be found on the Internet at
@uref{http://www.gnu.org/software/gawk/manual/html_node/GNU-Free-Documentation-License.html,
the GNU Project's website}.
@end ifset

@enumerate a
@item
The FSF's Back-Cover Text is: ``You have the freedom to
copy and modify this GNU manual.''
@end enumerate
@end copying

@c Comment out the "smallbook" for technical review.  Saves
@c considerable paper.  Remember to turn it back on *before*
@c starting the page-breaking work.

@c 4/2002: Karl Berry recommends commenting out this and the
@c `@setchapternewpage odd', and letting users use `texi2dvi -t'
@c if they want to waste paper.
@c @smallbook


@c Uncomment this for the release.  Leaving it off saves paper
@c during editing and review.
@setchapternewpage odd

@shorttitlepage GNU Awk
@titlepage
@title @value{TITLE}
@subtitle @value{SUBTITLE}
@subtitle Edition @value{EDITION}
@subtitle @value{UPDATE-MONTH}
@author Arnold D. Robbins

@ifnotdocbook
@c Include the Distribution inside the titlepage environment so
@c that headings are turned off.  Headings on and off do not work.

@page
@vskip 0pt plus 1filll
``To boldly go where no man has gone before'' is a
Registered Trademark of Paramount Pictures Corporation. @*
@c sorry, i couldn't resist
@sp 3
Published by:
@sp 1

Free Software Foundation @*
51 Franklin Street, Fifth Floor @*
Boston, MA  02110-1301 USA @*
Phone: +1-617-542-5942 @*
Fax: +1-617-542-2652 @*
Email: @email{gnu@@gnu.org} @*
URL: @uref{http://www.gnu.org/} @*

@c This one is correct for gawk 3.1.0 from the FSF
ISBN 1-882114-28-0 @*
@sp 2
@insertcopying
@end ifnotdocbook
@end titlepage

@c Thanks to Bob Chassell for directions on doing dedications.
@iftex
@headings off
@page
@w{ }
@sp 9
@center @i{To my parents, for their love, and for the wonderful example they set for me.}
@sp 1
@center @i{To my wife, Miriam, for making me complete.
Thank you for building your life together with me.}
@sp 1
@center @i{To our children, Chana, Rivka, Nachum, and Malka, for enrichening our lives in innumerable ways.}
@sp 1
@w{ }
@page
@w{ }
@page
@headings on
@end iftex

@docbook
<dedication>
<para>To my parents, for their love, and for the wonderful
example they set for me.</para>
<para>To my wife Miriam, for making me complete.
Thank you for building your life together with me.</para>
<para>To our children Chana, Rivka, Nachum and Malka,
for enrichening our lives in innumerable ways.</para>
</dedication>
@end docbook

@iftex
@headings off
@evenheading @thispage@ @ @ @strong{@value{TITLE}} @| @|
@oddheading  @| @| @strong{@thischapter}@ @ @ @thispage
@end iftex

@ifnottex
@ifnotxml
@ifnotdocbook
@node Top
@top General Introduction
@c Preface node should come right after the Top
@c node, in `unnumbered' sections, then the chapter, `What is gawk'.
@c Licensing nodes are appendices, they're not central to AWK.

This file documents @command{awk}, a program that you can use to select
particular records in a file and perform operations upon them.

@insertcopying

@end ifnotdocbook
@end ifnotxml
@end ifnottex

@menu
* Foreword3::                      å…³äºæœ¬@value{DOCUMENT}çš„ä¸€äº›è¯
* Foreword4::                      å…¶ä»–ä¸€äº›è¯
* Preface::                        æœ¬@value{DOCUMENT}çš„å†…å®¹; å†å²æ¦‚è¿°å’Œè‡´è°¢
* Translator Preface::             è¯‘è€…çš„è¯
* Getting Started::                å¯¹ @command{awk} çš„åŸºç¡€ä»‹ç»ï¼›å¦‚ä½•æ‰§è¡Œä¸€ä¸ª @command{awk} ç¨‹åºï¼›å‘½ä»¤è¡Œè¯­æ³•
* Invoking Gawk::                  å¦‚ä½•æ‰§è¡Œ @command{awk} ç¨‹åº
* Regexp::                         å…³äºä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ–¹é¢é¢
* Reading Files::                  å¦‚ä½•è¯»å–æ–‡ä»¶å’Œæ“ä½œåŸŸ
* Printing::                       å¦‚ä½•ä½¿ç”¨ @command{awk} æ‰“å°ï¼›ä»‹ç» @code{print} å’Œ @code{printf} è¯­å¥ï¼›ä¹Ÿä»‹ç»äº†é‡å®šå‘è¾“å‡º
* Expressions::                    è¡¨è¾¾å¼æ˜¯æ˜¯è¯­å¥çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†
* Patterns and Actions::           æ¦‚è§ˆæ¨¡å¼å’ŒåŠ¨ä½œ
* Arrays::                         æè¿°å’Œä½¿ç”¨æ•°ç»„ï¼›ä¹ŸåŒ…æ‹¬é¢å‘æ•°ç»„çš„æ§åˆ¶è¯­å¥
* Functions::                      å†…å»ºå‡½æ•°å’Œç”¨æˆ·å®šä¹‰å‡½æ•°
* Library Functions::              @command{awk} å‡½æ•°åº“
* Sample Programs::                è®¸å¤šæœ‰å®Œæ•´è§£é‡Šçš„ @command{awk} ç¨‹åº
* Advanced Features::              ä¸ºé«˜çº§ç”¨æˆ·è€Œå†™çš„ @command{gawk} ç›¸å…³æŒ‡å—
* Internationalization::           è®© @command{gawk} é€‚ç”¨äºä½ çš„è¯­è¨€
* Debugger::                       @command{awk} è°ƒè¯•å™¨
* Arbitrary Precision Arithmetic:: @command{gawk} ä¸­çš„ä»»æ„ç²¾åº¦ç®—æœ¯è¿ç®—
* Dynamic Extensions::             åŠ¨æ€åœ°ç»™ @command{gawk} æ·»åŠ æ–°çš„å†…ç½®å‡½æ•°
* Language History::               @command{awk} è¯­è¨€çš„æ¼”åŒ–è¿‡ç¨‹
* Installation::                   Installing @command{gawk} under various
                                   operating systems.
* Notes::                          Notes about adding things to @command{gawk}
                                   and possible future work.
* Basic Concepts::                 A very quick introduction to programming
                                   concepts.
* Glossary::                       An explanation of some unfamiliar terms.
* Copying::                        Your right to copy and distribute
                                   @command{gawk}.
* GNU Free Documentation License:: The license for this @value{DOCUMENT}.
* Index::                          Concept and Variable Index.

@detailmenu
* History::                             @command{gawk} ä¸ @command{awk} çš„å†å²ã€‚
* Names::                               @command{awk} çš„åˆ«åã€‚
* This Manual::                         ä½¿ç”¨æœ¬@value{DOCUMENT}ï¼›åŒ…æ‹¬ä½ å¯ä»¥ä½¿ç”¨çš„è¾“å…¥æ–‡ä»¶æ ·ä¾‹ã€‚
* Conventions::                         æ’ç‰ˆçº¦å®šã€‚
* Manual History::                      Brief history of the GNU project and
                                        this @value{DOCUMENT}.
* How To Contribute::                   Helping to save the world.
* Acknowledgments::                     Acknowledgments.
* Running gawk::                        How to run @command{gawk} programs;
                                        includes command-line syntax.
* One-shot::                            Running a short throwaway
                                        @command{awk} program.
* Read Terminal::                       Using no input files (input from the
                                        keyboard instead).
* Long::                                Putting permanent @command{awk}
                                        programs in files.
* Executable Scripts::                  Making self-contained @command{awk}
                                        programs.
* Comments::                            Adding documentation to @command{gawk}
                                        programs.
* Quoting::                             More discussion of shell quoting
                                        issues.
* DOS Quoting::                         Quoting in Windows Batch Files.
* Sample Data Files::                   Sample data files for use in the
                                        @command{awk} programs illustrated in
                                        this @value{DOCUMENT}.
* Very Simple::                         A very simple example.
* Two Rules::                           A less simple one-line example using
                                        two rules.
* More Complex::                        A more complex example.
* Statements/Lines::                    Subdividing or combining statements
                                        into lines.
* Other Features::                      Other Features of @command{awk}.
* When::                                When to use @command{gawk} and when to
                                        use other things.
* Intro Summary::                       Summary of the introduction.
* Command Line::                        How to run @command{awk}.
* Options::                             Command-line options and their
                                        meanings.
* Other Arguments::                     Input file names and variable
                                        assignments.
* Naming Standard Input::               How to specify standard input with
                                        other files.
* Environment Variables::               The environment variables
                                        @command{gawk} uses.
* AWKPATH Variable::                    Searching directories for
                                        @command{awk} programs.
* AWKLIBPATH Variable::                 Searching directories for
                                        @command{awk} shared libraries.
* Other Environment Variables::         The environment variables.
* Exit Status::                         @command{gawk}'s exit status.
* Include Files::                       Including other files into your
                                        program.
* Loading Shared Libraries::            Loading shared libraries into your
                                        program.
* Obsolete::                            Obsolete Options and/or features.
* Undocumented::                        Undocumented Options and Features.
* Invoking Summary::                    Invocation summary.
* Regexp Usage::                        How to Use Regular Expressions.
* Escape Sequences::                    How to write nonprinting characters.
* Regexp Operators::                    Regular Expression Operators.
* Bracket Expressions::                 What can go between @samp{[...]}.
* Leftmost Longest::                    How much text matches.
* Computed Regexps::                    Using Dynamic Regexps.
* GNU Regexp Operators::                Operators specific to GNU software.
* Case-sensitivity::                    How to do case-insensitive matching.
* Regexp Summary::                      Regular expressions summary.
* Records::                             Controlling how data is split into
                                        records.
* awk split records::                   How standard @command{awk} splits
                                        records.
* gawk split records::                  How @command{gawk} splits records.
* Fields::                              An introduction to fields.
* Nonconstant Fields::                  Nonconstant Field Numbers.
* Changing Fields::                     Changing the Contents of a Field.
* Field Separators::                    The field separator and how to change
                                        it.
* Default Field Splitting::             How fields are normally separated.
* Regexp Field Splitting::              Using regexps as the field separator.
* Single Character Fields::             Making each character a separate
                                        field.
* Command Line Field Separator::        Setting @code{FS} from the command
                                        line.
* Full Line Fields::                    Making the full line be a single
                                        field.
* Field Splitting Summary::             Some final points and a summary table.
* Constant Size::                       Reading constant width data.
* Splitting By Content::                Defining Fields By Content
* Multiple Line::                       Reading multiline records.
* Getline::                             Reading files under explicit program
                                        control using the @code{getline}
                                        function.
* Plain Getline::                       Using @code{getline} with no
                                        arguments.
* Getline/Variable::                    Using @code{getline} into a variable.
* Getline/File::                        Using @code{getline} from a file.
* Getline/Variable/File::               Using @code{getline} into a variable
                                        from a file.
* Getline/Pipe::                        Using @code{getline} from a pipe.
* Getline/Variable/Pipe::               Using @code{getline} into a variable
                                        from a pipe.
* Getline/Coprocess::                   Using @code{getline} from a coprocess.
* Getline/Variable/Coprocess::          Using @code{getline} into a variable
                                        from a coprocess.
* Getline Notes::                       Important things to know about
                                        @code{getline}.
* Getline Summary::                     Summary of @code{getline} Variants.
* Read Timeout::                        Reading input with a timeout.
* Command-line directories::            What happens if you put a directory on
                                        the command line.
* Input Summary::                       Input summary.
* Input Exercises::                     Exercises.
* Print::                               The @code{print} statement.
* Print Examples::                      Simple examples of @code{print}
                                        statements.
* Output Separators::                   The output separators and how to
                                        change them.
* OFMT::                                Controlling Numeric Output With
                                        @code{print}.
* Printf::                              The @code{printf} statement.
* Basic Printf::                        Syntax of the @code{printf} statement.
* Control Letters::                     Format-control letters.
* Format Modifiers::                    Format-specification modifiers.
* Printf Examples::                     Several examples.
* Redirection::                         How to redirect output to multiple
                                        files and pipes.
* Special FD::                          Special files for I/O.
* Special Files::                       File name interpretation in
                                        @command{gawk}. @command{gawk} allows
                                        access to inherited file descriptors.
* Other Inherited Files::               Accessing other open files with
                                        @command{gawk}.
* Special Network::                     Special files for network
                                        communications.
* Special Caveats::                     Things to watch out for.
* Close Files And Pipes::               Closing Input and Output Files and
                                        Pipes.
* Output Summary::                      Output summary.
* Output Exercises::                    Exercises.
* Values::                              Constants, Variables, and Regular
                                        Expressions.
* Constants::                           String, numeric and regexp constants.
* Scalar Constants::                    Numeric and string constants.
* Nondecimal-numbers::                  What are octal and hex numbers.
* Regexp Constants::                    Regular Expression constants.
* Using Constant Regexps::              When and how to use a regexp constant.
* Variables::                           Variables give names to values for
                                        later use.
* Using Variables::                     Using variables in your programs.
* Assignment Options::                  Setting variables on the command line
                                        and a summary of command-line syntax.
                                        This is an advanced method of input.
* Conversion::                          The conversion of strings to numbers
                                        and vice versa.
* Strings And Numbers::                 How @command{awk} Converts Between
                                        Strings And Numbers.
* Locale influences conversions::       How the locale may affect conversions.
* All Operators::                       @command{gawk}'s operators.
* Arithmetic Ops::                      Arithmetic operations (@samp{+},
                                        @samp{-}, etc.)
* Concatenation::                       Concatenating strings.
* Assignment Ops::                      Changing the value of a variable or a
                                        field.
* Increment Ops::                       Incrementing the numeric value of a
                                        variable.
* Truth Values and Conditions::         Testing for true and false.
* Truth Values::                        What is ``true'' and what is
                                        ``false''.
* Typing and Comparison::               How variables acquire types and how
                                        this affects comparison of numbers and
                                        strings with @samp{<}, etc.
* Variable Typing::                     String type versus numeric type.
* Comparison Operators::                The comparison operators.
* POSIX String Comparison::             String comparison with POSIX rules.
* Boolean Ops::                         Combining comparison expressions using
                                        boolean operators @samp{||} (``or''),
                                        @samp{&&} (``and'') and @samp{!}
                                        (``not'').
* Conditional Exp::                     Conditional expressions select between
                                        two subexpressions under control of a
                                        third subexpression.
* Function Calls::                      A function call is an expression.
* Precedence::                          How various operators nest.
* Locales::                             How the locale affects things.
* Expressions Summary::                 Expressions summary.
* Pattern Overview::                    What goes into a pattern.
* Regexp Patterns::                     Using regexps as patterns.
* Expression Patterns::                 Any expression can be used as a
                                        pattern.
* Ranges::                              Pairs of patterns specify record
                                        ranges.
* BEGIN/END::                           Specifying initialization and cleanup
                                        rules.
* Using BEGIN/END::                     How and why to use BEGIN/END rules.
* I/O And BEGIN/END::                   I/O issues in BEGIN/END rules.
* BEGINFILE/ENDFILE::                   Two special patterns for advanced
                                        control.
* Empty::                               The empty pattern, which matches every
                                        record.
* Using Shell Variables::               How to use shell variables with
                                        @command{awk}.
* Action Overview::                     What goes into an action.
* Statements::                          Describes the various control
                                        statements in detail.
* If Statement::                        Conditionally execute some
                                        @command{awk} statements.
* While Statement::                     Loop until some condition is
                                        satisfied.
* Do Statement::                        Do specified action while looping
                                        until some condition is satisfied.
* For Statement::                       Another looping statement, that
                                        provides initialization and increment
                                        clauses.
* Switch Statement::                    Switch/case evaluation for conditional
                                        execution of statements based on a
                                        value.
* Break Statement::                     Immediately exit the innermost
                                        enclosing loop.
* Continue Statement::                  Skip to the end of the innermost
                                        enclosing loop.
* Next Statement::                      Stop processing the current input
                                        record.
* Nextfile Statement::                  Stop processing the current file.
* Exit Statement::                      Stop execution of @command{awk}.
* Built-in Variables::                  Summarizes the predefined variables.
* User-modified::                       Built-in variables that you change to
                                        control @command{awk}.
* Auto-set::                            Built-in variables where @command{awk}
                                        gives you information.
* ARGC and ARGV::                       Ways to use @code{ARGC} and
                                        @code{ARGV}.
* Pattern Action Summary::              Patterns and Actions summary.
* Array Basics::                        The basics of arrays.
* Array Intro::                         Introduction to Arrays
* Reference to Elements::               How to examine one element of an
                                        array.
* Assigning Elements::                  How to change an element of an array.
* Array Example::                       Basic Example of an Array
* Scanning an Array::                   A variation of the @code{for}
                                        statement. It loops through the
                                        indices of an array's existing
                                        elements.
* Controlling Scanning::                Controlling the order in which arrays
                                        are scanned.
* Numeric Array Subscripts::            How to use numbers as subscripts in
                                        @command{awk}.
* Uninitialized Subscripts::            Using Uninitialized variables as
                                        subscripts.
* Delete::                              The @code{delete} statement removes an
                                        element from an array.
* Multidimensional::                    Emulating multidimensional arrays in
                                        @command{awk}.
* Multiscanning::                       Scanning multidimensional arrays.
* Arrays of Arrays::                    True multidimensional arrays.
* Arrays Summary::                      Summary of arrays.
* Built-in::                            Summarizes the built-in functions.
* Calling Built-in::                    How to call built-in functions.
* Numeric Functions::                   Functions that work with numbers,
                                        including @code{int()}, @code{sin()}
                                        and @code{rand()}.
* String Functions::                    Functions for string manipulation,
                                        such as @code{split()}, @code{match()}
                                        and @code{sprintf()}.
* Gory Details::                        More than you want to know about
                                        @samp{\} and @samp{&} with
                                        @code{sub()}, @code{gsub()}, and
                                        @code{gensub()}.
* I/O Functions::                       Functions for files and shell
                                        commands.
* Time Functions::                      Functions for dealing with timestamps.
* Bitwise Functions::                   Functions for bitwise operations.
* Type Functions::                      Functions for type information.
* I18N Functions::                      Functions for string translation.
* User-defined::                        Describes User-defined functions in
                                        detail.
* Definition Syntax::                   How to write definitions and what they
                                        mean.
* Function Example::                    An example function definition and
                                        what it does.
* Function Caveats::                    Things to watch out for.
* Calling A Function::                  Don't use spaces.
* Variable Scope::                      Controlling variable scope.
* Pass By Value/Reference::             Passing parameters.
* Return Statement::                    Specifying the value a function
                                        returns.
* Dynamic Typing::                      How variable types can change at
                                        runtime.
* Indirect Calls::                      Choosing the function to call at
                                        runtime.
* Functions Summary::                   Summary of functions.
* Library Names::                       How to best name private global
                                        variables in library functions.
* General Functions::                   Functions that are of general use.
* Strtonum Function::                   A replacement for the built-in
                                        @code{strtonum()} function.
* Assert Function::                     A function for assertions in
                                        @command{awk} programs.
* Round Function::                      A function for rounding if
                                        @code{sprintf()} does not do it
                                        correctly.
* Cliff Random Function::               The Cliff Random Number Generator.
* Ordinal Functions::                   Functions for using characters as
                                        numbers and vice versa.
* Join Function::                       A function to join an array into a
                                        string.
* Getlocaltime Function::               A function to get formatted times.
* Readfile Function::                   A function to read an entire file at
                                        once.
* Shell Quoting::                       A function to quote strings for the
                                        shell.
* Data File Management::                Functions for managing command-line
                                        data files.
* Filetrans Function::                  A function for handling data file
                                        transitions.
* Rewind Function::                     A function for rereading the current
                                        file.
* File Checking::                       Checking that data files are readable.
* Empty Files::                         Checking for zero-length files.
* Ignoring Assigns::                    Treating assignments as file names.
* Getopt Function::                     A function for processing command-line
                                        arguments.
* Passwd Functions::                    Functions for getting user
                                        information.
* Group Functions::                     Functions for getting group
                                        information.
* Walking Arrays::                      A function to walk arrays of arrays.
* Library Functions Summary::           Summary of library functions.
* Library Exercises::                   Exercises.
* Running Examples::                    How to run these examples.
* Clones::                              Clones of common utilities.
* Cut Program::                         The @command{cut} utility.
* Egrep Program::                       The @command{egrep} utility.
* Id Program::                          The @command{id} utility.
* Split Program::                       The @command{split} utility.
* Tee Program::                         The @command{tee} utility.
* Uniq Program::                        The @command{uniq} utility.
* Wc Program::                          The @command{wc} utility.
* Miscellaneous Programs::              Some interesting @command{awk}
                                        programs.
* Dupword Program::                     Finding duplicated words in a
                                        document.
* Alarm Program::                       An alarm clock.
* Translate Program::                   A program similar to the @command{tr}
                                        utility.
* Labels Program::                      Printing mailing labels.
* Word Sorting::                        A program to produce a word usage
                                        count.
* History Sorting::                     Eliminating duplicate entries from a
                                        history file.
* Extract Program::                     Pulling out programs from Texinfo
                                        source files.
* Simple Sed::                          A Simple Stream Editor.
* Igawk Program::                       A wrapper for @command{awk} that
                                        includes files.
* Anagram Program::                     Finding anagrams from a dictionary.
* Signature Program::                   People do amazing things with too much
                                        time on their hands.
* Programs Summary::                    Summary of programs.
* Programs Exercises::                  Exercises.
* Nondecimal Data::                     Allowing nondecimal input data.
* Array Sorting::                       Facilities for controlling array
                                        traversal and sorting arrays.
* Controlling Array Traversal::         How to use PROCINFO["sorted_in"].
* Array Sorting Functions::             How to use @code{asort()} and
                                        @code{asorti()}.
* Two-way I/O::                         Two-way communications with another
                                        process.
* TCP/IP Networking::                   Using @command{gawk} for network
                                        programming.
* Profiling::                           Profiling your @command{awk} programs.
* Advanced Features Summary::           Summary of advanced features.
* I18N and L10N::                       Internationalization and Localization.
* Explaining gettext::                  How GNU @command{gettext} works.
* Programmer i18n::                     Features for the programmer.
* Translator i18n::                     Features for the translator.
* String Extraction::                   Extracting marked strings.
* Printf Ordering::                     Rearranging @code{printf} arguments.
* I18N Portability::                    @command{awk}-level portability
                                        issues.
* I18N Example::                        A simple i18n example.
* Gawk I18N::                           @command{gawk} is also
                                        internationalized.
* I18N Summary::                        Summary of I18N stuff.
* Debugging::                           Introduction to @command{gawk}
                                        debugger.
* Debugging Concepts::                  Debugging in General.
* Debugging Terms::                     Additional Debugging Concepts.
* Awk Debugging::                       Awk Debugging.
* Sample Debugging Session::            Sample debugging session.
* Debugger Invocation::                 How to Start the Debugger.
* Finding The Bug::                     Finding the Bug.
* List of Debugger Commands::           Main debugger commands.
* Breakpoint Control::                  Control of Breakpoints.
* Debugger Execution Control::          Control of Execution.
* Viewing And Changing Data::           Viewing and Changing Data.
* Execution Stack::                     Dealing with the Stack.
* Debugger Info::                       Obtaining Information about the
                                        Program and the Debugger State.
* Miscellaneous Debugger Commands::     Miscellaneous Commands.
* Readline Support::                    Readline support.
* Limitations::                         Limitations and future plans.
* Debugging Summary::                   Debugging summary.
* Computer Arithmetic::                 A quick intro to computer math.
* Math Definitions::                    Defining terms used.
* MPFR features::                       The MPFR features in @command{gawk}.
* FP Math Caution::                     Things to know.
* Inexactness of computations::         Floating point math is not exact.
* Inexact representation::              Numbers are not exactly represented.
* Comparing FP Values::                 How to compare floating point values.
* Errors accumulate::                   Errors get bigger as they go.
* Getting Accuracy::                    Getting more accuracy takes some work.
* Try To Round::                        Add digits and round.
* Setting precision::                   How to set the precision.
* Setting the rounding mode::           How to set the rounding mode.
* Arbitrary Precision Integers::        Arbitrary Precision Integer Arithmetic
                                        with @command{gawk}.
* POSIX Floating Point Problems::       Standards Versus Existing Practice.
* Floating point summary::              Summary of floating point discussion.
* Extension Intro::                     What is an extension.
* Plugin License::                      A note about licensing.
* Extension Mechanism Outline::         An outline of how it works.
* Extension API Description::           A full description of the API.
* Extension API Functions Introduction:: Introduction to the API functions.
* General Data Types::                  The data types.
* Memory Allocation Functions::         Functions for allocating memory.
* Constructor Functions::               Functions for creating values.
* Registration Functions::              Functions to register things with
                                        @command{gawk}.
* Extension Functions::                 Registering extension functions.
* Exit Callback Functions::             Registering an exit callback.
* Extension Version String::            Registering a version string.
* Input Parsers::                       Registering an input parser.
* Output Wrappers::                     Registering an output wrapper.
* Two-way processors::                  Registering a two-way processor.
* Printing Messages::                   Functions for printing messages.
* Updating @code{ERRNO}::               Functions for updating @code{ERRNO}.
* Requesting Values::                   How to get a value.
* Accessing Parameters::                Functions for accessing parameters.
* Symbol Table Access::                 Functions for accessing global
                                        variables.
* Symbol table by name::                Accessing variables by name.
* Symbol table by cookie::              Accessing variables by ``cookie''.
* Cached values::                       Creating and using cached values.
* Array Manipulation::                  Functions for working with arrays.
* Array Data Types::                    Data types for working with arrays.
* Array Functions::                     Functions for working with arrays.
* Flattening Arrays::                   How to flatten arrays.
* Creating Arrays::                     How to create and populate arrays.
* Extension API Variables::             Variables provided by the API.
* Extension Versioning::                API Version information.
* Extension API Informational Variables:: Variables providing information about
                                        @command{gawk}'s invocation.
* Extension API Boilerplate::           Boilerplate code for using the API.
* Finding Extensions::                  How @command{gawk} finds compiled
                                        extensions.
* Extension Example::                   Example C code for an extension.
* Internal File Description::           What the new functions will do.
* Internal File Ops::                   The code for internal file operations.
* Using Internal File Ops::             How to use an external extension.
* Extension Samples::                   The sample extensions that ship with
                                        @command{gawk}.
* Extension Sample File Functions::     The file functions sample.
* Extension Sample Fnmatch::            An interface to @code{fnmatch()}.
* Extension Sample Fork::               An interface to @code{fork()} and
                                        other process functions.
* Extension Sample Inplace::            Enabling in-place file editing.
* Extension Sample Ord::                Character to value to character
                                        conversions.
* Extension Sample Readdir::            An interface to @code{readdir()}.
* Extension Sample Revout::             Reversing output sample output
                                        wrapper.
* Extension Sample Rev2way::            Reversing data sample two-way
                                        processor.
* Extension Sample Read write array::   Serializing an array to a file.
* Extension Sample Readfile::           Reading an entire file into a string.
* Extension Sample Time::               An interface to @code{gettimeofday()}
                                        and @code{sleep()}.
* Extension Sample API Tests::          Tests for the API.
* gawkextlib::                          The @code{gawkextlib} project.
* Extension summary::                   Extension summary.
* Extension Exercises::                 Exercises.
* V7/SVR3.1::                           The major changes between V7 and
                                        System V Release 3.1.
* SVR4::                                Minor changes between System V
                                        Releases 3.1 and 4.
* POSIX::                               New features from the POSIX standard.
* BTL::                                 New features from Brian Kernighan's
                                        version of @command{awk}.
* POSIX/GNU::                           The extensions in @command{gawk} not
                                        in POSIX @command{awk}.
* Feature History::                     The history of the features in
                                        @command{gawk}.
* Common Extensions::                   Common Extensions Summary.
* Ranges and Locales::                  How locales used to affect regexp
                                        ranges.
* Contributors::                        @command{gawk} çš„ä¸»è¦è´¡çŒ®è€….
* History summary::                     History summary.
* Gawk Distribution::                   What is in the @command{gawk}
                                        distribution.
* Getting::                             How to get the distribution.
* Extracting::                          How to extract the distribution.
* Distribution contents::               What is in the distribution.
* Unix Installation::                   Installing @command{gawk} under
                                        various versions of Unix.
* Quick Installation::                  Compiling @command{gawk} under Unix.
* Additional Configuration Options::    Other compile-time options.
* Configuration Philosophy::            How it's all supposed to work.
* Non-Unix Installation::               Installation on Other Operating
                                        Systems.
* PC Installation::                     Installing and Compiling
                                        @command{gawk} on MS-DOS and OS/2.
* PC Binary Installation::              Installing a prepared distribution.
* PC Compiling::                        Compiling @command{gawk} for MS-DOS,
                                        Windows32, and OS/2.
* PC Testing::                          Testing @command{gawk} on PC systems.
* PC Using::                            Running @command{gawk} on MS-DOS,
                                        Windows32 and OS/2.
* Cygwin::                              Building and running @command{gawk}
                                        for Cygwin.
* MSYS::                                Using @command{gawk} In The MSYS
                                        Environment.
* VMS Installation::                    Installing @command{gawk} on VMS.
* VMS Compilation::                     How to compile @command{gawk} under
                                        VMS.
* VMS Dynamic Extensions::              Compiling @command{gawk} dynamic
                                        extensions on VMS.
* VMS Installation Details::            How to install @command{gawk} under
                                        VMS.
* VMS Running::                         How to run @command{gawk} under VMS.
* VMS GNV::                             The VMS GNV Project.
* VMS Old Gawk::                        An old version comes with some VMS
                                        systems.
* Bugs::                                Reporting Problems and Bugs.
* Other Versions::                      Other freely available @command{awk}
                                        implementations.
* Installation summary::                Summary of installation.
* Compatibility Mode::                  How to disable certain @command{gawk}
                                        extensions.
* Additions::                           Making Additions To @command{gawk}.
* Accessing The Source::                Accessing the Git repository.
* Adding Code::                         Adding code to the main body of
                                        @command{gawk}.
* New Ports::                           Porting @command{gawk} to a new
                                        operating system.
* Derived Files::                       Why derived files are kept in the Git
                                        repository.
* Future Extensions::                   New features that may be implemented
                                        one day.
* Implementation Limitations::          Some limitations of the
                                        implementation.
* Extension Design::                    Design notes about the extension API.
* Old Extension Problems::              Problems with the old mechanism.
* Extension New Mechanism Goals::       Goals for the new mechanism.
* Extension Other Design Decisions::    Some other design decisions.
* Extension Future Growth::             Some room for future growth.
* Old Extension Mechanism::             Some compatibility for old extensions.
* Notes summary::                       Summary of implementation notes.
* Basic High Level::                    The high level view.
* Basic Data Typing::                   A very quick intro to data types.
@end detailmenu
@end menu

@c dedication for Info file
@ifinfo
To my parents, for their love, and for the wonderful
example they set for me.
@sp 1
To my wife Miriam, for making me complete.
Thank you for building your life together with me.
@sp 1
To our children Chana, Rivka, Nachum and Malka,
for enrichening our lives in innumerable ways.
@end ifinfo

@summarycontents
@contents

@node Foreword3
@unnumbered ç¬¬ä¸‰ç‰ˆå‰è¨€

@c This bit is post-processed by a script which turns the chapter
@c tag into a preface tag, and moves this stuff to before the title.
@c Bleah.
@docbook
  <prefaceinfo>
    <author>
      <firstname>Michael</firstname>
      <surname>Brennan</surname>
      <!-- can't put mawk into command tags. sigh. -->
      <affiliation><jobtitle>Author of mawk</jobtitle></affiliation>
    </author>
    <date>March 2001</date>
   </prefaceinfo>
@end docbook

æˆ‘è·Ÿ Arnold Robbins æ˜¯å¥½æœ‹å‹ã€‚ åœ¨ 1990 å¹´ï¼Œ
@c 11 years ago
æˆ‘ä»¬ç”±äº AWK å› ç¼˜é™…ä¼šè€Œç»“è¯†ã€‚
å½“æ—¶æˆ‘æ­£å¼€å§‹ä¸€ä»½æ–°å·¥ä½œï¼Œå¹¶æ³¨æ„åˆ°åœ¨å…¬å¸è§’è½é‡Œæ”¾ç€ä¸€å°æ²¡ç”¨çš„ Unix è®¡ç®—æœºã€‚
æ²¡æœ‰äººçŸ¥é“æ€ä¹ˆä½¿ç”¨å®ƒï¼Œæˆ‘ä¹Ÿä¸ä¼šã€‚ä½†æ˜¯ï¼Œå‡ å¤©åï¼Œå®ƒè·‘èµ·æ¥äº†ï¼Œå¹¶ä¸”æˆ‘å°±æ˜¯ rootï¼Œä¹Ÿæ˜¯å”¯ä¸€çš„ç”¨æˆ·ã€‚
ä»é‚£å¤©èµ·ï¼Œæˆ‘å°±å¼€å§‹ä»ä¸€ä¸ªç»Ÿè®¡åˆ†æå¸ˆå‘ä¸€ä¸ª Unix ç¨‹åºå‘˜è½¬å˜äº†ã€‚

æˆ‘ç»å¸¸å¾€è¿”äºå›¾ä¹¦é¦†ä¸ä¹¦åº—ï¼Œæœç´¢è·Ÿ Unix ç›¸å…³çš„å›¾ä¹¦ã€‚
æœ‰ä¸€æ¬¡æ‰¾åˆ°ä¸€æœ¬ç°è‰²çš„ AWK ç›¸å…³çš„ä¹¦ï¼Œå³ a.k.a.@: 
Alfred V.@: Aho, Brian W.@: Kernighan, ä¸ Peter J.@: Weinberger å†™çš„ @cite{The AWK Programming Language}ï¼ˆAddison-Wesley, 1988ï¼‰ã€‚
@command{awk} ç®€æ´çš„ç¼–ç¨‹è§„èŒƒâ€”â€”å°±æ˜¯åœ¨è¾“å…¥ä¸­æŸ¥æ‰¾æŸç§æ¨¡å¼çš„å­—ä¸²å¹¶æ‰§è¡Œç›¸åº”åŠ¨ä½œâ€”â€”ç»å¸¸èƒ½å¤Ÿå°†å¤æ‚çš„æˆ–è€…å†—é•¿çš„æ“ä½œåŒ–ä¸ºå‡ è¡Œä»£ç ã€‚
æˆ‘éå¸¸å…´å¥‹ï¼Œå¹¶ç€æ‰‹å¼€å§‹åˆ©ç”¨ AWK è¿›è¡Œç¼–ç¨‹ã€‚

å¯æ˜¯ï¼Œæˆ‘è®¡ç®—æœºä¸Šçš„ @command{awk} æ˜¯åœ¨ç°è‰²ä¹¦é‡Œæ‰€æè¿°çš„ä¸€ä¸ªå—é™çš„è¯­è¨€ç‰ˆæœ¬ã€‚
è€Œæˆ‘å‘ç°æˆ‘çš„è®¡ç®—æœºä¸­çš„å°±æ˜¯â€œæ—§ @command{awk}â€ï¼Œè€Œä¹¦ä¸­è®²è¿°çš„æ˜¯â€œæ–° @command{awk}â€ã€‚
æˆ‘çŸ¥é“è¿™æ˜¯å…¸å‹æƒ…å†µï¼›æ—§ç‰ˆæœ¬ä¸è‚¯è®©ä½ï¼Œä¹Ÿä¸æ„¿æ„æ”¾å¼ƒè‡ªå·±çš„åå­—ã€‚
å¦‚æœä¸€ä¸ªç³»ç»Ÿæœ‰ä¸€ä¸ªâ€œæ–° @command{awk}â€ï¼Œå°±ä¼šæ¯«æ— ä¾‹å¤–åœ°å«åš @command{nawk}ï¼Œå¹¶ä¸”æœ‰å‡ ä¸ªç³»ç»Ÿæœ‰è¿™æ ·çš„è½¯ä»¶ã€‚
å–å¾— @command{nawk} çš„æ–¹å¼æ˜¯é€šè¿‡ @code{prep.ai.mit.edu} çš„ @command{ftp} ä¸‹è½½æºä»£ç ã€‚
@command{gawk} æ˜¯ä¸€ä¸ªç”± David Trueman and Arnold æ‰€å†™çš„æ–°ç‰ˆæœ¬çš„ @command{awk}ï¼Œå¹¶å¯ä»¥åœ¨ GNU General Public License çš„è®¸å¯ä¸‹å–å¾—ã€‚

ï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œç°åœ¨æ‰¾â€œæ–° @command{awk}â€å¾ˆå®¹æ˜“äº†ï¼ŒGNU/Linux å°±å¸¦æœ‰ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ä¸‹è½½äºŒè¿›åˆ¶ç‰ˆæœ¬æˆ–è€…æºä»£ç ï¼›
æˆ‘è€å©†å°±åœ¨å¥¹çš„ VMS BOX ä¸­ä½¿ç”¨ @command{gawk}ã€‚ï¼‰

æˆ‘çš„ Unix ç³»ç»Ÿå› é—²ç½®è€Œè¢«ä½¿ç”¨èµ·æ¥ï¼Œå½“ç„¶ä¹Ÿè¿˜ä¸ä¼šè¿æ¥åˆ°ç½‘ç»œä¸­ã€‚
å› æ­¤ï¼Œå¾ˆæ˜æ˜¾ç”±äº @command{gawk} çš„å­˜åœ¨ï¼Œä»¥åŠ Unix ç¤¾ä¼šç¤¾åŒºçš„ä¸€èˆ¬ç‰¹ç‚¹ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªâ€œæ–° @command{awk}â€ã€‚
å› æ­¤ï¼Œæˆ‘å°±å†™äº†ä¸€ä¸ªï¼Œæˆ‘æŠŠå®ƒå«åš @command{mawk}ã€‚
åœ¨æˆ‘å®Œæˆå‰ï¼Œæˆ‘å·²ç»çŸ¥é“äº† @command{gawk}ï¼Œä½†æ˜¯å·²ç»å¤ªè¿Ÿäº†ã€‚
å› æ­¤ï¼Œæˆ‘è¿˜æ˜¯æŠŠ @command{mawk} å‘é€åˆ°äº† @code{comp.source} çš„æ–°é—»ç»„é‡Œã€‚

å‡ å¤©åï¼Œæˆ‘æ”¶åˆ°äº†æ¥è‡ª Arnold çš„é‚®ä»¶ï¼Œé‡Œé¢ä»–ä»‹ç»äº†ä¸€ä¸‹ä»–è‡ªå·±ã€‚
ä»–å»ºè®®æˆ‘åˆ†äº« @command{mawk} çš„è®¾è®¡ä¸ç®—æ³•ï¼Œå¹¶ä¸”æäº¤ä¸€ä¸ª POSIX æ ‡å‡†è‰æ¡ˆï¼Œè¿™æ ·æˆ‘å°±èƒ½å¤Ÿæ›´æ–° @command{mawk} æ¥æ”¯æŒ @cite{The AWK Programming Language} å‘å¸ƒåçš„è¯­è¨€æ‰©å±•ã€‚

è¢’ç™½è®²ï¼Œå¦‚æœæˆ‘ä»¬çš„è§’è‰²äº’æ¢ï¼Œæˆ‘å¯èƒ½å°±ä¸ä¼šå¦‚æ­¤å¼€æ”¾ï¼Œæˆ‘ä»¬ä¹Ÿå°±å¯èƒ½ä»ä¸ä¼šè§é¢ã€‚
æˆ‘å¾ˆé«˜å…´æˆ‘ä»¬è§äº†ä¸€é¢ã€‚ä»–æ˜¯ä¸€ä¸ª AWK ä¸“å®¶ä¸­çš„ä¸“å®¶ï¼Œä¹Ÿæ˜¯ç¡®å®æ˜¯ä¸ªå¥½äººã€‚
Arnold ä¸º Free Software Foundation è´¡çŒ®äº†å¾ˆå¤šçš„æ‰èƒ½ä¸æ—¶é—´ã€‚

è¿™æœ¬ä¹¦æ˜¯ @command{gawk} çš„å‚è€ƒä¹¦ï¼Œä½†æ˜¯æ ¸å¿ƒæ˜¯ä¸€ä¸ªå…³äº AWK ç¼–ç¨‹çš„ä¹¦ï¼Œé€‚ç”¨äºéå¸¸å¹¿çš„è¯»è€…ã€‚
ç¼–ç¨‹è§„èŒƒå‚è€ƒçš„æ˜¯ 1987 å¹´è´å°”å®éªŒå®¤çš„å®šä¹‰ï¼Œå¹¶äº 1992 å¹´æˆä¸º POSIX å·¥å…·æ ‡å‡†çš„è¯­è¨€è§„èŒƒã€‚

å¦ä¸€æ–¹é¢ï¼Œå¯¹äº AWK ç¨‹åºæ–°æ‰‹ï¼Œèƒ½å¤Ÿå­¦åˆ°å®ç”¨çš„ç¼–ç¨‹æ–¹æ³•ï¼Œè€Œè¿™ä¹Ÿæ­£æ˜¯ AWK çš„åŸºæœ¬æ–¹æ³•ï¼š
æ•°æ®é©±åŠ¨æ§åˆ¶æµï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œä»¥åŠå…³è”æ•°ç»„ã€‚é‚£äº›æ­£åœ¨å°é²œçš„äººå¯ä»¥é€šè¿‡ç‰¹æ®Šçš„ @file{/inet} æ–‡ä»¶æ¥ä½¿ç”¨ @command{gawk} çš„ç½‘ç»œåè®®æ¥å£ã€‚

è¿™æœ¬ä¹¦ä¸­çš„ä¾‹å­ä¼šæ¸…æ¥šåœ°è¡¨æ˜ï¼Œä½¿ç”¨ AWK ç¼–å†™çš„ç¨‹åºè¦æ¯”Cå†™æˆçš„ç¨‹åºæ›´å°æ›´å¿«ã€‚
ç»“æœï¼Œå¯èƒ½åˆ©ç”¨ AWK æ¥ç¼–å†™ç®—æ³•å¹¶å¿«é€Ÿè¿è¡Œï¼Œä»¥æ­¤æ¥åŠæ—¶å‘ç°é—®é¢˜ã€‚ç»å¸¸çš„æƒ…å†µä¸‹ï¼Œè§£é‡Šå‹çš„æ€§èƒ½å°±è¶³å¤Ÿäº†ï¼Œå› æ­¤ AWK çš„åŸå‹å°±ç›´æ¥è½¬æ¢æˆäº†äº§å“ã€‚

æ–°çš„ @command{pgawk}ï¼ˆprofiling gawkï¼‰ä¼šäº§ç”Ÿä»£ç æ‰§è¡Œçš„é‡‡æ ·æ•°æ®ã€‚
æˆ‘æœ€è¿‘å®éªŒäº†ä¸€ä¸ªç®—æ³•ï¼Œå³å¯¹ 
@ifnotdocbook
@math{n}
@end ifnotdocbook
@ifdocbook
@i{n}
@end ifdocbook 
è¡Œè¾“å…¥ï¼Œæ˜¾ç¤ºå‡ºçº¦
@tex
$\sim\! Cn^2$
@end tex
@ifnottex
@ifnotdocbook
~ C n^2
@end ifnotdocbook
@end ifnottex
@docbook
<emphasis>&sim; Cn<superscript>2</superscript></emphasis>
@end docbook
è¿™æ ·çš„æ€§èƒ½ï¼Œè€Œç†è®ºé¢„æµ‹ä¸‹ä¸ºçº¦ 
@tex
$\sim\! Cn\log n$
@end tex
@ifnottex
@ifnotdocbook
~ C n log n
@end ifnotdocbook
@end ifnottex
@docbook
<emphasis>&sim; Cn log n</emphasis>
@end docbook
ã€‚æŸ¥çœ‹äº† @file{awkprof.out} ç¨‹åºå‡ åˆ†é’Ÿåï¼Œå°±åœ¨ç¨‹åºçš„ä¸€è¡Œä»£ç ä¸­å‘ç°äº†é—®é¢˜æ‰€åœ¨ã€‚
è¿™æ ·ï¼Œ@command{pgawk} åˆæˆä¸ºæˆ‘ç¨‹åºå‘˜å·¥å…·ç®±ä¸­çš„ä¸€ä¸ªå¥½å·¥å…·ã€‚

Arnold æ·«æµ¸åœ¨ AWK ä¸­æœ‰åå‡ å¹´ï¼Œå¹¶ä¸”å¼€å‘äº† @command{gawk}ï¼Œä¹Ÿå³æœ¬ä¹¦çš„ä¸»é¢˜ã€‚å¦‚æœä½ ä½¿ç”¨ AWKï¼Œå¹¶ä¸”æƒ³çŸ¥é“ howï¼Œé‚£ä¹ˆå°±è¯»è¿™æœ¬ä¹¦å§ã€‚

@ifnotdocbook
@cindex Brennan, Michael
@display
Michael Brennan
Author of @command{mawk}
March 2001
@end display
@end ifnotdocbook

@node Foreword4
@unnumbered ç¬¬å››ç‰ˆå‰è¨€

@c This bit is post-processed by a script which turns the chapter
@c tag into a preface tag, and moves this stuff to before the title.
@c Bleah.
@docbook
  <prefaceinfo>
    <author>
      <firstname>Michael</firstname>
      <surname>Brennan</surname>
      <!-- can't put mawk into command tags. sigh. -->
      <affiliation><jobtitle>Author of mawk</jobtitle></affiliation>
    </author>
    <date>October 2014</date>
   </prefaceinfo>
@end docbook

æœ‰äº›ä¸œè¥¿ä¸€ç›´æ²¡æœ‰å˜åŒ–ã€‚
13 å¹´å‰ï¼Œæˆ‘å†™ä¸‹â€œå¦‚æœä½ ä½¿ç”¨ AWK æˆ–è€…æƒ³å­¦ä¹ å®ƒå¦‚ä½•å·¥ä½œï¼Œé‚£ä¹ˆå°±è¯»è¿™æœ¬ä¹¦ã€‚â€
è¿™å¥è¯å½“æ—¶æ˜¯çœŸç†ï¼Œè€Œç°åœ¨ä¾ç„¶æ˜¯çœŸç†ã€‚

å­¦ä¹ å¦‚ä½•ä½¿ç”¨ç¼–ç¨‹è¯­è¨€å¹¶ä»…ä»…æ˜¯æŒæ¡è¯­æ³•è¿™ä¹ˆç®€å•ã€‚éœ€è¦åœ¨ç†è§£çš„åŸºç¡€ä¸Šåˆ©ç”¨è¯­è¨€æä¾›çš„ç‰¹æ€§æ¥è§£å†³ç°å®ä¸­çš„ç¼–ç¨‹é—®é¢˜ã€‚è¿™æœ¬ä¹¦çš„ç„¦ç‚¹å°±æ˜¯ç”¨è®¸å¤šçš„ä¾‹å­æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨ AWKã€‚

è€Œæœ‰äº›ä¸œè¥¿æ˜¯æœ‰å˜åŒ–çš„ã€‚æˆ‘ä»¬çš„è®¡ç®—æœºè¦æ¯”ä¹‹å‰å¿«å¾—å¤šï¼Œå¹¶ä¸”æœ‰æ›´å¤šçš„å†…å­˜ã€‚ç»“æœæ˜¯é«˜çº§çš„è¯­è¨€å¯¼è‡´äº†é€Ÿåº¦ä¸å­˜å‚¨çš„ä½æ•ˆä½¿ç”¨ã€‚å› ä¸ºæ€§èƒ½è€Œå…ˆåœ¨ AWK ä¸­å†™åŸå‹ç„¶åç”¨ C é‡å†™ï¼Œè¿™ç§æƒ…å†µå¾ˆå°‘å‘ç”Ÿï¼Œå› ä¸ºæ›´å¤šçš„æƒ…å†µä¸‹ï¼ŒåŸå‹å·²ç»è¶³å¤Ÿå¿«äº†ã€‚

å½“ç„¶ï¼Œæœ‰äº›æ“ä½œæ›´é€‚åˆäºç”¨ C æˆ–è€… C++ æ¥å®ç°ï¼Œå¯¹äº @command{gawk} 4.1 ä»¥åŠåé¢çš„ç‰ˆæœ¬ï¼Œä½ ä¸éœ€è¦é€‰æ‹©åˆ°åº•æ˜¯ç”¨ AWK è¿˜æ˜¯ç”¨ C/C++ æ¥å®ç°ã€‚ä½ å¯ä»¥ç”¨ AWK æ¥å®ç°å¤§éƒ¨åˆ†çš„ç¨‹åºã€‚è€Œç”¨ C/C++ æ¥å†™çš„ç¨‹åºï¼Œä½ å®Œå…¨å¯ä»¥ç”¨ C æˆ–è€… C++ æ¥å†™æˆåŠ¨æ€æ’ä»¶ï¼Œç„¶åä½¿ç”¨ @command{gawk} è¿›è¡Œè£…è½½åˆå¹¶ã€‚
@c Chapter 16
@ref{Dynamic Extensions},
æè¿°äº†æ‰€æœ‰çš„æŠ€æœ¯ç»†èŠ‚ï¼Œå…¶ä¸­æœ‰è®¸å¤šçš„ä¾‹å­ï¼Œå¸Œæœ›è®©ä½ å­¦ä¹ åˆ°é‡Œé‡Œå¤–å¤–çš„ä¸€åˆ‡ã€‚

æˆ‘å¾ˆäº«å—ç”¨ AWK æ¥è¿›è¡Œç¼–ç¨‹ï¼Œå¹¶ä¸”åœ¨ç”¨å¿ƒï¼ˆé‡ï¼‰è¯»è¿™æœ¬ä¹¦ã€‚æˆ‘æƒ³ä½ ä¹Ÿä¼šè¿™æ ·ã€‚

@ifnotdocbook
@cindex Brennan, Michael
@display
Michael Brennan
Author of @command{mawk}
October 2014
@end display
@end ifnotdocbook

@node Preface
@unnumbered å‰è¨€

@c I saw a comment somewhere that the preface should describe the book itself,
@c and the introduction should describe what the book covers.
@c
@c 12/2000: Chuck wants the preface & intro combined.

@c This bit is post-processed by a script which turns the chapter
@c tag into a preface tag, and moves this stuff to before the title.
@c Bleah.
@docbook
  <prefaceinfo>
    <author>
      <firstname>Arnold</firstname>
      <surname>Robbins</surname>
      <affiliation><jobtitle>Nof Ayalon</jobtitle></affiliation>
      <affiliation><jobtitle>Israel</jobtitle></affiliation>
    </author>
    <date>February 2015</date>
   </prefaceinfo>
@end docbook

å½“å·¥ä½œäºæ–‡æœ¬æ–‡ä»¶çš„æ—¶å€™ï¼Œæœ‰å‡ ç±»å·¥ä½œä¸æ–­é‡å¤å‡ºç°ã€‚
ä½ å¯èƒ½æƒ³æŠ½å–æŒ‡å®šçš„è¡Œå¹¶ä¸¢å¼ƒå…¶ä»–éƒ¨åˆ†ã€‚æˆ–è€…ä½ æƒ³æ›´æ”¹ç‰¹å®šæ¨¡å¼çš„æ–‡æœ¬ï¼Œè€Œå…¶ä»–éƒ¨åˆ†çš„ä¸å˜ã€‚
è¿™æ ·çš„å·¥ä½œä½¿ç”¨ @command{awk} æ¥å®Œæˆé€šå¸¸å¾ˆç®€å•ã€‚@command{awk} å·¥å…·è§£é‡Šç‰¹å®šçš„ç¼–ç¨‹è¯­è¨€ï¼Œä½¿å¾—å®ƒå¤„ç†æ•°æ®é‡ç»„çš„å·¥ä½œéå¸¸åœ¨è¡Œã€‚

GNU ç‰ˆæœ¬çš„ @command{awk} ç§°ä¸º @command{gawk}ã€‚åœ¨ä½¿ç”¨æ°å½“çš„å‚æ•°æˆ–è€…ç¯å¢ƒå˜é‡çš„æƒ…å†µä¸‹ï¼Œ
å®ƒå®Œå…¨ä¸ POSIX æ ‡å‡†@footnote{The 2008 POSIX standard is accessible online at
@w{@url{http://www.opengroup.org/onlinepubs/9699919799/}.}} @command{awk} è¯­è¨€å…¼å®¹ï¼ŒåŒæ—¶ä¸ Brian Kemighan ç»´æŠ¤çš„ Unix ç‰ˆæœ¬çš„ @command{awk} è¯­è¨€å…¼å®¹ã€‚
è¿™å°±æ˜¯è¯´ï¼Œæ­£ç¡®ç¼–å†™çš„ @command{awk} ç¨‹åºï¼Œä¹Ÿå¯ä»¥åœ¨ @command{gawk} ä¸‹è¿è¡Œã€‚å› æ­¤ï¼Œåœ¨å¤§å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸åŒºåˆ«ä¸¤è€…çš„å®ç°ã€‚

@cindex @command{awk}, POSIX and, See Also POSIX @command{awk}
@cindex @command{awk}, POSIX and
@cindex POSIX, @command{awk} and
@cindex @command{gawk}, @command{awk} and
@cindex @command{awk}, @command{gawk} and
@cindex @command{awk}, uses for

é€šè¿‡ @command{awk} æˆ‘ä»¬å¯ä»¥è¾¾åˆ°å¦‚ä¸‹ç›®çš„ï¼š

@itemize @value{BULLET}
@item
ç®¡ç†å°çš„ä¸ªäººæ•°æ®åº“

@item
äº§ç”ŸæŠ¥è¡¨

@item
å®Œå–„æ•°æ®

@item
äº§ç”Ÿç´¢å¼•å¹¶æ‰§è¡Œå…¶ä»–æ–‡ä»¶å‡†å¤‡å·¥ä½œ

@item
å®éªŒç®—æ³•ï¼Œè¿™æ ·å¯ä»¥å›å¤´ç”¨å…¶ä»–çš„è¯­è¨€å®ç°ã€‚

@end itemize

@cindex @command{awk}, See Also @command{gawk}
@cindex @command{gawk}, See Also @command{awk}
@cindex @command{gawk}, uses for

é™¤æ­¤ä¹‹å¤–ï¼Œ@command{gawk} è¿˜æä¾›å¦‚ä¸‹è®¾æ–½ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿï¼š

@itemize @value{BULLET}
@item
æŠ½å–æ•°æ®çš„ä½æˆ–è€…å—ç”¨äºå¤„ç†

@item
æ’åºæ•°æ®

@item
å®ç°ç®€å•çš„ç½‘ç»œé€šè®¯

@item
æµ‹è¯„å¹¶è°ƒè¯• @command{awk} ç¨‹åº

@item
ç”¨ C/C++ ç¼–å†™å‡½æ•°ä»¥æ‰©å±•è¯­è¨€åŠŸèƒ½

@end itemize

æœ¬@value{DOCUMENT}ä¼šå‘ä½ ä»¬ä¼ æˆ @command{awk} è¯­è¨€ï¼Œå¹¶å‘Šè¯‰ä½ ä»¬å¦‚ä½•æ¥æœ‰æ•ˆåœ°ä½¿ç”¨å®ƒã€‚
ä½ æœ‰å¯èƒ½å·²ç»ç†Ÿæ‚‰åŸºæœ¬çš„ç³»ç»Ÿå‘½ä»¤ï¼Œå¦‚ @command{cat}ã€@command{ls}@footnote{è¿™äº›å·¥å…·åœ¨ Posix å…¼å®¹çš„ç³»ç»Ÿä¸Šéƒ½æœ‰ï¼Œåœ¨ä¼ ç»Ÿçš„åŸºäº Unix çš„ç³»ç»Ÿä¸Šä¹Ÿå­˜åœ¨ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ä¸€äº›å…¶ä»–çš„ç³»ç»Ÿï¼Œä½ ä¹Ÿéœ€è¦ç†Ÿæ‚‰ä¸€äº› IO é‡å®šå‘åŠç®¡é“çš„æ¦‚å¿µã€‚} ç­‰ï¼Œä¹Ÿç†Ÿæ‚‰ä¸€äº›åŸºæœ¬çš„ shell å·¥å…·ï¼Œå¦‚è¾“å…¥è¾“å‡ºé‡å®šå‘ä»¥åŠç®¡é“ã€‚

@cindex GNU @command{awk}, See @command{gawk}

@command{awk} è¯­è¨€çš„å®ç°å¯ä»¥åœ¨è®¸å¤šä¸åŒçš„è®¡ç®—æœºç¯å¢ƒä¸­è·å–ã€‚
æœ¬@value{DOCUMENT}é™¤äº†æè¿° @command{awk} è¯­è¨€çš„æ€»ä½“ï¼Œä¹Ÿä¼šæè¿°@command{awk} çš„ç‰¹æ®Šå®ç°ï¼Œå³ @command{gawk}ï¼ˆè¡¨ç¤º GNU @command{awk}ï¼‰ã€‚
@command{gawk} åœ¨å¾ˆå¤š Unix ç³»ç»Ÿä¸‹è¿è¡Œï¼ŒåŒ…æ‹¬ä» Intel æ¶æ„çš„ PC æœºï¼Œåˆ°å¤§å‹æœºç³»ç»Ÿã€‚
@command{gawk} ä¹Ÿè¢«ç§»æ¤åˆ°äº† Mac OS å¹³å°ï¼ŒWindows å¹³å°
@ifset FOR_PRINT
ï¼ˆæ‰€æœ‰ç‰ˆæœ¬ï¼‰
@end ifset
@ifclear FOR_PRINT
ï¼ˆæ‰€æœ‰ç‰ˆæœ¬ï¼‰ ä»¥åŠ OS/2 çš„ PC æœºï¼Œ
@end ifclear
è¿˜æœ‰ OpenVMS@footnote{ä¸€äº›å·²ç»ä¸ç”¨çš„ç³»ç»Ÿï¼Œåœ¨è¿™äº›ç³»ç»Ÿä¸Š @command{gawk} æœ‰è¿‡ç§»æ¤ï¼Œä½†æ˜¯å·²ç»ä¸å†æ”¯æŒï¼Œå¹¶ä¸”ä¸ºæ”¯æŒè¿™äº›ç³»ç»Ÿè€Œå­˜åœ¨çš„ä»£ç ä¹Ÿå·²ç»ç§»é™¤} ç³»ç»Ÿä¸Šã€‚â€ƒ

@node Translator Preface
@unnumbered è¯‘åº

è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡ç¿»è¯‘è¿™ä¹ˆé•¿çš„ä¹¦ã€‚

å½“æˆ‘çœ‹åˆ° GAWK ç®€å•çš„è¯­è¨€ä¸å¼ºå¤§çš„åŠŸèƒ½æ—¶ï¼Œæˆ‘äºæ˜¯æƒ³åˆ°ç½‘ä¸ŠæŸ¥æ‰¾ä¸€äº›ä¸­æ–‡çš„èµ„æ–™ï¼Œä»¥å¿«é€Ÿå­¦ä¹ ä¸€ä¸‹è¿™ä¸ªå·¥å…·ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æˆ‘åœ¨å¤„ç† Linux å­—ä¸²æ—¶èƒ½å¤Ÿä½¿ç”¨åˆ°å®ƒã€‚

ä½†æ˜¯æˆ‘å¾ˆå¤±æœ›ï¼Œæ‰¾äº†å¾ˆä¹…ï¼Œèƒ½å¤Ÿæ‰¾åˆ°çš„èµ„æ–™åŸºæœ¬ä¸Šæ˜¯æ”¯ç¦»ç ´ç¢çš„ï¼Œå¹¶æ²¡æœ‰å®Œæ•´å…¨é¢çš„ä¸­æ–‡æ‰‹å†Œã€‚æˆ‘äºæ˜¯æ±‚å…¶æ¬¡åœ°æ‰¾äº†ä¸€ä¸ªè‹±æ–‡æ–‡æ¡£ï¼Œå…¶åŸåä¸ºã€ŠGAWK: Effective AWK Programmingã€‹ï¼Œç”± Arnold D. Robbinsï¼Œå³ @command{gawk} å½“å‰çš„ä¸»è¦ç»´æŠ¤è€…ä¹‹ä¸€ç¼–å†™ã€‚åˆçœ‹ä¹‹ä¸‹ï¼Œé‡Œé¢çš„å†…å®¹æµ…æ˜¾æ˜“æ‡‚ï¼Œæ­£å¥½ç¬¦åˆæˆ‘è‡ªå·±çš„éœ€æ±‚ã€‚å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæˆ‘èŒå‘äº†å°†è¿™ä¸ªæ‰‹å†Œç¿»è¯‘ä¸ºä¸­æ–‡çš„æƒ³æ³•ã€‚ä½†æ˜¯æˆ‘æ‹¿ä¸å‡†æˆ‘æ˜¯å¦æœ‰è¿™æ ·çš„åšæŒï¼Œèƒ½å¤Ÿå°†è¿™ä¸ªæ‰‹å†Œå…¨éƒ¨ç¿»è¯‘å‡ºæ¥ã€‚

æˆ‘é•¿ä¹…éƒ½æ²¡æœ‰åŠ¨æ‰‹ï¼Œä¸»è¦æ˜¯å› ä¸ºæ²¡æœ‰è¿™ä¸ªé­„åŠ›ä¸‹å®šå†³å¿ƒæ¥åšè¿™ä»¶äº‹æƒ…ï¼Œå†ä¸€ä¸ªå¯¹äºè‡ªå·±çš„è¯­è¨€èƒ½åŠ›ä¹Ÿä¸å¤ªè‡ªä¿¡ã€‚ä¸€å¹´åï¼Œè¿™ä¸ªæƒ³æ³•ä¸€ç›´åœ¨å¤§è„‘é‡ŒæŒ¥ä¹‹ä¸å»ã€‚äºæ˜¯å¿ƒé‡Œç›˜ç®—ï¼Œè‹±æ–‡æ–‡æ¡£å¤§æ¦‚æœ‰ 500 å¤šé¡µï¼Œå¦‚æœæˆ‘æ¯å¤©ç¿»è¯‘ä¸¤é¡µï¼Œåˆ™ä¸€å¹´åï¼Œæ€ä¹ˆç€ä¹Ÿèƒ½å¤ŸæŠŠè¿™ä¸ªæ–‡æ¡£ç¿»è¯‘å‡ºæ¥ã€‚å¹¶ä¸”ï¼Œå¦‚æœèƒ½å¤Ÿç¿»è¯‘åˆ°å››é¡µï¼Œåˆ™æ‰€éœ€è¦çš„æ—¶é—´ç«‹å³å‡å°‘ä¸€åŠã€‚ç¿»è¯‘ä¸€æœ¬è‹±æ–‡ä¹¦ï¼Œé™¤å»èƒ½åŠ›å¤–ï¼Œè¿˜å¾—çœ‹è‡ªå·±æ˜¯ä¸æ˜¯èƒ½å¤Ÿæ”¾å¼ƒç¿»è¯‘æ—¶çš„åŠŸåˆ©æƒ³æ³•ï¼Œè§‰å¾—è¿™ä¹ˆåšæ˜¯å¦å€¼å¾—ã€‚å¹¶åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯å¦èƒ½å¤ŸåšæŒä¸€ä¸ªè¾ƒé•¿è€Œæ— å‘³çš„è¿‡ç¨‹ï¼Œæœ€åå°†æ–‡æ¡£ç¿»è¯‘å‡ºæ¥ã€‚æœ€åï¼Œæˆ‘è¿˜æ˜¯ä¸‹å®šå†³å¿ƒï¼Œè¯•ä¸€è¯•ã€‚

äºæ˜¯æˆ‘ç¬¬ä¸€æ­¥æ˜¯å°† PDF æ ¼å¼çš„è‹±æ–‡æ–‡æ¡£è½¬æ¢æˆ Word æ–‡æ¡£ï¼ˆæˆ‘ç”¨å…¶ä»–çš„å·¥å…·è½¬æ¢è¿‡ï¼Œä½†æ˜¯ç»“æœä¸æ˜¯å¾ˆå¥½ã€‚å› ä¸ºåŸæ¥çš„ PDF æ–‡æ¡£ä¸­æœ‰å¾ˆå¤šç‰¹åˆ«çš„æ ¼å¼ï¼Œåœ¨ Word ä¸­å¾ˆéš¾æ§åˆ¶ã€‚æ‰€ä»¥ä¸€ä¸åšï¼ŒäºŒä¸ä¼‘ï¼Œå¹²è„†æŠŠæ–‡å­—å¤åˆ¶å‡ºæ¥ï¼Œå†è°ƒæ•´å…¶æ ¼å¼ä¸åŸæ¥çš„ PDF ç›¸ç¬¦ã€‚æˆ‘ä¸çŸ¥é“è¿™ä¹ˆåšæ˜¯ä¸æ˜¯å¾ˆè ¢ï¼Œå¹¶æœ‰è¿ç¨‹åºå‘˜æ‡’çš„ç¾åï¼ï¼‰ã€‚å…‰è¿™ä¸ªäº‹æƒ…å°±è€—äº†æˆ‘è¿‘ä¸€ä¸ªæ˜ŸæœŸçš„æ—¶é—´ï¼Œ2016 å¹´æ˜¥èŠ‚å‰æŠŠè¿™ä¸ªåº•æœ¬åšå¥½äº†ï¼Œå¹¶ä¸”å¼€å§‹äº†ç¿»è¯‘ã€‚

å®åœ¨çš„ï¼Œå‰é¢çš„ç¿»è¯‘é€Ÿåº¦æ˜¯æœ‰ä¸€ç‚¹æ…¢ï¼Œä½†æ˜¯æ€»ä½“æ¥è¯´ï¼Œè¿˜æ˜¯æŒ‰ç…§åŸå…ˆçš„è®¾è®¡é€Ÿåº¦è¿›è¡Œçš„ã€‚å°±ç®—åœ¨è¿‡å¹´çš„å‡ å¤©é‡Œï¼Œå‡ ä¹æ¯å¤©éƒ½æœ‰è¿›å±•ã€‚è€Œä¸”ï¼Œç¿»è¯‘çš„éš¾åº¦ä¸æ˜¯å¾ˆå¤§ï¼Œæœ€è€ƒéªŒäººçš„æ˜¯æ¯å¤©è¦æ‹¿å‡ºä¸€å®šçš„æ—¶é—´æ¥åšè¿™ä¸ªäº‹æƒ…ã€‚å› ä¸ºä¸€æ—¦åœä¸‹æ¥ï¼Œå°±ä¼šä¸ºåœä¸‹æ¥æ‰¾ç†ç”±ã€‚åé¢å°±ä¼šæœ‰è¶Šæ¥è¶Šå¤šçš„ç†ç”±æ¥ä¸ºå»¶è¿Ÿå¼€è„±ã€‚æ‰€ä»¥ï¼Œè‡ªä»ç¿»è¯‘å¼€å§‹ï¼Œæˆ‘å‡ ä¹æ²¡æœ‰ä¸­æ–­æ¯å¤©åšä¸€ç‚¹ç¿»è¯‘ã€‚åœ¨ç¿»è¯‘æœ€åçš„å‡ ä¸ªé™„å½•ä¸­ï¼Œæˆ‘è¿˜å·®ç‚¹è¦æ”¾å¼ƒç¿»è¯‘ä¸‹å»ï¼Œå› ä¸ºè§‰å¾—é‚£äº›ä¸œè¥¿ç¿»è¯‘æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚ä½†æ˜¯ä¸ºäº†ä¿è¯ç¿»è¯‘çš„å®Œæ•´æ€§ï¼ŒåŒæ—¶ä¹Ÿä¸ºæŠŠè¿™ä¸ªäº‹æƒ…åšâ€œåœ†æ»¡â€ï¼Œæˆ‘è¿˜æ˜¯åšæŒæŠŠè¿™ä¸ªäº‹æƒ…åšä¸‹æ¥äº†ã€‚æœ€ååªå‰©ä¸‹ GPL ä¸ FDL æ²¡æœ‰ç¿»è¯‘ã€‚è¿™ä¸¤ä¸ªåè®®æ¯”è¾ƒå…¶ä»–çš„éƒ¨åˆ†æœ‰éš¾åº¦ä¸€äº›ã€‚å…³é”®åœ¨äºè¦ç¿»è¯‘å‡ºå¸¦ç‚¹åè®®æ€§è´¨ï¼Œè¯­è¨€ç²¾å‡†è€Œä¸”ä¸¥è°¨ï¼Œç¡®å®å¯¹æˆ‘è€Œè¨€ï¼Œèƒ½åŠ›è¿˜æ˜¯ä¸å¤Ÿçš„ã€‚è€Œä¸”è¿™ä¸¤ä¸ªåè®®ï¼Œæˆ‘æƒ³åœ¨äº’è”ç½‘ä¸Šåº”è¯¥å·²ç»æœ‰äº†ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸å†ç¿»è¯‘äº†ã€‚

ç¿»è¯‘åˆ°åé¢çš„æ—¶å€™ï¼Œè‡ªå·±ç¡®å®æ„Ÿè§‰æ¯”åŸæ¥å¿«äº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºç†Ÿç»ƒäº†çš„åŸå› ã€‚å‰©ä¸‹çš„æ•´ç†ä¹ŸèŠ±æ‰äº†æˆ‘çš„ä¸€äº›æ—¶é—´ã€‚é€šè¿‡ç¿»è¯‘è¿™ä¸ªäº‹æƒ…ï¼Œç¡®å®ä½¿è‡ªå·±æœ‰å¦‚ä¸‹æ”¶è·ï¼š

@enumerate
@item
è‡³å°‘å¯¹ Word æ–‡æ¡£çš„æ“ä½œæœ‰ä¸€ç‚¹ç‚¹æå‡ã€‚

@item
è€ƒéªŒå¹¶æå‡äº†ä¸€ä¸‹è‡ªå·±çš„èƒ½åŠ›ã€‚

@item
å†é‡åˆ°é•¿çš„è‹±æ–‡æ–‡æ¡£ï¼Œå¯èƒ½å°±æ²¡é‚£ä¹ˆæ€µäº†ã€‚

@item
ç¿»è¯‘èƒ½åŠ›æ˜¯å¦æœ‰å¤§çš„æé«˜ï¼Œè¿™ä¸ªä¸å¥½è¯´ï¼Œä½†æ˜¯åº”è¯¥æœ‰ä¸€ç‚¹å§ã€‚

@end enumerate

è¿™é‡Œçš„æ–‡å­—ï¼Œå‡ ä¹éƒ½æ˜¯ä¸€ä¸ªå­—ä¸€ä¸ªå­—ç èµ·æ¥ï¼Œè€Œä¸”ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡ç¿»è¯‘ï¼Œé‡Œé¢è‚¯å®šè¿˜æ˜¯æœ‰å¾ˆå¤šé”™è¯¯çš„åœ°æ–¹ï¼Œä¹Ÿæœ‰ä¸€äº›è¯ä¸è¾¾æ„çš„åœ°æ–¹ï¼Œå¯¹äºæ±‰è¯­çš„æŒæ¡æœ‰æ¬ ç«å€™ï¼Œä¹Ÿä¼šä½¿å¾—ç¿»è¯‘å‡ºæ¥çš„è¡Œæ–‡æ²¡æœ‰é‚£ä¹ˆç¬¦åˆä¸­æ–‡ä¹ æƒ¯ï¼Œæˆ–è€…ä¸å¤Ÿä¼˜ç¾ã€‚è¿™äº›çœŸè¿˜å¾—è¦å„ä½æµ·æ¶µï¼Œå¦‚æœå¤§å®¶è§‰å¾—è¿™ä¸ªç¿»è¯‘å¯¹å¤§å®¶æœ‰ä¸€ç‚¹ä½œç”¨ï¼Œæˆ‘å°±è§‰å¾—è¿™äº›ä»˜å‡ºä¹Ÿå€¼å¾—äº†ã€‚å¦‚æœè¯»è€…æ›´æ…·æ…¨ä¸€ç‚¹ï¼Œèƒ½å¤Ÿå‘Šè¯‰æˆ‘å“ªé‡Œæœ‰é—®é¢˜ï¼Œæˆ–è€…æœ‰ä¸€äº›æ”¹è¿›çš„å»ºè®®é‚£å°±æ›´å¥½äº†ã€‚å¦‚æœæœ‰è¿™æ–¹é¢çš„æ”¹è¿›ï¼Œè¯·å‘é‚®ä»¶åˆ° yeyouqun@@163.comã€‚

æˆ‘å¸Œæœ›æˆ‘çš„ä¸€ç‚¹å°åŠªåŠ›ï¼Œä¹Ÿä¸ºä¸­å›½çš„è½¯ä»¶äº‹ä¸šåšäº†ä¸€ç‚¹ç‚¹è´¡çŒ®ã€‚

åœ¨æœ€åï¼Œå¦‚æœè¦æœ‰ä»€ä¹ˆæ„Ÿè°¢çš„ï¼Œé¦–å…ˆå¾—è¦æ„Ÿè°¢è‡ªç”±è½¯ä»¶è¿åŠ¨çš„å‘èµ·è€…ä»¬ã€‚å¦‚æœæ²¡æœ‰ä»–ä»¬ï¼Œå°±ä¸ä¼šæœ‰è‡ªç”±è½¯ä»¶ç¤¾åŒºï¼Œä¹Ÿå°±ä¸ä¼šæœ‰ GNU/Linuxï¼Œä¹Ÿå°±æ²¡æœ‰ GAWK è¿™äº›ä¼˜ç§€çš„å·¥å…·ã€‚å…¶æ¬¡è¿˜è¦æ„Ÿè°¢åŸæ–‡çš„ä½œè€…ã€‚åˆ«äººä¹Ÿæ˜¯è‡ªç”±è½¯ä»¶çš„æ‹¥è¶¸ï¼Œå¦‚æœæ²¡æœ‰ä»–ä»¬çš„å…ˆæœŸä»˜å‡ºï¼Œä¹Ÿå°±æ²¡æœ‰è¿™ä¸ªæ–‡æ¡£çš„å­˜åœ¨ã€‚ç›®å‰è¿˜åªæœ‰æˆ‘ä¸€ä¸ªäººåœ¨ç¿»è¯‘è¿™ä¸ªæ–‡æ¡£ï¼Œå¦‚æœå¯ä»¥ï¼Œæˆ‘æƒ³å°æ¿€åŠ¨åœ°æ„Ÿè°¢ä¸€ä¸‹è‡ªå·±ã€‚æˆ‘å¸Œæœ›ä»¥åæ„Ÿè°¢åˆ—è¡¨èƒ½å¤Ÿå˜å¾—æ›´é•¿ã€‚å¸Œæœ›æ›´å¤šçš„äººå‚ä¸åˆ°å®Œå–„å®ƒçš„è¿‡ç¨‹é‡Œæ¥ã€‚

å¯¹äº†ï¼Œæˆ‘æƒ³æ„Ÿè°¢ä¸€ä¸‹æˆ‘å„¿å­ã€‚å¥½å¤šæ¬¡æˆ‘æ‰“å¼€ç”µè„‘å¼€å¯ä¸€å¤©çš„ç¿»è¯‘å·¥ä½œçš„æ—¶å€™ï¼Œä»–ç»å¸¸ä¼šåœ¨é”®ç›˜ä¸Šéšæ„æ•²å‡»ï¼Œä½¿å¾—æˆ‘è¿˜å¾—èŠ±æ‰ä¸€äº›æ—¶é—´æ¥æ’¤é”€ä»–æ‰€åšçš„â€œå·¥ä½œâ€ã€‚è€Œä¸”è¿˜è¦åš·ç€è¦å¬ ã€ŠABCD æ­Œã€‹ä»€ä¹ˆçš„ï¼Œè¿˜å¾—é™ªä»–å¬ä»–æ‰€è¯´çš„ä¸€ä¸‡åˆ†é’Ÿé‚£ä¹ˆä¹…ã€‚

ä¸è‡ªé‡åŠ›çš„å¶ä½‘ç¾¤

2016 å¹´ 4 æœˆ 

@menu
* History::                     @command{gawk} ä¸ @command{awk} çš„å†å²
* Names::                       @command{awk} çš„åˆ«å
* This Manual::                 ä½¿ç”¨æœ¬@value{DOCUMENT}ï¼›åŒ…æ‹¬ä½ å¯ä»¥ä½¿ç”¨çš„è¾“å…¥æ–‡ä»¶æ ·ä¾‹
* Conventions::                 æ’ç‰ˆçº¦å®š
* Manual History::              GNU é¡¹ç›®åŠæœ¬@value{DOCUMENT}
* How To Contribute::           å¦‚ä½•è´¡çŒ®
* Acknowledgments::             è‡´è°¢
@end menu

@node History
@unnumberedsec @command{awk} ä¸ @command{gawk} çš„å†å²
@cindex recipe for a programming language
@cindex programming language, recipe for
@sidebar ç¼–ç¨‹è¯­è¨€èœå•

@multitable {2 parts} {1 part  @code{egrep}} {1 part  @code{snobol}}
@item @tab 1 ä»½ @code{egrep} @tab 1 ä»½ @code{snobol}@footnote{SNOBOLè¯­è¨€ï¼Œä¸€ç§é¢å‘å­—ç¬¦ä¸²ç¬¦å·ï¼ˆStriNg Oriented symBOlic Languageï¼‰è¯­è¨€ã€‚â€”â€”è¯‘è€…}
@item @tab 2 ä»½ @code{ed} @tab 3 ä»½ C
@end multitable

å°†æ‰€æœ‰éƒ¨åˆ†é€šè¿‡ @code{lex} ä¸ @code{yacc} æ··åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”è¾…ä»¥å°‘é‡æ–‡æ¡£ï¼Œå¹¶å‘å¸ƒã€‚

8 å¹´åï¼Œæ·»åŠ å¤šä¸€ä»½ @code{egrep}ï¼Œä»¥åŠä¸¤ä»½çš„ Cã€‚æ–‡æ¡£å®Œå¤‡ç„¶åå‘å¸ƒã€‚
@end sidebar

@cindex Aho, Alfred
@cindex Weinberger, Peter
@cindex Kernighan, Brian
@cindex @command{awk}, history of

@command{awk} çš„åå­—æ¥æºäºæœ€åˆçš„è®¾è®¡è€…ï¼šAlfred V.@:
Aho, Peter J.@: Weinberger å’Œ Brian W.@: Kernighanã€‚
å®ƒçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å†™äº 1977 å¹´çš„ AT&T è´å°”å®éªŒå®¤ã€‚
1985 å¹´ï¼Œæ–°ç‰ˆæœ¬è¯­è¨€é€šè¿‡å¼•å…¥ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ã€å¤šè¾“å…¥æµã€æ­£åˆ™è¡¨è¾¾å¼ï¼Œè€Œä½¿å¾—å…¶åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚
æ–°ç‰ˆæœ¬çš„ @command{gawk} åœ¨ Unix System V Release 3.1ï¼ˆ1987 å¹´ï¼‰çš„æ—¶å€™å·²ç»å¹¿æ³›å¯ç”¨ã€‚
è€Œåœ¨ System V Release 4ï¼ˆ1989 å¹´ï¼‰ä¸­çš„ç‰ˆæœ¬æ·»åŠ äº†ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œå¹¶æ¸…ç†æ‰äº†ä¸€äº›è¯­è¨€çš„â€œæš—è§’â€è¡Œä¸ºã€‚
åœ¨ POSIX å‘½ä»¤è¯­è¨€ä»¥åŠå·¥å…·æ ‡å‡†ä¸­ï¼Œå¯¹ @command{awk}è§„èŒƒè¿›è¡Œè¿›ä¸€æ­¥çš„æ¾„æ¸…ã€‚
@command{gawk} çš„è®¾è®¡è€…ä¸æœ€åˆçš„ @command{awk} è®¾è®¡è€…å¯¹äº POSIX è§„èŒƒéƒ½æœ‰ç›¸åº”çš„åé¦ˆã€‚

@cindex Rubin, Paul
@cindex Fenlason, Jay
@cindex Trueman, David
Paul Rubin åœ¨ 1986 å¹´ç¼–å†™äº† @command{gawk}ï¼ŒJay Fenlason æ ¹æ® Richard Stallman çš„å»ºè®®å®Œå–„äº†å®ƒã€‚
John Woods ä¹Ÿè´¡çŒ®äº†éƒ¨åˆ†ä»£ç ã€‚åœ¨ 1988 å¹´å’Œ 1989 å¹´ï¼ŒDavid Trueman åœ¨æˆ‘çš„å¸®åŠ©ä¸‹å®Œå…¨é‡æ„äº† @command{gawk}ï¼Œä»¥è§£å†³ä¸æ›´æ–°çš„ @command{awk} å…¼å®¹çš„é—®é¢˜ã€‚
å¤§æ¦‚æ˜¯ 1994 å¹´ï¼Œæˆ‘æˆä¸ºäº†ä¸»è¦çš„ç»´æŠ¤è€…ã€‚ç°åœ¨çš„ç‰ˆæœ¬ä¸»è¦ç€çœ¼äº Bug ä¿®å¤ã€æ€§èƒ½æå‡ï¼Œæ ‡å‡†åŒ–ï¼Œæœ‰æ—¶ä¹Ÿæ·»åŠ ä¸€äº›æ–°çš„ç‰¹æ€§ã€‚

1997 å¹´ 5 æœˆï¼ŒJ@"urgen Kahrs è§‰å¾—æœ‰å¿…è¦ç”¨ @command{awk} è®¿é—®ç½‘ç»œï¼Œåœ¨æˆ‘çš„ä¸€äº›å¸®åŠ©ä¸‹ï¼Œ@command{gawk} æ·»åŠ è¿›äº†è¿™æ ·çš„ç‰¹æ€§ã€‚
å½“æ—¶ï¼Œä»–ä¹Ÿå†™äº† @cite{@value{GAWKINETTITLE}}
ï¼ˆä¸€ä¸ªå•ç‹¬å¯è·å–çš„æ–‡æ¡£ï¼Œæ˜¯ gawk å‘è¡Œç‰ˆæœ¬çš„ä¸€éƒ¨åˆ†ï¼‰çš„ä¸»ä½“å†…å®¹ã€‚
ä»–çš„ä»£ç æœ€ç»ˆåœ¨ @command{gawk} 3.1 @value{PVERSION} çš„æ—¶å€™æˆä¸ºä¸»æµ @command{gawk} å‘å¸ƒç‰ˆæœ¬çš„ä¸€éƒ¨åˆ†ã€‚

John Haque é‡å†™äº† @command{gawk} çš„å†…éƒ¨å®ç°ï¼Œä»¥æä¾› @command{awk} çº§çš„è°ƒè¯•å™¨ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨ 2011 å¹´çš„ @command{gawk} 4.0 @value{PVERSION} å¯ç”¨ã€‚

æŸ¥çœ‹ @ref{Contributors}ã€‚

@node Names
@unnumberedsec ç«ç‘°åˆ«å

@cindex @command{awk}, new vs.@: old

@command{awk} è¯­è¨€å·²ç»è¿›åŒ–äº†å¤šå¹´ï¼Œåœ¨ @ref{Language History}ï¼Œæœ‰å®Œå…¨çš„åˆ—è¡¨ã€‚
åœ¨æœ¬@value{DOCUMENT}ä¸­æ‰€æ¶‰åŠçš„æˆ‘ä»¬å¯ä»¥ç§°ä¸ºâ€œnew @command{awk}â€ã€‚
ç±»ä¼¼çš„ï¼Œ@command{awk} çš„åŸå§‹ç‰ˆæœ¬ç§°ä¸ºâ€œold @command{awk}â€ã€‚

åœ¨ç°åœ¨å¤šæ•°çš„ç³»ç»Ÿä¸­ï¼Œä½ è¿è¡Œ @command{awk} å·¥å…·ä½ éƒ½æœ‰ä¸€äº›ç‰ˆæœ¬çš„æ–° @command{awk}@footnote{åªæœ‰åœ¨ Solaris çš„ç³»ç»Ÿä¸­ä¾ç„¶ä½¿ç”¨æ—§ @command{awk} ä½œä¸ºé»˜è®¤çš„ @command{awk} å·¥å…·ã€‚æ›´ä¸ºç°ä»£çš„ @command{awk} åˆ™ä½äºè¿™äº›ç³»ç»Ÿä¸­çš„ @file{/usr/xpg6/bin} ç›®å½•ä¸‹ã€‚}ã€‚
å¦‚æœä½ çš„ç³»ç»Ÿä¸­çš„æ ‡å‡† @command{awk} æ˜¯æ—§çš„ç‰ˆæœ¬ï¼Œä½ ç”¨ä¸‹é¢çš„ä»£ç æµ‹è¯•ï¼Œå°±å¯ä»¥å¾—åˆ°è¿™æ ·çš„ç»“æœï¼š

@example
$ @kbd{awk 1 /dev/null}
@error{} awk: syntax error near line 1
@error{} awk: bailing out near line 1
@end example

@noindent
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ åº”è¯¥èƒ½æŸ¥æ‰¾åˆ°ä¸€æ–°ç‰ˆæœ¬çš„ @command{awk}ï¼Œæˆ–è€…ç›´æ¥å®‰è£… @command{gawk} å³å¯ã€‚
åœ¨æœ¬@value{DOCUMENT}ä¸­ï¼Œå¦‚æœæ‰€æ¶‰åŠçš„æ‰€æœ‰è¯­è¨€ç‰¹æ€§ï¼Œéƒ½åœ¨ä¸€ä¸ªå®Œæ•´å®ç°äº† POSIX æ ‡å‡†çš„ @command{awk} ä¸­æ‰¾åˆ°ï¼Œæˆ‘ä»¬ä¸ºäº†ç®€åŒ–ï¼Œå°±ä½¿ç”¨ @command{awk} æ¥æŒ‡ä»£ã€‚å½“æåˆ°çš„ç‰¹æ€§ç‰¹å®šäº GNU ç‰ˆæœ¬ï¼Œæˆ‘ä»¬åˆ™ä½¿ç”¨ @command{gawk} æŒ‡ä»£ã€‚

@node This Manual
@unnumberedsec ä½¿ç”¨æœ¬ä¹¦
@cindex @command{awk}, terms describing

@command{awk} è¿™ä¸ªè¯ï¼Œå³æŒ‡ä»£ç‰¹å®šçš„ç¨‹åºï¼Œä¹Ÿè¡¨ç¤ºä½ è¦ç”¨äºå‘Šè¯‰è¿™ä¸ªç¨‹åºæ‰€åšäº‹æƒ…çš„è¯­è¨€ã€‚
å½“éœ€è¦ç‰¹åˆ«å°å¿ƒæ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œ@command{awk} è¯­è¨€â€ï¼Œä»¥åŠâ€œ@command{awk} å·¥å…·â€ã€‚
æœ¬@value{DOCUMENT}æ—¢è¯´æ˜å¦‚ä½•ç”¨ @command{awk} è¯­è¨€ç¼–å†™ç¨‹åºï¼Œä¹Ÿè¯´æ˜å¦‚ä½•æ¥è¿è¡Œ @command{awk} å·¥å…·ã€‚
â€œ@command{awk} ç¨‹åºâ€æœ¯è¯­åˆ™æŒ‡ç”¨ @command{awk} è¯­è¨€ç¼–å†™çš„ç¨‹åºã€‚

@cindex @command{gawk}, @command{awk} and
@cindex @command{awk}, @command{gawk} and
@cindex POSIX @command{awk}

æœ¬ä¹¦ä¸»è¦æ¶‰åŠ POSIX æ ‡å‡†æ‰€å®šä¹‰çš„ @command{awk} ç‰¹æ€§ã€‚ä¹ŸåŒ…æ‹¬åœ¨ @command{gawk} ä¸­å®ç°äº†çš„é‚£äº›ç‰¹æ€§ã€‚è¿™ä¹ˆå¤„ç†ï¼Œåœ¨äºè¯•å›¾æè¿° @command{gawk} ä¸å…¶ä»– @command{awk} 
@ifclear FOR_PRINT
å®ç°ç‰ˆæœ¬@footnote{æ‰€æœ‰è¿™äº›å·®å¼‚éƒ½å½’é›†åœ¨â€œawk ä¸ gawk ä¹‹é—´çš„å·®å¼‚â€ä¸‹ã€‚}
ä¹‹é—´çš„å·®å¼‚ã€‚
@end ifclear
@ifset FOR_PRINT
å®ç°ç‰ˆæœ¬ã€‚
@end ifset
æœ€åï¼Œä¼šæåŠé‚£äº›åœ¨ @command{gawk} ä¸­å®ç°äº†ï¼Œä½†ä¸åœ¨ @command{awk} POSIX æ ‡å‡†ä¸­å®šä¹‰çš„ç‰¹æ€§ã€‚

@ifnotinfo
æœ¬@value{DOCUMENT}æ—¢å¯ä»¥ä½œä¸ºæ•™ç¨‹ï¼Œåˆå¯ä»¥ä½œä¸ºå‚è€ƒã€‚å¦‚æœä½ æ˜¯ä¸ªæ–°æ‰‹ï¼Œä½ å¯ä»¥è·³è¿‡é‚£äº›å¤æ‚çš„éƒ¨åˆ†ã€‚ä½ ä¹Ÿå¯ä»¥å¿½ç•¥é‚£äº›äº¤å‰å‚è€ƒï¼›ä»–ä»¬ä¸»è¦ç”¨äºä¸“å®¶çº§ç”¨æˆ·ï¼ŒåŒæ—¶ä½œä¸ºä¿¡æ¯å‚è€ƒä»¥åŠç”¨äºæœ¬@value{DOCUMENT}çš„ 
@uref{http://www.gnu.org/software/gawk/manual/, HTML}
ç‰ˆæœ¬ã€‚
@end ifnotinfo

åœ¨å…¨@value{DOCUMENT}ä¸­è¿˜åˆ†å¸ƒæœ‰ä¸€äº›è¾¹ä¾§æ ã€‚
å®ƒä»¬ä¸»è¦å¯¹ç›¸å…³çš„ç‚¹è¿›è¡Œæ›´å®Œæ•´å…¨é¢çš„è§£é‡Šï¼Œä½†æ˜¯ç¬¬ä¸€æ¬¡è¯»æœ¬@value{DOCUMENT}æ—¶å¯èƒ½ä¸å¤ªæœ‰å…´è¶£æ¶‰çŒã€‚
@ifclear FOR_PRINT
æ‰€æœ‰åœ¨è¾¹ä¾§æ çš„å†…å®¹ä¼šåœ¨ç´¢å¼•ä¸­å‡ºç°ã€‚
@end ifclear

åœ¨å¤šæ•°æ®æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ä¾‹å­éƒ½æ˜¯å®Œæ•´çš„ @command{awk} ç¨‹åºã€‚
ä¸€äº›è¿›é˜¶éƒ¨åˆ†çš„@value{SECTION}ï¼Œä»…æ˜¾ç¤º @command{awk} ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œä»¥æ­¤æ¥è¯´æ˜æ­£åœ¨è¿›è¡Œæè¿°çš„æ¦‚å¿µã€‚

æœ¬@value{DOCUMENT}ä¸»è¦ç›®æ ‡äººç¾¤ä¸»è¦é›†ä¸­åœ¨é‚£äº›è¿˜æ²¡æ¥è§¦è¿‡ @command{awk} çš„äººï¼Œä¹¦ä¸­ç›¸å½“å¤šçš„ä¿¡æ¯å¯¹äºä¸“å®¶ä¹Ÿéå¸¸æœ‰ç”¨ã€‚
å¯¹äº @command{awk} POSIX æ ‡å‡†çš„éƒ¨åˆ†æ›´æ˜¯å¦‚æ­¤ã€‚
åŒ…æ‹¬åœ¨ @ref{Library Functions} å’Œ
@ifnotdocbook
åœ¨
@end ifnotdocbook
@ref{Sample Programs} çš„æ ·ä¾‹ç¨‹åºã€‚è¿™äº›æ ·ä¾‹ç¨‹åºåº”è¯¥ä¼šç›¸å½“æœ‰è¶£ã€‚

æœ¬@value{DOCUMENT}åˆ†ä¸ºå¦‚ä¸‹è¿™äº›éƒ¨åˆ†ï¼š

@c FULLXREF ON

@itemize @value{BULLET}
@item
ç¬¬ä¸€éƒ¨åˆ†å¯¹ @command{awk} è¯­è¨€ä»¥åŠ @command{gawk} ç¨‹åºè¿›è¡Œè¯¦ç»†æè¿°ã€‚é€šè¿‡ä»æœ€åŸºç¡€çš„å¼€å§‹ï¼Œä¸æ–­è¯¦è§£ @command{awk} çš„æ‰€æœ‰ç‰¹æ€§ã€‚
å®ƒä»¬åŒ…å«å¦‚ä¸‹ç« èŠ‚ï¼š

@c nested
@itemize @value{MINUS}
@item
@ref{Getting Started},
åŒ…æ‹¬ä¸€äº›ä½¿ç”¨ @command{awk} çš„åŸºæœ¬å†…å®¹ã€‚

@item
@ref{Invoking Gawk},
æè¿°å¦‚ä½•è¿è¡Œ @command{gawk}ã€å‘½ä»¤è¡Œå‚æ•°çš„æ„ä¹‰ï¼Œä»¥åŠå®ƒå¦‚ä½•æ¥æŸ¥æ‰¾ @command{awk} ç¨‹åºæºä»£ç ã€‚

@item
@ref{Regexp},
æ€»ä½“ä»‹ç»æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°¤å…¶æ˜¯é‚£äº› POSIX @command{awk} ä»¥åŠ @command{gawk} æ‰€æ”¯æŒçš„å†…å®¹ã€‚

@item
@ref{Reading Files},
æè¿° @command{awk} å¦‚ä½•æ¥è¯»å–æ•°æ®ã€‚æœ¬ç« ä¸­ä»‹ç»è®°å½•ï¼ˆRecordsï¼‰ä¸åŸŸï¼ˆFieldsï¼‰çš„æ¦‚å¿µï¼Œä¹ŸåŒ…æ‹¬ @code{getline} å‘½ä»¤ã€‚I/O é‡å®šå‘æ˜¯é¦–å…ˆè¦æè¿°çš„éƒ¨åˆ†ï¼Œè€Œç½‘ç»œ I/O åˆ™ç®€å•æ¶‰åŠã€‚

@item
@ref{Printing},
ä»‹ç»åœ¨ @command{awk} ç¨‹åºä¸­å¦‚ä½•ä½¿ç”¨ @code{print} ä¸ @code{printf} äº§ç”Ÿè¾“å‡ºã€‚

@item
@ref{Expressions},
ä»‹ç»è¡¨è¾¾å¼ï¼Œè¿™äº›è¡¨è¾¾å¼æ˜¯æ„å»ºç¨‹åºä»£ç å—ï¼Œå¹¶å®Œæˆç›®æ ‡çš„åŸºç¡€ã€‚

@item
@ref{Patterns and Actions},
æè¿°å¦‚ä½•ä¸ºåŒ¹é…è®°å½•ç¼–å†™æ¨¡å¼ï¼Œå³å½“æŸä¸ªè®°å½•åŒ¹é…æ—¶æ‰€æ‰§è¡Œçš„åŠ¨ä½œã€‚åŒæ—¶è¿˜åŒ…æ‹¬ @command{awk} ä¸ @command{gawk} æ‰€ä½¿ç”¨çš„é¢„å®šä¹‰å˜é‡ã€‚

@item
@ref{Arrays},
åŒ…æ‹¬ @command{awk} ä¸­çš„å”¯ä¸€çš„æ•°ç»„ç»“æ„ï¼Œå…³è”æ•°ç»„ã€‚åˆ é™¤æ•°ç»„å…ƒç´ ä»¥åŠæ•´ä¸ªæ•°ç»„ï¼ŒåŒæ—¶ä¹Ÿæ¶‰åŠ @command{gawk} ä¸­çš„æ•°ç»„çš„æ’åºã€‚
åœ¨æœ¬@value{CHAPTER}è¿˜åŒ…æ‹¬ @command{gawk} å¦‚ä½•æ¥æä¾›å¤šç»´æ•°ç»„çš„å®ç°æ–¹å¼ã€‚

@item
@ref{Functions},
æè¿° @command{awk} ä¸ @command{gawk} æ‰€æä¾›çš„å†…å»ºå‡½æ•°ï¼Œä»¥åŠç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€‚è®¨è®º @command{gawk} å¦‚ä½•æ¥é—´æ¥è°ƒç”¨å‡½æ•°ã€‚

@end itemize

@item
ç¬¬äºŒéƒ¨åˆ†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ @command{awk} ä¸ @command{gawk} æ¥è§£å†³å®é™…é—®é¢˜ã€‚
è¿™é‡Œæœ‰éå¸¸å¤šçš„ä»£ç ä¾›è¯»è€…é˜…è¯»ä¸å­¦ä¹ ã€‚è¿™ä¸ªéƒ¨åˆ†åŒ…æ‹¬å¦‚ä¸‹å„ç« ï¼š

@c nested
@itemize @value{MINUS}
@item
@ref{Library Functions}, å±•ç¤ºå¤§é‡çš„å¯ä»¥é€šè¿‡ @command{awk} ç¨‹åºæ¥è°ƒç”¨çš„å‡½æ•°ã€‚

@item
@ref{Sample Programs},
æœ‰è®¸å¤šçš„ @command{awk} ç¨‹åºã€‚

@end itemize

é€šè¿‡é˜…è¯»è¿™ä¸¤ç« ï¼Œå¯ä»¥è®©ä½ çœ‹åˆ° @command{awk} ç¨‹åºå¦‚ä½•æ¥è§£å†³çœŸæ­£çš„é—®é¢˜ã€‚

@item
ç¬¬ä¸‰éƒ¨åˆ†å…³æ³¨ç‰¹å®šäº @command{gawk} çš„ç‰¹æ€§ï¼Œå®ƒä»¬åŒ…æ‹¬å¦‚ä¸‹å„ç« ï¼š

@c nested
@itemize @value{MINUS}
@item
@ref{Advanced Features},
æè¿°å„ç§é«˜çº§ç‰¹æ€§ã€‚å…¶ä¸­åŒ…æ‹¬å¦‚æ¥æ§åˆ¶æ•°ç»„éå†çš„é¡ºåºã€ä¸å¦ä¸€ä¸ªè¿›ç¨‹ä¹‹é—´çš„åŒå‘é€šä¿¡ã€æ‰§è¡Œ TCP/IP é€šä¿¡ã€æµ‹è¯„ä½ çš„ @command{awk} ç¨‹åºã€‚

@item
@ref{Internationalization},
æè¿°å¦‚ä½•å°†ç¨‹åºæ¶ˆæ¯åœ¨è¿è¡Œæ—¶ç¿»è¯‘æˆä¸åŒè¯­è¨€çš„ç‰¹æ€§ã€‚

@item
@ref{Debugger}, 
æè¿° @command{gawk} è°ƒè¯•å™¨ã€‚

@item
@ref{Arbitrary Precision Arithmetic},
æè¿°é«˜çº§çš„æ•°å­¦è®¡ç®—å·¥å…·ã€‚

@item
@ref{Dynamic Extensions}, 
æè¿°å¦‚ä½•é€šè¿‡ç¼–å†™ C ä¸ C++ æ‰©å±•ä¸º @command{gawk} æ·»åŠ æ–°å˜é‡ä¸å‡½æ•°ã€‚

@end itemize

@item
@ifclear FOR_PRINT
ç¬¬å››éƒ¨åˆ†åŒ…æ‹¬ä¸€äº›é™„å½•ï¼Œåè¯è§£é‡Šï¼Œä»¥åŠæœ¬@value{DOCUMENT}ä»£ç æ‰€ä½¿ç”¨çš„ä¸¤ä¸ªè®¸å¯ã€‚å®ƒä»¬åŒ…å«å¦‚ä¸‹é™„å½•ï¼š
@end ifclear
@ifset FOR_PRINT
ç¬¬å››éƒ¨åˆ†åŒ…æ‹¬å¦‚ä¸‹é™„å½•ï¼ŒåŒ…æ‹¬ GNU é€šç”¨å…¬å…±è®¸å¯ï¼š
@end ifset

@itemize @value{MINUS}
@item
@ref{Language History},
æè¿° @command{awk} è¯­è¨€ä»ç¬¬ä¸€ä¸ªç‰ˆæœ¬åˆ°ç°åœ¨çš„æ¼”åŒ–è¿‡ç¨‹ã€‚åŒæ—¶ä¹Ÿæè¿° @command{gawk} åœ¨ä¸åŒçš„æ—¶é—´å†…æ‰€å¼•å…¥çš„ç‰¹æ€§ã€‚

@item
@ref{Installation},
æè¿°å¦‚ä½•è·å– @command{gawk}ï¼Œå¦‚ä½•åœ¨ POSIX å…¼å®¹çš„ç³»ç»Ÿä¸­ç¼–è¯‘ï¼Œä»¥åŠå¦‚ä½•åœ¨é POSIX ç³»ç»Ÿä¸­ç¼–è¯‘ä¸ä½¿ç”¨å®ƒã€‚
ä»‹ç»å¦‚ä½•æ¥æŠ¥å‘Š @command{gawk} Bugï¼Œ
ä»¥åŠä»‹ç»å¯ä»¥è‡ªç”±è·å– @command{awk} çš„åœ°æ–¹ã€‚

@ifset FOR_PRINT
@item
@ref{Copying},
æä¾›ä½¿ç”¨ @command{gawk} æºç çš„è®¸å¯ã€‚

@end ifset

@ifclear FOR_PRINT
@item
@ref{Notes},
æè¿°å¦‚ä½•ç¦ç”¨ @command{gawk} æ‰©å±•ï¼Œä»¥åŠå¦‚ä½•å‘ @command{gawk} è´¡çŒ®æ–°ä»£ç ï¼Œè¿˜åŒ…æ‹¬ @command{gawk} æœªæ¥å¯èƒ½çš„å¼€å‘æ–¹å‘ã€‚

@item
@ref{Basic Concepts},
ä¸ºé‚£äº›åˆè¯†è®¡ç®—ç¼–ç¨‹çš„äººæä¾›ä¸€äº›ç²—ç•¥çš„èƒŒæ™¯èµ„æ–™ã€‚

@ref{Glossary}, 
å®šä¹‰å¤§å¤šæ•°çš„æœ¬@value{DOCUMENT}ä¸­æ‰€ç”¨åˆ°çš„æœ¯è¯­çš„æ„ä¹‰ï¼Œå¦‚æœä½ çœ‹åˆ°ä½ ä¸ç†Ÿæ‚‰çš„ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œã€‚

@item
@ref{Copying}, and
@ref{GNU Free Documentation License},
æä¾›æœ¬@value{DOCUMENT}ä¸­æºä»£ç ä»¥åŠæœ¬@value{DOCUMENT}æ‰€ä½¿ç”¨åˆ°çš„ä¸¤ä¸ªè®¸å¯è¯åè®®ã€‚

@end ifclear
@end itemize
@end itemize

@ifset FOR_PRINT
æœ¬@value{DOCUMENT}ç›¸å…³çš„ @command{gawk} å‘è¡Œç‰ˆæœ¬åŒ…å«äº†é¢å¤–çš„é™„å½•å’Œå…¶ä»–ææ–™ã€‚
ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œåœ¨å°åˆ·ç‰ˆä¸­æˆ‘ä»¬ç•¥è¿‡äº†è¿™éƒ¨åˆ†ã€‚
ä½ å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°è¿™äº›èµ„æ–™ï¼Œé“¾æ¥å¦‚ä¸‹ï¼š

@itemize @value{BULLET}
@item
@uref{http://www.gnu.org/software/gawk/manual/html_node/Notes.html,
The appendix on implementation notes}
æè¿°å¦‚ä½•ç¦ç”¨ @command{gawk} æ‰©å±•ï¼Œå¦‚ä½•å‘ @command{gawk} è´¡çŒ®æ–°ä»£ç ï¼Œ@command{gawk} æœªæ¥å¯èƒ½çš„å¼€å‘æ–¹å‘ï¼Œä»¥åŠæ‰©å±• API çš„è®¾è®¡å†³ç­–ã€‚

@item
@uref{http://www.gnu.org/software/gawk/manual/html_node/Basic-Concepts.html,
The appendix on basic concepts}
ä¸ºé‚£äº›åˆè¯†è®¡ç®—ç¼–ç¨‹çš„äººæä¾›ä¸€äº›ç²—ç•¥çš„èƒŒæ™¯èµ„æ–™ã€‚

@item
@uref{http://www.gnu.org/software/gawk/manual/html_node/Glossary.html,
The Glossary}
å®šä¹‰å¤§å¤šæ•°çš„æœ¬@value{DOCUMENT}ä¸­æ‰€ç”¨åˆ°çš„æœ¯è¯­çš„æ„ä¹‰ï¼Œå¦‚æœä½ çœ‹åˆ°ä½ ä¸ç†Ÿæ‚‰çš„ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œã€‚

@item
@uref{http://www.gnu.org/software/gawk/manual/html_node/GNU-Free-Documentation-License.html,
The GNU FDL}
æœ¬@value{DOCUMENT}æ‰€ä½¿ç”¨åˆ°çš„è®¸å¯è¯åè®®ã€‚

@end itemize

@c ok not to use CHAPTER / SECTION here
Some of the chapters have exercise sections; these have also been
omitted from the print edition but are available online.
@end ifset

@c FULLXREF OFF

@node Conventions
@unnumberedsec æ’ç‰ˆçº¦å®š

@cindex Texinfo
æœ¬@value{DOCUMENT}æ˜¯é€šè¿‡ @uref{http://www.gnu.org/software/texinfo/, Texinfo}@footnote{ä¸€ç§æ–‡æ¡£å¤„ç†è½¯ä»¶ï¼Œç”¨ä¸€ç§æ ¼å¼å³å¯ä»¥å®Œæˆç½‘é¡µè¾“å‡ºä»¥åŠæ‰“å°è¾“å‡ºã€‚è¿™ç§å·¥å…·ä¸»è¦ç”¨äºç¼–å†™è½¯ä»¶æ‰‹å†Œã€‚â€”â€”è¯‘è€…} å®Œæˆçš„ã€‚
è¿™æ˜¯ä¸€ç§æ–‡æ¡£æ ¼å¼åŒ–è¯­è¨€ã€‚ å•ä¸€çš„ TexInfo æºæ–‡ä»¶ï¼Œå³å¯ç”¨äºäº§ç”Ÿåœ¨çº¿ç‰ˆæœ¬çš„æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥äº§ç”Ÿæ‰“å°è¾“å‡ºçš„æ–‡æ¡£ã€‚
@ifnotinfo
å› ä¸ºè¿™ä¸ªåŸå› ï¼Œå…¶æ’ç‰ˆçº¦å®šä¸ä½ æ‰€è¯»å…¶ä»–çš„ä¹¦å¯èƒ½æœ‰ä¸€äº›å·®å¼‚ã€‚
@end ifnotinfo
@ifinfo
æœ¬@value{SECTION}ç®€è¦åœ°æè¿°äº†ä½¿ç”¨ Texinfo çš„æ’ç‰ˆçº¦å®šã€‚
@end ifinfo

ä½ åœ¨å‘½ä»¤è¡Œä¸Šè¾“å…¥çš„ä¾‹å­ï¼Œç”±é€šç”¨çš„ Shell ä¸»æ¬¡æç¤ºç¬¦ï¼Œ@samp{$} ä¸ @samp{>} å¼•å¯¼ã€‚
è¾“å…¥å‘½ä»¤@kbd{å¦‚ä¸‹}ã€‚
@c 8/2014: @print{} is stripped from the texi to make docbook.
@ifclear FOR_PRINT
å‘½ä»¤è¡Œçš„è¾“å‡ºç”±å­—ç¬¦â€œ@print{}â€å¼•å¯¼ã€‚è¿™ä»£è¡¨äº†å‘½ä»¤è¡Œçš„å…¸å‹è¾“å‡ºã€‚
@end ifclear
@ifset FOR_PRINT
å‘½ä»¤è¡Œçš„è¾“å‡ºï¼ˆé€šå¸¸æ˜¯æ ‡å‡†è¾“å‡ºï¼‰ï¼Œé€šå¸¸è¡¨ç°@code{å¦‚ä¸‹}ã€‚
@end ifset
é”™è¯¯ä¿¡æ¯ä»¥åŠå…¶ä»–çš„å‘½ä»¤è¡Œæ ‡å‡†é”™è¯¯è¾“å‡ºåˆ™ç”±â€œ@error{}â€å¼•å¯¼ï¼Œä¾‹å¦‚ï¼š

@example
$ @kbd{echo hi on stdout}
@print{} hi on stdout
$ @kbd{echo hello on stderr 1>&2}
@error{} hello on stderr
@end example

@ifnotinfo
åœ¨æ–‡æœ¬ä¸­ï¼Œæ‰€æœ‰ä¸ç¨‹åºç›¸å…³çš„ä¸œè¥¿ï¼Œå¦‚å‘½ä»¤åã€å˜é‡å’Œå‡½æ•°åã€å­—ä¸²ã€æ•°æ®ã€æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡éƒ½ä»¥ @code{this font} è¿™æ ·çš„å­—ä½“å‡ºç°ã€‚
ä»£ç æ®µä¹Ÿä»¥ç›¸åŒçš„å­—ä½“å‘ˆç°ï¼Œå¹¶ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼Œè¡¨ç°ä¸º @samp{like this}ã€‚
ç”±ç”¨æˆ·æˆ–è€…ç¨‹åºå‘˜æ›¿æ¢çš„éƒ¨åˆ†ä»¥ @var{this font}ï¼Œè¿™æ ·çš„å­—ä½“å‡ºç°ã€‚
é€‰é¡¹æ˜¯å¦‚ @option{-f} è¿™æ ·çš„å‚æ•°ã€‚@value{FFN}ç”± @file{/path/to/ourfile} è¿™æ ·çš„ä¸²æç¤ºã€‚
@ifclear FOR_PRINT
æœ‰äº›éœ€è¦å¼ºè°ƒçš„ä¸œè¥¿ä»¥ @emph{è¿™æ ·} çš„å­—ä½“å‡ºç°ã€‚
å¦‚æœæŸä¸€ç‚¹éœ€è¦ç‰¹åˆ«å¼ºè°ƒï¼Œå®ƒä»¥ @strong{è¿™æ ·} çš„å­—ä½“å‡ºç°ã€‚
@end ifclear
ç¬¬ä¸€ä¸ªå‡ºç°çš„æœ¯è¯­ï¼ŒåŒä¸€ä¸ªå¥å­ä¸­çš„å…ˆå‰å‡ºç°çš„æœ¯è¯­ï¼ŒåŒ…æ‹¬å…¶å®šä¹‰ä¹Ÿç”¨ç›¸åŒçš„å­—ä½“ï¼Œè¡¨ç°ä¸º @dfn{è¿™æ ·} çš„å­—ä½“ã€‚
@end ifnotinfo

ä½ ä»é”®ç›˜ä¸Šé”®å…¥çš„å­—ç¬¦ä¹Ÿç”¨ @kbd{like this} è¿™æ ·çš„å­—ä½“å‘ˆç°ã€‚
å¯¹äºä¸€äº›ç‰¹åˆ«çš„â€œæ§åˆ¶å­—ç¬¦â€ï¼Œè¿™äº›å­—ç¬¦æ˜¯éœ€è¦ä½ åŒæ—¶é”®å…¥ @kbd{CONTROL} é”®ä»¥åŠå¦ä¸€ä¸ªé”®æ¥è¾“å…¥ã€‚
æ¯”å¦‚ @kbd{Ctrl-d} éœ€è¦é¦–å…ˆæŒ‰ä¸‹å¹¶ä¿æŒ @kbd{CONTROL} é”®ï¼Œç„¶åæ•²å‡» @kbd{d} é”®ï¼Œç„¶åå†é‡Šæ”¾ä¸¤ä¸ªé”®ã€‚

ä¸ºäº†ç®€å•å¤„ç†ï¼Œåœ¨æœ¬@value{DOCUMENT}ä¸­ï¼Œæˆ‘ä»¬æŠŠ Brian Kernighan ç‰ˆæœ¬çš„ @command{awk} ç§°ä¸ºâ€œBWK @command{awk}â€ï¼ˆ@ref{Other Versions}ï¼ŒæŸ¥çœ‹è¿™ä¸ªç‰ˆæœ¬ä¸å…¶ä»–ç‰ˆæœ¬çš„ä¿¡æ¯ï¼‰ã€‚
@ifset FOR_PRINT
@quotation NOTE
Notes of interest look like this.
@end quotation

@quotation CAUTION
Cautionary or warning notes look like this.
@end quotation
@end ifset

@c fakenode --- for prepinfo
@unnumberedsubsec æš—è§’
@cindex Kernighan, Brian
@quotation
@i{æš—è§’æ€»æ˜¯å­˜åœ¨çš„â€”â€”æ— è®ºä½ å¤šä¹ˆä»”ç»†ï¼Œæ€»æ˜¯æœ‰ä¸€äº›æ›´å°çš„ï¼Œé»‘æš—çš„åœ°æ–¹ã€‚}
@author Brian Kernighan
@end quotation

@cindex d.c., See dark corner
@cindex dark corner
åœ¨æ²¡æœ‰åš POSIX æ ‡å‡†ï¼ˆä»¥åŠæ²¡å†™ @cite{@value{TITLE}}ï¼‰ä¹‹å‰ï¼Œ@command{awk} ç‰¹æ€§çš„æ–‡æ¡£å°‘å¾—å¯æ€œï¼Œç”šè‡³æ˜¯æ²¡æœ‰æ–‡æ¡£ã€‚
å¯¹äºè¿™æ ·çš„ç‰¹æ€§ï¼ˆç»å¸¸ç§°ä¸ºâ€œæš—è§’â€ï¼‰åœ¨è¿™ä¸ª@value{DOCUMENT}ä»¥
@iftex
é¡µè¾¹ä¸Šçš„æ‰‹ç”µå›¾å½¢
@value{DARKCORNER}
@end iftex
@ifnottex
``(d.c.).''
@end ifnottex
çš„å½¢å¼æç¤ºã€‚
@ifclear FOR_PRINT
å®ƒä»¬ä¹Ÿå‡ºç°åœ¨ç´¢å¼•ä¸­çš„â€œæš—è§’â€åŒºã€‚
@end ifclear

ä½†æ˜¯ï¼Œæ­£å¦‚å¼€æ”¾æ€§å¼•è¿°æ‰€æç¤ºçš„ï¼Œåœ¨å®šä¹‰ä¸Šå¯¹æš—è§’çš„è¦†ç›–æ˜¯ä¸å®Œå…¨çš„ã€‚

@cindex c.e., See common extensions

å¯¹äº @command{awk} æ ‡å‡†è¯­è¨€çš„æ‰©å±•ï¼Œå¾ˆå¤š @command{awk} å®ç°éƒ½æ”¯æŒï¼Œä»–ä»¬ç”¨
@ifclear FOR_PRINT
``@value{COMMONEXT},'' è¿›è¡Œæ ‡ç¤ºï¼Œå¹¶åœ¨ç´¢å¼•ä¸­çš„â€œé€šç”¨æ‰©å±•â€ä»¥åŠâ€œæ‰©å±•ï¼Œé€šç”¨â€ä¸­è¿›è¡Œåˆ—å‡ºã€‚
@end ifclear
@ifset FOR_PRINT
``@value{COMMONEXT}'' æ ‡è¯†â€œé€šç”¨æ‰©å±•â€ã€‚
@end ifset

@node Manual History
@unnumberedsec GNU é¡¹ç›®åŠæœ¬@value{DOCUMENT}

@cindex FSF (Free Software Foundation)
@cindex Free Software Foundation (FSF)
@cindex Stallman, Richard

è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šï¼ˆFSFï¼‰æ˜¯ä¸€ä¸ªéè¥åˆ©æ€§ç»„ç»‡ï¼Œå…¶ä¸“æ³¨äºå¼€å‘ä¸å‘å¸ƒå¯è‡ªç”±åˆ†å‘çš„è½¯ä»¶ã€‚
å®ƒç”± Richard M.@: Stallmanâ€”â€”å³æœ€åˆçš„ Emacs ç¼–è¾‘å™¨çš„ä½œè€…â€”â€”åˆ›å»ºã€‚GNU çš„ Emacs è½¯ä»¶ä¹Ÿæ˜¯ç›®å‰ç”¨å¾—æœ€å¹¿æ³›çš„ Emacs ç‰ˆæœ¬ã€‚

@cindex GNU Project
@cindex GPL (General Public License)
@cindex General Public License, See GPL
@cindex documentation, online

GNU@footnote{GNU è¡¨ç¤ºâ€œGNU's Not Unixâ€ã€‚} 
é¡¹ç›®æ˜¯è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šçš„é¡¹ç›®ï¼Œå…¶ç›®å‰ä¾ç„¶è¿˜åœ¨æŒç»­åœ°ä¸ºåˆ›å»ºä¸€ä¸ªå®Œå…¨å¯è‡ªç”±å‘å¸ƒï¼Œä¸ POSIX å…¼å®¹çš„è®¡ç®—ç¯å¢ƒè€ŒåŠªåŠ›ã€‚
è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šé€šè¿‡â€œé€šç”¨å…¬å…±è¯·å¯â€ï¼ˆGPLï¼‰æ¥ä¿è¯å…¶ä¸‹çš„è½¯ä»¶çš„æºä»£ç å¯¹äºç»ˆç«¯ç”¨æˆ·æ€»æ˜¯å¯ç”¨çš„ã€‚
@ifclear FOR_PRINT
GPL çš„å¤æœ¬å·²ç»åŒ…å«åœ¨
@ifnotinfo
æœ¬@value{DOCUMENT}ä¸­
@end ifnotinfo
ä»¥ä¾›å‚è€ƒ
(@pxref{Copying}).
@end ifclear
GPL ä¹Ÿåº”ç”¨äºç”¨ C å†™æˆçš„ @command{gawk}ã€‚è¦æŸ¥æ‰¾æ›´å¤šçš„å…³äºè‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šä»¥åŠ GNU é¡¹ç›®çš„åœ¨çº¿ä¿¡æ¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹ @uref{http://www.gnu.org, GNU é¡¹ç›®çš„ä¸»é¡µ}ã€‚
æœ¬@value{DOCUMENT}ä¹Ÿå¯ä»¥ä» @uref{http://www.gnu.org/software/gawk/manual/, GNU ç«™ç‚¹} ä¸Šé˜…è¯»ã€‚

@ifclear FOR_PRINT
Shellï¼Œç¼–è¾‘å™¨ï¼ˆEmacsï¼‰ï¼Œé«˜åº¦å¯ç§»æ¤çš„ Cã€C++ ä¸ Object-C ç¼–è¯‘å™¨ï¼Œç¬¦å·è°ƒè¯•å™¨ä»¥åŠå¤§é‡çš„å°å·¥å…·ï¼ˆå¦‚ @command{gawk}ï¼‰ï¼Œéƒ½å·²ç»å®Œæˆå¹¶å¯è‡ªç”±è·å–ã€‚
GNU æ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆHURDï¼‰ä¹Ÿå·²ç»å‘å¸ƒï¼Œåªæ˜¯è¿˜å¤„äºå¼€å‘çš„æ—©æœŸé˜¶æ®µã€‚

@cindex Linux
@cindex GNU/Linux
@cindex operating systems, BSD-based
åœ¨ GNU æ“ä½œç³»ç»Ÿå®Œå…¨å¼€å‘å¥½å‰ï¼Œä½ åº”è¯¥è€ƒè™‘ä½¿ç”¨ GNU/Linuxï¼Œä¸€ä¸ªå¯è‡ªç”±å‘å¸ƒçš„ï¼ŒUnix-like çš„æ“ä½œç³»ç»Ÿï¼Œç”¨äº Intelã€Power è¿™æ ·çš„æ„æ¶ï¼ŒSun Sparcï¼ŒIBM S/390 ç­‰å…¶ä»–ç³»ç»Ÿ@footnote{æœ¯è¯­``GNU/Linux''åœ¨@ref{Glossary}è¿›è¡Œè¯´æ˜ã€‚}ã€‚å¾ˆå¤šçš„ GNU/Linux å‘è¡Œç‰ˆæœ¬éƒ½å¯ä»¥é€šè¿‡äº’è”ç½‘ä¸‹è½½ã€‚
@end ifclear

@ifnotinfo
ä½ æ­£åœ¨é˜…è¯»çš„è¿™ä¸ª@value{DOCUMENT}ä¹Ÿæ˜¯å…è´¹çš„â€”â€”æœ€èµ·ç çš„ã€‚
è¿™é‡Œé¢çš„ä¿¡æ¯å¯¹ä»»ä½•ä¸€ä¸ªäººéƒ½æ˜¯å…è´¹çš„ã€‚ä¹ŸåŒ…æ‹¬ä¸ @command{gawk} ç›¸å…³çš„ï¼Œå¯¹äºæœºå™¨å¯è¯»çš„æºä»£ç ã€‚
ï¼ˆèŠ±ä¸€ç‚¹æ—¶é—´é˜…è¯»ä¸€ä¸‹åœ¨@ref{GNU Free Documentation License}ä¸­çš„è‡ªç”±æ–‡æ¡£è®¸å¯è¯åè®®ã€‚ï¼‰
@end ifnotinfo

@cindex Close, Diane
æ­¤@value{DOCUMENT}å·²ç»ç»è¿‡äº†å¤šä¸ªç‰ˆæœ¬ã€‚Paul Rubin å†™äº†ç¬¬ä¸€ä»½ @cite{The GAWK Manual}ï¼Œå¤§æ¦‚æœ‰40é¡µã€‚
Diane Close ä¸ Richard Stallman ä¸°å¯Œäº†å®ƒï¼Œäº§ç”Ÿäº†ä¸€ä¸ªå¤§æ¦‚ 90 é¡µçš„ç‰ˆæœ¬ï¼Œå®ƒåªé’ˆå¯¹æœ€åˆçš„ï¼Œâ€œæ—§â€ç‰ˆæœ¬çš„ @command{awk}ã€‚

æˆ‘ä» 1988 å¹´ç§‹å¤©å¼€å§‹ç€æ‰‹åˆ¶ä½œé‚£ä¸ªç‰ˆæœ¬ã€‚éšç€å·¥ä½œçš„æ¨è¿›ï¼Œè‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå‡ºç‰ˆäº†å‡ ä¸ªåˆæ­¥çš„ç‰ˆæœ¬ï¼ˆç‰ˆæœ¬å· 0.@var{x}ï¼‰ã€‚
åœ¨ 1996 å¹´ï¼Œ1.0 ç‰ˆæœ¬éšç€ @command{gawk} 3.0.0 å‘å¸ƒã€‚
è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå‡ºç‰ˆäº†å‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¹¦åä¸º @cite{The GNU Awk User's Guide}ã€‚
@ifset FOR_PRINT
SSC å‡ºç‰ˆäº†è¿™ä¸ª@value{DOCUMENT}çš„ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¹¦åä¸º @cite{Effective awk Programming}ï¼ŒO'Reilly åœ¨ 2001 å¹´å‡ºç‰ˆäº†ç¬¬ä¸‰ç‰ˆã€‚
@end ifset

è¿™ä¸€ç‰ˆç»´æŒäº†ä¹‹å‰çš„ç‰ˆæœ¬çš„åŸºæœ¬ç»“æ„ã€‚
FSF 4.0 ç‰ˆçš„å†…å®¹å®Œå…¨æ ¡å¯¹å’Œæ›´æ–°äº†ã€‚æ‰€æœ‰ 4.0 ç‰ˆæœ¬ä¹‹å‰çš„ @command{gawk} ç‰ˆæœ¬çš„å‚è€ƒéƒ½åˆ å»äº†ã€‚
é‚£ä¸ªç‰ˆæœ¬ä¸­å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯å¢åŠ äº† @ref{Debugger}ã€‚

åœ¨ FSF ç‰ˆæœ¬ä¸­ï¼Œ
@ifclear FOR_PRINT
@value{EDITION} ç‰ˆæœ¬
@end ifclear
@ifset FOR_PRINT
@value{EDITION}
(O'Reilly å‡ºç‰ˆçš„ç¬¬å››ç‰ˆ),
@end ifset
é‡æ–°ç»„ç»‡äº†æ–‡æ¡£å†…å®¹ï¼Œä¸»è¦çš„æ›´æ–°æ˜¯å¢åŠ äº† @ref{Arbitrary Precision Arithmetic} ä»¥åŠ @ref{Dynamic Extensions}ã€‚

è¿™ä¸ª@value{DOCUMENT}æœªæ¥ä¸€å®šä¼šæŒç»­ä¼˜åŒ–ã€‚å¦‚æœä½ åœ¨è¿™ä¸ª@value{DOCUMENT}å‘ç°äº†é”™è¯¯ï¼Œè¯·æŠ¥å‘Šå®ƒã€‚
@ref{Bugs} ï¼Œä½ å¯ä»¥æ‰¾åˆ°å…³äºæäº¤ç”µå­ç‰ˆé—®é¢˜æŠ¥å‘Šçš„ä¿¡æ¯ã€‚ 

@ifset FOR_PRINT
@c fakenode --- for prepinfo
@unnumberedsec å¦‚ä½•ä¿æŒæœ€æ–°ä¿¡æ¯

ä¹Ÿè®¸ä½ æ‰‹ä¸Šæœ‰æ¯”è¿™é‡Œçš„ç‰ˆæœ¬æ›´æ–°çš„ @command{gawk} ç‰ˆæœ¬ã€‚
å¦‚æœä½ æƒ³çŸ¥é“ä¿®æ”¹äº†ä»€ä¹ˆéƒ¨åˆ†ï¼Œé¦–å…ˆä½ åº”è¯¥çœ‹çœ‹ @command{gawk} å‘è¡Œä¸­çš„ @file{NEWS} æ–‡ä»¶ã€‚
è¿™ä¸ªæ–‡ä»¶ä¸­æä¾›äº†æ¯æ¬¡å‘å¸ƒçš„æ›´æ–°æ¦‚è¦ã€‚

ç„¶åï¼Œä½ å¯ä»¥æŸ¥çœ‹è¿™ä¸ªthis @value{DOCUMENT} @uref{http://www.gnu.org/software/gawk/manual/,
åœ¨çº¿ç‰ˆæœ¬}ï¼Œé˜…è¯»æ–°ç‰¹æ€§çš„ç›¸å…³ä¿¡æ¯ã€‚
@end ifset

@ifclear FOR_PRINT
@node How To Contribute
@unnumberedsec å¦‚ä½•è´¡çŒ®

ä½œä¸º GNU @command{awk} çš„ç»´æŠ¤è€…ï¼Œæˆ‘æ›¾ç»æƒ³ç€æˆ‘åº”è¯¥èƒ½å¤Ÿç®¡ç†è¿™ä¸€å¤§å †çš„å…¬å¼€å¯å¾—çš„ @command{awk} ç¨‹åºï¼Œæˆ‘ç”šè‡³æ‹›å‹Ÿè¿‡è´¡çŒ®è€…ã€‚
ä»äº’è”ç½‘å¯ä»¥å¾—åˆ°æˆ‘æƒ³è¦çš„ä¸œè¥¿ï¼Œèƒ½å¤Ÿå¸®åŠ© @command{gawk} çš„å‘å¸ƒç‰ˆä¿æŒåœ¨ä¸€ä¸ªå¯ç®¡ç†çš„å¤§å°ã€‚

æœ€åŸå§‹çš„ææ–™ï¼Œå¦‚æœ¬@value{DOCUMENT}ï¼Œè¿˜å¯ä»¥ä» @uref{ftp://ftp.freefriends.org/arnold/Awkstuff} è·å–ã€‚
ä¸ºäº†æŠŠè¿™ä¸ªäº‹æƒ…åšå¾—æ›´ä¸ºå¼€æ”¾å¹¿æ³›ï¼Œæˆ‘è¿˜ç”³è¯·äº† @code{awk.info} åŸŸåã€‚

ä½†æ˜¯ï¼Œæˆ‘å‘ç°æˆ‘æ²¡æœ‰æ—¶é—´å®Œå…¨åœ°æ¥ç®¡ç†è¿™äº›åˆ†å¸ƒçš„ä»£ç ï¼šæ–‡æ¡£å·²ç»ä¸å†å¢é•¿ï¼Œè€ŒåŸŸåå·²ç»å‡ å¹´å‰å°±ä¸èƒ½ä½¿ç”¨äº†ã€‚

2008 å¹´çš„æ™šäº›æ—¶å€™ï¼Œæœ‰å¿—æ„¿è€…è®¾ç«‹äº† @command{awk} ç›¸å…³çš„ç½‘ç«™â€”â€” @uref{http://awk.info} â€”â€”å·¥ä½œåšå¾—ç›¸å½“æ£’ã€‚

å¦‚æœä½ å†™è¿‡ä¸€ä¸ªæœ‰å‘³çš„ @command{awk} ç¨‹åºï¼Œæˆ–è€…å†™äº† @command{gawk} æ‰©å±•å¹¶ä¸”å¸Œæœ›ä¸å…¶ä»–äººåˆ†äº«ï¼Œè¯·çœ‹ @uref{http://awk.info/?contribute} æ¥äº†è§£å¦‚ä½•å°†å®ƒå‘å¸ƒåˆ°ç½‘ç«™ä¸Šã€‚

@ignore
å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™ä¸ªç½‘ç«™ä¹Ÿåœ¨å¯»æ‰¾ç»´æŠ¤è€…ï¼›å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œè¯·è”ç³»æˆ‘ã€‚
@end ignore

@ignore
å…¶ä»–é“¾æ¥ï¼š

http://www.reddit.com/r/linux/comments/dtect/composing_music_in_awk/
@end ignore
@end ifclear

@node Acknowledgments
@unnumberedsec è‡´è°¢

æœ€åˆçš„ @cite{The GAWK Manual} çš„è‡´è°¢å¦‚ä¸‹ï¼š

@quotation
å¾ˆå¤šçš„äººéœ€è¦æ„Ÿè°¢ï¼Œå› ä¸ºä»–ä»¬å¸®åŠ©äº§ç”Ÿäº†è¿™ä¸ªæ‰‹å†Œã€‚
Jay Fenlason æä¾›äº†è®¸å¤šçš„æƒ³æ³•ä¸ä¾‹å­ã€‚
Richard Mlynarik ä¸ Robert Chassell ç»™äº†æ–‡æ¡£éå¸¸æœ‰å¸®åŠ©çš„ç‚¹è¯„ã€‚
John W.@: å†™äº† @cite{A Supplemental Document for AWK} æ–‡æ¡£ã€‚
UC San Diego åŒ–å­¦éƒ¨çš„ Pierce æŒ‡å‡ºå‡ ä¸ªé—®é¢˜ï¼Œæ—¢ä¸ @command{awk} å®ç°æœ‰å…³ï¼Œä¹Ÿä¸æ‰‹å†Œæœ‰å…³ï¼Œä¸ç„¶è¿™äº›é—®é¢˜ä¼šé€ƒè¿‡æˆ‘ä»¬çš„çœ¼ç›ã€‚
@end quotation

@cindex Stallman, Richard
æˆ‘è¦æ„Ÿè°¢ Richard M.@: Stallmanï¼Œæ„Ÿè°¢ä»–å¯¹ç¾å¥½ä¸–ç•Œçš„æ„¿æ™¯ï¼Œå¹¶æœ‰å‹‡æ°”æˆç«‹ FSF å¹¶å¼€å¯ GNU é¡¹ç›®ã€‚

@ifclear FOR_PRINT
æœ¬@value{DOCUMENT}æ›´æ—©ç‰ˆæœ¬çš„è‡´è°¢å¦‚ä¸‹ï¼š
@end ifclear
@ifset FOR_PRINT
æœ¬@value{DOCUMENT}ä¹‹å‰çš„ç‰ˆæœ¬çš„è‡´è°¢å¦‚ä¸‹ï¼š
@end ifset

@quotation
ä¸‹é¢çš„äººï¼ˆæŒ‰å­—æ¯é¡ºåºï¼‰ä¸ºæœ¬@value{DOCUMENT}çš„ä¸åŒç‰ˆæœ¬æä¾›äº†å¾ˆå¥½çš„ç‚¹è¯„ï¼š
Rick Adamsï¼Œ
Dr.@: Nelson H.F. Beebeï¼Œ 
Karl Berryï¼Œ
Dr.@: Michael Brennanï¼Œ
Rich Burridgeï¼Œ
Claire Cloutierï¼Œ
Diane Closeï¼Œ
Scott Deifikï¼Œ
Christopher (â€œTopherâ€) Eliotï¼Œ
Jeffrey Friedlï¼Œ
Dr.@: Darrel Hankersonï¼Œ
Michal Jaegermannï¼Œ
Dr.@: Richard J.@: LeBlancï¼Œ
Michael Lijewskiï¼Œ
Pat Rankinï¼Œ
Miriam Robbinsï¼Œ
Mary Sheehanï¼Œ
å’Œ Chuck Toporekã€‚

@cindex Berry, Karl
@cindex Chassell, Robert J.@:
@c @cindex Texinfo
Robert J.@: Chassell åœ¨ä½¿ç”¨ Texinfo ä¸Šæä¾›äº†éå¸¸æœ‰ä»·å€¼çš„å»ºè®®ã€‚
ä»–ä¹Ÿåº”è¯¥å¾—åˆ°ç‰¹åˆ«æ„Ÿè°¢ï¼Œå› ä¸ºä»–è¯´æœæˆ‘@emph{ä¸è¦}ç”¨ @cite{How to Gawk Politely} è¿™æ ·çš„æ ‡é¢˜æ¥å‘½åæœ¬@value{DOCUMENT}ã€‚
Karl Berry åœ¨ Texinfo ä¸­çš„ @TeX{} éƒ¨åˆ†ç»™äºˆäº†ç›¸å½“å¤§çš„å¸®åŠ©ã€‚

@cindex Hartholz, Marshall
@cindex Hartholz, Elaine
@cindex Schreiber, Bert
@cindex Schreiber, Rita
æˆ‘ä¹Ÿè¦æ„Ÿè°¢ Marshall ä¸ Seattle çš„ Elaine Hartholz ï¼Œè¿˜æœ‰ Detroit çš„ Bert and Rita Schreiber åšå£«ï¼Œ
ä»–ä»¬ç‰ºç‰²äº†å¤§é‡çš„å‡æœŸæ—¶é—´â€”â€”ä»–ä»¬æœ¬å¯ä»¥å®‰å®‰é™è§£åœ°åœ¨å®¶é‡Œåº¦è¿‡â€”â€”ä½¿å¾—æˆ‘åœ¨æœ¬@value{DOCUMENT}çš„åˆ¶ä½œå’Œ @command{gawk} ä¸Šçš„å·¥ä½œéƒ½èƒ½è¿›å±•ç¥é€Ÿã€‚

@cindex Hughes, Phil
SSC çš„ Phil Hughes å€Ÿç»™æˆ‘ä»–çš„ç¬”è®°æœ¬ GNU/Linux ç³»ç»Ÿï¼Œä¸æ˜¯ä¸€æ¬¡ï¼Œè€Œæ˜¯ä¸¤æ¬¡ï¼Œä»–ä»¥è¿™æ ·çš„ä¸€ç§æ–¹å¼ä½¿æˆ‘åœ¨ç¦»å¼€å®¶çš„æ—¶å€™åšäº†å¤§é‡çš„å·¥ä½œã€‚

@cindex Trueman, David
David Trueman åº”è¯¥å¾—åˆ°ç‰¹åˆ«çš„è‡´è°¢ã€‚ä»–è‡ªå‘Šå¥‹å‹‡åœ°æ‰¿æ‹…èµ·äº†ä¼˜åŒ– @command{gawk} çš„å·¥ä½œï¼Œå› æ­¤ @command{gawk} æ‰ä¼šæ‰§è¡Œå¾—å¦‚æ­¤ä¹‹å¥½ï¼Œæ²¡æœ‰ Bugã€‚
å°½ç®¡ä»–ç°åœ¨ä¸å†ä»‹å…¥ @command{gawk} çš„å·¥ä½œï¼Œä½†æ˜¯ä¸ä»–åœ¨è¿™ä¸ªé¡¹ç›®ä¸Šä¸€èµ·å·¥ä½œç›¸å½“æ„‰å¿«ã€‚

@cindex Drepper, Ulrich
@cindex GNITS mailing list
@cindex mailing list, GNITS
GNITS é‚®ä»¶åˆ—è¡¨ä¸­çš„é‚£äº›æ— ç•çš„æˆå‘˜ä»¬ï¼Œä»¥åŠæœ€å€¼å¾—å°Šæ•¬çš„ Ulrich Drepper ä¸ºè®¾è®¡å›½é™…åŒ–ç‰¹æ€§æä¾›äº†æ— ä»·çš„å¸®åŠ©ä¸åé¦ˆã€‚

æ¥è‡ª O'Reilly & Associates çš„ Chuck Toporekï¼ŒMary Sheehanï¼Œå’Œ Claire Cloutierï¼Œå¯¹ @command{gawk} 3.1 ç‰ˆçš„æœ¬@value{DOCUMENT}æä¾›äº†ç¼–è¾‘ä¸Šçš„å¸®åŠ©ï¼Œä½œå‡ºäº†é‡è¦è´¡çŒ®ã€‚
@end quotation

@cindex Beebe, Nelson H.F.@:
@cindex Buening, Andreas
@cindex Collado, Manuel
@cindex Colombo, Antonio
@cindex Davies, Stephen
@cindex Deifik, Scott
@cindex Demaille, Akim
@cindex G., Daniel Richard
@cindex Hankerson, Darrel
@cindex Jaegermann, Michal
@cindex Kahrs, J@"urgen
@cindex Kasal, Stepan
@cindex Malmberg, John
@cindex Pitts, Dave
@cindex Ramey, Chet
@cindex Rankin, Pat
@cindex Schorr, Andrew
@cindex Vinschen, Corinna
@cindex Zaretskii, Eli

Dr.@: Nelson Beebeï¼Œ
Andreas Bueningï¼Œ
Dr.@: Manuel Colladoï¼Œ
Antonio Colomboï¼Œ
Stephen Daviesï¼Œ
Scott Deifikï¼Œ
Akim Demailleï¼Œ
Daniel Richard G.ï¼Œ
Darrel Hankersonï¼Œ
Michal Jaegermannï¼Œ
J@"urgen Kahrsï¼Œ
Stepan Kasalï¼Œ
John Malmbergï¼Œ
Dave Pittsï¼Œ
Chet Rameyï¼Œ
Pat Rankinï¼Œ
Andrew Schorrï¼Œ
Corinna Vinschenï¼Œ
å’Œ Eli Zaretskii
ï¼ˆæŒ‰å­—æ¯é¡ºåºï¼‰
ç»„æˆäº†ç›®å‰çš„ @command{gawk} â€œéœ¹é›³ç§»æ¤æ€§å°ç»„â€ã€‚å¦‚æœæ²¡æœ‰ä»–ä»¬çš„è‰°è‹¦å·¥ä½œä¸å¸®åŠ©ï¼Œ@command{gawk} ä¸ä¼šä»Šå¤©æœ‰å¦‚æ­¤ç¨³å®šï¼Œå¯ç§»æ¤çš„ç¨‹åºã€‚ä¸è¿™æ ·çš„ä¸€ç¾¤å¥½äººå°ç»„ä¸€èµ·å·¥ä½œæ›¾ç»æ˜¯ä¹Ÿå°†ä¸€ç›´æ˜¯ä»¶å¿«ä¹çš„äº‹æƒ…ã€‚

è®¸å¤šäººè´¡çŒ®äº†ç›¸å½“å¤šçš„ä»£ç ä¸æ–‡æ¡£ï¼Œ@ref{Contributors} ï¼Œå…¶ä¸­æœ‰å®Œæ•´çš„åˆ—è¡¨ã€‚

@ifset FOR_PRINT
@cindex Oram, Andy
æ„Ÿè°¢æ¥è‡ª O'Reilly Media çš„ Andy Oramã€‚ä»–å¼€å§‹äº†ç¬¬å››ç‰ˆçš„å‡ºç‰ˆï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸€ç›´æä¾›æ”¯æŒã€‚
æ„Ÿè°¢ Jasmine Kwityn çš„æ ¡å¯¹å·¥ä½œã€‚
@end ifset

è°¢è°¢ Michael Brennan å†™çš„åºè¨€ã€‚

@cindex Duman, Patrice
@cindex Berry, Karl
è°¢è°¢ Patrice Dumas æ–°å†™çš„ @command{makeinfo} ç¨‹åºï¼Œä¹Ÿè°¢è°¢ Karl Berry æŒç»­å·¥ä½œä½¿ç”¨ Texinfo è¿™æ ·çš„æ ‡å¿—è¯­è¨€å¦‚æ­¤ç‰›Bã€‚

@cindex Kernighan, Brian
@cindex Brennan, Michael
@cindex Day, Robert P.J.@:
Robert P.J.@: Dayï¼ŒMichael Brennanï¼Œè¿˜æœ‰ Brian Kernighanï¼Œéå¸¸å¥½å¿ƒåœ°ä½œä¸ºäº†æœ¬@value{DOCUMENT} 2015 ç‰ˆæœ¬çš„å®¡æ ¸è€…ã€‚
ä»–ä»¬çš„å·¥ä½œä½¿ç”¨è®©æœ¬@value{DOCUMENT}è´¨é‡æ›´ä¼˜ã€‚

æˆ‘è¿˜è¦æ„Ÿè°¢ Brian Kernighanï¼Œå› ä¸ºåœ¨æµ‹è¯•ä¸è°ƒè¯• @command{gawk} æœŸé—´æä¾›çš„æ— ä»·å¸®åŠ©ï¼Œä¹Ÿä¸ºä»–åœ¨æ¾„æ¸…æ— æ•°çš„è¯­è¨€ç–‘ç‚¹ä¸Šçš„çš„æŒç»­å¸®åŠ©ä¸å»ºè®®ã€‚
æ²¡æœ‰ä»–çš„å¸®åŠ©ï¼Œ@command{gawk} å’Œå®ƒçš„æ–‡æ¡£ä¸ä¼šåƒç°åœ¨è¿™ä¹ˆä¼˜ç§€ã€‚

Brian æ˜¯ä¸€æµç¨‹åºå‘˜ä¸æŠ€æœ¯ä½œè€…ï¼Œæˆ‘è¦ï¼ˆåˆä¸€æ¬¡ï¼‰æ„Ÿè°¢ä»–ï¼Œå› ä¸ºä»–æŒç»­çš„å‹è°Šä¸ä¸ºæˆ‘æ ‘ç«‹èµ·æ¥çš„è¿‘ 30 å¹´çš„æ¨¡èŒƒä½œç”¨ã€‚
æœ‰è¿™æ ·çš„äººä½œä¸ºè¯„è®ºäººçœŸæ˜¯å¤§å¹¸ã€‚è€Œä»–ä¸€ç›´ä»¥æ¥éƒ½å¦‚æ­¤è°¦å‘@enddots{}

@cindex Robbins, Miriam
@cindex Robbins, Jean
@cindex Robbins, Harry
@cindex G-d
æˆ‘è¿˜å¾—æ„Ÿè°¢æˆ‘çš„å†…äººï¼ŒMiriamã€‚å› ä¸ºå¥¹çš„è€å¿ƒï¼Œåœ¨è¿™ä¸ªé¡¹ç›®çš„å¤šä¸ªç‰ˆæœ¬ä¹‹é—´ä½œä¸ºç¬¬ä¸€è¯»è€…ï¼ŒåŒæ—¶è¿˜ä¸æˆ‘åˆ†äº«ç”µè„‘ã€‚
è¿˜è¦æ„Ÿè°¢æˆ‘çš„è€çˆ¸è€å¦ˆï¼Œå› ä¸ºä»–ä»¬çš„çˆ±ä¸ç”Ÿè€Œè‚²æˆ‘çš„è‰°è¾›ã€‚æœ€åï¼Œæˆ‘ä¹Ÿè¦æŠŠæˆ‘çš„æ„Ÿè°¢çŒ®ç»™ G-dï¼Œæ˜¯ä»–ç»™æˆ‘äº†è®¸å¤šæœºä¼šï¼Œç¤¼ç‰©ï¼Œè€Œè¿™äº›ç¤¼ç‰©ä½¿æˆ‘èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨è¿™äº›æœºä¼šã€‚
@ifnotdocbook
@sp 2
@noindent
Arnold Robbins @*
Nof Ayalon @*
Israel @*
February 2015
@end ifnotdocbook

@ifnotinfo
@part @value{PART1} @command{awk} è¯­è¨€
@end ifnotinfo

@ifdocbook

ç¬¬ä¸€éƒ¨åˆ†å¯¹ @command{awk} è¯­è¨€ä»¥åŠ @command{gawk} ç¨‹åºè¿›è¡Œè¯¦ç»†æè¿°ã€‚é€šè¿‡ä»æœ€åŸºç¡€çš„å¼€å§‹ï¼Œä¸æ–­è¯¦è§£ @command{awk} çš„æ‰€æœ‰ç‰¹æ€§ã€‚
è¿™éƒ¨åˆ†çš„å†…å®¹ä¹ŸåŒ…å«äº† @command{gawk} çš„è®¸å¤šç‰¹æ€§ï¼Œä½†ä¸æ˜¯å…¨éƒ¨ã€‚
å®ƒä»¬åŒ…å«å¦‚ä¸‹ç« èŠ‚ï¼š

@itemize @value{BULLET}
@item
@ref{Getting Started}

@item
@ref{Invoking Gawk}

@item
@ref{Regexp}

@item
@ref{Reading Files}

@item
@ref{Printing}

@item
@ref{Expressions}

@item
@ref{Patterns and Actions}

@item
@ref{Arrays}

@item
@ref{Functions}
@end itemize
@end ifdocbook

@node Getting Started
@chapter å¼€å§‹ @command{awk}
@c @cindex script, definition of
@c @cindex rule, definition of
@c @cindex program, definition of
@c @cindex basic function of @command{awk}
@cindex @command{awk}, function of

@command{awk} çš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯æŸ¥æ‰¾å…·æŸç§æ¨¡å¼çš„æ–‡æœ¬è¡Œï¼ˆæˆ–è€…å…¶ä»–å•ä½çš„æ–‡æœ¬ï¼‰ã€‚
å½“åŒ¹é…æŸä¸ªæ¨¡å¼åï¼Œ@command{awk} ä¼šå¯¹è¯¥è¡Œæ‰§è¡ŒæŒ‡å®šçš„åŠ¨ä½œã€‚
@command{awk} ç„¶åç»§ç»­è¾“å…¥è¡Œï¼Œç›´åˆ°æ–‡ä»¶è¾“å…¥å¤„ç†å®Œæ¯•ã€‚

@cindex @command{awk}, uses for
@cindex programming languages@comma{} data-driven vs.@: procedural
@cindex @command{awk} programs
@command{awk} ä¸­çš„ç¨‹åºä¸å…¶ä»–è¯­è¨€çš„ç¨‹åºä¸åŒï¼Œå› ä¸º @command{awk} ç¨‹åºæ˜¯@dfn{æ•°æ®é©±åŠ¨}çš„ï¼ˆå³ä½ æè¿°ä½ è¦å¤„ç†çš„æ•°æ®ï¼Œç„¶åå‘Šè¯‰ç¨‹åºæ‰¾åˆ°ç›¸åº”æ•°æ®åè¦æ‰§è¡Œçš„å·¥ä½œï¼‰ã€‚
å¤šæ•°å…¶ä»–è¯­è¨€éƒ½æ˜¯@dfn{è¿‡ç¨‹å¼}çš„ï¼›ä½ éœ€è¦åœ¨éå¸¸ç»†çš„ç»†èŠ‚ä¸Šæè¿°ç¨‹åºæ¯ä¸€è¡Œè¦åšä»€ä¹ˆã€‚
å½“ä¸è¿‡ç¨‹å¼è¯­è¨€æ‰“äº¤é“æ—¶ï¼Œä¸€èˆ¬å¾ˆéš¾æ¸…æ¥šåœ°æè¿°ä½ çš„ç¨‹åºæ‰€è¦å¤„ç†çš„æ•°æ®ã€‚æ­£æ˜¯ç”±äºè¿™ä¸ªåŸå› ï¼Œ@command{awk} ç¨‹åºéå¸¸æ˜“è¯»æ˜“å†™ã€‚

@cindex program, definition of
@cindex rule, definition of
å½“æ‰§è¡Œ @command{awk} ç¨‹åºï¼Œä½ éœ€è¦æŒ‡å®šä¸€ä¸ª@dfn{ç¨‹åº}å‘ŠçŸ¥ @command{awk} æ¥ä¸‹æ¥è¦åšä»€ä¹ˆã€‚
è¿™ä¸ªç¨‹åºåŒ…æ‹¬ä¸€ç³»ç»Ÿçš„@dfn{è§„åˆ™}ï¼ˆæœ‰å¯èƒ½ä¹Ÿä¼šåŒ…å«@dfn{å‡½æ•°å®šä¹‰}ï¼Œä¸€äº›ä½ ç°åœ¨å¯ä»¥å¿½ç•¥çš„é«˜çº§ç‰¹æ€§ï¼›@pxref{User-defined})ï¼Œ
æ¯ä¸ªè§„åˆ™æŒ‡å®šäº†è¦æŸ¥æ‰¾çš„æ¨¡å¼ä»¥åŠä¸€ä¸ªåœ¨æŸ¥æ‰¾åˆ°æ¨¡å¼æ—¶è¦æ‰§è¡Œçš„åŠ¨ä½œã€‚

åœ¨è¯­æ³•ä¸Šï¼Œè§„åˆ™åŒ…æ‹¬ä¸€ä¸ª@dfn{æ¨¡å¼}ï¼Œåé¢å¸¦ç€@dfn{åŠ¨ä½œ}ã€‚åŠ¨ä½œæ˜¯åŒ…å«åœ¨èŠ±æ‹¬å·ä¸­çš„ï¼Œä¸æ¨¡å¼åˆ†ç¦»ã€‚æ¯ä¸€è¡Œä¸€èˆ¬éƒ½æ˜¯æ–°çš„ä¸åŒçš„è§„åˆ™ã€‚
å› æ­¤ï¼Œ@command{awk} ç¨‹åºçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

@example
@var{pattern} @{ @var{action} @}
@var{pattern} @{ @var{action} @}
@dots{}
@end example

@menu
* Running gawk::                å¦‚ä½•æ‰§è¡Œ @command{awk} ç¨‹åºï¼›åŒ…æ‹¬å‘½ä»¤è¡Œè¯­æ³•ã€‚
* Sample Data Files::           Sample data files for use in the @command{awk}
                                programs illustrated in this @value{DOCUMENT}.
* Very Simple::                 A very simple example.
* Two Rules::                   A less simple one-line example using two
                                rules.
* More Complex::                A more complex example.
* Statements/Lines::            Subdividing or combining statements into
                                lines.
* Other Features::              Other Features of @command{awk}.
* When::                        When to use @command{gawk} and when to use
                                other things.
* Intro Summary::               Summary of the introduction.
@end menu

@node Running gawk
@section å¦‚ä½•æ‰§è¡Œ @command{awk} ç¨‹åº 

@cindex @command{awk} programs, running
æœ‰å‡ ç§æ–¹å¼æ‰§è¡Œ @command{awk} ç¨‹åºã€‚å¦‚æœç¨‹åºå¾ˆçŸ­ï¼Œæœ€å¥½çš„æ–¹å¼ç›´æ¥åŒ…å«åœ¨ç¨‹åºçš„æ‰§è¡Œå‘½ä»¤è¡Œä¸­ï¼Œå¦‚ä¸‹ï¼š

@example
awk '@var{program}' @var{input-file1} @var{input-file2} @dots{}
@end example

@cindex command line, formats
å½“ç¨‹åºæ¯”è¾ƒé•¿ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯å°†å…¶æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œï¼š

@example
awk -f @var{program-file} @var{input-file1} @var{input-file2} @dots{}
@end example

åœ¨æœ¬@value{SECTION}ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼Œä½†æ˜¯æ¯ç§æ–¹å¼éƒ½æœ‰ä¸€äº›å˜åŒ–ã€‚

@menu
* One-shot::                    è¿è¡Œä¸€æ¬¡æ€§ @command{awk} ç¨‹åºã€‚
* Read Terminal::               Using no input files (input from the keyboard
                                instead).
* Long::                        Putting permanent @command{awk} programs in
                                files.
* Executable Scripts::          Making self-contained @command{awk} programs.
* Comments::                    Adding documentation to @command{gawk}
                                programs.
* Quoting::                     More discussion of shell quoting issues.
@end menu

@node One-shot
@subsection ä¸€æ¬¡æ€§ @command{awk} ç¨‹åº

ä¸€æ—¦ä½ ç†Ÿæ‚‰äº† @command{awk}ï¼Œä½ å°±å¯ä»¥åœ¨ä½¿ç”¨æ—¶ç«‹å³è¾“å…¥ä¸€äº›ç®€å•çš„ç¨‹åºã€‚
ä½ å¯ä»¥æŠŠç¨‹åºä½œä¸º @command{awk} å‘½ä»¤è¡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåƒè¿™æ ·ï¼š

@example
awk '@var{program}' @var{input-file1} @var{input-file2} @dots{}
@end example

@noindent
è¿™ä¸ª@var{ç¨‹åº}åŒ…æ‹¬ä¸€ç³»åˆ—çš„æ¨¡å¼ä¸åŠ¨ä½œï¼Œæ­£å¦‚æ—©äº›æ—¶å€™æ‰€æè¿°çš„é‚£æ ·ã€‚

@cindex single quote (@code{'})
@cindex @code{'} (single quote)
è¿™ç§å‘½ä»¤æ ¼å¼å‘Šè¯‰ @dfn{Shell}ï¼Œæˆ–è€…å‘½ä»¤è¡Œè§£é‡Šå™¨ï¼Œå¼€å¯ @command{awk}ï¼Œå¹¶ç”¨å…¶ä¸­çš„@var{ç¨‹åº}æ¥å¤„ç†è¾“å…¥æ–‡ä»¶ã€‚
@var{ç¨‹åº}æ˜¯ç”±å•å¼•å·å¼•èµ·æ¥çš„ï¼Œå› æ­¤ Shell ä¸ä¼šå°† @command{awk} ä¸­çš„ç‰¹æ®Šå­—ç¬¦è§£ææˆ Shell çš„å­—ç¬¦ã€‚
å•å¼•å·ä¹Ÿä½¿ç”¨ Shell å°†æ‰€æœ‰çš„@var{ç¨‹åº}éƒ½ä½œä¸ºå•ç‹¬çš„ @command{awk} éƒ¨åˆ†ï¼Œå¯ä»¥è®©@var{ç¨‹åº}å¤šäºä¸€è¡Œã€‚

@cindex shells, scripts
@cindex @command{awk} programs, running, from shell scripts
è¿™æ ·çš„æ–¹å¼ç”¨æ¥æ‰§è¡ŒçŸ­çš„æˆ–è€…ä¸­ç­‰å¤§å°çš„ @command{awk} ç¨‹åºæ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå› ä¸ºå®ƒé¿å…äº†è¦ç”¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æ¥å†™ @command{awk} ç¨‹åºã€‚
è‡ªåŒ…å«çš„ Shell è„šæœ¬æ›´åŠ å¯é ï¼Œè¿™æ ·å°±ä¸ä¼šè·Ÿå…¶ä»–çš„æ–‡ä»¶å¼„æ··æ·†ã€‚

åœ¨æœ¬ç« çš„åé¢éƒ¨åˆ†ï¼Œå³
@ifdocbook
@value{SECTION} 
@end ifdocbook
@ref{Very Simple}ï¼Œæˆ‘ä»¬ä¼šå­¦ä¸€äº›é‚£äº›è‡ªåŒ…å«çš„ç¨‹åºå¾ˆçŸ­çš„ä¾‹å­ã€‚

@node Read Terminal
@subsection ä¸å¸¦è¾“å…¥æ–‡ä»¶è¿è¡Œ @command{awk} 

@cindex standard input
@cindex input, standard
@cindex input files, running @command{awk} without
ä½ ä¹Ÿå¯ä»¥è¿è¡Œ @command{awk} ç¨‹åºï¼Œä¸å¸¦è¾“å…¥æ–‡ä»¶ï¼Œå¦‚æœä½ æ•²å…¥ä¸‹é¢çš„å‘½ä»¤è¡Œï¼š

@example
awk '@var{program}'
@end example

@noindent
@command{awk} ä¼šä½¿@var{ç¨‹åº}å¯¼å‘åˆ°@dfn{æ ‡å‡†è¾“å…¥}ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ åœ¨é”®ç›˜ä¸Šè¾“å…¥çš„ä¸€åˆ‡éƒ½ä¼šæ¥å—ä¸ºè¾“å…¥æ•°æ®ã€‚
è¿™ä¼šä¸€ç›´æŒç»­ï¼Œç›´åˆ°ä½ è¾“å…¥ @kbd{Ctrl-d} æ¥è¡¨ç¤ºâ€œend-of-fileâ€ã€‚
@ifset FOR_PRINT
ï¼ˆåœ¨é POSIX æ“ä½œç³»ç»Ÿä¸­ï¼Œâ€œend-of-fileâ€æœ‰å¯èƒ½ä¸åŒã€‚ï¼‰
@end ifset
@ifclear FOR_PRINT
ï¼ˆåœ¨é POSIX æ“ä½œç³»ç»Ÿä¸­ï¼Œâ€œend-of-fileâ€æœ‰å¯èƒ½ä¸åŒã€‚å¦‚åœ¨ OS/2 ä¸­åˆ™æ˜¯ @kbd{Ctrl-z}ï¼‰
@end ifclear

@cindex files, input, See input files
@cindex input files, running @command{awk} without
@cindex @command{awk} programs, running, without input files
å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œç¨‹åºæ‰“å°ä¸€å°æ®µå»ºè®®ï¼ˆæ¥è‡ªç”± Douglas Adams çš„ @cite{The Hitchhiker's Guide to the Galaxy}ï¼‰ï¼Œä½¿ä½ æ¶ˆé™¤è®¡ç®—æœºç¨‹åºå¤æ‚æ€§çš„å¿§è™‘ï¼š

@example
$ @kbd{awk 'BEGIN @{ print "Don\47t Panic!" @}'}
@print{} Don't Panic!
@end example

@command{awk} åœ¨è¯»å…¥ä»»ä½•è¾“å…¥ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œä¸ @code{BEGIN} ç›¸å…³çš„è¯­å¥ã€‚
å¦‚æœç¨‹åºä¸­æ²¡æœ‰äº†å…¶ä»–çš„ä»£ç äº†ï¼Œåƒè¿™ä¸ªä¾‹å­ä¸­çš„æƒ…å†µä¸€æ ·ï¼Œ@command{awk} å°±ç›´æ¥ç»“æŸï¼Œè€Œä¸æ˜¯è¯•å›¾è¯»å–è‡ªå·±ä¸çŸ¥é“å¦‚ä½•å¤„ç†çš„è¾“å…¥ã€‚
@samp{\47} æ˜¯ä¸€ä¸ªå°æŠ€å·§ï¼ˆåé¢ä¼šè§£é‡Šï¼‰æ¥å°†å•å¼•å·å¼•å…¥ç¨‹åºï¼Œè¿™æ ·å°±ä¸ç”¨ä½¿ç”¨ Shell ä¸‘é™‹çš„å¼•æ–‡ä¼ä¿©ã€‚

@quotation æç¤º
å¦‚æœä½ ä½¿ç”¨ Bashï¼Œä½ éœ€è¦å…ˆæ‰§è¡Œå‘½ä»¤ @samp{set +H}ï¼Œç„¶åå†æ‰§è¡Œè¿™ä¸ªäº¤äº’å¼çš„å‘½ä»¤ï¼Œä»¥ç¦ç”¨ C shell å¼çš„å‘½ä»¤å†å²ï¼Œ
åœ¨è¿™ç§æ–¹å¼ä¸‹ @samp{!} ä¼šè¢«å½“ä½œç‰¹æ®Šå­—ç¬¦ã€‚æˆ‘ä»¬å»ºè®®ä½ å°†è¿™ä¸ªå‘½ä»¤æ”¾åœ¨ä½ ç”¨æˆ·çš„å¯åŠ¨æ–‡ä»¶ä¸­ã€‚@footnote{å¦‚åœ¨ Linux ç³»ç»Ÿä¸­ç”¨æˆ·ç›®å½•ä¸‹çš„ .profile ç­‰æ–‡ä»¶ä¸­ã€‚â€”â€”è¯‘è€…æ³¨} 
@end quotation

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•æ¨¡æ‹Ÿ @command{cat} å·¥å…·çš„ @command{awk} ç¨‹åºï¼›å®ƒå¤åˆ¶ä½ è¾“å…¥çš„å­—ç¬¦ï¼Œç„¶åè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºä¸Šï¼ˆä¸ºä»€ä¹ˆè¿™ä¸ªå¯ä»¥åšå¾—åˆ°ç­‰ä¼šè§£é‡Šï¼‰ï¼š

@example
$ @kbd{awk '@{ print @}'}
@kbd{Now is the time for all good men}
@print{} Now is the time for all good men
@kbd{to come to the aid of their country.}
@print{} to come to the aid of their country.
@kbd{Four score and seven years ago, ...}
@print{} Four score and seven years ago, ...
@kbd{What, me worry?}
@print{} What, me worry?
@kbd{Ctrl-d}
@end example

@node Long
@subsection è¿è¡Œé•¿ç¨‹åº

@cindex @command{awk} programs, running
@cindex @command{awk} programs, lengthy
@cindex files, @command{awk} programs in
æœ‰æ—¶ï¼Œ@command{awk} ç¨‹åºéå¸¸é•¿ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ›´æ–¹ä¾¿çš„æ–¹æ³•æ˜¯å°†ç¨‹åºæ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ã€‚
ä¸ºäº†å‘Šè¯‰ @command{awk} æ‰§è¡ŒæŸä¸ªæ–‡ä»¶ä¸­çš„ç¨‹åºï¼Œä½ æ•²å…¥ï¼š

@example
awk -f @var{source-file} @var{input-file1} @var{input-file2} @dots{}
@end example

@cindex @option{-f} option
@cindex command line, option @option{-f}
@option{-f} å‚æ•°æŒ‡ç¤º @command{awk} å·¥å…·ä» @var{source-file} ä¸­è¯»å–ç¨‹åºï¼ˆ@pxref{Options}ï¼‰ã€‚
ä»»ä½•çš„@value{FN}éƒ½å¯ä»¥ä½œä¸º@var{source-file}ã€‚å¦‚ä½ å¯ä»¥è¾“å…¥ä¸‹é¢å‘½ä»¤è¡Œï¼š

@example
BEGIN @{ print "Don't Panic!" @}
@end example

@noindent
åˆ°æ–‡ä»¶ @file{advice} ä¸­ï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¡Œï¼š

@example
awk -f advice
@end example

@noindent
ä¸‹é¢çš„ä»£ç åšä¸€æ ·çš„äº‹æƒ…ï¼š

@example
awk 'BEGIN @{ print "Don\47t Panic!" @}'
@end example

@cindex quoting in @command{gawk} command lines
@noindent
è¿™ä¸ªå·²ç»æ—©è§£é‡Šè¿‡ï¼ˆ@pxref{Read Terminal}ï¼‰ã€‚
æ³¨æ„ï¼Œå½“ä½ ç”¨ @option{-f} å‚æ•°æŒ‡å®š@value{FN}æ—¶ï¼Œä½ ä¸éœ€è¦æŠŠ@value{FN}å¼•èµ·æ¥ï¼Œå› ä¸ºå¤§å¤šæ•°@value{FN}éƒ½ä¸ä¼šå« Shell ç‰¹æ®Šå­—ç¬¦ã€‚
åœ¨æ–‡ä»¶ @file{advice} ä¸­ï¼Œ@command{awk} ç¨‹åºå¹¶æ²¡æœ‰æŠŠæ–‡ä»¶å†…å®¹ç»™å¼•èµ·æ¥ã€‚å¼•å·åªåœ¨å‘½ä»¤è¡Œä¸Šè¾“å…¥ç¨‹åºæ‰éœ€è¦ã€‚ï¼ˆå½“ç„¶ï¼ŒæŠŠç¨‹åºä»£ç æ”¾å…¥æ–‡ä»¶ä¸­ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å¼•å·ï¼ˆâ€˜â€™ï¼‰ï¼Œè€Œä¸éœ€è¦åƒ @samp{\47} è¿™æ ·çš„è¿›è¡Œè¾“å…¥ã€‚

@cindex single quote (@code{'}) in @command{gawk} command lines
@cindex @code{'} (single quote) in @command{gawk} command lines
å¦‚æœä½ æƒ³æ¸…æ¥šåœ°æ ‡è¯†è¿™æ ·çš„ @command{awk} ç¨‹åºï¼Œä½ å¯ä»¥ç»™@value{FN}åŠ ä¸Šæ‰©å±•å @file{.awk} ã€‚
è¿™ä¸ä¼šå½±å“ @command{awk} ç¨‹åºçš„æ‰§è¡Œï¼Œä½†ç¡®å®ä½¿â€œå®¶åŠ¡äº‹â€å®¹æ˜“äº†è®¸å¤šã€‚

@node Executable Scripts
@subsection å¯æ‰§è¡Œçš„ @command{awk} ç¨‹åº
@cindex @command{awk} programs
@cindex @code{#} (number sign), @code{#!} (executable scripts)
@cindex Unix, @command{awk} scripts and
@cindex number sign (@code{#}), @code{#!} (executable scripts)

å¦‚æœä½ å­¦è¿‡ @command{awk}ï¼Œä½ å¯èƒ½å°±ä¼šæƒ³ç”¨ @samp{#!} è¿™æ ·çš„æœºåˆ¶å†™ä¸€ä¸ªè‡ªåŒ…å«çš„ @command{awk} è„šæœ¬ã€‚
åœ¨å¾ˆå¤šç³»ç»Ÿ@footnote{@samp{#!} è¿™æ ·çš„æœºåˆ¶å¯ä»¥åœ¨GNU/Linuxï¼ŒåŸºäº BSD çš„ç³»ç»Ÿä»¥åŠ Unix ç³»ç»Ÿä¸Šä½¿ç”¨ã€‚}
ä¸Šä½ éƒ½å¯ä»¥è¿™ä¹ˆå¹²ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŠŠadviceæ–‡ä»¶å†™æˆè¿™æ ·ï¼š

@example
#! /bin/awk -f

BEGIN @{ print "Don't Panic!" @}
@end example

@noindent
æŠŠè¿™ä¸ªæ–‡ä»¶è®¾ç½®æˆå¯æ‰§è¡Œæƒé™ï¼ˆç”¨ @command{chmod} å·¥å…·ï¼‰ï¼Œåœ¨ Shell ä¸­ç®€å•åœ°è¾“å…¥ @samp{advice}ï¼Œ
ç³»ç»Ÿå°±ä¼šå°† @command{awk} æ‰§è¡Œæˆåƒä½ è¾“å…¥äº† @samp{awk -f advice} ä¸€æ ·ï¼š

@example
$ @kbd{chmod +x advice}
$ @kbd{advice}
@print{} Don't Panic!
@end example

@noindent
ï¼ˆæˆ‘ä»¬å‡è®¾ä½ å·²ç»å°†ä½ çš„å½“å‰ç›®å½•æ”¾åœ¨äº†ä½ çš„ Shell çš„æœç´¢è·¯å¾„å˜é‡ä¸‹ã€ä¸€èˆ¬ä¸º @code{$PATH}ã€‘ã€‚
å¦‚æœæ²¡æœ‰è¿™ä¹ˆåšï¼Œä½ æ•²å…¥ @samp{./advice} å°±å¯ä»¥äº†ã€‚ï¼‰

è‡ªåŒ…å«çš„ @command{awk} è„šæœ¬åœ¨ç”¨æˆ·è°ƒç”¨è„šæœ¬ä½†ä¸éœ€è¦çŸ¥é“ç¨‹åºæ˜¯ç”¨ @command{awk} å®ç°æ—¶éå¸¸æœ‰ç”¨ã€‚

@sidebar ç†è§£ @samp{#!}
@cindex portability, @code{#!} (executable scripts)

@command{awk} æ˜¯ä¸€ä¸ª@dfn{è§£é‡Šå‹}è¯­è¨€ã€‚è¿™è¡¨ç¤ºï¼Œ@command{awk} å·¥å…·æŠŠä½ çš„ç¨‹åºè¯»å…¥åï¼Œä¼šæ ¹æ®ä½ ç¨‹åºä¸­çš„æŒ‡ä»¤æ¥å¤„ç†ä½ çš„æ•°æ®ã€‚
ï¼ˆè¿™ä¸åŒäº C è¿™æ ·çš„@dfn{ç¼–è¯‘å‹}è¯­è¨€ï¼Œé¦–å…ˆä½ éœ€è¦å°†å®ƒä»¬ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼Œè¿™äº›ä»£ç å¯ä»¥ç›´æ¥è¢«ä½ ç³»ç»Ÿçš„å¤„ç†å™¨æ‰§è¡Œã€‚ï¼‰
@command{awk} å·¥å…·å› æ­¤è¢«ç§°ä¸º@dfn{è§£é‡Šå™¨ï¼ˆinterpreterï¼‰}ã€‚å¤šæ•°çš„ç°ä»£è¯­è¨€éƒ½æ˜¯è§£é‡Šæ‰§è¡Œçš„ã€‚

ä»¥ @samp{#!} å¼€å§‹çš„è¡Œåˆ—å‡ºäº†è¦æ‰§è¡Œçš„è§£é‡Šå™¨æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå•ä¸€çš„å¯é€‰å‘½ä»¤è¡Œå‚æ•°è¦ä¼ é€’ç»™å¯¹åº”çš„è§£é‡Šå™¨ã€‚
æ“ä½œç³»ç»Ÿç„¶åç”¨ç»™å®šçš„å‚æ•°æ‰§è¡Œè§£é‡Šå™¨ä»¥åŠæ‰€æœ‰çš„å‚æ•°åˆ—è¡¨æ‰§è¡Œè¢«æ‰§è¡Œçš„ç¨‹åºã€‚
ç¬¬ä¸€ä¸ªå‚æ•°å³æ˜¯ @command{awk} ç¨‹åºçš„å®Œæ•´è·¯å¾„ã€‚
å…¶ä»–çš„å‚æ•°ï¼Œè¦ä¹ˆæ˜¯ @command{awk} çš„å‚æ•°ï¼Œè¦ä¹ˆæ˜¯@value{DF}ï¼Œæˆ–è€…äºŒè€…å…¼æœ‰ã€‚
ï¼ˆæ³¨æ„ï¼Œåœ¨å¾ˆå¤šçš„ç³»ç»Ÿä¸Šï¼Œ@command{awk} ä¼šåœ¨ @file{/usr/bin} ç›®å½•ä¸‹æ‰¾åˆ°ï¼Œè€Œä¸æ˜¯åœ¨ @file{/bin} ç›®å½•ä¸‹ã€‚ï¼‰

æœ‰çš„ç³»ç»Ÿä¼šå°†è§£é‡Šå™¨çš„é•¿åº¦é™åˆ¶åœ¨ 32 ä¸ªå­—ç¬¦ã€‚ä½†è¿™ç§æƒ…å†µç”¨è½¯è¿æ¥å°±å¯ä»¥è§£å†³ã€‚

åœ¨ @samp{#!} è¡Œï¼Œä½ åœ¨ @command{awk} çš„è·¯å¾„åé¢æœ€å¥½ä¸å¥½æ”¾è¶…ä¸€ä¸ªå‚æ•°ã€‚
è¿™ä¸ä¼šæœ‰ä½œç”¨ã€‚æ“ä½œç³»ç»Ÿä¼šå°†é‚£ä¸€è¡Œå‰©ä¸‹çš„å†…å®¹å½“ä½œä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¼ é€’ç»™ @command{awk}ã€‚
è¿™ä¼šå¯¼è‡´ä¸€äº›ä»¤äººç–‘æƒ‘çš„è¡Œä¸ºâ€”â€”å¤šæ•°åƒæ˜¯ @command{awk} ä½¿ç”¨æ–¹æ³•çš„ä¸€äº›è¯Šæ–­ä¿¡æ¯ã€‚

@cindex @code{ARGC}/@code{ARGV} variables, portability and
@cindex portability, @code{ARGV} variable
æœ€åï¼Œ@code{ARGV[0]} å‚æ•°çš„å€¼ï¼ˆ@pxref{Built-in Variables}ï¼‰ä¼šæ ¹æ®ç³»ç»Ÿçš„åŒè€Œä¸åŒã€‚
æœ‰çš„ç³»ç»Ÿä¼šæŠŠ @samp{awk} ä½œä¸ºå®ƒçš„å€¼ï¼Œè€Œæœ‰çš„ä¼šå°† @command{awk} çš„å®Œæ•´è·¯å¾„èµ‹å€¼ç»™å®ƒï¼ˆå¦‚ @file{/bin/awk}ï¼‰ã€‚
æœ‰ä¸€äº›ä¼šå°†è„šæœ¬çš„æ–‡ä»¶åï¼ˆ@samp{advice}ï¼‰èµ‹ç»™å®ƒã€‚
æ‰€ä»¥ï¼Œä¸è¦ä¾èµ–äº @code{ARGV[0]} çš„å€¼æ¥æä¾›ç»™ä½ çš„è„šæœ¬ä½¿ç”¨ã€‚
@end sidebar

@node Comments
@subsection @command{awk} ç¨‹åºä¸­çš„æ³¨é‡Š
@cindex @code{#} (number sign), commenting
@cindex number sign (@code{#}), commenting
@cindex commenting
@cindex @command{awk} programs, documenting

@dfn{æ³¨é‡Š}ï¼Œå°±æ˜¯ç¨‹åºä¸­ç»™äººè¯»çš„æ–‡æœ¬ï¼›å®ƒä¸æ˜¯å¯æ‰§è¡Œç¨‹åºçš„ä¸€éƒ¨ä»½ã€‚æ³¨é‡Šå¯ä»¥è§£é‡Šç¨‹åºæ˜¯åšä»€ä¹ˆçš„ï¼Œä»¥åŠå¦‚ä½•åšçš„ã€‚å‡ ä¹æ‰€æœ‰çš„ç¨‹åºè¯­è¨€éƒ½ä¼šæä¾›æ³¨é‡Šï¼Œå› ä¸ºç¨‹åºå¦‚æœæ²¡æœ‰å®ƒä»¬æ˜¯éå¸¸äºéš¾ç†è§£çš„ã€‚

åœ¨ @command{awk} è¯­è¨€ä¸­ï¼Œæ³¨é‡Šä»¥ @samp{#} å¼€å¤´ç„¶åæŒç»­åˆ°ä¸€è¡Œçš„ç»“æŸã€‚ @samp{#} ä¸ä¸€å®šè¦æ˜¯ä¸€è¡Œçš„å¼€å§‹å­—ç¬¦ã€‚
@command{awk} ä¼šå¿½ç•¥æ•°å­—ç¬¦å· @samp{#} åé¢çš„å†…å®¹ã€‚å¦‚æˆ‘ä»¬å·²ç»åœ¨ @file{advice} ä¸­è¾“å…¥äº†ä¸‹é¢çš„å†…å®¹ï¼š

@example
# This program prints a nice, friendly message.  It helps
# keep novice users from being afraid of the computer.
BEGIN    @{ print "Don't Panic!" @}
@end example

ä½ å¯ä»¥å°†æ³¨é‡Šä¹Ÿå¸¦è¿›å‘½ä»¤è¡Œä¸­çš„â€œç”¨åå³æ‰”â€@command{awk} ç¨‹åºä¸­ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è®²ï¼Œè¿™ä¸ªç”¨å¤„ä¸å¤§ï¼›æ³¨é‡Šçš„ç›®çš„æ˜¯å¸®ä½ æˆ–è€…å…¶ä»–äººåé¢é˜…è¯»æ—¶ç†è§£ç¨‹åºã€‚

@cindex quoting, for small awk programs
@cindex single quote (@code{'}), vs.@: apostrophe
@cindex @code{'} (single quote), vs.@: apostrophe
@quotation æ³¨æ„
@ref{One-shot}ï¼Œæ‰€æåˆ°çš„ï¼Œä½ å¯ä»¥å°†ä¸€ä¸ªä¸­ç­‰å¤§å°çš„ç¨‹åºç”¨å•å¼•å·å¼•èµ·æ¥ã€‚è¿™æ ·å°±ä½¿å¾—ä½ çš„ Shell è„šæœ¬æ˜¯è‡ªåŒ…å«çš„äº†ã€‚
ä½ è¿™ä¹ˆåšçš„æ—¶å€™ï¼Œä½ @emph{ä¸è¦}å°†æ’‡å·ï¼ˆâ€™ï¼‰æ”¾åˆ°ä½ çš„æ³¨é‡Šä¸­ï¼ˆæˆ–è€…ä½ çš„ç¨‹åºçš„ä»»ä½•ä½ç½®ï¼‰ã€‚Shell ä¼šå°†é—­å¼•å·å½“åšæ•´ä¸ªç¨‹åºçš„ç»“æŸã€‚ç»“æœå°±æ˜¯ï¼ŒShell ä¼šæ‰“å°å‡ºå¼•å·ä¸åŒ¹é…çš„é”™è¯¯ï¼Œè€Œå¦‚æœ @command{awk} å®é™…æ˜¯æ‰§è¡Œäº†ï¼Œä¹Ÿä¼šæ‰“å°å‡ºè¯­æ³•é”™è¯¯ç­‰å¥‡æ€ªçš„ä¿¡æ¯ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼š

@example
$ @kbd{awk 'BEGIN @{ print "hello" @} # let's be cute'}
>
@end example

Shell é¦–å…ˆçœ‹åˆ°å‰é¢ä¸¤ä¸ªå¼•å·åŒ¹é…ï¼Œç„¶ååœ¨åé¢çš„æ³¨é‡Šåˆçœ‹åˆ°äº†ä¸€ä¸ªå¼€å§‹çš„å¼•å·ã€‚
å› æ­¤å°±æœ‰ç¬¬äºŒä¸ªæç¤ºï¼Œå¹¶ç­‰å¾…è¾“å…¥ã€‚å¯¹äº Unix @command{awk}ï¼Œé—­å¼•å·ä¸²ä¼šäº§ç”Ÿè¿™æ ·çš„ç»“æœï¼š

@example
$ @kbd{awk '@{ print "hello" @} # let's be cute'}
> @kbd{'}
@error{} awk: can't open file be
@error{}  source line number 1
@end example

@cindex @code{\} (backslash)
@cindex backslash (@code{\})
åœ¨ @samp{let's} ä¸­çš„æ’‡å·å‰é¢åŠ ä¸€ä¸ªè½¬ä¹‰ç¬¦ï¼ˆ\ï¼‰ä¹Ÿæ²¡æœ‰ä½œç”¨ï¼Œå› ä¸ºè½¬ä¹‰ç¬¦åœ¨å•å¼•å·ä¸­ä¹Ÿä¸æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ã€‚
ä¸‹ä¸€ä¸ª@value{SUBSECTION}ä¸­æˆ‘ä»¬ä¼šè§£é‡Š Shell çš„å¼•å·è§„åˆ™ã€‚
@end quotation

@node Quoting
@subsection Shell å¼•å·é—®é¢˜
@cindex shell quoting, rules for

@menu
* DOS Quoting::                 Quoting in Windows Batch Files.
@end menu

å¯¹äºçŸ­åˆ°ä¸­ç­‰å¤§å°çš„ @command{awk} ç¨‹åºè€Œè¨€ï¼Œæœ€æ–¹ä¾¿çš„æ–¹å¼æ˜¯å°†ç¨‹åºåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ã€‚
è¿™ä¸ªé€šè¿‡å°†æ•´ä¸ªç¨‹åºåŒ…å«åœ¨ä¸€å¯¹å•å¼•å·å½“ä¸­å³å¯ã€‚æ— è®ºåœ¨äº¤äº’å¼çš„è¾“å…¥ç¨‹åºï¼Œè¿˜æ˜¯åœ¨ä¸€ä¸ªå¤§çš„ Shell è„šæœ¬ä¸­è¾“å…¥éƒ½æ˜¯å¯ä»¥çš„ï¼š

@example
awk '@var{program text}' @var{input-file1} @var{input-file2} @dots{}
@end example

@cindex shells, quoting, rules for
@cindex Bourne shell, quoting rules for
ä¸€æ—¦ä½ é€šè¿‡ Shell æ¥è¿è¡Œï¼Œå¯¹äº Shell çš„å¼•å·è§„åˆ™æœ‰æ‰€äº†è§£æ€»æ˜¯å¥½çš„ã€‚
ä¸‹é¢çš„è§„åˆ™åªåº”ç”¨äº POSIX å…¼å®¹çš„ Bourne å¼çš„ Shell ä¸­ï¼ˆå¦‚ Bashï¼ŒGNU Bourne-Again Shellï¼‰ã€‚å¦‚æœä½ ç”¨çš„æ˜¯ C Shellï¼Œé‚£å°±éœ€è¦ä½ è‡ªå¤„äº†ã€‚

åœ¨æ·±å…¥è§„åˆ™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»æœ¬@value{DOCUMENT}ä¸­é€šç¯‡æ‰€ä½¿ç”¨çš„æ¦‚å¿µï¼Œå®ƒä»¬å°±æ˜¯ @dfn{null}ï¼Œæˆ–è€… empty ä¸²ã€‚

null string å°±æ˜¯åœ¨å­—ç¬¦æ•°æ®ä¸­æ²¡æœ‰å€¼ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç©ºçš„ã€‚åœ¨ @command{awk} ç¨‹åºä¸­å†™æˆè¿™æ ·ï¼š@code{""}ã€‚
åœ¨ Shell ä¸­ï¼Œå®ƒå¯ä»¥å†™æˆå•æˆ–è€…åŒå¼•å·çš„å½¢å¼ï¼š@code{""} æˆ–è€… @code{''}ã€‚è™½è¯´ null string ä¸­æ²¡æœ‰å­—ç¬¦ï¼Œä½†æ˜¯ç¡®å®æ˜¯å­˜åœ¨çš„ã€‚
ä¾‹å¦‚ä¸‹é¢çš„æŒ‡ä»¤ï¼š

@example
$ @kbd{echo ""}
@end example

@noindent
åœ¨è¿™é‡Œï¼Œ@command{echo} å·¥å…·æ”¶åˆ°å•ä¸€çš„å‚æ•°ï¼Œå°±ç®—å‚æ•°ä¸­æ²¡æœ‰å­—ç¬¦åœ¨å…¶ä¸­ã€‚
åœ¨æœ¬@value{DOCUMENT}çš„åç»­éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ¯è¯­ @dfn{null string} ä»¥åŠ @dfn{empty string} æ¥è¡¨ç¤ºè¿™æ ·çš„ä¸²ã€‚ç°åœ¨åœ¨å¼•å·è§„åˆ™ä¸­ï¼š

@itemize @value{BULLET}
@item
è¢«å¼•èµ·æ¥çš„é¡¹å¯ä»¥ä¸æ²¡æœ‰è¢«å¼•èµ·æ¥é¡¹è¿æ¥ï¼Œä¹Ÿå¯ä»¥ä¸å·²ç»å¼•èµ·æ¥çš„é¡¹è¿›è¡Œè¿æ¥ã€‚Shell ä¼šå°†å®ƒä»¬å…¨éƒ¨è½¬æ¢æˆå‘½ä»¤çš„å‚æ•°ã€‚

@item
åœ¨å¼•èµ·æ¥çš„ä¸²ä¸­ï¼Œåœ¨ä»»ä½•å•ä¸ªå­—ç¬¦å‰çš„åæ–œæ ï¼ˆ@samp{\}ï¼‰éƒ½ä¼šè¢« Shell ç§»é™¤ï¼Œè€Œå°†è¢«å¼•èµ·æ¥çš„å­—ç¬¦ä¼ é€’ç»™å‘½ä»¤ã€‚

@item
@cindex @code{\} (backslash), in shell commands
@cindex backslash (@code{\}), in shell commands
@cindex single quote (@code{'}), in shell commands
@cindex @code{'} (single quote), in shell commands
å•å¼•å·ä¿æŠ¤åœ¨å¼€ä¸é—­å¼•å·ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦ã€‚Shell ä¸ä¼šå¯¹ä¸²ä¸­çš„ä¸œè¥¿åšä»»ä½•è§£æï¼Œå¹¶åŸæ ·åœ°ä¼ é€’ç»™å‘½ä»¤ã€‚@emph{ä¸å¯èƒ½}åœ¨ä¸€ä¸ªå•å¼•å·ä¸­åµŒå…¥å•å¼•å·ã€‚
å‚è€ƒ @ref{Comments} ä¸­çš„ä¾‹å­ï¼Œçœ‹çœ‹å¦‚æœä½ è¿™ä¹ˆåšä¼šæœ‰ä»€ä¹ˆç»“æœã€‚

@item
@cindex double quote (@code{"}), in shell commands
@cindex @code{"} (double quote), in shell commands
åŒå¼•å·ä¿æŠ¤å¼€å¼•å·ä¸é—­å¼•å·ä¹‹é—´çš„å¤§å¤šæ•°æ®å­—ä¸²ã€‚Shell åªåšæœ€å°çš„å˜é‡ä¸å‘½ä»¤çš„æ›¿æ¢ã€‚ä¸åŒçš„ Shell å¯¹äºåŒå¼•å·çš„å¤„ç†æ˜¯ä¸ä¸€æ ·çš„ã€‚

ç”±äºåœ¨åŒå¼•å·ä¸­ï¼Œç‰¹å®šçš„å­—ç¬¦æ˜¯ä¼šè¢« Shell å¤„ç†çš„ï¼Œå› æ­¤ä»–ä»¬åœ¨ä¸²ä¸­ä¸€å®šè¦è¿›è¡Œ@dfn{è½¬ä¹‰}ã€‚
è¦æ³¨æ„è¿™äº›ç¬¦å·@samp{$}ï¼Œ@samp{`}ï¼Œ@samp{\} å’Œ @samp{"}ã€‚è¿™äº›ç¬¦å·å¦‚æœè¦åŸæ ·åœ°ä¼ é€’ç»™ç¨‹åºä¸­ï¼Œä½ å°±éœ€è¦åœ¨ä¸²ä¸­ç”¨åæ–œæ ï¼ˆ@samp{\} ï¼‰è¿›è¡Œè½¬ä¹‰ã€‚
ï¼ˆå‰å¯¼çš„åæ–œæ ï¼ˆ@samp{\}ï¼‰ä¼šå…ˆè¢«è¿‡æ»¤æ‰ã€‚ï¼‰
ä½ å¯ä»¥å‚è€ƒ
@ifnotinfo
ä¹‹å‰çš„
@end ifnotinfo
åœ¨ @ref{Read Terminal} ä¸­çš„ä¾‹å­ï¼š

@example
awk 'BEGIN @{ print "Don\47t Panic!" @}'
@end example

@noindent
å¯ä»¥å†™æˆè¿™æ ·çš„å½¢å¼ï¼š

@example
$ @kbd{awk "BEGIN @{ print \"Don't Panic!\" @}"}
@print{} Don't Panic!
@end example

@cindex single quote (@code{'}), with double quotes
@cindex @code{'} (single quote), with double quotes
æ³¨æ„åœ¨åŒå¼•å·ä¸­çš„å•å¼•å·ä¸æ˜¯ç‰¹æ®Šç¬¦å·ã€‚

@item
ç©ºä¸²ï¼ˆNull stringï¼‰å¦‚æœå‡ºç°åœ¨éç©ºä¸²ä¸­æ—¶ï¼Œä¼šè¢«ç§»é™¤ï¼Œè€Œæ˜¾å¼çš„ç©ºä¸²ä¼šè¢«ä¿ç•™ã€‚ä¾‹å¦‚ï¼šå¯ä»¥å°†åŸŸåˆ†éš”ç¬¦ @code{FS} æŒ‡å®šä¸ºç©ºä¸²ï¼ˆnull stringï¼‰ï¼Œå¯ä»¥è¿™ä¹ˆæ¥ï¼š

@example
awk -F "" '@var{program}' @var{files} # correct
@end example

@noindent
@cindex null strings in @command{gawk} arguments, quoting and
è€Œä¸è¦è¿™ä¹ˆæ¥ï¼š

@example
awk -F"" '@var{program}' @var{files}  # wrong!
@end example

@noindent
åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œ@command{awk} ä¼šå°è¯•ä½¿ç”¨ç¨‹åºçš„æ–‡æœ¬ä½œä¸º @code{FS} çš„å€¼ï¼Œç¬¬ä¸€ä¸ª@value{FN}ä¼šåšä¸ºç¨‹åºçš„æ–‡æœ¬ï¼
è¿™ä¼šå¯¼è‡´åœ¨æœ€å¥½çš„æƒ…å†µä¸‹æ˜¯è¯­æ³•é”™è¯¯ï¼Œè€Œæœ€åçš„æƒ…å†µä¸‹ä¼šå¯¼è‡´ä»¤äººè´¹è§£çš„è¡Œä¸ºã€‚
@end itemize

@cindex quoting in @command{gawk} command lines, tricks for
æ··ç”¨å•åŒå¼•å·æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚ä½ éœ€è¦ç”¨ä¸€äº› Shell çš„ä¼ä¿©ï¼Œå¦‚ï¼š

@example
$ @kbd{awk 'BEGIN @{ print "Here is a single quote <'"'"'>" @}'}
@print{} Here is a single quote <'>
@end example

@noindent
è¿™ä¸ªç¨‹åºä¸­åŒ…æ‹¬ä¸‰ä¸ªè¿æ¥çš„å¼•ä¸²ã€‚ç¬¬ä¸€ä¸ªä¸ç¬¬ä¸‰ä¸ªéƒ½æ˜¯å•å¼•å·ä¸²ï¼Œè€Œç¬¬äºŒä¸ªæ˜¯åŒå¼•å·ä¸²ã€‚

è¿™ä¸ªå…¶å®å¯ä»¥ç®€åŒ–ä¸ºï¼š

@example
$ @kbd{awk 'BEGIN @{ print "Here is a single quote <'\''>" @}'}
@print{} Here is a single quote <'>
@end example

@noindent
è¿™ä¸ªå¾—è¦ä½ è‡ªå·±çœ‹å“ªä¸ªæ›´å¥½è¯»ã€‚

å¦ä¸€ä¸ªä½¿ç”¨åŒå¼•å·çš„é€‰æ‹©ï¼Œå°±æ˜¯è½¬æ¢å†…åµŒçš„ï¼Œ@command{awk} å±‚çš„åŒå¼•å·ã€‚

@example
$ @kbd{awk "BEGIN @{ print \"Here is a single quote <'>\" @}"}
@print{} Here is a single quote <'>
@end example

@noindent
è¿™ç§é€‰æ‹©ä¼šéå¸¸ç—›è‹¦ï¼Œå› ä¸ºåŒå¼•å·ï¼Œåæ–œæ ï¼ˆ@samp{\}ï¼‰ä»¥åŠç¾å…ƒç¬¦å·ï¼ˆ@samp{$}ï¼‰åœ¨é«˜çº§çš„ @command{awk} ç¨‹åºä¸­æ˜¯å¾ˆæ™®éçš„ã€‚

ç¬¬ä¸‰ä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨è½¬ä¹‰çš„å•åŒå¼•å·å­—ç¬¦çš„å¯¹åº”ç çš„å…«è¿›åˆ¶åºåˆ—ï¼ˆ@pxref{Escape Sequences}ï¼‰ï¼Œå¦‚ä¸‹ï¼š

@example
$ @kbd{awk 'BEGIN @{ print "Here is a single quote <\47>" @}'}
@print{} Here is a single quote <'>
$ @kbd{awk 'BEGIN @{ print "Here is a double quote <\42>" @}'}
@print{} Here is a double quote <">
@end example

@noindent
è¿™çœ‹èµ·æ¥å°±æ¼‚äº®å¤šäº†ï¼Œä½†æ˜¯ä½ éœ€è¦æ³¨é‡Šå¥½æ‰€è½¬ä¹‰çš„ä¸œè¥¿æ˜¯ä»€ä¹ˆã€‚

ç¬¬å››ä¸ªé€‰æ‹©å°±æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œå¼çš„å˜é‡èµ‹å€¼ï¼Œå¦‚ä¸‹ï¼š

@example
$ @kbd{awk -v sq="'" 'BEGIN @{ print "Here is a single quote <" sq ">" @}'}
@print{} Here is a single quote <'>
@end example

ï¼ˆåœ¨è¿™é‡Œï¼Œä¸¤ä¸ªä¸²å¸¸é‡ä»¥åŠ @code{sq} çš„å€¼ä¼šè¢«è¿æ¥èµ·æ¥æˆä¸ºä¸€ä¸ªå•ä¸€çš„ä¸²ï¼Œç„¶åç”¨ @code{print} æ‰“å°å‡ºæ¥ã€‚ï¼‰

å¦‚æœä½ ç¡®å®åœ¨ç¨‹åºä¸­å³éœ€è¦å•å¼•å·ä¹Ÿéœ€è¦åŒå¼•å·ï¼Œä½ æœ€å¥½æ˜¯å°†å®ƒä»¬ç§»åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚åœ¨æ–‡ä»¶é‡Œï¼ŒShell ä¸ä¼šè§£æä½ çš„ç¨‹åºæ‰€è¦åšçš„äº‹æƒ…ã€‚

@node DOS Quoting
@subsubsection MS-Windows æ‰¹å¤„ç†æ–‡ä»¶ä¸­çš„å¼•å·é—®é¢˜

@ignore
Date: Wed, 21 May 2008 09:58:43 +0200 (CEST)
From: jeroen.brink@inter.NL.net
Subject: (g)awk "contribution"
To: arnold@skeeve.com
Message-id: <42220.193.172.132.34.1211356723.squirrel@webmail.internl.net>

Hello Arnold,

maybe you can help me out. Found your email on the GNU/awk online manual
pages.

I've searched hard to figure out how, on Windows, to print double quotes.
Couldn't find it in the Quotes area, nor on google or elsewhere. Finally i
figured out how to do this myself.

How to print all lines in a file surrounded by double quotes (on Windows):

gawk "{ print \"\042\" $0 \"\042\" }" <file>

Maybe this is a helpfull tip for other (Windows) gawk users. However, i
don't have a clue as to where to "publish" this tip! Do you?

Kind regards,

Jeroen Brink
@end ignore

å°½ç®¡æœ¬@value{DOCUMENT}ä¸­ä¸€èˆ¬åªé’ˆå¯¹ POSIX ç³»ç»Ÿä»¥åŠ POSIX Shellï¼Œä¸‹é¢çš„é—®é¢˜ä¹Ÿå€¼å¾—ä¸ºç”¨æˆ·æå‡ºæ¥ã€‚

@cindex Brink, Jeroen
å¾®è½¯ Windows ç³»ç»Ÿä¸­çš„ Shell ç”¨åŒå¼•å·æ¥å¼•å­—ä¸²ã€‚å› æ­¤ï¼Œæ¯”è¾ƒéš¾æˆ–è€…ä¸å¯èƒ½åœ¨å‘½ä»¤è¡Œè„šæœ¬ä¸­é€šè¿‡è½¬ä¹‰çš„æ–¹å¼æ¥åŒ…å«åŒå¼•å·ã€‚
å¤šè°¢ Jeroen Brink æä¾›ä¸‹é¢çš„ä¾‹å­ï¼Œå‘ˆç°æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œéƒ½å¹¶ç”¨åŒå¼•å·å¼•èµ·æ¥ï¼š

@example
gawk "@{ print \"\042\" $0 \"\042\" @}" @var{file}
@end example


@node Sample Data Files
@section ä¾‹å­ä¸­ä½¿ç”¨çš„@value{DDF}

@cindex input files, examples
@cindex @code{mail-list} file
æœ¬@value{DOCUMENT}ä¸­æ‰€ä½¿ç”¨åˆ°çš„ä¾‹å­ï¼Œä¸»è¦ä»ä¸¤ä¸ªæ ·ä¾‹@value{DF}ä¸­è¾“å…¥æ•°æ®ã€‚
ç¬¬ä¸€ä¸ªæ˜¯ @file{mail-list} æ–‡ä»¶ï¼Œé‡Œé¢å±•ç¤ºäº†ä¸€ç³»åˆ—çš„äººåï¼ŒåŒæ—¶è¿˜æœ‰ä»–ä»¬çš„é‚®ä»¶åœ°å€ï¼Œä»¥åŠç›¸å…³çš„ä¸ªäººä¿¡æ¯ã€‚
ç¬¬äºŒä¸ªæ˜¯ @file{inventory-shipped} æ–‡ä»¶ï¼ŒåŒ…å«äº†æ¯æœˆçš„å‘è´§æƒ…å†µã€‚ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œæ¯ä¸€è¡Œéƒ½ç§°ä¸ºä¸€æ¡@dfn{è®°å½•}ã€‚

åœ¨ @file{mail-list} æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªè®°å½•åŒ…æ‹¬äº†äººåï¼Œä»–/å¥¹çš„ç”µè¯å·ç ï¼Œä»–/å¥¹çš„é‚®ä»¶åœ°å€ï¼Œä»¥åŠä»–/å¥¹ä¸ä½œè€…æœ¬äººçš„å…³ç³»ã€‚
åˆ—ç”¨è¡Œæ¥è¿›è¡Œåˆ†éš”ã€‚æœ€åä¸€åˆ—ä¸­çš„ @samp{A} è¡¨ç¤ºç›¸è¯†çš„äººã€‚@samp{F} è¡¨ç¤ºç›¸åº”çš„äººæ˜¯æœ‹å‹å…³ç³»ï¼Œ@samp{R} è¡¨ç¤ºç›¸åº”çš„äººæ˜¯äº²å±å…³ç³»ï¼š

@example
@c system if test ! -d eg      ; then mkdir eg      ; fi
@c system if test ! -d eg/lib  ; then mkdir eg/lib  ; fi
@c system if test ! -d eg/data ; then mkdir eg/data ; fi
@c system if test ! -d eg/prog ; then mkdir eg/prog ; fi
@c system if test ! -d eg/misc ; then mkdir eg/misc ; fi
@c file eg/data/mail-list
Amelia       555-5553     amelia.zodiacusque@@gmail.com    F
Anthony      555-3412     anthony.asserturo@@hotmail.com   A
Becky        555-7685     becky.algebrarum@@gmail.com      A
Bill         555-1675     bill.drowning@@hotmail.com       A
Broderick    555-0542     broderick.aliquotiens@@yahoo.com R
Camilla      555-2912     camilla.infusarum@@skynet.be     R
Fabius       555-1234     fabius.undevicesimus@@ucb.edu    F
Julie        555-6699     julie.perscrutabor@@skeeve.com   F
Martin       555-6480     martin.codicibus@@hotmail.com    A
Samuel       555-3430     samuel.lanceolis@@shu.edu        A
Jean-Paul    555-2127     jeanpaul.campanorum@@nyu.edu     R
@c endfile
@end example

@cindex @code{inventory-shipped} file
@file{inventory-shipped} æ–‡ä»¶ä¸­çš„æ•°æ®è¡¨ç¤ºäº†åœ¨ä¸€å¹´ä¸­çš„å‘è´§ä¿¡æ¯ã€‚
æ¯ä¸ªè®°å½•éƒ½åŒ…æ‹¬ä¸€ä¸ªæœˆç»¿è‰²é›†è£…ç®±çš„å‘è´§æ•°ï¼Œçº¢ç®±ç›’è£…çš„å‘è´§æ•°ç»Ÿè®¡ï¼Œæ©™è‰²çš„è¢‹è£…çš„å‘è´§æ•°ç»Ÿè®¡ï¼Œä»¥åŠè“è‰²åŒ…è£…çš„å‘è´§æ•°ç»Ÿè®¡ã€‚è¿™é‡Œé¢æœ‰ 16 æ¡è®°å½•ï¼ŒåŒ…æ‹¬äº†äº†ä¸Šä¸€å¹´æœ€å 12 ä¸ªæœˆçš„æ•°æ®ï¼Œä»¥åŠæœ¬å¹´çš„å‰ 4 ä¸ªæœˆçš„æ•°æ®ã€‚ç”¨ç©ºè¡Œåˆ†éš”äº†å¹´ä»½ï¼š

@example
@c file eg/data/inventory-shipped
Jan  13  25  15 115
Feb  15  32  24 226
Mar  15  24  34 228
Apr  31  52  63 420
May  16  34  29 208
Jun  31  42  75 492
Jul  24  34  67 436
Aug  15  34  47 316
Sep  13  55  37 277
Oct  29  54  68 525
Nov  20  87  82 577
Dec  17  35  61 401

Jan  21  36  64 620
Feb  26  58  80 652
Mar  24  75  70 495
Apr  21  70  74 514
@c endfile
@end example

ä¸Šé¢çš„æ–‡ä»¶åŒ…å«åœ¨ @command{gawk} å‘å¸ƒç‰ˆæœ¬ï¼Œä½äºç›®å½• @file{awklib/eg/data} ä¸­ã€‚

@node Very Simple
@section ä¸€äº›ç®€å•ä¾‹å­

ä¸‹é¢çš„å‘½ä»¤è¡Œæ‰§è¡Œäº†ä¸€ä¸ªå¾ˆç®€å•çš„ @command{awk} ç¨‹åºï¼Œå°±æ˜¯æŸ¥æ‰¾ @file{mail-list} æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸² @samp{li}
ï¼ˆä¸€ç»„å­—ç¬¦ç§°ä¸ºä¸€ä¸ª@dfn{å­—ç¬¦ä¸²}ï¼Œè¿™ä¸ªæ˜¯åŸºäºè‹±è¯­ä¸­çš„æœ¯è¯­@dfn{ä¸²}çš„ç”¨æ³•ï¼Œå¦‚â€œä¸€ä¸²çç â€æˆ–è€…â€œç«è½¦ä¸­çš„ä¸€ä¸²è½¦å¢â€ï¼‰ï¼š

@example
awk '/li/ @{ print $0 @}' mail-list
@end example

@noindent
å¦‚æœè¡Œä¸­åŒ…æ‹¬äº† @samp{li} ï¼Œä»–ä»¬å°±ä¼šè¢«æ‰“å°å‡ºæ¥ï¼Œå› ä¸º @w{@samp{print $0}} çš„æ„æ€å°±æ˜¯æ‰“å°å½“å‰è¡Œã€‚
ï¼ˆåªå†™ @samp{print} çš„æ„æ€æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ @samp{print} ä»£æ›¿ @w{@samp{print $0}}ã€‚ï¼‰

ä½ åº”è¯¥æ³¨æ„åˆ° @command{awk} ç¨‹åºä¸­åœ¨ä¸² @samp{li} ä¸¤è¾¹çš„æ–œæ ï¼ˆ@samp{/}ï¼‰ã€‚
è¿™ä¸ªæ–œæ æŒ‡ç¤ºäº† @samp{li} æ˜¯è¦æœç´¢çš„ä¸œè¥¿ã€‚è¿™ç§æ¨¡å¼ç§°ä¸º@dfn{æ­£åˆ™è¡¨è¾¾å¼}ï¼Œè¿™ä¸ªçŸ¥è¯†ç‚¹ä¼šåœ¨åé¢æ¶‰åŠï¼ˆ@pxref{Regexp}ï¼‰ã€‚
è¿™ä¸ªæ¨¡å¼å…è®¸åŒ¹é…å•è¯çš„éƒ¨åˆ†ã€‚åœ¨ @command{awk} ç¨‹åºä¸¤è¾¹ç”±å•å¼•å·å¼•èµ·æ¥ï¼Œå› æ­¤ä¸ä¼šè§£æå…¶ä¸­çš„ä»»ä½•å­—ç¬¦ã€‚

ä¸‹é¢æ˜¯è¿™ä¸ªç¨‹åºçš„è¾“å‡º:

@example
$ @kbd{awk '/li/ @{ print $0 @}' mail-list}
@print{} Amelia       555-5553     amelia.zodiacusque@@gmail.com    F
@print{} Broderick    555-0542     broderick.aliquotiens@@yahoo.com R
@print{} Julie        555-6699     julie.perscrutabor@@skeeve.com   F
@print{} Samuel       555-3430     samuel.lanceolis@@shu.edu        A
@end example

@cindex actions, default
@cindex patterns, default
åœ¨ @command{awk} çš„è§„åˆ™ä¸­ï¼Œå³å¯ä»¥çœç•¥æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥çœç•¥ç›¸å…³çš„åŠ¨ä½œï¼Œä½†ä¸èƒ½ä¸¤è€…éƒ½çœç•¥ã€‚å¦‚æœæ¨¡å¼çœç•¥äº†ï¼Œé‚£ä¹ˆåŠ¨ä½œçš„æ‰§è¡Œå°±ä¼šé’ˆå¯¹@emph{æ‰€æœ‰çš„}è¾“å…¥è¡Œã€‚
å¦‚æœåŠ¨ä½œè¢«çœç•¥äº†ï¼Œé‚£ä¹ˆé»˜è®¤çš„è¿è¡Œå°±æ˜¯æ‰“å°æ‰€æœ‰çš„åŒ¹é…è¡Œã€‚

@cindex actions, empty
å› æ­¤ï¼Œæˆ‘ä»¬ä¸ç®¡ä¾‹å­ä¸­çš„åŠ¨ä½œï¼ˆå³ @code{print} è¯­å¥ä»¥åŠèŠ±æ‹¬å·ï¼‰ï¼Œç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š@command{awk} ä¼šæ‰“å°æ‰€æœ‰åŒ¹é…äº† @samp{li} å­—ä¸²çš„è¡Œã€‚å¦‚æœçœç•¥äº† @code{print} è¯­å¥ï¼Œè€Œä¿ç•™èŠ±æ‹¬å·ï¼Œåˆ™åŠ¨ä½œä¼šä»€ä¹ˆä¹Ÿä¸åšï¼ˆå³ä¸ä¼šæœ‰è¡Œè¢«è¾“å‡ºï¼‰ã€‚

@cindex @command{awk} programs, one-line examples
å®é™…çš„ @command{awk} ç¨‹åºå¤§å¤šåªæœ‰ä¸€ä¸¤è¡Œé•¿ã€‚ä¸‹é¢æ”¶é›†äº†ä¸€äº›æœ‰ç”¨è€ŒçŸ­å°çš„ç¨‹åºï¼Œä»¥ä¾¿äºä½ å¼€å§‹ä½¿ç”¨ @command{awk}ã€‚
å…¶ä¸­æœ‰äº›ç¨‹åºåŒ…æ‹¬çš„ç‰¹æ€§ç›®å‰è¿˜æ²¡æœ‰æ¶‰åŠï¼ˆå¯¹äºç¨‹åºçš„æè¿°å¯ä»¥æç¤ºä½ æ¥ä¸‹æ¥å°†åšä»€ä¹ˆï¼Œä½†ä¸éœ€è¦ä½ å…ˆè¯»å®Œæœ¬@value{DOCUMENT}åæˆä¸ºä¸“å®¶åå†æ¥é˜…è¯»ç¨‹åºï¼ï¼‰
å¤§å¤šæ•°çš„ä¾‹å­éƒ½ä½¿ç”¨åä¸º @file{data} çš„@value{DF}ã€‚è¿™ä»…æ˜¯ä¸ªå ä½ç¬¦ï¼›å¦‚æœä½ è‡ªå·±ä½¿ç”¨è¿™äº›ç¨‹åºï¼Œæ›¿æ¢æˆä½ è‡ªå·±çš„@value{FN}çš„ @file{data} æ–‡ä»¶å°±å¥½äº†ã€‚
ä¸ºäº†åç»­å‚è€ƒï¼šä¸€èˆ¬æ¥è®²è¦å®ŒæˆåŒæ ·ä¸€ä»¶äº‹ï¼Œ@command{awk} å¯ä»¥æœ‰ä¸æ­¢ä¸€ç§æ–¹æ³•ã€‚åœ¨æŸä¸ªæ—¶å€™ï¼Œä½ å¯èƒ½æƒ³å›è¿‡å¤´æ¥çœ‹è¿™äº›ä¾‹å­ï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿæƒ³å‡ºæ›´å¤šæ–¹æ³•æ¥åšè¿™é‡Œå±•ç¤ºçš„ç›¸åŒçš„äº‹æƒ…ã€‚

@itemize @value{BULLET}
@item
æ‰“å°å¤§äº 80 ä¸ªå­—ç¬¦çš„è¡Œï¼š

@example
awk 'length($0) > 80' data
@end example

è¿™é‡Œå”¯ä¸€çš„è§„åˆ™å°±æ˜¯æœ‰ä¸€ä¸ªå…³ç³»è¡¨è¾¾å¼ä½œä¸ºæ¨¡å¼ï¼Œä½†æ˜¯æ²¡æœ‰åŠ¨ä½œã€‚å› æ­¤å®ƒç”¨çš„æ˜¯é»˜è®¤åŠ¨ä½œï¼Œå°±æ˜¯æ‰“å°è®°å½•ï¼ˆè¾“å…¥è¡Œï¼‰ã€‚

@item
æ‰“å°æœ€é•¿çš„è¡Œçš„é•¿åº¦ï¼š

@example
awk '@{ if (length($0) > max) max = length($0) @}
     END @{ print max @}' data
@end example

è¿™é‡Œä¸ @code{END} å…³è”çš„ä»£ç ï¼Œä¼šåœ¨æ‰€æœ‰çš„è¡Œè¯»å…¥åæ‰§è¡Œï¼›å®ƒä¸ @code{BEGIN} åˆšå¥½ç›¸åã€‚

@cindex @command{expand} utility
@item
æ‰“å° @file{data} æ–‡ä»¶ä¸­æœ€é•¿çš„è¡Œçš„é•¿åº¦ï¼š

@example
expand data | awk '@{ if (x < length($0)) x = length($0) @}
                   END @{ print "maximum line length is " x @}'
@end example

è¿™ä¸ªä¾‹å­ä¸å‰é¢çš„æœ‰ä¸€äº›ä¸åŒï¼šè¾“å…¥æ˜¯é€šè¿‡ @command{expand} å·¥å…·ï¼Œå°† TABs è½¬æ¢æˆç©ºæ ¼ã€‚å› æ­¤é•¿åº¦çš„æ¯”è¾ƒå®é™…ä¸Šæ˜¯åˆ°æœ€å³è¾¹çš„åˆ—æ•°ï¼Œè€Œä¸æ˜¯æ¯ä¸€è¡Œçš„è¾“å…¥å­—ç¬¦æ•°ã€‚

@item
æ‰“å°è‡³å°‘æœ‰ä¸€ä¸ªåŸŸçš„è¡Œï¼š

@example
awk 'NF > 0' data
@end example

è¿™ä¸ªæ˜¯æœ€å¥½çš„åˆ é™¤ç©ºç™½è¡Œçš„æ–¹æ³•ï¼ˆå³æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªä¸æ—§æ–‡ä»¶ä¸€æ ·çš„æ–‡ä»¶ï¼Œä½†æ˜¯ç§»é™¤äº†å…¶ä¸­çš„ç©ºç™½è¡Œï¼‰ã€‚

@item
æ‰“å°ä» 0 åˆ° 100 ï¼ˆåŒ…å« 0 å’Œ 100ï¼‰çš„7ä¸ªéšæœºæ•°ï¼š

@example
awk 'BEGIN @{ for (i = 1; i <= 7; i++)
                 print int(101 * rand()) @}'
@end example

@item
æ‰“å°@var{å¤šä¸ªæ–‡ä»¶}ä¸­æ€»å…±çš„å­—èŠ‚æ•°ï¼š

@example
ls -l @var{files} | awk '@{ x += $5 @}
                   END @{ print "total bytes: " x @}'
@end example

@item
æ‰“å°@var{å¤šä¸ªæ–‡ä»¶}æ‰€ä½¿ç”¨çš„ KB æ€»æ•°ï¼š

@c Don't use \ continuation, not discussed yet
@c Remember that awk does floating point division,
@c no need for (x+1023) / 1024
@example
ls -l @var{files} | awk '@{ x += $5 @}
   END @{ print "total K-bytes:", x / 1024 @}'
@end example

@item
æ‰“å°æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•åçš„æ’åºåˆ—è¡¨ï¼š

@example
awk -F: '@{ print $1 @}' /etc/passwd | sort
@end example

@item
æ‰“å°æ–‡ä»¶çš„è¡Œæ•°ï¼š

@example
awk 'END @{ print NR @}' data
@end example

@item
æ‰“å°@value{DF}ä¸­çš„å¶æ•°è¡Œï¼š

@example
awk 'NR % 2 == 0' data
@end example

å¦‚æœä½ ä½¿ç”¨è¡¨è¾¾å¼ @samp{NR % 2 == 1}ï¼Œåˆ™ç¨‹åºå°†æ‰“å°å‡ºå¥‡æ•°è¡Œã€‚
@end itemize

@node Two Rules
@section ä¸¤è§„åˆ™çš„ä¾‹å­
@cindex @command{awk} programs

@command{awk} å·¥å…·ä»æ–‡ä»¶ä¸­ä¸€æ¬¡è¯»å–ä¸€è¡Œã€‚å¯¹äºæ¯ä¸€è¡Œï¼Œ@command{awk} éƒ½æ˜¯å°è¯•ä¸æ¯ä¸ªæ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœæœ‰å‡ ä¸ªæ¨¡å¼ä¸å…¶åŒ¹é…ï¼Œåˆ™å‡ ä¸ªåŠ¨ä½œéƒ½ä¼šæŒ‰ç…§åŒ¹é…çš„é¡ºåºè¢«æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰æ¨¡å¼åŒ¹é…ä¸Šï¼Œåˆ™ä¸ä¼šæœ‰åŠ¨ä½œä¼šæ‰§è¡Œã€‚

å½“å¤„ç†äº†åŒ¹é…è¡Œçš„æ‰€æœ‰è§„åˆ™åï¼ˆä¹Ÿè®¸ä¹Ÿæ²¡æœ‰ï¼‰ï¼Œ@command{awk} ä¼šè¯»å–ä¸‹ä¸€è¡Œã€‚ï¼ˆä½†æ˜¯ï¼Œ@pxref{Next Statement}ï¼Œ
@ifdocbook
ä¸ @ref{Nextfile Statement} ä¸­çš„ç›¸å…³çŸ¥è¯†ã€‚ï¼‰
@end ifdocbook
@ifnotdocbook
ä¸ @pxref{Nextfile Statement}.)
@end ifnotdocbook
è¿™ä¸ªè¿‡ç¨‹ä¸€ç›´æŒç»­åˆ°æ–‡ä»¶è¯»å–å®Œæ¯•ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ @command{awk} ç¨‹åºåŒ…å«äº†ä¸¤ä¸ªè§„åˆ™ï¼š

@example
/12/  @{ print $0 @}
/21/  @{ print $0 @}
@end example

@noindent
ç¬¬ä¸€ä¸ªè§„åˆ™ç”¨å­—ç¬¦ä¸² @samp{12} ä½œä¸ºæ¨¡å¼ï¼Œä»¥åŠ @samp{print $0} ä½œä¸ºåŠ¨ä½œã€‚ç¬¬äºŒä¸ªè§„åˆ™ç”¨ @samp{21} ä½œä¸ºæ¨¡å¼ï¼Œä¹Ÿç”¨ @samp{print $0} ä½œä¸ºåŠ¨ä½œã€‚æ¯ä¸ªè§„åˆ™çš„åŠ¨ä½œéƒ½ç”¨è‡ªå·±çš„èŠ±æ‹¬å·åŒ…å«èµ·æ¥ã€‚

è¿™ä¸ªç¨‹åºæ‰“å°æ¯ä¸€è¡ŒåŒ…å«æœ‰ @samp{12} @emph{æˆ–è€…} @samp{21} çš„è¡Œã€‚å¦‚æœæœ‰ä¸€è¡ŒåŒ…å«äº†ä¸¤ä¸ªä¸²ï¼Œåˆ™ä¼šæ‰“å°ä¸¤æ¬¡ï¼Œæ¯ä¸ªè§„åˆ™ä¸€æ¬¡ã€‚

å¦‚æœæˆ‘ä»¬åŒæ—¶å¯¹æˆ‘ä»¬çš„ä¸¤ä¸ª@value{DF}ï¼Œå³ @file{mail-list} æ–‡ä»¶ä¸ @file{inventory-shipped} æ–‡ä»¶æ‰§è¡Œè¿™ä¸ªç¨‹åºä¼šæœ‰ä»€ä¹ˆç»“æœï¼š

@example
$ @kbd{awk '/12/ @{ print $0 @}}
>      @kbd{/21/ @{ print $0 @}' mail-list inventory-shipped}
@print{} Anthony      555-3412     anthony.asserturo@@hotmail.com   A
@print{} Camilla      555-2912     camilla.infusarum@@skynet.be     R
@print{} Fabius       555-1234     fabius.undevicesimus@@ucb.edu    F
@print{} Jean-Paul    555-2127     jeanpaul.campanorum@@nyu.edu     R
@print{} Jean-Paul    555-2127     jeanpaul.campanorum@@nyu.edu     R
@print{} Jan  21  36  64 620
@print{} Apr  21  70  74 514
@end example

@noindent
ç•™æ„åœ¨ @file{mail-list} æ–‡ä»¶ä¸­çš„ @samp{Jean-Paul} å¼€å¤´çš„è¡Œï¼Œå®ƒè¢«æ‰“å°äº†ä¸¤æ¬¡ï¼Œä¸€ä¸ªè§„åˆ™ä¸€æ¬¡ã€‚

@node More Complex
@section å¤æ‚ä¸€ç‚¹çš„ä¾‹å­

ç›®å‰æˆ‘ä»¬å·²ç»æŒæ¡ä¸€äº›åŸºæœ¬çš„æŠ€èƒ½ï¼Œç°åœ¨æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ @command{awk} å…¸å‹åœ°è¿˜èƒ½åšäº›ä»€ä¹ˆäº‹æƒ…ã€‚è¿™ä¸ªä¾‹å­å±•ç¤ºäº† @command{awk} å¦‚ä½•è¢«ç”¨æ¥åšæ±‡æ€»ï¼Œé€‰æ‹©ä»¥åŠé‡æ–°å®‰æ’å¦ä¸€ä¸ªå·¥å…·çš„è¾“å‡ºã€‚æ‰€ç”¨åˆ°çš„ç‰¹æ€§è¿˜æ²¡æœ‰æ¶‰åŠï¼Œå› æ­¤ä½ ä¸è¦æ‹…å¿ƒä¸ç†è§£æ‰€æœ‰çš„ç»†èŠ‚ï¼š

@example
ls -l | awk '$6 == "Nov" @{ sum += $5 @}
             END @{ print sum @}'
@end example

@cindex @command{ls} utility
è¿™ä¸ªå‘½ä»¤æ‰“å°å½“å‰ç›®å½•ä¸‹ï¼Œæœ€åçš„ä¿®æ”¹æ—¶é—´ä¸ºåä¸€æœˆä»½çš„æ‰€æœ‰æ–‡ä»¶çš„æ€»å…±çš„å­—èŠ‚æ•°ã€‚
@w{@samp{ls â€“l}} æ˜¯è¿™æ•´ä½“å‘½ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæ˜¾ç¤ºä¸€ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„å¤§å°ä»¥åŠæœ€åä¿®æ”¹æ—¶é—´ã€‚å®ƒçš„è¾“å‡ºç±»ä¼¼äºè¿™æ ·ï¼š

@example
-rw-r--r--  1 arnold   user   1933 Nov  7 13:05 Makefile
-rw-r--r--  1 arnold   user  10809 Nov  7 13:03 awk.h
-rw-r--r--  1 arnold   user    983 Apr 13 12:14 awk.tab.h
-rw-r--r--  1 arnold   user  31869 Jun 15 12:20 awkgram.y
-rw-r--r--  1 arnold   user  22414 Nov  7 13:03 awk1.c
-rw-r--r--  1 arnold   user  37455 Nov  7 13:03 awk2.c
-rw-r--r--  1 arnold   user  27511 Dec  9 13:07 awk3.c
-rw-r--r--  1 arnold   user   7989 Nov  7 13:03 awk4.c
@end example

@noindent
@cindex line continuations, with C shell
ç¬¬ä¸€ä¸ªåŸŸåŒ…å«äº†è¯»å†™æƒé™ï¼Œç¬¬äºŒä¸ªåŸŸåŒ…å«äº†æ–‡ä»¶çš„ç¡¬è¿æ¥@footnote{ç¡¬é“¾æ¥(hard linkï¼Œ ä¹Ÿç§°é“¾æ¥)å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åã€‚å¤šæ•°æ–‡ä»¶ç³»ç»Ÿå¯ä»¥ç”¨å¤šä¸ªæ–‡ä»¶åä¸åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œé“¾æ¥ï¼Œè¿™äº›æ–‡ä»¶åå¯ä»¥åœ¨åŒä¸€ç›®å½•æˆ–ä¸åŒç›®å½•ã€‚ä¸€ä¸ªæ–‡ä»¶æœ‰å‡ ä¸ªæ–‡ä»¶åï¼Œå°±è¯´è¯¥æ–‡ä»¶çš„é“¾æ¥æ•°ä¸ºå‡ ã€‚è¿™ä¸ªä¸è½¯é“¾æ¥ä¸åŒï¼Œè½¯è¿æ¥æ˜¯æŒ‡å‘æ–‡ä»¶åçš„æ–‡ä»¶ã€‚åˆ é™¤æ‰€æœ‰ç¡¬è¿æ¥æ‰èƒ½åˆ é™¤æ–‡ä»¶ã€‚åˆ é™¤è¢«è½¯è¿æ¥çš„æŒ‡å‘çš„æ–‡ä»¶ï¼ˆå¦‚æœåªæœ‰ä¸€ä¸ªç¡¬è¿æ¥ï¼‰å°±å¯ä»¥åˆ é™¤æ–‡ä»¶æœ¬èº«ã€‚â€”â€”è¯‘è€…æ³¨}
ä¸ªæ•°ï¼Œç¬¬ä¸‰ä¸ªåŸŸæ˜¾ç¤ºäº†æ–‡ä»¶çš„å±ä¸»ä¿¡æ¯ã€‚ç¬¬å››ä¸ªåŸŸæ˜¾ç¤ºçš„æ–‡ä»¶çš„ç”¨æˆ·ä¿¡æ¯ã€‚ç¬¬äº”ä¸ªåŸŸæ˜¾ç¤ºäº†æ–‡ä»¶çš„å­—èŠ‚å¤§å°ã€‚ç¬¬å…­ã€ä¸ƒã€å…«ä¸ªåŸŸåˆ†åˆ«åŒ…æ‹¬æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´çš„æœˆï¼Œæ—¥ä¸æ—¶é—´ã€‚æœ€åï¼Œç¬¬ä¹ä¸ªåŸŸåŒ…å«äº†@value{FN}ã€‚

@c @cindex automatic initialization
@cindex initialization, automatic
åœ¨ @command{awk} ç¨‹åºä¸­ @samp{$6 == â€œNovâ€} å°±æ˜¯ç”¨æ¥åˆ¤æ–­ @w{@samp{ls â€“l}} è¾“å‡ºçš„ç¬¬å…­ä¸ªåŸŸæ˜¯å¦ä¸º @samp{Nov} çš„è¡¨è¾¾å¼ã€‚
å¦‚æœæ¯æ¬¡çš„è¾“å…¥è¡Œçš„ç¬¬å…­ä¸ªåŸŸåŒ¹é…å­—ä¸² @samp{Nov} ï¼Œ@command{awk} å°±ä¼šæ‰§è¡Œ @samp{sum += $5}ã€‚
è¿™ä¸ªä¼šåŠ ä¸Šç¬¬äº”ä¸ªåŸŸï¼ˆæ–‡ä»¶å¤§å°ï¼‰åˆ°å˜é‡ @code{sum} ä¸­ã€‚ç»“æœå°±æ˜¯ï¼Œå½“ @command{awk} å®Œæˆäº†æ‰€æœ‰è¡Œçš„è¾“å…¥æ—¶ï¼Œ@code{sum} å°±åŒ…å«äº†åŒ¹é…æ¨¡å¼çš„æ‰€æœ‰æ–‡ä»¶çš„å¤§å°ã€‚ï¼ˆè¿™å¯ä»¥å·¥ä½œæ˜¯å› ä¸º @command{awk} çš„å˜é‡ä¼šé»˜è®¤åˆå§‹åŒ–ä¸º 0ã€‚ï¼‰

æœ€åä¸€è¡Œå¤„ç†åï¼Œ@command{END} è§„åˆ™å°±ä¼šæ‰§è¡Œï¼Œå¹¶æ‰“å°å‡º @code{sum} çš„å€¼ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ä¸º 80600ã€‚

è¿™äº›ä¸ªé«˜çº§çš„ @command{awk} æŠ€æœ¯ä¼šåœ¨åé¢çš„@value{SECTION}ä¸­æ¶‰åŠï¼ˆ@pxref{Action Overview}ï¼‰ã€‚åœ¨ä½ å­¦ä¹ åˆ°è¿™äº›é«˜çº§æŠ€æœ¯å‰ï¼Œä½ åªéœ€è¦çŸ¥é“ @command{awk} å¦‚ä½•è§£æä½ çš„è¾“å…¥å¹¶æ˜¾ç¤ºä½ çš„è¾“å‡ºã€‚é€šè¿‡æ“ä½œå„ä¸ªåŸŸå¹¶ä½¿ç”¨ @code{print} è¯­å¥ï¼Œä½ å°±å¯ä»¥äº§ç”Ÿä¸€äº›ç›¸å½“æœ‰ç”¨çš„ï¼Œä»¤äººå°è±¡æ·±åˆ»çš„æŠ¥è¡¨ã€‚

@node Statements/Lines
@section @command{awk} è¯­å¥ä¸è¡Œ
@cindex line breaks
@cindex newlines

é€šå¸¸æƒ…å†µä¸‹ï¼Œ@command{awk} ç¨‹åºçš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¯­å¥æˆ–è€…ä¸€ä¸ªç‹¬ç«‹çš„è§„åˆ™ï¼Œç±»ä¼¼äºï¼š

@example
awk '/12/  @{ print $0 @}
     /21/  @{ print $0 @}' mail-list inventory-shipped
@end example

@cindex @command{gawk}, newlines in
ä½†æ˜¯ @command{gawk} ä¼šå¿½ç•¥ä¸‹é¢ç¬¦å·åé¢çš„ä»»ä½•æ–°è¡Œï¼š

@example
,    @{    ?    :    ||    &&    do    else
@end example

@noindent
ä»»ä½•ä¸€ä¸ªæ–°è¡Œéƒ½ä¼šè®¤ä¸ºæ˜¯ä¸€ä¸ªè¯­å¥@footnote{è¿™é‡Œçš„ @samp{?} ä¸ @samp{:} æ˜¯ä¸€ä¸ªä¸‰å…ƒæ“ä½œç¬¦è¡¨è¾¾å¼ï¼Œ@ref{Conditional Exp} ä¸­è¿›è¡Œäº†æè¿°ã€‚
åœ¨ @samp{?} ä¸ @samp{:} ä¹‹åè¿›è¡Œæ–­è¡Œæ˜¯ä¸€ä¸ªå°æ‰©å±•ï¼Œå¦‚æœæŒ‡å®šäº†@option{--posix} å‚æ•°(@pxref{Options})ï¼Œåˆ™è¿™ä¸ªç‰¹æ€§å°±ä¼šè¢«ç¦ç”¨ã€‚}
çš„ç»“æŸã€‚

@cindex @code{\} (backslash), continuing lines and
@cindex backslash (@code{\}), continuing lines and
åœ¨æ–°çš„ä¸€è¡Œä¼šä¸­æ­¢ä¸€ä¸ªå‘½ä»¤çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æƒ³æŠŠä¸€è¡Œå‘½ä»¤å†™æˆä¸¤è¡Œï¼Œä½ å¯ä»¥åœ¨ç¬¬ä¸€è¡Œçš„æœ«å°¾åŠ ä¸Šåæ–œæ ï¼ˆ@samp{\}ï¼‰æ¥@dfn{ç»­å†™}è¿™ä¸ªå‘½ä»¤ã€‚
ä¸ºäº†è¯†åˆ«ä¸€è¡Œçš„åç»­å­—ç¬¦ï¼ˆç»­è¡Œï¼‰ï¼Œï¼ˆ @samp{\} ï¼‰åæ–œæ å¿…é¡»æ˜¯è¡Œçš„ç»“æŸå­—ç¬¦ã€‚
åæ–œæ å¯ä»¥å†™åœ¨è¿™ä¸ªå‘½ä»¤çš„ä»»ä½•åœ°æ–¹ï¼Œå³ä½¿åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼çš„ä¸­é—´ä¹Ÿå¯ä»¥ã€‚å¦‚ï¼š
@example
awk '/This regular expression is too long, so continue it\
 on the next line/ @{ print $1 @}'
@end example

@noindent
@cindex portability, backslash continuation and
æˆ‘ä»¬ä¸€èˆ¬ä¸åœ¨æˆ‘ä»¬çš„ç¨‹åºä»£ç ä¸­åˆ©ç”¨åæ–œæ æ¥ç»­è¡Œã€‚@command{gawk} å¯¹äºä¸€è¡Œçš„é•¿åº¦æ²¡æœ‰é™åˆ¶ï¼Œå› æ­¤åæ–œæ ç»­è¡Œå¹¶éæ˜¯å¿…è¦çš„ã€‚è¿™ä»…æ˜¯ä½¿å¾—ç¨‹åºæ›´æœ‰å¯è¯»æ€§ã€‚å› ä¸ºè¿™ä¸ªåŸå› ï¼Œä¹Ÿä¸ºæ¸…æ™°èµ·è§ï¼Œæˆ‘ä»¬å°½é‡ä¿è¯æœ¬@value{DOCUMENT}ä¸­ä»£ç çš„è¯­å¥çš„çŸ­å°ã€‚å¦‚æœä½ çš„ä»£ç æ˜¯å†™åœ¨å•ç‹¬çš„æ–‡ä»¶è€Œä¸æ˜¯å‘½ä»¤è¡Œä¸­ï¼Œé‚£ä¹ˆåæ–œæ å°±æœ€æœ‰ç”¨äº†ã€‚åŒæ—¶ä½ ä¹Ÿéœ€è¦çŸ¥é“ä¸åŒçš„å‘å¸ƒç‰ˆæœ¬çš„ @command{awk} å¯¹äºåæ–œæ åœ¨ä½•å¤„ä½¿ç”¨æ˜¯æœ‰ç‰¹æ®Šåœ°æ–¹çš„ã€‚å› æ­¤ï¼Œä¸ºäº†èƒ½æœ€å¤§åŒ–ä½ çš„ä»£ç çš„å¯ç§»æ¤æ€§ï¼Œæœ€å¥½ä¸è¦æŠŠä½ çš„ä»£ç è¡Œåœ¨å­—ä¸²æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ä¸­é—´æ–­è¡Œåˆ†å¼€ã€‚
@c 10/2000: gawk, mawk, and current bell labs awk allow it,
@c solaris 2.7 nawk does not. Solaris /usr/xpg4/bin/awk does though!  sigh.

@cindex @command{csh} utility
@cindex backslash (@code{\}), continuing lines and, in @command{csh}
@cindex @code{\} (backslash), continuing lines and, in @command{csh}
@quotation æ³¨æ„
@emph{åæ–œæ ç»­è¡Œä¸ä¼šåœ¨ C Shell ä¸­æœ‰æ•ˆã€‚}å®ƒåªåœ¨ç‹¬ç«‹çš„ @command{awk} ç¨‹åºæ–‡ä»¶ï¼Œæˆ–è€…ä¸€æ¬¡æ€§çš„ç¨‹åºä¸­æœ‰ç”¨ï¼Œ@emph{å‰ææ˜¯}ä½ ä½¿ç”¨çš„æ˜¯ POSIX å…¼å®¹çš„ Shellï¼Œä¾‹å¦‚ Unix Bourne Shell æˆ–è€… Bashã€‚ä½†æ˜¯ C Shell çš„è¡¨ç°ä¸åŒï¼ä½ éœ€è¦åœ¨è¡Œä¸­ä½¿ç”¨ä¸¤ä¸ªåæ–œæ ï¼Œç„¶åå†å†™å…¥æ–°è¡Œã€‚åœ¨ä½¿ç”¨ C Shell æ—¶ä½ ä¹Ÿéœ€è¦ç•™æ„ @command{awk} ç¨‹åºä¸­çš„@emph{æ¯ä¸€ä¸ª}æ–°è¡Œéƒ½éœ€è¦åæ–œæ è½¬ä¹‰ã€‚ä½œä¸ºè¯´æ˜å¦‚ä¸‹ï¼š

@example
% @kbd{awk 'BEGIN @{ \}
? @kbd{  print \\}
? @kbd{      "hello, world" \}
? @kbd{@}'}
@print{} hello, world
@end example

@noindent
è¿™é‡Œé¢ï¼Œ@samp{%} ä¸ @samp{?} éƒ½æ˜¯ C Shell çš„ä¸»ã€æ¬¡æç¤ºç¬¦ï¼Œä¸æ ‡å‡†çš„ Shell çš„ @samp{$} ä¸ @samp{>} ç±»ä¼¼ã€‚

ä¸å‰é¢ä¸€ä¸ªä¾‹å­ç›¸æ¯”ï¼Œçœ‹çœ‹ POSIX å…¼å®¹çš„ Shell å¦‚ä½•æ¥å®Œæˆï¼š

@example
$ @kbd{awk 'BEGIN @{}
>   @kbd{print \}
>       @kbd{"hello, world"}
> @kbd{@}'}
@print{} hello, world
@end example
@end quotation

@command{awk} æ˜¯ä¸€ä¸ªé¢å‘è¡Œçš„è¯­è¨€ã€‚æ¯ä¸€ä¸ªè§„åˆ™çš„åŠ¨ä½œéƒ½ä¸æ¨¡å¼åœ¨åŒä¸€è¡Œã€‚ä¸ºäº†å°†å®ƒä»¬åˆ†éš”åœ¨ä¸åŒçš„è¡Œï¼Œä½ @emph{å¿…é¡»}ä½¿ç”¨åæ–œæ æ¥è¿›è¡Œç»­è¡Œï¼›æ²¡æœ‰ä»–é€‰é¡¹ã€‚

@cindex backslash (@code{\}), continuing lines and, comments and
@cindex @code{\} (backslash), continuing lines and, comments and
@cindex commenting, backslash continuation and
è¿˜æœ‰ä¸€ä¸ªäº‹æƒ…è¦è®°ä½ï¼Œä¸è¦å°†åæ–œæ ä¸æ³¨é‡Šæ··ç”¨ã€‚@command{awk} åªè¦çœ‹åˆ° @samp{#} å¼€å§‹ä¸€ä¸ªæ³¨é‡Šï¼Œå°±ä¼šå¿½ç•¥ä¸€è¡Œä¸­@emph{æ‰€æœ‰çš„}åç»­éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{gawk 'BEGIN @{ print "dont panic" # a friendly \}
> @kbd{                                   BEGIN rule}
> @kbd{@}'}
@error{} gawk: cmd. line:2:                BEGIN rule
@error{} gawk: cmd. line:2:                ^ syntax error
@end example

@noindent
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œçœ‹èµ·æ¥åæ–œæ ä¼šå°†æ³¨é‡Šç»­åˆ°ä¸‹ä¸€è¡Œã€‚ä½†æ˜¯ï¼Œåæ–œæ -æ–°è¡Œè¿™æ ·çš„ç»„åˆä»æ¥ä¸ä¼šè¢«æ³¨æ„åˆ°ï¼Œå› ä¸ºå®ƒåœ¨æ³¨é‡Šä¸­è¢«è—èµ·æ¥äº†ã€‚å› æ­¤ï¼Œ@code{BEGIN} ä¼šè¢«è§†ä½œä¸€ä¸ªè¯­æ³•é”™è¯¯ã€‚

@cindex statements, multiple
@cindex @code{;} (semicolon), separating statements in actions
@cindex semicolon (@code{;}), separating statements in actions
å½“ @command{awk} çš„ä¸€ä¸ªè§„åˆ™ä¸­çš„è¯­å¥å¾ˆçŸ­ï¼Œä½ æƒ³æŠŠå®ƒä»¬æ”¾åœ¨åŒä¸€è¡Œï¼Œè¿™ä¸ªå¯é€šè¿‡è¯­å¥ä¹‹é—´ç”¨åˆ†å·ï¼ˆ@samp{;}ï¼‰è¿›è¡Œåˆ†éš”ã€‚è¿™ä¹ŸåŒæ ·é€‚åº”äºè§„åˆ™æœ¬èº«ã€‚å› æ­¤ï¼Œåœ¨æœ¬@value{SECTION}ä¸­å±•ç¤ºçš„ç¨‹åºä¹Ÿå¯ä»¥å†™åœ¨è¿™æ ·ï¼š

@example
/12/ @{ print $0 @} ; /21/ @{ print $0 @}
@end example

@quotation æç¤º
éœ€è¦å£°æ˜çš„ä¸€ç‚¹æ˜¯ï¼Œç”¨ä¸€ä¸ªåˆ†å·åˆ†éš”åŒä¸€è¡Œä¸­çš„è§„åˆ™å¹¶ä¸æ˜¯ @command{awk} è¯­è¨€çš„é¦–åˆ›ã€‚ä¸ºäº†ä¸åœ¨ä¸€ä¸ªåŠ¨ä½œçš„è¯­å¥å¤„ç†ä¿æŒä¸€è‡´ï¼Œè¿™æ‰åŠ å…¥åˆ° @command{awk} ä¸­çš„ã€‚
@end quotation

@node Other Features
@section @command{awk} çš„å…¶ä»–ç‰¹æ€§

@cindex variables
@command{awk} è¯­è¨€æä¾›äº†éå¸¸å¤šçš„é¢„å®šä¹‰çš„ï¼Œæˆ–è€…@dfn{å†…å»ºçš„}å˜é‡ï¼Œå¯è®©ä½ çš„ç¨‹åºä» @command{awk} è·å–ä¿¡æ¯ã€‚ä¹Ÿæœ‰äº›å˜é‡é›†æ˜¯è®©ä½ çš„ @command{awk} ç¨‹åºæ§åˆ¶ @command{awk} å¦‚ä½•å¤„ç†ä½ çš„æ•°æ®ã€‚

å¦å¤–ï¼Œ@command{awk} ä¹Ÿæä¾›äº†å¾ˆå¤šçš„å†…å»ºå‡½æ•°ï¼Œæ¥åšä¸€äº›é€šç”¨æ€§çš„è®¡ç®—ä¸å­—ä¸²ç›¸å…³çš„æ“ä½œã€‚@command{gawk} æä¾›äº†å†…å»ºçš„å‡½æ•°ç”¨æ¥å¤„ç†æ—¶é—´æˆ³ï¼Œæ‰§è¡Œä½æ“ä½œï¼Œä»¥åŠè¿è¡Œæ—¶çš„å­—ä¸²ç¿»è¯‘ï¼ˆå›½é™…åŒ–ï¼‰ï¼Œç¡®å®šå˜é‡çš„ç±»å‹ä»¥åŠæ•°æ®æ’åºã€‚

å½“æˆ‘ä»¬å¼€å‘ @command{awk} è¯­è¨€ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¼šä»‹ç»å¤šæ•°çš„å˜é‡ä¸å‡½æ•°ï¼Œä»–ä»¬ä¼šåœ¨ @ref{Built-in Variables}ï¼Œä»¥åŠ @ref{Built-in}ï¼Œæœ‰ç³»ç»Ÿçš„æè¿°ã€‚

@node When
@section ä½•æ—¶ä½¿ç”¨ @command{awk}

@cindex @command{awk}, uses for
ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†ä¸€äº› @command{awk} å¯ä»¥åšçš„äº‹æƒ…ï¼Œä½ å¯èƒ½æœ‰ç–‘é—® @command{awk} å¯¹ä½ æœ‰ä»€ä¹ˆç”¨å¤„ã€‚é€šè¿‡ä½¿ç”¨å…¶ä»–å·¥å…·ç¨‹åºï¼Œæ›´é«˜çº§çš„æ¨¡å¼ï¼ŒåŸŸåˆ†éš”ç¬¦ï¼Œç®—æœ¯è¯­å¥ä»¥åŠå…¶ä»–çš„é€‰æ‹©æ–¹æ¡ˆï¼Œä½ å¯ä»¥äº§ç”Ÿæ›´ä¸ºå¤æ‚çš„è¾“å‡ºã€‚
@command{awk} å¯¹äºä»å¤§é‡çš„åŸå§‹æ•°æ®äº§ç”ŸæŠ¥è¡¨çš„åœºæ™¯ä¸­éå¸¸ç”¨æœ‰ï¼Œå¦‚ä»å…¶ä»–çš„å·¥å…·ï¼Œå¦‚ @command{ls} çš„è¾“å‡ºä¸­æ±‡æ€»ä¿¡æ¯ã€‚ï¼ˆ@ref{More Complex}ï¼‰

ç”¨ @command{awk} è¯­è¨€å†™çš„ç¨‹åºä¸€èˆ¬ä¼šæ¯”è¾ƒå…¶ä»–çš„è¯­è¨€æ‰€å†™çš„ç¨‹åºè¦çŸ­ã€‚è¿™ä½¿å¾— @command{awk} ç¨‹åºéå¸¸å®¹æ˜“ç»„åˆä¸ä½¿ç”¨ã€‚
@command{awk} å¸¸å¸¸åœ¨â€œç”¨åå³ä¸¢â€çš„åœºæ™¯ä¸­å¿«é€Ÿå®ç°ä½ çš„ä»£ç ã€‚ç”±äº @command{awk} æ˜¯è§£é‡Šå‹çš„ï¼Œè¿™å°±é¿å…äº†åœ¨ç¼–è¾‘-ç¼–è¯‘-æµ‹è¯•-è°ƒè¯•è¿™æ ·çš„ç¨‹åºå¼€å‘æµç¨‹çš„ç¼–è¯‘æµç¨‹ï¼Œè€Œè¿™ä¸ªæµç¨‹é€šå¸¸éƒ½æ¯”è¾ƒé•¿ã€‚

@cindex Brian Kernighan's @command{awk}
ä¹Ÿæœ‰éå¸¸å¤æ‚ @command{awk} ç¨‹åºï¼ŒåŒ…æ‹¬ä¸€ä¸ªå®Œæ•´çš„å¯é‡å®šä½çš„ä¸º
@ifclear FOR_PRINT
 8 ä½å¾®å¤„ç†å†™çš„æ±‡ç¼–å™¨ï¼ˆ@pxref{Glossary}ï¼Œå–å¾—è¯¦ç»†ä¿¡æ¯ï¼‰ï¼Œ
@end ifclear
@ifset FOR_PRINT
 8 ä½å¾®å¤„ç†å†™çš„æ±‡ç¼–å™¨ï¼Œ
@end ifset
ä»¥åŠä¸ºä¸“ç”¨çš„ Prolog è®¡ç®—æœºå†™çš„å¾®ä»£ç çš„æ±‡ç¼–å™¨ã€‚èµ·åˆçš„ @command{awk} çš„èƒ½åŠ›æ²¡æœ‰åŠæ³•å®Œæˆè¿™ä¹ˆå¤æ‚çš„ä»»åŠ¡ï¼Œä½†æ˜¯ç°ä»£ç‰ˆæœ¬çš„ @command{awk} åˆ™å…·å¤‡äº†è¿™æ ·çš„èƒ½åŠ›ã€‚

@cindex @command{awk} programs, complex
å¦‚æœä½ å‘ç°ä½ å¯èƒ½éœ€è¦å†™å¥½å‡ ç™¾è¡Œçš„ @command{awk} ç¨‹åºä»£ç ï¼Œä½ æˆ–è®¸åº”è¯¥è€ƒè™‘ä½¿ç”¨å…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ï¼ŒShell å°±å¯¹å­—ä¸²å¤„ç†ä¸åŒ¹é…å°±å¾ˆåœ¨è¡Œï¼›
å¦å¤–ï¼Œå®ƒä¹Ÿå¯ä»¥è®©ä½ å……åˆ†ä½¿ç”¨ç³»ç»Ÿä¸­çš„å¼ºå¤§å·¥å…·ã€‚Python åœ¨é«˜å±‚çº§ä¸Šçš„è¯­è¨€ç¼–ç¨‹æ–¹ä¾¿æ€§ä¸ä½¿ç”¨ç³»ç»Ÿå·¥å…·ä¹‹é—´æä¾›äº†å¾ˆå¥½çš„å¹³è¡¡ã€‚
@footnote{å…¶ä»–çš„æµè¡Œçš„å·¥å…·åŒ…æ‹¬ Ruby ä¸ Perlã€‚}

@node Intro Summary
@section æ€»ç»“

@c FIXME: Review this chapter for summary of builtin functions called.
@itemize @value{BULLET}
@item
@command{awk} ç¨‹åºç”±@var{æ¨¡å¼}-@var{åŠ¨ä½œ}å¯¹ç»„æˆã€‚

@item
æ²¡æœ‰@var{æ¨¡å¼}çš„@var{åŠ¨ä½œ}ä¹Ÿä¼šè¿è¡Œã€‚å¯¹äºæ²¡æœ‰@var{æ¨¡å¼}çš„é»˜è®¤@var{åŠ¨ä½œ}å°±æ˜¯ @samp{@{ print $0 @}} ã€‚

@item
è¦ä¹ˆä½¿ç”¨
 @samp{awk '@var{program}' @var{files}} 
æˆ–è€…
 @samp{awk -f @var{program-file} @var{files}} 
æ¥è¿è¡Œ @command{awk} ã€‚

@item
ä½ å¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„ @samp{#!} å­—ä¸²æ”¾åœ¨ @command{awk} ç¨‹åºçš„ç¬¬ä¸€è¡Œæ¥ç›´æ¥æ‰§è¡Œã€‚

@item
@command{awk} ç¨‹åºçš„æ³¨é‡Šä»¥ @samp{#} å¼€å§‹ï¼Œå¹¶æŒç»­åˆ°åŒä¸€è¡Œçš„ç»“æŸã€‚

@item
å½“åœ¨å†™å¤§çš„è„šæœ¬çš„ä¸€éƒ¨ä»½æ—¶ï¼Œ@command{awk} æ—¶å€™è¦æ³¨æ„å¼•å·é—®é¢˜ï¼ˆæˆ–è€… MS-Windows çš„æ‰¹å¤„ç†æ–‡ä»¶ï¼‰ã€‚

@item
å¯ä»¥ä½¿ç”¨åæ–œæ æ¥è¿›è¡Œæºä»£ç ç»­è¡Œã€‚ä¹Ÿå¯ä»¥åœ¨é€—å· @samp{,} ï¼Œå¼€å¤§æ‹¬å· @samp{@{} ï¼Œé—®å· @samp{?} ï¼Œå†’å· @samp{:}ï¼Œ@samp{||}ï¼Œ@samp{&&}ï¼Œ@samp{do}ï¼Œä¸ @samp{else} åé¢è‡ªåŠ¨ç»­è¡Œã€‚
@end itemize


@node Invoking Gawk
@chapter è¿è¡Œ @command{awk} ä¸ @command{gawk}


æœ¬@value{CHAPTER}çš„å†…å®¹åŒ…æ‹¬å¦‚ä½•æ¥è¿è¡Œ @command{awk} ï¼Œä»‹ç» POSIX æ ‡å‡†çš„ä¸ @command{gawk} ç‰¹å®šçš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œ
ä»¥åŠ @command{awk} ä¸ @command{gawk} ä¸å¸¦å‚æ•°è¿è¡Œæ—¶çš„æƒ…å½¢ã€‚åé¢å†æ¶‰åŠ @command{gawk} å¦‚ä½•æ¥æœç´¢æ–‡ä»¶ï¼Œåœ¨è¯»å–å…¶ä»–æ–‡ä»¶çš„åŒæ—¶ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ï¼Œ@command{gawk} çš„ç¯å¢ƒå˜é‡ï¼Œé€€å‡ºçŠ¶æ€ï¼Œä½¿ç”¨åŒ…å«æ–‡ä»¶ï¼Œä»¥åŠé‚£äº›è¿‡æ—¶çš„ï¼Œæœªæ–‡æ¡£åŒ–çš„é€‰é¡¹ä¸ç‰¹æ€§ã€‚

æœ¬@value{CHAPTER}ä¸­çš„è®¸å¤šç‰¹æ€§ä¸é€‰é¡¹åœ¨åé¢çš„@value{CHAPTER}ä¸­ä¼šæ›´è¯¦ç»†åœ°è¯´æ˜ã€‚å¯ä»¥è·³è¿‡æœ¬@value{CHAPTER}ä¸­é‚£äº›ä½ ç°åœ¨ä¸æ„Ÿå…´è¶£çš„å†…å®¹ã€‚

@menu
* Command Line::                How to run @command{awk}.
* Options::                     Command-line options and their meanings.
* Other Arguments::             Input file names and variable assignments.
* Naming Standard Input::       How to specify standard input with other
                                files.
* Environment Variables::       The environment variables @command{gawk} uses.
* Exit Status::                 @command{gawk}'s exit status.
* Include Files::               Including other files into your program.
* Loading Shared Libraries::    Loading shared libraries into your program.
* Obsolete::                    Obsolete Options and/or features.
* Undocumented::                Undocumented Options and Features.
* Invoking Summary::            Invocation summary.
@end menu

@node Command Line
@section è°ƒç”¨ @command{awk}
@cindex command line, invoking @command{awk} from
@cindex @command{awk}, invoking
@cindex arguments, command-line, invoking @command{awk}
@cindex options, command-line, invoking @command{awk}

æœ‰ä¸¤ç§æ–¹å¼æ¥è¿è¡Œ @command{awk}â€”â€”å¸¦æ˜¾å¼ç¨‹åºçš„æ–¹å¼æˆ–è€…æ˜¯ä¸€åˆ°å¤šä¸ªçš„ç¨‹åºæ–‡ä»¶æ–¹å¼ã€‚ä¸‹é¢æ˜¯ä¸¤ç§è¿è¡Œæ–¹å¼çš„æ¨¡å¼ï¼›åœ¨ [@dots{}] ä¸­åŒ…æ‹¬å†…å®¹æ˜¯å¯é€‰ï¼š

@display
@command{awk} [@var{options}] @option{-f} @var{progfile} [@option{--}] @var{file} @dots{}
@command{awk} [@var{options}] [@option{--}] @code{'@var{program}'} @var{file} @dots{}
@end display

@cindex GNU long options
@cindex long options
@cindex options, long
é™¤æ”¯æŒä¼ ç»Ÿçš„å•å­—æ¯çš„ POSIX é€‰é¡¹å¤–ï¼Œ @command{gawk} ä¹Ÿæ”¯æŒ GNU é•¿æ ¼å¼çš„é€‰é¡¹ã€‚

@cindex dark corner, invoking @command{awk}
@cindex lint checking, empty programs
ä¹Ÿå¯ä»¥ç”¨ç©ºç¨‹åºçš„æ–¹å¼è°ƒç”¨ @command{awk}ï¼š

@example
awk '' datafile1 datafile2
@end example

@cindex @option{--lint} option
@noindent
ä½†æ˜¯ï¼Œè¿™æ ·åšåŸºæœ¬æ²¡ä»€ä¹ˆç”¨ã€‚å½“ç¨‹åºå†…å®¹ä¸ºç©ºæ—¶ï¼Œ@command{awk} ä¼šå®‰é™åœ°é€€å‡ºã€‚
@value{DARKCORNER}
å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­è¿›è¡Œäº†æŒ‡å®šäº† @option{--lint} å‚æ•°ï¼Œ@command{gawk} ä¼šè­¦å‘Šè¯´ï¼Œç¨‹åºä¸ºç©ºã€‚

@node Options
@section å‘½ä»¤è¡Œå‚æ•°
@cindex options, command-line
@cindex command line, options
@cindex GNU long options
@cindex options, long

é€‰é¡¹ä»¥æ¨ªæ å¼€å§‹ï¼Œåé¢æ¥ä¸€ä¸ªå­—ç¬¦ã€‚GNU é£æ ¼çš„é•¿é€‰é¡¹ï¼Œåˆ™æ˜¯ä¸¤ä¸ªæ¨ªæ åé¢å¸¦å…³é”®å­—ã€‚å…³é”®å­—å¯ä»¥æ˜¯ç¼©å†™çš„ï¼Œåªè¦ç¼©å†™ä½¿å¾—é€‰é¡¹æ˜¯å¯è¯†åˆ«çš„å”¯ä¸€æ ‡è¯†å³å¯ã€‚å¦‚æœé€‰é¡¹å¸¦å‚æ•°ï¼Œè¦ä¹ˆæ˜¯å…³é”®å­—åé¢ç›´æ¥è·Ÿä¸€ä¸ªç­‰äºå·ï¼ˆ@samp{=}ï¼‰åŠ ä¸Šå‚æ•°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯å…³é”®å­—ä¸å‚æ•°çš„å€¼é€šè¿‡ç©ºæ ¼åˆ†éš”ã€‚å¦‚æœç‰¹å®šçš„é€‰é¡¹æœ‰å¤šä¸ªå€¼ï¼Œé‚£ä¹ˆåªæœ‰æœ€åä¸€ä¸ªå€¼æœ‰æ•ˆã€‚

@cindex POSIX @command{awk}, GNU long options and
@command{gawk} çš„æ¯ä¸€ä¸ªé•¿é€‰é¡¹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ POSIX é£æ ¼çš„çŸ­é€‰é¡¹ã€‚é•¿çŸ­é€‰é¡¹åœ¨æ‰€æœ‰çš„ä¸Šä¸‹æ–‡ä¸­éƒ½å¯ä»¥äº’ç›¸æ›¿æ¢çš„ã€‚ä¸‹é¢çš„åˆ—è¡¨åˆ—å‡ºäº† POSIX æ ‡å‡†ä¸­è§„å®šçš„é€‰é¡¹ï¼š

@table @code
@item -F @var{fs}
@itemx --field-separator @var{fs}
@cindex @option{-F} option
@cindex @option{--field-separator} option
@cindex @code{FS} variable, @code{--field-separator} option and
Set the @code{FS} variable to @var{fs}
è®¾ç½® @code{FS} å˜é‡çš„å€¼ä¸º @var{fs}ï¼ˆ@pxref{Field Separators}ï¼‰ã€‚

@item -f @var{source-file}
@itemx --file @var{source-file}
@cindex @option{-f} option
@cindex @option{--file} option
@cindex @command{awk} programs, location of
ä»@var{æºç¨‹åºæ–‡ä»¶}ä¸­è¯»å– @command{awk} ç¨‹åºï¼Œè€Œä¸æ˜¯ç¬¬ä¸€ä¸ªéé€‰é¡¹çš„å‚æ•°ã€‚è¿™ä¸ªé€‰é¡¹å¯ä»¥æŒ‡å®šå¤šæ¬¡ï¼›@command{awk} çš„ç¨‹åºå¯ä»¥ç”±æ¯ä¸€ä¸ªæŒ‡å®šçš„@var{æºç¨‹åºæ–‡ä»¶}è¿æ¥è€Œæˆã€‚

@item -v @var{var}=@var{val}
@itemx --assign @var{var}=@var{val}
@cindex @option{-v} option
@cindex @option{--assign} option
@cindex variables, setting
åœ¨æ‰§è¡Œç¨‹åº@emph{ä¹‹å‰}ï¼Œè®¾ç½®@var{å˜é‡}å€¼ä¸º @var{val}ã€‚è¿™ä¸ªå˜é‡åœ¨ @code{BEGIN} è§„åˆ™ä¸­å¯ç”¨ï¼ˆ@pxref{Other Arguments}ï¼‰ã€‚

@option{-v} é€‰é¡¹åªå¯ä»¥è®¾ç½®ä¸€ä¸ªå˜é‡ï¼›ä½†æ˜¯å¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼Œå¦‚æ­¤æ¥è®¾ç½®å¦ä¸€ä¸ªå˜é‡çš„å€¼ï¼š
@samp{awk @w{-v foo=1} @w{-v bar=2} @dots{}} ã€‚

@cindex predefined variables, @code{-v} option@comma{} setting with
@cindex variables, predefined @code{-v} option@comma{} setting with
@quotation æ³¨æ„
ä½¿ç”¨ @option{-v} é€‰é¡¹è®¾ç½®å†…ç½®å˜é‡çš„å€¼å¯èƒ½å¯¼è‡´ä»¤äººæƒŠè®¶çš„ç»“æœã€‚@command{awk} åœ¨éœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥é‡æ–°è®¾ç½®è¿™äº›å˜é‡çš„å€¼ï¼Œè€Œå¿½ç•¥ä½ æŒ‡å®šçš„ä»»ä½•åˆå§‹å€¼ã€‚
@end quotation

@item -W @var{gawk-opt}
@cindex @option{-W} option
é€‰æ‹©ä¸€ä¸ªå®ç°æœ‰å…³çš„é€‰é¡¹ã€‚è¿™æ˜¯ä¸ºç‰¹å®šå®ç°è€Œæä¾›çš„ä¸€ç§ POSIX è½¬æ¢ã€‚è¿™ä¸ªé€‰é¡¹ä¹Ÿæœ‰ä¸€ä¸ª GNU é£æ ¼çš„é•¿é€‰é¡¹ã€‚æ³¨æ„é•¿é€‰é¡¹æ˜¯å¯ä»¥ç¼©å†™çš„ï¼Œåªè¦ä¿è¯ç¼©å†™æ˜¯å”¯ä¸€çš„å³å¯ã€‚ç‰¹å®šäº @command{gawk} çš„é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ä¸‹é¢ä¼šåˆ—å‡ºã€‚

@item --
@cindex command line, options, end of
@cindex options, command-line, end of
æŒ‡ç¤ºå‘½ä»¤è¡Œé€‰é¡¹çš„ç»“æŸã€‚åç»­çš„å‚æ•°ä¸ä¼šè¢«è¯†åˆ«ä¸ºé€‰é¡¹ï¼Œå³ä½¿å®ƒä»¬ä»¥ @samp{-} å¼€å§‹ã€‚
å¯¹äº @option{--} çš„è§£é‡Šæ˜¯å‚ç…§ POSIX çš„å‚æ•°åˆ†æä¹ æƒ¯ã€‚

@cindex @code{-} (hyphen), filenames beginning with
@cindex hyphen (@code{-}), filenames beginning with
å¦‚æœä½ æœ‰ä¸€ä¸ª@value{FN}ä»¥ @samp{-} å¼€å§‹ï¼Œè¿™ä¸ªå‚æ•°åˆ™éå¸¸æœ‰ç”¨ï¼Œæˆ–è€…åœ¨ Shell è„šæœ¬é‡Œï¼Œ@value{FN}ä¼šç”±ç”¨æˆ·æ¥æŒ‡å®šã€‚åœ¨æŠŠå‚æ•°ä¼ é€’ç»™ @command{awk} ç¨‹åºä¸Šï¼Œè¿™ä¸ªå‚æ•°ä¹Ÿéå¸¸æœ‰ç”¨ã€‚æŸ¥çœ‹ @ref{Getopt Function}ã€‚
@end table

ä¸‹é¢çš„é€‰é¡¹æ˜¯ç‰¹å®šäº @command{gawk} çš„é€‰é¡¹ï¼š

@c Have to use @asis here to get docbook to come out right.
@table @asis
@item @option{-b}
@itemx @option{--characters-as-bytes}
@cindex @option{-b} option
@cindex @option{--characters-as-bytes} option
æŒ‡å®š @command{gawk} å°†è¾“å…¥çš„æ•°æ®æŒ‰ç…§å•å­—èŠ‚çš„æ–¹å¼å¯¹å¾…ã€‚å¦å¤–ï¼Œæ‰€æœ‰çš„ç”± @code{print} æˆ–è€… @code{printf} çš„è¾“å‡ºä¹Ÿä»¥å•å­—èŠ‚çš„æ–¹å¼å¯¹å¾…ã€‚

æ­£å¸¸æƒ…å†µä¸‹ï¼Œ@command{gawk} ä¼šæŒ‰ç…§ POSIX çš„æ ‡å‡†ï¼ŒæŒ‰ç…§å½“å‰è¯­è¨€è®¾ç½®æ¥å¤„ç†è¾“å…¥æ•°æ®ï¼ˆ@pxref{Locales}ï¼‰ã€‚
è¿™å¸¸å¸¸å¯¼è‡´å°†å¤šå­—èŠ‚å­—ç¬¦è½¬æ¢ä¸ºå®½å­—ç¬¦ï¼ˆå†…éƒ¨å¤„ç†äº†ï¼‰ï¼Œå½“è¾“å…¥çš„æ•°æ®ä¸æ˜¯æœ‰æ•ˆçš„å¤šå­—èŠ‚å­—ç¬¦æ—¶ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸€äº›é—®é¢˜æˆ–è€…ç–‘æƒ‘ã€‚è¿™ä¸ªé€‰é¡¹ç®€å•åœ°å‘Šè¯‰ @command{gawk} ï¼Œâ€œåˆ«ç¢°æˆ‘çš„æ•°æ®ï¼â€

@item @option{-c}
@itemx @option{--traditional}
@cindex @option{-c} option
@cindex @option{--traditional} option
@cindex compatibility mode (@command{gawk}), specifying
æŒ‡å®šå…¼å®¹æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ @command{awk} çš„ GNU æ‰©å±•ä¼šè¢«ç¦ç”¨ï¼Œè¿™æ · @command{gawk} çš„è¡¨ç°å°±è·Ÿ BWK @command{awk} ä¸€è‡´ã€‚
@ref{POSIX/GNU}ï¼Œå…¶ä¸­æ±‡æ€»äº†æ‰€æœ‰çš„æ‰©å±•ã€‚
@ifclear FOR_PRINT
ä¹Ÿå¯ä»¥å‚è€ƒ @ref{Compatibility Mode}ã€‚
@end ifclear

@item @option{-C}
@itemx @option{--copyright}
@cindex @option{-C} option
@cindex @option{--copyright} option
@cindex GPL (General Public License), printing
æ‰“å°ç®€å•ç‰ˆæœ¬çš„é€šç”¨è®¸å¯è¯åè®®ï¼ˆGeneral Public Licenseï¼ŒGPLï¼‰ç„¶åé€€å‡ºã€‚

@item @option{-d}[@var{file}]
@itemx @option{--dump-variables}[@code{=}@var{file}]
@cindex @option{-d} option
@cindex @option{--dump-variables} option
@cindex dump all variables of a program
@cindex @file{awkvars.out} file
@cindex files, @file{awkvars.out}
@cindex variables, global, printing list of
æ‰“å°ç»è¿‡æ’åºçš„å…¨å±€å˜é‡ï¼Œä»¥åŠå®ƒä»¬çš„ç±»å‹ï¼Œä»¥åŠæœ€ç»ˆå€¼åˆ° @var{file} ä¸­ã€‚å¦‚æœæ²¡æœ‰æä¾› @var{file} å‚æ•°ï¼Œå°±æŠŠè¿™ä¸ªåˆ—è¡¨æ‰“å°åˆ°ä¸€ä¸ª @file{awkvars.out} çš„æ–‡ä»¶ä¸­ï¼Œå¹¶è¾“å‡ºåœ¨å½“å‰ç›®å½•ã€‚å¦‚æœæä¾›äº† @var{file} å‚æ•°ï¼Œåœ¨ @option{-d} å‚æ•°ä¸ @var{file} ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚

@cindex troubleshooting, typographical errors@comma{} global variables
æŸ¥çœ‹å…¨å±€å˜é‡åˆ—è¡¨ï¼Œæ˜¯ä¸€ç§æŸ¥æ‰¾ç¨‹åºä¸­è¾“å…¥é”™è¯¯çš„ä¸€ç§å¥½æ–¹æ³•ã€‚å¦‚æœä½ çš„ç¨‹åºå¾ˆå¤§ï¼Œè€Œå‡½æ•°å¾ˆå¤šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œæ¥ç¡®å®šä½ çš„å‡½æ•°æ˜¯å¦æœ‰è¿™ç§æƒ…å†µï¼Œå³æœ¬æ¥ä½¿ç”¨æœ¬åœ°å˜é‡å´é”™è¯¯åœ°ä½¿ç”¨äº†å…¨å±€å˜é‡ã€‚ï¼ˆè¿™ä¸ªåœ¨å°†å˜é‡åå‘½ä»¤ä¸º @code{i}ï¼Œ@code{j} ç­‰ç­‰åå­—çš„æƒ…å†µä¸‹å°¤å…¶å®¹æ˜“å‡ºé”™ã€‚ï¼‰

@item @option{-D}[@var{file}]
@itemx @option{--debug}[@code{=}@var{file}]
@cindex @option{-D} option
@cindex @option{--debug} option
@cindex @command{awk} debugging, enabling
å¯ç”¨ @command{awk} ç¨‹åºè°ƒè¯•ï¼ˆ@pxref{Debugging}ï¼‰ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒè¯•å™¨ä»é”®ç›˜ä¸­äº¤äº’å¼åœ°è¯»å…¥å‘½ä»¤ã€‚å¯é€‰å‚æ•° @var{file} å¯ä»¥è®©ä½ æŒ‡å®šåœ¨æ–‡ä»¶ä¸­çš„å‘½ä»¤è¡Œåˆ—è¡¨ï¼Œè€Œä¸æ˜¯äº¤äº’åœ°è¾“å…¥ã€‚
å¦‚æœä½ æä¾›äº† @var{file} å‚æ•°ï¼Œåˆ™åœ¨ @option{-D} ä¸ @var{file} ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚

@item @option{-e} @var{program-text}
@itemx @option{--source} @var{program-text}
@cindex @option{-e} option
@cindex @option{--source} option
@cindex source code, mixing
åœ¨ @var{program-text} ä¸­æŒ‡å®šæºä»£ç ã€‚è¿™ä¸ªé€‰é¡¹å¯ä»¥è®©ä½ æ··ç”¨é€šè¿‡æ–‡ä»¶ä¸é€šè¿‡å‘½ä»¤è¡Œæ¥æä¾›æºä»£ç çš„æ–¹å¼ã€‚è¿™ä¸ªé€‰é¡¹åœ¨ä½ æœ‰è‡ªå·±çš„åº“å‡½æ•°è¦ä½¿ç”¨ï¼Œä½†æ˜¯ä½ åˆé€šè¿‡å‘½ä»¤è¡Œæ¥è½¬å…¥ç¨‹åºçš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚ï¼ˆ@pxref{AWKPATH Variable}ï¼‰ã€‚

@item @option{-E} @var{file}
@itemx @option{--exec} @var{file}
@cindex @option{-E} option
@cindex @option{--exec} option
@cindex @command{awk} programs, location of
@cindex CGI, @command{awk} scripts for
ä¸ @option{-f} å‚æ•°ç±»ä¼¼ï¼Œ@command{awk} ä» @var{file} ä¸­è¯»å–ç¨‹åºã€‚ä¸ @option{-f} ç›¸æ¯”ï¼Œæœ‰ä¸¤ä¸ªä¸åŒï¼š

@itemize @value{BULLET}
@item
è¿™ä¸ªé€‰é¡¹ä¼šç»“æŸé€‰é¡¹çš„å¤„ç†ï¼›ä»»ä½•åœ¨å‘½ä»¤è¡Œä¸Šåç»­çš„å…¶ä»–å‚æ•°éƒ½å°†ç›´æ¥ä¼ é€’ç»™ @command{awk} ç¨‹åºã€‚

@item
å‘½ä»¤å˜é‡èµ‹å€¼å½¢å¼ @samp{@var{var}=@var{value}} ä¹Ÿå°†ç¦æ­¢ã€‚
@end itemize

è¿™ä¸ªé€‰é¡¹åœ¨å†™ WWW CGI ç¨‹åºæ—¶é€šè¿‡ URL ä¼ ç»Ÿå‚æ•°æ—¶éå¸¸æœ‰ç”¨ã€‚é€šè¿‡è¿™ä¸ªé€‰é¡¹å¯ä»¥é˜²æ­¢ä¸€äº›æœ‰å®³çš„ï¼ˆæˆ–è€…å…¶ä»–çš„ï¼‰ç”¨æˆ·å°†é€‰é¡¹ï¼Œèµ‹å€¼ä»¥åŠ @command{awk} æºä»£ç ï¼ˆé€šè¿‡ @option{-e} é€‰é¡¹ï¼‰ä¼ é€’ç»™ CGI åº”ç”¨ã€‚
@footnote{è¦è·å–æ›´å¤šçš„ç»†èŠ‚ï¼Œè¯·å‚è€ƒ @uref{http://www.ietf.org/rfc/rfc3875,
RFC 3875} çš„ Section 4.4ã€‚
ä¹Ÿå¯ä»¥æŸ¥çœ‹ @uref{http://lists.gnu.org/archive/html/bug-gawk/2014-11/msg00022.html, å‘é€åˆ° @command{gawk} çš„ bug mailing åˆ—è¡¨ä¸­çš„è§£é‡Š}ã€‚}
è¿™ä¸ªé€‰é¡¹éœ€è¦ä¸ @samp{#!} è„šæœ¬ä¸€èµ·ä½¿ç”¨ï¼ˆ@pxref{Executable Scripts}ï¼‰ï¼Œä¾‹å¦‚è¿™æ ·ï¼š

@example
#! /usr/local/bin/gawk -E

@var{awk program here @dots{}}
@end example

@item @option{-g}
@itemx @option{--gen-pot}
@cindex @option{-g} option
@cindex @option{--gen-pot} option
@cindex portable object files, generating
@cindex files, portable object, generating
åˆ†ææºç¨‹åºä¸­çš„å·²ç»åšäº†ç¿»è¯‘æ ‡å¿—æ‰€æœ‰å­—ä¸²å¸¸é‡ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª GNU @command{gettext} å¯ç§»æ¤çš„å¯¹è±¡æ¨¡æ¿æ–‡ä»¶åˆ°æ ‡å‡†è¾“å‡ºä¸Šã€‚
@ref{Internationalization}ï¼Œæ¥å–å¾—è¿™ä¸ªé€‰é¡¹çš„ç›¸å…³ä¿¡æ¯ã€‚

@item @option{-h}
@itemx @option{--help}
@cindex @option{-h} option
@cindex @option{--help} option
@cindex GNU long options, printing list of
@cindex options, printing list of
@cindex printing, list of options
æ‰“å°â€œä½¿ç”¨æ–¹å¼â€ä¿¡æ¯ï¼Œæ±‡æ€» @command{gawk} æ¥æ”¶çš„é•¿ã€çŸ­é£æ ¼çš„é€‰é¡¹ç„¶åé€€å‡ºã€‚

@item @option{-i} @var{source-file}
@itemx @option{--include} @var{source-file}
@cindex @option{-i} option
@cindex @option{--include} option
@cindex @command{awk} programs, location of
ä» @var{source-file} è¯»å– @command{awk} æºåº“ã€‚è¿™ä¸ªé€‰é¡¹ä¸åœ¨ä½ çš„ç¨‹åºä¸­çš„ @code{@@include} ç­‰åŒã€‚
ä¹Ÿéå¸¸ç±»ä¼¼äº @option{-f} é€‰é¡¹ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªé‡è¦çš„ä¸åŒã€‚
é¦–å…ˆï¼Œå½“ @option{-i} æŒ‡å®šæ—¶ï¼Œå¦‚æœæºç¨‹åºä¹‹å‰å·²ç»è£…è½½è¿‡äº†ï¼Œåˆ™ä¸ä¼šå†è¢«è£…è½½ï¼Œè€Œå½“ä½¿ç”¨ @option{-f} æ—¶ï¼Œ@command{gawk} æ€»æ˜¯ä¼šè£…è½½æºæ–‡ä»¶ã€‚
ç¬¬äºŒï¼Œç”±äºè¿™ä¸ªé€‰é¡¹ç›®çš„æ˜¯ç”¨äºåº“ç±»å‹çš„ä»£ç ï¼Œ@command{gawk} ä¸ä¼šå°†è¿™äº›æ–‡ä»¶è¯†åˆ«æˆä¸»ç¨‹åºçš„è¿ç»­è¾“å…¥ã€‚
å› æ­¤ï¼Œåœ¨å¤„ç†äº† @option{-i} å‚æ•°åï¼Œ@command{gawk} è¿˜æ˜¯å¸Œæœ›é€šè¿‡å‘½ä»¤è¡Œçš„ @option{-f} å‚æ•°æ¥å–å¾—ä¸»ç¨‹åºæºä»£ç ã€‚

@item @option{-l} @var{ext}
@itemx @option{--load} @var{ext}
@cindex @option{-l} option
@cindex @option{--load} option
@cindex loading, extensions
è½½å…¥ä¸€ä¸ªåä¸º @var{ext} çš„åŠ¨æ€æ‰©å±•ã€‚æ‰©å±•å­˜å‚¨ä¸ºç³»ç»Ÿçš„å…±äº«åŠ¨æ€åº“ã€‚
è¿™ä¸ªé€‰é¡¹ä½¿ç”¨ @env{AWKLIBPATH} å˜é‡æ¥æœç´¢åº“ã€‚æ­£ç¡®çš„åº“åç¼€ä¼šæ ¹æ®ç³»ç»Ÿé»˜è®¤æä¾›ï¼Œå› æ­¤ä½ ä¸éœ€è¦æŒ‡å®šæ‰©å±•åã€‚
æ‰©å±•çš„åˆå§‹åŒ–å‡½æ•°ä¸º @code{dl_load()}ã€‚
å¦å¤–ä¸€ä¸ªé€‰é¡¹å°±æ˜¯é€šè¿‡åœ¨ç¨‹åºä¸­é€šè¿‡ @code{@@load} å…³é”®å­—æ¥è£…è½½å…±äº«åº“ã€‚
è¿™ä¸ªé«˜çº§ç‰¹æ€§çš„è¯¦ç»†è¯´æ˜åœ¨ @ref{Dynamic Extensions}ã€‚

@item @option{-L}[@var{value}]
@itemx @option{--lint}[@code{=}@var{value}]
@cindex @option{-l} option
@cindex @option{--lint} option
@cindex lint checking, issuing warnings
@cindex warnings, issuing
å¯¹äºå¯ç–‘çš„æˆ–è€…ä¸å¯ç§»æ¤åˆ°å…¶ä»– @command{awk} å®ç°çš„ç»“æœæå‡ºå‘Šè­¦ã€‚
å¦‚æœæä¾›äº† @var{value}ï¼Œåˆ™ @option{-L} å‚æ•°ä¸ @var{value} ä¹‹é—´ä¸å¯ä»¥æœ‰ç©ºæ ¼ã€‚
ä¸€äº›è­¦å‘Šä¼šåœ¨ç¬¬ä¸€æ¬¡è¯»å…¥ç¨‹åºæ—¶å°±ä¼šç»™å‡ºã€‚è€Œå…¶ä»–çš„ä¸€äº›ä¼šåœ¨è¿è¡Œæ—¶ç»™å‡ºã€‚å½“å¯é€‰å‚æ•°çš„å€¼æ˜¯ @samp{fatal}ï¼Œlint è­¦å‘Šå°±æˆäº†è‡´å‘½é”™è¯¯ã€‚
è¿™å¯èƒ½æœ‰ç‚¹å¤¸å¼ ï¼Œä½†æ˜¯è¿™ç¡®å®èƒ½å¤Ÿåˆºæ¿€å¼€å‘è€…å¼€å‘å‡ºæ›´åŠ â€œå¹²å‡€â€çš„ @command{awk} ç¨‹åºã€‚
å¦‚æœå¯é€‰å‚æ•°çš„å€¼ä¸º @samp{invalid}ï¼Œåˆ™åªæœ‰åœ¨ç¡®å®æ˜¯æ— æ•ˆçš„æƒ…å†µä¸‹æ‰ä¼šå‘å‡ºå‘Šè­¦ã€‚ï¼ˆè¿™ä¸ªè¿˜æ²¡æœ‰å®Œå…¨å®ç°ï¼‰

æœ‰äº›å‘Šè­¦åªæ‰“å°ä¸€æ¬¡ï¼Œå°±ç®—è¿™æ ·çš„å¯ç–‘ç»“æœåœ¨ä½ çš„ @command{awk} ç¨‹åºä¸­å‡ºç°å¤šæ¬¡ã€‚
å› æ­¤ï¼Œå½“å»é™¤äº†ç”± @option{--lint} æ‰€æŠ¥å‘Šçš„é—®é¢˜æ—¶ï¼Œä½ åº”è¯¥è¦ä»”ç»†æ£€æŸ¥ä½ çš„ç¨‹åºä¸­æ‰€æœ‰ä¸æ°å½“çš„ç»“æ„ã€‚å¦‚æœä½ çš„ç¨‹åºä¸é•¿ï¼Œåšè¿™ä¸ªå·¥ä½œä¹Ÿä¸ä¼šæˆä¸ºä»€ä¹ˆè´Ÿæ‹…ã€‚

@item @option{-M}
@itemx @option{--bignum}
@cindex @option{-M} option
@cindex @option{--bignum} option
å¼ºåˆ¶å¯¹äºæ•°æ®è®¡ç®—ä½¿ç”¨ä»»æ„ç²¾åº¦ã€‚è¿™ä¸ªé€‰é¡¹å¦‚æœåœ¨ @command{gawk} ç¼–è¯‘æ—¶æ²¡æœ‰ä½¿ç”¨ GNU MPFR ä»¥åŠ MP åº“æ—¶ï¼Œä¸ä¼šèµ·ä½œç”¨ã€‚ï¼ˆæŸ¥çœ‹ @ref{Arbitrary Precision Arithmetic}ï¼‰
@item @option{-n}
@itemx @option{--non-decimal-data}
@cindex @option{-n} option
@cindex @option{--non-decimal-data} option
@cindex hexadecimal values@comma{} enabling interpretation of
@cindex octal values@comma{} enabling interpretation of
@cindex troubleshooting, @code{--non-decimal-data} option
å¯ç”¨è‡ªåŠ¨çš„å¯¹è¾“å…¥æ•°æ®çš„å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶å€¼çš„è‡ªåŠ¨è§£é‡Šï¼ˆæŸ¥çœ‹ @ref{Nondecimal Data}ï¼‰ã€‚

@quotation æ³¨æ„
è¿™ä¸ªé€‰é¡¹æœ‰å¯èƒ½ä¸¥é‡ç ´åæ—§çš„ç¨‹åºï¼Œå› æ­¤è¦å°å¿ƒä½¿ç”¨ã€‚åŒæ—¶ä¹Ÿæç¤ºï¼Œè¿™ä¸ªå‚æ•°å¯èƒ½åœ¨ @command{gawk} çš„åé¢çš„ç‰ˆæœ¬ä¼šè¢«å–æ¶ˆã€‚
@end quotation

@item @option{-N}
@itemx @option{--use-lc-numeric}
@cindex @option{-N} option
@cindex @option{--use-lc-numeric} option
å½“åˆ†ææ•°å€¼è¾“å…¥æ•°æ®æ—¶ï¼Œå¼ºåˆ¶ä½¿ç”¨å½“å‰çš„è¯­è¨€è®¾ç½®ï¼ˆcurrent localeï¼‰çš„åè¿›åˆ¶å°æ•°ç‚¹å­—ç¬¦ã€‚ï¼ˆæŸ¥çœ‹ @ref{Locales}ï¼‰

@item @option{-o}[@var{file}]
@itemx @option{--pretty-print}[@code{=}@var{file}]
@cindex @option{-o} option
@cindex @option{--pretty-print} option
å¯ç”¨ @command{awk} ç¨‹åºçš„ç®€å•æ‰“å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å‡ºç¨‹åºè¢«åˆ›å»ºåœ¨ä¸€ä¸ªæ–‡ä»¶åä¸º @file{awkprof.out} æ–‡ä»¶ä¸­ï¼ˆæŸ¥çœ‹ @ref{Profiling}ï¼‰ã€‚
å¯é€‰å‚æ•° @var{file} å¯ä»¥è®©ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªä¸åŒçš„@value{FN}ç”¨äºè¾“å‡ºã€‚å¦‚æœä½ æä¾›äº† @var{file} å‚æ•°ï¼Œåˆ™ @option{-o} é€‰é¡¹ä¸ @var{file} ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚

@quotation æç¤º
ç”±äº @command{gawk} æ¼”åŒ–çš„æ–¹å¼ï¼Œæœ‰è¿™ä¸ªå‚æ•°æ—¶ï¼Œä½ çš„ç¨‹åºä¾ç„¶ä¼šæ‰§è¡Œã€‚è¿™ä¸ªä¼šåœ¨ä¸‹ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤ @command{gawk} ä»…ç®€åŒ–æ‰“å°ç¨‹åºï¼Œè€Œä¸æ˜¯æ‰§è¡Œå®ƒã€‚
@end quotation

@item @option{-O}
@itemx @option{--optimize}
@cindex @option{--optimize} option
@cindex @option{-O} option
å¯ç”¨æŸäº›ç¨‹åºå†…éƒ¨è¡¨è¾¾å¼çš„ä¼˜åŒ–ã€‚åœ¨æ­¤æ—¶ï¼Œè¿™ä¸ªä»…ä»…åŒ…æ‹¬ä¸€äº›ç®€å•çš„å¸¸é‡æŠ˜å ã€‚ 

@item @option{-p}[@var{file}]
@itemx @option{--profile}[@code{=}@var{file}]
@cindex @option{-p} option
@cindex @option{--profile} option
@cindex @command{awk} profiling, enabling
å¯ç”¨ @command{awk} ç¨‹åºé‡‡æ ·åˆ†æï¼ˆæŸ¥çœ‹ @ref{Profiling}ï¼‰ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œé‡‡æ ·åˆ†æä¼šç”Ÿæˆæ–‡ä»¶åä¸º @file{awkprof.out}ã€‚
å¯é€‰å‚æ•° @var{file} å¯ä»¥è®©ä½ æŒ‡å®šä¸€ä¸ªä¸åŒçš„@value{FN}ã€‚å¦‚æœä½ æŒ‡å®šäº† @var{file} å‚æ•°ï¼Œåˆ™åœ¨ @option{-p} é€‰é¡¹ä¸ @var{file} å‚æ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚
é‡‡æ ·åˆ†æç»“æœä¸­åœ¨å·¦è¾¹åŒ…æ‹¬ç¨‹åºä¸­çš„æ¯æ¡è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ï¼Œä»¥åŠæ¯ä¸ªå‡½æ•°çš„å‡½æ•°è°ƒç”¨æ¬¡æ•°ã€‚

@item @option{-P}
@itemx @option{--posix}
@cindex @option{-P} option
@cindex @option{--posix} option
@cindex POSIX mode
@cindex @command{gawk}, extensions@comma{} disabling
ä¸¥æ ¼æŒ‰ POSIX æ¨¡å¼æ¥ã€‚è¿™ä¸ªç¦ç”¨æ‰€æœ‰çš„ @command{gawk} æ‰©å±•ï¼ˆå°±åƒ @option{--traditional} ä¸€æ ·ï¼‰ï¼Œå¹¶ç¦ç”¨æ‰€æœ‰ä¸å±äº POSIX çš„æ‰©å±•ï¼Œ

@itemize @value{BULLET}

@cindex newlines
@cindex whitespace, newlines as
@item
å½“ @code{FS} ç­‰äºå•ä¸ªç©ºæ ¼æ—¶ï¼Œæ–°è¡Œä¸ä¼šåƒç©ºæ ¼ä¸€æ ·ç”¨æ¥è¿›è¡ŒåŸŸåˆ†éš”ï¼ˆæŸ¥çœ‹ @ref{Fields}ï¼‰ã€‚

@item
åœ¨ @samp{?} æˆ–è€… @samp{:} åä¸èƒ½æ–­è¡Œï¼ˆæŸ¥çœ‹ @ref{Conditional Exp}ï¼‰ã€‚


@cindex @code{FS} variable, as TAB character
@item
æŒ‡å®š @samp{-Ft} æ—¶ï¼Œä¸èƒ½å°† @code{FS} çš„å€¼è®¾ç½®ä¸ºå•ä¸€çš„ TAB å­—ç¬¦ï¼ˆæŸ¥çœ‹ @ref{Field Separators}ï¼‰ã€‚

@cindex locale decimal point character
@cindex decimal point character, locale specific
@item
è¯­è¨€è®¾ç½®ä¸­çš„åè¿›åˆ¶å°æ•°ç‚¹å­—ç¬¦ç”¨æ¥åˆ†æè¾“å…¥æ•°æ®ï¼ˆæŸ¥çœ‹ @ref{Locales}ï¼‰ã€‚
@end itemize

@c @cindex automatic warnings
@c @cindex warnings, automatic
@cindex @option{--traditional} option, @code{--posix} option and
@cindex @option{--posix} option, @code{--traditional} option and
å¦‚æœä½ å³æä¾›äº† @option{--traditional} ä¸ @option{--posix} å‚æ•°åœ¨å‘½ä»¤è¡Œä¸­ï¼Œ@option{--posix} ä¼šä¼˜å…ˆæ‰§è¡Œã€‚@command{gawk} åˆ™ä¼šè¾“å‡ºä¸€ä¸ªè­¦å‘Šã€‚

@item @option{-r}
@itemx @option{--re-interval}
@cindex @option{-r} option
@cindex @option{--re-interval} option
@cindex regular expressions, interval expressions and
åœ¨ regexps ä¸­å…è®¸åŒºé—´è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @ref{Regexp Operators}ï¼‰ã€‚ç°åœ¨è¿™ä¸ªæ˜¯ @command{gawk} çš„é»˜è®¤è¡Œä¸ºã€‚è¿™ä¸ªå‚æ•°ä¿ç•™ä¸‹æ¥ï¼Œå³ä¸ºäº†èº«åçš„å…¼å®¹æ€§ï¼Œä¹Ÿä¸ºäº†ä¸ @option{--traditional} ç»„åˆä½¿ç”¨ã€‚

@item @option{-S}
@itemx @option{--sandbox}
@cindex @option{-S} option
@cindex @option{--sandbox} option
@cindex sandbox mode
ç¦ç”¨ @code{system()} å‡½æ•°ï¼Œç”¨ @code{getline} è¿›è¡Œè¾“å…¥é‡å®šå‘ï¼Œç”¨ @code{print}ï¼Œ@code{printf} ä»¥åŠåŠ¨æ€æ‰©å±•æ¥è¿›è¡Œè¾“å‡ºé‡å®šå‘ã€‚
å½“ä½ è¦æ‰§è¡Œæ¥æºæœ‰æœ‰ç–‘é—®çš„ @command{awk} æºä»£ç æ—¶ï¼Œä¸ºäº†ç¡®ä¿è„šæœ¬ä¸ä¼šè®¿é—®ä½ çš„ç³»ç»Ÿï¼ˆè€Œä¸æ˜¯é€šè¿‡æŒ‡å®šè¾“å…¥@value{DF}ï¼‰ï¼Œè¿™ä¸ªå‚æ•°å°¤å…¶æœ‰ç”¨ã€‚

@item @option{-t}
@itemx @option{--lint-old}
@cindex @option{-L} option
@cindex @option{--lint-old} option
å½“ç›¸åº”çš„ç»“æ„åœ¨ Version 7 Unix èµ·åˆå§‹çš„ @command{awk} ç‰ˆæœ¬ä¸­ä¸å¯ç”¨æ—¶ï¼Œå‘å‡ºå‘Šè­¦ï¼ˆæŸ¥çœ‹ @ref{V7/SVR3.1}ï¼‰ã€‚

@item @option{-V}
@itemx @option{--version}
@cindex @option{-V} option
@cindex @option{--version} option
@cindex @command{gawk}, versions of, information about@comma{} printing
æ‰“å°è¿™ä¸ª @command{gawk} çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚è¿™ä¸ªå¯ä»¥è®©ä½ ç¡®å®šä½ çš„ @command{gawk} ç‰ˆæœ¬æ˜¯ä¸æ˜¯ä¸ Free Software Foundation å‘å¸ƒçš„æœ€æ–°ç‰ˆæœ¬åŒ¹é…ã€‚
åœ¨ Bug æŠ¥å‘Šä¸­ä¹Ÿéå¸¸æœ‰ç”¨ï¼ˆæŸ¥çœ‹ @ref{Bugs}ï¼‰ã€‚
@end table

åªè¦æä¾›äº†ç¨‹åºæ–‡æœ¬ï¼Œå¦‚æœæœ‰é€‰é¡¹ç”±äºè­¦å‘Šè€Œè¢«æ ‡å¿—ä¸ºæ— æ•ˆï¼Œå¿½ç•¥å®ƒå°±å¯ä»¥äº†ã€‚

@cindex @option{-F} option, @option{-Ft} sets @code{FS} to TAB
åœ¨å…¼å®¹æ¨¡å¼é‡Œï¼Œæœ‰ä¸ªç‰¹æ®Šçš„åœ°æ–¹ï¼Œå¦‚æœæœ @var{fs} çš„å€¼é€šè¿‡ @option{-F} å‚æ•°è®¾ç½®ä¸º @samp{t} ï¼Œé‚£ä¹ˆ @code{FS} å°±ä¼šè¢«è®¾ç½®æˆ TAB å­—ç¬¦ï¼ˆ@code{"\t"}ï¼‰ã€‚
è¿™ç§æƒ…å†µåªæœ‰åœ¨ä½¿ç”¨ @option{--traditional} æ—¶æ‰ä¼šä¸ºçœŸï¼Œè€Œä¸æ˜¯ @option{--posix}ï¼ˆæŸ¥çœ‹ @ref{Field Separators}ï¼‰ã€‚

@cindex @option{-f} option, multiple uses
@option{-f} å‚æ•°å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨å¤šæ¬¡ã€‚
@command{awk} å°†ä»å¤šä¸ªæ–‡ä»¶ä¸­è¯»å–ç¨‹åºï¼Œå°±å¥½åƒè¿™äº›æ–‡ä»¶å·²ç»åˆå¹¶æˆäº†ä¸€ä¸ªå¤§çš„æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼åœ¨åˆ›å»º @command{awk} å‡½æ•°åº“æ—¶éå¸¸æœ‰ç”¨ã€‚è¿™äº›å‡½æ•°åªéœ€è¦å†™ä¸€æ¬¡ï¼Œç„¶åä»æŸä¸ªæ ‡å‡†çš„ä½ç½®å–ç”¨ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­åŒ…å«ã€‚@option{-i} å‚æ•°åœ¨è¿™ä¸ªæ–¹é¢çš„è€ƒè™‘ä¹Ÿç±»ä¼¼ã€‚ï¼ˆæ­£å¦‚ @ref{Definition Syntax}ï¼Œä¸­æ‰€æåˆ°çš„ï¼Œè¿™äº›å‡½æ•°åå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ï¼‰

æ ‡å‡†çš„ @command{awk} ä¸­ï¼Œå°±ç®—ç¨‹åºæ˜¯é€šè¿‡é”®ç›˜è¾“å…¥çš„ï¼Œé€šè¿‡ @samp{-f /dev/tty} å®Œæˆï¼Œåº“å‡½æ•°ä¹Ÿè¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚
è¾“å…¥ç¨‹åºåï¼Œé”®å…¥ @kbd{Ctrl-d}ï¼ˆæ–‡ä»¶ç»“æŸç¬¦ï¼‰æ¥ç»“æŸã€‚ï¼ˆä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ @samp{-f -} æ¥ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ç¨‹åºæºä»£ç ï¼Œåªæ˜¯è¿™ä¸ªæ—¶å€™ï¼Œä½ å°±ä¸èƒ½åŒæ—¶ä½¿ç”¨æ ‡å‡†è¾“å…¥ä½œä¸ºæ•°æ®çš„è¾“å…¥æºã€‚ï¼‰

ç”±äºæ ‡å‡† @command{awk} ä¸­æ··ç”¨æºæ–‡ä»¶ä¸å‘½ä»¤è¡Œ @command{awk} ç¨‹åºï¼Œæ˜¾å¾—æœ‰ä¸€äº›ç¬¨æ‹™ï¼Œæ‰€ä»¥ @command{gawk} æä¾›äº†ä¸€ä¸ª @option{-e} é€‰é¡¹ã€‚
è¿™å¹¶ä¸éœ€è¦ä½ æŠ¢å æ ‡å‡†è¾“å…¥æ¥è¾“å…¥æºä»£ç ï¼Œè€Œæ˜¯è®©ä½ å¾ˆå®¹æ˜“åœ°æ··åˆä½¿ç”¨å‘½ä»¤è¡Œä¸åº“æºä»£ç ï¼ˆæŸ¥çœ‹ @ref{AWKPATH Variable}ï¼‰ã€‚
ä¸ @option{-f} ä¸€æ ·ï¼Œ@option{-e} ä¸ @option{-i} é€‰é¡¹ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤ä¸­å¤šæ¬¡ä½¿ç”¨ã€‚

@cindex @option{-e} option
å¦‚æœæ²¡æœ‰ @option{-f} æˆ–è€… @option{-e} é€‰é¡¹æŒ‡å®šï¼Œ@command{gawk} ä¼šä½¿ç”¨å‘½ä»¤è¡Œä¸­çš„ç¬¬ä¸€ä¸ªéé€‰é¡¹å‚æ•°ä½œä¸ºç¨‹åºçš„æºä»£ç ã€‚

@cindex @env{POSIXLY_CORRECT} environment variable
@cindex lint checking, @env{POSIXLY_CORRECT} environment variable
@cindex POSIX mode
å¦‚æœç¯å¢ƒå˜é‡ @env{POSIXLY_CORRECT} å­˜åœ¨ï¼Œ@command{gawk} å°±ä¼šä¸¥æ ¼åœ°æŒ‰ç…§ POSIX æ¨¡å¼æ‰§è¡Œï¼Œå°±å¦‚ä½ æä¾›äº† @option{--posix} å‚æ•°ä¸€æ ·ã€‚
è®¸å¤šçš„ GNU ç¨‹åºéƒ½æŸ¥æ‰¾è¿™ä¸ªç¯å¢ƒå˜é‡æ¥ç¦ç”¨ä¸ POSIX æ ‡å‡†æœ‰å†²çªçš„æ‰©å±•ï¼Œä½†æ˜¯ @command{gawk} çš„è¡Œä¸ºæœ‰ä¸€äº›ä¸åŒï¼š
å°±ç®—æŸä¸ªç‰¹æ€§ä¸ POSIX æ²¡æœ‰å†²çªï¼Œå®ƒä¹Ÿç¦ç”¨æ‰€æœ‰çš„æ‰©å±•ï¼Œç„¶åæŒ‰ç…§ä¸¥æ ¼çš„ POSIX æ ‡å‡†æ¨¡å¼æ‰§è¡Œã€‚
å¦‚æœæŒ‡å®šäº† @option{--lint} é€‰é¡¹ï¼Œ@command{gawk} ä¼šå› ä¸º @env{POSIXLY_CORRECT} è€Œå¼€å¯ POSIX æ¨¡å¼ï¼Œç„¶åä¼šè¾“å‡ºè­¦å‘Šä¿¡æ¯ï¼Œè¯´ POSIX æ¨¡å¼å·²ç»å¯ç”¨ã€‚
ä¸€èˆ¬æ¥è¯´ï¼Œä½ å¯èƒ½ä¼šåœ¨ä½ çš„ Shell çš„å¯åŠ¨è„šæœ¬ä¸­è®¾ç½®è¿™ä¸ªå˜é‡ã€‚
å¯¹äºä¸ Bourne Shell å…¼å®¹çš„ Shell æ¥è¯´ï¼ˆå¦‚ Bashï¼‰ï¼Œä½ å¯ä»¥å°†ä¸‹é¢çš„è¡ŒåŠ å…¥åˆ°ç”¨æˆ·ä¸»ç›®å½•çš„ @file{.profile} æ–‡ä»¶ä¸­ï¼š

@example
POSIXLY_CORRECT=true
export POSIXLY_CORRECT
@end example

@cindex @command{csh} utility, @env{POSIXLY_CORRECT} environment variable
å¯¹äºä¸ C shell å…¼å®¹çš„ shellï¼Œ@footnote{ä¸å»ºè®®è¿™ä¹ˆåšã€‚}ä½ å¯ä»¥å°†ä¸‹é¢çš„è¡ŒåŠ å…¥åˆ°ç”¨æˆ·ä¸»ç›®å½•çš„ @file{.login} æ–‡ä»¶ä¸­ï¼š

@example
setenv POSIXLY_CORRECT true
@end example

@cindex portability, @env{POSIXLY_CORRECT} environment variable
å¯¹äºæ¯æ—¥çš„å·¥ä½œç¯å¢ƒï¼Œè®¾ç½® @env{POSIXLY_CORRECT} å˜é‡å¹¶ä¸å€¼å¾—å»ºè®®ï¼Œä½†æ˜¯å¯¹äºæµ‹è¯•ä½ çš„ç¨‹åºåœ¨å…¶ä»–ç¯å¢ƒä¸­çš„å¯ç§»æ¤æ€§åˆ™æœ‰ç›¸å½“ä½œç”¨ã€‚

@node Other Arguments
@section å…¶ä»–å‘½ä»¤è¡Œå‚æ•°
@cindex command line, arguments
@cindex arguments, command-line

å¯¹äºå‘½ä»¤è¡Œä¸­çš„é¢å¤–å‚æ•°ï¼Œä¸€èˆ¬éƒ½ä¼šè¢«å½“ä½œè¾“å…¥æ–‡ä»¶æ¥å¯¹å¾…ï¼Œå¹¶ä¾æ¬¡å¤„ç†ã€‚
ä½†æ˜¯å…·æœ‰ @code{@var{var}=@var{value}}ï¼ˆå°† @var{value} èµ‹å€¼ç»™å˜é‡ @var{var}ï¼‰å½¢å¼çš„å‚æ•°ï¼Œå´å¹¶ä¸ä½œä¸ºä¸€ä¸ªè¾“å…¥æ–‡ä»¶æŒ‡å®šã€‚
ï¼ˆæŸ¥çœ‹ @ref{Assignment Options}ã€‚ï¼‰
åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ@var{count=1} æ˜¯ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œè€Œä¸æ˜¯@value{FN}ï¼š

@example
awk -f program.awk file1 count=1 file2
@end example

@cindex @command{gawk}, @code{ARGIND} variable in
@cindex @code{ARGIND} variable, command-line arguments
@cindex @code{ARGV} array, indexing into
@cindex @code{ARGC}/@code{ARGV} variables, command-line arguments
æ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°éƒ½å¯ä»¥é€šè¿‡ @code{ARGV} æ•°ç»„è¢« @command{awk} ç¨‹åºå¾—åˆ°ï¼ˆæŸ¥çœ‹ @ref{Built-in Variables}ï¼‰ã€‚
å‘½ä»¤è¡Œå‚æ•°ä¸ç¨‹åºæ–‡æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰éƒ½åœ¨ @code{ARGV} ä¸­å¿½ç•¥æ‰äº†ã€‚å…¶ä»–çš„å‚æ•°ï¼ŒåŒ…æ‹¬å˜é‡èµ‹å€¼ï¼Œéƒ½åŒ…å«åœ¨äº†è¿™ä¸ªæ•°ç»„ä¸­ã€‚éšç€å¯¹ @code{ARGV} å‚æ•°çš„å¤„ç†ï¼Œ
@command{gawk} ä¼šè®¾ç½® @code{ARGIND} çš„å€¼ä¸º @code{ARGV} æ•°ç»„çš„ç´¢å¼•ï¼Œä»¥è®°å½•å½“å‰çš„å…ƒç´ ä½ç½®ã€‚

@c FIXME: One day, move the ARGC and ARGV node closer to here.
é€šè¿‡æ›´æ”¹ @code{ARGC} ä¸ @code{ARGV} çš„å€¼ï¼Œä½ å¯ä»¥æ§åˆ¶ @command{awk} å¤„ç†è¾“å…¥æ–‡ä»¶çš„æ–¹å¼ï¼›è¿™ä¸ªå†…å®¹åœ¨ @ref{ARGC and ARGV}ï¼Œä¼šæœ‰æ›´è¯¦ç»†çš„æè¿°ã€‚

@cindex input files, variable assignments and
@cindex variable assignments and input files
å¯¹æ–‡ä»¶åå‚æ•°ä¸èµ‹å€¼å˜é‡å‚æ•°çš„åŒºåˆ†æ˜¯åœ¨ @command{awk} åœ¨å‡†å¤‡æ‰“å¼€ä¸‹ä¸€ä¸ªè¾“å…¥æ–‡ä»¶æ—¶å¤„ç†çš„ã€‚
åœ¨é‚£ä¸ªæ‰§è¡Œç‚¹ï¼Œ@command{awk} ä¼šæ£€æŸ¥@value{FN}ï¼Œçœ‹å®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶è¿˜æ˜¯ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼›å¦‚æœæ˜¯ï¼Œ@command{awk} ä¼šè®¾ç½®é‚£ä¸ªå˜é‡è€Œä¸æ˜¯æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»æ“ä½œã€‚

å› æ­¤ï¼Œåœ¨å¤„ç†å®Œæ‰€æœ‰ä¹‹å‰çš„æ–‡ä»¶åï¼Œå˜é‡å°±ä¼šè¢«è®¾ç½®æˆç›¸åº”çš„å€¼ã€‚
ç‰¹åˆ«çš„ï¼Œä»¥è¿™ç§æ–¹å¼å¯¹å˜é‡è¿›è¡Œçš„èµ‹å€¼ï¼Œåœ¨ @code{BEGIN} è§„åˆ™ï¼ˆæŸ¥çœ‹ @ref{BEGIN/END}ï¼‰ä¸­æ˜¯@emph{ä¸å¯}è®¿é—®åˆ°çš„ï¼Œ
å› ä¸ºè¿™ä¸ªè§„åˆ™åœ¨ @command{awk} å¼€å§‹æ‰«æå‚æ•°åˆ—è¡¨ä¹‹å‰å°±å·²ç»æ‰§è¡Œäº†ã€‚

@cindex dark corner, escape sequences
åœ¨å‘½ä»¤è¡Œä¸Šæ‰€ç»™çš„èµ‹å€¼å˜é‡ä¼šæŒ‰ç…§è½¬ä¹‰çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼ˆæŸ¥çœ‹ @ref{Escape Sequences}ï¼‰ã€‚
@value{DARKCORNER}

åœ¨ä¸€äº›éå¸¸æ—©æœŸçš„ @command{awk} å®ç°ä¸­ï¼Œå½“å˜é‡èµ‹å€¼å‚æ•°å‡ºç°åœ¨ä»»ä½•@value{FN}ä¹‹å‰ï¼Œ
åˆ™èµ‹å€¼æ“ä½œä¼šå‘ç”Ÿåœ¨ @code{BEGIN} è§„åˆ™æ‰§è¡Œ@emph{ä¹‹å‰}ã€‚
@command{awk} çš„è¡Œä¸ºå› æ­¤å°±ä¸ä¸€è‡´äº†ï¼›ä¸€äº›å‘½ä»¤è¡Œèµ‹å€¼ä¼šåœ¨ @code{BEGIN} è§„åˆ™ä¸­å°±å¯ä»¥ä½¿ç”¨ï¼Œè€Œå…¶ä»–çš„åˆ™ä¸å¯ä»¥ã€‚
éå¸¸ä¸å¹¸çš„æ˜¯ï¼Œä¸€äº›åº”ç”¨ç¨‹åºå´ä¾èµ–äºè¿™æ ·çš„â€œç‰¹æ€§â€ã€‚å½“ @command{awk} å˜å¾—æ›´ä¸€è‡´çš„æ—¶å€™ï¼Œ@option{-v} é€‰é¡¹å°±ç”¨æ¥åè°ƒåº”ç”¨ä¾èµ–äºè¿™ç§æ—§è¡Œä¸ºçš„ä»£ç ã€‚

å˜é‡èµ‹å€¼ç‰¹æ€§ä¼šåœ¨è®¾ç½® @code{RS}ï¼Œ@code{OFS} å’Œ @code{ORS} å˜é‡çš„å€¼æ—¶éå¸¸æœ‰ä½œç”¨ï¼Œè¿™ä¸ªå˜é‡ç”¨æ¥åœ¨æ‰«æ@value{DF}æ—¶æ§åˆ¶è¾“å…¥è¾“å‡ºæ ¼å¼ã€‚åŒæ—¶ï¼Œå¦‚æœ @command{awk} è¦å¤šæ¬¡æ‰«æ@value{DF}æ—¶ï¼Œç”¨æ¥æ§åˆ¶çŠ¶æ€ä¹Ÿéå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š

@cindex files, multiple passes over
@example
awk 'pass == 1  @{ @var{pass 1 stuff} @}
     pass == 2  @{ @var{pass 2 stuff} @}' pass=1 mydata pass=2 mydata
@end example

æœ‰äº†å˜é‡èµ‹å€¼ç‰¹æ€§åï¼Œç”¨ @option{-F} å‚æ•°æ¥è®¾ç½® @code{FS} çš„å€¼ï¼Œä¸¥æ ¼æ¥è¯´å°±ä¸é‚£ä¹ˆå¿…è¦äº†ã€‚è¿™é‡Œä¿ç•™ä¸‹æ¥åªæ˜¯ä¸ºäº†å…¼å®¹å†å²ç‰ˆæœ¬ã€‚

@node Naming Standard Input
@section å‘½åæ ‡å‡†è¾“å…¥

å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½ å¸Œæœ›åŒæ—¶ä»æ ‡å‡†è¾“å…¥ä¸æ–‡ä»¶ä¸­è¾“å…¥æ•°æ®ï¼Œä½ å¸Œæœ›è¯»ä¸€ä¸ªæ–‡ä»¶ï¼Œå†ä»æ ‡å‡†è¾“å…¥çš„ç®¡é“ä¸­è¯»å…¥æ•°æ®ï¼Œç„¶åå†è¯»å¦ä¸€ä¸ªæ–‡ä»¶ã€‚

å°†æ ‡å‡†è¾“å…¥å‘½åçš„æ–¹å¼ï¼Œå¯¹æ‰€æœ‰ç‰ˆæœ¬çš„ @command{awk}ï¼Œéƒ½æ˜¯ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„å‡å·ï¼Œæˆ–è€…è¯´æ˜¯æ¨ªæ  @samp{-} ï¼Œä¾‹å¦‚ï¼š

@example
@var{some_command} | awk -f myprog.awk file1 - file2
@end example

@noindent
è¿™ä¸ªä¾‹å­ä¸­ï¼Œ@command{awk} é¦–å…ˆè¯»å–æ–‡ä»¶ @file{file1}ï¼Œç„¶åä» @var{some_command} çš„è¾“å‡ºä¸­è¯»å…¥æ•°æ®ï¼Œæœ€åä» @file{file2} ä¸­è¯»å–æ•°æ®ã€‚

å½“ä½ ä½¿ç”¨ @code{getline} æ¥è¯»å–æ–‡ä»¶æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ @code{"-"} æ¥å‘½åæ ‡å‡†è¾“å…¥ï¼ˆæŸ¥çœ‹ @ref{Getline/File}ï¼‰ã€‚

å¦å¤–ï¼Œ@command{gawk} ä¹Ÿå¯ä»¥è®©ä½ åœ¨å‘½ä»¤è¡Œæˆ–è€…ç¨‹åºæ–‡ä»¶ä¸­æŒ‡å®šç‰¹æ®Šçš„@value{FN} @file{/dev/stdin}ã€‚
ä¸€äº›ç‰ˆæœ¬çš„ @command{awk} ä¹Ÿæ”¯æŒè¿™ç§æ–¹å¼ï¼Œä½†è¿™å¹¶ä¸æ˜¯æ ‡å‡†ã€‚ï¼ˆæœ‰äº›æ“ä½œç³»ç»Ÿåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æä¾›æ–‡ä»¶ @file{/dev/stdin}ï¼›è€Œ @command{gawk} æ€»æ˜¯è‡ªå·±æ¥å¤„ç†è¿™ä¸ªæ–‡ä»¶ã€‚ï¼‰

@node Environment Variables
@section @command{gawk} ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ 
@cindex environment variables used by @command{gawk}

æœ‰å¾ˆå¤šçš„ç¯å¢ƒå˜é‡ä¼šå½±å“åˆ° @command{gawk} çš„è¡Œä¸ºã€‚

@menu
* AWKPATH Variable::            Searching directories for @command{awk}
                                programs.
* AWKLIBPATH Variable::         Searching directories for @command{awk} shared
                                libraries.
* Other Environment Variables:: The environment variables.
@end menu

@node AWKPATH Variable
@subsection ç¯å¢ƒå˜é‡ @env{AWKPATH}
@cindex @env{AWKPATH} environment variable
@cindex directories, searching for source files
@cindex search paths, for source files
@cindex differences in @command{awk} and @command{gawk}, @env{AWKPATH} environment variable
@ifinfo
ä¹‹å‰çš„@value{SECTION}ä¸­æè¿°äº† @command{awk} ç¨‹åºæ–‡ä»¶æ€æ ·åœ¨å‘½ä»¤è¡Œä¸­ç”¨ @option{-f} é€‰é¡¹å‘½åã€‚
@end ifinfo
åœ¨å¤§å¤šçš„ @command{awk} å®ç°ä¸­ï¼Œä½ å¯ä»¥æŒ‡å®šä¸ºæ¯ä¸ªç¨‹åºæ–‡ä»¶æŒ‡å®šç¡®å®šçš„è·¯å¾„åï¼Œé™¤éæ–‡ä»¶å°±åœ¨å½“å‰ç›®å½•ã€‚
ä½†æ˜¯ï¼Œå¦‚æœé€šè¿‡ @option{-f} æˆ–è€… @option{-i} é€‰é¡¹æ‰€æä¾›çš„@value{FN}ä¸­æ²¡æœ‰åŒ…æ‹¬ç›®å½•åˆ†éš”ç¬¦ @samp{/}ï¼Œ@command{gawk} åˆ™ä¼šåœ¨ä¸€ç³»åˆ—çš„ç›®å½•ä¸­è¿›è¡Œæœç´¢
ï¼ˆç§°ä¸º@dfn{æœç´¢è·¯å¾„}ï¼‰ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æŸ¥æ‰¾æ˜¯å¦æœ‰æŒ‡å®šçš„æ–‡ä»¶åã€‚

è¿™äº›æœç´¢è·¯å¾„åŒ…æ‹¬ä¸€ç³»åˆ—çš„ç”±å†’å·åˆ†éš”çš„è·¯å¾„åã€‚@footnote{åœ¨ MS-Windows ä¸ MS-DOS ä¸­åˆ™ä½¿ç”¨åˆ†å·â€œ;â€ã€‚} 
@command{gawk} ä» @env{AWKPATH} ç¯å¢ƒå˜é‡ä¸­å–å¾—å®ƒçš„æœç´¢è·¯å¾„ã€‚å¦‚æœä¸å­˜åœ¨è¿™ä¸ªå˜é‡ï¼Œæˆ–è€…è¿™ä¸ªå˜é‡ä¸ºç©ºï¼Œ@command{gawk} ä¼šä½¿ç”¨é»˜è®¤çš„è·¯å¾„ï¼ˆåé¢è¯´æ˜ï¼‰ã€‚

æœç´¢è·¯å¾„ç‰¹æ€§ç”¨æ¥åˆ›å»ºé€šç”¨çš„ @command{awk} å‡½æ•°åº“éå¸¸æœ‰ç”¨ã€‚
åº“æ–‡ä»¶å¯ä»¥æ”¾åœ¨ä¸€ä¸ªæ ‡å‡†çš„é»˜è®¤ç›®å½•ä¸­ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šä¸€ä¸ªçŸ­çš„@value{FN}ã€‚ä¸ç„¶çš„è¯ï¼Œä½ éœ€è¦è¾“å…¥æ¯ä¸ªæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚

é€šè¿‡ä½¿ç”¨ @option{-i} æˆ–è€… @option{-f} é€‰é¡¹ï¼Œä½ çš„å‘½ä»¤è¡Œ @command{awk} ç¨‹åºå¯ä»¥åˆ©ç”¨ @command{awk} çš„åº“æ–‡ä»¶
ï¼ˆæŸ¥çœ‹ @ref{Library Functions}ï¼‰ã€‚
å¦‚æœæ˜¯åœ¨å…¼å®¹æ¨¡å¼ä¸­ï¼Œè·¯å¾„æœç´¢å¹¶æ²¡æœ‰å®ç°ï¼Œå› æ­¤ï¼Œè€Œå¯¹äº @option{--traditional} ä¸ @option{--posix} æ¨¡å¼ï¼Œæœç´¢è·¯å¾„ä¸å¯ç”¨ã€‚
æŸ¥çœ‹ @ref{Options}ã€‚

å¦‚æœæºä»£ç æ–‡ä»¶æ²¡æœ‰åœ¨åˆå§‹çš„è·¯å¾„ä¸­æ‰¾åˆ°ï¼Œåˆ™è·¯å¾„æœç´¢ä¼šåœ¨@value{FN}åé¢åŠ ä¸€ä¸ª @samp{.awk} åç¼€ååå†æ‰§è¡Œæœç´¢ã€‚

@command{gawk} çš„è·¯å¾„æœç´¢æœºåˆ¶ä¸ Shell çš„æœºåˆ¶æœ‰ç‚¹ç±»ä¼¼ã€‚
ï¼ˆå¯ä»¥æŸ¥çœ‹ @uref{http://www.gnu.org/software/bash/manual/,
@cite{Bourne-Again Shell æ‰‹å†Œ}}ã€‚ï¼‰
å®ƒå°†ç©ºçš„è·¯å¾„é¡¹è§†ä¸ºå½“å‰è·¯å¾„ã€‚ï¼ˆä¸€ä¸ªç©ºé¡¹ç”±ä¸€ä¸ªå†’å·å¼€å§‹ï¼Œæˆ–è€…ä»¥å†’å·ç»“æŸçš„è·¯å¾„ï¼Œæˆ–è€…ä¸¤ä¸ªç´§æ¥ç€çš„å†’å·è¡¨ç¤º [@samp{::}]ã€‚ï¼‰

@quotation æç¤º
è¦å°†å½“å‰è·¯å¾„åŒ…æ‹¬åœ¨è·¯å¾„ä¸­ï¼Œè¦ä¹ˆåœ¨é¡¹ç›®ä¸­æ”¾ä¸€ä¸ªç‚¹å· @file{.} æˆ–è€…å†™ä¸€ä¸ªç©ºçš„è·¯å¾„é¡¹ã€‚

@command{gawk} ä¹‹å‰çš„å‡ ä¸ªä¸åŒç‰ˆæœ¬ä¼šæ˜¾ç¤ºåœ°åœ¨å½“å‰ç›®å½•è¿›è¡Œæœç´¢ï¼Œä¸ç®¡æ˜¯åœ¨æœç´¢è·¯å¾„å‰è¿˜æ˜¯åã€‚
åœ¨@value{PVERSION} 4.1.2 è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œåˆ™ä¸å†è¿™ä¹ˆå¤„ç†ï¼›å¦‚æœä½ å¸Œæœ›æœç´¢å½“å‰ç›®å½•ï¼Œä½ å¿…é¡»åŒ…æ‹¬ä¸€ä¸ªç‚¹ @file{.} ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„é¡¹ï¼Œè¦ä¹ˆåœ¨æœç´¢è·¯å¾„ä¸­åŠ å…¥ä¸€ä¸ªç©ºé¡¹ã€‚
@end quotation

@env{AWKPATH} çš„é»˜è®¤è·¯ä¹ˆæ˜¯ï¼š
@samp{.:/usr/local/share/awk}ã€‚
@footnote{ä½ çš„ @command{gawk} ç‰ˆæœ¬å¯èƒ½ä½¿ç”¨ä¸åŒçš„ç›®å½•ï¼›è¿™ä¾èµ–äº @command{gawk} æ˜¯å¦‚ä½•è¢«æ„å»ºä¸å®‰è£…çš„ã€‚
å®é™…çš„è·¯å¾„æ˜¯ @code{$(datadir)} åœ¨ @command{gawk} é…ç½®æ—¶æ‰€äº§ç”Ÿçš„å€¼ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä¸€èˆ¬æ¥è¯´ä½ ä¹Ÿä¸éœ€è¦æ‹…å¿ƒã€‚}
ç”±äº @file{.} åŒ…æ‹¬åœ¨äº†å¼€å§‹å¤„ï¼Œ@command{gawk} ä¼šé¦–å…ˆæœç´¢å½“å‰ç›®å½•ï¼Œç„¶åå†æœç´¢ @file{/usr/local/share/awk}ã€‚
åœ¨å®è·µä¸­ï¼Œè¿™æ„å‘³ç€ä½ å¾ˆå°‘éœ€è¦æ›´æ”¹ @env{AWKPATH} çš„å€¼ã€‚

@command{gawk} å°†å…¶ä½¿ç”¨çš„æœç´¢è·¯å¾„çš„å€¼æ”¾åœ¨ @code{ENVIRON["AWKPATH"]} å…ƒç´ ä¸­ã€‚
è¿™æä¾›äº†å¯ä»¥è®©ä½ åœ¨ @command{awk} ç¨‹åºä¸­è®¿é—®æœç´¢è·¯å¾„çš„æœºåˆ¶ã€‚

å°½ç®¡ä½ å¯ä»¥åœ¨ç¨‹åºä¸­æ›´æ”¹ @code{ENVIRON["AWKPATH"]} çš„å€¼ï¼Œä½†è¿™ä¸ä¼šå½±å“æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºçš„è¡Œä¸ºã€‚
åŸå› å¦‚ä¸‹ï¼š@env{AWKPATH} æ˜¯ç”¨æ¥ä½œä¸ºæœç´¢ç¨‹åºæ–‡ä»¶çš„ç¯å¢ƒå˜é‡ã€‚
ä¸€æ—¦ä½ çš„ç¨‹åºè¿è¡Œèµ·æ¥ï¼Œæ‰€æœ‰çš„æ–‡ä»¶éƒ½å·²ç»æœç´¢åˆ°äº†ï¼Œ@command{gawk} å°±ä¸å†éœ€è¦ @env{AWKPATH} å˜é‡äº†ã€‚

@node AWKLIBPATH Variable
@subsection ç¯å¢ƒå˜é‡ @env{AWKLIBPATH}
@cindex @env{AWKLIBPATH} environment variable
@cindex directories, searching for loadable extensions
@cindex search paths, for loadable extensions
@cindex differences in @command{awk} and @command{gawk}, @code{AWKLIBPATH} environment variable

@env{AWKLIBPATH} ç¯å¢ƒå˜é‡ä¸ @env{AWKPATH} å˜é‡ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯ç”±æ¥æœç´¢å¯è£…è½½çš„æ‰©å±•ï¼ˆå­˜å‚¨ä¸ºç³»ç»Ÿçš„å…±äº«åº“ï¼‰ï¼Œè€Œä¸æ˜¯ç”¨æ¥æœç´¢æºä»£ç æ–‡ä»¶ï¼Œ
è¿™äº›æ‰©å±•ç”± @option{-l} é€‰é¡¹è¿›è¡ŒæŒ‡å®šã€‚å¦‚æœæ‰©å±•æ²¡æœ‰æ‰¾åˆ°ï¼Œä¼šåœ¨æœç´¢å®ŒæˆååŠ ä¸Šæ°å½“çš„å…±äº«åº“åç¼€åå†æ¬¡æœç´¢ã€‚
ä¾‹å¦‚ï¼Œåœ¨ GNU/Linux ç³»ç»Ÿä¸­ï¼Œåç¼€æ˜¯ @samp{.so}ã€‚
æœç´¢è·¯å¾„ä¹Ÿå¯ä»¥ç”¨äºç”¨ @code{@@load} å…³é”®è¯è¿›è¡Œçš„æ‰©å±•è£…è½½ï¼ˆæŸ¥çœ‹ @ref{Loading Shared Libraries}ï¼‰ã€‚

å¦‚æœ @env{AWKLIBPATH} åœ¨ç¯å¢ƒå˜é‡ä¸­ä¸å­˜åœ¨ï¼Œæˆ–è€…ä¸ºç©ºï¼Œ@command{gawk} ä¼šä½¿ç”¨é»˜è®¤çš„è·¯å¾„ï¼Œ
ä¸€èˆ¬æ˜¯ @samp{/usr/local/lib/gawk}ï¼Œä½†è¿™ä¹Ÿä¼šç”±äº @command{gawk} æ„å»ºçš„æ–¹å¼è€Œæœ‰ä¸åŒã€‚

@command{gawk} ä¼šå°†æœç´¢è·¯å¾„çš„å€¼å­˜æ”¾äº @code{ENVIRON["AWKLIBPATH"]} ä¸­ã€‚è¿™æ ·ï¼Œåœ¨ä½ çš„ç¨‹åºä¸­å¯ä»¥å¾—åˆ°å®é™…çš„æœç´¢è·¯å¾„ã€‚

@node Other Environment Variables
@subsection å…¶ä»–çš„ç¯å¢ƒå˜é‡
è¿˜æœ‰å¾ˆå¤šçš„ç¯å¢ƒå˜é‡ä¼šå½±å“ @command{gawk} çš„è¡Œä¸ºï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ¯”è¾ƒç‰¹æ®Šã€‚ä¸‹é¢çš„å˜é‡éƒ½æ˜¯ä¸€èˆ¬çš„ç”¨æˆ·ä½¿ç”¨ï¼š

@table @env
@item GAWK_MSEC_SLEEP
æŒ‡å®šè¿æ¥é‡è¯•çš„é—´éš”ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚åœ¨ä¸æ”¯æŒ @code{usleep()} è°ƒç”¨çš„ç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªå€¼ä¸ºå‘ä¸Šèˆå…¥ä¸ºæ•´æ•°ç§’ã€‚

@item GAWK_READ_TIMEOUT
æŒ‡å®š @command{gawk} åœ¨è¿”å›å‡ºé”™å‰ï¼Œç­‰å¾…è¾“å…¥çš„æ¯«ç§’æ•°ã€‚æŸ¥çœ‹ @ref{Read Timeout}ã€‚

@item GAWK_SOCK_RETRIES
æ§åˆ¶ @command{gawk} é‡è¯•åŒå‘ TCP/IP ï¼ˆSocketï¼‰è¿æ¥çš„æ¬¡æ•°ã€‚æŸ¥çœ‹ @ref{TCP/IP Networking}ã€‚

@item POSIXLY_CORRECT
å¯¼è‡´ @command{gawk} åˆ‡æ¢åˆ° POSIX å…¼å®¹æ¨¡å¼ï¼Œå¹¶ç¦ç”¨æ‰€æœ‰çš„ä¼ ç»Ÿçš„ä¸ GNU æ‰©å±•ã€‚æŸ¥çœ‹ @ref{Options}ã€‚
@end table

ä¸‹é¢çš„ç¯å¢ƒå˜é‡ç”± @command{gawk} çš„å¼€å‘è€…ç”¨äºæµ‹è¯•ä¸è°ƒæµ‹ç›®çš„ã€‚å®ƒä»¬ä¼šæ”¹å˜ã€‚è¿™äº›å˜é‡æ˜¯ï¼š

@table @env
@item AWKBUFSIZE
è¿™ä¸ªå˜é‡åªå½±å“åœ¨ POSIX å…¼å®¹ç³»ç»Ÿä¸Šçš„ @command{gawk}ã€‚
å¦‚æœå€¼æ˜¯ @samp{exact}ï¼Œ@command{gawk} ä¼šä½¿ç”¨è¾“å…¥æ–‡ä»¶çš„å¤§å°ä½œä¸ºå†…å­˜ç¼“å­˜çš„å¤§å°ï¼Œæ¥ç”¨è¿›è¡Œ I/O çš„åˆ†é…ã€‚å…¶ä»–æƒ…å†µä¸‹çš„å€¼åˆ™æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œ
@command{gawk} ä½¿ç”¨è¿™ä¸ªå€¼è¿›è¡Œç¼“å­˜çš„åˆ†é…ã€‚ï¼ˆå½“è¿™ä¸ªå˜é‡æ²¡æœ‰è®¾ç½®ï¼Œ@command{gawk} ä½¿ç”¨æ–‡ä»¶å¤§å°ä¸é»˜è®¤å—å¤§å°ä¸¤è€…ä¸­çš„å°çš„æ•°å€¼ï¼Œ
è¿™ä¸€èˆ¬æ¥è¯´è€…æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„ I/O å—å¤§å°ã€‚ï¼‰

@item AWK_HASH
å¦‚æœè¿™ä¸ªå˜é‡å­˜åœ¨ï¼Œå€¼ä¸º @samp{gst} ï¼Œ@command{gawk} ä¼šåˆ‡æ¢ä½¿ç”¨æ¥è‡ªäº GNU Smalltalk çš„å“ˆå¸Œå‡½æ•°æ¥ç®¡ç†æ•°ç»„ã€‚è¿™ä¸ªå‡½æ•°æ¯”æ ‡å‡†çš„å‡½æ•°è¦ç¨å¿«ã€‚

@item AWKREADFUNC
å¦‚æœè¿™ä¸ªå˜é‡å­˜åœ¨ï¼Œ@command{gawk} ä¼šåˆ‡æ¢æˆä¸€æ¬¡ä¸€è¡Œåœ°è¯»å–æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ•´å—åœ°è¯»ã€‚è¿™ä¸ªå˜é‡çš„å­˜åœ¨æ˜¯ä¸ºäº†è°ƒè¯•åœ¨ non-POSIX æ“ä½œç³»ç»Ÿä¸Šæ–‡ä»¶ç³»ç»Ÿçš„é—®é¢˜ï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸Šçš„ I/O æ˜¯ä»¥è®°å½•æ¥è¿›è¡Œè¯»å–è€Œä¸æ˜¯ä»¥å—çš„æ–¹å¼ã€‚

@item GAWK_MSG_SRC
å¦‚æœè¿™ä¸ªå˜é‡å­˜åœ¨ï¼Œ@command{gawk} ä¼šåœ¨äº§ç”Ÿçš„è­¦å‘Šä¿¡æ¯ä¸è‡´å‘½ä¿¡æ¯ä¸­åŠ å…¥@value{FN}ä¸è¡Œå·ã€‚å®ƒçš„ç›®çš„æ˜¯å¸®åŠ©åˆ†ç¦»æ¶ˆæ¯æºï¼Œå› ä¸ºæœ‰å¯èƒ½æœ‰å¤šä¸ªåœ°æ–¹ä¼šäº§ç”Ÿç›¸åŒçš„è­¦å‘Šæˆ–è€…é”™è¯¯ä¿¡æ¯ã€‚

@item GAWK_LOCALE_DIR
æŒ‡æ˜ç¼–è¯‘å¥½çš„ä¿¡æ¯å¯¹è±¡æ–‡ä»¶çš„ä½ç½®ã€‚åœ¨ @command{gawk} å¼€å§‹è¿è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡è¢«ä¼ é€’ç»™ @code{bindtextdomain()} å‡½æ•°ã€‚

@item GAWK_NO_DFA
å¦‚æœè¿™ä¸ªå˜é‡å­˜åœ¨ï¼Œ@command{gawk} ä¸ä¼šä½¿ç”¨ DFA regexp åŒ¹é…å™¨
@footnote{æ­£åˆ™å¼•æ“ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šä¸€ç§æ˜¯ DFAï¼ˆç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºï¼ŒDeterministic finite automatonï¼‰ï¼Œä¸€ç§æ˜¯ NFAï¼ˆéç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºï¼ŒNon-deterministic finite automaton)ã€‚è¿™ä¸¤ç§å¼•æ“éƒ½æœ‰äº†å¾ˆä¹…çš„å†å²ï¼Œå½“ä¸­ä¹Ÿç”±è¿™ä¸¤ç§å¼•æ“äº§ç”Ÿäº†å¾ˆå¤šå˜ä½“ï¼äºæ˜¯ POSIX çš„å‡ºå°è§„é¿äº†ä¸å¿…è¦å˜ä½“çš„ç»§ç»­äº§ç”Ÿã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸»æµçš„æ­£åˆ™å¼•æ“åˆåˆ†ä¸º 3 ç±»ï¼šä¸€ã€DFAï¼ŒäºŒã€ä¼ ç»Ÿå‹NFAï¼Œä¸‰ã€POSIX NFAã€‚DFA å¼•æ“åœ¨çº¿æ€§å¼çŠ¶æ€ä¸‹æ‰§è¡Œï¼Œå› ä¸ºå®ƒä»¬ä¸è¦æ±‚å›æº¯ï¼ˆå¹¶å› æ­¤å®ƒä»¬æ°¸è¿œä¸æµ‹è¯•ç›¸åŒçš„å­—ç¬¦ä¸¤æ¬¡ï¼‰ã€‚DFA å¼•æ“è¿˜å¯ä»¥ç¡®ä¿åŒ¹é…æœ€é•¿çš„å¯èƒ½çš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯ï¼Œå› ä¸º DFA å¼•æ“åªåŒ…å«æœ‰é™çš„çŠ¶æ€ï¼Œæ‰€ä»¥å®ƒä¸èƒ½åŒ¹é…å…·æœ‰åå‘å¼•ç”¨çš„æ¨¡å¼ï¼›å¹¶ä¸”å› ä¸ºå®ƒä¸æ„é€ æ˜¾å¼æ‰©å±•ï¼Œæ‰€ä»¥å®ƒä¸å¯ä»¥æ•è·å­è¡¨è¾¾å¼ã€‚â€”â€”è¯‘è€…æ³¨}
æ¥è¿›è¡Œâ€œå®ƒåŒ¹é…ä¹ˆï¼Ÿâ€ç±»å‹çš„åŒ¹é…æµ‹è¯•ã€‚è¿™ä¼šå¯¼è‡´ @command{gawk} æ›´æ…¢ã€‚å®ƒçš„ç›®çš„æ˜¯å¸®åŠ©åˆ†éš”ä¸¤ä¸ª @command{gawk} å†…éƒ¨ä½¿ç”¨çš„ regexp åŒ¹é…å™¨ã€‚ï¼ˆæœ¬æ¥åº”è¯¥æ˜¯æ²¡æœ‰ä»€ä¹ˆå·®å¼‚çš„ï¼Œä½†æ˜¯å¶å°”æœ‰æ—¶ç†è®ºä¸å®é™…ç›¸äº’ä¸å¤ªåˆæ‹ã€‚ï¼‰

@item GAWK_NO_PP_RUN
å½“ @command{gawk} æŒ‡å®š @option{--pretty-print} é€‰é¡¹æ—¶ï¼Œå¦‚æœå­˜åœ¨è¿™ä¸ªå˜é‡ï¼Œå®ƒå°†ä¸ä¼šæ‰§è¡Œç¨‹åºã€‚

@quotation æ³¨æ„
è¿™ä¸ªå˜é‡åœ¨ä¸‹ä¸ªç‰ˆæœ¬å‘å¸ƒæ—¶ä¸ä¼šç»§ç»­å­˜åœ¨ã€‚
@end quotation

@item GAWK_STACKSIZE
æŒ‡å®š @command{gawk} å†…éƒ¨æ±‚å€¼æ ˆçš„å¢é•¿çš„å¤§å°ï¼Œå¦‚æœéœ€è¦å¢é•¿çš„è¯ã€‚

@item INT_CHAIN_MAX
æŒ‡å®š @command{gawk} ç®¡ç†çš„ç”±æ•´æ•°è¿›è¡Œç´¢å¼•çš„æ•°ç»„ä¸­çš„å“ˆå¸Œé“¾çš„å…ƒç´ çš„æœ€å¤§æ•°å€¼ã€‚

@item STR_CHAIN_MAX
æŒ‡å®š @command{gawk} ç®¡ç†çš„ç”±å­—ä¸²è¿›è¡Œç´¢å¼•çš„æ•°ç»„ä¸­çš„å“ˆå¸Œé“¾çš„å…ƒç´ çš„æœ€å¤§æ•°å€¼ã€‚

@item TIDYMEM
å¦‚æœè¿™ä¸ªå˜é‡å­˜åœ¨ï¼Œ@command{gawk} åˆ™ä½¿ç”¨ GNU C åº“ä¸­çš„ @code{mtrace()} åº“è°ƒç”¨æ¥è·Ÿè¸ªå¯èƒ½çš„å†…å­˜æ³„éœ²ã€‚
@end table

@node Exit Status
@section @command{gawk} çš„é€€å‡ºçŠ¶æ€

@cindex exit status, of @command{gawk}
å¦‚æœä½¿ç”¨ä¸€ä¸ªæ•°å€¼æ¥ä¸ @code{exit} è¯­å¥ä¸€èµ·ä½¿ç”¨ï¼ˆæŸ¥çœ‹ @ref{Exit Statement}ï¼‰ï¼Œ@command{gawk} åˆ™ç”¨è¿™ä¸ªæ•°å€¼åšä¸ºå®ƒçš„é€€å‡ºçŠ¶æ€æ•°å€¼ã€‚

å¦åˆ™ï¼Œå¦‚æœåœ¨æ‰§è¡Œä¸­æ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œ@command{gawk} åˆ™ç”¨ C çš„å¸¸é‡ @code{EXIT_SUCCESS} é€€å‡ºï¼Œè¿™ä¸€èˆ¬ä¸º 0ã€‚

å¦‚æœå‡ºç°äº†é”™è¯¯ï¼Œ@command{gawk} åˆ™ä½¿ç”¨ C å¸¸é‡ @code{EXIT_FAILURE} é€€å‡ºï¼Œè¿™ä¸€èˆ¬æ˜¯ 1ã€‚

å¦‚æœ @command{gawk} ç”±äºè‡´å‘½é”™è¯¯è€Œé€€å‡ºï¼Œåˆ™é€€å‡ºçŠ¶æ€ä¸º 2ã€‚åœ¨ non-POSIX ç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªå€¼å¯èƒ½ä¼šè¢«å½±å°„ä¸º @code{EXIT_FAILURE}ã€‚

@node Include Files
@section åœ¨ä½ çš„ç¨‹åºä¸­åŒ…å«å…¶ä»–çš„æ–‡ä»¶

@c Panos Papadopoulos <panos1962@gmail.com> contributed the original
@c text for this section.

æœ¬@value{SECTION}ä¸­æ‰€æè¿°çš„ç‰¹æ€§éƒ½æ˜¯ @command{gawk} æ‰€ç‹¬æœ‰çš„ã€‚

@cindex @code{@@include} directive
@cindex file inclusion, @code{@@include} directive
@cindex including files, @code{@@include} directive
@code{@@include} å…³é”®å­—å¯ä»¥ç”¨æ¥è¯»å– @command{awk} å¤–éƒ¨çš„æºæ–‡ä»¶ã€‚è¿™èµ‹äºˆäº†ä½ å°†å¤§çš„ @command{awk} æºç¨‹åºæ‹†åˆ†ä¸ºæ›´å°çš„ï¼Œå¯ç®¡ç†çš„ä»£ç å—çš„èƒ½åŠ›ï¼Œä¹Ÿå¯ä»¥è®©ä½ å¤ç”¨é€šç”¨çš„ @command{awk} æºä»£ç ã€‚è¿™å°±æ˜¯è¯´ï¼Œä½ å¯ä»¥å°†å®ç°ç‰¹å®šä»»åŠ¡çš„ @command{awk} å‡½æ•°ç»„ç»‡æˆå¤–éƒ¨æ–‡ä»¶ã€‚
é€šè¿‡ @code{@@include} å…³é”®å­—ä¸ @env{AWKPATH} ç¯å¢ƒå˜é‡æ­é…ä½¿ç”¨ï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥åƒå‡½æ•°åº“ä¸€æ ·è¢«ä½¿ç”¨ã€‚æ³¨æ„ï¼Œæºæ–‡ä»¶ä¹Ÿå¯ä»¥é€šè¿‡ @option{-i} é€‰é¡¹åŒ…å«è¿›æ¥ã€‚

è®©æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ã€‚æˆ‘ä»¬å¯åŠ¨ä¸¤ä¸ªå°çš„ï¼ˆæ²¡å•¥ç”¨çš„ï¼‰@command{awk} è„šæœ¬ï¼Œåå­—ä¸º @file{test1} ä¸ @file{test2}ã€‚è¿™é‡Œæ˜¯ @file{test1} çš„è„šæœ¬ï¼š

@example
BEGIN @{
    print "This is script test1."
@}
@end example

@noindent
è¿™é‡Œæ˜¯ @file{test2} çš„ï¼š

@example
@@include "test1"
BEGIN @{
    print "This is script test2."
@}
@end example

ç”¨ @command{gawk} æ‰§è¡Œ @file{test2} äº§ç”Ÿäº†ä¸‹é¢çš„ç»“æœï¼š

@example
$ @kbd{gawk -f test2}
@print{} This is script test1.
@print{} This is script test2.
@end example

@command{gawk} æ‰§è¡Œ @file{test2} è„šæœ¬ï¼Œè€Œè¿™è„šæœ¬é€šè¿‡ @code{@@include} å…³é”®å­—åŒ…å«äº† @file{test1}ã€‚
å› æ­¤ï¼ŒåŒ…å«å¤–éƒ¨çš„ @command{awk} æºä»£ç ï¼Œä½ å¯ä»¥åªä½¿ç”¨ @code{@@include}ï¼Œåé¢åŠ ä¸Šè¦åŒ…å«çš„æ–‡ä»¶åï¼Œå¹¶ç”¨åŒå¼•å·å¼•èµ·æ¥ã€‚

@quotation æç¤º
è¦è®°ä½ï¼Œè¿™æ˜¯ä¸ªè¯­è¨€ç»“æ„ï¼Œå¹¶ä¸”@value{FN}ä¸èƒ½æ˜¯ä¸ªä¸²å˜é‡ï¼Œè€Œåªèƒ½æ˜¯ä¸€ä¸ªåœ¨åŒå¼•å·ä¸­çš„ä»£è¡¨å…¶è‡ªèº«çš„å­—ä¸²å¸¸é‡ã€‚
@end quotation

æ–‡ä»¶åŒ…å«æœ‰å¯èƒ½æ˜¯å†…åµŒçš„ï¼›ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ç¬¬ä¸‰ä¸ªè„šæœ¬ï¼Œåå­—ä¸º @file{test3}ï¼š

@example
@@include "test2"
BEGIN @{
    print "This is script test3."
@}
@end example

@noindent
ç”¨ @command{gawk} æ‰§è¡Œè„šæœ¬ @file{test3} åˆ™ä¼šäº§ç”Ÿä¸‹é¢çš„ç»“æœï¼š

@example
$ @kbd{gawk -f test3}
@print{} This is script test1.
@print{} This is script test2.
@print{} This is script test3.
@end example

@value{FN}ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•åã€‚å¦‚ï¼š

@example
@@include "../io_funcs"
@end example

@noindent
æˆ–è€…ï¼š

@example
@@include "/usr/awklib/network"
@end example

@noindent
ä¸Šé¢ä¸¤ä¸ªæ ¼å¼éƒ½æ˜¯æ­£ç¡®çš„ã€‚@env{AWKPATH} ç¯å¢ƒå˜é‡åœ¨ä½¿ç”¨ @code{@@include} æ—¶ä¼šäº§ç”Ÿå·¨å¤§å¥½å¤„ã€‚åœ¨ @code{@@include} ä½¿ç”¨ @env{AWKPATH} ç¯å¢ƒå˜é‡çš„è§„åˆ™ï¼Œåœ¨å‘½ä»¤è¡Œæœç´¢ä¸­ä¹Ÿæ˜¯ä¸€æ ·é€‚åº”çš„ï¼ˆæŸ¥çœ‹ @ref{AWKPATH Variable}ï¼‰ã€‚

ç”¨è¿™æ¥æ„å»º @command{gawk} çš„å‡½æ•°åº“éå¸¸æœ‰ç”¨ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå¤§çš„ï¼Œéå¸¸æœ‰ç”¨çš„é€šç”¨ @command{awk} å‡½æ•°è„šæœ¬ï¼Œä½ å°±å¯ä»¥å°†ä»–ä»¬æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªåº“æ–‡ä»¶ï¼Œç„¶åå°†è¿™äº›æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç‰¹å®šç›®å½•ã€‚ç„¶åä½ å¯ä»¥å°†è¿™äº›â€œåº“â€åŒ…å«è¿›æ¥ã€‚ä½ å¯ä»¥ä½¿ç”¨æ–‡ä»¶çš„å…¨è·¯å¾„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® @env{AWKPATH} ç¯å¢ƒå˜é‡ï¼Œç„¶åä½¿ç”¨ @code{@@include}ï¼Œå¹¶ä»…ä½¿ç”¨å…¨è·¯å¾„åçš„æ–‡ä»¶åéƒ¨åˆ†å³å¯ã€‚
å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å°†åº“æ–‡ä»¶æ”¾åœ¨ä¸æ­¢ä¸€ä¸ªç›®å½•ä¸‹ï¼›æ›´å¤æ‚çš„å·¥ä½œç¯å¢ƒæ˜¯è¿™æ ·çš„ï¼Œä½ ç”¨å¤šä¸ªç›®å½•æ¥ç»„ç»‡éœ€è¦åŒ…å«çš„æ–‡ä»¶ã€‚

ç”±äºå¯ä»¥é€šè¿‡å¤šä¸ª @option{-f} é€‰é¡¹æ¥æŒ‡å®šä¸ªæ–‡ä»¶ï¼Œ@code{@@include} è¿™æ ·çš„æœºåˆ¶å¹¶ä¸ä¸¥æ ¼éœ€è¦ã€‚
ä½†æ˜¯ï¼Œ@code{@@include} å…³é”®å­—å¯ä»¥å¸®ä½ æ„å»ºè‡ªåŒ…å«çš„ @command{gawk} ç¨‹åºï¼Œè¿™æ ·å¯ä»¥é¿å…å†™å¤æ‚ï¼Œå¤šä½™çš„å‘½ä»¤è¡Œã€‚ç‰¹åˆ«æ˜¯ï¼Œ@code{@@include} åœ¨å†™ CGI è„šæœ¬æ¥è¿è¡Œç½‘ç»œé¡µé¢æ—¶éå¸¸æœ‰ç”¨ã€‚

å¦‚åœ¨ @ref{AWKPATH Variable}ï¼Œæ‰€æåˆ°çš„ï¼Œå½“å‰çš„ç›®å½•æ€»æ˜¯åŒ…å«åœ¨æ–‡ä»¶ @env{AWKPATH} æœç´¢è·¯å¾„çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œè¿™ä¹ŸåŒæ ·åº”ç”¨äº @code{@@include} æœºåˆ¶ã€‚

@node Loading Shared Libraries
@section åœ¨ä½ çš„ç¨‹åºè£…å…¥åŠ¨æ€æ‰©å±•

æœ¬@value{SECTION}æè¿°çš„ä¹Ÿæ˜¯ @command{gawk} çš„ç‰¹æ€§ã€‚

@cindex @code{@@load} directive
@cindex loading extensions, @code{@@load} directive
@cindex extensions, loading, @code{@@load} directive
@code{@@load} å…³é”®å­—ï¼Œå¯ä»¥ç”¨æ¥è¯»å–å¤–éƒ¨çš„ @command{awk} æ‰©å±•ï¼ˆå­˜å‚¨ä¸ºç³»ç»Ÿå…±äº«åº“ï¼‰ã€‚
è¿™ä¸ªæœºåˆ¶å¯ä»¥è®©ä½ ä½¿ç”¨ç¼–è¯‘è¿‡çš„ä»£ç æ¥å®ç°éå¸¸é«˜çš„æ‰§è¡Œæ€§èƒ½ï¼Œå¹¶ä¸”/æˆ–è€…ä½¿ç”¨ä½¿ç”¨ä¸€äº› @command{awk} è¯­è¨€æ‰€ä¸æ”¯æŒçš„èƒ½åŠ›ã€‚
@env{AWKLIBPATH} å˜é‡æ¥ç”¨è¿›è¡Œæ‰©å±•çš„æœç´¢ã€‚ä½¿ç”¨ @code{@@load} æœºåˆ¶å®Œå…¨ä¸ä½¿ç”¨å‘½ä»¤è¡Œé€‰é¡¹ @option{-l} ç­‰åŒã€‚

å¦‚æœæ‰©å±•ä¸€å¼€å§‹æ²¡æœ‰åœ¨ @env{AWKLIBPATH} ä¸­æ‰¾åˆ°ï¼Œä¼šé€šè¿‡ç»™@value{FN}é™„åŠ ä¸Šé»˜è®¤åŠ¨æ€åº“æ‰©å±•åå†æœç´¢ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œåœ¨ GNU/Linux ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªåç¼€åæ˜¯ @samp{.so} ï¼š

@example
$ @kbd{gawk '@@load "ordchr"; BEGIN @{print chr(65)@}'}
@print{} A
@end example

@noindent
ä¸Šé¢çš„ä»£ç ä¸ä¸‹é¢çš„ä¾‹å­ç­‰åŒï¼š

@example
$ @kbd{gawk -lordchr 'BEGIN @{print chr(65)@}'}
@print{} A
@end example

@noindent
å¯¹äºå‘½ä»¤è¡Œçš„ä½¿ç”¨ï¼Œ@option{-l} é€‰é¡¹æ›´åŠ æ–¹ä¾¿ï¼Œä½†æ˜¯ @code{@@load} ç”¨æ¥åœ¨ä½ çš„ @command{awk} æºä»£ç ä¸­åµŒå…¥å¿…é¡»çš„æ‰©å±•ä¹Ÿéå¸¸æœ‰ç”¨ã€‚

@ref{Dynamic Extensions}ï¼Œè¯¦ç»†è§£é‡Šäº†å¦‚ä½•ï¼ˆç”¨ C æˆ–è€… C++ï¼‰æ¥å†™æ‰©å±•ï¼Œè¿™äº›æ‰©å±•å¯ä»¥ç”¨ @code{@@load} æ¥è£…è½½ï¼Œä¹Ÿå¯ä»¥ç”¨ @option{-l} é€‰é¡¹æ¥è£…è½½ã€‚
åœ¨è¿™ç« é‡Œä¹Ÿè¿°åŠäº† @code{ordchr} æ‰©å±•ã€‚

@node Obsolete
@section å·²ç»å–æ¶ˆçš„é€‰é¡¹ä»¥åŠç‰¹æ€§ 

@c update this section for each release!

@cindex options, deprecated
@cindex features, deprecated
@cindex obsolete features
æœ¬@value{SECTION}æ‰€æ¶‰åŠçš„ç‰¹æ€§ä»¥åŠ/æˆ–è€…å‘½ä»¤è¡Œé€‰é¡¹ï¼Œæ¥è‡ªä¹‹å‰çš„ @command{gawk} å‘å¸ƒç‰ˆæœ¬ã€‚
è¿™äº›ç‰¹æ€§ï¼Œå‘½ä»¤è¡Œé€‰é¡¹è¦ä¹ˆå·²ç»ä¸å†å¯ç”¨ï¼Œè¦ä¹ˆæ˜¯è™½ç„¶æ˜¯è¿˜æ”¯æŒï¼Œä½†æ˜¯å·²ç»æ ‡å¿—ä¸ºæ”¾å¼ƒçŠ¶æ€(æ„å‘³ç€å®ƒä»¬åœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸­å°†@emph{ä¸å†}å¯ç”¨)ã€‚

è¿›ç¨‹ç›¸å…³çš„ç‰¹æ®Šæ–‡ä»¶ @file{/dev/pid}ï¼Œ@file{/dev/ppid}ï¼Œ@file{/dev/pgrpid}ï¼Œä¸ @file{/dev/user} å·²ç»åœ¨ @command{gawk} 3.1 ç‰ˆæœ¬å–æ¶ˆäº†ï¼Œä½†æ˜¯è¿˜å¯ä»¥ä½¿ç”¨ã€‚
åˆ° 4.0 @value{PVERSION}çš„æ—¶å€™ï¼Œå®ƒä»¬å°†ä¸å†è¢« @command{gawk} è¯†åˆ«ã€‚ï¼ˆè€Œæ˜¯ä½¿ç”¨ @code{PROCINFO}ï¼ŒæŸ¥çœ‹ @ref{Auto-set}ã€‚ï¼‰

@ignore
This @value{SECTION}
is thus essentially a place holder,
in case some option becomes obsolete in a future version of @command{gawk}.
@end ignore

@node Undocumented
@section æœªè®°è½½çš„é€‰é¡¹ä¸ç‰¹æ€§ 
@cindex undocumented features
@cindex features, undocumented
@cindex Skywalker, Luke
@cindex Kenobi, Obi-Wan
@cindex Jedi knights
@cindex Knights, jedi
@quotation
@i{ä½¿ç”¨æºä»£ç ï¼Œç¥å¥½è¿ï¼}
@author Obi-Wan
@end quotation

@cindex shells, sea
æœ¬@value{SECTION}ç‰¹æ„ç•™ç©ºã€‚

@ignore
@c If these came out in the Info file or TeX document, then they wouldn't
@c be undocumented, would they?

@command{gawk} has one undocumented option:

@table @code
@item -W nostalgia
@itemx --nostalgia
Print the message @samp{awk: bailing out near line 1} and dump core.
This option was inspired by the common behavior of very early versions of
Unix @command{awk} and by a t--shirt.
The message is @emph{not} subject to translation in non-English locales.
@c so there! nyah, nyah.
@end table

Early versions of @command{awk} used to not require any separator (either
a newline or @samp{;}) between the rules in @command{awk} programs.  Thus,
it was common to see one-line programs like:

@example
awk '@{ sum += $1 @} END @{ print sum @}'
@end example

@command{gawk} actually supports this but it is purposely undocumented
because it is bad style.  The correct way to write such a program
is either:

@example
awk '@{ sum += $1 @} ; END @{ print sum @}'
@end example

@noindent
or:

@example
awk '@{ sum += $1 @}
     END @{ print sum @}' data
@end example

@noindent
@ref{Statements/Lines}, for a fuller explanation.

You can insert newlines after the @samp{;} in @code{for} loops.
This seems to have been a long-undocumented feature in Unix @command{awk}.

Similarly, you may use @code{print} or @code{printf} statements in the
@var{init} and @var{increment} parts of a @code{for} loop.  This is another
long-undocumented ``feature'' of Unix @command{awk}.

@end ignore

@node Invoking Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
ä½¿ç”¨ @samp{awk '@var{program}' @var{files}} æˆ–è€… @samp{awk -f @var{program-file} @var{files}} æ¥è¿è¡Œ @command{awk}ã€‚

@item
å¯¹æ‰€æœ‰ç‰ˆæœ¬çš„ @command{awk}ï¼Œæœ‰ä¸‰ä¸ªæ ‡å‡†çš„é€‰é¡¹ï¼Œå³ @option{-f}ï¼Œ@option{-F} ä¸ @option{-v}ã€‚
@command{gawk} æ”¯æŒè¿™å‡ ä¸ªé€‰é¡¹ï¼Œä¹Ÿæ”¯æŒå…¶ä»–è®¸å¤šçš„é€‰é¡¹ï¼Œä»¥åŠ GNU é£æ ¼çš„é•¿é€‰é¡¹ã€‚

@item
éé€‰é¡¹çš„å‘½ä»¤è¡Œå‚æ•°é€šå¸¸ä¼šè¢«å½“åš@value{FN}å¯¹å¾…ï¼Œé™¤éå®ƒä»–æœ‰ @samp{@var{var}=@var{value}} è¿™æ ·çš„å½¢å¼ï¼Œè¿™ç§å½¢å¼ä¸‹ï¼Œä¼šåœ¨ @command{awk} å¤„ç†è¾“å…¥æ–‡ä»¶æ—¶æ‰§è¡Œå˜é‡èµ‹å€¼è¯­å¥ã€‚

@item
æ‰€æœ‰çš„éé€‰é¡¹å‘½ä»¤è¡Œå‚æ•°ï¼Œä¸åŒ…æ‹¬ç¨‹åºæ–‡æœ¬ï¼Œéƒ½ä¼šå­˜æ”¾äº @code{ARGV} æ•°ç»„ä¸­ï¼Œè°ƒæ•´ @code{ARGC} ä¸ @code{ARGV} ä¼šå½±å“ @command{awk} å¤„ç†è¾“å…¥çš„æ–¹å¼ã€‚

@item
åœ¨å‘½ä»¤è¡Œä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„å‡å·ï¼ˆ@samp{-}ï¼‰æ¥æŒ‡å®šæ ‡å‡†è¾“å…¥ã€‚
@command{gawk} ä¹Ÿå¯ä»¥è®©ä½ ä½¿ç”¨ç‰¹æ®Š@value{FN} @file{/dev/stdin}ã€‚

@item
@command{gawk} ä¼šå…³æ³¨ä¸€ç³»åˆ—çš„ç¯å¢ƒå˜é‡ï¼Œ@env{AWKPATH}ï¼Œ@env{AWKLIBPATH} ä¸ @env{POSIXLY_CORRECT} æ˜¯æœ€é‡è¦çš„å‡ ä¸ªã€‚

@item
@command{gawk} çš„é€€å‡ºçŠ¶æ€å‘è°ƒç”¨å®ƒçš„ç¨‹åºä¼ é€’äº†ç›¸åº”çš„ä¿¡æ¯ã€‚åœ¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨ @code{exit} è¯­å¥æ¥è®¾ç½® @command{awk} ç¨‹åºçš„é€€å‡ºçŠ¶æ€ã€‚

@item
@command{gawk} å¯ä»¥å°†å…¶ä»–çš„ @command{awk} æºä»£ç åŒ…å«åœ¨åˆ°ä½ çš„ç¨‹åºä¸­ï¼Œ
è¿™æ˜¯é€šè¿‡ @code{@@include} è¯­å¥ä»¥åŠ/æˆ–è€… @option{-i} ä¸ @option{-f} å‘½ä»¤è¡Œå‚æ•°æ¥å®ç°çš„ã€‚

@item
é€šè¿‡ @code{@@load} è¯­å¥ä¸/æˆ–è€… @option{-l} é€‰é¡¹ï¼Œä½ å¯ä»¥å°†ä½¿ç”¨ C æˆ–è€… C++ ç¼–è¯‘çš„å…¶ä»–é™„åŠ åŠŸèƒ½æ¨¡å—ï¼ˆæ‰©å±•ï¼‰å¼•å…¥ä½ çš„ç¨‹åºã€‚
ï¼ˆè¿™ä¸ªé«˜çº§ç‰¹æ€§ä¼šåœ¨ @ref{Dynamic Extensions}ï¼Œä¸­è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚ï¼‰
@end itemize

@node Regexp
@chapter æ­£åˆ™è¡¨è¾¾å¼

@cindex regexp
@cindex regular expressions

@dfn{æ­£åˆ™è¡¨è¾¾å¼}ï¼Œä¹Ÿç§°ä¸º @dfn{regexp}ï¼Œæ˜¯æè¿°å­—ä¸²é›†çš„æ–¹æ³•ã€‚ç”±äºæ­£åˆ™è¡¨è¾¾å¼æ˜¯ @command{awk} ç¨‹åºæœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œ
å®ƒä»¬çš„æ ¼å¼ä¸ä½¿ç”¨æœ‰å¿…è¦ç”¨å•ç‹¬çš„@value{CHAPTER}æ¥è¿›è¡Œè§£æã€‚

@cindex forward slash (@code{/}) to enclose regular expressions
@cindex @code{/} (forward slash) to enclose regular expressions
åœ¨æ–œæ å¯¹ï¼ˆ@samp{/}ï¼‰ä¸­åŒ…æ‹¬çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåœ¨ @command{awk} ä¸­ç§°ä¸ºæ¨¡å¼ï¼Œç”¨ä»¥åŒ¹é…é‚£äº›å±äºè¿™ä¸ªå­—ä¸²é›†çš„è¾“å…¥è®°å½•ã€‚
æœ€ç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯ä¸€ä¸²å­—ç¬¦åºåˆ—ï¼Œæ•°å­—æˆ–è€…äºŒè€…å…¼è€Œæœ‰ä¹‹ã€‚è¿™æ ·çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä»»æ„å…·æœ‰è¿™ä¸ªå­—ç¬¦åºåˆ—çš„å­—ä¸²ã€‚
æ‰€ä»¥æ­£åˆ™è¡¨è¾¾å¼ @samp{foo} åŒ¹é…ä»»æ„åŒ…å« @samp{foo} çš„å­—ä¸²ã€‚è¿™æ ·ï¼Œæ¨¡å¼ @code{/foo/} åŒ¹é…ä»»æ„çš„è¾“å…¥è®°å½•ï¼Œ
åªè¦è¿™ä¸ªè®°å½•åœ¨@emph{ä»»æ„ä½ç½®}åŒ…å«è¿™ä¸‰ä¸ªè¿ç»­çš„å­—ç¬¦åºåˆ— @samp{foo} å¥½å¯ã€‚å…¶ä»–ç±»å‹çš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥è®©ä½ æŒ‡å®šæ›´å¤æ‚çš„å­—ä¸²ç±»ã€‚

@ifnotinfo
åœ¨æœ¬ç« çš„å¼€å§‹çš„ä¾‹å­ï¼Œéƒ½æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚å½“æˆ‘ä»¬æ›´æ·±å…¥åœ°è§£é‡Šæ­£åˆ™è¡¨è¾¾å¼å¦‚ä½•å·¥ä½œæ—¶ï¼Œå°±ä¼šå†™ä¸€äº›æ›´å¤æ‚çš„ä¾‹å­ã€‚
@end ifnotinfo

@menu
* Regexp Usage::                How to Use Regular Expressions.
* Escape Sequences::            How to write nonprinting characters.
* Regexp Operators::            Regular Expression Operators.
* Bracket Expressions::         What can go between @samp{[...]}.
* Leftmost Longest::            How much text matches.
* Computed Regexps::            Using Dynamic Regexps.
* GNU Regexp Operators::        Operators specific to GNU software.
* Case-sensitivity::            How to do case-insensitive matching.
* Regexp Summary::              Regular expressions summary.
@end menu

@node Regexp Usage
@section å¦‚ä½•ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼

@cindex regular expressions, as patterns
æ­£åˆ™è¡¨è¾¾å¼é€šè¿‡ä¸¤ä¸ªæ–œæ åŒ…å«èµ·æ¥è¿›è¡Œä½¿ç”¨ã€‚ç„¶åæ­£åˆ™è¡¨è¾¾å¼å°±ä¼šå¯¹è®°å½•çš„æ•´ä¸ªæ–‡æœ¬è¿›è¡Œæµ‹è¯•ã€‚ï¼ˆæ­£å¸¸æƒ…å†µä¸‹ï¼Œåªéœ€è¦æŒ‰é¡ºåºåŒ¹é…æ–‡æœ¬çš„ä¸€éƒ¨ä»½å°±èƒ½å¤ŸæˆåŠŸæµ‹è¯•åŒ¹é…ä¸å¦ã€‚ï¼‰ä¾‹å¦‚ï¼Œä¸‹é¢åªéœ€è¦è®°å½•çš„ä»»æ„ä½ç½®å‡ºç° @samp{li} ä¸²ï¼Œå°±æ‰“å°å®ƒçš„ç¬¬äºŒä¸ªåŸŸï¼š

@example
$ @kbd{awk '/li/ @{ print $2 @}' mail-list}
@print{} 555-5553
@print{} 555-0542
@print{} 555-6699
@print{} 555-3430
@end example

@cindex regular expressions, operators
@cindex operators, string-matching
@c @cindex operators, @code{~}
@cindex string-matching operators
@cindex @code{~} (tilde), @code{~} operator
@cindex tilde (@code{~}), @code{~} operator
@cindex @code{!} (exclamation point), @code{!~} operator
@cindex exclamation point (@code{!}), @code{!~} operator
@c @cindex operators, @code{!~}
@cindex @code{if} statement, use of regexps in
@cindex @code{while} statement, use of regexps in
@cindex @code{do}-@code{while} statement, use of regexps in
@c @cindex statements, @code{if}
@c @cindex statements, @code{while}
@c @cindex statements, @code{do}
æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ç”¨äºåŒ¹é…è¡¨è¾¾å¼ã€‚è¿™äº›è¡¨è¾¾å¼ä¸­ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªè¦åŒ¹é…çš„ä¸²ï¼›è€Œä¸éœ€è¦æ•´ä¸ªçš„è¾“å…¥è®°å½•ã€‚
æœ‰ä¸¤ä¸ªæ“ä½œç¬¦æ¥æ‰§è¡ŒåŒ¹é…ï¼Œä¸€ä¸ªæ˜¯ @samp{~}ï¼Œä¸€ä¸ªæ˜¯ @samp{!~}ã€‚
è¿™äº›è¡¨è¾¾å¼å¯ä»¥ç”¨ä½œæ¨¡å¼éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨ @code{if} è¯­å¥ï¼Œ@code{while} è¯­å¥ï¼Œ@code{for} è¯­å¥ï¼Œä»¥åŠ @code{do} è¯­å¥ã€‚
ï¼ˆæŸ¥çœ‹ @ref{Statements}ã€‚ï¼‰ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœ @var{exp}ï¼ˆå­˜æœ‰å­—ä¸²ï¼‰åŒ¹é… @var{regexp} åˆ™ä¼šä¸ºçœŸï¼š

@example
@var{exp} ~ /@var{regexp}/
@end example

@noindent
ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŒ¹é…ï¼Œæˆ–è€…é€‰æ‹©æ‰€æœ‰çš„è¾“å…¥è®°å½•ä¸­çš„ç¬¬ä¸€ä¸ªåŸŸä¸­æŸä¸ªåœ°æ–¹å­˜åœ¨å¤§å­—çš„å­—æ¯ @samp{J} ï¼š

@example
$ @kbd{awk '$1 ~ /J/' inventory-shipped}
@print{} Jan  13  25  15 115
@print{} Jun  31  42  75 492
@print{} Jul  24  34  67 436
@print{} Jan  21  36  64 620
@end example

ä¸‹é¢æ‰§è¡Œä¸€æ ·çš„åŠŸèƒ½ï¼š

@example
awk '@{ if ($1 ~ /J/) print @}' inventory-shipped
@end example

ä¸‹ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœè¡¨è¾¾å¼ @var{exp}ï¼ˆå­˜æœ‰å­—ä¸²ï¼‰@emph{ä¸}åŒ¹é… regexp åˆ™ä¸ºçœŸï¼š

@example
@var{exp} !~ /@var{regexp}/
@end example

ä¸‹é¢çš„ä¾‹å­ä¸­åŒ¹é…æˆ–è€…é€‰æ‹©æ‰€æœ‰çš„ï¼Œç¬¬ä¸€ä¸ªåŸŸä¸åŒ…å«å¤§å†™å­—æ¯ @samp{J} çš„è®°å½•ï¼š

@example
$ @kbd{awk '$1 !~ /J/' inventory-shipped}
@print{} Feb  15  32  24 226
@print{} Mar  15  24  34 228
@print{} Apr  31  52  63 420
@print{} May  16  34  29 208
@dots{}
@end example

@cindex regexp constants
@cindex constant regexps
@cindex regular expressions, constants, See regexp constants
å½“ regexp è¢«æ–œæ åŒ…å«æ—¶ï¼Œå¦‚ @code{/foo/} æˆ‘ä»¬ç§°ä¹‹ä¸º@dfn{æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡}ï¼Œå°±ç±»ä¼¼äº @code{5.27} æ˜¯ä¸€ä¸ªæ•°å€¼å¸¸é‡ä»¥åŠ @code{"foo"} æ˜¯ä¸€ä¸ªå­—ä¸²å¸¸é‡ä¸€æ ·ã€‚

@node Escape Sequences
@section è½¬ä¹‰åºåˆ—

@cindex escape sequences, in strings
@cindex backslash (@code{\}), in escape sequences
@cindex @code{\} (backslash), in escape sequences
æœ‰äº›å­—ç¬¦ä¸èƒ½å¤ŸåŸæ ·åœ°åœ¨å­—ä¸²å¸¸é‡ï¼ˆ@code{"foo"}ï¼‰æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼ˆ@code{/foo/}ï¼‰ä¸­ã€‚
ç›¸åï¼Œå®ƒä»¬éœ€è¦æ”¾åœ¨@dfn{è½¬ä¹‰åºåˆ—}ä¸­ï¼Œåœ¨è¿™ä¸ªåºåˆ—ä¸­ï¼Œå­—ç¬¦ä¼šç”¨ä¸€ä¸ªåæ–œæ ï¼ˆ@samp{\}ï¼‰å¼€å§‹ã€‚
å…¶ä¸­çš„ä¸€ä¸ªç”¨æ³•å°±æ˜¯åœ¨ä¸€ä¸ªåŒå¼•å·å­—ä¸²å¸¸é‡ä¸­åŒ…å«è¿›ä¸€ä¸ªåŒå¼•å·ã€‚ç”±äºå…‰åŒå¼•å·ä¼šç»“æŸä¸€ä¸ªä¸²ï¼Œåœ¨å­—ä¸²ä¸­ï¼Œä½ å¿…é¡»ä½¿ç”¨ @samp{\"} æ¥è¡¨ç¤ºä¸€ä¸ªå®é™…çš„åŒå¼•å·ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{awk 'BEGIN @{ print "He said \"hi!\" to her." @}'}
@print{} He said "hi!" to her.
@end example

åæ–œæ å­—ç¬¦è‡ªå·±æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªä¸èƒ½ä»¥é€šå¸¸æ–¹å¼åŒ…å«çš„å­—ç¬¦ï¼›ä½ å¿…é¡»è¾“å…¥ @samp{\\} æ¥å°†åæ–œæ åŒ…å«è¿›å­—ä¸²æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ä¸­ã€‚å› æ­¤ï¼Œå¦‚æœå­—ä¸²çš„å†…å®¹ä¸º @samp{"} ä¸ @samp{\}ï¼Œåˆ™å¿…é¡»å†™æˆ @code{"\"\\"}ã€‚

å…¶ä»–çš„è½¬ä¹‰å­—ç¬¦æ˜¯ä¸€äº›å¦‚ TAB æˆ–è€…æ¢è¡Œç¬¦è¿™æ ·çš„ä¸å¯æ‰“å°å­—ç¬¦ã€‚æ²¡ä»€ä¹ˆä¸œè¥¿å¯ä»¥é˜»æ­¢ä½ è¾“å…¥å¤§å¤šæ•°çš„ä¸å¯æ‰“å°å­—ç¬¦åˆ°å­—ä¸²å¸¸é‡æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ä¸­ï¼Œä½†é‚£çœ‹èµ·æ¥å¥‡ä¸‘æ— æ¯”ã€‚

ä¸‹é¢çš„åˆ—è¡¨åˆ—å‡ºäº†æ‰€æœ‰çš„åœ¨ @command{awk} ä¸­ä½¿ç”¨çš„è½¬ä¹‰çš„å­—ç¬¦ä»¥åŠå…¶å¯¹åº”çš„å­—ç¬¦ã€‚é™¤éå¦å¤–æç¤ºï¼Œæ‰€æœ‰è¿™äº›è½¬ä¹‰å­—ç¬¦å³å¯ç”¨äºå­—ä¸²å¸¸é‡ä¹Ÿç”¨äºæ­£åˆ™è¡¨è¾¾å¼ï¼š

@table @code
@item \\
 å­—ç¬¦åæ–œæ  @samp{\}ã€‚

@c @cindex @command{awk} language, V.4 version
@cindex @code{\} (backslash), @code{\a} escape sequence
@cindex backslash (@code{\}), @code{\a} escape sequence
@item \a
 â€œalertâ€å­—ç¬¦ï¼Œ@kbd{Ctrl-g}ï¼ŒASCII ä»£ç  7ï¼ˆBELï¼Œå“é“ƒï¼‰ã€‚ï¼ˆè¿™é€šå¸¸æ˜¯åˆ¶é€ ä¸€äº›å¯ä»¥å¬å¾—åˆ°çš„å™ªå£°ã€‚ï¼‰

@cindex @code{\} (backslash), @code{\b} escape sequence
@cindex backslash (@code{\}), @code{\b} escape sequence
@item \b
 é€€æ ¼ï¼Œ@kbd{Ctrl-h}ï¼ŒASCII ä»£ç 8ï¼ˆBSï¼‰ã€‚

@cindex @code{\} (backslash), @code{\f} escape sequence
@cindex backslash (@code{\}), @code{\f} escape sequence
@item \f
 æ¢é¡µï¼Œ@kbd{Ctrl-l}ï¼ŒASCII ä»£ç  12ï¼ˆFFï¼‰ã€‚

@cindex @code{\} (backslash), @code{\n} escape sequence
@cindex backslash (@code{\}), @code{\n} escape sequence
@item \n
 æ¢è¡Œï¼Œ@kbd{Ctrl-j}ï¼ŒASCII ä»£ç  10ï¼ˆLFï¼‰ã€‚

@cindex @code{\} (backslash), @code{\r} escape sequence
@cindex backslash (@code{\}), @code{\r} escape sequence
@item \r
 å›è½¦ï¼Œ@kbd{Ctrl-m}ï¼ŒASCII ä»£ç 13ï¼ˆCRï¼‰ã€‚

@cindex @code{\} (backslash), @code{\t} escape sequence
@cindex backslash (@code{\}), @code{\t} escape sequence
@item \t
 æ°´å¹³è·³æ ¼ï¼Œ@kbd{Ctrl-i}ï¼ŒASCII ä»£ç 9ï¼ˆHTï¼‰ã€‚

@c @cindex @command{awk} language, V.4 version
@cindex @code{\} (backslash), @code{\v} escape sequence
@cindex backslash (@code{\}), @code{\v} escape sequence
@item \v
 å‚ç›´è·³æ ¼ï¼Œ@kbd{Ctrl-k}ï¼ŒASCII ä»£ç 11ï¼ˆVTï¼‰ã€‚

@cindex @code{\} (backslash), @code{\}@var{nnn} escape sequence
@cindex backslash (@code{\}), @code{\}@var{nnn} escape sequence
@item \@var{nnn}
 å…«è¿›åˆ¶å€¼ @var{nnn}ï¼Œ@var{nnn} è¡¨ç¤º 1 åˆ° 3 ä½çš„ @samp{0} åˆ° @samp{7} ä¹‹é—´çš„æ•°å­—ã€‚å¦‚ï¼ŒASCII ESC å­—ç¬¦çš„ä»£ç æ˜¯ @samp{\033}ã€‚

@c @cindex @command{awk} language, V.4 version
@c @cindex @command{awk} language, POSIX version
@cindex @code{\} (backslash), @code{\x} escape sequence
@cindex backslash (@code{\}), @code{\x} escape sequence
@cindex common extensions, @code{\x} escape sequence
@cindex extensions, common@comma{} @code{\x} escape sequence
@item \x@var{hh}@dots{}
 åå…­è¿›åˆ¶å€¼ @var{hh}ï¼Œ@var{hh} è¡¨ç¤ºåå…­è¿›åˆ¶æ•°å­—ï¼ˆ@samp{0} åˆ° @samp{9}ï¼Œä»¥åŠ @samp{A} åˆ° @samp{F} æˆ–è€… @samp{a} åˆ° @samp{f}ï¼‰åºåˆ—ã€‚
ç±»ä¼¼äº ISO C ä¸­çš„ç»“æ„ï¼Œè½¬æ¢åºåˆ—ä¸€ç›´å»¶ç»­åˆ°ç¬¬ä¸€ä¸ªéåå…­è¿›åˆ¶çš„æ•°å­—ä¸ºæ­¢ã€‚
@value{COMMONEXT}ä½†æ˜¯ï¼Œä½¿ç”¨ä¸¤ä¸ªä»¥ä¸Šçš„åå…­è¿›åˆ¶çš„æ•°å­—ä¼šäº§ç”Ÿæœªå®šä¹‰çš„ç»“æœã€‚ï¼ˆ@samp{\x} è½¬ä¹‰åºåˆ—åœ¨ POSIX @command{awk} ä¸­ä¸è¢«æ”¯æŒã€‚ï¼‰

@quotation æ³¨æ„
ä¸‹ä¸€ä¸ª @command{gawk} çš„ä¸»è¦ç‰ˆæœ¬ä¼šæœ‰æ”¹å˜ï¼Œä¼šä½¿ç”¨åˆ° @samp{\x} åé¢è·Ÿä¸¤ä¸ªæœ€å¤§çš„åå…­è¿›åˆ¶æ•°å­—çš„æƒ…å†µã€‚
@end quotation

@cindex @code{\} (backslash), @code{\/} escape sequence
@cindex backslash (@code{\}), @code{\/} escape sequence
@item \/
A literal slash (necessary for regexp constants only).
 å­—é¢æ–œæ å­—ç¬¦ï¼ˆåœ¨æ­£åˆ™è¡¨è¾¾å¼çš„å¸¸é‡ä¸­ä½¿ç”¨ï¼‰ã€‚å½“ä½ è¦åœ¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­åŠ å…¥æœ‰åæ–œæ çš„è¡¨è¾¾å¼å¸¸é‡æ—¶ä½¿ç”¨
ï¼ˆå¦‚ @code{/.*:\/home\/[[:alnum:]]+:.*/} ç¬¦å·ä¼šåœ¨ @ref{Bracket Expressions} è®¨è®ºã€‚ï¼‰
ç”±äºæ­£åˆ™è¡¨è¾¾å¼é€šè¿‡æ–œæ æ¥åˆ†éš”ï¼Œæ‰€ä»¥å¦‚æœæ–œæ æ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä½ å°±éœ€è¦è¿›è¡Œè½¬ä¹‰ï¼Œä»¥é€šçŸ¥ @command{awk} ç»§ç»­å¤„ç†æ­£åˆ™è¡¨è¾¾å¼åé¢çš„éƒ¨åˆ†ã€‚

@cindex @code{\} (backslash), @code{\"} escape sequence
@cindex backslash (@code{\}), @code{\"} escape sequence
@item \"
 å­—é¢åŒå¼•å·ï¼ˆä»…åœ¨å­—ä¸²å¸¸é‡ä¸­ä½¿ç”¨ï¼‰ã€‚è¿™ä¸ªåºåˆ—å½“ä½ è¦åœ¨ä¸€ä¸ªå­—ä¸²å¸¸é‡ä¸­åŒ…å«åŒå¼•å·æ—¶ä½¿ç”¨
 ï¼ˆä¾‹å¦‚ @code{"He said \"hi!\" to her."}ï¼‰ã€‚
 ç”±äºåŒå¼•å·ç”¨æ¥åˆ†éš”å­—ä¸²ï¼Œæ‰€ä»¥å½“åœ¨å­—ä¸²ä¸­æœ‰åŒå¼•å·æ—¶ï¼Œä½ éœ€è¦è¿›è¡Œè½¬ä¹‰ï¼Œä»¥é€šçŸ¥ @command{awk} ç»§ç»­å¤„ç†å­—ä¸²åé¢çš„éƒ¨åˆ†ã€‚
@end table

åœ¨ @command{gawk} çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæœ‰è®¸å¤šçš„ä»¥åæ–œæ å¼€å§‹ä¸¤å­—ç¬¦åºåˆ—æœ‰å…³ç‰¹æ®Šçš„æ„ä¹‰ã€‚æŸ¥çœ‹ @ref{GNU Regexp Operators}ã€‚

åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œåœ¨ä»»æ„å­—ç¬¦å‰çš„åæ–œæ ï¼Œä¸åœ¨å‰é¢çš„åˆ—è¡¨ä¸­ï¼Œä¹Ÿæ²¡æœ‰åœ¨ @ref{GNU Regexp Operators} ä¸­ï¼Œå…¶ä¸‹ä¸€ä¸ªå­—ç¬¦åˆ™ä¼šæŒ‰å­—é¢çš„å¤„ç†ã€‚
å°±ç®—å®ƒæ­£å¸¸æƒ…å†µä¸‹æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„æ“ä½œç¬¦ã€‚ä¾‹å¦‚ @code{/a\+b/} åŒ¹é…3ä¸ªå­—ç¬¦çš„ä¸² @samp{a+b} ã€‚

@cindex backslash (@code{\}), in escape sequences
@cindex @code{\} (backslash), in escape sequences
@cindex portability
ä¸ºäº†å®Œå…¨å¯ç§»æ¤ï¼Œä¸è¦ä½¿ç”¨ä»»ä½•æ²¡æœ‰åœ¨å‰é¢åˆ—è¡¨åˆ—å‡ºçš„å­—ç¬¦æˆ–è€…åœ¨ä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦å­—ç¬¦å‰ä½¿ç”¨åæ–œæ ã€‚

@c 11/2014: Moved so as to not stack sidebars
@sidebar å¸¸è§„å­—ç¬¦å‰çš„åæ–œæ 
@cindex portability, backslash in escape sequences
@cindex POSIX @command{awk}, backslashes in string constants
@cindex backslash (@code{\}), in escape sequences, POSIX and
@cindex @code{\} (backslash), in escape sequences, POSIX and

@cindex troubleshooting, backslash before nonspecial character
å¦‚æœä½ åœ¨å­—ä¸²å¸¸é‡ä¸­çš„æŸä¸ªæœªåœ¨å‰é¢çš„åˆ—è¡¨ä¸­åˆ—å‡ºçš„å­—ç¬¦å‰ä½¿ç”¨åæ–œæ ï¼ŒPOSIX @command{awk} æœ‰æ„åœ°ä½¿è¿™ç§æƒ…å†µä¸ºæœªå®šä¹‰ã€‚æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š

@c @cindex automatic warnings
@c @cindex warnings, automatic
@cindex Brian Kernighan's @command{awk}
@table @asis
@item æŠŠåæ–œæ å»æ‰
è¿™æ­£æ˜¯ BWK @command{awk} ä¸ @command{gawk} ä¸¤è€…æ‰€åšçš„ã€‚
ä¾‹å¦‚ @code{"a\qc"} ä¸ @code{"aqc"} ä¸€æ ·ã€‚
ï¼ˆå› ä¸ºè¿™æ˜¯å¾ˆå®¹æ˜“å¼•å…¥ï¼Œåˆå®¹æ˜“é”™è¿‡çš„ Bugï¼Œ@command{gawk} ä¼šç»™äºˆè­¦å‘Šã€‚ï¼‰
è€ƒè™‘ @samp{FS = @w{"[ \t]+\|[ \t]+"}} ä½¿ç”¨ç«–çº¿ @samp{|} ä»¥åŠå‘¨è¾¹çš„ç©ºç™½ä½œä¸ºåŸŸåˆ†éš”ç¬¦ï¼Œ
è¿™æ—¶ï¼Œéœ€è¦åœ¨å­—ä¸²ä¸­ä½¿ç”¨ä¸¤ä¸ªåæ–œæ ï¼š@samp{FS = @w{"[ \t]+\\|[ \t]+"}}ã€‚ï¼‰
@c I did this!  This is why I added the warning.

@cindex @command{gawk}, escape sequences
@cindex Unix @command{awk}, backslashes in escape sequences
@cindex @command{mawk} utility
@item ä¿ç•™åæ–œæ 
æœ‰ä¸€äº› @command{awk} å®ç°ä¼šè¿™ä¹ˆåšã€‚åœ¨è¿™ç§å®ç°ä¸­ï¼Œè¾“å…¥ @code{"a\qc"} å°†ä¸è¾“å…¥ @code{"a\\qc"} ç›¸åŒã€‚
@end table
@end sidebar

æ€»ç»“ä¸€ä¸‹ï¼š

@itemize @value{BULLET}
@item
å¯¹äºå­—ä¸²å¸¸é‡ä¸æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼Œå‰é¢åˆ—è¡¨ä¸­çš„è½¬ä¹‰åºåˆ—éƒ½æ˜¯ä¼šé¦–å…ˆå¤„ç†ã€‚å¤„ç†çš„æ—¶é—´éå¸¸é å‰ï¼Œ@command{awk} ä¸€è¯»å®Œä½ çš„ç¨‹åºï¼Œå°±å¤„ç†äº†ã€‚

@item
å¸¸é‡æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…åŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @ref{Computed Regexps}ï¼‰ï¼Œ@command{gawk} éƒ½ä¼šå¤„ç†åˆ—åœ¨ @ref{GNU Regexp Operators} ä¸­çš„æ“ä½œç¬¦ã€‚

@item
åœ¨å…¶ä»–çš„ç¬¦å·å‰ä½¿ç”¨åæ–œæ ï¼Œéƒ½è¡¨ç¤ºæŠŠè¿™ä¸ªç¬¦å·æŒ‰å­—é¢å¤„ç†ã€‚
@end itemize

@sidebar è½¬ä¹‰å…ƒå­—ç¬¦
@cindex metacharacters, escape sequences for

å‡è®¾ä½ ä½¿ç”¨å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶è½¬ä¹‰æ¥æäº¤æ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦ï¼ˆæŸ¥çœ‹ @ref{Regexp Operators}ï¼‰ï¼Œ@command{awk} æ˜¯å¦å°†è¿™äº›å­—ç¬¦åšä¸ºå­—é¢å­—ç¬¦è¿˜æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦ï¼Ÿ

@cindex dark corner, escape sequences, for metacharacters
ç”±äºå†å²åŸå› ï¼Œè¿™æ ·çš„å­—ç¬¦æ˜¯æŒ‰ç…§å­—é¢å­—ç¬¦æ¥å¤„ç†çš„ã€‚
@value{DARKCORNER}
ç„¶è€Œï¼ŒPOSIX æ ‡å‡†å´è¡¨ç¤ºå®ƒä»¬åº”è¯¥è¢«å½“æˆçœŸæ­£çš„å…ƒå­—ç¬¦ï¼Œ@command{gawk} åˆ™æ˜¯è¿™ä¹ˆå¤„ç†çš„ã€‚
åœ¨å…¼å®¹æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ@command{gawk} åœ¨æ­£åˆ™è¡¨è¾¾å¼å¸¸ä¸­ä¼šå°†è¿™äº›è½¬ä¹‰çš„å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶çš„å­—ç¬¦æŒ‰å­—é¢å¤„ç†ã€‚å› æ­¤ @code{/a\52b/} ä¸ @code{/a\*b/} ç­‰åŒã€‚
@end sidebar

@node Regexp Operators
@section æ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦
@cindex regular expressions, operators
@cindex metacharacters in regular expressions

ä½ å¯ä»¥åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä¸ç‰¹å®šå­—ç¬¦è¿›è¡Œç»„åˆï¼Œç§°ä¸º@dfn{æ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦}æˆ–è€…@dfn{å…ƒå­—ç¬¦}ï¼Œæ¥ç»™æ­£å¸¸è¡¨è¾¾å¼åŠ å…¥æ›´åŠ å¼ºå¤§çš„èƒ½åŠ›ä¸å¤šæ ·æ€§ã€‚

åœ¨å‰èŠ‚ @ref{Escape Sequences} ä¸­æ‰€æè¿°çš„è½¬ä¹‰å­—ç¬¦ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚
å®ƒä»¬é€šè¿‡åæ–œæ  @samp{\} å¼•å…¥ï¼Œç„¶ååœ¨å¤„ç†æ­£åˆ™è¡¨è¾¾å¼ç¬¬ä¸€æ­¥ï¼Œè¢«è¯†åˆ«æˆæˆ–è€…è½¬æ¢æˆç›¸åº”çš„çœŸå®å­—ç¬¦ã€‚

ä¸‹é¢æ˜¯å…ƒå­—ç¬¦åˆ—è¡¨ã€‚æ‰€æœ‰çš„é‚£äº›æœªåˆ—åœ¨æ­¤çš„ï¼Œéè½¬ä¹‰åºåˆ—ï¼Œå°±æ˜¯ä»£è¡¨ä»–ä»¬è‡ªå·±ï¼š

@c Use @asis so the docbook comes out ok. Sigh.
@table @asis
@cindex backslash (@code{\}), regexp operator
@cindex @code{\} (backslash), regexp operator
@item @code{\}
è¿™ä¸ªå–æ¶ˆäº†æŸä¸ªå­—ç¬¦çš„åœ¨åŒ¹é…æ—¶çš„ç‰¹æ®Šå«ä¹‰ï¼Œå¦‚ @samp{\$} å°±æ˜¯åŒ¹é…å­—ç¬¦ @samp{$} ã€‚

@cindex regular expressions, anchors in
@cindex Texinfo, chapter beginnings in files
@cindex @code{^} (caret), regexp operator
@cindex caret (@code{^}), regexp operator
@item @code{^}
è¿™é‡ŒåŒ¹é…å­—ä¸²çš„å¼€å¤´ã€‚@samp{^@@chapter} åŒ¹é…å­—ä¸²å¼€å¤´çš„ @samp{@@chapter}ï¼Œå¦‚å¯ä»¥ç”¨æ¥è¯†åˆ« Texinfo ä¸­ç« çš„å¼€å¤´ã€‚
@samp{^} ä¹Ÿè¢«ç§°ä¸º@dfn{é”šå®šç¬¦}ï¼Œå› ä¸ºå®ƒå°±æ˜¯å°†æ¨¡å¼è®¾å®šæˆåŒ¹é…å­—ä¸²çš„å¼€å¤´ã€‚

è¦äº†è§£ @samp{^} å¹¶ä¸æ˜¯åŒ¹é…å†…åµŒåœ¨å­—ä¸²ä¸­è¡Œå¤´ï¼ˆå³ @samp{\n} å­—ç¬¦æ­£å³è¾¹çš„ç‚¹ï¼‰ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­æ¡ä»¶è¡¨è¾¾å¼ä¸ä¸ºçœŸï¼š

@example
if ("line1\nLINE 2" ~ /^L/) @dots{}
@end example

@cindex @code{$} (dollar sign), regexp operator
@cindex dollar sign (@code{$}), regexp operator
@item @code{$}
è¿™ä¸ªä¸ @samp{^} ç±»ä¼¼ï¼Œä½†æ˜¯åŒ¹é…çš„æ˜¯ä¸²å°¾ã€‚å¦‚ @samp{p$} åŒ¹é…ä»¥ @samp{p} ç»“å°¾çš„ä¸²ã€‚
@samp{$} æ˜¯ä¸ªé”šå®šç¬¦ï¼Œä½†æ˜¯ä¸åŒ¹é…å†…åµŒåœ¨å­—ä¸²ä¸­è¡Œå°¾ï¼ˆåœ¨ @samp{\n} æŒ‰è¡Œç¬¦æ­£å‰çš„ä½ç½®ï¼‰ã€‚ä¸‹é¢çš„ä¾‹å­çš„æ¡ä»¶è¿”å›éçœŸã€‚

@example
if ("line1\nLINE 2" ~ /1$/) @dots{}
@end example

@cindex @code{.} (period), regexp operator
@cindex period (@code{.}), regexp operator
@item @code{.} (period)
åŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œ@emph{åŒ…æ‹¬}æ¢è¡Œç¬¦ã€‚
å¦‚ @samp{.P} åŒ¹é…ä»»æ„å­—ç¬¦åé¢è·Ÿ @samp{P} çš„ä»»æ„å­—ä¸²ã€‚é€šè¿‡ä½¿ç”¨è¿æ¥ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ è¿™æ ·çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚ @samp{U.A}ï¼Œ æ¥åŒ¹é…ä»»æ„çš„ä¸‰å­—ç¬¦åºåˆ—ï¼Œå…¶ä»¥ @samp{U} å¼€å¤´ï¼Œä»¥ @samp{A} ç»“å°¾ã€‚

@cindex POSIX @command{awk}, period (@code{.})@comma{} using
åœ¨ä¸¥æ ¼çš„ POSIX æ¨¡å¼ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ä¸‹ï¼Œ@samp{.} ä¸åŒ¹é… @sc{nul}ï¼ˆç©ºï¼‰å­—ç¬¦ï¼Œè¯¥å­—ç¬¦æ‰€æœ‰çš„ä½éƒ½è¢«ç½®æˆäº† 0ã€‚
å¦åˆ™ï¼Œ@sc{nul} å°±åªæ˜¯å¦ä¸€ä¸ªå­—ç¬¦ã€‚å…¶ä»–ç‰ˆæœ¬çš„ @command{awk} å¯èƒ½ä¸èƒ½åŒ¹é… @sc{nul} å­—ç¬¦ã€‚

@cindex @code{[]} (square brackets), regexp operator
@cindex square brackets (@code{[]}), regexp operator
@cindex bracket expressions
@cindex character sets, See Also bracket expressions
@cindex character lists, See bracket expressions
@cindex character classes, See bracket expressions
@item @code{[}@dots{}@code{]}
è¿™ä¸œè¥¿å«@dfn{æ–¹æ‹¬å·è¡¨è¾¾å¼}ã€‚@footnote{åœ¨å…¶ä»–è¯´æ³•ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°æ–¹æ‹¬å·è¡¨è¾¾å¼æŒ‡çš„æ˜¯è¦ä¹ˆæ˜¯ä¸€ä¸ª@dfn{å­—ç¬¦é›†}ï¼Œæˆ–è€…@dfn{å­—ç¬¦ç±»å‹}ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª@dfn{å­—ç¬¦åˆ—è¡¨}ã€‚}
å®ƒè¦åŒ¹é…çš„æ˜¯åŒ…å«åœ¨æ–¹æ‹¬å·ä¸­çš„ä»»æ„@emph{ä¸€ä¸ª}å­—ç¬¦ã€‚
ä¾‹å¦‚ï¼Œ@samp{[MVX]} åŒ¹é…å­—ç¬¦ @samp{M}ï¼Œ@samp{V} æˆ–è€… @samp{X} ä¸­çš„ä¸€ä¸ªã€‚å¯ä»¥åœ¨æ–¹æ‹¬å·ä¸­æ”¾å…¥ä»€ä¹ˆå­—ç¬¦çš„å®Œæ•´è®¨è®ºåœ¨ @ref{Bracket Expressions}ã€‚

@cindex bracket expressions, complemented
@item @code{[^}@dots{}@code{]}
è¿™ä¸ªæ˜¯@dfn{æ–¹æ‹¬å·ç›¸åè¡¨è¾¾å¼}ã€‚åœ¨å­—ç¬¦ @samp{[} åé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦@emph{å¿…é¡»}æ˜¯ @samp{^}ã€‚
è¿™é‡ŒåŒ¹é…@emph{é™¤äº†}æ–¹æ‹¬å·ä¸­åˆ—å‡ºçš„é‚£äº›å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ@samp{[^awk]}ï¼ŒåŒ¹é…ä¸æ˜¯ @samp{a}ï¼Œ@samp{w}ï¼Œ@samp{k} çš„å­—ç¬¦ã€‚

@cindex @code{|} (vertical bar)
@cindex vertical bar (@code{|})
@item @code{|}
è¿™ä¸ªæ˜¯@dfn{é€‰æ‹©æ“ä½œç¬¦}ï¼Œç”¨æ¥æŒ‡å®šå…¶ä»–é€‰æ‹©ã€‚
@samp{|} åœ¨æ‰€æœ‰çš„æ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦ä¸­å…·æœ‰æœ€ä½çš„ä¼˜å…ˆçº§ã€‚
ä¾‹å¦‚ï¼Œ@samp{^P|[aeiiouy]} è¦ä¹ˆåŒ¹é… @samp{^P}ï¼Œè¦ä¹ˆåŒ¹é… @samp{[aeiouy]}ã€‚
å°±æ˜¯è¯´ï¼ŒåŒ¹é…ä»»æ„ä»¥ @samp{P} å¼€å¤´çš„å­—ä¸²ï¼Œæˆ–è€…åŒ…å«ï¼ˆåœ¨å­—ä¸²ä¸­çš„ä»»ä¸€ä½ç½®ï¼‰è‹±è¯­å…ƒéŸ³å­—æ¯çš„å­—ä¸²ã€‚

é€‰æ‹©æ“ä½œä¼šåœ¨æ­£åˆ™è¡¨è¾¾å¼çš„ä¸¤è¾¹å–ä¸­æœ€å¤§å¯èƒ½æ€§çš„ä¸€è¾¹ã€‚

@cindex @code{()} (parentheses), regexp operator
@cindex parentheses @code{()}, regexp operator
@item @code{(}@dots{}@code{)}
åœ†æ‹¬å·ç”¨æ¥å¯¹æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œç»„åˆï¼Œå¦‚ç®—æ³•ä¸­çš„ç±»ä¼¼ã€‚ä»–ä»¬å¯ä»¥å°†å…·æœ‰é€‰æ‹©æ“ä½œç¬¦ @samp{|} çš„æ­£åˆ™è¡¨è¾¾å¼ç»„åˆèµ·æ¥ã€‚
ä¾‹å¦‚ @samp{@@(samp|code)\@{[^@}]+\@}]+\@}} 
èƒ½å¤ŸåŒ¹é… @samp{@@code@{foo@}} ä¸ @samp{@@samp@{bar@}}ã€‚
ï¼ˆè¿™é‡Œ Texinfo çš„æ ¼å¼æ§åˆ¶åºåˆ—ã€‚ @samp{+} åœ¨æœ¬åˆ—è¡¨ä¸­åé¢è§£é‡Šã€‚ï¼‰

@cindex @code{*} (asterisk), @code{*} operator, as regexp operator
@cindex asterisk (@code{*}), @code{*} operator, as regexp operator
@item @code{*}
è¿™ä¸ªç¬¦å·è¡¨è¾¾å‰é¢çš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥é‡å¤å¤šæ¬¡æ¥æ‰¾åŒ¹é…ã€‚
ä¾‹å¦‚ @samp{ph*} ä¸­å°† @samp{*} ç¬¦å·æ”¾åœ¨å‰é¢çš„ @samp{h} åé¢ï¼Œæ¥æŸ¥æ‰¾ä¸€ä¸ª @samp{p} åé¢è·Ÿè·Ÿéšä»»æ„å¤šä¸ª @samp{h} çš„åŒ¹é…ä¸²ã€‚è¿™ä¹Ÿä¼šåŒ¹é…ä»…æœ‰ @samp{p}ï¼Œè€Œåé¢æ²¡æœ‰ @samp{h} çš„æƒ…å†µã€‚

åœ¨ç†è§£ @samp{*} å¦‚ä½•å·¥ä½œä¸Šé¢ï¼Œæœ‰ä¸¤ä¸ªå¾®å¦™çš„åœ°æ–¹è¦æ³¨æ„ã€‚ç¬¬ä¸€ï¼Œ@samp{*} åªåº”ç”¨åœ¨å…¶å‰é¢çš„å•ç‹¬æ­£åˆ™è¡¨è¾¾å¼ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨ @samp{ph*} ä¸­ï¼Œåªä½œç”¨äº @samp{h}ï¼‰ã€‚
è¦ä½¿ @samp{*} åº”ç”¨åœ¨ä¸€ä¸ªæ›´å¤§çš„å­è¡¨è¾¾å¼ä¸­ï¼Œåˆ™ä½¿ç”¨æ‹¬å·ï¼š@samp{(ph)*} åŒ¹é… @samp{ph}ï¼Œ@samp{phph}ï¼Œ@samp{phphph} ç­‰ç­‰ã€‚

ç¬¬äºŒï¼Œ@samp{*} ä¼šæŸ¥æ‰¾å°½å¯èƒ½å¤šçš„é‡å¤ã€‚å¦‚æœè¦åŒ¹é…çš„æ–‡æœ¬ä¸º @samp{phhhhhhhhhhhhhhooey}ï¼Œåˆ™ @samp{ph*} ä¼šåŒ¹é…æ‰€æœ‰çš„ @samp{h} ã€‚

@cindex @code{+} (plus sign), regexp operator
@cindex plus sign (@code{+}), regexp operator
@item @code{+}
æœ¬ç¬¦å·ç±»ä¼¼äº @samp{*}ï¼Œåªæ˜¯å…¶å‰é¢çš„è¡¨è¾¾å¼è‡³å°‘è¦åŒ¹é…ä¸€æ¬¡ã€‚è¿™å°±æ˜¯è¯´ï¼Œ@samp{wh+y} ä¼šåŒ¹é… @samp{why}ï¼Œä»¥åŠ @samp{whhy}ï¼Œä½†æ˜¯ä¸ä¼šåŒ¹é… @samp{wy}ï¼Œè€Œ @samp{wh*y} åˆ™ä¼šåŒ¹é…æ‰€æœ‰çš„ä¸‰ä¸ªã€‚

@cindex @code{?} (question mark), regexp operator
@cindex question mark (@code{?}), regexp operator
@item @code{?}
è¿™ä¸ªç¬¦å·ç±»ä¼¼äº @samp{*}ï¼Œåªæ˜¯å…¶å‰é¢çš„è¡¨è¾¾å¼åªèƒ½åŒ¹é…è¦ä¹ˆä¸€æ¬¡ï¼Œè¦ä¹ˆä¸åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œ@samp{fe?d} åŒ¹é… @samp{fed} ä¸ @samp{fd}ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„ä»€ä¹ˆã€‚

@cindex interval expressions, regexp operator
@item @code{@{}@var{n}@code{@}}
@itemx @code{@{}@var{n}@code{,@}}
@itemx @code{@{}@var{n}@code{,}@var{m}@code{@}}
åœ¨èŠ±æ‹¬å·ä¸­ä¸å…¶ä¸­çš„ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªæ•°å€¼è¡¨ç¤ºä¸€ç§@dfn{åŒºé—´è¡¨è¾¾å¼}ã€‚
å¦‚æœåªæœ‰ä¸€ä¸ªæ•°å€¼åœ¨èŠ±æ‹¬å·ä¸­ï¼Œåˆ™å‰é¢çš„è¡¨è¾¾å¼é‡å¤ @var{n} æ¬¡ã€‚
å¦‚æœæœ‰ä¸¤ä¸ªæ•°å€¼ï¼Œå¹¶ä»¥é€—å·åˆ†éš”ï¼Œåˆ™å‰é¢çš„è¡¨è¾¾å¼é‡å¤ @var{n} åˆ° @var{m} æ¬¡ã€‚
å¦‚æœåªæœ‰ä¸€ä¸ªæ•°å€¼ï¼Œåé¢è·Ÿä¸€ä¸ªé€—å·ï¼Œåˆ™å‰é¢çš„è¡¨è¾¾å¼è‡³å°‘è¦é‡å¤ @var{n} æ¬¡ã€‚

@table @code
@item wh@{3@}y
åŒ¹é… @samp{whhhy}ï¼Œ ä½†ä¸åŒ¹é… @samp{why} or @samp{whhhhy} ã€‚

@item wh@{3,5@}y
åªåŒ¹é… @samp{whhhy}ï¼Œ@samp{whhhhy}ï¼Œæˆ–è€… @samp{whhhhhy} ã€‚

@item wh@{2,@}y
åŒ¹é… @samp{whhy}ï¼Œ@samp{whhhy}ï¼Œç­‰ç­‰ã€‚
@end table

@cindex POSIX @command{awk}, interval expressions in
åŒºé—´è¡¨è¾¾å¼åœ¨ @command{awk} ä¸Šå†æ¥ä¸å—æ”¯æŒã€‚åé¢æˆä¸º POSIX æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œä½¿å¾— @command{awk} ä¸ @command{egrep} ä¹‹é—´ç›¸äº’ä¿æŒä¸€è‡´ã€‚

@cindex @command{gawk}, interval expressions and
æœ€å¼€å§‹æ—¶ï¼Œç”±äºæ—§çš„ç¨‹åºå¯èƒ½åœ¨æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ä¸­ä½¿ç”¨ @samp{@{} ä¸ @samp{@}}ï¼Œ@command{gawk} å› æ­¤åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­@emph{ä¸}åŒ¹é…åŒºé—´è¡¨è¾¾å¼ã€‚

ä½†æ˜¯ä» 4.0 å¼€å§‹ï¼Œ@command{gawk} å¼€å§‹é»˜è®¤åŒ¹é…åŒºé—´è¡¨è¾¾å¼ã€‚è¿™æ˜¯å› ä¸ºä¸ POSIX æ ‡å‡†å…¼å®¹ï¼Œç›¸æ¯”äºä¸æ—§çš„ç¨‹åºå…¼å®¹ï¼Œå‰è€…æ›´ä¸ºé‡è¦ã€‚

å¯¹äºåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ @samp{@{} ä¸ @samp{@}} çš„ç¨‹åºï¼Œå¥½çš„å®è·µæ˜¯å°†ä»–ä»¬ç”¨åæ–œæ è¿›è¡Œè½¬ä¹‰ã€‚
è¿™æ ·çš„è¯ï¼Œä½ çš„æ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶åœ¨ä»»ä½•å…¶ä»–çš„ç‰ˆæœ¬ä¸­å¯ç”¨ã€‚@footnote{å¦‚æœä½ åœ¨æ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦æˆ–è€…å‡½æ•°ä¸­ä½¿ç”¨å­—ä¸²å¸¸é‡ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸¤ä¸ªåæ–œæ ã€‚}

æœ€åï¼Œå½“ @samp{@{} ä¸ @samp{@}} å‡ºç°åœ¨æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ä¸­ï¼Œä½†ä¸æ˜¯ä»¥ä¸€ç§å¯ä»¥è¢«è§£é‡Šä¸ºåŒºé—´è¡¨è¾¾å¼çš„æ–¹å¼ï¼ˆå¦‚ @code{/q@{a@}/}ï¼‰ï¼Œé‚£ä¹ˆä»–ä»¬å°±åªè¡¨ç¤ºè‡ªå·±ã€‚
@end table

@cindex precedence, regexp operators
@cindex regular expressions, operators, precedence of
åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œ@samp{*}ï¼Œ@samp{+} ä»¥åŠ @samp{?} æ“ä½œç¬¦ï¼ŒåŒ…æ‹¬èŠ±æ‹¬å· @samp{@{} ä¸ @samp{@}}ï¼Œå…·æœ‰æœ€é«˜çš„ä¼˜å…ˆçº§ï¼Œ
ç„¶åæ˜¯è¿æ¥æ“ä½œç¬¦ï¼Œæœ€åæ‰æ˜¯ @samp{|}ï¼Œåœ¨æ•°å­¦ä¸Šï¼Œæ‹¬å·å¯ä»¥æ”¹å˜æ“ä½œç¬¦çš„ç»„åˆæ–¹å¼ã€‚

@cindex POSIX @command{awk}, regular expressions and
@cindex @command{gawk}, regular expressions, precedence
åœ¨ POSIX @command{awk} ä¸­ä¸ @command{gawk} ä¸­ï¼Œ@samp{*}ï¼Œ@samp{+} ä»¥åŠ @samp{?} æ“ä½œç¬¦ï¼Œå¦‚æœåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå®ƒä»¬å‰é¢æ²¡æœ‰ä»»ä½•å­—ç¬¦äº†ï¼Œé‚£ä¹ˆå®ƒå°±ä»£è¡¨å®ƒä»¬è‡ªå·±ã€‚
å¦‚ @code{/+/} åŒ¹é…ä¸€ä¸ªå­—é¢åŠ å·ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šå…¶ä»–çš„ @command{awk} ç‰ˆæœ¬ä¼šæŠŠè¿™æ ·çš„ç”¨æ³•è§†ä¸ºè¯­æ³•é”™è¯¯ã€‚

å¦‚æœ @command{gawk} åœ¨å…¼å®¹æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼ŒåŒºé—´è¡¨è¾¾å¼åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ˜¯ä¸å¯ç”¨çš„ã€‚

@node Bracket Expressions
@section ä½¿ç”¨æ–¹æ‹¬å·è¡¨è¾¾å¼
@cindex bracket expressions
@cindex bracket expressions, range expressions
@cindex range expressions (regexps)
@cindex character lists in regular expression

å¦‚å‰é¢æ‰€æåˆ°çš„ï¼Œæ–¹æ‹¬å·è¡¨è¾¾å¼åŒ¹é…åœ¨æ‹¬å·ä¸­åˆ—å‡ºçš„ä»»æ„å­—ç¬¦ã€‚

åœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼å†…ï¼Œä¸€ä¸ª@dfn{èŒƒå›´è¡¨è¾¾å¼}ç”±ä¸¤ä¸ªç”¨è¿å­—ç¬¦åˆ†éš”çš„å­—ç¬¦ç»„æˆã€‚å®ƒåŒ¹é…ä»¥ç³»ç»Ÿçš„æœ¬åœ°å­—ç¬¦é›†æ’åºï¼Œå¹¶å¤„äºè¿™ä¸¤ä¸ªå­—ç¬¦é—´çš„ç¬¦å·ã€‚å¦‚ @samp{[0-9]} ä¸ @samp{[0123456789]} ç­‰åŒã€‚
ï¼ˆæŸ¥çœ‹ @ref{Ranges and Locales}ï¼Œå¯¹ POSIX æ ‡å‡†ä¸ @command{gawk} å˜åŒ–è¿‡ç¨‹çš„è§£é‡Šï¼Œè¿™ä¸»è¦æ˜¯æœ‰ä¸€äº›å†å²å…´è¶£æ‰€åœ¨ã€‚ï¼‰

@uref{http://www.unicode.org, Unicode å­—ç¬¦ç¼–ç æ ‡å‡†} çš„æµè¡Œï¼Œå¸¦æ¥äº†ä¸€ä¸ªæ–°çš„å°é—®é¢˜ã€‚æ–¹æ‹¬å·è¡¨è¾¾å¼å†…ä½¿ç”¨çš„å…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶çš„è½¬ç§»åºåˆ—ï¼Œåªèƒ½è¡¨ç¤ºå•å­—èŠ‚çš„å­—ç¬¦ï¼ˆç¼–ç èŒƒå›´åœ¨ 0-256 ä¹‹é—´çš„å­—ç¬¦ï¼‰ã€‚ä¸ºäº†åŒ¹é…ç¼–ç èŒƒå›´å¤§äº 256 çš„å­—ç¬¦ï¼Œè¯·ç›´æ¥è¾“å…¥å¤šå­—èŠ‚å­—ç¬¦çš„ç¼–ç ã€‚

@cindex @code{\} (backslash), in bracket expressions
@cindex backslash (@code{\}), in bracket expressions
@cindex @code{^} (caret), in bracket expressions
@cindex caret (@code{^}), in bracket expressions
@cindex @code{-} (hyphen), in bracket expressions
@cindex hyphen (@code{-}), in bracket expressions
ä¸ºäº†åŒ…æ‹¬è¿™äº›å­—ç¬¦ @samp{\}ï¼Œ@samp{]}ï¼Œ@samp{-}ï¼Œæˆ–è€… @samp{^} åœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ï¼Œå°†åœ¨å®ƒä»¬ä¹‹å‰ä½¿ç”¨ @samp{\}ï¼Œå¦‚ï¼š

@example
[d\]]
@end example

@noindent
ä¼šåŒ¹é… @samp{d} æˆ–è€… @samp{]}ï¼Œå¦å¤–ï¼Œå¦‚æœä½ å°† @samp{]} å°±æ”¾åœ¨å¼€æ–¹æ‹¬å· @samp{[} çš„åé¢ï¼Œåˆ™é—­æ–¹æ‹¬å·ä¼šä»¥å…¶å­—é¢å­—ç¬¦å¯¹å¾…å¹¶è¿›è¡ŒåŒ¹é…ã€‚

@cindex POSIX @command{awk}, bracket expressions and
@cindex Extended Regular Expressions (EREs)
@cindex EREs (Extended Regular Expressions)
@cindex @command{egrep} utility
å¯¹äºåœ¨æ–¹æ‹¬å·ä¸­çš„ @samp{\} è¡¨è¾¾å¼å¯¹å¾…ä¸Šï¼Œä¸å…¶ä»–çš„ @command{awk} å®ç°æ˜¯å…¼å®¹çš„ï¼Œä¹Ÿæ˜¯ POSIX æ ‡å‡†æ‰€è¦æ±‚çš„ã€‚
åœ¨ @command{awk} ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ˜¯ POSIX EREsï¼ˆæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ï¼ŒExtended Regular Expressionsï¼‰è§„èŒƒçš„ä¸€ä¸ªè¶…é›†ã€‚
POSIX çš„æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼åŸºäºä¼ ç»Ÿçš„ @command{egrep} å·¥å…·æ‰€æ¥å—çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚

@cindex bracket expressions, character classes
@cindex POSIX @command{awk}, bracket expressions and, character classes
@dfn{å­—ç¬¦ç±»}æ˜¯åœ¨ POSIX æ ‡å‡†ä¸­å¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ã€‚å­—ç¬¦ç±»æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¬¦å·ï¼Œç”¨å…¶æ¥è¡¨è¿°å…·æœ‰ç‰¹å®šå±æ€§çš„ä¸€ç±»å­—ç¬¦çš„åˆ—è¡¨ï¼Œä½†æ˜¯å®é™…çš„å­—ç¬¦ç”±äºå›½å®¶çš„ä¸åŒï¼Œä»¥åŠ/æˆ–è€…å­—ç¬¦é›†çš„ä¸åŒè€Œä¸åŒã€‚å¦‚ï¼Œå¯¹äºå­—æ¯ç±»çš„ç¬¦å·ï¼Œåœ¨ç¾å›½ä¸æ³•å›½ä¹‹é—´å°±ä¸ä¸€æ ·ã€‚

æ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ç±»ï¼Œåªæœ‰åœ¨ä¸€ä¸ªæ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­çš„æ–¹æ‹¬å·@emph{å†…éƒ¨}æ‰ä¼šæœ‰æ•ˆã€‚
å­—ç¬¦ç±»ç”± @samp{[:}ï¼Œä¸€ä¸ªä»£è¡¨ç±»çš„å…³é”®å­—ï¼Œä»¥åŠ @samp{:]} ç»„æˆï¼Œ@ref{table-char-classes} åˆ—å‡ºäº†ç”± POSIX æ ‡å‡†å®šä¹‰çš„å­—ç¬¦ç±»ã€‚

@float Table,table-char-classes
@caption{POSIX å­—ç¬¦ç±»}
@multitable @columnfractions .15 .85
@headitem ç±» @tab å«ä¹‰
@item @code{[:alnum:]} @tab å­—æ¯æ•°å­—å­—ç¬¦
@item @code{[:alpha:]} @tab å­—æ¯å­—ç¬¦
@item @code{[:blank:]} @tab ç©ºæ ¼ä¸ TAB å­—ç¬¦
@item @code{[:cntrl:]} @tab æ§åˆ¶å­—ç¬¦
@item @code{[:digit:]} @tab æ•°å­—å­—ç¬¦
@item @code{[:graph:]} @tab å¯è§å¯æ‰“å°çš„å­—ç¬¦ï¼ˆç©ºæ ¼æ˜¯å¯æ‰“å°çš„ï¼Œä½†æ˜¯æ˜¯ä¸å¯è§çš„ï¼Œè€Œ @samp{a} åˆ™å…¼è€Œæœ‰ä¹‹ï¼‰
@item @code{[:lower:]} @tab å°å†™å­—æ¯å­—ç¬¦
@item @code{[:print:]} @tab å¯æ‰“å°å­—ç¬¦ï¼ˆé‚£äº›ä¸æ˜¯æ§åˆ¶å­—ç¬¦çš„å­—ç¬¦ï¼‰
@item @code{[:punct:]} @tab æ ‡ç‚¹å­—ç¬¦ï¼ˆé‚£äº›ä¸æ˜¯å­—æ¯ï¼Œæ•°å­—ï¼Œæ§åˆ¶ä»¥åŠç©ºæ ¼å­—ç¬¦çš„å­—ç¬¦ï¼‰
@item @code{[:space:]} @tab ç©ºæ ¼å­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼ï¼ŒTABï¼Œä»¥åŠå›æ¡£ï¼Œç­‰ï¼‰
@item @code{[:upper:]} @tab å­—æ¯çš„å¤§å†™å­—ç¬¦
@item @code{[:xdigit:]} @tab åå…­è¿›åˆ¶çš„æ•°å­—çš„å­—ç¬¦
@end multitable
@end float

ä¾‹å¦‚ï¼Œåœ¨ POSIX æ ‡å‡†å‰ï¼Œä½ å¿…é¡»ç”¨è¿™æ ·çš„è¡¨è¾¾å¼ @code{/[A-Za-z0-9]/} æ¥åŒ¹é…å­—æ¯æ•°å­—å­—ç¬¦ã€‚
å¦‚æœä½ çš„å­—ç¬¦é›†æœ‰å¦ä¸€å¥—å­—æ¯å­—ç¬¦ï¼Œè¿™ä¸ªå°±ä¸ä¼šåŒ¹é…å®ƒä»¬ã€‚
é€šè¿‡ POSIX çš„å­—ç¬¦ç±»ï¼Œä½ å¯å†™æˆè¿™æ · @code{/[[:alnum:]]/} æ¥åŒ¹é…ä½ çš„å­—ç¬¦é›†ä¸­çš„å­—æ¯ä¸æ•°å­—ã€‚
@c Thanks to
@c Date: Tue, 01 Jul 2014 07:39:51 +0200
@c From: Hermann Peifer <peifer@gmx.eu>
æœ‰ä¸€äº›å·¥å…·çš„æ­£åˆ™è¡¨è¾¾å¼æä¾›äº†ä¸€ç§éæ ‡å‡†çš„ @samp{[:ascii:]} å­—ç¬¦ç±»ï¼Œ@command{awk} åˆ™æ²¡æœ‰æä¾›ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥è¿™æ · @samp{[\x00-\x7F]} æ¥æ¨¡æ‹Ÿè¿™ç§ç»“æ„ã€‚
è¿™ä¼šåŒ¹é…æ•°å€¼ä¸Šä¸º 0 åˆ° 127 ä¹‹é—´çš„ï¼Œå®šä¹‰åœ¨ ASCII å­—ç¬¦é›†ä¸­çš„å­—ç¬¦ã€‚åˆ©ç”¨å…¶åçš„å­—ç¬¦åˆ—è¡¨ï¼ˆ@samp{[^\x00-\x7F]}ï¼‰å¯ä»¥åŒ¹é…ä»»ä½•ä¸ªä¸åœ¨ ASCII ä¸­çš„å•å­—èŠ‚å­—ç¬¦ã€‚

@cindex bracket expressions, collating elements
@cindex bracket expressions, non-ASCII
@cindex collating elements
æœ‰ä¸¤ä¸ªé¢å¤–çš„åºåˆ—å¯ä»¥å‡ºç°åœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ï¼Œè¿™äº›ç”¨æ¥åº”ç”¨åˆ°é ASCII å­—ç¬¦é›†ä¸­ï¼Œè¿™äº›å­—ç¬¦é›†æœ‰çš„å•ç¬¦å·ï¼ˆç§°ä¸º@dfn{é›†åˆå…ƒç´ }ï¼‰å¯ä»¥ç”±å¤šä¸ªå­—ç¬¦æ¥è¡¨ç¤ºã€‚
å®ƒä»¬ä¹Ÿå¯ä»¥æœ‰å‡ ä¸ªå­—ç¬¦æ˜¯ç­‰åŒçš„ï¼Œä»¥è¿›è¡Œ@dfn{æ ¡å¯¹}ï¼Œæ’åºç­‰ç›®çš„ã€‚ï¼ˆå¦‚åœ¨æ³•è¯­ä¸­ï¼Œæ™®é€šå­—æ¯ ``e'' æœ‰ä¸€ä¸ªé‡éŸ³å­—æ¯ ``@`e'' æ˜¯ç­‰åŒçš„ã€‚ï¼‰è¿™äº›åºåˆ—æ˜¯ï¼š

@table @asis
@cindex bracket expressions, collating symbols
@cindex collating symbols
@item é›†åˆç¬¦å·
åœ¨ @samp{[.} ä¸ @samp{.]} ä¹‹é—´çš„ï¼Œå¤šå­—ç¬¦é›†åˆå…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ @samp{ch} æ˜¯ä¸€ä¸ªé›†åˆå…ƒç´ ï¼Œè¿™æ · @samp{[[.ch.]]} å°±æ˜¯å¯ä»¥åŒ¹é…è¿™æ ·çš„é›†åˆå…ƒç´ çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚è€Œ @samp{[ch]} åˆ™æ˜¯åŒ¹é… @samp{c} æˆ–è€… @samp{h} çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚

@cindex bracket expressions, equivalence classes
@item ç­‰åŒç±»
ç‰¹å®šäºå­—ç¬¦é›†çš„ç”¨äºå‘½åç­‰åŒå­—ç¬¦åˆ—è¡¨ã€‚å…¶åå­—ç”± @samp{[=} ä¸ @samp{=]} åŒ…å«ã€‚
å¦‚åå­— @samp{e} å¯ä»¥ç”¨æ¥è¡¨ç¤ºæ‰€æœ‰çš„ ``e,'' ``@^e,'' ``@`e,'' ä¸ ``@'e.''ã€‚
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ@samp{[[=e=]]} å°±æ˜¯ç”¨æ¥åŒ¹é… @samp{e}ï¼Œ@samp{@^e}ï¼Œ@samp{@'e}ï¼Œæˆ–è€… @samp{@`e} çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚
@end table

è¿™ä¸ªç‰¹æ€§åœ¨é‚£äº›éè‹±è¯­çš„å­—ç¬¦é›†ä¸­éå¸¸æœ‰ç”¨ã€‚

@cindex internationalization, localization, character classes
@cindex @command{gawk}, character classes and
@cindex POSIX @command{awk}, bracket expressions and, character classes
@quotation æ³¨æ„
@command{gawk} å½“å‰æ‰€ä½¿ç”¨çš„ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åº“ï¼Œåªèƒ½è¯†åˆ« POSIX å­—ç¬¦ç±»ï¼›å®ƒä»¬æ— æ³•è¯†åˆ«é›†åˆç¬¦å·æˆ–è€…ç­‰åŒç±»ã€‚
@end quotation
@c maybe one day ...

åœ¨ä¸€ä¸ªæ–¹æ‹¬å·è¡¨è¾¾å¼å†…ï¼Œä¸€ä¸ªå¼€æ–¹æ‹¬å·ï¼ˆ@samp{[}ï¼‰ä½œä¸ºå®ƒæœ¬èº«æ¥ä½¿ç”¨ï¼Œè€Œä¸è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ç±»ï¼Œé›†åˆå…ƒç´ æˆ–è€…ç­‰åŒç±»ã€‚
@samp{.} å’Œ @samp{*} åŒç†ã€‚

@node Leftmost Longest
@section åŒ¹é…å¤šå°‘ï¼Ÿ

@cindex regular expressions, leftmost longest match
@c @cindex matching, leftmost longest
è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š

@example
echo aaaabcd | awk '@{ sub(/a+/, "<A>"); print @}'
@end example

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ @code{sub()} å‡½æ•°æ¥æ”¹å˜è¾“å…¥è®°å½•ã€‚
ï¼ˆ@code{sub()} ç”¨ç¬¬äºŒä¸ªå‚æ•°æ›¿æ¢ï¼Œä»»æ„åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°çš„æ–‡æœ¬å†…å®¹ï¼ŒæŸ¥çœ‹ @ref{String Functions}ã€‚ï¼‰
è¿™é‡Œï¼Œæ­£åˆ™è¡¨è¾¾å¼ @code{/a+/} è¡¨ç¤ºâ€œä¸€ä¸ªæˆ–è€…å¤šä¸ª @samp{a} å­—ç¬¦â€ï¼Œå¹¶å°†å…¶æ›¿æ¢ä¸ºæ–‡ä»¶ @samp{<A>} ã€‚

è¾“å…¥ä¸­åŒ…æ‹¬ 4 ä¸ª @samp{a} å­—ç¬¦ã€‚@command{awk}ï¼ˆä»¥åŠ POSIXï¼‰æ­£åˆ™è¡¨è¾¾å¼æ€»æ˜¯åŒ¹é…æœ€å·¦è¾¹@emph{æœ€é•¿}çš„è¾“å…¥å­—ç¬¦åºåˆ—ã€‚
å› æ­¤ï¼Œæ‰€æœ‰çš„ 4 ä¸ª @samp{a} å­—ç¬¦éƒ½å°†è¢« @samp{<A>} æ›¿æ¢ã€‚

@example
$ @kbd{echo aaaabcd | awk '@{ sub(/a+/, "<A>"); print @}'}
@print{} <A>bcd
@end example

å¯¹äºç®€å•çš„åŒ¹é…/ä¸åŒ¹é…çš„æµ‹è¯•ï¼Œè¿™å°±å¹¶ä¸å¤ªé‡è¦ï¼Œä½†æ˜¯å½“æ‰§è¡Œæ–‡æœ¬åŒ¹é…ä¸æ›¿æ¢æ—¶ï¼Œ
å¦‚ @code{match()}ï¼Œ@code{sub()}ï¼Œ@code{gsub()} ä¸ @code{gensub()} ç­‰å‡½æ•°æ‰€æ‰§è¡Œçš„ï¼Œè¿™ä¸ªç‰¹ç‚¹å°±éå¸¸é‡è¦äº†ã€‚
@ifinfo
@ref{String Functions} ä¸­æè¿°äº†æ›´å¤šå…³äºè¿™äº›å‡½æ•°çš„ä¿¡æ¯ã€‚
@end ifinfo
ç†è§£è¿™ä¸ªåŸåˆ™å¯¹äºåŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼åˆ†éš”çš„è®°å½•ä¹Ÿéå¸¸é‡è¦ï¼ˆæŸ¥çœ‹ @ref{Records}ï¼Œä¹Ÿå¯æŸ¥çœ‹ @ref{Field Separators}ï¼‰ã€‚

@node Computed Regexps
@section ä½¿ç”¨åŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼

@cindex regular expressions, computed
@cindex regular expressions, dynamic
@cindex @code{~} (tilde), @code{~} operator
@cindex tilde (@code{~}), @code{~} operator
@cindex @code{!} (exclamation point), @code{!~} operator
@cindex exclamation point (@code{!}), @code{!~} operator
@c @cindex operators, @code{~}
@c @cindex operators, @code{!~}
åœ¨ @samp{~} æˆ–è€… @samp{!~} æ“ä½œç¬¦çš„å³æ‰‹è¾¹ï¼Œä¸ä¸€å®šéœ€è¦ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼ˆä¾‹å¦‚ç”¨æ–œæ åˆ†éš”è¿™äº›çš„å­—ä¸²ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»»æ„çš„è¡¨è¾¾å¼ã€‚
åœ¨å¿…è¦çš„æƒ…å†µä¸‹ï¼Œè¡¨è¾¾å¼ä¼šè¢«æ±‚å€¼ï¼Œæˆ–è€…è½¬æ¢ä¸ºå­—ä¸²ï¼›è¿™ä¸ªå­—ä¸²å³è¢«ç”¨äºå½“åšæ­£åˆ™è¡¨è¾¾å¼ã€‚
ä»¥è¿™ç§æ–¹å¼è®¡ç®—çš„è¡¨è¾¾å¼ç§°ä¸º@dfn{åŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼}æˆ–è€…@dfn{è®¡ç®—å‹æ­£åˆ™è¡¨è¾¾å¼}ï¼š

@example
BEGIN @{ digits_regexp = "[[:digit:]]+" @}
$0 ~ digits_regexp    @{ print @}
@end example

@noindent
ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå°† @code{digits_regexp} è®¾ç½®æˆæè¿°ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ•°å­—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶æµ‹è¯•è¾“å…¥è®°å½•æ˜¯å¦åŒ¹é…è¿™ä¸ªè¡¨è¾¾å¼ã€‚

@quotation æç¤º
å½“ä½¿ç”¨ @samp{~} ä¸ @samp{!~} æ“ä½œç¬¦æ—¶ï¼Œè¦äº†è§£ä½¿ç”¨è¿™æ ·çš„ç”¨æ–œæ è¡¨å¼çš„æ­£åˆ™è¡¨è¾¾å¼å­—ä¸²å¸¸é‡ä¸ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„æ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´çš„ä¸åŒã€‚
å¦‚æœä½ å‡†å¤‡ä½¿ç”¨å­—ä¸²å¸¸é‡ï¼Œä½ å°±å¿…é¡»å¾—ç†è§£å­—ä¸²å®é™…ä¸Šä¼šè¢«æ‰«æä¸¤éï¼›ç¬¬ä¸€æ¬¡æ˜¯ @command{awk} è¯»å–ä½ çš„ç¨‹åºçš„æ—¶å€™ï¼Œç¬¬äºŒæ¬¡æ˜¯å½“è¦æ‰§è¡Œä¸æ“ä½œç¬¦å·¦è¾¹çš„å­—ä¸²ä¸å³è¾¹çš„æ¨¡å¼ç¬¦è¿›è¡ŒåŒ¹é…çš„æ—¶å€™ã€‚
è¿™å¯¹äºæ‰€æœ‰æ±‚å€¼ä¸ºå­—ä¸²çš„è¡¨è¾¾å¼éƒ½æ˜¯å¦‚æ­¤ï¼ˆå¦‚å‰ä¾‹ä¸­çš„ @code{digits_regexp}ï¼‰ï¼Œè€Œå¹¶ä¸æ­¢æ˜¯å­—ä¸²å¸¸é‡æ‰å¦‚æ­¤ã€‚
@end quotation

@cindex regexp constants, slashes vs.@: quotes
@cindex @code{\} (backslash), in regexp constants
@cindex backslash (@code{\}), in regexp constants
@cindex @code{"} (double quote), in regexp constants
@cindex double quote (@code{"}), in regexp constants
å­—ä¸²ä¼šè¢«æ‰«æä¸¤æ¬¡ä¼šæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸è½¬ä¹‰åºåˆ—æœ‰å…³ï¼Œå°¤å…¶æ˜¯åæ–œæ ã€‚ä¸ºäº†å°†åæ–œæ åŠ å…¥åˆ°æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„å­—ä¸²ï¼Œä½ éœ€è¦è¾“å…¥ä¸¤ä¸ªåæ–œæ ã€‚

ä¾‹å¦‚ï¼Œ@code{/\*/} æ˜¯å­—ç¬¦ @samp{*} çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚åªéœ€è¦ä¸€ä¸ªåæ–œæ ã€‚å¦‚æœä½ è¦åœ¨å­—ä¸²åœ¨å®ç°ç›¸åŒçš„äº‹æƒ…ï¼Œä½ å°±å¾—è¾“å…¥ @code{"\\*"}ã€‚
ç¬¬ä¸€ä¸ªåæ–œæ è½¬ä¹‰ç¬¬äºŒä¸ªåæ–œæ ï¼Œå› æ­¤å®é™…çš„å­—ä¸²æ‰åŒ…å«ä¸¤ä¸ªå­—ç¬¦ï¼Œå³ @samp{\} ä¸ @samp{*} ã€‚

@cindex troubleshooting, regexp constants vs.@: string constants
@cindex regexp constants, vs.@: string constants
@cindex string constants, vs.@: regexp constants
å‡è®¾ä½ æ—¢ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ä¸å­—ä¸²å¸¸é‡æ¥æè¿°æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½ è¯¥å¦‚ä½•æ¥é€‰æ‹©ä½¿ç”¨ï¼Ÿç­”æ¡ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼Œæœ‰å‡ ä¸ªåŸå› ï¼š

@itemize @value{BULLET}
@item
å­—ä¸²å¸¸é‡å†™èµ·æ¥æ›´å¤æ‚ï¼Œè¯»èµ·æ¥ä¹Ÿæ›´éš¾ã€‚ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ä½¿ä½ çš„ç¨‹åºå°‘å‡ºé”™ã€‚ä¸ç†è§£ä¸¤ç§å¸¸é‡ä¹‹é—´çš„å·®å¼‚å¸¸å¸¸æ˜¯é”™è¯¯ä¹‹æºã€‚

@item
ç”¨æ­£åˆ™è¡¨å¤§å¼å¸¸é‡æ›´åŠ é«˜æ•ˆã€‚@command{awk} ä¼šæ³¨æ„åˆ°ä½ æä¾›æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¼šå°†å®ƒå­˜æˆèƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°è¿›è¡Œæ¨¡å¼åŒ¹é…çš„å½¢å¼ã€‚å½“ä½¿ç”¨å­—ä¸²å¸¸é‡ï¼Œ@command{awk} åˆ™é¦–å…ˆéœ€è¦å°†å…¶è½¬æ¢æˆå†…éƒ¨å½¢å¼ç„¶åæ‰æ‰§è¡Œæ¨¡å¼åŒ¹é…ã€‚

@item
ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡æ˜¯ä¸€ç§æ›´å¥½çš„å½¢å¼ï¼Œèƒ½å¤Ÿæ›´å®¹æ˜“çœ‹æ¸…ä½ è¦è¿›è¡Œçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚
@end itemize

@sidebar åœ¨åŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨ @code{\n} 
@cindex regular expressions, dynamic, with embedded newlines
@cindex newlines, in dynamic regexps

ä¸€äº›æ—§ç‰ˆæœ¬çš„ @command{awk} ä¸èƒ½å¤Ÿåœ¨åŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ–¹æ‹¬å·è¡¨è¾¾å¼é‡Œä½¿ç”¨æ¢è¡Œç¬¦ @samp{\n}ï¼š

@example
$ @kbd{awk '$0 ~ "[ \t\n]"'}
@error{} awk: newline in character class [
@error{} ]...
@error{}  source line number 1
@error{}  context is
@error{}        $0 ~ "[ >>>  \t\n]" <<<
@end example

@cindex newlines, in regexp constants
ä½†æ˜¯åœ¨æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ä¸­å´æ²¡æœ‰é—®é¢˜ï¼š

@example
$ @kbd{awk '$0 ~ /[ \t\n]/'}
@kbd{here is a sample line}
@print{} here is a sample line
@kbd{Ctrl-d}
@end example

@command{gawk} æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”åœ¨å®è·µä¸­ä¹Ÿå¾ˆå°‘å‡ºç°ï¼Œä½†æ˜¯åœ¨åé¢çš„ä½¿ç”¨ä¸­ï¼Œåˆ™å€¼å¾—æ³¨æ„ä¸€ä¸‹ã€‚
@end sidebar

@node GNU Regexp Operators
@section ç‰¹å®šäº @command{gawk} çš„æ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦

@c This section adapted (long ago) from the regex-0.12 manual

@cindex regular expressions, operators, @command{gawk}
@cindex @command{gawk}, regular expressions, operators
@cindex operators, GNU-specific
@cindex regular expressions, operators, for words
@cindex word, regexp definition of
GNU è½¯ä»¶åœ¨å¤„ç†æ­£åˆ™è¡¨è¾¾å¼æ—¶æä¾›äº†è®¸å¤šé¢å¤–çš„æ­£åˆ™æ“ä½œç¬¦ã€‚
åœ¨æœ¬@value{SECTION}ä¸­åˆ—å‡ºçš„æ“ä½œç¬¦æ˜¯ @command{gawk} ç‰¹æœ‰çš„ï¼Œä»–ä»¬åœ¨å…¶ä»–çš„ @command{awk} ä¸­æ˜¯æ²¡æœ‰çš„ã€‚è¿™äº›æ“ä½œç¬¦å¤šæ•°æ˜¯ç”¨æ¥å¤„ç†å­—ï¼ˆå•è¯ï¼‰åŒ¹é…ã€‚
å¯¹äºæˆ‘ä»¬çš„ç›®çš„è€Œè¨€ï¼Œä¸€ä¸ª@dfn{å•è¯}å°±æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—æ¯ã€æ•°å­—æˆ–è€…ä¸‹åˆ’çº¿ï¼ˆ@samp{_}ï¼‰çš„è¿ç»­åºåˆ—ï¼š

@table @code
@c @cindex operators, @code{\s} (@command{gawk})
@cindex backslash (@code{\}), @code{\s} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\s} operator (@command{gawk})
@item \s
åŒ¹é…ä»»æ„çš„ç©ºç™½å­—ç¬¦ï¼Œä½ å¯çœ‹æˆæ˜¯ @w{@samp{[[:space:]]}} ç¼©å†™ã€‚

@c @cindex operators, @code{\S} (@command{gawk})
@cindex backslash (@code{\}), @code{\S} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\S} operator (@command{gawk})
@item \S
åŒ¹é…ä»»æ„éç©ºç™½å­—ç¬¦ï¼Œå¯ä»¥çœ‹æˆæ˜¯ @w{@samp{[^[:space:]]}} çš„ç¼©å†™ã€‚

@c @cindex operators, @code{\w} (@command{gawk})
@cindex backslash (@code{\}), @code{\w} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\w} operator (@command{gawk})
@item \w
åŒ¹é…ä»»æ„ç»„æˆå•è¯çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯åŒ¹é…ä»»æ„çš„å­—æ¯ï¼Œæ•°å­—æˆ–è€…ä¸‹åˆ’çº¿ã€‚å¯ä»¥çœ‹æˆä¸º @w{@samp{[[:alnum:]_]}} çš„ç¼©å†™ã€‚

@c @cindex operators, @code{\W} (@command{gawk})
@cindex backslash (@code{\}), @code{\W} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\W} operator (@command{gawk})
@item \W
åŒ¹é…ä»»æ„çš„éç»„æˆå•è¯çš„å­—ç¬¦ï¼Œå¯ä»¥çœ‹æˆæ˜¯ @w{@samp{[^[:alnum:]_]}} çš„ç¼©å†™ã€‚

@c @cindex operators, @code{\<} (@command{gawk})
@cindex backslash (@code{\}), @code{\<} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\<} operator (@command{gawk})
@item \<
åŒ¹é…å•è¯å¼€å§‹çš„ç©ºä¸²ï¼Œå¦‚ @code{/\<away/} åŒ¹é… @samp{away}ï¼Œä½†æ˜¯ä¸åŒ¹é… @samp{stowaway} ã€‚

@c @cindex operators, @code{\>} (@command{gawk})
@cindex backslash (@code{\}), @code{\>} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\>} operator (@command{gawk})
@item \>
åŒ¹é…å•è¯åçš„ç©ºä¸²ï¼Œå¦‚ @code{/stow\>/} åŒ¹é… @samp{stow}ï¼Œä½†æ˜¯ä¸åŒ¹é… @samp{stowaway} ã€‚

@c @cindex operators, @code{\y} (@command{gawk})
@cindex backslash (@code{\}), @code{\y} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\y} operator (@command{gawk})
@cindex word boundaries@comma{} matching
@item \y
åŒ¹é…å•è¯ä¸¤è¾¹çš„ç©ºä¸²ï¼ˆå¦‚å•è¯çš„è¾¹ç•Œï¼‰ã€‚å¦‚ @samp{\yballs?\y} åŒ¹é… @samp{ball} æˆ–è€… @samp{balls}ï¼Œä½œä¸ºå•ç‹¬çš„å•è¯ã€‚

@c @cindex operators, @code{\B} (@command{gawk})
@cindex backslash (@code{\}), @code{\B} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\B} operator (@command{gawk})
@item \B
åŒ¹é…å•è¯ä¸­ä»»æ„ä¸¤ä¸ªç»„æˆå•è¯å­—ç¬¦é—´çš„ç©ºä¸²ï¼Œä¾‹å¦‚ @code{/\Brat\B/} åŒ¹é… @samp{crate}ï¼Œä½†æ˜¯ä¸åŒ¹é… @samp{dirty rat} ã€‚@samp{\B} çš„åé¢å®é™…å°±æ˜¯ @samp{\y} ã€‚
@end table

@cindex buffers, operators for
@cindex regular expressions, operators, for buffers
@cindex operators, string-matching, for buffers
è¿˜æœ‰è¿˜ä¸¤ä¸ªæ“ä½œç¬¦ç”¨åœ¨ç¼“å­˜ä¸­ï¼Œåœ¨ Emacs é‡Œï¼Œ@dfn{ç¼“å­˜}å¾ˆè‡ªç„¶çš„å°±æ˜¯ä¸€ä¸ª Emacs ç¼“å­˜ã€‚åœ¨å…¶ä»–çš„ GNU ç¨‹åºä¸­ï¼ŒåŒ…æ‹¬ @command{gawk}ï¼Œå¯ä»¥è®¤ä¸ºæ•´ä¸ªè¦åŒ¹é…çš„å­—ä¸²å°±æ˜¯ä¸€ä¸ªç¼“å­˜ã€‚è¿™ä¸¤ä¸ªæ“ä½œç¬¦æ˜¯ï¼š

@table @code
@item \`
@c @cindex operators, @code{\`} (@command{gawk})
@cindex backslash (@code{\}), @code{\`} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\`} operator (@command{gawk})
åŒ¹é…ç¼“å­˜ï¼ˆå­—ä¸²ï¼‰çš„å¼€å§‹å¤„çš„ç©ºä¸²ã€‚

@c @cindex operators, @code{\'} (@command{gawk})
@cindex backslash (@code{\}), @code{\'} operator (@command{gawk})
@cindex @code{\} (backslash), @code{\'} operator (@command{gawk})
@item \'
åŒ¹é…ç¼“å­˜ï¼ˆå­—ä¸²ï¼‰çš„ç»“æŸå¤„çš„çª—å£ã€‚
@end table

@cindex @code{^} (caret), regexp operator
@cindex caret (@code{^}), regexp operator
@cindex @code{?} (question mark), regexp operator
@cindex question mark (@code{?}), regexp operator
ç”±äº @samp{^} ä¸ @samp{$} æ€»æ˜¯ä¼šåŒ¹é…å­—ä¸²çš„å¼€å¤´ä¸ç»“å°¾ï¼Œè¿™ä¸ªæ“ä½œç¬¦æ²¡æœ‰ç»™ @command{awk} å¸¦æ¥ä»€ä¹ˆæ–°çš„åŠŸèƒ½ã€‚æä¾›è¿™äº›æ“ä½œç¬¦åªæ˜¯ä¸ºäº†ä¸å…¶ä»–çš„ GNU è½¯ä»¶ä¿æŒå…¼å®¹æ€§ã€‚

@cindex @command{gawk}, word-boundary operator
@cindex word-boundary operator (@command{gawk})
@cindex operators, word-boundary (@command{gawk})
åœ¨å…¶ä»–çš„ GNU è½¯ä»¶ä¸­ï¼Œå•è¯è¾¹ç•Œæ“ä½œç¬¦æ˜¯ @samp{\b} ã€‚ä½†æ˜¯è¿™ä¸ªä¸ @command{awk} è¯­è¨€å®šä¹‰ @samp{\b} æ˜¯ä¸€ä¸ªé€€æ ¼æœ‰å†²çªï¼Œå› æ­¤ @command{gawk} ä½¿ç”¨äº†ä¸€ä¸ªä¸åŒçš„å­—æ¯ã€‚ä¸€ä¸ªå¯é€‰æ‹©çš„æ–¹æ³•å°±æ˜¯åœ¨ GNU æ“ä½œç¬¦ä¸­å¿…é¡»è¾“å…¥åŒåæ–œæ ï¼Œä½†æ˜¯è¿™ä¸ªç”¨æ¥èµ·ä»¤äººç–‘æƒ‘ã€‚å½“å‰çš„æ–¹æ³•å°±æ˜¯åœ¨ä½¿ç”¨ @samp{\y}ï¼Œè¿™æ · GNU ä¸­çš„ @samp{\b} åœ¨ä¸¤ä¸ªæ¶æ£ä¸­å°±å‡ºç°å¾—å°‘ä¸€äº›ã€‚

@cindex regular expressions, @command{gawk}, command-line options
@cindex @command{gawk}, command-line options, and regular expressions
æœ‰å‡ ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰å¯ä»¥æ§åˆ¶ @command{gawk} å¦‚ä½•æ¥è§£é‡Šæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦ï¼š

@table @asis
@item No options
åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ@command{gawk} ä¼šæä¾›æ‰€æœ‰çš„ POSIX æ­£åˆ™è¡¨è¾¾å¼çš„è®¾æ–½ï¼Œ
ä»¥åŠ
@ifnotinfo
å‰é¢æ‰€æè¿°çš„é‚£äº› GNU æ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦ã€‚
@end ifnotinfo
@ifnottex
@ifnotdocbook
é‚£äº›åœ¨ @ref{Regexp Operators} æè¿°çš„ GNU æ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦ã€‚
@end ifnotdocbook
@end ifnottex

@item @code{--posix}
åªåŒ¹é… POSIX æ­£åˆ™è¡¨è¾¾å¼ï¼ŒGNU æ“ä½œç¬¦æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ï¼ˆå¦‚ @samp{\w} å°±æ˜¯åŒ¹é…å­—é¢çš„ @samp{w}ï¼‰ã€‚åŒºé—´è¡¨è¾¾å¼ä¹Ÿå¯ç”¨ã€‚

@cindex Brian Kernighan's @command{awk}
@item @code{--traditional}
åŒ¹é…ä¼ ç»Ÿçš„ @command{awk} æ­£åˆ™è¡¨è¾¾å¼ã€‚
GNU æ“ä½œç¬¦æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå¹¶ä¸”åŒºé—´è¡¨è¾¾å¼ä¹Ÿä¸å¯ç”¨ã€‚å› ä¸º BWK @command{awk} æ”¯æŒå®ƒä»¬ï¼Œ
POSIX çš„å­—ç¬¦ç±»ï¼ˆ@samp{[[:alnum:]]} ç­‰ï¼‰å¯ç”¨ã€‚ç”±å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶æè¿°çš„è½¬ä¹‰å­—ç¬¦åºåˆ—ä¼šæŒ‰å­—é¢å¤„ç†ï¼Œå°±ç®—å®ƒä»¬ä»¥æ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦å‡ºç°ã€‚

@item @code{--re-interval}
å¦‚æœæŒ‡å®šäº† @option{--traditional}ï¼Œåˆ™å¯ä»¥åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨åŒºé—´è¡¨è¾¾å¼ã€‚å¦åˆ™åŒºé—´è¡¨è¾¾å¼æ˜¯é»˜è®¤å¯ç”¨çš„ã€‚
@end table

@node Case-sensitivity
@section åŒ¹é…æ—¶çš„å¤§å°å†™

@cindex regular expressions, case sensitivity
@cindex case sensitivity, regexps and
å¤§å°å†™åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­éå¸¸é‡è¦ï¼Œæ— è®ºæ˜¯åŒ¹é…æ­£å¸¸å­—ç¬¦ï¼ˆå¦‚éå…ƒå­—ç¬¦ï¼‰è¿˜æ˜¯åœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ã€‚å› æ­¤ @samp{w} åªåŒ¹é…å°å†™çš„ @samp{w}ï¼Œè€Œä¸æ˜¯å¤§å†™çš„ @samp{W} ã€‚

ä¸åŒºåˆ†å¤§å°å†™çš„æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨æ–¹æ‹¬å·è¡¨è¾¾å¼â€”â€”å¦‚ @samp{[Ww]}ã€‚
ä½†æ˜¯è¦ç»å¸¸ä½¿ç”¨çš„æ—¶å€™å°±æœ‰ç‚¹çƒ¦äº†ï¼Œä¹Ÿä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼æ›´éš¾è¯»ã€‚æœ‰å¯ä»¥æœ‰ä¸¤ä¸ªå…¶ä»–æ–¹æ³•å¯ä»¥é€‰æ‹©ã€‚

ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯åœ¨è¦è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™åŒ¹é…çš„åœ°æ–¹ï¼Œç”¨å†…å»ºçš„å‡½æ•° tolower() æˆ–è€… toupper() ï¼ˆå½“ç„¶è¿˜æ²¡è®¨è®ºè¿‡ï¼›å¯ä»¥æŸ¥çœ‹ @ref{String Functions}ï¼‰
å°†å…¶è½¬æ¢æˆåŒä¸€ç§å¤§å°å†™ã€‚ä¾‹å¦‚ï¼š

@example
tolower($1) ~ /foo/  @{ @dots{} @}
@end example

@noindent
å°†ç¬¬ä¸€ä¸ªåŸŸè½¬æ¢æˆå°å†™ï¼Œç„¶åå¯¹å…¶è¿›è¡ŒåŒ¹é…ã€‚è¿™ä¸ªåœ¨ POSIX å…¼å®¹çš„ @command{awk} ä¸­æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚

@cindex @command{gawk}, regular expressions, case sensitivity
@cindex case sensitivity, @command{gawk}
@cindex differences in @command{awk} and @command{gawk}, regular expressions
@cindex @code{~} (tilde), @code{~} operator
@cindex tilde (@code{~}), @code{~} operator
@cindex @code{!} (exclamation point), @code{!~} operator
@cindex exclamation point (@code{!}), @code{!~} operator
@cindex @code{IGNORECASE} variable, with @code{~} and @code{!~} operators
@cindex @command{gawk}, @code{IGNORECASE} variable in
@c @cindex variables, @code{IGNORECASE}
å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼Œåªåœ¨ @command{gawk} ä¸­ä½¿ç”¨ï¼Œå°±æ˜¯è®¾ç½®å˜é‡ @code{IGNORECASE} ä¸ºéé›¶å€¼
ï¼ˆæŸ¥çœ‹ @ref{Built-in Variables}ï¼‰ã€‚
å½“ @code{IGNORECASE} ä¸ºéé›¶æ—¶ï¼Œ@emph{æ‰€æœ‰}çš„æ­£åˆ™è¡¨è¾¾å¼ä»¥å­—ä¸²æ“ä½œéƒ½ä¸åŒºåˆ†å¤§å°å†™ã€‚

åŠ¨æ€åœ°æ”¹å˜ @code{IGNORECASE} çš„å€¼ï¼Œå°±å¯ä»¥æ§åˆ¶ç¨‹åºè¿è¡Œæ—¶çš„å¤§å°å†™å¤„ç†æ–¹å¼ã€‚å¤§å°å†™é»˜è®¤æƒ…å†µä¸‹æ˜¯åŒºåˆ†çš„ï¼Œ
å› ä¸º @code{IGNORECASE} ï¼ˆåƒå…¶ä»–å¤§å¤šæ•°å˜é‡ä¸€æ ·ï¼‰è¢«åˆå§‹åŒ–ä¸º0ï¼š

@example
x = "aB"
if (x ~ /ab/) @dots{}   # this test will fail

IGNORECASE = 1
if (x ~ /ab/) @dots{}   # now it will succeed
@end example

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½ ä¸èƒ½é€šè¿‡ @code{IGNORECASE} æ¥ä½¿ç‰¹å®šçš„è§„åˆ™æ˜¯å¤§å°å†™ä¸åŒºåˆ†çš„ï¼Œè€Œå…¶ä»–çš„è§„åˆ™åˆ™æ˜¯åŒºåˆ†çš„ã€‚
å› ä¸ºæ²¡æœ‰ç›´æ¥çš„æ–¹æ³•æ¥è®¾ç½® @code{IGNORECASE} ä»¥é’ˆå¯¹ç‰¹å®šçš„è§„åˆ™ã€‚
@footnote{æœ‰ç»éªŒçš„ C ä¸ C++ ç¨‹åºå‘˜ä¼šæ³¨æ„åˆ°ï¼Œé€šè¿‡ä½¿ç”¨è¿™æ · 
@samp{IGNORECASE = 1 && /foObAr/ @{ @dots{} @}} å’Œ 
@samp{IGNORECASE = 0 || /foobar/ @{ @dots{} @}} çš„æ–¹å¼ï¼Œè¿™ç§æƒ…å†µæ˜¯å¯èƒ½çš„ã€‚
ä½†æ˜¯è¿™å¤šå°‘æœ‰ç‚¹å«ç³Šï¼Œå› æ­¤æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆå¹²ã€‚}
å¦‚æœè¦è¿™ä¹ˆåšï¼Œè¦ä¹ˆä½¿ç”¨æ–¹æ‹¬å·è¡¨è¾¾å¼æˆ–è€…ä½¿ç”¨ tolower() æ–¹æ³•ï¼Œä½†æ˜¯ä½ å¯ä»¥å¯¹ @code{IGNORECASE} æ‰€åšçš„äº‹æƒ…ï¼Œå°±æ˜¯åŠ¨æ€åœ°ä¸ºæ‰€æœ‰è§„åˆ™å¼€å…³å¤§å°å†™åŒºåˆ†åŠŸèƒ½ã€‚

@code{IGNORECASE} ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè®¾ç½®ï¼Œæˆ–è€…åœ¨ @code{BEGIN} è§„åˆ™ä¸­è®¾ç½®
ï¼ˆæŸ¥çœ‹ @ref{Other Arguments}ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ @ref{Using BEGIN/END}ï¼‰ã€‚
åœ¨å‘½ä»¤è¡Œä¸Šè®¾ç½® @code{IGNORECASE} ä½¿å¾—ç¨‹åºä¸ç”¨æ›´æ”¹å°±å¯ä»¥è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…ã€‚

@c @cindex ISO 8859-1
@c @cindex ISO Latin-1
åœ¨å¤šå­—èŠ‚å­—ç¬¦çš„åŒºåŸŸä¸­ï¼Œå¤§å°å†™å­—ç¬¦æ˜¯ç­‰åŒçš„ï¼Œåˆ™æ˜¯æ ¹æ®å®ƒä»¬åœ¨å­—ç¬¦é›†ä¸­çš„å®½å­—ç¬¦å€¼æ¥è¿›è¡Œæµ‹è¯•çš„ã€‚
å¦åˆ™å­—ç¬¦å°±æ˜¯æŒ‰ç…§ ISO-8859-1ï¼ˆISO Latin-1ï¼‰å­—ç¬¦é›†è¿›è¡Œæµ‹è¯•çš„ã€‚
è¿™ä¸ªå­—ç¬¦é›†æ˜¯ä¼ ç»Ÿ 128 ASCII å­—ç¬¦çš„è¶…é›†ï¼Œå®ƒä¹Ÿæä¾›äº†è®¸å¤šçš„å­—ç¬¦å¯ç”¨äºæ¬§æ´²è¯­è¨€ã€‚ 
@footnote{å¦‚æœä½ ä¸äº†è§£è¿™äº›ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œè¿™ä»…ä»…æ„å‘³ç€ gawk å¯ä»¥åšæ­£ç¡®çš„äº‹æƒ…ã€‚}

å¦‚æœ @command{gawk} æ˜¯åœ¨å…¼å®¹æ¨¡å¼ä¸­ï¼Œåˆ™ @code{IGNORECASE} çš„å€¼ä¸ä¼šæœ‰å½±å“ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚å¤§å°å†™åœ¨å…¼å®¹æ¨¡å¼ä¸‹éƒ½æ˜¯åŒºåˆ†çš„ã€‚

@node Regexp Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
æ­£åˆ™è¡¨è¾¾å¼æè¿°äº†è¦è¢«åŒ¹é…çš„å­—ä¸²é›†ã€‚åœ¨ @command{awk} ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡å†™æˆè¿™æ ·ï¼š@code{/}@dots{}@code{/}ã€‚

@item
æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡å¯ä»¥åœ¨æ¨¡å¼ä¸æ¡ä»¶è¡¨è¾¾å¼ä¸­å•ç‹¬ä½¿ç”¨ï¼Œæˆ–è€…åˆ©ç”¨ @samp{~} ä¸ @samp{!~} æ“ä½œç¬¦ä½¿å…¶æˆä¸ºåŒ¹é…è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ã€‚

@item
è½¬ä¹‰åºåˆ—å¯ä»¥è®©ä½ è¾“å…¥ä¸å¯æ‰“å°å­—ç¬¦ï¼Œä¹Ÿå¯ä»¥è®©ä½ å°†æ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦ä½œä¸ºå­—é¢å­—ç¬¦åœ¨è¡¨è¾¾å¼ä¸­è¿›è¡ŒåŒ¹é…ã€‚

@item
æ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦å¯ä»¥æä¾›ç»„åˆï¼Œé€‰æ‹©ä»¥åŠé‡å¤åŠŸèƒ½ã€‚

@item
æ–¹æ‹¬å·è¡¨è¾¾å¼ä½¿ä½ æ–¹ä¾¿åœ°æŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†åˆï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æŸä¸ªç‚¹è¿›è¡ŒåŒ¹é…ã€‚åœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ã€‚POSIX å­—ç¬¦ç±»å¯ä»¥æŒ‡å®šä¸€ç»„åŒºåŸŸå­—ç¬¦æ— å…³çš„å­—ç¬¦ã€‚

@item
æ­£åˆ™è¡¨è¾¾å¼ä¼šåŒ¹é…æœ€å·¦æœ€é•¿çš„å­—ä¸²ã€‚è¿™å¯¹äºä½ éœ€è¦äº†è§£åŒ¹é…çš„åŒºåŸŸèŒƒå›´æ—¶æ˜¯æœ‰æ„ä¹‰çš„ï¼Œåƒæ–‡ä»¶æ›¿æ¢ï¼Œä»¥åŠè®°å½•åˆ†éš”ç¬¦æ˜¯æ­£åˆ™è¡¨è¾¾å¼è¿™ç§æƒ…å†µã€‚

@item
åŒ¹é…è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨åŠ¨æ€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¦‚å­—ä¸²å€¼æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼å¯¹å¾…ï¼‰ã€‚

@item
@command{gawk} çš„ @code{IGNORECASE} å˜é‡å¯ä»¥è®©ä½ æ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ—¶çš„å¤§å°åŒºåˆ†æƒ…å†µã€‚åœ¨å…¶ä»–ç‰ˆæœ¬çš„ @command{awk} ä¸­ï¼Œä½¿ç”¨ tolower() æˆ–è€… toupper ()ã€‚

@end itemize


@node Reading Files
@chapter è¯»å–è¾“å…¥æ–‡ä»¶

@cindex reading input files
@cindex input files, reading
@cindex input files
@cindex @code{FILENAME} variable
åœ¨å…¸å‹çš„ @command{awk} ç¨‹åºä¸­ï¼Œ@command{awk} è¦ä¹ˆä»æ ‡å‡†è¾“å…¥ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå°±æ˜¯é”®ç›˜ï¼Œä½†æ˜¯å¸¸å¸¸æ˜¯å…¶ä»–ç¨‹åºå‘½ä»¤çš„ç®¡é“è¾“å…¥ï¼‰ï¼Œ
è¦ä¹ˆä»ä½ åœ¨ @command{awk} å‘½ä»¤è¡Œä¸ŠæŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚å¦‚æœä½ æŒ‡å®šäº†è¾“å…¥æ–‡ä»¶ï¼Œ@command{awk} ä¼šæŒ‰é¡ºåºä»ä¸­è¯»å–ï¼Œå¹¶åœ¨ä¸‹ä¸€ä¸ªæ–‡ä»¶ä¹‹å‰å¤„ç†å…¶ä¸­çš„æ•°æ®ã€‚
å½“å‰æ­£åœ¨å¤„ç†çš„æ–‡ä»¶å¯ä»¥ä»å‚å®šä¹‰çš„å˜é‡ @code{FILENAME} ä¸­å–å¾—ï¼ˆæŸ¥çœ‹ @ref{Built-in Variables}ï¼‰ã€‚

@cindex records
@cindex fields
è¾“å…¥å•ä½ç§°ä¸º@dfn{è®°å½•}ï¼Œå¹¶åˆ©ç”¨ä½ æä¾›çš„è§„åˆ™ä¸€æ¬¡å¤„ç†ä¸€ä¸ªè®°å½•ï¼Œæ¯ä¸ªè®°å½•ä¸€è¡Œã€‚æ¯ä¸ªè®°å½•ä¼šè¢«è‡ªåŠ¨åŠ›åœ°æ‹†åˆ†æˆå‡ ä¸ªå—ï¼Œç§°ä¸º@dfn{åŸŸ}ã€‚
è¿™æ ·ç¨‹åºå°±èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è®°å½•çš„ä¸åŒéƒ¨åˆ†ã€‚

@cindex @code{getline} command
åœ¨æå°‘æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ @code{getline} å‘½ä»¤æ¥è¯»å–æ•°æ®ã€‚@code{getline} éå¸¸æœ‰ç”¨ï¼Œä¸€æ˜¯å…¶å¯ä»¥ä»å¤§é‡çš„æ–‡ä»¶ä¸­æ˜¾ç¤ºåœ°è¾“å…¥ï¼ŒäºŒæ˜¯åœ¨è¯»å–æ–‡ä»¶æ—¶ï¼Œè¿™äº›æ–‡ä»¶ä¸éœ€è¦åœ¨å‘½ä»¤åœ°ä¸­æŒ‡å®š
ï¼ˆæŸ¥çœ‹ @ref{Getline}ï¼‰ã€‚

@menu
* Records::                     Controlling how data is split into records.
* Fields::                      An introduction to fields.
* Nonconstant Fields::          Nonconstant Field Numbers.
* Changing Fields::             Changing the Contents of a Field.
* Field Separators::            The field separator and how to change it.
* Constant Size::               Reading constant width data.
* Splitting By Content::        Defining Fields By Content
* Multiple Line::               Reading multiline records.
* Getline::                     Reading files under explicit program control
                                using the @code{getline} function.
* Read Timeout::                Reading input with a timeout.
* Command-line directories::    What happens if you put a directory on the
                                command line.
* Input Summary::               Input summary.
* Input Exercises::             Exercises.
@end menu

@node Records
@section è¾“å…¥å¦‚ä½•æ‹†åˆ†ä¸ºè®°å½•

@cindex input, splitting into records
@cindex records, splitting input into
@cindex @code{NR} variable
@cindex @code{FNR} variable
@command{awk} å°†è¾“å…¥æ‹†åˆ†ä¸ºè®°å½•ä¸åŸŸï¼Œç„¶åè¾“å…¥åˆ°ä½ çš„ç¨‹åºä¸­ã€‚åŒæ—¶ï¼Œ@command{awk} è®°å½•ä»å½“å‰è¾“å…¥æ–‡ä»¶ä¸­å·²ç»è¯»å–çš„è®°å½•æ•°ã€‚
è¿™ä¸ªå€¼å­˜å‚¨åœ¨é¢„å®šä¹‰çš„å˜é‡ @code{FNR} ä¸­ï¼Œåœ¨å¤„ç†ä¸‹ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå®ƒä¼šè¢«é‡ç½®ä¸º 0ã€‚
å¦ä¸€ä¸ªé¢„å®šä¹‰çš„å˜é‡ç§°ä¸º @code{NR}ï¼Œæ¥ç”¨è®°å½•ä»æ‰€æœ‰@value{DF}ä¸­å·²ç»è¯»å–è¾“å…¥è®°å½•çš„æ€»æ•°ã€‚å®ƒä» 0 å¼€å§‹ï¼Œä½†æ˜¯ä¸ä¼šè‡ªåŠ¨é‡è®¾ä¸º 0ã€‚

@menu
* awk split records::           How standard @command{awk} splits records.
* gawk split records::          How @command{gawk} splits records.
@end menu

@node awk split records
@subsection æ ‡å‡† @command{awk} çš„è®°å½•æ‹†åˆ†

@cindex separators, for records
@cindex record separators
è®°å½•é€šè¿‡è¢«ç§°ä¸º@dfn{è®°å½•åˆ†éš”ç¬¦}çš„å­—ç¬¦åˆ†éš”ã€‚é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯æ¢è¡Œç¬¦ï¼ˆ@samp{\n}ï¼‰ã€‚
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®°å½•é»˜è®¤éƒ½æ˜¯ä¸€è¡Œä¸€è¡Œçš„ã€‚
è¦ä½¿ç”¨ä¸åŒçš„å­—ç¬¦æ¥è¿›è¡Œè®°å½•åˆ†éš”ï¼Œç®€å•åœ°ç»™é¢„å®šä¹‰çš„å˜é‡ @code{RS} èµ‹å€¼å³å¯ã€‚

@cindex newlines, as record separators
@cindex @code{RS} variable
ä¸å…¶ä»–çš„å˜é‡ç±»ä¼¼ï¼Œ@code{RS} çš„å€¼å¯ä»¥åœ¨ @command{awk} ç¨‹åºä¸­é€šè¿‡æ“ä½œç¬¦ @samp{=} æ¥æ”¹å˜ï¼ˆæŸ¥çœ‹ @ref{Assignment Ops}ï¼‰ã€‚
æ–°çš„è®°å½•åˆ†éš”ç¬¦å¯ä»¥ç”¨å¼•å·å¼•èµ·æ¥ï¼Œå³æŒ‡ç¤ºä¸ºä¸€ä¸ªå­—ä¸²å¸¸é‡ã€‚ä¸€èˆ¬åœ°ï¼Œè¿™ä¹ˆåšçš„æ­£ç¡®æ—¶é—´æ˜¯åœ¨ç¨‹åºæ‰§è¡Œçš„å¼€å§‹ï¼Œå¹¶åœ¨è®°å½•æœªè¾“å…¥ä¹‹å‰ï¼Œå› æ­¤å°±å¯ä»¥ä»ç¬¬ä¸€æ¡è®°å½•å¼€å§‹è¿›è¡Œå¤„ç†ã€‚
è¦è¿™ä¹ˆåšï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„ @code{BEGIN} æ¨¡å¼ï¼ˆæŸ¥çœ‹ @ref{BEGIN/END}ï¼‰ã€‚ä¾‹å¦‚ï¼š

@example
awk 'BEGIN @{ RS = "u" @}
     @{ print $0 @}' mail-list
@end example

@noindent
åœ¨è¯»å–ä»»ä½•è¾“å…¥ä¹‹å‰ï¼Œå°† @code{RS} çš„å€¼æ”¹æˆ @samp{u} ã€‚
æ–°çš„å€¼æ˜¯ä¸€ä¸ªå­—ä¸²ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å­—æ¯ @samp{u}ï¼›å…¶ç»“æœå°±æ˜¯ï¼Œè®°å½•éƒ½è¢«å­—æ¯ @samp{u} è¿›è¡Œåˆ†éš”ã€‚
ç„¶åè¾“å…¥æ–‡ä»¶è¢«è¯»å–ï¼Œ@command{awk} ç¨‹åºçš„ç¬¬äºŒä¸ªè§„åˆ™ï¼ˆæ²¡æœ‰æ¨¡å¼çš„åŠ¨ä½œï¼‰æ‰“å°æ¯ä¸€ä¸ªè®°å½•ã€‚
å› ä¸ºæ¯ä¸ª @code{print} è¯­å¥éƒ½ä¼šåœ¨è¾“å‡ºçš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œ
æ‰€ä»¥ï¼Œä¸‹é¢è¿™ä¸ª @command{awk} ç¨‹åºå°±æ˜¯å°†æ¯ä¸ªå­—æ¯ @samp{u} æ¢æˆäº†æ¢è¡Œç¬¦ã€‚
ä¸‹é¢æ˜¯æ‰§è¡Œç¨‹åºåœ¨ä½¿ç”¨ @file{mail-list} ä½œä¸ºè¾“å…¥æ–‡ä»¶æ—¶çš„è¾“å‡ºï¼š

@example
$ @kbd{awk 'BEGIN @{ RS = "u" @}}
>      @kbd{@{ print $0 @}' mail-list}
@print{} Amelia       555-5553     amelia.zodiac
@print{} sq
@print{} e@@gmail.com    F
@print{} Anthony      555-3412     anthony.assert
@print{} ro@@hotmail.com   A
@print{} Becky        555-7685     becky.algebrar
@print{} m@@gmail.com      A
@print{} Bill         555-1675     bill.drowning@@hotmail.com       A
@print{} Broderick    555-0542     broderick.aliq
@print{} otiens@@yahoo.com R
@print{} Camilla      555-2912     camilla.inf
@print{} sar
@print{} m@@skynet.be     R
@print{} Fabi
@print{} s       555-1234     fabi
@print{} s.
@print{} ndevicesim
@print{} s@@
@print{} cb.ed
@print{}     F
@print{} J
@print{} lie        555-6699     j
@print{} lie.perscr
@print{} tabor@@skeeve.com   F
@print{} Martin       555-6480     martin.codicib
@print{} s@@hotmail.com    A
@print{} Sam
@print{} el       555-3430     sam
@print{} el.lanceolis@@sh
@print{} .ed
@print{}         A
@print{} Jean-Pa
@print{} l    555-2127     jeanpa
@print{} l.campanor
@print{} m@@ny
@print{} .ed
@print{}      R
@print{}
@end example

@noindent
æ³¨æ„åå­—ä¸º @samp{Bill} çš„é‚£ä¸€é¡¹æ²¡æœ‰è¢«æ‹†åˆ†ã€‚åœ¨åˆå§‹çš„@value{DF}ä¸­ï¼ˆæŸ¥çœ‹ @ref{Sample Data Files}ï¼‰ï¼Œé‚£ä¸€è¡Œæ˜¯è¿™æ ·çš„ï¼š

@example
Bill         555-1675     bill.drowning@@hotmail.com       A
@end example

@noindent
é‡Œé¢ä¸åŒ…å« @samp{u}ï¼Œå› æ­¤æ²¡æœ‰ç†ç”±è¦åˆ†éš”è®°å½•ï¼Œä¸åƒå…¶ä»–çš„éƒ¨åˆ†ï¼Œå®ƒä»¬æ¯ä¸ªéƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª @samp{u} å‡ºç°ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªè®°å½•ä¼šè¢«å½“å‰ä¸€ä¸ªè®°å½•çš„ä¸€éƒ¨åˆ†ï¼›è¾“å‡ºæ—¶åˆ†éš”ä»–ä»¬çš„æ¢è¡Œç¬¦æ˜¯åŸæ¥@value{DF}ä¸­çš„æ¢è¡Œç¬¦ï¼Œè€Œä¸æ˜¯ @command{awk} åæ¥æ‰“å°è®°å½•æ—¶åŠ ä¸Šçš„ã€‚

@cindex record separators, changing
@cindex separators, for records
å¦ä¸€ä¸ªæ–¹æ³•å°±æ˜¯åˆ©ç”¨å˜é‡èµ‹å€¼ç‰¹æ€§ï¼Œåœ¨å‘½ä»¤è¡Œä¸Šæ”¹å˜è®°å½•åˆ†éš”ç¬¦ï¼ˆæŸ¥çœ‹ @ref{Other Arguments}ï¼‰ï¼š

@example
awk '@{ print $0 @}' RS="u" mail-list
@end example

@noindent
è¿™é‡Œå°†åœ¨å¤„ç† @file{mail-list} ä¹‹å‰å°† @code{RS} è®¾ç½®æˆ @samp{u} ã€‚

åˆ©ç”¨ç±»ä¼¼äº @samp{u} è¿™æ ·çš„å­—æ¯å­—ç¬¦ä½œä¸ºè®°å½•çš„åˆ†éš”ç¬¦æœ‰å¯èƒ½äº§ç”Ÿå¥‡æ€ªçš„ç»“æœã€‚
ä½¿ç”¨ç‰¹åˆ«ä¸€ç‚¹çš„å­—ç¬¦ï¼Œå¦‚ @samp{/} æ›´å¯èƒ½åœ¨å¤§å¤šæ•°ä¾‹å­ä¸­äº§ç”Ÿæ­£ç¡®çš„ç»“æœï¼Œä½†æ˜¯è¿™ä¹Ÿä¸æ˜¯æ‰“åŒ…ç¥¨çš„äº‹æƒ…ã€‚ç»ˆææ–¹æ³•å°±æ˜¯ï¼šè¦äº†è§£ä½ çš„æ•°æ®ã€‚

ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºè®°å½•çš„åˆ†éš”ç¬¦ï¼Œå½“ @command{gawk} å®Œå…¨ä¸ POSIX å…¼å®¹æ—¶ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„æƒ…å†µä¼šå‡ºç°
ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚ä¸‹é¢ï¼ˆæç«¯æƒ…å†µï¼‰çš„ç®¡ç¨‹ä¼šæ‰“å°ä»¤äººæƒŠè®¶çš„ @samp{1} ï¼š

@example
$ @kbd{echo | gawk --posix 'BEGIN @{ RS = "a" @} ; @{ print NF @}'}
@print{} 1
@end example

è¿™é‡Œæœ‰ä¸€ä¸ªåŸŸï¼ŒåªåŒ…å«ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚å†…å»ºå˜é‡ @code{NF} çš„å€¼å°±æ˜¯å½“å‰è®°å½•çš„åŸŸçš„æ•°é‡ã€‚
ï¼ˆåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œ@command{gawk} ä¼šå°†æ¢è¡Œç¬¦å½“åšç©ºæ ¼å¤„ç†ï¼Œä¼šæ‰“å° @samp{0} ä½œä¸ºç»“æœã€‚@command{awk} å¤§å¤šæ•°å…¶ä»–ç‰ˆæœ¬éƒ½æ˜¯è¿™ä¹ˆè¡¨ç°çš„ã€‚ï¼‰

@cindex dark corner, input files
å½“è¾“å…¥æ–‡ä»¶ç»“æŸåï¼Œå°±ä¼šç»“æŸå½“å‰çš„è¾“å…¥è®°å½•ï¼Œå°±ç®—æ–‡ä»¶çš„æœ€åä¸€ä¸ªå­—ç¬¦ä¸åœ¨ @code{RS} é‡Œã€‚
@value{DARKCORNER}

@cindex empty strings
@cindex null strings
@cindex strings, empty, See null strings
ç©ºä¸² @code{""}ï¼ˆå³æ²¡æœ‰ä»»ä½•å­—ç¬¦çš„ä¸²ï¼‰å¯¹äº @code{RS} çš„å€¼æ¥è¯´ï¼Œæœ‰ç€ç‰¹æ®Šçš„å«ä¹‰ã€‚
å³è¡¨ç¤ºè®°å½•ä¹‹é—´æ˜¯é€šè¿‡ä¸€ä¸ªæˆ–è€…å¤šä¸ªç©ºè¡Œæ¥åˆ†éš”çš„ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„ä»€ä¹ˆå­—ç¬¦ã€‚æŸ¥çœ‹ @ref{Multiple Line}ï¼Œæ¥è·å–æ›´å¤šçš„ç»†èŠ‚ã€‚

å¦‚æœä½ åœ¨ @command{awk} ç¨‹åºä¸­ä¸­é€”æ”¹å˜ @code{RS} çš„å€¼ï¼Œæ–°çš„å€¼å°†ç”¨æ¥åšåç»­è®°å½•çš„åˆ†éš”ç¬¦ï¼Œä½†æ˜¯å½“å‰çš„è®°å½•ä¼šç»§ç»­æŒ‰åŸæ¥çš„æ–¹å¼å¤„ç†ã€‚

@cindex @command{gawk}, @code{RT} variable in
@cindex @code{RT} variable
@cindex records, terminating
@cindex terminating records
@cindex differences in @command{awk} and @command{gawk}, record separators
@cindex regular expressions, as record separators
@cindex record separators, regular expressions as
@cindex separators, for records, regular expressions as
å½“è®°å½•å°¾å·²ç»ç¡®å®šå¥½äº†ï¼Œ@command{gawk} è®¾ç½®å˜é‡ @code{RT} çš„å€¼ä¸ºè¾“å…¥æ–‡ä»¶ä¸­åŒ¹é… @code{RS} çš„æ–‡æœ¬ã€‚

@node gawk split records
@subsection ä½¿ç”¨ @command{gawk} åˆ†å‰²è®°å½•

@cindex common extensions, @code{RS} as a regexp
@cindex extensions, common@comma{} @code{RS} as a regexp
å½“ä½¿ç”¨ @command{gawk} æ—¶ï¼Œ@code{RS} çš„å€¼å¹¶ä¸å±€é™äºå•ä¸ªå­—ç¬¦çš„å­—ä¸²ï¼Œ
å®ƒä¹Ÿå¯ä»¥æ˜¯ä»»ä½•çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @ref{Regexp}ï¼‰ã€‚@value{COMMONEXT}
ä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªè®°å½•éƒ½åœ¨ä¸‹ä¸ªåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„æ–‡ä»¶ä¸²åœ°æ–¹ç»“æŸï¼›è€Œä¸‹ä¸€ä¸ªè®°å½•åˆ™å¼€å§‹äºè¯¥åŒ¹é…æ–‡æœ¬çš„åœ°æ–¹ã€‚
è¿™ä¸ªä¸€èˆ¬çš„åŸåˆ™åœ¨é€šå¸¸çš„æƒ…å†µä¸‹æ˜¯ä¹ˆå·¥ä½œçš„ï¼Œæ­¤æ—¶ @code{RS} åªåŒ…æ‹¬ä¸€ä¸ªæ¢è¡Œç¬¦ï¼š
è®°å½•ç»“æŸäºä¸‹ä¸€ä¸ªåŒ¹é…ä¸²çš„å¼€å§‹å¤„ï¼ˆè¾“å…¥ä¸­çš„ä¸‹ä¸€ä¸ªæ¢è¡Œç¬¦ï¼‰ï¼Œç„¶åä¸‹ä¸€ä¸ªè®°å½•å°±å¼€å§‹äºåˆšæ‰åŒ¹é…ä¸²çš„åé¢ï¼ˆå³ä¸‹ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¤„ï¼‰ã€‚ç”±äºæ¢è¡Œç¬¦åŒ¹é… @code{RS}ï¼Œæ‰€ä»¥å…¶å¹¶ä¸æ˜¯ä»»ä½•è®°å½•çš„ä¸€éƒ¨åˆ†ã€‚

å½“ @code{RS} åªæ˜¯å•ä¸€çš„ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œ@code{RT} åŒ…å«ç›¸åŒçš„å•ä¸€å­—ç¬¦ã€‚
ä½†æ˜¯ï¼Œå½“@code{RS} æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œ@code{RT} åŒ…å«åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å®é™…çš„è¾“å…¥æ–‡æœ¬ã€‚

å¦‚æœè¾“å…¥æ–‡ä»¶ç»“æŸæ—¶ä¹Ÿæ²¡æœ‰æ–‡æœ¬åŒ¹é… @code{RS}ï¼Œ@command{gawk} å°† @code{RT} è®¾ç½®æˆç©ºä¸²ã€‚

ä¸‹é¢çš„ä¾‹å­è§£é‡Šäº†è¿™ä¸¤ä¸ªç‰¹æ€§ã€‚ä¾‹å­ä¸­å°† @code{RS} è®¾ç½®æˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼è¦ä¹ˆåŒ¹é…æ¢è¡Œç¬¦ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªå¤§å†™å­—æ¯çš„åºåˆ—ï¼Œå…¶å‰å¯¼å¹¶ä¸”/æˆ–è€…å…¶æœ«å°¾å¸¦æœ‰å¯é€‰çš„ç©ºç™½ç¬¦ã€‚

@example
$ @kbd{echo record 1 AAAA record 2 BBBB record 3 |}
> @kbd{gawk 'BEGIN @{ RS = "\n|( *[[:upper:]]+ *)" @}}
>             @kbd{@{ print "Record =", $0,"and RT = [" RT "]" @}'}
@print{} Record = record 1 and RT = [ AAAA ]
@print{} Record = record 2 and RT = [ BBBB ]
@print{} Record = record 3 and RT = [
@print{} ]
@end example

@noindent
æ–¹æ‹¬å·å‹¾å‹’å‡º @code{RT} çš„å†…å®¹ï¼Œè®©ä½ å¯çœ‹åˆ°äº†å‰é¢ä¸åé¢çš„ç©ºç™½ã€‚@code{RT} çš„ç»ˆå€¼æ˜¯ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚
å¯ä»¥æŸ¥çœ‹ @ref{Simple Sed}ï¼Œæ¥çœ‹çœ‹æ›´æœ‰ç”¨çš„ä»¥æ­£åˆ™è¡¨è¾¾å¼ä½œä¸º @code{RS} ä¸ @code{RT} çš„ä¾‹å­ã€‚

å¦‚æœä½ å°† @code{RS} è®¾ç½®åœ¨å¯ä»¥æœ‰å¯é€‰ç»“æŸæ–‡æœ¬çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚ @samp{RS = "abc(XYZ)?"}ï¼Œ
ç”±äºå®ç°ä¸Šçš„é™åˆ¶ï¼Œ@command{gawk} æœ‰å¯èƒ½åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å‰éƒ¨åˆ†ï¼Œè€Œä¸ä¼šåŒ¹é…åé¢çš„å¯é€‰éƒ¨åˆ†ï¼Œå°¤å…¶æ˜¯å¯é€‰çš„ç»“å°¾åŒ¹é…å¾ˆé•¿çš„æƒ…å†µã€‚
@command{gawk} ä¼šè¯•å›¾é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç›®å‰ï¼Œå¹¶ä¸ä¿è¯ç»ä¸ä¼šå‘ç”Ÿè¿™ä¸ªæƒ…å†µï¼ˆå³ä¸åŒ¹é…ç»“å°¾å¯é€‰éƒ¨åˆ†â€”â€”â€”è¯‘è€…ï¼‰ã€‚

@quotation æç¤º
è¦è®°ä½ï¼Œåœ¨ @command{awk} ä¸­ï¼Œ@samp{^} ä¸ @samp{$} é”šå®šå…ƒå­—ç¬¦åŒ¹é…å­—ä¸²çš„å¼€å§‹ä¸ç»“æŸï¼Œè€Œä¸æ˜¯è¡Œçš„å¼€å§‹ä¸ç»“æŸã€‚
è¿™æ ·çš„ç»“æœå°±æ˜¯ï¼Œå¦‚æœæœ‰è¿™æ ·çš„è¡¨è¾¾å¼ @samp{RS = "^[[:upper:]]"} å¯ä»¥åªåŒ¹é…æ–‡ä»¶çš„å¼€å¤´ã€‚
è¿™æ˜¯å› ä¸º @command{gawk} å°†è¾“å…¥æ–‡ä»¶çœ‹ä½œæ˜¯ä¸€ä¸ªåŒ…å«æ¢è¡Œç¬¦çš„é•¿ä¸²ã€‚å› æ­¤æœ€å¥½é¿å…åœ¨ @code{RS} çš„å€¼ä¸­å«æœ‰é”šå®šç¬¦ã€‚
@end quotation

@cindex differences in @command{awk} and @command{gawk}, @code{RS}/@code{RT} variables
å°† @code{RS} è®¾ç½®æˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥åŠ @code{RT} å˜é‡æ˜¯ @command{gawk} çš„æ‰©å±•ï¼›å®ƒä»¬åœ¨å…¼å®¹æ¨¡å¼ä¸‹æ˜¯ä¸å¯ç”¨çš„ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚
åœ¨å…¼å®¹æ¨¡å¼ä¸‹ï¼Œåªæœ‰ @code{RS} å€¼çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¼šç”¨æ¥ç¡®å®šè®°å½•çš„ç»“æŸã€‚

@sidebar @code{RS = "\0"} æ˜¯ä¸å¯ç§»æ¤çš„
@cindex portability, data files as single record
æœ‰é‚£ä¹ˆå‡ æ¬¡ï¼Œä½ å¯èƒ½æƒ³å°†æ•´ä¸ª@value{DF}ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„è®°å½•ã€‚
å”¯ä¸€èƒ½å¤Ÿå®ç°è¿™ä¸ªåŠŸèƒ½çš„å°±æ˜¯å°† @code{RS} çš„å€¼è®¾ç½®æˆä¸ä¼šåœ¨è¾“å…¥æ–‡ä»¶ä¸­å‡ºç°çš„å­—ç¬¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç¨‹åºæ¯”è¾ƒéš¾åšåˆ°åœ¨ä»»æ„çš„è¾“å…¥æ–‡ä»¶ä¸­éƒ½æ˜¯æ­£ç¡®çš„ã€‚

ä½ å¯èƒ½è®¤ä¸ºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºæ–‡æœ¬æ–‡ä»¶æ¥è¯´ï¼Œæ‰€æœ‰ä½éƒ½ç”± 0 ç»„æˆçš„ @sc{nul} å­—ç¬¦ï¼Œé€‚åˆä½œä¸º @code{RS} çš„å€¼ï¼š

@example
BEGIN @{ RS = "\0" @}  # whole file becomes one record?
@end example

@cindex differences in @command{awk} and @command{gawk}, strings, storing
@command{gawk} å®é™…ä¸Šæ¥å—è¿™æ ·çš„è¾“å…¥ï¼Œå¹¶ä¸”ä½¿ç”¨ @sc{nul} å­—ç¬¦ä½œä¸ºè®°å½•çš„åˆ†éš”ç¬¦ã€‚
è¿™å¯¹äºç‰¹å®šçš„ç‰¹æ®Šæ–‡ä»¶æ˜¯å¯ä»¥çš„ï¼Œä¾‹å¦‚åœ¨ GNU/Linux ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ @file{/proc/environ}ï¼Œå®é™…ä¸Š @sc{nul} å­—ç¬¦å®é™…ä¸Šæ˜¯è®°å½•åˆ†éš”ç¬¦ã€‚
å¯æ˜¯ï¼Œå¯¹äºå¤§å¤šæ•°çš„ @command{awk} å®ç°æ¥è¯´ï¼Œè¿™æ˜¯ä¸å¯ç§»æ¤çš„ã€‚

@cindex dark corner, strings, storing
å¤§å¤šæ•°çš„å…¶ä»– @command{awk} å®ç°@footnote{è‡³å°‘æˆ‘ä»¬æ‰€çŸ¥é“çš„é‚£äº›ã€‚}å†…éƒ¨å°†å­—ä¸²å­˜æˆ C é£æ ¼çš„å­—ä¸²ã€‚
è€Œ C é£æ ¼çš„å­—ä¸²ä½¿ç”¨ @sc{nul} åšä¸ºå­—ä¸²çš„ç»“æŸç¬¦ï¼Œæ•ˆæœå°±æ˜¯ @samp{RS = "\0"} ä¸ @samp{RS = ""} æ˜¯ä¸€æ ·çš„ã€‚
@value{DARKCORNER}

æ–°è¿‘çš„ @command{mawk} çš„ç‰ˆæœ¬ä¹Ÿå¯ä»¥ä½¿ç”¨ @sc{nul} å­—ç¬¦ä½œä¸ºè®°å½•çš„åˆ†éš”ç¬¦ã€‚
ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸ªç‰¹æ®Šæƒ…å†µï¼š@command{mawk} ä¸å…è®¸åœ¨å­—ä¸²ä¸­åµŒå…¥ @sc{nul} å­—ç¬¦ã€‚ï¼ˆè¿™å¯èƒ½åœ¨ @command{mawk} çš„åç»­ç‰ˆæœ¬ä¸­ä¼šæ”¹å˜ã€‚ï¼‰

@cindex records, treating files as
@cindex treating files, as single records
é€šè¿‡ @ref{Readfile Function}ï¼Œæ¥æŸ¥çœ‹ä¸€äº›æœ‰è¶£çš„æ–¹æ³•æ¥è¯»å–æ•´ä¸ªæ–‡ä»¶ã€‚
å¦‚æœä½ ä½¿ç”¨ @command{gawk}ï¼ŒæŸ¥çœ‹ @ref{Extension Sample Readfile}ï¼Œæ¥é€‰æ‹©å…¶ä»–çš„é€‰é¡¹ã€‚
@end sidebar

@node Fields
@section æ£€æŸ¥åŸŸ

@cindex examining fields
@cindex fields
@cindex accessing fields
@cindex fields, examining
@cindex POSIX @command{awk}, field separators and
@cindex field separators, POSIX and
@cindex separators, field, POSIX and
å½“ @command{awk} è¯»å–è¾“å…¥è®°å½•æ—¶ï¼Œè®°å½•æ˜¯è‡ªåŠ¨åœ°è¢« @command{awk} å·¥å…·åˆ†ææˆ–è€…åˆ†éš”æˆç§°ä¸º@dfn{åŸŸ}çš„å—ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸŸæ˜¯é€šè¿‡@dfn{ç©ºç™½}è¿›è¡Œåˆ†éš”çš„ï¼Œåƒä¸€è¡Œä¸­çš„å•è¯ä¸€æ ·ã€‚
@command{awk} ä¸­çš„ç©ºç™½ç¬¦è¡¨ç¤ºä¸€ä¸ªæˆ–è€…å¤šä¸ªç©ºæ ¼ã€TABsï¼Œæˆ–è€…æ¢è¡Œç¬¦æ‰€ç»„æˆçš„ä¸²ï¼›
@footnote{åœ¨ POSIX awkï¼Œæ¢è¡Œç¬¦ä¸è¢«è®¤ä¸ºæ˜¯ç”¨æ¥è¿›è¡ŒåŸŸåˆ†éš”çš„ç©ºç™½ç¬¦ã€‚}
ï¼ˆå…¶ä»–çš„å­—ç¬¦å¦‚å›æ¡£ç¬¦ï¼Œå‚ç›´è·³æ ¼ç­‰ï¼‰è¢«å…¶ä»–è¯­è¨€è®¤ä¸ºæ˜¯ç©ºç™½ç¬¦çš„è¿™äº›ç¬¦å·éƒ½@emph{ä¸}è¢« @command{awk} è¯†åˆ«ä¸ºç©ºç™½ç¬¦ã€‚

åŸŸçš„ç”¨å¤„æ˜¯ä¸ºäº†è®©ä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŒ‡å®šè¿™äº›è®°å½•çš„å—ã€‚ä½ ä¸å¿…ä¸€å®šè¦ä½¿ç”¨ä»–ä»¬ï¼Œä½ å¯ä»¥æ“ä½œæ•´ä¸ªè®°å½•ï¼Œ
ä½†æ˜¯åŸŸå¯ä»¥ä½¿å¾— @command{awk} ç¨‹åºå˜å¾—éå¸¸å¼ºå¤§ã€‚

@cindex field operator @code{$}
@cindex @code{$} (dollar sign), @code{$} field operator
@cindex dollar sign (@code{$}), @code{$} field operator
@cindex field operators@comma{} dollar sign as
ä½ ä½¿ç”¨ç¾å…ƒç¬¦å·ï¼ˆ@samp{$}ï¼‰æ¥æŒ‡å®š @command{awk} ç¨‹åºä¸­çš„åŸŸï¼Œç¬¦å·åé¢è·Ÿçš„æ˜¯åŸŸçš„ç¼–å·ã€‚
å› æ­¤ï¼Œ@code{$1} è¡¨ç¤ºæ˜¯ç¬¬ä¸€ä¸ªåŸŸï¼Œ@code{$2} æ˜¯ç¬¬äºŒä¸ªç­‰ç­‰ã€‚
ï¼ˆä¸åƒ Unix Shell ä¸­ï¼ŒåŸŸçš„ç¼–å·åªè¢«é™åˆ¶ç”¨å•ä¸ªæ•°å­—ï¼Œä¾‹å¦‚ï¼Œ@code{$127} æ˜¯è®°å½•ä¸­çš„ç¬¬ 127 ä¸ªåŸŸã€‚ï¼‰å‡è®¾ä¸‹é¢çš„è¡Œæ˜¯è¾“å…¥è¡Œï¼š

@example
This seems like a pretty nice example.
@end example

@noindent
è¿™é‡Œç¬¬ä¸€ä¸ªåŸŸï¼Œæˆ–è€… @code{$1} æ˜¯ @samp{This}ï¼Œç¬¬äºŒä¸ªåŸŸï¼Œæˆ–è€…è¯´ @code{$2} æ˜¯ @samp{seems} ç­‰ç­‰ã€‚
æ³¨æ„æœ€åä¸€ä¸ªåŸŸï¼Œå³ @code{$7} æ˜¯ @samp{example.} ã€‚
å› ä¸ºåœ¨ @samp{e} ä¸ @samp{.} ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ï¼Œå› æ­¤ç‚¹å·è¢«è®¤ä¸ºæ˜¯ç¬¬ä¸ƒä¸ªåŸŸçš„ä¸€éƒ¨åˆ†ã€‚

@cindex @code{NF} variable
@cindex fields, number of
@code{NF} æ˜¯é¢„å®šä¹‰å˜é‡ï¼Œç”¨æ¥è®°å½•å½“å‰è®°å½•çš„åŸŸæ•°é‡ã€‚@command{awk} åœ¨æ¯æ¬¡è¯»å–è®°å½•çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ›´æ–° @code{NF} çš„å€¼ã€‚
æ— è®ºè®°å½•ä¸­æœ‰å¤šå°‘ä¸ªåŸŸï¼Œå…¶æœ€åä¸€ä¸ªåŸŸéƒ½å¯ä»¥ç”¨ @code{$NF} æ¥è¡¨ç¤ºã€‚å› æ­¤åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ@code{$NF} ä¸ @code{$7} ç›¸åŒï¼Œå³ @samp{example.} ã€‚
å¦‚æœä½ æŒ‡å®šåŸŸè¶…è¿‡äº†æœ€åä¸€ä¸ªåŸŸï¼ˆå¦‚ä¸Šé¢çš„åªæœ‰ 7 ä¸ªåŸŸçš„ä¾‹å­ä¸­æŒ‡å®š @code{$8}ï¼‰ï¼Œ
ä½ ä¼šå¾—åˆ°ä¸€ä¸ªç©ºä¸²ï¼ˆå¦‚æœç”¨ä½œæ•°å€¼æ“ä½œä¸­ï¼Œåˆ™ä½ ä¼šå¾—åˆ° 0ã€‚ï¼‰

@code{$0} çœ‹èµ·æ¥åƒç”¨æ¥è¡¨ç¤ºç¬¬ 0 ä¸ªåŸŸï¼Œä½†è¿™æ˜¯ä¸ªç‰¹åˆ«æƒ…å†µï¼Œå®ƒä»£è¡¨çš„æ˜¯æ•´ä¸ªè¾“å…¥è®°å½•ã€‚
å½“ä½ ä¸ä½¿ç”¨å•ä¸ªçš„åŸŸçš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå˜é‡ã€‚è¿™é‡Œæœ‰æ›´å¤šçš„ä¾‹å­ï¼š

@example
$ @kbd{awk '$1 ~ /li/ @{ print $0 @}' mail-list}
@print{} Amelia       555-5553     amelia.zodiacusque@@gmail.com    F
@print{} Julie        555-6699     julie.perscrutabor@@skeeve.com   F
@end example

@noindent
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¼šæ‰“å°æ–‡ä»¶ @file{mail-list} ä¸­çš„æ¯ä¸€æ¡è®°å½•ï¼Œå…¶ç¬¬ 1 ä¸ªåŸŸä¸­åŒ…å« @samp{li} å­—ä¸²ã€‚

ä½œä¸ºæ¯”è¾ƒï¼Œä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¼šåœ¨@emph{æ•´ä¸ªè®°å½•}ä¸­æŸ¥æ‰¾ @samp{li} å­—ä¸²ï¼Œç„¶åæ‰“å°åŒ¹é…çš„è®°å½•ä¸­çš„ç¬¬ä¸€ä¸ªä¸æœ€åä¸€ä¸ªåŸŸï¼š

@example
$ @kbd{awk '/li/ @{ print $1, $NF @}' mail-list}
@print{} Amelia F
@print{} Broderick R
@print{} Julie F
@print{} Samuel A
@end example

@node Nonconstant Fields
@section éå¸¸æ•°åŸŸç¼–å·
@cindex fields, numbers
@cindex field numbers

åŸŸç¼–å·ä¸ä¸€å®šè¦æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚@command{awk} ç¨‹åºä¸­çš„ä»»æ„è¡¨è¾¾å¼éƒ½å¯ä»¥ç”¨åœ¨ @samp{$} çš„åé¢æ¥æŒ‡å®šä¸€ä¸ªåŸŸã€‚è¡¨è¾¾å¼çš„å€¼æŒ‡å®šäº†ä¸€ä¸ªåŸŸç¼–å·ã€‚å¦‚æœæœæ˜¯ä¸€ä¸ªå­—ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œåˆ™å°†ä¼šè¢«è½¬æ¢æˆä¸€ä¸ªæ•°å€¼ã€‚çœ‹ä¸‹é¢ä¾‹å­ï¼š

@example
awk '@{ print $NR @}'
@end example

@noindent
å›å¿†ä¸€ä¸‹ï¼Œ@code{NR} æ˜¯åˆ°ç›®å‰ä¸ºæ­¢æ‰€è¯»å–çš„è®°å½•æ•°ï¼š
å½“è¯»å–ç¬¬ä¸€ä¸ªè®°å½•æ—¶ @code{NR} ä¸º 1ï¼Œå½“è¯»å–ç¬¬äºŒä¸ªè®°å½•æ—¶ @code{NR} ä¸º 2ï¼Œç­‰ç­‰ã€‚
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¼šæ‰“å°ç¬¬ä¸€ä¸ªè®°å½•çš„ç¬¬ä¸€ä¸ªåŸŸï¼Œç¬¬äºŒä¸ªè®°å½•çš„ç¬¬äºŒä¸ªåŸŸç­‰ç­‰ã€‚å¯¹äº 20 ä¸ªè®°å½•ï¼Œç¬¬ 20 ä¸ªåŸŸçš„å€¼ä¼šè¢«æ‰“å°ï¼›
æœ€å¯èƒ½çš„æƒ…å†µæ˜¯ï¼Œè®°å½•å°‘äº 20 ä¸ªåŸŸï¼Œå› æ­¤è¿™ä¼šæ‰“å°ä¸€ä¸ªç©ºè¡Œã€‚è¿™é‡Œæœ‰å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œæ¥ç”¨å¦ä¸€ä¸ªè¡¨è¾¾å¼æ¥è®¡ç®—åŸŸåŸŸç¼–å·ï¼š

@example
awk '@{ print $(2*2) @}' mail-list
@end example

@command{awk} ä¼šå¯¹ @samp{(2*2)} è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œå¹¶ç”¨å…¶å€¼ä½œä¸ºåŸŸçš„ç¼–å·ï¼Œå¹¶æ‰“å°è¯¥åŸŸã€‚
@samp{*} ä»£è¡¨ä¹˜æ³•æ“ä½œï¼Œä¼šåœ¨ @samp{$} ä¹‹å‰å®Œæˆï¼›å½“åœ¨åŸŸç¼–å·è¡¨è¾¾å¼ä¸­æœ‰äºŒå…ƒæ“ä½œç¬¦
@footnote{@dfn{äºŒå…ƒæ“ä½œç¬¦}ï¼Œå¦‚æœ @samp{*} ç”¨äºä¹˜æ³•ï¼Œä¼šä½¿ç”¨ä¸¤ä¸ªæ“ä½œæ•°ã€‚ä¹‹æ‰€ä»¥è¦åšè¿™æ ·çš„åŒºåˆ†ï¼Œ
æ˜¯å› ä¸º @command{awk} ä¹Ÿæœ‰ä¸€å…ƒæ“ä½œç¬¦ï¼ˆåªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼‰ä»¥åŠä¸‰å…ƒæ“ä½œç¬¦ï¼ˆä¸‰ä¸ªæ“ä½œæ•°ï¼‰ã€‚}
å­˜åœ¨æ—¶ï¼Œè¿™éƒ½æ˜¯å¿…è¦çš„ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰“å° @file{mail-list} æ–‡ä»¶ä¸­æ¯ä¸€è¡Œä¸­å…³ç³»çš„ç±»å‹ï¼ˆç¬¬ 4 ä¸ªåŸŸï¼‰ã€‚
ï¼ˆæ‰€æœ‰çš„ @command{awk} æ“ä½œç¬¦éƒ½æŒ‰ç…§ä¼˜å…ˆçº§é™åºåˆ—å‡ºåœ¨ @ref{Precedence}ã€‚ï¼‰

å¦‚æœåŸŸç¼–å·æœ€ç»ˆè®¡ç®—ä¸º 0ï¼Œä½ å°±ä¼šå¾—åˆ°æ•´ä¸ªè®°å½•ã€‚å› æ­¤ï¼Œ@samp{$(2-2)} ä¸ @code{$0} çš„å€¼æ˜¯ä¸€æ ·çš„ã€‚
è´Ÿçš„åŸŸç¼–å·æ˜¯æ— æ•ˆçš„ï¼›è¿™ä¹ˆåšä¸€èˆ¬ä¼šå¯¼è‡´ç¨‹åºçš„ç»“æŸã€‚ï¼ˆPOSIX æ ‡å‡†æ²¡æœ‰å®šä¹‰åœ¨ä½¿ç”¨è´Ÿçš„åŸŸç¼–å·æ˜¯ä¼šäº§ç”Ÿä»€ä¹ˆæƒ…å†µã€‚
@command{gawk} ä¼šæ³¨æ„åˆ°è¿™æ ·çš„ä½¿ç”¨æ–¹å¼ï¼Œå¹¶ç»“æŸæ•´ä¸ªç¨‹åºã€‚å…¶ä»–çš„ @command{awk} å®ç°å¤„ç†æ–¹å¼å¯èƒ½ä¸åŒã€‚ï¼‰

å¦‚åœ¨ @ref{Fields} ä¸­æ‰€æåˆ°çš„ï¼Œ@command{awk} å°†å½“å‰è®°å½•çš„åŸŸæ•°ç›®å­˜å‚¨åœ¨å†…å»ºçš„å˜é‡ @code{NF} ä¸­ï¼ˆæŸ¥çœ‹ @ref{Built-in Variables}ï¼‰ã€‚
å› æ­¤ï¼Œ@code{$NF} è¡¨è¾¾å¼å…·æœ‰ä¸€ä¸ªç‰¹åˆ«çš„ç‰¹æ€§â€”â€”å°±æ˜¯ä¼šç›´æ¥å¯¹ @code{NF} æ±‚å€¼ï¼Œå¹¶å°†è¿™ä¸ªå€¼ä½œä¸ºåŸŸç¼–å·ã€‚

@node Changing Fields
@section æ›´æ”¹åŸŸå†…å®¹

@cindex fields, changing contents of
@command{awk} æ‰€çœ‹åˆ°çš„åŸŸå†…å®¹ï¼Œæ˜¯å¯ä»¥åœ¨ @command{awk} ç¨‹åºä¸­æ›´æ”¹çš„ï¼Œè¿™ä¼šæ›´æ”¹ @command{awk} èƒ½çœ‹åˆ°å½“å‰è¾“å…¥è®°å½•çš„ç»“æœã€‚ï¼ˆè¿™ä¸ªè¾“å…¥å®é™…ä¸Šè¿˜æ²¡æœ‰è¢«å¤„ç†ï¼›@command{awk} ä¸ä¼šä¿®æ”¹è¾“å…¥æ–‡ä»¶ã€‚ï¼‰è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ä»¥åŠå®ƒçš„è¾“å‡ºï¼š

@example
$ @kbd{awk '@{ nboxes = $3 ; $3 = $3 - 10}
>        @kbd{print nboxes, $3 @}' inventory-shipped}
@print{} 25 15
@print{} 32 22
@print{} 24 14
@dots{}
@end example

@noindent
ä¸Šé¢çš„ç¨‹åºï¼Œé¦–å…ˆä¿å­˜ç¬¬ä¸‰ä¸ªåŸŸçš„åŸå§‹çš„å€¼åˆ°å˜é‡ @code{nboxes} ä¸­ã€‚
@samp{-} å·è¡¨ç¤ºç›¸å‡ï¼Œå› æ­¤ç¨‹åºé‡æ–°å¯¹ç¬¬ä¸‰ä¸ªåŸŸï¼Œå³ @code{$3} è¿›è¡Œèµ‹å€¼ä¸ºç¬¬ä¸‰ä¸ªåŸŸçš„åŸå§‹å€¼å‡ 10ï¼š
@samp{$3 - 10} ã€‚ï¼ˆæŸ¥çœ‹ @ref{Arithmetic Ops}.ï¼‰
ç„¶åæ‰“å°ç¬¬ä¸‰ä¸ªåŸŸçš„æ—§å€¼ä¸æ–°å€¼ï¼ˆåº“æˆ¿ä¸­æœ‰äººå‡ºé”™äº†ï¼Œå¯¼è‡´åœ¨ç›˜ç‚¹çº¢ç›’å­æ—¶å¯¼è‡´äº†ä¸ä¸€è‡´ã€‚ï¼‰

è¦ä½¿è¿™ä¸ªèƒ½å¤Ÿå·¥ä½œï¼Œåˆ™ @code{$3} çš„æ–‡ä»¶å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å€¼ï¼›è€Œå­—ç¬¦ä¸²ä¹Ÿå¿…é¡»è½¬æ¢æˆæ•°å€¼ä»¥è¿›è¡Œç®—æ³•è®¡ç®—ã€‚è€Œå‡æ³•æ‰€å¾—çš„ç»“æœä¹Ÿä¼šè½¬åŒ–æˆå­—ä¸²ï¼Œå¹¶æˆä¸ºç¬¬ä¸‰ä¸ªåŸŸçš„å€¼ã€‚
æŸ¥çœ‹ @ref{Conversion}ã€‚

å½“æŸä¸ªåŸŸçš„å€¼è¢«æ›´æ”¹äº†åï¼ˆå¦‚ @command{awk} æ‰€è§çš„ï¼‰ï¼Œè¾“å…¥è®°å½•çš„æ–‡æœ¬å°±ä¼šè¢«é‡æ–°è®¡ç®—ï¼Œä»¥å°†æ–°çš„åŸŸåŒ…å«åœ¨æ—§çš„åŸŸæ‰€åœ¨çš„ä½ç½®ã€‚
æ¢å¥è¯è¯´ï¼Œ@code{$0} ä¼šå˜æ›´ä»¥åæ˜ å˜åŒ–çš„åŸŸã€‚å› æ­¤ï¼Œè¿™ä¸ªç¨‹åºä¼šæ‰“å°è¾“å…¥æ–‡ä»¶çš„å¤æœ¬ï¼ŒåŒæ—¶ï¼Œæ¯è¡Œä¸­çš„ç¬¬äºŒä¸ªåŸŸä¼šå‡å» 10ï¼š

@example
$ @kbd{awk '@{ $2 = $2 - 10; print $0 @}' inventory-shipped}
@print{} Jan 3 25 15 115
@print{} Feb 5 32 24 226
@print{} Mar 5 24 34 228
@dots{}
@end example

ç»™åŸŸèŒƒå›´ä¹‹å¤–çš„åŸŸèµ‹å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¦‚ï¼š

@example
$ @kbd{awk '@{ $6 = ($5 + $4 + $3 + $2)}
> @kbd{       print $6 @}' inventory-shipped}
@print{} 168
@print{} 297
@print{} 301
@dots{}
@end example

@cindex adding, fields
@cindex fields, adding
@noindent
æˆ‘ä»¬åœ¨ä¸Šé¢åˆ›å»ºäº† @code{$6}ï¼Œå®ƒçš„å€¼åæ˜ äº†åŸŸ @code{$2}ï¼Œ@code{$3}ï¼Œ@code{$4} ä¸ @code{$5} çš„å’Œã€‚
@samp{+} ä»£è¡¨åŠ æ“ä½œã€‚å¯¹äºæ–‡ä»¶ @file{inventory-shipped} æ¥è¯´ï¼Œ@code{$6} è¡¨ç¤ºäº†ç‰¹å®šæœˆä»½ä¸­ï¼Œå·²ç»å‘é€çš„åŒ…è£¹çš„æ€»æ•°ã€‚

åˆ›å»ºä¸€ä¸ªæ–°çš„åŸŸï¼Œä¼šæ”¹å˜ @command{awk} çš„é’ˆå¯¹å½“å‰çš„è¾“å…¥è®°å½•å†…éƒ¨å¤æœ¬ï¼Œä¹Ÿå°±æ˜¯ @code{$0} çš„å€¼ã€‚
å› æ­¤ï¼Œå¦‚æœä½ åœ¨æ·»åŠ äº†ä¸€ä¸ªåŸŸåæ‰§è¡Œ @samp{print $0}ï¼Œå¯¼è‡´è¾“å‡ºç»“æœä¹Ÿä¼šåŒ…æ‹¬æ–°çš„åŸŸï¼ŒåŒæ—¶ç›¸åº”æ•°é‡çš„åŸŸåˆ†éš”ç¬¦ä¼šæ’å…¥åˆ°å…¶æœ¬èº«ä¸å‰ä¸€ä¸ªå·²ç»å­˜åœ¨çš„åŸŸä¹‹é—´ã€‚

@cindex @code{OFS} variable
@cindex output field separator, See @code{OFS} variable
@cindex field separators, See Also @code{OFS}
è¿™æ ·çš„é‡æ–°è®¡ç®—æ—¢å— @code{NF} çš„å½±å“ï¼Œä¹Ÿä¼šå½±å“ @code{NF}ï¼ˆåŸŸæ•°é‡ï¼›æŸ¥çœ‹ @ref{Fields}ï¼‰ã€‚
å¦‚æœï¼Œ@code{NF} çš„å€¼è¢«è®¾ç½®æˆä½ åˆ›å»ºçš„åŸŸçš„æœ€å¤§å€¼ã€‚
@code{$0} çš„ç¡®åˆ‡æ ¼å¼ä¹ŸåŒæ ·å—ä¸€ä¸ªæœªè®¨è®ºçš„ç‰¹æ€§çš„å½±å“ï¼š
@dfn{è¾“å‡ºåŸŸåˆ†éš”ç¬¦}ï¼Œ@code{OFS}ï¼Œè¯¥åˆ†éš”ç¬¦ç”¨æ¥åˆ†éš”åŸŸï¼ˆæŸ¥çœ‹ @ref{Output Separators}ï¼‰ã€‚

ä½†æ˜¯ï¼Œä»…ä»…@emph{å‚è€ƒ}ä¸€ä¸ªåŸŸèŒƒå›´å¤–çš„åŸŸï¼Œå¹¶@emph{ä¸ä¼š}æ”¹å˜ @code{$0} çš„å€¼ï¼Œä¹Ÿ@emph{ä¸ä¼š}æ”¹å˜ @code{NF} çš„å€¼ã€‚å‚è€ƒèŒƒå›´ä¹‹å¤–çš„åŸŸä»…ä¼šäº§ç”Ÿä¸ªç©ºä¸²ï¼Œå¦‚ï¼š

@example
if ($(NF+1) != "")
    print "can't happen"
else
    print "everything is normal"
@end example

@noindent
ä¸Šé¢çš„ä¾‹å­åº”å½“æ‰“å° @samp{everything is normal}ï¼Œå› ä¸º @code{NF+1} ä¸€å®šä¼šè¶…è¿‡åŸŸèŒƒå›´ã€‚
ï¼ˆæŸ¥çœ‹ @ref{If Statement}ï¼Œæ¥è·å–å…³äº @command{awk} çš„ @code{if-else} è¯­å¥çš„æ›´å¤šä¿¡æ¯ã€‚
æŸ¥çœ‹ @ref{Typing and Comparison}ï¼Œæ¥è·å– @samp{!=} æ“ä½œç¬¦çš„æ›´å¤šä¿¡æ¯ã€‚ï¼‰

çŸ¥é“è¿™æ ·çš„äº‹å®ä¹Ÿéå¸¸é‡è¦ï¼šå¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„åŸŸèµ‹å€¼ä¼šæ”¹å˜ @code{$0} çš„å€¼ï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜ @code{NF} çš„å€¼ï¼Œå°±ç®—ä½ ç»™è¿™ä¸ªåŸŸèµ‹ç»™ä¸€ä¸ªç©ºä¸²ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{echo a b c d | awk '@{ OFS = ":"; $2 = ""}
>                       @kbd{print $0; print NF @}'}
@print{} a::c:d
@print{} 4
@end example

@noindent
ç›¸åº”çš„åŸŸè¿˜æ˜¯å­˜åœ¨çš„ï¼Œåªæ˜¯å…·æœ‰ä¸€ä¸ªç©ºå€¼ï¼Œåœ¨ @samp{a} ä¸ @samp{c} ä¹‹é—´ç”¨å†’å·è¿›è¡Œäº†åˆ†éš”ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºï¼Œå¦‚æœä½ åˆ›å»ºä¸€ä¸ªæ–°çš„åŸŸï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„æƒ…å†µï¼š

@example
$ @kbd{echo a b c d | awk '@{ OFS = ":"; $2 = ""; $6 = "new"}
>                       @kbd{print $0; print NF @}'}
@print{} a::c:d::new
@print{} 6
@end example

@noindent
ä¸­é—´çš„åŸŸï¼Œ@code{$5} ä¼šä»¥ç©ºå€¼åˆ›å»ºï¼ˆç”±ç¬¬äºŒå¯¹ç´§é‚»çš„å†’å·æŒ‡ç¤ºï¼‰ï¼Œ@code{NF} çš„å€¼åˆ™æ›´æ–°ä¸º 6ã€‚

@cindex dark corner, @code{NF} variable, decrementing
@cindex @code{NF} variable, decrementing
å‡å°‘ @code{NF} çš„å€¼ï¼Œå°†ä¼šå°†æ–°å€¼åé¢çš„åŸŸå…¨éƒ¨ä¸¢å¼ƒï¼Œå¹¶é‡æ–°è®¡ç®— @code{$0} çš„å€¼ã€‚
@value{DARKCORNER}
ä¸‹é¢æ˜¯è¿™æ ·çš„ä¾‹å­ï¼š

@example
$ @kbd{echo a b c d e f | awk '@{ print "NF =", NF;}
> @kbd{                          NF = 3; print $0 @}'}
@print{} NF = 6
@print{} a b c
@end example

@cindex portability, @code{NF} variable@comma{} decrementing
@quotation æ³¨æ„
ä¸€äº›ç‰ˆæœ¬çš„ @command{awk} å½“ @code{NF} é€’å‡æ—¶ä¸ä¼šé‡å»º @code{$0}ã€‚
@end quotation

æœ€ç»ˆï¼Œæœ‰æœºä¼šåœ¨åˆé€‚çš„æ—¶æœºå¼ºåˆ¶ @command{awk} åˆ©ç”¨å½“å‰çš„åŸŸä¸ @code{OFS} å€¼é‡æ–°æ•´ä¸ªè®°å½•ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œä½¿ç”¨ä¸‹é¢çœ‹èµ·æ¥æ²¡ç”¨çš„èµ‹å€¼è¯­å¥ï¼š

@example
$1 = $1   # force record to be reconstituted
print $0  # or whatever else with $0
@end example

@noindent
è¿™å¼ºåˆ¶ @command{awk} é‡å»ºè®°å½•ã€‚å¦‚è¿™é‡Œæ‰€ç¤ºï¼Œæ·»åŠ ç›¸åº”çš„æ³¨é‡Šæ˜¯æœ‰å¸®åŠ©çš„ã€‚

è¿™æ˜¯ @code{$0} ä¸è®°å½•ä¹‹é—´å…³ç³»çš„ç”ŸåŠ¨ä½“ç°ã€‚
ä»»ä½•å¯¹ @code{$0} çš„èµ‹å€¼éƒ½ä¼šå¯¼è‡´ @command{awk} åˆ©ç”¨@emph{å½“å‰}çš„ @code{FS} å€¼å¯¹è®°å½•è¿›è¡Œé‡æ–°åˆ†æã€‚
è¿™ä¹ŸåŒæ ·ä½¿ç”¨äºå†…å»ºçš„å‡½æ•°å¯¹äº @code{$0} çš„æ›´æ”¹ï¼Œä¾‹å¦‚ @code{sub()} ä»¥åŠ @code{gsub()}ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚

@sidebar ç†è§£ @code{$0}

è®°ä½ @code{$0} æ˜¯@emph{æ•´ä¸ª}è®°å½•è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼ŒçŸ¥é“ä»–æ˜¯é€šè¿‡è¾“å…¥è·å–çš„ï¼Œè¿™ä¸€ç‚¹ä¹ŸåŒæ ·é‡è¦ã€‚
å®ƒåŒ…å«ä»»ä½•çš„å‰å¯¼ä¸åç¼€çš„ç©ºç™½ç¬¦ï¼Œä¹Ÿå°±æ˜¯åˆ†éš”åŸŸçš„ç©ºç™½ç¬¦ï¼ˆæˆ–è€…å…¶ä»–çš„åˆ†éš”å­—ç¬¦ï¼‰ã€‚

é€šè¿‡ç®€å•åœ°è®¾ç½® @code{FS} æˆ–è€… @code{OFS} çš„å€¼æ¥æ”¹å˜åŸŸåˆ†éš”ç¬¦ï¼Œå¹¶æœŸæœ›ç®€å•çš„ @samp{print} æˆ–è€… @samp{print $0} æ‰“å°çš„æ—¶æ–°è®°å½•çš„å€¼ï¼Œ
æ˜¯ä¸ªå¸¸è§çš„é”™è¯¯ã€‚

ä½†æ˜¯è¿™ä¸ä¼šæœ‰ä½œç”¨ï¼Œå› ä¸ºå¯¹äºæ›´æ”¹è®°å½•æœ¬èº«ä»€ä¹ˆä¹Ÿæ²¡æœ‰åšã€‚ç›¸åçš„ï¼Œä½ å¿…é¡»å¼ºåˆ¶è®°å½•è¦è¿›è¡Œé‡å»ºï¼Œå…¸å‹çš„æƒ…å†µå°±æ˜¯åˆ©ç”¨å¦‚ @samp{$1 = $1} è¿™æ ·çš„è¯­å¥æ¥è§¦å‘ã€‚
@end sidebar


@node Field Separators
@section æŒ‡å®šè®°å½•å¦‚ä½•è¿›è¡Œåˆ†éš”

@menu
* Default Field Splitting::      How fields are normally separated.
* Regexp Field Splitting::       Using regexps as the field separator.
* Single Character Fields::      Making each character a separate field.
* Command Line Field Separator:: Setting @code{FS} from the command line.
* Full Line Fields::             Making the full line be a single field.
* Field Splitting Summary::      Some final points and a summary table.
@end menu

@cindex @code{FS} variable
@cindex fields, separating
@cindex field separators
@cindex fields, separating
@dfn{åŸŸåˆ†éš”ç¬¦}è¦ä¹ˆæ˜¯ä¸€ä¸ªå•ä¸ªå­—ç¬¦ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œ
ä»¥æ§åˆ¶ @command{awk} å°†è¾“å…¥è®°å½•åˆ†éš”æˆåŸŸã€‚@command{awk} æ‰«æè¾“å…¥è®°å½•çš„å­—ç¬¦åºåˆ—ä»¥åŒ¹é…åˆ†éš”ç¬¦ï¼›åŸŸåˆ™æ˜¯åŒ¹é…ä¹‹é—´çš„æ–‡æœ¬ã€‚

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å­å¼¹ç¬¦ï¼ˆ@bullet{}ï¼‰ä¸ªè¡¨ç¤ºè¾“å‡ºä¹‹é—´çš„ç©ºé—´ã€‚å¦‚æœåŸŸåˆ†éš”ç¬¦æ˜¯ @samp{oo} ç„¶åä¸‹é¢çš„è¡Œï¼š

@example
moo goo gai pan
@end example

@noindent
å°†è¢«åˆ†æˆä¸‰ä¸ªåŸŸï¼š@samp{m}ï¼Œ@samp{@bullet{}g}ï¼Œ and @samp{@bullet{}gai@bullet{}pan} ã€‚
æ³¨æ„ç¬¬äºŒä¸ªä¸ç¬¬ä¸‰ä¸ªåŸŸä¸­çš„å‰å¯¼ç©ºé—´ã€‚

@cindex troubleshooting, @command{awk} uses @code{FS} not @code{IFS}
åŸŸåˆ†éš”ç¬¦ç”±é¢„å®šä¹‰çš„å˜é‡ @code{FS} è¡¨ç¤ºã€‚
Shell ç¨‹åºå‘˜è¦æ³¨æ„ï¼š@command{awk} @emph{ä¸}ä½¿ç”¨ç”± POSIX å…¼å®¹ Shell
ï¼ˆä¾‹å¦‚ Unix Bourne shellï¼Œ@command{sh}ï¼Œæˆ–è€… Bashï¼‰ä½¿ç”¨çš„åå­— @code{IFS}ã€‚

@cindex @code{FS} variable, changing value of
@code{FS} çš„å€¼å¯ä»¥åœ¨ @command{awk} çš„ç¨‹åºå½“ä¸­ä½¿ç”¨èµ‹å€¼æ“ä½œç¬¦æ¥è¿›è¡Œæ”¹å˜ï¼Œ@samp{=} ï¼ˆæŸ¥çœ‹ @ref{Assignment Ops}ï¼‰ã€‚
ä¸€èˆ¬æ¥è¯´ï¼Œè¿›è¡Œèµ‹å€¼çš„æ­£ç¡®æ—¶æœºä¸€èˆ¬æ˜¯åœ¨æ‰§è¡Œçš„å¼€å§‹ï¼Œå¹¶åœ¨ä»»ä½•è®°å½•è¿˜æ²¡æœ‰è¢«å¤„ç†ä¹‹å‰ï¼Œå› æ­¤ç¬¬ä¸€æ¡è®°å½•ä¼šé€šè¿‡æ­£ç¡®çš„åˆ†éš”ç¬¦è¿›è¡Œå¤„ç†ã€‚
ä¸ºäº†å®ç°è¿™æ ·çš„èµ‹å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ @code{BEGIN} æ¨¡å¼ï¼ˆæŸ¥çœ‹ @ref{BEGIN/END}ï¼‰ã€‚
ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä¾‹å­å°† @code{FS} çš„å€¼è®¾ç½®æˆå­—ä¸² @code{","}ï¼š

@example
awk 'BEGIN @{ FS = "," @} ; @{ print $2 @}'
@end example

@cindex @code{BEGIN} pattern
@noindent
å¦‚æœè¾“å…¥çš„è¡Œä¸ºï¼š

@example
John Q. Smith, 29 Oak St., Walamazoo, MI 42139
@end example

@noindent
è¿™ä¸ª @command{awk} ç¨‹åºä¼šæå–å¹¶æ‰“å°å­—ä¸² @samp{@bullet{}29@bullet{}Oak@bullet{}St.} ã€‚

@cindex field separators, choice of
@cindex regular expressions as field separators
@cindex field separators, regular expressions as
æœ‰æ—¶ï¼Œè¾“å…¥æ•°æ®ä¸­åŒ…å«æœ‰åˆ†éš”ç¬¦ï¼Œå› æ­¤æ²¡æœ‰æŒ‰ä½ æ‰€é¢„æœŸçš„æ–¹å¼å¯¹æˆ–è€…åˆ†éš”ã€‚å¦‚ï¼Œåœ¨æˆ‘ä»¬åˆšæ‰ä½¿ç”¨çš„ä¾‹å­ä¸­ï¼Œäººåä¸­æœ‰å¯èƒ½æœ‰ç§°è°“æˆ–è€…åç¼€ï¼Œå¦‚ï¼š

@example
John Q. Smith, LXIX, 29 Oak St., Walamazoo, MI 42139
@end example

@noindent
åŒæ ·çš„ç¨‹åºï¼Œä¼šæå– @samp{@bullet{}LXIX} è€Œä¸æ˜¯ @samp{@bullet{}29@bullet{}Oak@bullet{}St.} ã€‚
å¦‚æœä½ é¢„æœŸå…¶æ‰“å°çš„æ˜¯åœ°å€ï¼Œä½ å°±ä¼šæ„Ÿè§‰åˆ°å¾ˆå¥‡æ€ªã€‚
ç»ˆææ–¹æ³•æ˜¯è¦ä»”ç»†é€‰æ‹©ä½ çš„æ•°æ®ç»“æ„å’Œåˆ†éš”ç¬¦ä»¥é¿å…è¿™æ ·çš„é—®é¢˜ã€‚
ï¼ˆå¦‚æœæœæ•°æ®çš„æ ¼å¼å¹¶ä¸å¥½å¤„ç†ï¼Œä¹Ÿå¯ä»¥å…ˆå°†å®ƒç”¨å¦ä¸€ä¸ªç¨‹åºå…ˆè¾“å‡ºæ¥è¿›è¡ŒæŸ¥çœ‹ã€‚ï¼‰


@node Default Field Splitting
@subsection æ ‡å‡†çš„åŸŸåˆ†éš”ç¬¦ç©ºç™½ç¬¦

@cindex newlines, as field separators
@cindex whitespace, as field separators
é€šå¸¸çš„æƒ…å†µä¸‹ï¼ŒåŸŸæ˜¯é€šè¿‡ç©ºç™½ç¬¦åºåˆ—è¿›è¡Œåˆ†éš”çš„ï¼ˆç©ºæ ¼ï¼ŒTABsï¼Œæˆ–è€…æ¢è¡Œç¬¦ï¼‰ï¼Œè€Œä¸æ˜¯é€šè¿‡å•ä¸ªç©ºæ ¼ã€‚
ä¸€è¡Œä¸­çš„ä¸¤ä¸ªè¿ç»­ç©ºæ ¼ä¸ä¼šåˆ†éš”å‡ºä¸€ä¸ªç©ºåŸŸã€‚åŸŸåˆ†éš”ç¬¦ @code{FS} çš„é»˜è®¤å€¼æ˜¯åŒ…å«ä¸€ä¸ªç©ºæ ¼çš„å­—ä¸²ï¼Œå³ @w{@code{" "}}ã€‚
å¦‚æœ @command{awk} å°†è¿™ä¸ªå€¼æŒ‰ç…§é€šå¸¸çš„æ–¹æ³•è§£é‡Šï¼Œæ¯ä¸ªç©ºæ ¼éƒ½ä¼šåˆ†éš”å‡ºä¸€ä¸ªåŸŸå‡ºæ¥ï¼Œä»è€Œå¯¼è‡´ä¸€è¡Œä¸­çš„è¿ç»­ä¸¤ä¸ªç©ºæ ¼ä¼šåœ¨ä»–ä»¬ä¹‹é—´äº§ç”Ÿä¸€ä¸ªç©ºåŸŸã€‚
æ²¡æœ‰äº§ç”Ÿè¿™ç§æƒ…å†µï¼Œæ˜¯å› ä¸º @code{FS} å€¼ä¸­çš„å•ä¸ªç©ºæ ¼æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µâ€”â€”å…¶ç”¨æ¥æŒ‡å®šåŸŸåˆ†éš”çš„é»˜è®¤æ–¹å¼ã€‚

å¦‚æœ @code{FS} æ˜¯å…¶ä»–çš„ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œå¦‚ @code{","}ï¼Œåˆ™æ¯ä¸€ä¸ªè¿™æ ·çš„å­—ç¬¦å‡ºç°ï¼Œéƒ½ä¼šåˆ†éš”å‡ºä¸¤ä¸ªåŸŸå‡ºæ¥ã€‚
ä¸¤ä¸ªè¿ç»­å‡ºç°ï¼Œå°±ä¼šåˆ†éš”å‡ºä¸€ä¸ªç©ºåŸŸã€‚å¦‚æœè¿™ä¸ªå­—ç¬¦å‡ºç°åœ¨å¼€å¤´æˆ–è€…ç»“å°¾ï¼Œä¹Ÿä¼šäº§ç”Ÿä¸€ä¸ªç©ºåŸŸã€‚
ç©ºæ ¼æ˜¯å”¯ä¸€ä¸€ä¸ªä¸æŒ‰è¿™ç§è§„åˆ™å¤„ç†çš„å­—ç¬¦ã€‚

@node Regexp Field Splitting
@subsection ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†éš”åŸŸ
@cindex regular expressions, as field separators
@cindex field separators, regular expressions as
å‰é¢çš„@value{SUBSECTION}è®¨è®ºäº†ä½¿ç”¨å•ä¸ªå­—ç¬¦æˆ–è€…ç®€å•ä¸²ä½œä¸º @code{FS} å€¼çš„æƒ…å†µã€‚æ›´é€šå¸¸çš„æƒ…å†µï¼Œ@code{FS} çš„å€¼å¯ä»¥åŒ…å«ä»»æ„çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸€æ¬¡åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼å°±ä¼šåˆ†éš”åŸŸã€‚å¦‚ä¸‹é¢çš„èµ‹å€¼ï¼š

@example
FS = ", \t"
@end example

@noindent
æ¯ä¸€ä¸ªè¾“å…¥è¡Œä¸­ï¼ŒåŒ¹é…é€—å·åé¢è·Ÿç€ä¸€ä¸ªç©ºæ ¼ä¸ä¸€ä¸ª TAB å­—ç¬¦çš„æ–‡æœ¬åŒºï¼Œéƒ½å°†æˆä¸ºä¸€ä¸ªåˆ†éš”ç¬¦ã€‚
@ifinfo
ï¼ˆ@samp{\t} æ˜¯ä¸€ä¸ª@dfn{è½¬ä¹‰åºåˆ—}ï¼Œä»£è¡¨ä¸€ä¸ª TAB å­—ç¬¦ï¼›æŸ¥çœ‹ @ref{Escape Sequences} å…³äºç±»ä¼¼çš„è½¬ä¹‰åºåˆ—çš„å®Œæ•´åˆ—è¡¨ã€‚ï¼‰
@end ifinfo

åœ¨ä¸€ä¸ªä¸æ˜¯å¤ªæ™®é€šçš„æ­£åˆ™è¡¨è¾¾å¼ä¾‹å­ä¸­ï¼Œä¼šå°è¯•ç”¨å•ä¸ªç©ºæ ¼æ¥åˆ†éš”åŸŸï¼Œä¸å•ä¸ªçš„é€—å·ä¸€æ ·çš„æ–¹å¼ã€‚
@code{FS} å¯ä»¥è¢«è®¾ç½®æˆ @w{@code{"[@ ]"}}ï¼ˆå·¦æ–¹æ‹¬å·ï¼Œç©ºæ ¼ï¼Œå³æ–¹æ‹¬å·ï¼‰ã€‚
è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼åªåŒ¹é…å•ä¸ªç©ºæ ¼è€Œä¸æ˜¯å…¶å®ƒçš„ï¼ˆæŸ¥çœ‹ @ref{Regexp}ï¼‰ã€‚

@samp{FS = @w{" "}}ï¼ˆå•ç©ºæ ¼ï¼‰ä¸ @samp{FS = @w{"[ \t\n]+"}}ï¼ˆåŒ¹é…ä¸€ä¸ªæˆ–è€…å¤šä¸ªç©ºæ ¼ï¼ŒTABs ä¸æ¢è¡Œç¬¦ï¼‰ä¹‹é—´å­˜åœ¨ä¸€ä¸ªé‡å¤§çš„å·®å¼‚ã€‚
å¯¹äº FS çš„ä¸¤ä¸ªå€¼ï¼ŒåŸŸéƒ½ä¼šè¢«è¿ç»­çš„ï¼ˆå‡ºç°å¤šä¸ªç›¸é‚»çš„ï¼‰ç©ºæ ¼ã€TABsã€ä¸æ¢è¡Œç¬¦åˆ†éš”ã€‚
ä½†æ˜¯ï¼Œå½“ @code{FS} çš„å€¼æ˜¯ @w{@code{" "}} æ—¶ï¼Œ@command{awk} é¦–å…ˆå°†è®°å½•çš„å‰åç©ºç™½ç¬¦éƒ½å»æ‰ï¼Œç„¶åæ‰å»å†³å®šåŸŸæ‰€åœ¨çš„åŒºåŸŸã€‚ä¾‹å¦‚ä¸‹é¢çš„ç®¡ç¨‹ä¼šæ‰“å° @samp{b} ï¼š

@example
$ @kbd{echo ' a b c d ' | awk '@{ print $2 @}'}
@print{} b
@end example

@noindent
ä½†æ˜¯è¿™ä¸ªç®¡ç¨‹ä¼šæ‰“å° @samp{a}ï¼ˆæ³¨æ„ä¸€ä¸‹åœ¨æ¯ä¸ªå­—æ¯å‰åä¸¤é¢å¤–ç©ºæ ¼ï¼‰ï¼š

@example
$ @kbd{echo ' a  b  c  d ' | awk 'BEGIN @{ FS = "[ \t\n]+" @}}
>                                  @kbd{@{ print $2 @}'}
@print{} a
@end example

@noindent
@cindex null strings
@cindex strings, null
@cindex empty strings, See null strings
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªåŸŸæ˜¯ nullï¼Œæˆ–è€…ç§°ä¸ºç©ºã€‚

ç•¥å»è®°å½•çš„å‰åç©ºç™½ç¬¦åœ¨ @code{$0} æ˜¯å¦‚æœä½•æ¥é‡æ–°è®¡ç®—ä¹Ÿä¼šæœ‰ä½œç”¨ã€‚å¦‚ï¼Œè€ƒå¯Ÿä¸‹é¢çš„ç®¡ç¨‹ï¼š

@example
$ @kbd{echo '   a b c d' | awk '@{ print; $2 = $2; print @}'}
@print{}    a b c d
@print{} a b c d
@end example

@noindent
ç¬¬ä¸€ä¸ª print è¯­å¥æ‰“å°å‡ºè¢«è¯»æ—¶çš„å†…å®¹ï¼Œå¹¶ä¸”å‰å¤´çš„ç©ºç™½æ˜¯ä¿ç•™äº†çš„ã€‚
å¯¹äº @code{$2} åŸŸçš„èµ‹å€¼ä¼šå¯¼è‡´ @code{$0} çš„é‡å»ºï¼Œå¹¶ä¸”å°† @code{$1} åˆ° @code{$NF} çš„è®°å½•åˆå¹¶åœ¨ä¸€èµ·ï¼Œ
ç›¸äº’ä¹‹é—´ç”¨ @code{OFS} çš„å€¼è¿›è¡Œåˆ†éš”ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯ç©ºæ ¼ï¼‰ã€‚
å› ä¸ºå‰å¯¼çš„ç©ºç™½åœ¨æŸ¥æ‰¾ @code{$1} æ—¶å·²ç»è¢«å¿½ç•¥äº†ï¼Œæ‰€ä»¥å®ƒä¸å†æ˜¯æ–°çš„ @code{$0} çš„ä¸€éƒ¨ä»½ã€‚
æœ€ç»ˆï¼Œæœ€åçš„ä¸€ä¸ª @code{print} è¯­å¥æ‰“å°çš„æ˜¯æ–°çš„ @code{$0}ã€‚

@cindex @code{FS}, containing @code{^}
@cindex @code{^} (caret), in @code{FS}
@cindex dark corner, @code{^}, in @code{FS}
ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åˆ†éš”è®°å½•æ—¶ï¼Œæœ‰ä¸€ä¸ªé¢å¤–çš„ç»†èŠ‚ä¹‹å¤„è¦äº†è§£ã€‚
è¿™åœ¨ POSIX æ ‡å‡†åœ¨æ²¡æœ‰ç¡®å®šï¼Œä¹Ÿåœ¨æ²¡å…¶ä»–åœ°æ–¹è¯´æ˜ï¼Œåˆ°åº• @samp{^} åœ¨åŸŸåˆ†éš”æ—¶è¡¨ç¤ºä»€ä¹ˆã€‚æ˜¯åªåŒ¹é…æ•´ä¸ªè®°å½•çš„å¼€å§‹ï¼Ÿè¿˜æ˜¯åŸŸåˆ†éš”å‡ºçš„æ–°ä¸²ï¼Ÿå› æ­¤ä¸åŒçš„ç‰ˆæœ¬çš„ @command{awk} å¯¹äºè¿™ä¸ªé—®é¢˜çš„å›ç­”ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ä½ ä¸è¦ä¾èµ–äºä½ çš„ç¨‹åºä¸­çš„ç‰¹å®šè¡Œä¸ºè¡¨ç°ã€‚
@value{DARKCORNER}

@cindex Brian Kernighan's @command{awk}
ä½œä¸ºæç¤ºä¿¡æ¯ï¼ŒBWK @command{awk} å…è®¸ @samp{^} åªåŒ¹é…è®°å½•çš„å¼€å¤´ã€‚
@command{gawk} ä¹Ÿè¿™ä¹ˆå¤„ç†ã€‚å¦‚ï¼š

@example
$ @kbd{echo 'xxAA  xxBxx  C' |}
> @kbd{gawk -F '(^x+)|( +)' '@{ for (i = 1; i <= NF; i++)}
> @kbd{                            printf "-->%s<--\n", $i @}'}
@print{} --><--
@print{} -->AA<--
@print{} -->xxBxx<--
@print{} -->C<--
@end example

@node Single Character Fields
@subsection å„å­—ç¬¦çš†ä¸ºåˆ†éš”ç¬¦

@cindex common extensions, single character fields
@cindex extensions, common@comma{} single character fields
@cindex differences in @command{awk} and @command{gawk}, single-character fields
@cindex single-character fields
@cindex fields, single-character
æœ‰é‚£ä¹ˆå‡ æ¬¡ï¼Œä½ å¯èƒ½æƒ³æµ‹è¯•ä¸€ä¸‹å•ç‹¬åœ°æ¯ä¸ªå­—ç¬¦ä½œä¸ºåˆ†éš”ç¬¦çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ
åœ¨ @command{gawk} ä¸­ä½ åªéœ€è¦ç®€å•åœ°å°†ç©ºä¸²ï¼ˆ@code{""}ï¼‰èµ‹å€¼ç»™ @code{FS} å³å¯ã€‚@value{COMMONEXT}
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè®°å½•ä¸­çš„æ¯ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦éƒ½å°†æˆä¸ºä¸€ä¸ªåˆ†éš”ç¬¦ã€‚å¦‚ï¼š

@example
$ @kbd{echo a b | gawk 'BEGIN @{ FS = "" @}}
>                  @kbd{@{}
>                      @kbd{for (i = 1; i <= NF; i = i + 1)}
>                          @kbd{print "Field", i, "is", $i}
>                  @kbd{@}'}
@print{} Field 1 is a
@print{} Field 2 is
@print{} Field 3 is b
@end example

@cindex dark corner, @code{FS} as null string
@cindex @code{FS} variable, as null string
ä¼ ç»Ÿä¸Šï¼Œ@code{FS} ç­‰äº @code{""} çš„è¡Œä¸ºå¹¶ä¸æ˜¯ç¡®å®šçš„ã€‚
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒUnix @command{awk} çš„å¤§å¤šæ•°ç‰ˆæœ¬åªæ˜¯ç®€å•åœ°å°†æ•´ä¸ªè®°å½•å½“åšä¸€ä¸ªåŸŸã€‚
@value{DARKCORNER}
åœ¨å…¼å®¹æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œå¦‚æœ @code{FS} æ˜¯ä¸€ä¸ªç©ºä¸²ï¼Œé‚£ä¹ˆ @command{gawk} ä¹Ÿä¼šæŒ‰ç…§ä¸Šé¢çš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚

@node Command Line Field Separator
@subsection ä»å‘½ä»¤è¡Œä¸­è®¾ç½® @code{FS}
@cindex @option{-F} option, command-line
@cindex field separator, on command line
@cindex command line, @code{FS} on@comma{} setting
@cindex @code{FS} variable, setting from command line

@code{FS} å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ @option{-F} é€‰é¡¹è¿›è¡Œè®¾ç½®ï¼Œå¦‚ï¼š

@example
awk -F, '@var{program}' @var{input-files}
@end example

@noindent
è®¾ç½® @code{FS} çš„å€¼ä¸º @samp{,}ï¼Œæ³¨æ„é€‰é¡¹ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå¤§å†™çš„ @samp{F}ï¼Œè€Œä¸æ˜¯å°å†™çš„ @samp{f}ã€‚
åè€… @option{-f} é€‰é¡¹æŒ‡å®šäº†åŒ…å« @command{awk} ç¨‹åºçš„æ–‡ä»¶ã€‚

å‚æ•° @option{-F} çš„èµ‹å€¼æ–¹å¼å’Œé¢„å®šä¹‰å‚æ•° @code{FS} çš„èµ‹å€¼æ–¹å¼å®Œå…¨ä¸€æ ·ã€‚
ä»»ä½•åœ¨åŸŸåˆ†éš”å­—ç¬¦ä¸­çš„ç‰¹æ®Šå­—ç¬¦éƒ½å¿…é¡»è¿›è¡Œé€‚å½“åœ°è½¬ä¹‰ã€‚
å¦‚ä½¿ç”¨ä¸€ä¸ª @samp{\} ç”¨ä½œä¸€ä¸ªåŸŸåˆ†éš”ç¬¦ï¼Œä½ éœ€è¦è¿™æ ·æ¥è¾“å…¥ï¼š

@example
# same as FS = "\\"
awk -F\\\\ '@dots{}' files @dots{}
@end example

@noindent
@cindex @code{\} (backslash), as field separator
@cindex backslash (@code{\}), as field separator
ç”±äº @samp{\} è¦åœ¨ shell ä¸­ç”¨å¼•å·å¼•èµ·æ¥ï¼Œ@command{awk} ä¼šçœ‹åˆ° @samp{-F\\}ã€‚
ä¹‹å @command{awk} ä¼šå¤„ç† @samp{\\} è½¬ä¹‰å­—ç¬¦ï¼Œ
ï¼ˆæŸ¥çœ‹ @ref{Escape Sequences}ï¼‰ï¼Œæœ€åï¼Œäº§ç”Ÿä¸€ä¸ªå•ç‹¬çš„ @samp{\} ç”¨ä½œåŸŸåˆ†éš”ç¬¦ã€‚

@c @cindex historical features
æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ä¾‹å­ï¼Œåœ¨å…¼å®¹æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ
å¦‚æœ @option{-F} çš„å‚æ•°æ˜¯ @samp{t}ï¼Œåˆ™ @code{FS} ä¼šè¢«è®¾ç½®æˆ TAB ç¬¦å·ã€‚
å¦‚æœä½ åœ¨ Shell ä¸­è¾“å…¥ @samp{-F\t}ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•è½¬ä¹‰ï¼Œåˆ™ @samp{\} ä¼šè¢«åˆ é™¤æ‰ã€‚
æ‰€ä»¥ï¼Œ@command{awk} ä¼šäº†è§£åˆ°ä½ æ˜¯çœŸçš„æƒ³ç”¨ TABs æ¥åˆ†éš”è®°å½•ï¼Œè€Œä¸æ˜¯ @samp{t} ã€‚
å¦‚æœä½ ç¡®å®æ˜¯è¦ç”¨ @samp{t} æ¥åˆ†éš”è®°å½•ï¼Œåˆ™åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ @samp{-v FS="t"} æˆ–è€… @samp{-F"[t]"} ã€‚
å¦‚æœä¸æ˜¯åœ¨å…¼å®¹æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ @samp{-F '\t'} æ¥æŒ‡å®š TABs æ¥åšåŸŸåˆ†éš”ç¬¦ã€‚

ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªåä¸º @file{edu.awk} çš„ç¨‹åºæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬äº† @code{/edu/} æ¨¡å¼ï¼Œ
ä»¥åŠåŠ¨ä½œ @samp{print $1}ï¼š

@example
/edu/   @{ print $1 @}
@end example

æˆ‘ä»¬å°† @code{FS} çš„å€¼è®¾ç½®æˆ @samp{-} å­—ç¬¦ï¼Œå¹¶æŠŠç¨‹åºè¿è¡Œåœ¨æ–‡ä»¶ @file{mail-list} ä¸Šã€‚
ä¸‹é¢çš„å‘½ä»¤æ‰“å°å‡ºé‚£äº›å·¥ä½œåœ¨å¤§å­¦æˆ–è€…åœ¨ä¸Šå¤§å­¦çš„äººçš„åå­—åˆ—è¡¨ï¼Œä»¥åŠä»–ä»¬ç”µè¯å·ç çš„å‰ä¸‰ä¸ªæ•°å­—ï¼š

@example
$ @kbd{awk -F- -f edu.awk mail-list}
@print{} Fabius       555
@print{} Samuel       555
@print{} Jean
@end example

@noindent
æ³¨æ„ç¬¬ä¸‰è¡Œè¾“å‡ºï¼Œç¬¬ä¸‰è¡Œå†…å®¹åœ¨åŸæ–‡ä»¶æ˜¯è¿™æ ·çš„ï¼š

@example
Jean-Paul    555-2127     jeanpaul.campanorum@@nyu.edu     R
@end example

@samp{-} æ˜¯äººåçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å´è¢«ç”¨æ¥ä½œäº†åŸŸåˆ†éš”ç¬¦ï¼Œè€Œä¸æ˜¯æŒ‰ç…§é¢„æƒ³çš„é‚£æ ·ç”¨ç”µè¯å·ç ä¸­çš„ @samp{-} æ¥åšåˆ†éš”ç¬¦ã€‚è¿™è¯´æ˜äº†ï¼Œä½ éœ€è¦ä»”ç»†åœ°é€‰æ‹©ä½ çš„åŸŸåˆ†éš”ç¬¦ã€‚

@cindex Unix @command{awk}, password files@comma{} field separators and
ä¹Ÿè®¸ï¼Œå¤§å¤šæ•°ä½¿ç”¨å•å­—ç¬¦ä½œä¸ºåŸŸåˆ†éš”çš„æƒ…å†µä¸‹å‡ºç°åœ¨å¤„ç† Unix ç³»ç»Ÿçš„å¯†ç æ–‡ä»¶ã€‚åœ¨è®¸å¤šçš„ Unix ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç”¨æˆ·åœ¨ç³»ç»Ÿçš„å¯†ç æ–‡ä»¶ä¸­éƒ½æœ‰ä¸€ä¸ªé¡¹ï¼Œä¸€è¡Œä¸€ç”¨æˆ·ã€‚è¿™äº›è¡Œä¸­çš„ä¿¡æ¯æ˜¯ç”¨å†’å·åˆ†éš”çš„ã€‚ç¬¬ä¸€ä¸ªåŸŸæ˜¯ç”¨æˆ·çš„ç™»å½•åï¼Œç¬¬äºŒé¡¹æ˜¯ç”¨æˆ·å·²ç»åŠ å¯†è¿‡çš„å¯†ç ï¼Œæˆ–è€…æ˜¯å½±å­å¯†ç ï¼ˆå½±å­å¯†ç å°±æ˜¯åœ¨ç¬¬äºŒä¸ªåŸŸä¸­ç”¨ @samp{x} ä»£æ›¿çš„å¯†ç ã€‚ï¼‰å¯†ç æ–‡ä»¶çš„é¡¹çœ‹èµ·æ¥å¯èƒ½å¦‚ä¸‹ï¼š

@cindex Robbins, Arnold
@example
arnold:x:2076:10:Arnold Robbins:/home/arnold:/bin/bash
@end example

ä¸‹é¢çš„ç¨‹åºæœç´¢ç³»ç»Ÿçš„å¯†ç æ–‡ä»¶å¹¶æœæ‰“å°é‚£äº›ç”¨æˆ·çš„å…¨åæ²¡æœ‰å­˜åœ¨çš„é¡¹ï¼š

@example
awk -F: '$5 == ""' /etc/passwd
@end example

@node Full Line Fields
@subsection ä¸€è¡Œå³ä¸€åŸŸ 

æœ‰æ—¶å€™ï¼Œå°†æ•´è¡Œå½“æˆä¸€ä¸ªåŸŸéå¸¸æœ‰ç”¨ï¼Œè¿™åªè¦ç®€å•åœ°å°† @code{FS} è®¾ç½®æˆ @samp{\n}ï¼ˆæ¢è¡Œç¬¦ï¼‰å³å¯ï¼Œè¿™ä¹Ÿæ˜¯å¯ç§»æ¤çš„ï¼š
@footnote{æ„Ÿè°¢ Andrew Schorr æ‰€åšçš„æç¤ºã€‚}

@example
awk -F'\n' '@var{program}' @var{files @dots{}}
@end example

@noindent
å½“ä½ è¿™ä¹ˆåšæ—¶ï¼Œ@code{$1} ä¸ @code{$0} ä¸€æ ·ã€‚

@sidebar æ”¹å˜ @code{FS} ä¸ä¼šå½±å“åŸŸ

@cindex POSIX @command{awk}, field separators and
@cindex field separator, POSIX and
æ ¹æ® POSIX æ ‡å‡†ï¼Œ@command{awk} çš„è¡Œä¸ºèµ·æ¥å°±å°±åƒè®°å½•åœ¨è¢«è¯»å–çš„æ—¶å€™å°±å·²ç»åˆ†éš”äº†ã€‚
è¿™æ„æ€å°±æ˜¯è¯´ï¼Œå¦‚æœä½ åœ¨è®°å½•è¯»å–åå†æ›´æ”¹ @code{FS} çš„å€¼ï¼ŒåŸŸçš„å€¼ï¼ˆå¦‚ä»–ä»¬å¦‚ä½•è¢«åˆ†å‰²ï¼‰åº”è¯¥åæ˜ çš„æ˜¯æ—§çš„ @code{FS} çš„æƒ…å†µï¼Œ
è€Œä¸æ˜¯æ–°çš„ã€‚

@cindex dark corner, field separators
@cindex @command{sed} utility
@cindex stream editors
ä½†æ˜¯ï¼Œè®¸å¤šçš„æ—§çš„ @command{awk} å®ç°ä¸æ˜¯è¿™ä¹ˆå¤„ç†çš„ã€‚
ç›¸åï¼Œè¿™äº›å®ç°æ˜¯å½“è¦ä½¿ç”¨åŸŸæ—¶ï¼Œæ‰å¼€å§‹è¿›è¡Œåˆ†å‰²ã€‚åŸŸä½¿ç”¨@emph{å½“å‰}çš„ @code{FS} å€¼æ¥è¿›è¡Œåˆ†å‰²ã€‚
@value{DARKCORNER}
è¿™ä¸ªè¡Œä¸ºå¾ˆéš¾è¿›è¡Œè¯†åˆ«ã€‚
ä¸‹é¢çš„ä¾‹å­è§£é‡Šäº†ä¸¤ç§æ–¹æ³•çš„å·®å¼‚ï¼š

@example
sed 1q /etc/passwd | awk '@{ FS = ":" ; print $1 @}'
@end example

@noindent
ä¸€èˆ¬éƒ½æ‰“å°ï¼š

@example
root
@end example

@noindent
è¿™æ˜¯åœ¨ä¸€ä¸ªä¸æ­£ç¡®çš„ @command{awk} å®ç°ä¸­çš„è¡Œä¸ºï¼Œè€Œ @command{gawk} åˆ™ä¼šæ‰“å°æ–‡ä»¶çš„ç¬¬ä¸€è¡Œçš„æ•´è¡Œï¼Œå¦‚ï¼š

@example
root:x:0:0:Root:/:
@end example

ï¼ˆsed å‘½ä»¤
@footnote{@command{sed} å·¥å…·ç§°ä¸ºâ€œæµç¼–è¾‘å™¨â€ã€‚å®ƒçš„è¡Œä¸ºä¹Ÿç”± POSIX æ ‡å‡†æ¥å®šä¹‰ã€‚}
æ‰“å°æ–‡ä»¶ @file{/etc/passwd} çš„ç¬¬ä¸€è¡Œã€‚ï¼‰
@end sidebar

@node Field Splitting Summary
@subsection åŸŸåˆ†å‰²æ€»ç»“ 

å½“ä½ ç»™ @code{FS} èµ‹å€¼ä¸ºä¸€ä¸ªå­—ä¸²å¸¸é‡çš„æ—¶å€™ï¼Œè¦è®°ä½è¿™ä¸ªéå¸¸é‡è¦ï¼Œå…¶ä¸ @command{awk} æ­£å¸¸çš„å­—ç¬¦å¤„ç†æ˜¯ä¸ä¸€æ ·çš„ã€‚
ä¾‹å¦‚ï¼šUnix @command{awk} ä¸ @command{gawk}ï¼Œè¿™æ ·çš„èµ‹å€¼ @samp{FS = "\.."} ä¼šå°† @code{".."} èµ‹å€¼ç»™ @code{FS}
ï¼ˆåæ–œæ ä¼šè¢«å»æ‰ï¼‰ã€‚
è¿™ä¸ªèµ‹å€¼åˆ›å»ºäº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¡¨ç¤ºâ€œåŸŸç”±ä¸¤ä¸ªå­—ç¬¦è¿›è¡Œåˆ†å‰²ã€‚â€
å¦‚æœä½ ç¡®å®æƒ³ç”¨ä¸€ä¸ªç‚¹å·ï¼ˆ@samp{.}ï¼‰åé¢è·Ÿä¸€ä¸ªå­—ç¬¦æ¥åˆ†å‰²åŸŸï¼Œä½¿ç”¨ @samp{FS = "\\.."}ã€‚

ä¸‹é¢æ˜¯åŸºäº @code{FS} çš„å€¼çš„åŸŸåˆ†å‰²çš„æ€»ç»“ï¼ˆ@samp{==} è¡¨ç¤ºç­‰äºï¼‰ï¼š

@table @code
@item FS == " "
åŸŸç”±è¿ç»­çš„ç©ºæ ¼è¿›è¡Œåˆ†å‰²ã€‚è®°å½•çš„å‰åçš„ç©ºç™½ä¼šè¢«å¿½ç•¥ã€‚è¿™æ˜¯é»˜è®¤åˆ†å‰²æ–¹å¼ã€‚

@item FS == @var{ä»»æ„å•ä¸ªå­—ç¬¦}
åŸŸç”±å•ä¸ªå­—ç¬¦è¿›è¡Œåˆ†å‰²ã€‚
å¤šä¸ªè¿ç»­çš„å­—ç¬¦ä¼šåˆ†å‰²å‡ºç©ºåŸŸï¼Œå¤´ã€å°¾çš„å‡ºç°ä¹Ÿä¸€æ ·ã€‚å­—ç¬¦ç”šè‡³å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦ï¼Œå¹¶ä¸”ä¹Ÿä¸éœ€è¦è¿›è¡Œè½¬ä¹‰ã€‚

@item FS == @var{regexp}
åŸŸç”±åŒ¹é… @var{regexp} çš„æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²è¿›è¡Œåˆ†å‰²ã€‚å‰ååŒ¹é…ä¼šåˆ†å‰²å‡ºç©ºå­—ç¬¦ã€‚

@item FS == ""
è®°å½•ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯åˆ†éš”ç¬¦ã€‚ï¼ˆè¿™æ˜¯ä¸€ä¸ªé€šç”¨æ‰©å±•ï¼›ä½†æ˜¯æ²¡æœ‰ç”± POSIX æ ‡å‡†å®šä¹‰ã€‚ï¼‰
@end table

@sidebar @code{FS} ä¸ @code{IGNORECASE}

@emph{ä»…ä»…}å½“åŸŸåˆ†å‰²ç¬¦ @code{FS} çš„å€¼æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œ@code{IGNORECASE} å˜é‡ï¼ˆæŸ¥çœ‹ @ref{User-modified}ï¼‰
ä¼šå½±å“åˆ°åˆ†å‰²ã€‚
å½“ @code{FS} æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦æ—¶ï¼Œåˆ™æ²¡æœ‰å½±å“ï¼Œå³ä½¿å­—ç¬¦æ˜¯ä¸€ä¸ªå­—æ¯ã€‚å› æ­¤ä¸‹é¢çš„ä»£ç ï¼š

@example
FS = "c"
IGNORECASE = 1
$0 = "aCa"
print $1
@end example

@noindent
è¾“å‡ºä¸º @samp{cCa}ã€‚
å¦‚æœä½ ç¡®å®æƒ³ç”¨å­—æ¯å­—ç¬¦æ¥åˆ†å‰²åŸŸè€Œå¿½ç•¥å¤§å°å†™ï¼Œå°±ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ç”±å®ƒæ¥ä¸ºä½ å¤„ç†è¿™æ ·çš„é—®é¢˜
ï¼ˆå¦‚ï¼Œ@samp{FS = "[c]"}ï¼‰ã€‚
åœ¨è¿™ä¸ªä¾‹å­ï¼Œ@code{IGNORECASE} ä¼šäº§ç”Ÿæ•ˆæœã€‚
@end sidebar


@node Constant Size
@section è¯»å–å›ºå®šå®½åº¦æ•°æ®

@cindex data, fixed-width
@cindex fixed-width data
@cindex advanced features, fixed-width data

@c O'Reilly doesn't like it as a note the first thing in the section.
æœ¬@value{SECTION}è®¨è®º @command{gawk} ä¸€ä¸ªé«˜çº§ç‰¹æ€§ã€‚å¦‚æœä½ æ˜¯ @command{awk} æ–°æ‰‹ï¼Œä½ å¯ä»¥ç¬¬ä¸€æ¬¡é˜…è¯»æ—¶è·³è¿‡ã€‚

@command{gawk} æä¾›äº†å¤„ç†å›ºå®šå®½åº¦åŸŸçš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦ç‰¹åˆ«çš„åŸŸåˆ†å‰²ç¬¦ã€‚
ä¾‹å¦‚ï¼Œè¿™ç§ç‰¹æ€§å¯èƒ½å‡ºç°åœ¨æ—§çš„ Fortran ç¨‹åºçš„è¾“å…¥æ•°æ®ä¸­ï¼Œå…¶ä¸­æ•°å­—éƒ½æ˜¯è¿ç»­å‡ºç°çš„ï¼›
æˆ–è€…æ˜¯å‡ºç°åœ¨ä¸€äº›ç¨‹åºçš„è¾“å‡ºç»“æœä¸­ï¼Œè¿™äº›ç¨‹åºçš„è®¾è®¡ä¸è€ƒè™‘å°†å®ƒçš„è¾“å‡ºç»“æœä½œä¸ºå…¶ä»–ç¨‹åºçš„è¾“å…¥æ•°æ®ã€‚

ä½œä¸ºåè€…çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯è¡¨ï¼Œå®ƒçš„æ¯ä¸€åˆ—é€šè¿‡åˆ©ç”¨å¯å˜çš„æ•°å­—æˆ–è€…ç©ºæ ¼æ¥å¯¹é½ï¼Œ@emph{ç©ºçš„åŸŸåˆ™å…¨æ˜¯ç©ºæ ¼}ã€‚
å¾ˆæ˜æ˜¾çš„ï¼Œ@command{awk} çš„ä¸€èˆ¬åŸŸåˆ†å‰²æ˜¯åŸºäº @code{FS} çš„å€¼ï¼Œä¸ä¼šåœ¨è¿™æ ·çš„ä¾‹å­ä¸­å·¥ä½œå¾—å¥½ã€‚
å°½ç®¡ä¸€ä¸ªå¯ç§»æ¤çš„ @command{awk} ç¨‹åºå¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—çš„ @code{substr()} è°ƒç”¨æ¥å¤„ç† @code{$0}ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ï¼Œåœ¨å¤„ç†æœ‰å¾ˆå¤šåŸŸï¼Œå¹¶ä¸”æ•°æ®é‡å·¨å¤§æ—¶ï¼Œè¿™æ˜¯ä¸€å¾ˆè¹©è„šä¹Ÿä½æ•ˆçš„æ–¹æ³•ã€‚

@cindex troubleshooting, fatal errors, field widths@comma{} specifying
@cindex @command{w} utility
@cindex @code{FIELDWIDTHS} variable
@cindex @command{gawk}, @code{FIELDWIDTHS} variable in
å°†è¾“å…¥è®°å½•åˆ†å‰²æˆå›ºå®šå®½åº¦çš„åŸŸï¼Œé€šè¿‡æŒ‡å®šä¸€ä¸ªåŒ…å«ç©ºæ ¼åˆ†å‰²çš„æ•°å­—åˆ°å†…å»ºå˜é‡ @code{FIELDWIDTHS} æ¥å®ç°ã€‚
æ¯ä¸€ä¸ªæ•°å­—è¡¨ç¤ºäº†åŸŸçš„å®½åº¦ï¼Œ@emph{åŒ…å«}äº†åŸŸä¹‹é—´çš„åˆ—ã€‚
å¦‚æœä½ æƒ³å¿½ç•¥åŸŸä¹‹é—´çš„åˆ—ï¼Œåˆ™å¯ä»¥æŒ‡å®šåˆ†ç¦»çš„åŸŸå®½åº¦ï¼Œåˆ™åé¢çš„å¤„ç†ä¼šå¿½ç•¥æ‰å®ƒã€‚æŒ‡å®šä¸€ä¸ªè´Ÿçš„åŸŸå®½æ˜¯ä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚
ä¸‹é¢çš„æ•°æ®æ˜¯ Unix å·¥å…· @command{w} çš„è¾“å‡ºã€‚è¿™ä¸ªç”¨æ¥æ¼”ç¤º @code{FIELDWIDTHS} çš„ä½¿ç”¨éå¸¸æœ‰ç”¨ï¼š

@example
@group
 10:06pm  up 21 days, 14:04,  23 users
User     tty       login@  idle   JCPU   PCPU  what
hzuo     ttyV0     8:58pm            9      5  vi p24.tex
hzang    ttyV3     6:37pm    50                -csh
eklye    ttyV5     9:53pm            7      1  em thes.tex
dportein ttyV6     8:17pm  1:47                -csh
gierd    ttyD3    10:00pm     1                elm
dave     ttyD4     9:47pm            4      4  w
brent    ttyp0    26Jun91  4:46  26:46   4:41  bash
dave     ttyq4    26Jun9115days     46     46  wnewmail
@end group
@end example

ä¸‹é¢çš„ç¨‹åºä½¿ç”¨ä¸Šé¢çš„è¾“å…¥ï¼Œå°†ç©ºé—²æ—¶é—´è½¬æ¢ä¸ºç§’æ•°ï¼Œå¹¶æ‰“å°è¾“å‡ºå¤´ä¸¤ä¸ªåŸŸå¹¶è®¡ç®—ç©ºé—²æ—¶é—´ï¼š

@example
BEGIN  @{ FIELDWIDTHS = "9 6 10 6 7 7 35" @}
NR > 2 @{
    idle = $4
    sub(/^ +/, "", idle)   # strip leading spaces
    if (idle == "")
        idle = 0
    if (idle ~ /:/) @{
        split(idle, t, ":")
        idle = t[1] * 60 + t[2]
    @}
    if (idle ~ /days/)
        idle *= 24 * 60 * 60

    print $1, $2, idle
@}
@end example

@quotation æç¤º
ä¸Šé¢çš„ç¨‹åºä½¿ç”¨äº†ä¸€äº› @command{awk} æˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰è®¨è®ºçš„ç‰¹æ€§ã€‚
@end quotation

æ‰§è¡Œä¸Šé¢çš„ç¨‹åºï¼Œäº§ç”Ÿäº†å¦‚ä¸‹è¾“å‡ºï¼š

@example
hzuo      ttyV0  0
hzang     ttyV3  50
eklye     ttyV5  0
dportein  ttyV6  107
gierd     ttyD3  1
dave      ttyD4  0
brent     ttyp0  286
dave      ttyq4  1296000
@end example

å¦ä¸€ä¸ªå›ºå®šå®½åº¦è¾“å…¥æ•°æ®ä¾‹å­ï¼ˆå¯èƒ½æ›´å¤æ‚ï¼‰æ˜¯æ¥è‡ªäºæŠ•ç¥¨ç«™ã€‚
åœ¨ç¾å›½çš„ä¸€äº›åœ°åŒºï¼ŒæŠ•ç¥¨è€…ä¼šå°†ä»–ä»¬çš„é€‰æ‹©åœ¨è®¡ç®—æœºå¡ä¸Šæ‰“ä¸Šå­”ã€‚
ç„¶åå¤„ç†è¿™äº›å¡ï¼Œä»è€Œç»Ÿè®¡ç‰¹å®šçš„å€™é€‰è€…æˆ–è€…ç‰¹å®šçš„é—®é¢˜ã€‚
ç”±äºæŠ•ç¥¨è€…å¯ä»¥ä¸é€‰æ‹©æŸäº›é—®é¢˜ï¼Œå› æ­¤å¡ä¸Šçš„æŸäº›åˆ—å¯èƒ½æ˜¯ç©ºçš„ã€‚
å¤„ç†è¿™ç±»æ•°æ®çš„ @command{awk} ç¨‹åºå¯ä»¥ä½¿ç”¨ @code{FIELDWIDTHS} ç‰¹æ€§æ¥ç®€åŒ–æ•°æ®çš„è¯»å–ã€‚
ï¼ˆå½“ç„¶ï¼Œè®© @command{gawk} é€‰æ‹©åœ¨é€‰ä¸¾å¡é˜…è¯»å™¨ä¸Šçš„ç³»ç»Ÿæ˜¯å¦ä¸€ä¸ªé—®é¢˜ï¼ï¼‰

@cindex @command{gawk}, splitting fields and
å‘ @code{FS} èµ‹å€¼ä¼šè®© @command{gawk} ä½¿ç”¨ @code{FS} æ¥è¿›è¡ŒåŸŸåˆ†å‰²ã€‚
ä½¿ç”¨ @samp{FS = FS} æ¥å®Œæˆè¿™æ ·çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦çŸ¥é“å½“å‰çš„ @code{FS} å€¼ã€‚
ä¸ºäº†äº†è§£å½“å‰æ­£åœ¨ä½¿ç”¨çš„åŸŸåˆ†å‰²ç­–ç•¥ï¼Œå¯ä»¥ä½¿ç”¨ @code{PROCINFO["FS"]}
ï¼ˆæŸ¥çœ‹ @ref{Auto-set}ï¼‰ã€‚
å¦‚æœæ˜¯å¸¸è§„çš„åˆ†å‰²ç­–ç•¥ï¼Œåˆ™è¿”å›çš„å€¼æ˜¯ @code{"FS"}ï¼Œ
å¦‚æœæ˜¯å›ºå®šå®½åº¦çš„åˆ†å‰²ç­–ç•¥åˆ™è¿”å›çš„æ˜¯ @code{"FIELDWIDTHS"}ï¼š

@example
if (PROCINFO["FS"] == "FS")
    @var{regular field splitting} @dots{}
else if  (PROCINFO["FS"] == "FIELDWIDTHS")
    @var{fixed-width field splitting} @dots{}
else
    @var{content-based field splitting} @dots{} @ii{(see next @value{SECTION})}
@end example

å½“è¦å†™ä¸€ä¸ªéœ€è¦ä¸´æ—¶æ”¹å˜ @code{FS} æˆ–è€… @code{FIELDWIDTHS} ç­–ç•¥çš„å‡½æ•°æ—¶ï¼Œ
è¿™ä¸ªåŠŸèƒ½åˆ™éå¸¸æœ‰ç”¨ã€‚è¿™ä¸ªå‡½æ•°è¯»ä¸€äº›è®°å½•åï¼Œç„¶åæ¢å¤åˆå§‹é…ç½®
ï¼ˆæŸ¥çœ‹ @ref{Passwd Functions}ï¼Œæœ‰è¿™ç§å‡½æ•°çš„ä¾‹å­ï¼‰ã€‚

@node Splitting By Content
@section ä»¥å†…å®¹å®šä¹‰åŸŸ

@c O'Reilly doesn't like it as a note the first thing in the section.
æœ¬@value{SECTION}ä¸­ï¼Œè®¨è®ºä¸€ä¸ª @command{gawk} çš„é«˜çº§ç‰¹æ€§ã€‚å¦‚æœä½ æ˜¯ä¸€ @command{awk} æ–°æ‰‹ï¼Œç¬¬ä¸€æ¬¡é˜…è¯»æ—¶ï¼Œä½ å¯ä»¥è·¯è¿‡è¿™ä¸€èŠ‚ã€‚

@cindex advanced features, specifying field content
é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½¿ç”¨ @code{FS} ç­–ç•¥æ—¶ï¼Œ@command{gawk} å°†åŸŸå®šä¹‰ä¸ºè®°å½•çš„ä¸€éƒ¨ä»½ï¼Œå®ƒä»¬å‡ºç°åœ¨æ¯ä¸ªåŸŸåˆ†å‰²ç¬¦ä¹‹é—´ã€‚
æ¢è¨€ä¹‹ï¼Œ@code{FS} å®šä¹‰äº†åŸŸ@emph{ä¸æ˜¯ä»€ä¹ˆ}ï¼Œè€Œä¸æ˜¯åŸŸ@emph{æ˜¯ä»€ä¹ˆ}ã€‚
ä½†æ˜¯ï¼Œæœ‰é‚£ä¹ˆä¸€äº›æ—¶å€™ï¼Œä½ ç¡®å®éœ€è¦æŒ‰ç…§åŸŸæ˜¯ä»€ä¹ˆæ¥å®šä¹‰å®ƒä»¬ï¼Œè€Œä¸æ˜¯å®ƒä»¬ä¸æ˜¯ä»€ä¹ˆæ¥å®šä¹‰ã€‚

æœ€è‡­çš„ä¾‹å­å°±æ˜¯æ‰€è°“çš„@dfn{é€—å·åˆ†éš”}æ•°æ®ï¼ˆCSVï¼‰ã€‚
è®¸å¤šçš„è¡¨å•ç¨‹åºï¼Œéƒ½å¯ä»¥å°†ä»–ä»¬çš„æ•°æ®è¾“å‡ºä¸ºæ–‡æœ¬æ–‡ä»¶ï¼Œ
è¿™äº›è®°å½•éƒ½ä»¥æ¢è¡Œç¬¦ç»“æŸï¼ŒåŒæ—¶é€šè¿‡é€—å·åˆ†éš”ã€‚
å¦‚æœåªæœ‰é€—å·æ¥åˆ†å‰²æ•°æ®ï¼Œè¿™ä¸ªå°±ä¸æ˜¯é—®é¢˜ã€‚
é—®é¢˜æ˜¯ï¼Œå½“å…¶ä¸­çš„æŸä¸ªåŸŸä¸­@emph{æœ‰}é€—å·æ—¶ã€‚
åœ¨è¿™æ ·çš„çŠ¶å†µä¸‹ï¼Œå¤§å¤šæ•°æ®çš„ç¨‹åºéƒ½å°†åŸŸç”¨åŒå¼•å·å¼•èµ·æ¥ã€‚
@footnote{CSV æ ¼å¼ç¼ºä¹æ­£å¼çš„æ ‡å‡†å®šä¹‰å¤šå¹´ï¼Œ
@uref{http://www.ietf.org/rfc/rfc4180.txt, RFC 4180} æ ‡å‡†åŒ–äº†å¤šæ•°çš„é€šç”¨å®è·µã€‚}
æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰å¦‚ä¸‹è¿™æ ·çš„æ•°æ®ï¼š

@example
@c file eg/misc/addresses.csv
Robbins,Arnold,"1234 A Pretty Street, NE",MyTown,MyState,12345-6789,USA
@c endfile
@end example

@cindex @command{gawk}, @code{FPAT} variable in
@cindex @code{FPAT} variable
@code{FPAT} å˜é‡ä¸ºè¿™æ ·çš„é—®é¢˜æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚@code{FPAT} çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å­—ä¸²ã€‚è¿™ä¸ªè¡¨è¾¾å¼æè¿°äº†æ¯ä¸ªåŸŸçš„å†…å®¹ã€‚

åœ¨ä¸Šé¢æ‰€åˆ—çš„ CSV æ•°æ®ä¸­ï¼Œ
æ¯ä¸ªåŸŸè¦ä¹ˆæ˜¯â€œä¸€åˆ‡éƒ½ä¸æ˜¯é€—å·ï¼Œâ€æˆ–è€…â€œä¸€ä¸ªåŒå¼•å·ï¼Œä¸€åˆ‡ä¸æ˜¯åŒå¼•å·ï¼Œä¸€ä¸ªé—­åŒå¼•å·ã€‚â€
å¦‚æœå†™è¿™æ ·çš„ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼ˆæŸ¥çœ‹ @ref{Regexp}ï¼‰ï¼Œ
æˆ‘ä»¬æœ‰è¿™æ ·çš„æ­£åˆ™è¡¨è¾¾å¼ @code{/([^,]+)|("[^"]+")/}ã€‚
æŠŠè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºå­—ç¬¦ä¸²ï¼Œéœ€è¦æˆ‘ä»¬è½¬ä¹‰å…¶ä¸­çš„åŒå¼•å·ï¼Œäºæ˜¯å®ƒå°±å˜æˆäº†è¿™æ ·ï¼š

@example
FPAT = "([^,]+)|(\"[^\"]+\")"
@end example

æ˜¯éª¡å­æ˜¯é©¬ï¼Œæ‹‰å‡ºæ¥æºœæºœï¼Œè¿™æ˜¯æ¥åˆ†æä¸Šé¢æ•°æ®çš„ç®€å•ç¨‹åºï¼š

@example
@c file eg/misc/simple-csv.awk
BEGIN @{
    FPAT = "([^,]+)|(\"[^\"]+\")"
@}

@{
    print "NF = ", NF
    for (i = 1; i <= NF; i++) @{
        printf("$%d = <%s>\n", i, $i)
    @}
@}
@c endfile
@end example

å½“è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š

@example
$ @kbd{gawk -f simple-csv.awk addresses.csv}
NF =  7
$1 = <Robbins>
$2 = <Arnold>
$3 = <"1234 A Pretty Street, NE">
$4 = <MyTown>
$5 = <MyState>
$6 = <12345-6789>
$7 = <USA>
@end example

æ³¨æ„å«åœ¨ @code{$3} é‡Œçš„é€—å·ã€‚

è¿™ç§å¤„ç† CSV æ•°æ®ç±»å‹çš„ç›´æ¥æå‡æ˜¯åœ¨åŒå¼•å·å‡ºç°æ—¶ï¼Œä¼šè‡ªåŠ¨ç§»é™¤å®ƒä»¬ï¼Œå¦‚åƒè¿™æ ·çš„ï¼š

@example
if (substr($i, 1, 1) == "\"") @{
    len = length($i)
    $i = substr($i, 2, len - 2)    # Get text within the two quotes
@}
@end example

ä¸ @code{FS} ä¸€èµ·ï¼Œ@code{IGNORECASE} å˜é‡ä¼šå½±å“ @code{FPAT} ç±»å‹çš„åŸŸåˆ†å‰²ç­–ç•¥
ï¼ˆæŸ¥çœ‹ @ref{User-modified}ï¼‰ã€‚

ç»™ @code{FPAT} èµ‹å€¼ï¼Œä¼šè¦†ç›– @code{FS} ä¸ @code{FIELDWIDTHS} ç­–ç•¥ã€‚
ä¸ @code{FIELDWIDTHS}, ä¸­çš„ @code{PROCINFO["FS"]} çš„å€¼ç±»ä¼¼ï¼Œ
å¦‚æœé‡‡ç”¨çš„æ˜¯åŸºäºå†…å®¹çš„åŸŸåˆ†å‰²ç­–ç•¥ï¼Œå…¶å€¼å°†æ˜¯ @code{"FPAT"}ã€‚

@quotation æç¤º
æœ‰ä¸€äº›ç¨‹åºè¾“å‡ºçš„ CSV æ•°æ®ä¼šåŒ…å«æ¢è¡Œç¬¦åœ¨åŒå¼•å·ä¹‹é—´ã€‚
@command{gawk} æ²¡åŠæ³•å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚å°±ç®—æ˜¯ç¬¦å·æ­£è§„çš„ CSV è§„èŒƒçš„æ•°æ®ï¼Œä¹Ÿæ— èƒ½ä¸ºåŠ›ã€‚
@code{FPAT} æœºåˆ¶ä¸ºå¤§å¤šæ•°æƒ…å½¢æä¾›äº†ä¸€ç§ä¼˜é›…çš„è§£å†³æ–¹æ³•ï¼Œ@command{gawk} çš„å¼€å‘è€…å¯¹æ­¤ä¹Ÿéå¸¸æ»¡æ„ã€‚
@end quotation

æ­£å¦‚æ‰€å†™çš„ï¼Œ@code{FPAT} æ‰€ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¦ç¤ºæ¯ä¸ªåŸŸåŒ…å«è‡³å°‘ä¸€ä¸ªå­—ç¬¦ã€‚ç›´æ¥æ›´æ”¹ï¼ˆæ›´æ”¹ç¬¬ä¸€ä¸ª @samp{+} ä¸º @samp{*}ï¼‰å…è®¸åŸŸå¯ä¸ºç©ºï¼š

@example
FPAT = "([^,]*)|(\"[^\"]+\")"
@end example

@c FIXME: 4/2015
@c Consider use of FPAT = "([^,]*)|(\"[^\"]*\")"
@c (star in latter part of value) to allow quoted strings to be empty.
@c Per email from Ed Morton <mortoneccc@comcast.net>

æœ€åï¼Œ@code{patsplit()} å‡½æ•°ä¹Ÿå®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œ
ç”¨æ¥å¯¹å¸¸è§„çš„å­—ç¬¦è¿›è¡Œåˆ†å‰²ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œ@command{gawk} æä¾›ä¸‰ç§ç‹¬ç«‹çš„æ–¹æ³•æ¥å°†è¾“å…¥è®°å½•åˆ†å‰²æˆè®°å½•ã€‚
è¿™äº›æœºåˆ¶é€šè¿‡ä¸‰ä¸ªå˜é‡æ¥å®ç°ï¼Œå³ @code{FS}ï¼Œ@code{FIELDWIDTHS}ï¼Œæˆ–è€… @code{FPAT}ï¼Œ
è°æœ€åè¢«èµ‹å€¼ï¼Œåˆ™é‡‡ç”¨ç›¸åº”çš„å¯¹åº”çš„æœºåˆ¶ã€‚

@node Multiple Line
@section å¤šè¡Œè®°å½•

@cindex multiple-line records
@cindex records, multiline
@cindex input, multiline records
@cindex files, reading, multiline records
@cindex input, files, See input files
åœ¨ä¸€äº›æ•°æ®ä¸­ï¼Œå•è¡Œæ— æ³•æ–¹ä¾¿åœ°åŒ…å«æ‰€æœ‰çš„ä¿¡æ¯åœ¨ä¸€ä¸ªé¡¹ä¸­ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å¤šè¡Œè®°å½•ã€‚å®ç°è¿™ä¸ªæ–¹å¼çš„ç¬¬ä¸€æ­¥æ˜¯é€‰æ‹©ä½ çš„æ•°æ®æ ¼å¼ã€‚

@cindex record separators, with multiline records
å…¶ä¸­ä¸€ä¸ªæŠ€å·§æ˜¯ä½¿ç”¨ä¸€ä¸ªä¸å¸¸ç”¨çš„å­—ç¬¦æˆ–è€…å­—ä¸²æ¥åˆ†å‰²æ•°æ®ã€‚
ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨æ¢é¡µç¬¦ï¼ˆåœ¨ @command{awk} ä¸­å†™æˆ @samp{\f}ï¼ŒåŒ C è¯­è¨€ï¼‰æ¥åˆ†å‰²ä»–ä»¬ï¼Œ
ä½¿å¾—æ¯ä¸ªè®°å½•æ˜¯æ–‡ä»¶ä¸­çš„ä¸€ä¸ªé¡µã€‚
æ¥ç€ï¼Œå°†å˜é‡ @code{RS} çš„å€¼è®¾ç½®æˆ @samp{\f}ï¼ˆåªåŒ…å«ä¸€ä¸ªæ¢é¡µç¬¦çš„å­—ä¸²ï¼‰ã€‚
ä»»æ„å…¶ä»–çš„å­—ç¬¦ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼Œåªè¦å®ƒä»¬ä¸æ˜¯è®°å½•æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚

@cindex @code{RS} variable, multiline records and
å¦ä¸€ä¸ªæŠ€å·§æ˜¯ç”¨ä¸€ä¸ªç©ºè¡Œæ¥åˆ†éš”è®°å½•ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„å€¼ï¼Œå³ä¸€ä¸ªç©ºä¸²èµ‹å€¼ç»™ @code{RS}ï¼Œ
ä»¥æç¤ºè®°å½•æ˜¯é€šè¿‡ä¸€ä¸ªæˆ–è€…å¤šä¸ªç©ºè¡Œæ¥è¿›è¡Œåˆ†éš”çš„ã€‚
å½“ @code{RS} è¢«è®¾ç½®æˆç©ºä¸²ï¼Œæ¯æ¡è®°å½•å°±æ˜¯ç»“æŸäºç¬¬ä¸€ä¸ªç©ºè¡Œã€‚ä¸‹ä¸€ä¸ªè®°å½•ç›´åˆ°åç»­é‡åˆ°çš„ç¬¬ä¸€ä¸ªéç©ºè¡Œå¼€å§‹ã€‚ä¸ç®¡åœ¨è¡Œä¸­å‡ºç°å¤šå°‘ç©ºè¡Œï¼Œå®ƒä»¬éƒ½å®é™…åˆ†éš”ä¸€ä¸ªè®°å½•ã€‚ï¼ˆç©ºè¡Œå¿…é¡»æ˜¯å®Œå…¨ç©ºçš„ï¼ŒåŒ…å«ç©ºæ ¼çš„ä¹Ÿä¸ç®—ã€‚ï¼‰

@cindex leftmost longest match
@cindex matching, leftmost longest
ä½ å¯ä»¥é€šè¿‡å°†ä¸² @code{"\n\n+"} èµ‹å€¼ç»™ @code{RS}ï¼Œå–å¾—ä¸ @samp{RS = ""} ä¸€æ ·çš„æ•ˆæœã€‚
è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è®°å½•ç»“å°¾ä¸€ä¸ªåˆ°å¤šä¸ªæ¢è¡Œç¬¦ã€‚
å¦å¤–ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ€»æ˜¯åŒ¹é…æœ€é•¿çš„å¯èƒ½åºåˆ—ï¼ˆæŸ¥çœ‹ @ref{Leftmost Longest}ï¼‰ã€‚
å› æ­¤ï¼Œä¸‹ä¸€ä¸ªè®°å½•å¼€å§‹äºåç»­çš„ç¬¬ä¸€ä¸ªéç©ºè¡Œï¼Œä¸ç®¡ä¸€è¡Œä¸­å‡ºç°å¤šå°‘çš„ç©ºè¡Œï¼Œä»–ä»¬éƒ½ä¼šè®¤ä¸ºæ˜¯ä¸€ä¸ªè®°å½•åˆ†éš”ç¬¦ã€‚

@cindex dark corner, multiline records
ä½†æ˜¯ï¼Œ@samp{RS = ""} ä¸ @samp{RS = "\n\n+"} ä¸¤è€…ä¹‹é—´æœ‰ä¸€ä¸ªé‡è¦çš„å·®åˆ«ã€‚
ç¬¬ä¸€ä¸ªæƒ…å½¢ä¸‹ï¼Œè¾“å…¥çš„@value{DF}çš„å‰å¯¼ç©ºè¡Œä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å¦‚æœæ–‡ä»¶çš„æœ€åä¸€æ¡è®°å½•åé¢æ²¡æœ‰é¢å¤–çš„ä¸€ä¸ªç©ºè¡Œï¼Œæœ€åçš„æ¢è¡Œç¬¦ä¼šè¢«ä»è®°å½•ä¸­åˆ é™¤ã€‚ä½†æ˜¯åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªç‰¹æ®Šå¤„ç†è¿‡ç¨‹ä¸ä¼šæ‰§è¡Œã€‚
@value{DARKCORNER}

@cindex field separator, in multiline records
@cindex @code{FS}, in multiline records
ç°åœ¨ï¼Œè¾“å…¥å·²ç»è¢«åˆ†å‰²æˆè®°å½•ï¼Œç¬¬äºŒæ­¥æ˜¯å°†è®°å½•åˆ†å‰²æˆåŸŸã€‚
ä¸€ç§æ–¹æ³•æ˜¯ç”¨é€šå¸¸çš„æ–¹å¼æ˜¯å°†è®°å½•åˆ†å‰²æˆåŸŸã€‚
åœ¨ä¸‹é¢è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ç§é»˜è®¤å¤„ç†æ–¹å¼ã€‚
å½“ @code{RS} è¢«è®¾ç½®æˆäº†ç©ºä¸²ï¼Œ@emph{å¹¶ä¸”} @code{FS} è¢«è®¾ç½®æˆå•ä¸ªå­—ç¬¦çš„æ—¶å€™ï¼Œæ¢è¡Œç¬¦æ€»æ˜¯è¢«ä½œä¸ºåŸŸåˆ†éš”ç¬¦ã€‚
æ— è®ºç”± @code{FS} åˆ†å‰²çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Œè¿™éƒ½ä¼šè¢«åŠ å…¥æœ€ç»ˆçš„åŸŸåˆ†å‰²ç»“æœé‡Œé¢ã€‚
@footnote{å½“ @code{FS} ä¸ºç©ºä¸²ï¼ˆ@code{""}ï¼‰æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ï¼Œ
è¿™ä¸ªç‰¹æ®Šçš„ç‰¹æ€§æ²¡æœ‰åº”ç”¨åœ¨ @code{RS} ä¸­ã€‚
ä½†æ˜¯å´å¯ä»¥åº”ç”¨åœ¨å½“åŸŸåˆ†éš”ç¬¦ä¸ºé»˜è®¤ç©ºæ ¼æ—¶ï¼š@samp{FS = @w{" "}} æƒ…å†µä¸­ã€‚}

è¿™ä¸ªç‰¹æ®Šçš„ä¾‹å¤–çš„åŸå§‹åŠ¨æœºå¯èƒ½æ˜¯ä¸ºäº†æä¾›åœ¨é»˜è®¤åœºæ™¯ä¸‹æœ‰ç”¨çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ @code{FS} ç­‰äº @w{@code{" "}} æ—¶ï¼‰ã€‚å½“
ä½ ç¡®å®ä¸æƒ³ç”¨æ¢è¡Œç¬¦æ¥åˆ†éš”åŸŸæ—¶ï¼Œè¿™ä¸ªç‰¹æ€§å¯èƒ½å°±ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºæ²¡æœ‰æ–¹æ³•å¯ä»¥é¿å…å®ƒã€‚
ä½†æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡ @code{split()} å‡½æ•°æ¥æ‰‹å·¥åˆ†è§£è®°å½•æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜
ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚
å¦‚æœä½ æœ‰ä¸€ä¸ªå•å­—ç¬¦çš„åŸŸåˆ†éš”ç¬¦ï¼Œä½ å¯ä»¥ç”¨å¦å¤–ä¸€ç§æ–¹å¼æ¥è§£å†³è¿™ä¸ªç‰¹æ€§å¸¦æ¥çš„é—®é¢˜ï¼Œåªéœ€è¦å°† @code{FS} è®¾ç½®æˆè¿™ä¸ªå•å­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚
ä¾‹å¦‚ï¼Œå¦‚æœåŸŸåˆ†éš”ç¬¦æ˜¯ä¸€ä¸ªç™¾å·ï¼Œè¦ä½¿ç”¨ @samp{FS = "%"}ï¼Œè€Œä¸è¦ä½¿ç”¨ @samp{FS = "[%]"}ã€‚

å¯¹åŸŸè¿›è¡Œåˆ†å‰²çš„å¦å¤–ä¸€ä¸ªæ–¹æ³•æ˜¯å°†æ¯ä¸ªåŸŸæ”¾åœ¨ä¸€ä¸ªè¡Œä¸­ï¼šä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œåªéœ€è¦å°†å˜é‡ @code{FS} è®¾ç½®æˆå­—ä¸² @code{"\n"}ã€‚
ï¼ˆè¿™ä¸ªå•å­—ç¬¦åˆ†éš”ç¬¦åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ï¼‰ä¸€ä¸ªå®é™…çš„ä»¥è¿™ç§æ–¹å¼è¿›è¡Œç»„ç»‡çš„@value{DF}å¯èƒ½å°±æ˜¯é‚®ä»¶åˆ—è¡¨ï¼Œ
åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­ï¼Œç©ºè¡Œç”¨æ¥åˆ†éš”é¡¹ç›®ã€‚è€ƒè™‘ä¸€ä¸ªåå­—ä¸º @file{addresses} çš„é‚®ä»¶åˆ—è¡¨ï¼Œçœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼š

@example
Jane Doe
123 Main Street
Anywhere, SE 12345-6789

John Smith
456 Tree-lined Avenue
Smallville, MW 98765-4321
@dots{}
@end example

@noindent
ä¸‹é¢åˆ™æ˜¯ä¸€ä¸ªå¤„ç†è¯¥æ–‡ä»¶çš„ç®€å•çš„ç¨‹åºï¼š

@example
# addrs.awk --- simple mailing list program

# Records are separated by blank lines.
# Each line is one field.
BEGIN @{ RS = "" ; FS = "\n" @}

@{
      print "Name is:", $1
      print "Address is:", $2
      print "City and State are:", $3
      print ""
@}
@end example

æ‰§è¡Œåï¼Œäº§ç”Ÿå¦‚ä¸‹çš„è¾“å‡ºï¼š

@example
$ @kbd{awk -f addrs.awk addresses}
@print{} Name is: Jane Doe
@print{} Address is: 123 Main Street
@print{} City and State are: Anywhere, SE 12345-6789
@print{}
@print{} Name is: John Smith
@print{} Address is: 456 Tree-lined Avenue
@print{} City and State are: Smallville, MW 98765-4321
@print{}
@dots{}
@end example

åœ¨ @ref{Labels Program}ï¼ŒæŸ¥çœ‹ä¸€ä¸ªæ›´å®é™…çš„ç¨‹åºæ¥å¤„ç†é‚®ä»¶åˆ—è¡¨ã€‚
ä¸‹é¢çš„åˆ—è¡¨æ€»ç»“äº†è®°å½•åŸºäº 
@ifinfo
@code{RS}
ï¼ˆ@samp{==} çš„æ„æ€æ˜¯â€œç­‰äºâ€ï¼‰
@end ifinfo
@ifnotinfo
@code{RS}
@end ifnotinfo
 çš„å€¼çš„è®°å½•åˆ†å‰²æ–¹å¼ï¼š

@table @code
@item RS == "\n"
è®°å½•é€šè¿‡æ¢æ¥ç¬¦æ¥è¿›è¡Œåˆ†å‰²ï¼ˆ@samp{\n}ï¼‰ã€‚
åœ¨æ•ˆæœä¸Šï¼Œ@value{DF}ä¸­çš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªè®°å½•ï¼ŒåŒ…æ‹¬ç©ºè¡Œã€‚è¿™æ˜¯é»˜è®¤è¡Œä¸ºã€‚

@item RS == @var{ä»»æ„å•ç‹¬å­—ç¬¦}
è®°å½•é€šè¿‡å­—ç¬¦æ¥è¿›è¡Œåˆ†å‰²ã€‚å¤šä¸ªè¿ç»­çš„å­—ç¬¦ä¼šåˆ†å‰²å‡ºç©ºè®°å½•ã€‚

@item RS == ""
è®°å½•é€šè¿‡ä¸€è¿ä¸²çš„ç©ºè¡Œè¿›è¡Œåˆ†å‰²ã€‚å½“ @code{FS} æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦æ—¶ï¼Œåˆ™æ¢è¡Œç¬¦æ€»ä¼šè¡¨ç°ä¸ºåŸŸåˆ†éš”ç¬¦ï¼Œ
ä¸ç®¡ @code{FS} æœ‰ä»€ä¹ˆæ ·çš„å€¼ã€‚æ–‡ä»¶çš„å¤´å°¾çš„æ¢è¡Œç¬¦ä¼šè¢«å¿½ç•¥æ‰ã€‚

@item RS == @var{regexp}
è®°å½•é€šè¿‡åŒ¹é… @var{regexp} æ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²æ¥è¿›è¡Œåˆ†å‰²ã€‚
æ–‡ä»¶å¤´å°¾çš„ç©ºè¡Œä¼šåˆ†å‰²å‡ºç©ºçš„è®°å½•ã€‚ï¼ˆè¿™æ˜¯ @command{gawk} çš„æ‰©å±•ï¼›åœ¨ POSIX ä¸­æ²¡æœ‰å¯¹è¿™ç§æƒ…å½¢è¿›è¡Œå®šä¹‰ã€‚ï¼‰
@end table

@cindex @command{gawk}, @code{RT} variable in
@cindex @code{RT} variable
å¦‚æœä¸æ˜¯åœ¨å…¼å®¹æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ
@command{gawk} è®¾ç½® @code{RT} çš„å€¼ä¸ºè¾“å…¥æ•°æ®ä¸­åŒ¹é…ç”± @code{RS} æŒ‡å®šçš„å€¼çš„æ–‡æœ¬ã€‚
ä½†æ˜¯ï¼Œå¦‚æœè¾“å…¥æ–‡ä»¶ç»“æŸè¾“å…¥è€Œæ²¡æœ‰åŒ¹é… @code{RS}ï¼Œåˆ™ @command{gawk} ä¼šå°† @code{RT} çš„å€¼è®¾ç½®æˆç©ºä¸²ã€‚

@node Getline
@section ç”¨ @code{getline} è¾“å…¥æ•°æ®

@cindex @code{getline} command, explicit input with
@cindex input, explicit
åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä» @command{awk} çš„ä¸»è¦è¾“å…¥æµä¸­è·å–æ•°æ®ï¼Œ
è¦ä¹ˆæ˜¯æ ‡å‡†è¾“å…¥ï¼ˆé€šå¸¸æ˜¯ä½ çš„é”®ç›˜ï¼Œæœ‰æ—¶æ˜¯å…¶ä»–ç¨‹åºçš„è¾“å‡ºï¼‰æˆ–è€…é€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šçš„æ–‡ä»¶ã€‚
@command{awk} è¯­è¨€æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å†…å»ºå‘½ä»¤ @code{getline} å¯ä»¥ç”¨æ¥æ˜¾å¼åœ°åœ¨ä½ çš„æ§åˆ¶ä¸‹è¯»å–è¾“å…¥ã€‚

@code{getline} å‘½ä»¤æœ‰å‡ ç§ä¸åŒçš„ä½¿ç”¨æ–¹å¼ï¼Œå¹¶ä¸”åˆå­¦è€…æœ€å¥½@emph{ä¸è¦}ä½¿ç”¨ã€‚
ä¸‹é¢çš„ @code{getline} ä½¿ç”¨ä¾‹å­ä»¥åŠç›¸åº”çš„è§£é‡ŠåŒ…æ‹¬äº†ä¸€äº›ç›®å‰è¿˜æ²¡æœ‰æ¶‰åŠçš„çŸ¥è¯†ã€‚
å› æ­¤ï¼Œå½“ä½ é˜…è¯»äº†
@ifinfo
æœ¬@value{DOCUMENT}
@end ifinfo
@ifhtml
æœ¬@value{DOCUMENT}
@end ifhtml
@ifnotinfo
@ifnothtml
çš„ç¬¬ä¸€ã€äºŒéƒ¨åˆ†
@end ifnothtml
@end ifnotinfo
çš„å‰©ä¸‹çš„éƒ¨åˆ†@emph{ä¹‹å}ï¼Œå†å›è¿‡å¤´æ¥å­¦ä¹  @code{getline} ï¼Œ
åˆ™ä½ ä¼šæ›´äº†è§£ @command{awk} æ˜¯å¦‚ä½•è¿›è¡Œå·¥ä½œçš„ã€‚

@cindex @command{gawk}, @code{ERRNO} variable in
@cindex @code{ERRNO} variable, with @command{getline} command
@cindex differences in @command{awk} and @command{gawk}, @code{getline} command
@cindex @code{getline} command, return values
@cindex @option{--sandbox} option, input redirection with @code{getline}

@code{getline} å‘½ä»¤æŸ¥çœ‹åˆ°ä¸€ä¸ªè®°å½•æ—¶åˆ™è¿”å› 1ï¼Œ å¦‚æœé‡åˆ°æ–‡ä»¶ç»“æŸæ—¶åˆ™è¿”å› 0ã€‚
å¦‚æœåœ¨è¯»å–æ•°æ®æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œå¦‚æ–‡ä»¶ä¸èƒ½è¢«æ‰“å¼€ï¼Œåˆ™ @code{getline} è¿”å› @minus{}1ã€‚
åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œ@command{gawk} å°†å˜é‡ @code{ERRNO} çš„å€¼è®¾ç½®æˆæ‰€é‡åˆ°çš„é”™è¯¯çš„æè¿°å­—ä¸²ã€‚

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ@var{command} ä»£è¡¨ shell å‘½ä»¤çš„å­—ä¸²å€¼ã€‚

@quotation æç¤º
å½“ @option{--sandbox} æŒ‡å®šæ—¶ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œä»æ–‡ä»¶ï¼Œç®¡é“æˆ–è€…å¹¶ç¨‹ ä¸­è¯»å–è¡Œæ•°æ®æ˜¯è¢«ç¦æ­¢çš„ã€‚
@end quotation

@menu
* Plain Getline::               Using @code{getline} with no arguments.
* Getline/Variable::            Using @code{getline} into a variable.
* Getline/File::                Using @code{getline} from a file.
* Getline/Variable/File::       Using @code{getline} into a variable from a
                                file.
* Getline/Pipe::                Using @code{getline} from a pipe.
* Getline/Variable/Pipe::       Using @code{getline} into a variable from a
                                pipe.
* Getline/Coprocess::           Using @code{getline} from a coprocess.
* Getline/Variable/Coprocess::  Using @code{getline} into a variable from a
                                coprocess.
* Getline Notes::               Important things to know about @code{getline}.
* Getline Summary::             Summary of @code{getline} Variants.
@end menu

@node Plain Getline
@subsection ä¸å¸¦å‚æ•°è°ƒç”¨ @code{getline}

@code{getline} å‘½ä»¤å¯ä»¥ä¸å¸¦å‚æ•°æ¥ä»å½“å‰æ–‡ä»¶ä¸­è¯»å–è¾“å…¥ã€‚
åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼Œå°±æ˜¯è¯»å–ä¸‹ä¸€ä¸ªè¾“å…¥è®°å½•å¹¶å°†å…¶åˆ†å‰²ä¸ºåŸŸã€‚å½“ä½ å·²ç»å®Œæˆå½“å‰è®°å½•çš„å¤„ç†ï¼Œ
ä½†æ˜¯å¯¹äºä¸‹ä¸€ä¸ªè®°å½•æƒ³@emph{é©¬ä¸Š}åšä¸€äº›å¤„ç†çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š

@example
# Remove text between /* and */, inclusive
@{
    if ((i = index($0, "/*")) != 0) @{
        out = substr($0, 1, i - 1)  # leading part of the string
        rest = substr($0, i + 2)    # ... */ ...
        j = index(rest, "*/")       # is */ in trailing part?
        if (j > 0) @{
            rest = substr(rest, j + 2)  # remove comment
        @} else @{
            while (j == 0) @{
                # get more text
                if (getline <= 0) @{
                    print("unexpected EOF or error:", ERRNO) > "/dev/stderr"
                    exit
                @}
                # build up the line using string concatenation
                rest = rest $0
                j = index(rest, "*/")   # is */ in trailing part?
                if (j != 0) @{
                    rest = substr(rest, j + 2)
                    break
                @}
            @}
        @}
        # build up the output line using string concatenation
        $0 = out rest
    @}
    print $0
@}
@end example

@c 8/2014: Here is some sample input:
@ignore
mon/*comment*/key
rab/*commen
t*/bit
horse /*comment*/more text
part 1 /*comment*/part 2 /*comment*/part 3
no comment
@end ignore

è¿™ä¸ª @command{awk} ç¨‹åºä»è¾“å…¥ä¸­åˆ é™¤ C é£æ ¼çš„æ³¨é‡Šï¼ˆ@samp{/* @dots{} */}ï¼‰ã€‚
å…¶ä¸­ç”¨åˆ°çš„ä¸€äº›ç‰¹æ€§æˆ‘ä»¬è¿˜æ²¡æœ‰è®²åˆ°ï¼ŒåŒ…æ‹¬å­—ä¸²åˆå¹¶
ï¼ˆæŸ¥çœ‹ @ref{Concatenation}ï¼‰ï¼Œ
ä»¥åŠ @code{index()}ï¼Œ@code{substr()} å†…å»ºå‡½æ•°ç­‰
ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚
é€šè¿‡æ›¿æ¢ @samp{print $0} ä¸ºå…¶ä»–çš„è¯­å¥ï¼Œä½ å¯ä»¥æ‰§è¡Œæ›´ä¸ºå¤æ‚çš„ä»è¾“å…¥ä¸­åˆ é™¤æ³¨é‡Šçš„å¤„ç†ï¼Œä¾‹å¦‚æœç´¢æ­£åˆ™è¡¨è¾¾å¼ç­‰ã€‚
ï¼ˆè¿™ä¸ªç¨‹åºæœ‰ä¸€ä¸ªå¾ˆå¾®å°çš„ç»†èŠ‚â€”â€”å°±æ˜¯å¦‚æœä¸€ä¸ªæ³¨é‡Šåœ¨æœ¬è¡Œç»“æŸï¼ŒåŒæ—¶åœ¨åŒä¸€è¡Œåˆå¼€å¯å¦ä¸€ä¸ªæ³¨é‡Šï¼Œè¿™ä¸ªç¨‹åºä¸ä¼šç”Ÿæ•ˆã€‚ï¼‰

è¿™ç§ä½¿ç”¨ @code{getline} çš„æ–¹å¼ï¼Œä¼šè®¾ç½® @code{$0} çš„ @code{NF}ï¼Œ@code{NR}ï¼Œ@code{FNR}ï¼Œ@code{RT} å˜é‡ã€‚

@quotation æç¤º
@code{$0} çš„æ–°å€¼ç”¨äºæµ‹è¯•æ¥æ‰€æœ‰æ¥ä¸‹æ¥çš„æ¨¡å¼ã€‚
@code{$0} åœ¨è§¦å‘æ‰§è¡Œ @code{getline} è°ƒç”¨çš„è§„åˆ™çš„æœ€åˆå§‹å°±ä¼šä¸¢å¤±ã€‚
å¦ä¸€æ–¹é¢ï¼Œ@code{next} è¯­å¥è¯»å–ä¸€ä¸ªæ–°çš„è®°å½•ï¼Œå¹¶ä¸”ç«‹å³ä»ç¨‹åºä¸­çš„ç¬¬ä¸€ä¸ªè§„åˆ™å¼€å§‹å¤„ç†å®ƒã€‚
æŸ¥çœ‹ @ref{Next Statement}ã€‚
@end quotation
@node Getline/Variable
@subsection å°† @code{getline} èµ‹å€¼ç»™å˜é‡
@cindex @code{getline} into a variable
@cindex variables, @code{getline} command into@comma{} using

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ @samp{getline @var{var}} å°†ä» @command{awk} çš„è¾“å…¥çš„ä¸‹ä¸€ä¸ªè®°å½•èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚
è¿™æ²¡æœ‰åšä»»ä½•é’ˆå¯¹æ•°æ®çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä¸‹ä¸€è¡Œæ˜¯ä¸€ä¸ªæ³¨é‡Šæˆ–è€…ä¸€ä¸ªç‰¹æ®Šå­—ä¸²ï¼Œä½ æƒ³è¯»å–å®ƒçš„åŒæ—¶ï¼Œä¸è§¦å‘ä»»ä½•è§„åˆ™ã€‚
è¿™ç§å½¢å¼çš„ @code{getline} è°ƒç”¨å¯ä»¥è®©ä½ è¯»å–è¡Œå¹¶ä¸”å°†å…¶å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œ
å› æ­¤ï¼Œä¸»å¾ªç¯ä¸­ read-a-line-and-check-each-ruleï¼ˆè¯»å–ä¸€è¡Œå¹¶æ£€æŸ¥æ¯ä¸ªè§„åˆ™ï¼‰çš„ @command{awk} å¾ªç¯å°±çœ‹ä¸åˆ°è¿™ä¸ªè®°å½•äº†ã€‚
ä¸‹é¢çš„ä¾‹å­äº¤æ¢è¾“å…¥ä¸­çš„ä¸¤è¡Œï¼š

@example
@{
     if ((getline tmp) > 0) @{
          print tmp
          print $0
     @} else
          print $0
@}
@end example

@noindent
ä¾‹å­ä¸­ä½¿ç”¨ä¸‹é¢çš„è¾“å…¥ï¼š

@example
wan
tew
free
phore
@end example

@noindent
å¹¶äº§ç”Ÿå¦‚ä¸‹çš„ç»“æœï¼š

@example
tew
wan
phore
free
@end example

è¿™ä¹ˆä½¿ç”¨ @code{getline} å‘½ä»¤ä»…è®¾ç½®å˜é‡ @code{NR}ï¼Œ@code{FNR} ä»¥åŠ @code{RT}ï¼ˆå½“ç„¶è¿˜æœ‰å˜é‡ @var{var}ï¼‰ã€‚
è®°å½•ä¸ä¼šè¢«åˆ†å‰²æˆåŸŸï¼Œå› æ­¤åŸŸçš„å€¼ï¼ˆåŒ…æ‹¬ @code{$0}ï¼‰ä»¥åŠ @code{NF} çš„å€¼éƒ½ä¸ä¼šæ”¹å˜ã€‚

@node Getline/File
@subsection ä½¿ç”¨ @code{getline} è¯»å–æ–‡ä»¶

@cindex @code{getline} from a file
@cindex input redirection
@cindex redirection of input
@cindex @code{<} (left angle bracket), @code{<} operator (I/O)
@cindex left angle bracket (@code{<}), @code{<} operator (I/O)
@cindex operators, input/output
ä½¿ç”¨ @samp{getline < @var{file}} æ¥ä» @var{file} ä¸­è¯»å–è®°å½•ã€‚
åœ¨è¿™é‡Œï¼Œ@var{file} æ˜¯ä¸€ä¸ªæ±‚å€¼ä¸ºå­—ä¸²çš„è¡¨è¾¾å¼ï¼Œå¹¶ç”¨å…¶æŒ‡å®š@value{FN}ã€‚
@samp{< @var{file}} ç§°ä¸ºé‡å®šå‘ï¼Œå› ä¸ºå®ƒå°†è¾“å…¥å®šå‘ä¸ºå¦ä¸€ä¸ªä¸åŒçš„ä½ç½®ã€‚
ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºå½“å®ƒé‡åˆ°ä»å½“å‰è¾“å…¥æ–‡ä»¶è¾“å…¥çš„è®°å½•ä¸­çš„ç¬¬ä¸€ä¸ªåŸŸçš„å€¼ä¸º 10 æ—¶ï¼Œ
åˆ™ä»æ–‡ä»¶ @file{secondary.input} ä¸­è¯»å–è¾“å…¥è®°å½•ï¼š
Here, @var{file} is a string-valued expression that

@example
@{
    if ($1 == 10) @{
         getline < "secondary.input"
         print
    @} else
         print
@}
@end example

ç”±äºä¸»è¾“å…¥æµæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå˜é‡ @code{NR} ä»¥åŠ @code{FNR} çš„å€¼æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚ä½†æ˜¯ï¼Œå®ƒæ‰€è¯»å–çš„è®°å½•ä¼šè¢«æ­£å¸¸åœ°åˆ†å‰²æˆåŸŸï¼Œ
å› æ­¤ @code{$0} ä»¥åŠå…¶ä»–åŸŸçš„å€¼æ˜¯ä¼šæ”¹å˜çš„ï¼Œå› æ­¤å¯¼è‡´ @code{NF} ä¸ @code{RT} çš„å€¼æ˜¯ä¼šæ”¹å˜çš„ã€‚

@cindex POSIX @command{awk}, @code{<} operator and
@c Thanks to Paul Eggert for initial wording here
æ ¹æ® POSIX æ ‡å‡†ï¼Œ@samp{getline < @var{expression}} å¦‚æœ @samp{$} ä¸­åŒ…å«æœªæ‹¬èµ·æ¥çš„é™¤ @samp{$} çš„æ“ä½œç¬¦æ—¶ï¼Œ
åˆ™ä¼šäº§ç”Ÿæ­§ä¹‰ã€‚ä¾‹å¦‚ @samp{getline < dir "/" file} å°±æ˜¯æœ‰æ­§ä¹‰çš„ï¼Œå› ä¸ºè¿æ¥æ“ä½œç¬¦
ï¼ˆè¿˜æœªè®¨è®ºåˆ°ï¼ŒæŸ¥çœ‹ @ref{Concatenation}ï¼‰æ˜¯æ²¡æœ‰è¢«æ‹¬èµ·æ¥çš„ã€‚
å¦‚æœä½ çš„ç¨‹åºè¦èƒ½å¤Ÿç§»æ¤åˆ°æ‰€æœ‰çš„ @command{awk} å®ç°ä¸­ï¼Œä½ åº”è¯¥è¿™ä¹ˆå†™ @samp{getline < (dir "/" file)}ã€‚

@node Getline/Variable/File
@subsection ä»æ–‡ä»¶ä¸­ @code{getline} åˆ°å˜é‡
@cindex variables, @code{getline} command into@comma{} using

ä½¿ç”¨ @samp{getline @var{var} < @var{file}} æ¥ä»æ–‡ä»¶ @var{file} ä¸­è¯»å–è¾“å…¥ï¼Œ
å¹¶ä¸”å°†å…¶å­˜æ”¾åœ¨å˜é‡ @var{var} ä¸­ã€‚å¦‚å‰æ‰€ç¤ºï¼Œæ–‡ä»¶ @var{file} æ˜¯ä¸€ä¸ªæ±‚å€¼ä¸ºå­—ä¸²çš„å˜é‡ï¼Œç»“æœä¸­åŒ…æ‹¬è¦è¢«è¯»å–çš„æ–‡ä»¶ã€‚

åœ¨è¿™ä¸ªç‰ˆæœ¬çš„ @code{getline} ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ªé¢„å®šä¹‰çš„å˜é‡ä¼šæ”¹å˜ï¼Œè®°å½•ä¹Ÿä¸ä¼šè¢«åˆ†å‰²æˆåŸŸã€‚
å”¯ä¸€æ”¹å˜çš„å°±æ˜¯ @var{var} å˜é‡ã€‚
@footnote{è¿™ä¸ªä¸å¤ªæ˜¯è¿™ä¹ˆå›äº‹ã€‚@code{RT} åœ¨ @code{RS} æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ—¶å¯èƒ½ä¼šæ”¹å˜ã€‚}
ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºå¤åˆ¶æ‰€æœ‰çš„è¾“å…¥æ–‡ä»¶åˆ°è¾“å‡ºï¼Œé™¤äº†å¦‚æœè®°å½•å†…å®¹ä¸º @w{@samp{@@include @var{filename}}}ã€‚
è¿™æ ·çš„è®°å½•ä¼šè¢«æ–‡ä»¶ @var{filename} æ›¿æ¢ï¼š

@example
@{
     if (NF == 2 && $1 == "@@include") @{
          while ((getline line < $2) > 0)
               print line
          close($2)
     @} else
          print
@}
@end example

æ³¨æ„è¿™é‡Œçš„å¦å¤–çš„è¾“å…¥æ–‡ä»¶çš„åå­—æ˜¯å¦‚ä½•æ„å»ºåˆ°ç¨‹åºä¸­çš„ï¼›
å®ƒæ˜¯ç›´æ¥ä»æ•°æ®ä¸­æ¥çš„ï¼Œé€šè¿‡ @code{@@include} è¡Œçš„ç¬¬ 2 ä¸ªåŸŸæ¥æŒ‡å®šçš„ã€‚

@code{close()} å‡½æ•°çš„è°ƒç”¨æ˜¯ä¸ºäº†ä¿è¯å¦‚æœ @code{@@include} åœ¨è¾“å…¥æ–‡ä»¶ä¸­å‡ºç°ä¸¤æ¬¡ï¼Œæ–‡ä»¶çš„å†…å®¹ä¹Ÿä¼šè¢«æŒ‡å®šä¸¤æ¬¡ã€‚
æŸ¥çœ‹ @ref{Close Files And Pipes}ã€‚

è¿™ä¸ªç¨‹åºçš„ä¸è¶³å°±æ˜¯ä¸èƒ½å¤„ç†å†…åµŒ @code{@@include} çš„æƒ…å†µ
ï¼ˆä¾‹å¦‚ï¼Œ@code{@@include} è¯­å¥åŒ…å«åœ¨è¢«åŒ…å«çš„æ–‡ä»¶ä¸­ï¼‰ï¼Œ
å¦‚ä¸€ä¸ªçœŸæ­£çš„å®å¤„ç†å™¨æ‰€æ‰§è¡Œçš„åŠŸèƒ½ã€‚åœ¨ @ref{Igawk Program}ï¼ŒæŸ¥çœ‹å¤„ç†å†…åµŒ @code{@@include} è¯­å¥çš„ç¨‹åºã€‚

@node Getline/Pipe
@subsection ä»ç®¡é“ä¸­ä½¿ç”¨ @code{getline} 

@c From private email, dated October 2, 1988. Used by permission, March 2013.
@cindex Kernighan, Brian
@quotation
@i{
å…¨çŸ¥å…¨èƒ½å¤ªé¥è¿œï¼Œè¿˜æ˜¯å…³æ³¨ç»†èŠ‚æ›´æœ‰ç”¨ã€‚
}
@author Brian Kernighan
@end quotation

@cindex @code{|} (vertical bar), @code{|} operator (I/O)
@cindex vertical bar (@code{|}), @code{|} operator (I/O)
@cindex input pipeline
@cindex pipe, input
@cindex operators, input/output
å‘½ä»¤çš„è¾“å…¥ä¹Ÿå¯ä»¥è¢«é€šè¿‡ä½¿ç”¨ @samp{@var{command} | getline} æ¥ä»¥ç®¡é“è¾“å‡ºç»™ @code{getline}ã€‚
åœ¨è¿™ç§æƒ…å½¢ä¸­ï¼Œ@var{command} æ˜¯ä¸€ä¸ª Shell å‘½ä»¤ï¼Œ
åŒæ—¶ï¼Œå®ƒçš„è¾“å‡ºä¼šè¢«ä»¥ç®¡é“å½¢å¼è¾“å‡ºç»™ @command{awk} æ¥ä½œä¸ºè¾“å…¥ã€‚è¿™ç§å½¢å¼çš„ @code{getline} ä»ç®¡é“ä¸­ä¸€æ¬¡è¯»å–ä¸€ä¸ªè®°å½•ã€‚
å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºå¤åˆ¶å®ƒçš„è¾“å…¥åˆ°è¾“å‡ºä¸­ï¼Œæ’é™¤é‚£äº›ä»¥ @samp{@@execute} å¼€å¤´çš„è¡Œï¼Œè¿™äº›è¡Œä¼šè¢«æ›¿æ¢ä¸ºå°†è¡Œçš„å‰©ä¸‹çš„å†…å®¹å½“åš Shell å‘½ä»¤æ‰§è¡Œæ—¶äº§ç”Ÿçš„è¾“å‡ºï¼š

@example
@{
     if ($1 == "@@execute") @{
          tmp = substr($0, 10)        # Remove "@@execute"
          while ((tmp | getline) > 0)
               print
          close(tmp)
     @} else
          print
@}
@end example

@noindent
@code{close()} å‡½æ•°ä¿è¯ä¸¤ä¸ªç›¸åŒçš„ @samp{@@execute} è¡Œï¼Œå‘½ä»¤ä¼šæ‰§è¡Œç›¸åº”æ¬¡æ•°ã€‚
@ifnottex
@ifnotdocbook
æŸ¥çœ‹ @ref{Close Files And Pipes}ã€‚
@end ifnotdocbook
@end ifnottex
@c This example is unrealistic, since you could just use system
å‡è®¾æœ‰ä¸‹é¢çš„è¾“å…¥ï¼š

@example
foo
bar
baz
@@execute who
bletch
@end example

@noindent
ç¨‹åºå¯èƒ½äº§ç”Ÿå¦‚ä¸‹çš„è¾“å‡ºï¼š

@cindex Robbins, Bill
@cindex Robbins, Miriam
@cindex Robbins, Arnold
@example
foo
bar
baz
arnold     ttyv0   Jul 13 14:22
miriam     ttyp0   Jul 13 14:23     (murphy:0)
bill       ttyp1   Jul 13 14:23     (murphy:0)
bletch
@end example

@noindent
æ³¨æ„è¿™ä¸ªç¨‹åºä¼šæ‰§è¡Œå‘½ä»¤ @command{who} ç„¶åæ‰“å°å‡ºç»“æœã€‚
ï¼ˆå¦‚æœä½ æµ‹è¯•è¿™ä¸ªç¨‹åºï¼Œä½ å¯èƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœï¼Œè¿™ä¾èµ–äºä½ æ‰€ç™»å…¥çš„ç³»ç»Ÿã€‚ï¼‰

è¿™æ ·çš„ @code{getline} å½¢å¼ä¼šå°†è®°å½•åˆ†å‰²æˆåŸŸï¼Œå¹¶è®¾ç½® @code{NF} çš„å€¼ï¼Œå¹¶é‡æ–°è®¡ç®— @code{$0} çš„å€¼ã€‚@code{NR} ä¸ @code{FNR} çš„å€¼ä¸ä¼šæ”¹å˜ï¼Œ@code{RT} çš„å€¼åˆ™ä¼šè¢«è®¾ç½®ã€‚

@cindex POSIX @command{awk}, @code{|} I/O operator and
@c Thanks to Paul Eggert for initial wording here
æ ¹æ® POSIX æ ‡å‡†ï¼Œ@samp{@var{expression} | getline} è¡¨è¾¾å¼ä¸­ï¼Œ
å¦‚æœ @var{expression} åŒ…å«äº†æœªè¢«æ‹¬èµ·æ¥çš„é™¤ @samp{$} ä¹‹å¤–çš„æ“ä½œç¬¦æ—¶ï¼Œåˆ™ä¼šæ˜¯æœ‰æ­§ä¹‰çš„ã€‚
ä¾‹å¦‚ï¼Œ@samp{@w{"echo "} "date" | getline} ç”±äºè¿æ¥æ“ä½œç¬¦æ²¡æœ‰è¢«æ‹¬èµ·æ¥ï¼Œ å› æ­¤è¿™ä¸ªè¯­å¥æ˜¯æœ‰æ­§ä¹‰çš„ã€‚
å¦‚æœä½ æƒ³ä½ çš„ç¨‹åºå¯ä»¥æœ‰ç§»æ¤åˆ°æ‰€æœ‰çš„ @command{awk} å®ç°é‡Œï¼Œä½ åº”è¯¥è¿™ä¹ˆå†™ï¼š @samp{(@w{"echo "} "date") | getline}ã€‚

@cindex Brian Kernighan's @command{awk}
@cindex @command{mawk} utility
@quotation æç¤º
ä¸å¹¸çš„æ˜¯ï¼Œ@command{gawk} åœ¨å¯¹å¾…åƒè¿™æ ·çš„ç»“æ„ @samp{@w{"echo "} "date" | getline} æ—¶æ˜¯ä¸ä¸€è‡´çš„ã€‚
å¤§å¤šæ•°çš„ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ç›®å‰çš„ç‰ˆæœ¬ï¼Œéƒ½å°†å…¶çœ‹æˆ @samp{@w{("echo "} "date") | getline}ã€‚
ï¼ˆè¿™ä¹Ÿæ˜¯ BWK @command{awk} çš„è¡Œä¸ºï¼‰
æœ‰ä¸€äº›ç‰ˆæœ¬åˆ™ä¼šå°†å…¶çœ‹æˆ @samp{@w{"echo "} ("date" | getline)}ã€‚ï¼ˆè¿™æ˜¯ @command{mawk} çš„è¡Œä¸ºï¼‰
ç®€å•åœ°è¯´ã€‚æ˜¾å¼åœ°ä½¿ç”¨æ‹¬å·ï¼Œå°±ä¸ç”¨æ‹…å¿ƒè¿™äº›é—®é¢˜ã€‚
@end quotation

@node Getline/Variable/Pipe
@subsection ä»ç®¡é“ä¸­ @code{getline} åˆ°å˜é‡
@cindex variables, @code{getline} command into@comma{} using

å½“ä½¿ç”¨ @samp{@var{command} | getline @var{var}} è¿™ç§å½¢å¼ï¼Œå³ @var{command} å‘½ä»¤çš„è¾“å‡ºé€šè¿‡ç®¡é“å‘é€ç»™ @code{getline}ï¼Œ
å¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡ @var{var} ä¸­ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºåˆ©ç”¨ @command{date} å·¥å…·ï¼Œ
è¯»å–å½“å‰çš„æ—¥æœŸä¸æ—¶é—´åˆ°å˜é‡ @code{current_time} ä¸­ï¼Œç„¶åæ‰“å°å®ƒï¼š

@example
BEGIN @{
     "date" | getline current_time
     close("date")
     print "Report printed on " current_time
@}
@end example

åœ¨è¿™ä¸ªç‰ˆæœ¬çš„ @code{getline} ä¸­ï¼Œæ²¡æœ‰ä»»ä½•é¢„å®šä¹‰çš„å˜é‡ä¼šæ”¹å˜ï¼Œè®°å½•ä¹Ÿä¸ä¼šåˆ†å‰²æˆåŸŸï¼Œä½†æ˜¯ @code{RT} ä¼šè¢«è®¾å®šã€‚

@ifinfo
@c Thanks to Paul Eggert for initial wording here
According to POSIX, @samp{@var{expression} | getline @var{var}} is ambiguous if
@var{expression} contains unparenthesized operators other than
@samp{$}; for example, @samp{@w{"echo "} "date" | getline @var{var}} is ambiguous
because the concatenation operator is not parenthesized. You should
write it as @samp{(@w{"echo "} "date") | getline @var{var}} if you want your
program to be portable to other @command{awk} implementations.
@end ifinfo

@node Getline/Coprocess
@subsection ä»å¹¶ç¨‹ä¸­ä½¿ç”¨ @code{getline}
@cindex coprocesses, @code{getline} from
@cindex @code{getline} command, coprocesses@comma{} using from
@cindex @code{|} (vertical bar), @code{|&} operator (I/O)
@cindex vertical bar (@code{|}), @code{|&} operator (I/O)
@cindex operators, input/output
@cindex differences in @command{awk} and @command{gawk}, input/output operators

ä»ç®¡é“ä¸­ @code{getline} è¯»å–è¾“å…¥æ˜¯å•å‘æ“ä½œã€‚
é€šè¿‡ @samp{@var{command} | getline} å¯åŠ¨çš„å‘½ä»¤ command åªä¼šå°†æ•°æ®å‘é€@emph{åˆ°}ä½ çš„ @command{awk} ç¨‹åºã€‚

æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šæƒ³å‘é€æ•°æ®åˆ°å¦ä¸€ä¸ªç¨‹åºç”¨äºå¤„ç†ï¼Œå¹¶å°†ç»“æœè¿”å›æ¥ã€‚
@command{gawk} å¯ä»¥å¯åŠ¨ä¸€ä¸ª@dfn{å¹¶ç¨‹}ï¼ŒåŒæ—¶å…è®¸åŒå‘é€šä¿¡ã€‚
è¿™æ˜¯é€šè¿‡ @samp{|&} æ“ä½œç¬¦æ¥å®ç°çš„ã€‚å…¸å‹çš„æƒ…å†µä¸­ï¼Œä½ é¦–å…ˆå°†æ•°æ®å†™åˆ°å¹¶ç¨‹ä¸­ï¼Œç„¶åå°†ç»“æœè¯»å–å›æ¥ï¼Œå¦‚ä¸‹é¢æ‰€ç¤ºï¼š

@example
print "@var{some query}" |& "db_server"
"db_server" |& getline
@end example

@noindent
ä¸Šé¢çš„ä¾‹å­ä¸­å°†è¯·æ±‚å‘é€åˆ° @command{db_server} ä¸­ç„¶åè¯»å–ç»“æœã€‚

@code{NR} ä¸ @code{FNR} çš„å€¼ä¸ä¼šå˜æ›´ï¼Œå› ä¸ºä¸»è¾“å…¥æµæ²¡æœ‰è¢«ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œè®°å½•ä¼šæŒ‰æ­£å¸¸æ–¹å¼åˆ†å‰²æˆåŸŸï¼Œå› æ­¤ä¼šæ”¹å˜ @code{$0} çš„å€¼ï¼Œå…¶ä»–åŸŸçš„å€¼ï¼Œä»¥åŠ @code{NF} è·Ÿ @code{RT} çš„å€¼ã€‚

å¹¶ç¨‹æ˜¯ä¸€ä¸ªé«˜çº§ç‰¹æ€§ã€‚åœ¨è¿™é‡Œè®¨è®ºæ˜¯å› ä¸ºè¿™@value{SECTION}è·Ÿ @code{getline} æœ‰å…³ã€‚
æŸ¥çœ‹ @ref{Two-way I/O}ï¼Œè¿™é‡Œå¹¶ç¨‹ä¼šæ›´è®¨è®ºå¾—æ›´æ·±å…¥ä¸€äº›ã€‚

@node Getline/Variable/Coprocess
@subsection ä½¿ç”¨å¹¶ç¨‹ @code{getline} åˆ°å˜é‡ 
@cindex variables, @code{getline} command into@comma{} using

å½“ä½ ä½¿ç”¨ @samp{@var{command} |& getline @var{var}}ï¼Œ
å¹¶ç¨‹ @var{command} çš„è¾“å‡ºä¼šé€šè¿‡ä¸€ä¸ªåŒå‘ç®¡æ–—ç®¡é“å‘é€åˆ° @code{getline} ä¸­ï¼Œå¹¶ä¿å­˜åœ¨å˜é‡ @var{var} ä¸­ã€‚

åœ¨è¿™ä¸ªç‰ˆæœ¬çš„ @code{getline} ä¸­ï¼Œæ²¡æœ‰ä»»ä½•é¢„å®šä¹‰çš„å˜é‡ä¼šæ”¹å˜ï¼Œè®°å½•ä¹Ÿä¸ä¼šåˆ†å‰²æˆåŸŸã€‚
å”¯ä¸€å˜åŒ–çš„æ˜¯å˜é‡ @var{var}ï¼Œä½†æ˜¯ @code{RT} çš„å€¼ä¼šè¢«è®¾å®šã€‚

@ifinfo
Coprocesses are an advanced feature. They are discussed here only because
this is the @value{SECTION} on @code{getline}.
@ref{Two-way I/O},
where coprocesses are discussed in more detail.
@end ifinfo

@node Getline Notes
@subsection å›é¡¾ @code{getline}
è¿™ä¸‹é¢æœ‰å‡ ç‚¹å…³äº @code{getline} çš„å†…å®¹éœ€è¦ç•™æ„ï¼š

@itemize @value{BULLET}
@item
å½“ @code{getline} æ”¹å˜äº† @code{$0} ä¸ @code{NF} çš„å€¼æ—¶ï¼Œ@command{awk} ä¸ä¼šè‡ªåŠ¨è·³åˆ°ç¨‹åºçš„å¼€å§‹å¹¶æµ‹è¯•æ–°çš„è®°å½•ä¸æ¨¡å¼ã€‚ä½†æ˜¯æ–°çš„è®°å½•ä¼šåŒ¹é…ä»»æ„ååç»­è§„åˆ™ã€‚

@cindex differences in @command{awk} and @command{gawk}, implementation limitations
@cindex implementation issues, @command{gawk}, limits
@cindex @command{awk}, implementations, limits
@cindex @command{gawk}, implementation issues, limits
@item
ä¸€äº›éå¸¸è€çš„ @command{awk} å®ç°é™åˆ¶äº† @command{awk} ç¨‹åºå¯ä»¥æ‰“å¼€çš„ç®¡çº¿çš„æ•°é‡å°±æ˜¯ 1 ä¸ªã€‚
åœ¨ @command{gawk} ä¸­ï¼Œæ²¡æœ‰è¿™æ ·çš„é™åˆ¶ã€‚ä½ å¯ä»¥æ‰“å¼€ä½ æƒ³è¦çš„åœ¨æ“ä½œç³»ç»Ÿé™åˆ¶ä¸‹çš„ç®¡çº¿ï¼ˆä»¥åŠå¹¶ç¨‹ï¼‰æ•°é‡ã€‚

@cindex side effects, @code{FILENAME} variable
@cindex @code{FILENAME} variable, @code{getline}@comma{} setting with
@cindex dark corner, @code{FILENAME} variable
@cindex @code{getline} command, @code{FILENAME} variable and
@cindex @code{BEGIN} pattern, @code{getline} and
@item
å¦‚æœä½ åœ¨ @code{BEGIN} è§„åˆ™ä¸­ä½¿ç”¨ @code{getline} è€Œæ²¡æœ‰é‡å®šå‘ç¬¦ï¼Œåˆ™ä¼šå‡ºç°ä¸€ä¸ªæœ‰è¶£çš„å‰¯ä½œç”¨ã€‚
ç”±äºä¸€ä¸ªæœªé‡å®šå‘çš„ @code{getline} ä¼šä»å‘½ä»¤è¡Œä¸­çš„æ•°æ®æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œ
ç¬¬ä¸€ä¸ª @code{getline} å‘½ä»¤ä¼šå¯¼è‡´ @command{awk} è®¾ç½® @code{FILENAME} çš„å€¼ã€‚
æ­£å¸¸æƒ…å†µä¸‹ã€‚@code{FILENAME} ä¸ä¼šåœ¨ @code{BEGIN} è§„åˆ™å†…æœ‰å€¼ï¼Œç”±äºä½ è¿˜æ²¡æœ‰å¼€å§‹å¤„ç†å‘½ä»¤è¡Œ@value{DF}ã€‚
@value{DARKCORNER}
ï¼ˆæŸ¥çœ‹ @ref{BEGIN/END} ä¸ @ref{Auto-set}ã€‚ï¼‰

@item
åœ¨ @code{getline} ä¸­ä½¿ç”¨ @code{FILENAME}ï¼ˆ@samp{getline < FILENAME}ï¼‰æœ‰å¯èƒ½å¯¼è‡´å›°æƒ‘ã€‚
@command{awk} åˆ©ç”¨å½“å‰æ–‡ä»¶æ‰“å¼€ä¸€ä¸ªç‹¬ç«‹çš„è¾“å…¥æµã€‚
ä½†æ˜¯ä¸é€šè¿‡ä½¿ç”¨å˜é‡ï¼Œ@code{$0} ä¸ @code{NF} çš„å€¼ä¹Ÿè¿˜ä¼šæ”¹å˜ã€‚
å¦‚æœä½ è¿™ä¹ˆåšï¼Œæœ‰å¯èƒ½æ˜¯å¶ç„¶ï¼Œä½ åº”è¯¥é‡æ–°è€ƒè™‘ä½ åˆ°åº•æƒ³è¦ä»€ä¹ˆç»“æœã€‚

@item
@ifdocbook
ä¸‹ä¸€@value{SECTION}ï¼Œ
@end ifdocbook
@ifnotdocbook
@ref{Getline Summary}ï¼Œ
@end ifnotdocbook
æä¾›äº† @code{getline} ä¸åŒå˜ä½“åŠåœ¨ç›¸åº”æƒ…å†µä¸‹å—å½±å“çš„å˜é‡çš„æ€»ç»“è¡¨ã€‚
ä¹Ÿå€¼å¾—æ³¨æ„ï¼Œé‚£äº›å˜ä½“ä¸ä½¿ç”¨é‡å®šå‘ï¼Œå¦‚æœå¯¼è‡´äº† @command{awk} é‡æ–°è¯»å–ä¸€ä¸ªæ–°çš„è¾“å…¥æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å¯¼è‡´ @code{FILENAME} çš„æ›´æ–°ã€‚

@item
@cindex Moore, Duncan
å¦‚æœæ­£åœ¨è¢«èµ‹å€¼çš„å˜é‡æ˜¯ä¸€ä¸ªå¸¦å‰¯æ•ˆåº”çš„è¡¨è¾¾å¼ï¼Œåˆ™ä¸åŒçš„ @command{awk} ç‰ˆæœ¬ä¼šæœ‰ä¸åŒçš„è¡¨ç°ã€‚
è¿™ä¾èµ–äºæ€æ ·ç¢°åˆ°â€œend-of-fileâ€ã€‚
ä¸€äº›ç‰ˆæœ¬ä¸­ä¸è¿™äº›è¡¨è¾¾å¼ä¸ç”Ÿæ•ˆï¼›è®¸å¤šç‰ˆæœ¬ï¼ˆåŒ…æ‹¬ @command{gawk}ï¼‰ä¼šç”Ÿæ•ˆã€‚
è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæ„Ÿè°¢Duncan Mooreï¼š

@ignore
Date: Sun, 01 Apr 2012 11:49:33 +0100
From: Duncan Moore <duncan.moore@@gmx.com>
@end ignore

@example
BEGIN @{
    system("echo 1 > f")
    while ((getline a[++c] < "f") > 0) @{ @}
    print c
@}
@end example

@noindent
è¿™é‡Œï¼Œå‰¯æ•ˆåº”æ˜¯ @samp{++c} ã€‚å¦‚æœæ–‡ä»¶ç»“æŸæ—¶ï¼Œ@code{c} æ˜¯å¦æ˜¯åœ¨ @code{a} çš„å…ƒç´ è¢«èµ‹å€¼ä¹‹å‰è¿›è¡Œé€’å¢ä¹ˆï¼Ÿ

@command{gawk} å°† @code{getline} æŒ‰ç…§å‡½æ•°è°ƒç”¨æ¥å¯¹å¾…ï¼Œå¹¶åœ¨å°è¯•è¯»å– @file{f} ä¹‹å‰å¯¹è¡¨è¾¾å¼ @samp{a[++c]} è¿›è¡Œæ±‚å€¼ã€‚
ä½†æ˜¯ï¼Œåœ¨ @command{awk} çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œå½“å®ƒçŸ¥é“æœ‰å­—ä¸²å€¼è¦è¿›è¡Œèµ‹å€¼æ—¶ï¼Œæ‰ä¼šå¯¹è¡¨è¾¾å¼æ±‚å€¼ã€‚
@end itemize

@node Getline Summary
@subsection @code{getline} å˜ä½“æ€»ç»“
@cindex @code{getline} command, variants

@ref{table-getline-variants} æ€»ç»“äº† @code{getline} çš„8ä¸ªå˜ä½“ï¼Œå¹¶åˆ—ä¸¾äº†åœ¨æ¯ç§å˜ä½“ä¸‹ä¼šè¢«è®¾ç½®çš„é¢„å®šä¹‰å˜é‡ï¼Œä»¥åŠå˜ä½“æ˜¯å¦æ˜¯ @command{gawk} çš„æ ‡å‡†æ‰©å±•ã€‚
æç¤ºï¼šå¯¹æ¯ä¸ªå˜ä½“ï¼Œ@command{gawk} éƒ½ä¼šè®¾ç½®é¢„å®šä¹‰å˜é‡ @code{RT}ã€‚

@float Table,table-getline-variants
@caption{@code{getline} å˜ä½“åŠå…¶è®¾ç½®çš„å˜é‡}
@multitable @columnfractions .33 .38 .27
@headitem Variant @tab Effect @tab @command{awk} / @command{gawk}
@item @code{getline} @tab Sets @code{$0}, @code{NF}, @code{FNR}, @code{NR}, and @code{RT} @tab @command{awk}
@item @code{getline} @var{var} @tab Sets @var{var}, @code{FNR}, @code{NR}, and @code{RT} @tab @command{awk}
@item @code{getline <} @var{file} @tab Sets @code{$0}, @code{NF}, and @code{RT} @tab @command{awk}
@item @code{getline @var{var} < @var{file}} @tab Sets @var{var} and @code{RT} @tab @command{awk}
@item @var{command} @code{| getline} @tab Sets @code{$0}, @code{NF}, and @code{RT} @tab @command{awk}
@item @var{command} @code{| getline} @var{var} @tab Sets @var{var} and @code{RT} @tab @command{awk}
@item @var{command} @code{|& getline} @tab Sets @code{$0}, @code{NF}, and @code{RT} @tab @command{gawk}
@item @var{command} @code{|& getline} @var{var} @tab Sets @var{var} and @code{RT} @tab @command{gawk}
@end multitable
@end float

@node Read Timeout
@section å¸¦è¶…æ—¶çš„è¾“å…¥è¯»å–
@cindex timeout, reading input

@cindex differences in @command{awk} and @command{gawk}, read timeouts
æœ¬@value{SECTION}è®¨è®ºçš„ç‰¹æ€§æ˜¯ @command{gawk} æ‰€ç‹¬æœ‰çš„ã€‚

åœ¨è¯»å–é”®ç›˜ä¸Šã€ç®¡é“ã€åŒå‘é€šä¿¡ï¼ŒåŒ…æ‹¬ TCP/IP å¥—æ¥å­—ä¸­è¯»å–è¾“å…¥çš„æ—¶å€™ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªä¸ºæ¯«ç§’å•ä½è¶…æ—¶æ—¶é—´ã€‚
è¿™å¯ä»¥åœ¨æ¯ä¸ªè¾“å…¥ï¼Œæ¯ä¸ªå‘½ä»¤æˆ–è€…æ¯ä¸ªè¿æ¥çš„åŸºç¡€ä¸Šæ¥æŒ‡å®šã€‚æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥æŒ‡å®š @code{PROCINFO} æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´ çš„å€¼æ¥å®ç°
ï¼ˆæŸ¥çœ‹ @ref{Auto-set}ï¼‰ï¼š

@example
PROCINFO["input_name", "READ_TIMEOUT"] = @var{timeout in milliseconds}
@end example

å¦‚æœè®¾ç½®äº†è¿™æ ·çš„æ—¶é—´ï¼Œ@command{gawk} è¶…æ—¶åï¼Œå¦‚æœæ²¡æœ‰åœ¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´å†…è¯»å–åˆ°æ•°æ®ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªå¤±è´¥çŠ¶æ€ã€‚
ä¾‹å¦‚ï¼ŒTCP å®¢æˆ·ç«¯å¯ä»¥åœ¨æŒ‡å®šæ—¶é—´åï¼Œå†³å®šæ˜¯æ”¾å¼ƒæ¥æ”¶ä»æœåŠ¡å™¨è¿”å›çš„å“åº”ã€‚

@example
Service = "/inet/tcp/0/localhost/daytime"
PROCINFO[Service, "READ_TIMEOUT"] = 100
if ((Service |& getline) > 0)
    print $0
else if (ERRNO != "")
    print ERRNO
@end example

ä¸‹é¢åˆ™æ˜¯ä» user é‚£é‡Œ
@footnote{è¿™é‡Œå‡è®¾æ ‡å‡†è¾“å…¥å°±æ˜¯é”®ç›˜ã€‚}
è¿›è¡Œäº¤äº’å¼è¯»å†™ï¼Œå¹¶ä¸”ä¸ç­‰å¾…è¶…è¿‡ 5 ç§’ï¼š

@example
PROCINFO["/dev/stdin", "READ_TIMEOUT"] = 5000
while ((getline < "/dev/stdin") > 0)
    print $0
@end example

å¦‚æœæ²¡æœ‰æ•°æ®è¾“å…¥ï¼Œ@command{gawk} ä¼šåœ¨ç­‰å¾…æŒ‡å®šçš„è¶…æ—¶æ—¶æœŸåï¼Œç»“æŸè¯»æ“ä½œï¼Œå¹¶è¿”å›å¤±è´¥ï¼Œ
åŒæ—¶è®¾ç½® @code{ERRNO} çš„å€¼ä¸ºæ°å½“çš„å€¼ã€‚è´Ÿå€¼æˆ–è€… 0 çš„è¶…æ—¶æ—¶é—´ï¼Œä¸ä¸æŒ‡å®šè¶…æ—¶æ—¶é—´ä¸€æ ·ã€‚

è¶…æ—¶æ—¶é—´ä¹Ÿå¯ä»¥è®¾ç½®åœ¨åœ¨æ˜¾å¼çš„å¾ªç¯ä¸­æ¥è¯»å–é”®ç›˜è¾“å…¥ï¼Œé€šè¿‡è¯»å–è¿™äº›è¾“å…¥æ¥å¯¹æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå¦‚ï¼š

@example
$ @kbd{gawk 'BEGIN @{ PROCINFO["-", "READ_TIMEOUT"] = 5000 @}}
> @kbd{@{ print "You entered: " $0 @}'}
@kbd{gawk}
@print{} You entered: gawk
@end example

åœ¨è¿™ä¸ªæƒ…å½¢ä¸‹ï¼Œå¦‚æœåœ¨5ç§’ä¹‹å†…ååº”å¤±è´¥ï¼Œä¼šå¯¼è‡´å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š

@example
@error{} gawk: cmd. line:2: (FILENAME=- FNR=1) fatal: error reading input file `-': Connection timed out
@end example

è¶…æ—¶æˆ–è€…å˜æ›´è¶…æ—¶å¯ä»¥åœ¨ä»»æ„æ—¶é—´ï¼Œå¹¶åœ¨ä¸‹æ¬¡ä»è¾“å…¥è®¾å¤‡ä¸­è¯»å–æ—¶äº§ç”Ÿæ•ˆæœã€‚
åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä» 1 ç§’å¼€å§‹ï¼Œå¹¶ä¸æ–­æŒ‰ 1/10 ç§’çš„æ—¶é—´é€’å‡ï¼Œç›´åˆ°æœ‰è¾“å…¥åˆ°è¾¾ï¼š

@example
PROCINFO[Service, "READ_TIMEOUT"] = 1000
while ((Service |& getline) > 0) @{
    print $0
    PROCINFO[Service, "READ_TIMEOUT"] -= 100
@}
@end example

@quotation æç¤º
ä½ ä¸å¯ä»¥å‡è®¾è¯»æ“ä½œåœ¨è¯»å–äº†ç¬¬ 10 ä¸ªè®°å½•åä¼šé˜»å¡ã€‚
æœ‰å¯èƒ½ @command{gawk} ç¬¬ä¸€æ¬¡è¯»å–æ—¶å°±è¯»å–äº†å¤šäºä¸€ä¸ªçš„è®°å½•å¹¶ç¼“å­˜èµ·æ¥ã€‚
å› ä¸ºè¿™ä¸ªåŸå› ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ”¹å˜è¶…æ—¶å€¼ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚
@end quotation

å¦‚æœ @code{PROCINFO} å…ƒç´ æ²¡æœ‰è®¾ç½®ï¼Œå¹¶ä¸” @env{GAWK_READ_TIMEOUT} ç¯å¢ƒå˜é‡å­˜åœ¨ï¼Œ
@command{gawk} ä¼šä½¿ç”¨è¿™ä¸ªå˜é‡çš„å€¼æ¥åˆå§‹åŒ–è¶…æ—¶å€¼ã€‚å”¯ä¸€åœ°ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥æŒ‡å®šè¶…æ—¶å€¼æœ‰è¿™æ ·çš„ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ä¸èƒ½å¤ŸæŒ‰ç…§æ¯å‘½ä»¤æˆ–è€…æ¯ä¸ªè¿æ¥åœ°è¿›è¡Œæ§åˆ¶ã€‚

@command{gawk} ä¼šè®¤ä¸ºè¶…æ—¶äº‹ä»¶æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚
å°±ç®—åç»­å¯¹äºè¾“å…¥è®¾å¤‡çš„è¯»å–æ˜¯æˆåŠŸçš„ã€‚è¿™æ˜¯ä¸€ä¸ªé™åˆ¶ï¼Œè¿™ä¹Ÿè¡¨ç¤ºä½ ä¸å¯ä»¥ç”¨è¿™ä¸ªæ¥å¤ç”¨ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„è¾“å…¥æºã€‚

èµ‹å€¼ä¸€ä¸ªè¶…æ—¶å€¼ï¼Œå¯ä»¥é¿å…è¯»æ“ä½œä¸€ç›´è¢«é˜»å¡ã€‚ä½†æ˜¯è¦è®°ä½ï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•æ¥ç­‰å¾…è¾“å…¥è®¾ç½®å‡†å¤‡å°±ç»ªã€‚ä¸€ä¸ªç½‘ç»œå®¢æˆ·ç«¯åœ¨å¯ä»¥è¯»å–æ•°æ®ä¹‹å‰å¯èƒ½éœ€è¦ç­‰å¾…å¾ˆé•¿çš„æ—¶é—´æ¥å»ºç«‹è¿æ¥ï¼Œæˆ–è€…è¦å¾ˆé•¿çš„æ—¶é—´æ¥æ‰“å¼€ FIFO ç‰¹æ®Šæ–‡ä»¶ä»¥è¿›è¡Œè¯»å–ï¼Œè¿™æ—¶ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çš„è¿›ç¨‹æ‰“å¼€è¿™ä¸ªç‰¹æ®Šæ–‡ä»¶å¹¶è¿›è¡Œå†™ã€‚

@node Command-line directories
@section å‘½ä»¤è¡Œä¸­çš„ç›®å½•
@cindex differences in @command{awk} and @command{gawk}, command-line directories
@cindex directories, command-line
@cindex command line, directories on

æ ¹æ® POSIX æ ‡å‡†ï¼Œåœ¨ @command{awk} å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„æ–‡ä»¶åå¿…é¡»æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼›å¦‚æœä¸æ˜¯åˆ™ä¼šæ˜¯ä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚
å¤§å¤šæ•° @command{awk} ç‰ˆæœ¬å°†å‘½ä»¤è¡Œä¸ŠæŒ‡å®šç›®å½•çœ‹æˆæ˜¯ä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚

åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ@command{gawk} åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šç›®å½•ä¼šäº§ç”Ÿä¸€ä¸ªå‘Šè­¦ï¼Œä½†æ˜¯ä¼šå¿½ç•¥å®ƒã€‚
è¿™è®©ä½ åœ¨ awk ç¨‹åºä¸­ä½¿ç”¨ shell é€šé…ç¬¦å˜å¾—æ›´å®¹æ˜“ï¼š

@example
$ @kbd{gawk -f whizprog.awk *}        @ii{Directories could kill this program}
@end example

å¦‚æœæŒ‡å®šäº† @option{--posix} æˆ–è€… @option{--traditional} é€‰é¡¹ï¼Œ
@command{gawk} åˆ™ä¼šå°†åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šç›®å½•è§†ä¸ºè‡´å‘½é”™è¯¯ã€‚

æŸ¥çœ‹ @ref{Extension Sample Readdir}ï¼Œæœ‰ä¸€ä¸ªæ–¹å¼æ¥åœ¨ @command{awk} ç¨‹åºå°†ç›®å½•è§†ä¸ºæœ‰ç”¨çš„æ•°æ®ã€‚

@node Input Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
æ ¹æ® @code{RS} çš„å€¼ï¼Œè¾“å…¥ä¼šè¢«åˆ†å‰²æˆè®°å½•ï¼Œå¯èƒ½å¦‚ä¸‹ï¼š

@multitable @columnfractions .25 .35 .40
@headitem Value of @code{RS} @tab Records are split on @dots{} @tab @command{awk} / @command{gawk}
@item Any single character @tab That character @tab @command{awk}
@item The empty string (@code{""}) @tab Runs of two or more newlines @tab @command{awk}
@item A regexp @tab Text that matches the regexp @tab @command{gawk}
@end multitable

@item
@code{FNR} è¡¨ç¤ºå·²ç»ä»å½“å‰è¾“å…¥æ–‡ä»¶ä¸­è¯»å–äº†å¤šå°‘è®°å½•ï¼Œ@code{NR} åˆ™è¡¨åˆ™ä»æ‰€æœ‰çš„æ–‡ä»¶æ€»è¯»å–äº†å¤šå°‘è®°å½•ã€‚

@item
@command{gawk} è®¾ç½® @code{RT} çš„å€¼ä¸ºé€šè¿‡ @code{RS} åŒ¹é…çš„æ–‡æœ¬ã€‚

@item
å°†è¾“å…¥åˆ†å‰²æˆè®°å½•åï¼Œ@command{awk} ä¼šè¿›ä¸€æ­¥å°†è®°å½•åˆ†å‰²æˆä¸åŒçš„åŸŸï¼Œç§°ä¸º @code{$1}ï¼Œ@code{$2} ç­‰ç­‰ã€‚
@code{$0} æ˜¯æ•´ä¸ªè®°å½•ï¼Œ@code{NF} è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªåŸŸã€‚é»˜è®¤çš„åˆ†å‰²åŸŸçš„æ–¹å¼æ˜¯åœ¨ç©ºç™½ç¬¦ä¹‹é—´çš„å­—ç¬¦ã€‚

@item
åŸŸå¯ä»¥é€šè¿‡å˜é‡æ¥è¿›è¡Œå‚è€ƒï¼Œå¦‚ @code{$NF}ã€‚åŸŸä¹Ÿå¯ä»¥è¢«èµ‹å€¼ï¼Œè¿™ä¼šå¯¼è‡´ @code{$0} å†æ¬¡è¢«ä½¿ç”¨æ—¶ï¼Œä¼šè¢«é‡æ–°è®¡ç®—ã€‚
å¯¹å¤§äº @code{NF} çš„å€¼çš„åŸŸè¿›è¡Œèµ‹å€¼å¯ä»¥åˆ›å»ºæ–°çš„åŸŸï¼Œå¹¶é‡å»ºè®°å½•ï¼Œé€šè¿‡ @code{OFS} æ¥åˆ†å‰²åŸŸã€‚
å¢å¤§ @code{NF} çš„å€¼ä¹Ÿäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚å‡å°‘ @code{NF} çš„å€¼ï¼Œä¼šä¸¢å¼ƒè¶…è¿‡ @code{NF} ä¹‹å¤–çš„åŸŸï¼Œå¹¶é‡å»ºè®°å½•ã€‚

@item
åŸŸåˆ†å‰²æ¯”è®°å½•åˆ†å‰²è¦å¤æ‚ä¸€äº›ï¼š

@multitable @columnfractions .40 .40 .20
@headitem Field separator value @tab Fields are split @dots{} @tab @command{awk} / @command{gawk}
@item @code{FS == " "} @tab On runs of whitespace @tab @command{awk}
@item @code{FS == @var{any single character}} @tab On that character @tab @command{awk}
@item @code{FS == @var{regexp}} @tab On text matching the regexp @tab @command{awk}
@item @code{FS == ""}  @tab Such that each individual character is a separate field @tab @command{gawk}
@item @code{FIELDWIDTHS == @var{list of columns}} @tab Based on character position @tab @command{gawk}
@item @code{FPAT == @var{regexp}} @tab On the text surrounding text matching the regexp @tab @command{gawk}
@end multitable

@item
ä½¿ç”¨ @samp{FS = "\n"} ä¼šä½¿æ•´ä¸ªè®°å½•æˆä¸ºä¸€ä¸ªåŸŸï¼ˆå‡è®¾ç”¨æ¢è¡Œç¬¦æ¥åˆ†éš”è®°å½•ï¼‰ã€‚

@item
@code{FS} å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹ @option{-F} è¿›è¡Œè®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œä¸­çš„å˜é‡èµ‹å€¼æ–¹å¼è¿›è¡Œè®¾ç½®ã€‚

@item
é€šè¿‡ @code{PROCINFO["FS"]} æ¥æŸ¥çœ‹æ­£åœ¨è¢«ç”¨äºè¿›è¡ŒåŸŸåˆ†å‰²çš„æ–¹å¼ã€‚

@item
ä½¿ç”¨ @code{getline} åŠå…¶ä¸åŒçš„æ ¼å¼æ¥ä»é»˜è®¤çš„è¾“å…¥æµä¹‹å¤–çš„æ–‡ä»¶ï¼Œç®¡é“æˆ–è€…å¹¶ç¨‹ç­‰åœ°æ–¹è¯»å–è®°å½•ã€‚

@item
ä½¿ç”¨ @code{PROCINFO[@var{file}, "READ_TIMEOUT"]} æ¥å¯¹ä» @var{file} æ–‡ä»¶è¯»è¿›è¡Œè¶…æ—¶è®¾ç½®ã€‚

@item
æ ‡å‡†çš„ @command{awk} ä¸­ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šç›®å½•æ˜¯ä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼›
@command{gawk} åœ¨é POSIX æ¨¡å¼ä¸­ä¼šå¿½ç•¥å®ƒä»¬ã€‚

@end itemize

@c EXCLUDE START
@node Input Exercises
@section ç»ƒä¹ 

@enumerate
@item
ä½¿ç”¨ @code{FIELDWIDTHS} å˜é‡ï¼ˆæŸ¥çœ‹ @ref{Constant Size}ï¼‰ï¼Œå†™ä¸€ä¸ªç¨‹åºæ¥è¯»å–é€‰ä¸¾æ•°æ®ï¼Œ
è¿™äº›æ•°æ®ä¸­æ¯ä¸ªè®°å½•ä»£è¡¨ä¸€ä¸ªæŠ•ç¥¨è€…çš„é€‰ç¥¨ã€‚æ„é€ ä¸€ä¸ªæ–¹å¼æ¥å®šä¹‰åˆ—å¦‚ä½•æ¥ä¸æ¯ä¸ªæŠ•ç¥¨é¡¹è¿›è¡Œå…³è”ï¼Œå¹¶æ‰“å°æ€»çš„ç¥¨æ•°ï¼Œ
åŒ…æ‹¬æ¯ä¸ªé¡¹çš„å¼ƒæƒç¥¨æ•°ã€‚

@item
åœ¨ @ref{Plain Getline} ä¸­ï¼Œæœ‰ä¸€ä¸ªç¨‹åºæ¥ä»è¾“å…¥ä¸­ç§»é™¤ C é£æ ¼çš„æ³¨é‡Šï¼ˆ@samp{/* @dots{} */})ã€‚
é‚£ä¸ªç¨‹åºåœ¨ä¸€ä¸ªè¡Œä¸­ç»“æŸä¸€ä¸ªæ³¨é‡Šï¼ŒåŒæ—¶å¼€å¯å¦ä¸€ä¸ªæ³¨é‡Šæ—¶å·¥ä½œä¸æ­£ç¡®ã€‚å¯ä»¥åšä¸€äº›å¾ˆå°çš„å˜æ›´å°±å¯ä»¥æ¥ä¿®å¤å®ƒï¼Œå¦‚ä½•æ¥åšï¼Ÿ

@end enumerate
@c EXCLUDE END

@node Printing
@chapter æ‰“å°è¾“å‡º

@cindex printing
@cindex output, printing, See printing
å¤§å¤šæ•°ç¼–ç¨‹è¡Œä¸ºå°±æ˜¯@dfn{æ‰“å°}æˆ–è€…è¯´æ˜¯è¾“å‡ºä¸€äº›æˆ–è€…å…¨éƒ¨çš„è¾“å…¥ã€‚
ä½¿ç”¨ @code{print} è¯­å¥è¿›è¡Œç®€å•çš„è¾“å‡ºï¼Œåˆ©ç”¨ @code{printf} è¯­å¥è¿›è¡Œæ ¼å¼åŒ–è¾“å‡ºã€‚
åœ¨å†³å®šæ‰“å°@emph{å“ªä¸ª}å€¼çš„åœºæ™¯ä¸‹ï¼Œ@code{print} è¯­å¥æ²¡ä»€ä¹ˆé™åˆ¶ã€‚
ä½†æ˜¯æœ‰ä¸¤ä¸ªä¾‹å¤–ï¼Œä½ æ— æ³•æŒ‡å®šå®ƒä»¬@emph{å¦‚ä½•}æ¥æ‰“å°å®ƒä»¬â€”â€”å¤šå°‘åˆ—ï¼Œæ˜¯å¦ä½¿ç”¨å¹‚æ–¹å¼ç­‰ç­‰ã€‚
ï¼ˆå¯¹äºè¿™äº›ä¾‹å¤–ï¼ŒæŸ¥çœ‹ @ref{Output Separators} å’Œ @ref{OFMT}ï¼‰
å¯¹äºè§„èŒƒçš„æ‰“å°ï¼Œä½ éœ€è¦ @code{printf} è¯­å¥ï¼ˆæŸ¥çœ‹ @ref{Printf}ï¼‰ã€‚

@cindex @code{print} statement
@cindex @code{printf} statement
é™¤äº†åŸºæœ¬çš„ä¸æ ¼å¼åŒ–çš„æ‰“å°ï¼Œæœ¬@value{CHAPTER}è¿˜ä¼šè®¨è®º I/O é‡å®šå‘åˆ°æ–‡ä»¶ä¸ç®¡é“çš„ç›¸å…³é—®é¢˜ï¼Œ
ä»‹ç»ä¸€äº› @command{gawk} å†…éƒ¨ä½¿ç”¨çš„ç‰¹æ®Šçš„@value{FN}ï¼Œè¿˜è®¨è®º @code{close()} è¿™ä¸ªå†…å»ºå‡½æ•°ã€‚

@menu
* Print::                       The @code{print} statement.
* Print Examples::              Simple examples of @code{print} statements.
* Output Separators::           The output separators and how to change them.
* OFMT::                        Controlling Numeric Output With @code{print}.
* Printf::                      The @code{printf} statement.
* Redirection::                 How to redirect output to multiple files and
                                pipes.
* Special FD::                  Special files for I/O.
* Special Files::               File name interpretation in @command{gawk}.
                                @command{gawk} allows access to inherited file
                                descriptors.
* Close Files And Pipes::       Closing Input and Output Files and Pipes.
* Output Summary::              Output summary.
* Output Exercises::            Exercises.
@end menu

@node Print
@section @code{print} è¯­å¥

åˆ©ç”¨ @code{print} è¿›è¡Œç®€å•çš„ï¼Œæ ‡å‡†åŒ–çš„è¾“å‡ºã€‚åªéœ€è¦æŒ‡å®šè¦æ‰“å°çš„å­—ä¸²ä»¥åŠæ•°å­—ï¼Œå¹¶ç”¨é€—å·åˆ†éš”å®ƒä»¬ã€‚å®ƒä»¬è¾“å‡ºæ—¶ç”¨ç®€å•çš„ç©ºæ ¼è¿›è¡Œåˆ†éš”ï¼Œå¹¶åœ¨æœ€åé™„åŠ ä¸Šæ¢è¡Œç¬¦ã€‚è¯­å¥çœ‹èµ·æ¥å¦‚ä¸‹ï¼š

@example
print @var{item1}, @var{item2}, @dots{}
@end example

@noindent
æ•´ä¸ªçš„é¡¹ç›®åˆ—è¡¨å¯ä»¥ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œä½†æ˜¯å¯é€‰çš„ã€‚
å¦‚æœé¡¹ç›®è¡¨è¾¾å¼ä½¿ç”¨äº† @samp{>} è¿™æ ·çš„å…³ç³»æ“ä½œç¬¦ï¼Œåˆ™æ‹¬å·æ˜¯å¿…é¡»çš„ï¼›å¦åˆ™ä¼šäº§ç”Ÿä»¤äººå›°æƒ‘çš„è¾“å‡ºé‡å®šå‘
ï¼ˆæŸ¥çœ‹ @ref{Redirection}ï¼‰ã€‚

è¦æ‰“å°çš„é¡¹ï¼Œå¯ä»¥æ˜¯å¸¸é‡å­—ä¸²ï¼Œæ•°å€¼ï¼Œå½“å‰è®°å½•çš„åŸŸï¼ˆå¦‚ @code{$1}ï¼‰ï¼Œå˜é‡ï¼Œä»¥åŠä»»æ„çš„ @command{awk} è¡¨è¾¾å¼ã€‚æ•°å€¼ä¼šè¢«è½¬æ¢æˆå­—ä¸²ï¼Œç„¶åå†æ‰“å°ã€‚

@cindex records, printing
@cindex lines, blank, printing
@cindex text, printing
ç®€å•çš„ @samp{print} è¯­å¥ï¼ŒåŒæ—¶æ²¡æœ‰å¸¦ä»»ä½•æ‰“å°é¡¹ï¼Œç­‰åŒäº @samp{print $0}ï¼šå³æ‰“å°æ•´ä¸ªçš„å½“å‰è®°å½•ã€‚
è¦æ‰“å°ä¸€ä¸ªç©ºè¡Œï¼Œåˆ™ä½¿ç”¨ @samp{print ""}ã€‚
è¦æ‰“å­—å›ºå®šçš„æ–‡æœ¬ç‰‡ï¼Œä½¿ç”¨å­—ä¸²å¸¸é‡ï¼Œå¦‚ @w{@code{"Don't Panic"}} è¿™æ ·çš„é¡¹ã€‚
å¦‚æœä½ å¿˜è®°ä½¿ç”¨åŒå¼•å·å­—ç¬¦ï¼Œåˆ™æ–‡ä»¶ä¼šè¢«å½“æˆ @command{awk} è¡¨è¾¾å¼ï¼Œè¿™æ ·æœ‰å¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯ã€‚è¦è®°ä½ï¼Œåœ¨ä»»æ„ä¸¤ä¸ªè¦æ‰“å°çš„é¡¹ç›®ä¹‹é—´ç©ºæ ¼æ˜¯è¦æ‰“å°çš„ã€‚

æ³¨æ„ @code{print} è¯­å¥æ˜¯ä¸€ä¸ªè¯­å¥ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼â€”â€”ä½ ä¸èƒ½ä½¿ç”¨åœ¨æ¨¡å¼-åŠ¨ä½œè¯­å¥ä¸­çš„æ¨¡å¼éƒ¨åˆ†ã€‚

@node Print Examples
@section @code{print} è¯­å¥ä¾‹å­

æ¯ä¸€ä¸ª @code{print} è¯­å¥è‡³å°‘ä¼šäº§ç”Ÿä¸€è¡Œè¾“å‡ºã€‚ä½†æ˜¯ä¸é™äºåªè¾“å‡ºä¸€è¡Œã€‚å¦‚æ˜¯é¡¹ç›®ä¸­çš„å€¼æ˜¯ä¸€ä¸ªå­—ä¸²ï¼Œå¹¶åŒ…å«ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œåˆ™æ¢è¡Œç¬¦ä¼šä¸å‰©ä¸‹çš„ä¸²ä¸€èµ·è¾“å‡ºã€‚ä¸€ä¸ªå•ä¸€çš„ @code{print} è¯­å¥å¯ä»¥æŒ‰è¿™ç§æ–¹å¼é¦–å…ˆä»»æ„è¡Œæ•°ã€‚

@cindex newlines, printing
ä¸‹é¢æ˜¯ä¸€ä¸ªæ‰“å°å†…åµŒäº†
@ifinfo
æ¢è¡Œç¬¦
ï¼ˆ@samp{\n} æ˜¯ä¸€ä¸ªè½¬ä¹‰åºåˆ—ï¼Œç”¨æ¥è¡¨ç¤ºæ¢è¡Œç¬¦ï¼›å‚è€ƒ @ref{Escape Sequences} ï¼‰
@end ifinfo
@ifhtml
æ¢è¡Œç¬¦
ï¼ˆ@samp{\n} æ˜¯ä¸€ä¸ªè½¬ä¹‰åºåˆ—ï¼Œç”¨æ¥è¡¨ç¤ºæ¢è¡Œç¬¦ï¼›å‚è€ƒ @ref{Escape Sequences} ï¼‰
@end ifhtml
@ifnotinfo
@ifnothtml
æ¢è¡Œç¬¦
@end ifnothtml
@end ifnotinfo
çš„å­—ç¬¦ä¸²çš„ä¾‹å­ï¼š

@example
$ @kbd{awk 'BEGIN @{ print "line one\nline two\nline three" @}'}
@print{} line one
@print{} line two
@print{} line three
@end example

@cindex fields, printing
ä¸‹ä¸€ä¸ªä¾‹å­ï¼Œä¼šè¿è¡Œåœ¨æ–‡ä»¶ @file{inventory-shipped} ä¸Šï¼Œå¹¶æ‰“å°æ¯ä¸ªè¾“å…¥è®°å½•çš„å‰ä¸¤ä¸ªåŸŸï¼Œå®ƒä»¬ä¹‹é—´æœ‰ç©ºæ ¼ï¼š

@example
$ @kbd{awk '@{ print $1, $2 @}' inventory-shipped}
@print{} Jan 13
@print{} Feb 15
@print{} Mar 15
@dots{}
@end example

@cindex @code{print} statement, commas, omitting
@cindex troubleshooting, @code{print} statement@comma{} omitting commas
å¸¸è§çš„ä½¿ç”¨ @code{print} è¯­å¥çš„é”™è¯¯æ˜¯çœç•¥äº†é¡¹ç›®ä¹‹é—´çš„é€—å·ã€‚è¿™å¸¸ä¼šå¯¼è‡´åœ¨è¾“å‡ºä¸­æ‰€æœ‰çš„é¡¹ç›®æŒ¤åœ¨äº†ä¸€äº›ï¼Œç›¸äº’ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ã€‚åŸå› åœ¨äºåœ¨ @command{awk} ä¸­ï¼Œå¹¶åˆ—ä¸¤ä¸ªå­—ä¸²è¡¨ç¤ºçš„æ˜¯åˆå¹¶å®ƒä»¬ã€‚è¿™æ˜¯ç›¸åŒçš„ç¨‹åºï¼Œä½†æ˜¯æ²¡æœ‰é€—å·çš„æƒ…å†µï¼š

@example
$ @kbd{awk '@{ print $1 $2 @}' inventory-shipped}
@print{} Jan13
@print{} Feb15
@print{} Mar15
@dots{}
@end example

@cindex @code{BEGIN} pattern, headings@comma{} adding
å¯¹äºä¸ç†Ÿæ‚‰ @file{inventory-shipped} æ–‡ä»¶çš„è¯»è€…ï¼Œ
ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­çš„è¾“å‡ºæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚å¼€å¤´çš„è¡Œå¯èƒ½æ›´æ¸…æ¥šã€‚
è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„æœˆä»½ï¼ˆ@code{$1}ï¼‰è¡¨ä»¥åŠå·²ç»å‘é€çš„è“åŒ…ï¼ˆ@code{$2}ï¼‰ä¸­æ·»åŠ ä¸€äº›å¤´éƒ¨ä¿¡æ¯ï¼š
æˆ‘ä»¬ä½¿ç”¨ @code{BEGIN} ï¼ˆå‚è€ƒ @ref{BEGIN/END}ï¼‰æ¥å®ç°ï¼Œè¿™æ ·å¤´éƒ¨åªä¼šæ‰“å°ä¸€æ¬¡ï¼š

@example
awk 'BEGIN @{  print "Month Crates"
              print "----- ------" @}
           @{  print $1, $2 @}' inventory-shipped
@end example

@noindent
å½“æ‰§è¡Œæ—¶ï¼Œç¨‹åºæ‰“å°å¦‚ä¸‹ï¼š

@example
Month Crates
----- ------
Jan 13
Feb 15
Mar 15
@dots{}
@end example

@noindent
ç„¶è€Œï¼Œå”¯ä¸€çš„é—®é¢˜æ˜¯å¤´éƒ¨ä¿¡æ¯ä¸è¡¨æ•°æ®å¹¶æ²¡æœ‰å¯¹é½ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æ‰“å°ä¸€äº›ç©ºæ ¼æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼š

@example
@group
awk 'BEGIN @{ print "Month Crates"
             print "----- ------" @}
           @{ print $1, "     ", $2 @}' inventory-shipped
@end group
@end example

@cindex @code{printf} statement, columns@comma{} aligning
@cindex columns, aligning
å¦‚æœè¦ä¿®å¤çš„åˆ—æœ‰å¾ˆå¤šï¼Œè¿™æ ·çš„ä¿®å¤æ–¹å¼ä¼šéå¸¸ç¹çã€‚è®¡ç®—ä¸¤ä¸‰ä¸ªåˆ—æ˜¯å¾ˆç®€å•çš„ï¼Œ
ä½†æ˜¯è¶…è¿‡è¿™ä¸ªæ•°çš„æ—¶å€™ï¼Œæ‰€è€—çš„æ—¶é—´å°±å¾ˆå¤šäº†ã€‚
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ @code{printf} è¯­å¥åŸå› ï¼ˆæŸ¥çœ‹ @ref{Printf}ï¼‰ï¼›å®ƒçš„å…¶ä¸­ä¸€ä¸ªç‰¹åˆ«åŠŸèƒ½å°±æ˜¯å¯¹é½æ•°æ®åˆ—ã€‚

@cindex line continuations, in @code{print} statement
@cindex @code{print} statement, line continuations and
@quotation æç¤º
ä½ å¯ä»¥å¯¹ @code{print} æˆ–è€… @code{printf} è¿›è¡Œç»­è¡Œï¼Œåªéœ€è¦ç®€å•åœ°åœ¨ä»»æ„çš„é€—å·åé¢æ”¾ç½®ä¸€ä¸ªæ¢è¡Œç¬¦å³å¯ã€‚
ï¼ˆæŸ¥çœ‹ @ref{Statements/Lines}ï¼‰ã€‚
@end quotation

@node Output Separators
@section è¾“å‡ºåˆ†éš”ç¬¦

@cindex @code{OFS} variable
å¦‚å‰æ‰€è¿°ï¼Œ@code{print} è¯­å¥åŒ…å«äº†ç”±é€—å·åˆ†éš”çš„é¡¹ç›®åˆ—è¡¨ã€‚
åœ¨è¾“å‡ºä¸­ï¼Œé¡¹ç›®ä¸€èˆ¬æ˜¯ç”¨ç©ºæ ¼è¿›è¡Œåˆ†éš”ã€‚ä½†æ˜¯ä¹Ÿä¸ä¸€å®šéè¦è¿™æ ·ï¼Œç©ºæ ¼åªæ˜¯é»˜è®¤æƒ…å†µã€‚
ä»»æ„çš„å­—ä¸²éƒ½å¯ä»¥ç”¨æ¥å½“æˆæ˜¯è¾“å‡ºåˆ†éš”ä¼šï¼Œåªéœ€è¦è®¾å®šé¢„å®šä¹‰çš„å˜é‡ @code{OFS}ã€‚
è¿™ä¸ªå˜é‡åˆå§‹å€¼å°±æ˜¯ä¸² @w{@code{" "}}ï¼ˆä¸€ä¸ªç©ºæ ¼ï¼‰ã€‚

æ•´ä¸ªçš„ @code{print} è¯­å¥è¾“å‡ºç§°ä¸ºä¸€ä¸ª@dfn{è¾“å‡ºè®°å½•ï¼ˆoutput recordï¼‰}ã€‚
æ¯ä¸€ä¸ª @code{print} è¯­å¥è¾“å‡ºä¸€ä¸ªè¾“å‡ºè®°å½•ï¼Œç„¶åè¾“å‡ºä¸€ä¸ª@dfn{è¾“å‡ºè®°å½•åˆ†éš”ç¬¦}ï¼ˆæˆ–è€… @code{ORS}ï¼‰ã€‚
@code{ORS} çš„åˆå§‹å€¼ä¸ºä¸² @code{"\n"}ï¼ˆä¸€ä¸ªæ¢è¡Œç¬¦ï¼‰ã€‚å› æ­¤ï¼Œæ¯ä¸€ä¸ª @code{print} è¯­å¥äº§ç”Ÿä¸€ä¸ªå•ç‹¬çš„è¡Œã€‚

@cindex output, records
@cindex output record separator, See @code{ORS} variable
@cindex @code{ORS} variable
@cindex @code{BEGIN} pattern, @code{OFS}/@code{ORS} variables, assigning values to
ä¸ºäº†æ”¹å˜è¾“å‡ºåŸŸä»¥åŠè®°å½•çš„åˆ†éš”æ–¹å¼ï¼Œç»™å˜é‡ @code{OFS} ä»¥åŠ @code{ORS} èµ‹å€¼å³å¯ã€‚
é€šå¸¸åšè¿™ä»¶äº‹çš„åœ°æ–¹å°±æ˜¯ @code{BEGIN} è§„åˆ™é‡Œï¼ˆæŸ¥çœ‹ @ref{BEGIN/END}ï¼‰ï¼Œ
å› æ­¤ï¼Œåœ¨ä»»æ„çš„è¾“å…¥è¢«å¤„ç†ä¹‹å‰å°±å¯ä»¥å°±ç»ªã€‚ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­çš„å¯¹å…¶è¿›è¡Œèµ‹å€¼ï¼Œéœ€è¦æ”¾åœ¨è¾“å…¥æ–‡ä»¶ä¹‹å‰ï¼Œ
æˆ–è€…ä½¿ç”¨ @option{-v} å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚
ä¸‹é¢çš„ä¾‹å­æ‰“å°è®°å½•çš„ç¬¬ä¸€ä¸ç¬¬äºŒä¸ªåŸŸï¼Œå¹¶ç”¨åˆ†å·åˆ†éš”ï¼Œå¹¶åœ¨æ¯ä¸ªæ¢è¡Œç¬¦çš„åé¢å¢åŠ ä¸€ä¸ªç©ºè¡Œï¼š

@example
$ @kbd{awk 'BEGIN @{ OFS = ";"; ORS = "\n\n" @}}
>            @kbd{@{ print $1, $2 @}' mail-list}
@print{} Amelia;555-5553
@print{}
@print{} Anthony;555-3412
@print{}
@print{} Becky;555-7685
@print{}
@print{} Bill;555-1675
@print{}
@print{} Broderick;555-0542
@print{}
@print{} Camilla;555-2912
@print{}
@print{} Fabius;555-1234
@print{}
@print{} Julie;555-6699
@print{}
@print{} Martin;555-6480
@print{}
@print{} Samuel;555-3430
@print{}
@print{} Jean-Paul;555-2127
@print{}
@end example

å¦‚æœ @code{ORS} çš„å€¼ä¸­ä¸åŒ…å«æ¢è¡Œç¬¦ï¼Œç¨‹åºçš„è¾“å‡ºå°±ä¼šæŒ¤åœ¨ä¸€è¡Œä¸­ã€‚

@node OFMT
@section æ§åˆ¶ @code{print} çš„æ•°å­—è¾“å‡º 
@cindex numeric, output format
@cindex formats@comma{} numeric output
å½“ç”¨ @code{print} è¯­å¥æ‰“å°æ•°å€¼æ—¶ï¼Œ@command{awk} å†…éƒ¨ä¼šå°†æ¯ä¸€ä¸ªæ•°å€¼è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åæ‰“å°å®ƒã€‚
@command{awk} ä½¿ç”¨ sprintf å‡½æ•°æ¥åšè¿™æ ·çš„è½¬æ¢ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚
ç›®å‰ï¼Œåªéœ€è¦çŸ¥é“ @code{sprintf()} æ¥å—ä¸€ä¸ªæ ¼å¼è§„èŒƒï¼ˆå­—ä¸²ï¼‰ç”¨ä»¥å‘Šè¯‰å¦‚ä½•æ¥å¯¹æ•°å­—æˆ–è€…å­—ä¸²å¦‚ä½•è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶ä¸”æ•°å­—æœ‰å¾ˆå¤šç§æ–¹å¼æ¥è¿›è¡Œæ ¼å¼åŒ–ã€‚
ä¸åŒçš„æ ¼å¼è§„èŒƒä¼šåœ¨ 
@ref{Control Letters} 
ä¸­è®¨è®ºå¾—æ›´åŠ è¯¦ç»†ã€‚

@cindexawkfunc{sprintf}
@cindex @code{OFMT} variable
@cindex output, format specifier@comma{} @code{OFMT}
é¢„å®šä¹‰çš„å˜é‡ @code{OFMT} åŒ…å«äº† @code{print} æ—¶æƒ³å°†æ•°å€¼è½¬æ¢æˆå­—ä¸²ï¼Œ
ä½¿ç”¨ @code{sprintf} æ—¶çš„æ ¼å¼è§„èŒƒã€‚@code{OFMT} çš„é»˜è®¤çš„å€¼æ˜¯ @code{"%.6g"}ã€‚
@code{print} æ‰“å°æ•°å­—çš„æ ¼å¼å¯èƒ½é€šè¿‡ç»™ @code{OFMT} èµ‹äºˆä¸åŒçš„æ ¼å¼è§„èŒƒæ¥æ”¹å˜ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼š

@example
$ @kbd{awk 'BEGIN @{}
>   @kbd{OFMT = "%.0f"  # print numbers as integers (rounds)}
>   @kbd{print 17.23, 17.54 @}'}
@print{} 17 18
@end example

@noindent
@cindex dark corner, @code{OFMT} variable
@cindex POSIX @command{awk}, @code{OFMT} variable and
@cindex @code{OFMT} variable, POSIX @command{awk} and
æ ¹æ® POSIX æ ‡å‡†ï¼Œå¦‚æœ @code{OFMT} åŒ…å«çš„ä¸æ˜¯æµ®ç‚¹è½¬æ¢è§„èŒƒçš„å…¶ä»–ä»»æ„æ•°å€¼ï¼Œä¼šäº§ç”Ÿæœªå®šä¹‰çš„ @command{awk} è¡Œä¸ºã€‚
@value{DARKCORNER}

@node Printf
@section ä½¿ç”¨ @code{printf} è¯­å¥ç¾åŒ–æ‰“å°

@cindex @code{printf} statement
@cindex output, formatted
@cindex formatting output
ä¸ºäº†æ¯” @code{print} æä¾›æ›´åŠ ç²¾å‡†åœ°æ§åˆ¶è¾“å‡ºæ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨ @code{printf}ã€‚@code{printf} å¯ä»¥æŒ‡å®šæ¯ä¸ªé¡¹ç›®çš„å®½åº¦ï¼Œä»¥åŠä¸€ç³»åˆ—çš„æ•°å€¼è¾“å‡ºæ ¼å¼ï¼ˆå¦‚ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆåŸºæ•°ï¼Œæ˜¯å¦æ‰“å°å¹‚æŒ‡æ•°å½¢å¼ï¼Œæ˜¯å¦æ‰“å°ç¬¦å·ï¼Œä»¥åŠåœ¨å°æ•°ç‚¹åè¦æ‰“å°å¤šä¸ªä½ç­‰ï¼‰ã€‚

@menu
* Basic Printf::                Syntax of the @code{printf} statement.
* Control Letters::             Format-control letters.
* Format Modifiers::            Format-specification modifiers.
* Printf Examples::             Several examples.
@end menu

@node Basic Printf
@subsection ä½¿ç”¨ @code{printf} è¯­å¥ç¾åŒ–æ‰“å°

@cindex @code{printf} statement, syntax of
ä¸€ä¸ªç®€å•çš„ @code{printf} è¯­å¥æ˜¯è¿™æ ·çš„ï¼š

@example
printf @var{format}, @var{item1}, @var{item2}, @dots{}
@end example

@noindent
ä¸ @code{print} ç›¸ä¼¼ï¼Œæ•´ä¸ªçš„å‚æ•°åˆ—è¡¨å¯ä»¥ä½¿ç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚è¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œ
å¦‚æœé¡¹ç›®è¡¨è¾¾å¼ä¸­åŒ…å«äº† @samp{>} å…³ç³»è¡¨è¾¾æ“ä½œç¬¦ï¼Œåˆ™æ‹¬å·æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸€ä¸ªè¾“å‡ºé‡å®šå‘è€Œä½¿ç”¨å›°æƒ‘
ï¼ˆæŸ¥çœ‹ @ref{Redirection}ï¼‰ã€‚

@cindex format specifiers
åœ¨ @code{print} ä¸ @code{printf} ä¹‹é—´çš„ä¸åŒï¼Œå°±æ˜¯ @var{format} å‚æ•°ã€‚
è¿™æ˜¯ä¸€ä¸ªä¼šè¢«å½“æˆå­—ä¸²è¯†åˆ«çš„è¡¨è¾¾å¼ï¼Œå®ƒæŒ‡å®šäº†æ¯ä¸ªå‚æ•°çš„è¾“å‡ºæ ¼å¼ã€‚å®ƒç§°ä¸º@dfn{æ ¼å¼å­—ä¸²}ã€‚

æ ¼å¼å­—ä¸²ä¸ ISO C åº“ä¸­çš„å‡½æ•° @code{printf()} éå¸¸ç±»ä¼¼ã€‚
å¤§å¤šçš„æ ¼å¼æ–‡æœ¬éƒ½è¾“å‡ºæ¥è¯´éƒ½æ˜¯å­—é¢çš„ã€‚åœ¨è¿™äº›æ–‡æœ¬ä¹‹é—´åˆ†æ•£ç€@dfn{æ ¼å¼æŒ‡å®šç¬¦}ã€‚æ¯ä¸ªé¡¹ç›®ä¸€ä¸ªã€‚æ¯ä¸ªæ ¼å¼æŒ‡å®šç¬¦éƒ½å®šä¹‰äº†ä¸‹ä¸€ä¸ªè¾“å‡ºçš„é¡¹ç›®åœ¨ç›¸åº”ä½ç½®çš„æ ¼å¼ã€‚

@code{printf} ä¸ä¼šè‡ªåŠ¨åœ°åœ¨è¾“å‡ºä¸­é™„åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚å®ƒåªè¾“å‡ºæ ¼å¼ä¸²æ‰€å®šä¹‰çš„ä¸²ã€‚å› æ­¤ï¼Œå¦‚æœéœ€è¦æ¢è¡Œç¬¦ï¼Œä½ éœ€è¦åœ¨æ ¼å¼ä¸­åŠ å…¥ã€‚è¾“å‡ºåˆ†éš”ç¬¦å˜é‡ @code{OFS} ä»¥åŠ @code{ORS} åœ¨ @code{printf} è¯­å¥ä¸­æ²¡æœ‰ä½œç”¨ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{awk 'BEGIN @{}
>    @kbd{ORS = "\nOUCH!\n"; OFS = "+"}
>    @kbd{msg = "Don\47t Panic!"}
>    @kbd{printf "%s\n", msg}
> @kbd{@}'}
@print{} Don't Panic!
@end example

@noindent
ä¾‹å­ä¸­ï¼Œæ— è®ºæ˜¯ @samp{+} è¿˜æ˜¯ @samp{OUCH!} éƒ½æ²¡æœ‰å‡ºç°åœ¨è¾“å‡ºä¿¡æ¯ä¸­ã€‚

@node Control Letters
@subsection æ ¼å¼æ§åˆ¶å­—æ¯
@cindex @code{printf} statement, format-control characters
@cindex format specifiers, @code{printf} statement

æ ¼å¼æŒ‡å®šç¬¦ä»¥å­—ç¬¦ @samp{%} å¼€å§‹ï¼Œå¹¶ä»¥@dfn{æ ¼å¼æ§åˆ¶å­—æ¯}ç»“æŸâ€”â€”æ•´ä¸ªæ ¼å¼æŒ‡å®šç¬¦å‘Šè¯‰ @code{printf} è¯­å¥å¦‚ä½•æ¥è¾“å‡ºé¡¹ç›®ã€‚
æ ¼å¼å­—æ¯æŒ‡å®šäº†è¦æ‰“å°çš„å€¼çš„@emph{ç±»å‹}ã€‚æ ¼å¼æŒ‡å®šç¬¦çš„å…¶ä½™éƒ¨åˆ†åˆ™ç”±å¯é€‰çš„@dfn{ä¿®é¥°ç¬¦}ç»„æˆï¼Œ
è¿™äº›ä¿®é¥°ç¬¦æ§åˆ¶@emph{å¦‚ä½•}æ¥æ‰“å°è¿™äº›å€¼ï¼Œå¦‚åŸŸå®½åº¦ã€‚ä¸‹é¢æ˜¯æ ¼å¼æ§åˆ¶å­—æ¯ï¼š

@c @asis for docbook to come out right
@table @asis
@item @code{%c}
å°†æ•°å­—æ‰“å°æˆä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€åœ¨ @samp{printf "%c", 65} è¾“å‡ºå­—æ¯ @samp{A}ã€‚
å¦‚æœæ˜¯ä¸€ä¸ªå­—ä¸²ï¼Œåˆ™è¾“å‡ºå­—ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚

@cindex dark corner, format-control characters
@cindex @command{gawk}, format-control characters
@quotation æç¤º
POSIX æ ‡å‡†è¯´æ˜¯æ‰“å°å­—ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚åœ¨å¤šå­—èŠ‚è¯­è¨€ä¸­ï¼Œ@command{gawk} ä¼šå°è¯•å°†å­—ä¸²çš„é¦–å­—èŠ‚è½¬æ¢æˆä¸€ä¸ªæœ‰æ•ˆçš„å®½å­—èŠ‚ï¼Œç„¶åæ‰“å°é‚£ä¸ªå­—ç¬¦çš„å¤šå­—èŠ‚ç¼–ç ã€‚ç›¸ä¼¼åœ°ï¼Œå½“æ‰“å°ä¸€ä¸ªæ•°å€¼æ—¶ï¼Œ@command{gawk} å…è®¸æ•°å€¼çš„å€¼åœ¨ä¸€ä¸ªå®½å­—ç¬¦æ‰€å…è®¸çš„å€¼èŒƒå›´å†…ã€‚å¦‚æœè½¬æ¢æˆå¤šå­—èŠ‚ç¼–ç å‡ºé”™ï¼Œ@command{gawk} ä¼šä½¿ç”¨æ•°å€¼çš„ä½ 8 ä½æ¥æ‰“æˆå­—ç¬¦æ‰“å°ã€‚

å…¶ä»–ç‰ˆæœ¬çš„ @command{awk} ä¸€èˆ¬ä¸¥æ ¼é™åˆ¶ä¸ºæ‰“å°å­—ä¸²çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œæˆ–è€…æ•°å€¼çš„èŒƒå›´åœ¨ä¸€ä¸ªå­—èŠ‚çš„æ‰€è¡¨ç¤ºçš„èŒƒå›´å†…ï¼ˆ0-255ï¼‰ã€‚
@end quotation


@item @code{%d}, @code{%i}
æ‰“å°ä¸€ä¸ªåè¿›åˆ¶æ•´æ•°ã€‚ä¸¤ä¸ªæ§åˆ¶å­—æ¯æ˜¯ç­‰åŒçš„ã€‚ï¼ˆ@samp{%i} è§„èŒƒä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹ ISO Cã€‚ï¼‰

@item @code{%e}, @code{%E}
å°†æ•°å€¼æ‰“å°æˆç§‘å­¦è®¡ç®—æ–¹å¼ï¼ˆå¹‚æŒ‡æ•°ï¼‰ï¼Œä¾‹å¦‚ï¼š

@example
printf "%4.3e\n", 1950
@end example

@noindent
ä¼šæ‰“å° @samp{1.950e+03}ï¼Œå¸¦æœ‰ 4 ä¸ªæœ‰æ•ˆä½ï¼Œå…¶ä¸­ 3 ä¸ªåœ¨å°æ•°ç‚¹çš„åé¢ã€‚
ï¼ˆ@samp{4.3} è¡¨ç¤ºä¸¤ä¸ªä¿®é¥°ç¬¦ï¼Œä¼šåœ¨ä¸‹ä¸ª@value{SUBSECTION}ä¸­è¿›è¡Œè®¨è®ºã€‚ï¼‰
@samp{%E} è¡¨ç¤ºåœ¨è¾“å‡ºä¸­ä½¿ç”¨ @samp{E} è€Œä¸æ˜¯ @samp{e} ã€‚

@item @code{%f}
æ‰“å°ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œä¾‹å¦‚ï¼š

@example
printf "%4.3f", 1950
@end example

@noindent
ä¼šæ‰“å° @samp{1950.000}ï¼Œå¸¦æœ‰ 4 ä¸ªæœ‰æ•ˆä½ï¼Œ3 ä¸ªåœ¨å°æ•°ç‚¹åé¢ã€‚
ï¼ˆ@samp{4.3} è¡¨ç¤ºä¸¤ä¸ªä¿®é¥°ç¬¦ï¼Œä¼šåœ¨ä¸‹ä¸ª@value{SUBSECTION}ä¸­è¿›è¡Œè®¨è®ºã€‚ï¼‰

åœ¨æ”¯æŒ IEEE 754 æµ®ç‚¹æ ¼å¼çš„ç³»ç»Ÿä¸Šï¼Œä»£è¡¨è´Ÿæ— ç©·ä¼šæ ¼å¼åŒ–ä¸º @samp{-inf}ï¼Œæˆ–è€… @samp{-infinity}ï¼Œ
æ­£æ— ç©·åˆ™ä¸º @samp{inf} æˆ–è€… @samp{infinity}ã€‚å¯¹äºâ€œä¸æ˜¯æ•°å€¼â€è¿™ç§ç‰¹æ®Šæƒ…å†µï¼Œåˆ™æ ¼å¼åŒ–ä¸º @samp{-nan} æˆ–è€… @samp{ nan}
ï¼ˆæŸ¥çœ‹ @ref{Math Definitions}ï¼‰ã€‚

@item @code{%F}
ç±»ä¼¼äº @samp{%f}ï¼Œåªæ˜¯æ— ç©·å¤§ï¼Œä»¥åŠâ€œä¸æ˜¯æ•°å€¼â€ ä¼šä½¿ç”¨å¤§å†™å­—æ¯è¾“å‡ºã€‚

@samp{%F} æ˜¯ä¸€ä¸ª ISO C çš„ä¸€ä¸ªæ‰©å±•ï¼Œä¸æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒã€‚å¯¹äºä¸æ”¯æŒçš„ç³»ç»Ÿï¼Œ@command{gawk} ä¼šä½¿ç”¨ @samp{%f} æ¥ä»£æ›¿ã€‚

@item @code{%g}, @code{%G}
ä»¥ç§‘å­¦æ–¹å¼æˆ–è€…æµ®ç‚¹æ•°æ–¹å¼æ‰“å°æµ®æ•°å€¼ï¼Œçœ‹å“ªä¸ªä½¿ç”¨æ›´å°‘çš„å­—ç¬¦ï¼Œå¦‚æœç»“æœæ˜¯ä»¥ç§‘å­¦è®¡æ•°æ–¹å¼ï¼Œ@samp{%G} åˆ™ä½¿ç”¨ @samp{E} è€Œä¸æ˜¯ä½¿ç”¨ @samp{e} ã€‚

@item @code{%o}
æ‰“å°ä¸€ä¸ªæ— ç¬¦å·å…«è¿›åˆ¶æ•´æ•°ï¼ˆæŸ¥çœ‹ @ref{Nondecimal-numbers}ï¼‰ã€‚

@item @code{%s}
æ‰“å°ä¸€ä¸ªå­—ä¸²ã€‚

@item @code{%u}
æ‰“å°ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ã€‚ï¼ˆä½¿ç”¨è¿™ä¸ªæ ¼å¼è¦æ³¨æ„ï¼Œå› æ­¤åœ¨ @command{awk} ä¸­çš„æ‰€æœ‰æ•°å€¼éƒ½æ˜¯æµ®ç‚¹æ•°ï¼Œè¿™ä¸ªåªæ˜¯ä¸ºäº†ä¸ ISO C ä¿æŒå…¼å®¹ã€‚ï¼‰

@item @code{%x}, @code{%X}
æ‰“å°ä¸€ä¸ªæ— ç¬¦å·çš„åå…­è¿›åˆ¶æ•´æ•°ï¼Œ@samp{%X} ä½¿ç”¨å­—æ¯ @samp{A} åˆ° @samp{F} è€Œä¸æ˜¯ @samp{a} åˆ° @samp{f}
ï¼ˆæŸ¥çœ‹ @ref{Nondecimal-numbers}ï¼‰ã€‚

@item @code{%%}
æ‰“å° @samp{%}ã€‚è¿™ä¸ªä¸ä¼šæ¶ˆè€—åé¢çš„å‚æ•°ï¼Œå¹¶ä¸”å¿½ç•¥æ‰æ‰€æœ‰çš„ä¿®é¥°ç¬¦ã€‚
@end table

@cindex dark corner, format-control characters
@cindex @command{gawk}, format-control characters
@quotation æç¤º
å½“ä½¿ç”¨æ•´æ•°çš„æ§åˆ¶å­—æ¯æ¥æ‰“å°å…¶å€¼è¶…è¿‡ C æ•´æ•°çš„æœ€å¤§çš„èŒƒå›´æ—¶ï¼Œ@command{gawk} ä¼šåˆ‡æ¢åˆ° @samp{%g} è¿™ä¸ªæ ¼å¼æŒ‡å®šç¬¦ã€‚
å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨äº† @option{--lint} é€‰é¡¹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ
@command{gawk} ä¼šç”Ÿæˆä¸€ä¸ªå‘Šè­¦ã€‚å…¶ä»–ç‰ˆæœ¬çš„ @command{awk} æœ‰å¯èƒ½æ‰“å°ä¸€ä¸ªæ— æ•ˆçš„å€¼ï¼Œæˆ–è€…äº§ç”Ÿå®Œå…¨ä¸åŒçš„å…¶ä»–ç»“æœã€‚
@value{DARKCORNER}
@end quotation

@node Format Modifiers
@subsection @code{printf} çš„ä¿®é¥°ç¬¦

@cindex @code{printf} statement, modifiers
@cindex modifiers@comma{} in format specifiers
ä¸€ä¸ªæ ¼å¼æŒ‡ç¤ºç¬¦åŠŸèƒ½åŒ…æ‹¬ä¸€äº›ä¿®é¥°ç¬¦ä»¥æ§åˆ¶é¡¹ç›®çš„å€¼å¦‚ä½•æ¥è¿›è¡Œæ‰“å°ï¼Œä»¥åŠå…¶éœ€è¦å¤šå°‘çš„ç©ºé—´ã€‚
ä¿®é¥°ç¬¦å¤„äº @samp{%} ä¸æ ¼å¼æ§åˆ¶å­—æ¯ä¹‹é—´ã€‚æˆ‘ä»¬ä½¿ç”¨å­å¼¹ç¬¦â€œ@bullet{}â€æ¥è¡¨ç¤ºè¾“å‡ºä¸­çš„ç©ºæ ¼ã€‚
ä¸‹é¢æ˜¯å¯èƒ½çš„ä¿®é¥°ç¬¦ï¼Œä»¥å‡ºç°çš„é¡ºåºæ’åºï¼š

@table @asis
@cindex differences in @command{awk} and @command{gawk}, @code{print}/@code{printf} statements
@cindex @code{printf} statement, positional specifiers
@c the code{} does NOT start a secondary
@cindex positional specifiers, @code{printf} statement
@item @code{@var{N}$}
ä¸€ä¸ªæ•´æ•°åé¢å¸¦ä¸€ä¸ª @samp{$} æ˜¯ä¸€ä¸ªä½ç½®æŒ‡å®šç¬¦ã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ ¼å¼å­—ä¸²ä¸­çš„æ ¼å¼æŒ‡å®šç¬¦æ˜¯æŒ‰é¡ºåºåº”ç”¨åˆ°åé¢çš„å‚æ•°çš„ã€‚é€šè¿‡@dfn{ä½ç½®æŒ‡å®šç¬¦}ï¼Œæ ¼å¼æŒ‡å®šç¬¦åˆ™åº”ç”¨åˆ°æŒ‡å®šçš„å‚æ•°ä¸­ï¼Œ
è€Œä¸æ˜¯åŸæ¥æœ¬åº”è¯¥åº”ç”¨åœ¨åˆ—è¡¨ä¸­çš„å‚æ•°ã€‚
ä½ç½®æŒ‡å®šç¬¦ä» 0 å¼€å§‹è®¡ç®—ã€‚å› æ­¤ï¼š

@example
printf "%s %s\n", "don't", "panic"
printf "%2$s %1$s\n", "panic", "don't"
@end example

@noindent
æ‰“å°ä¸¤æ¬¡æœ€æœ‰åçš„å‹å¥½ä¿¡æ¯ã€‚

åˆçœ‹ä¹‹ä¸‹ï¼Œè¿™ä¸ªç‰¹æ€§æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ç”¨å¤„ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯ @command{gawk} çš„ä¸€ä¸ªæ‰©å±•ï¼Œ
ä¸»è¦ç”¨äºåœ¨è¿è¡Œæ—¶è¿›è¡Œä¿¡æ¯ç¿»è¯‘ã€‚æŸ¥çœ‹ @ref{Printf Ordering}ï¼Œ
å½“ä¸­æ‰€æè¿°çš„ä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•æ¥ä½¿ç”¨ä½ç½®æŒ‡å®šç¬¦ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¿½ç•¥å®ƒã€‚

@item @code{-} (Minus)
ä¸€ä¸ªå‡å· @samp{-}ï¼Œç”¨åœ¨å®½åº¦æŒ‡å®šç¬¦ä¹‹å‰ï¼ˆçœ‹æœ¬åˆ—è¡¨ä¹‹åï¼‰ï¼Œ
å‘Šè¯‰å¯¹æŒ‡å®šçš„å®½åº¦å†…è¿›è¡Œå·¦å¯¹é½ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨æŒ‡å®šçš„å®½åº¦å†…ï¼Œå‚æ•°æ˜¯å³å¯¹é½ã€‚å› æ­¤ï¼š

@example
printf "%-4s", "foo"
@end example

@noindent
æ‰“å° @samp{foo@bullet{}} ã€‚

@item @var{space}
å¯¹äºæ•°å€¼è½¬æ¢ï¼Œè¡¨ç¤ºæ­£å€¼ä¹‹å‰ç¼€ä¸€ä¸ªç©ºæ ¼ï¼Œæˆ–è€…è´Ÿå€¼ä¹‹é—´å¸¦ä¸€ä¸ªå‡å· @samp{-} ã€‚

@item @code{+}
åŠ å·ï¼Œç”¨åœ¨å®½åº¦æŒ‡å®šç¬¦å‰ï¼ˆçœ‹æœ¬åˆ—è¡¨ä¹‹åï¼‰ï¼Œå‘Šè¯‰åœ¨æ•°å€¼è½¬æ¢ä¸Šæ€»æ˜¯ä½¿ç”¨ç¬¦å·ï¼Œå°±ç®—æ•°å€¼æ ¼å¼æ˜¯æ­£æ•°ã€‚
@samp{+} å·é‡è½½äº†ç©ºæ ¼æŒ‡å®šç¬¦ã€‚

@item @code{#}
å¯¹äºç‰¹å®šçš„æ§åˆ¶å­—æ¯ä½¿ç”¨â€œå€™é€‰æ ¼å¼â€ã€‚
å¯¹äº @samp{%o} åˆ™æä¾›ä¸€ä¸ªå‰å¯¼çš„ 0ã€‚å¯¹äº @samp{%x} ä¸ @samp{%X}ï¼Œåˆ™ä½¿ç”¨ @samp{0x} æˆ–è€… @samp{0X} åœ¨éé›¶çš„ç»“æœä¹‹å‰ã€‚
å¯¹äº @samp{%e}ï¼Œ@samp{%E}ï¼Œ@samp{%f}ï¼Œ@samp{%F}ï¼Œç»“æœä¸­æ€»æ˜¯åŒ…å«å°æ•°ç‚¹ã€‚å¯¹äº @samp{%g} ä¸ @samp{%G}ï¼Œåé¢çš„é›¶ä¸ä¼šä»ç»“æœä¸­ç§»é™¤ã€‚

@item @code{0}
å‰å¯¼çš„ @samp{0}ï¼ˆé›¶ï¼‰æ˜¯ä¸€ä¸ªæ ‡å¿—æŒ‡ç¤ºç¬¦ï¼ŒæŒ‡å®šè¾“å‡ºä¸­ä½¿ç”¨ 0 æ¥å¡«å……è€Œä¸æ˜¯ä½¿ç”¨ç©ºæ ¼ã€‚
è¿™åªç”¨åœ¨æ•°å€¼æ ¼å¼ä¸­ã€‚è¿™ä¸ªæ ‡å¿—ä¹Ÿåº”ç”¨åœ¨å¦‚æœå®½åº¦æŒ‡å®šç¬¦ä¸­æŒ‡å®šçš„å®½åº¦å¤§äºè¦æ‰“å°çš„æ•°å€¼çš„å®½åº¦çš„æƒ…å†µã€‚

@item @code{'}
å•å¼•å·æˆ–è€…æ’‡å·æ˜¯ ISO C çš„ POSIX æ‰©å±•ã€‚å®ƒè¡¨ç¤ºçš„æ˜¯æµ®ç‚¹æ•°å€¼ä¸­çš„æ•´æ•°éƒ¨åˆ†ï¼Œæˆ–è€…æ•´æ•°çš„å…¨éƒ¨ï¼Œ
åº”è¯¥åŒ…å«æœ‰ä¸€ä¸ªç™¾åˆ†ä½åˆ†éš”ç¬¦ã€‚è¿™ä¸ªåªåœ¨æ”¯æŒè¿™æ ·çš„æ ¼å¼çš„è¯­è¨€ä¸­æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{cat thousands.awk}          @ii{Show source program}
@print{} BEGIN @{ printf "%'d\n", 1234567 @}
$ @kbd{LC_ALL=C gawk -f thousands.awk}
@print{} 1234567                   @ii{Results in} "C" @ii{locale}
$ @kbd{LC_ALL=en_US.UTF-8 gawk -f thousands.awk}
@print{} 1,234,567                 @ii{Results in US English UTF locale}
@end example

@noindent
è¦è·å–å…³äºè¯­è¨€è®¾ç½®ä¸å›½é™…åŒ–é—®é¢˜çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ @ref{Locales}ã€‚

@quotation æç¤º
@samp{'} æ ‡å¿—æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ç‰¹æ€§ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥ä¼šå¯¼è‡´ä¸€äº›äº‹æƒ…å¤æ‚èµ·æ¥ï¼šåœ¨å‘½ä»¤è¡Œç¨‹åºä¸­ç”¨èµ·æ¥éå¸¸å›°éš¾ã€‚è¦äº†è§£å¼•å·æŠ€å·§çš„ä¸€äº›ä¿¡æ¯ï¼Œè¯·çœ‹ @ref{Quoting}ã€‚
@end quotation

@item @var{width}
è¿™æ˜¯ä¸€ä¸ªæ•°å€¼æŒ‡å®šç¬¦ï¼ŒæŒ‡å®šä¸€ä¸ªåŸŸæ‰€éœ€è¦çš„æœ€å°å®½åº¦ã€‚
åœ¨ @samp{%} ä¸æ ¼å¼æ§åˆ¶å­—æ¯ä¹‹é—´æ’å…¥ä¸€ä¸ªæ•°å€¼ï¼Œå¼ºåˆ¶åŸŸçš„å®½åº¦æ‰©å±•åˆ°æŒ‡å®šçš„å¤§å°ã€‚é»˜è®¤çš„æƒ…å†µä¸‹ä¼šåœ¨å·¦è¾¹çš„ä½ç½®åœ¨ç©ºé—²ä½ç½®ä»¥ç©ºæ ¼å¡«å……ã€‚ä¾‹å¦‚ï¼š

@example
printf "%4s", "foo"
@end example

@noindent
ä¼šæ‰“å° @samp{@bullet{}foo} ã€‚

@var{width} çš„å€¼æ˜¯æœ€å°å®½åº¦ï¼Œä¸æ˜¯æœ€å¤§ã€‚å¦‚æœå€¼æ‰€éœ€è¦çš„ @var{width} æ›´å¤§ï¼Œä¼šæ‰©å±•åˆ°å¿…è¦çš„å®½åº¦ã€‚å› æ­¤ä¸‹é¢ï¼š

@example
printf "%4s", "foobar"
@end example

@noindent
ä¼šæ‰“å° @samp{foobar} ã€‚

å¦‚æœåœ¨ @var{width} çš„é¢å‰åŠ ä¸€ä¸ªå‡å·ï¼ˆ@samp{-}ï¼‰ï¼Œåˆ™è¾“å‡ºä¸­çš„å¡«å……ä¼šåœ¨å³è¾¹ï¼Œè€Œä¸æ˜¯åœ¨å·¦è¾¹ã€‚

@item @code{.@var{prec}}
ä¸€ä¸ªç‚¹åé¢è·Ÿä¸€ä¸ªæ•´æ•°å¸¸é‡æŒ‡å®šäº†æ‰“å°æ—¶æ‰€ä½¿ç”¨çš„ç²¾åº¦ã€‚å…¶å«ä¹‰æ ¹æ®æ§åˆ¶å­—æ¯ä¸åŒã€‚

@table @asis
@item @code{%d}, @code{%i}, @code{%o}, @code{%u}, @code{%x}, @code{%X}
è¦æ‰“å°çš„æœ€å°æ•°å­—ä¸ªæ•°ã€‚

@item @code{%e}, @code{%E}, @code{%f}, @code{%F}
åœ¨å°æ•°ç‚¹åé¢çš„æ•°å€¼ä¸ªæ•°ã€‚

@item @code{%g}, @code{%G}
æœ‰æ•ˆæ•°å­—ä½çš„æœ€å¤§ä¸ªæ•°ã€‚

@item @code{%s}
ä»è¦æ‰“å°çš„å­—ä¸²ä¸­æ‰“å°çš„æœ€å¤§å­—ç¬¦æ•°ã€‚
@end table

å› æ­¤ä¸‹é¢çš„ä»£ç ï¼š

@example
printf "%.4s", "foobar"
@end example

@noindent
ä¼šæ‰“å° @samp{foob} ã€‚
@end table

C åº“ä¸­çš„ @code{printf} çš„åŠ¨æ€ @var{width} ä¸ @var{prec} èƒ½åŠ›ï¼ˆä¾‹å¦‚ï¼Œ@code{"%*.*s"}ï¼‰ä¹Ÿè¢«æ”¯æŒã€‚
ä¸éœ€è¦æ˜¾å¼åœ°åœ¨æ ¼å¼å­—ä¸²ä¸­æŒ‡å®šä¸€ä¸ª @var{width} ä¸/æˆ–è€… @var{prec} çš„å€¼ï¼Œ
å®ƒä»¬ä¹Ÿå¯ä»¥åœ¨å‚æ•°åˆ—è¡¨ä¸­è¿›è¡Œå¤„ç†ï¼Œå¦‚ï¼š

@example
w = 5
p = 3
s = "abcdefg"
printf "%*.*s\n", w, p, s
@end example

@noindent
ä¸ä¸‹é¢çš„å®Œå…¨ä¸€è‡´ï¼š

@example
s = "abcdefg"
printf "%5.3s\n", s
@end example

@noindent
ä¸¤ä¸ªç¨‹åºéƒ½è¾“å‡º @samp{@w{@bullet{}@bullet{}abc}}ã€‚
@command{awk} æ—©æœŸçš„ç‰ˆæœ¬ä¸æ”¯æŒè¿™æ ·çš„èƒ½åŠ›ã€‚å¦‚æœä½ å¿…éœ€ä½¿ç”¨è¿™æ ·çš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥é€šè¿‡ï¼ˆå­—ä¸²ï¼‰è¿æ¥çš„æ–¹å¼æ¥æ„å»ºæ ¼å¼æ ¼å¼å­—ä¸²æ¥æ¨¡æ‹Ÿè¿™ä¸ªç‰¹æ€§ï¼š

@example
w = 5
p = 3
s = "abcdefg"
printf "%" w "." p "s\n", s
@end example

@noindent
åœ¨å®è·µä¸­è¿™ä¸ªä»£ç ä¸æ˜¯å¾ˆå¥½è¯»ï¼Œä½†æ˜¯ç¡®å®å¯ä»¥å·¥ä½œã€‚

@c @cindex lint checks
@cindex troubleshooting, fatal errors, @code{printf} format strings
@cindex POSIX @command{awk}, @code{printf} format strings and
C ç¨‹åºå‘˜è¿˜å¯ä»¥åœ¨ @code{printf} çš„æ ¼å¼å­—ä¸²ä¸­ä½¿ç”¨ä¸€äº›é¢å¤–çš„ä¿®é¥°ç¬¦ï¼ˆ@samp{h}ï¼Œ@samp{j}ï¼Œ@samp{l}ï¼Œ@samp{L}ï¼Œ@samp{t}ï¼Œ
ä¸ @samp{z}ï¼‰ã€‚
è¿™äº›åœ¨ @command{awk} ä¸­éƒ½æ˜¯æ— æ•ˆçš„ã€‚å¤§å¤šæ•° @command{awk} å®ç°éƒ½æ˜¯é»˜é»˜åœ°å¿½ç•¥å®ƒä»¬ã€‚
å¦‚æœ @option{--lint} åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šäº†ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ
@command{gawk} ä¼šäº§ç”Ÿå‘Šè­¦ã€‚å¦‚æœæŒ‡å®šäº† @option{--posix}ï¼Œåˆ™ä¼šäº§ç”Ÿä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚

@node Printf Examples
@subsection @code{printf} èŒƒä¾‹

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å¦‚ä½•æ¥ä½¿ç”¨ @code{printf} å®ç°å¯¹é½è¡¨æ ¼çš„ä¾‹å­ï¼š

@example
awk '@{ printf "%-10s %s\n", $1, $2 @}' mail-list
@end example

@noindent
è¿™ä¸ªå‘½ä»¤æ‰“å°æ–‡ä»¶ @file{mail-list} ä¸­çš„äººåï¼ˆ@code{$1}ï¼‰ä¸º 10 ä¸ªå­—ç¬¦çš„ä¸²ï¼Œå¹¶ä¸”å·¦å¯¹é½ã€‚
åŒæ—¶ä¹Ÿæ‰“å°ç”µè¯å·ç ï¼ˆ@code{$2}ï¼‰åœ¨åŒä¸€è¡Œçš„åé¢ã€‚è¿™ä¼šäº§ç”Ÿä¸€ä¸ªä¸¤è¡Œå¯¹é½çš„åå­—ä¸ç”µè¯çš„åˆ—è¡¨ï¼Œå¦‚ï¼š

@example
$ @kbd{awk '@{ printf "%-10s %s\n", $1, $2 @}' mail-list}
@print{} Amelia     555-5553
@print{} Anthony    555-3412
@print{} Becky      555-7685
@print{} Bill       555-1675
@print{} Broderick  555-0542
@print{} Camilla    555-2912
@print{} Fabius     555-1234
@print{} Julie      555-6699
@print{} Martin     555-6480
@print{} Samuel     555-3430
@print{} Jean-Paul  555-2127
@end example

åœ¨è¿™ä¾‹å­ä¸­ï¼Œç”µè¯å·ç è¦ä»¥å­—ä¸²çš„æ–¹å¼æ‰“å°ï¼Œå› ä¸ºå·ç æ˜¯ä»¥æ¨ªæ è¿›è¡Œåˆ†éš”çš„ã€‚å¦‚æœå°†ç”µè¯å·ç æ‰“å°æˆæ•°å€¼ï¼Œåˆ™äº§ç”Ÿçš„è¾“å‡ºåªæœ‰ä¸‰ä¸ªæ•°å­—ï¼š @samp{555} ã€‚è¿™å°±æœ‰ç‚¹è›‹ç–¼äº†ã€‚

æ²¡æœ‰å¿…è¦æŒ‡å®šç”µè¯å·ç çš„é•¿åº¦ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸€è¡Œä¸­çš„æœ€åä¸€é¡¹ã€‚ä¸éœ€è¦åœ¨å®ƒä»¬çš„åé¢å¡«ä¸Šç©ºæ ¼ã€‚

å¦‚æœåœ¨åˆ—çš„ä¸Šé¢æ‰“å°ä¸€äº›å¤´éƒ¨ï¼Œçœ‹èµ·æ¥å°±æ›´åŠ æ¼‚äº®äº†ã€‚è¿™å¯ä»¥é€šè¿‡ @code{BEGIN} è§„åˆ™æ¥å®ç°ï¼ˆæŸ¥çœ‹ @ref{BEGIN/END}ï¼‰ï¼Œè¿™æ ·çš„è¯ï¼Œå¤´éƒ¨å°±åªä¼šåœ¨ @command{awk} ç¨‹åºå¼€å§‹æ‰“å°ä¸€æ¬¡ï¼š

@example
awk 'BEGIN @{ print "Name      Number"
             print "----      ------" @}
           @{ printf "%-10s %s\n", $1, $2 @}' mail-list
@end example

åœ¨å‰é¢çš„ä¾‹å­ä¸­æ··åˆäº† @code{print} ä¸ @code{printf} è¯­å¥ã€‚åªä½¿ç”¨ @code{printf} ä¹Ÿå¯ä»¥äº§ç”Ÿç›¸åŒçš„ç»“æœï¼š

@example
awk 'BEGIN @{ printf "%-10s %s\n", "Name", "Number"
             printf "%-10s %s\n", "----", "------" @}
           @{ printf "%-10s %s\n", $1, $2 @}' mail-list
@end example

@noindent
åœ¨æ‰“å°å¤´éƒ¨æ—¶ï¼Œä½¿ç”¨ä¸åˆ—ä¸€æ ·çš„æ ¼å¼æŒ‡å®šç¬¦ï¼Œå¯ä»¥ä¿è¯å¤´éƒ¨ä¹Ÿåˆ—ä¸€æ ·åœ°å¯¹é½ã€‚

å…¶ä¸­çš„æ ¼å¼æŒ‡å®šä¸²è¢«ä½¿ç”¨äº†ä¸‰ä¸ªï¼Œå› æ­¤å¯ä»¥å°†å…¶å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œå¦‚ï¼š

@example
awk 'BEGIN @{ format = "%-10s %s\n"
             printf format, "Name", "Number"
             printf format, "----", "------" @}
           @{ printf format, $1, $2 @}' mail-list
@end example


@node Redirection
@section é‡å®šå‘ @code{print} ä¸ @code{printf} çš„è¾“å‡º

@cindex output redirection
@cindex redirection of output
@cindex @option{--sandbox} option, output redirection with @code{print}, @code{printf}
åˆ°ç›®å‰ï¼Œä» @code{print} ä¸ @code{printf} çš„è¾“å‡ºéƒ½æ‰“å°åœ¨æ ‡å‡†è¾“å‡ºä¸Šï¼Œä¸€èˆ¬å°±æ˜¯å±å¹•ã€‚@code{print} ä¸ @code{printf} éƒ½å¯ä»¥å°†å…¶è¾“å‡ºå®šå‘åˆ°å…¶ä»–çš„åœ°æ–¹ï¼Œè¿™å°±ç§°ä¸º@dfn{é‡å®šå‘}ã€‚

@quotation æç¤º
å½“åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šäº† @option{--sandbox}ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ
å°†è¾“å‡ºå®šå‘åˆ°æ–‡ä»¶ï¼Œç®¡é“ä¸å¹¶ç¨‹ä¼šè¢«ç¦ç”¨ã€‚
@end quotation

é‡å®šå‘å‡ºç°åœ¨ @code{print} ä¸ @code{printf} è¯­å¥ä¹‹åã€‚@command{awk} ä¸­çš„é‡å®šå‘å¦‚ Shell è„šæœ¬ä¸­çš„é‡å®šå‘ä¸€æ ·ï¼ŒåŒºåˆ«åªæ˜¯å®ƒä»¬æ˜¯å†™åœ¨ @command{awk} ç¨‹åºä¸­ã€‚

@c the commas here are part of the see also
@cindex @code{print} statement, See Also redirection@comma{} of output
@cindex @code{printf} statement, See Also redirection@comma{} of output
æœ‰ 4 ç§é‡å®šå‘æ–¹å¼ï¼šå®šå‘åˆ°æ–‡ä»¶ï¼Œå®šå‘é™„åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼›å®šå‘åˆ°å¦ä¸€ä¸ªå‘½ä»¤çš„ç®¡é“ä¸­ï¼Œä¸å®šå‘åˆ°ä¸€ä¸ªå¹¶ç¨‹ã€‚
æˆ‘ä»¬å°†å…¶å±•ç¤ºåœ¨ @code{print} è¯­å¥ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥åº”ç”¨åœ¨ @code{printf} è¯­å¥ï¼š

@table @code
@cindex @code{>} (right angle bracket), @code{>} operator (I/O)
@cindex right angle bracket (@code{>}), @code{>} operator (I/O)
@cindex operators, input/output
@item print @var{items} > @var{output-file}
è¿™ä¸ªç±»å‹çš„å®šå‘ä¼šå°†é¡¹ç›®è¾“å‡ºåˆ°ä¸€ä¸ªåå­—ä¸º @var{output-file} çš„æ–‡ä»¶ä¸­ã€‚
æ–‡ä»¶å @var{output-file} å¯ä»¥æ˜¯ä»»æ„è¡¨è¾¾å¼ã€‚å®ƒçš„å€¼ä¼šè¢«è½¬æ¢æˆå­—ä¸²å¹¶ç”¨ä½œ@value{FN}
ï¼ˆæŸ¥çœ‹ @ref{Expressions}ï¼‰ã€‚

å½“ä½¿ç”¨è¿™ç§é‡å®šå‘æ—¶ï¼Œ@var{output-file} åœ¨ç¬¬ä¸€ä¸ªè¾“å‡ºå†™å…¥å‰ä¼šå°†æ–‡ä»¶æ¸…ç©ºã€‚
åç»­å¯¹åŒä¸€ä¸ªæ–‡ä»¶çš„å†™ä¸å†è¿›è¡Œå†…å®¹æ“¦é™¤ï¼Œåªä¼šé™„åŠ ã€‚ï¼ˆè¿™ä¸ä½ åœ¨ Shell ä¸­ä½¿ç”¨é‡å®šå‘ä¸åŒã€‚ï¼‰
å¦‚æœ @var{output-file} ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒã€‚
ä¾‹å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ª @command{awk} ç¨‹åºï¼Œå…¶ä¼šå°†äººååˆ—è¡¨å†™åˆ°åä¸º @file{name-list} çš„æ–‡ä»¶ä¸­ï¼Œ
å¹¶å°†ç”µè¯å·ç å†™å…¥åˆ°å¦ä¸€ä¸ªåä¸º @file{phone-list} çš„æ–‡ä»¶ä¸­ï¼š

@example
$ @kbd{awk '@{ print $2 > "phone-list"}
>        @kbd{print $1 > "name-list" @}' mail-list}
$ @kbd{cat phone-list}
@print{} 555-5553
@print{} 555-3412
@dots{}
$ @kbd{cat name-list}
@print{} Amelia
@print{} Anthony
@dots{}
@end example

@noindent
è¾“å‡ºçš„æ–‡ä»¶ä¸­ï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªåå­—æˆ–è€…ä¸€ä¸ªç”µè¯å·ç ã€‚

@cindex @code{>} (right angle bracket), @code{>>} operator (I/O)
@cindex right angle bracket (@code{>}), @code{>>} operator (I/O)
@item print @var{items} >> @var{output-file}
è¿™ä¸ªç±»å‹çš„é‡å®šå‘å°†é¡¹ç›®è¾“å‡ºåˆ°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„åä¸º @var{output-file} çš„æ–‡ä»¶ä¸­ã€‚
è¿™ä¸ªç”¨æ³•ä¸å•ä¸ªçš„ @samp{>} çš„é‡å®šå‘æœ‰ä¸åŒæ—¶ï¼Œ@var{output-file} æ–‡ä»¶ä¸­çš„æ—§å†…å®¹ï¼ˆå¦‚æœæœ‰ï¼‰ä¸ä¼šè¢«æ¸…ç©ºã€‚
@command{awk} çš„è¾“å‡ºä¼šé™„åŠ åˆ°æ–‡ä»¶ä¸­ã€‚å¦‚æœ @var{output-file} æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒã€‚

@cindex @code{|} (vertical bar), @code{|} operator (I/O)
@cindex pipe, output
@cindex output, pipes
@item print @var{items} | @var{command}
é€šè¿‡ç®¡é“å¯ä»¥å°†è¾“å‡ºå®šå‘åˆ°ä¸€ä¸ªå¦ä¸€ä¸ªç¨‹åºè€Œä¸æ˜¯æ–‡ä»¶ã€‚è¿™ä¸ªæ–¹å¼çš„é‡å®šå‘ä¼šå‘ @var{command} æ‰“å¼€ä¸€ä¸ªç®¡é“ï¼Œ
ç„¶åå°† @var{items} çš„å€¼é€šè¿‡ä¸ºæ‰§è¡Œçš„ @var{command} åˆ›å»ºçš„ç®¡é“å†™åˆ°å’–ä¸€ä¸ªç¨‹åºä¸­ã€‚

é‡å®šå‘å‚æ•° @var{command} å®é™…æ˜¯æ˜¯ä¸€ä¸ª @command{awk} è¡¨è¾¾å¼ã€‚
å®ƒçš„å€¼ä¼šè¢«è½¬æ¢æˆè¦æ‰§è¡Œçš„ Shell å‘½ä»¤çš„å­—ä¸²ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ä¼šäº§ç”Ÿä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯æœªæ’åºçš„äººåï¼Œä¸€ä¸ªæŒ‰å­—æ¯å€’åºå¯¹äººåè¿›è¡Œæ’åˆ—ï¼š

@ignore
10/2000:
record.  It's done to avoid overfull hboxes in TeX.  Leave it
alone for now and let's hope no-one notices.
@end ignore

@example
awk '@{ print $1 > "names.unsorted"
       command = "sort -r > names.sorted"
       print $1 | command @}' mail-list
@end example

æœªæ’åºçš„åˆ—è¡¨æŒ‰ç…§å¸¸è§„çš„æ–¹å¼è¿›è¡Œé‡å®šå‘ï¼Œè€Œæ’åºçš„åˆ—è¡¨åˆ™é€šè¿‡ç®¡é“å‘ @command{sort} å·¥å…·è¾“å‡ºã€‚

ä¸‹ä¸ªä¾‹å­åˆ©ç”¨é‡å®šå‘å°†æ¶ˆæ¯é€šè¿‡é‚®ä»¶åˆ—è¡¨ç³»ç»Ÿé‚®å¯„å‡ºå»ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨ä¸€ä¸ªå‘¨æœŸæ‰§è¡Œçš„ç³»ç»Ÿç»´æŠ¤ @command{awk} è„šæœ¬ä¸­é‡åˆ°é—®é¢˜æ—¶ï¼Œéå¸¸æœ‰ç”¨ï¼š

@example
report = "mail bug-system"
print("Awk script failed:", $0) | report
print("at record number", FNR, "of", FILENAME) | report
close(report)
@end example

@code{close()} å‡½æ•°åœ¨è¿™é‡Œè°ƒç”¨ï¼Œæ˜¯å› ä¸ºåœ¨å°†æ‰€æœ‰çš„è¾“å‡ºå†™åˆ°ç®¡é“åå…³é—­å®ƒæ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹å®è·µã€‚
æŸ¥çœ‹ @ref{Close Files And Pipes}ï¼Œæ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚

è¿™ä¸ªä¾‹å­ä¹Ÿè¯´æ˜äº†åˆ©ç”¨å˜é‡æ¥è¡¨ç¤º @var{file} æ–‡ä»¶æˆ–è€… @var{command} å‘½ä»¤
â€”â€”æ²¡æœ‰å¿…è¦æ€»æ˜¯ç”¨å­—ä¸²å¸¸é‡æ¥è¡¨ç¤ºå®ƒä»¬ã€‚
ä½¿ç”¨å˜é‡ä¸€èˆ¬æ¥è¯´æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºï¼ˆå¦‚æœä½ è¦ç”¨ç›¸åŒçš„åå­—æˆ–è€…å‘½ä»¤ï¼‰@command{awk} éœ€è¦æ¯æ¬¡éƒ½è¦å†™ç›¸åŒçš„å­—ä¸²ã€‚

@cindex coprocesses
@cindex @code{|} (vertical bar), @code{|&} operator (I/O)
@cindex operators, input/output
@cindex differences in @command{awk} and @command{gawk}, input/output operators
@item print @var{items} |& @var{command}
è¿™ä¸ªé‡å®šå‘å°†é¡¹ç›®æ‰“å°åˆ° @var{command} çš„è¾“å…¥ä¸­ã€‚
è¿™ä¸ªæ–¹å¼ä¸å•ä¸ª @samp{|} é‡å®šå‘çš„ä¸åŒæ˜¯ï¼Œè¿™é‡Œçš„ @var{command} è¾“å‡ºå¯ä»¥ç”¨ @code{getline} è¿›è¡Œè¯»å–ã€‚
å› æ­¤ï¼Œcommand æ˜¯ä¸€ä¸ª@dfn{å¹¶ç¨‹}ï¼Œå³ä¸ @command{awk} ä¸€èµ·æ‰§è¡Œï¼Œä½†æ˜¯åªä½œä¸º @command{awk} ç¨‹åºçš„è¡¥å……ã€‚

è¿™ä¸ªç‰¹æ€§æ˜¯ @command{gawk} çš„æ‰©å±•ï¼Œåœ¨ POSIX ç±»å‹çš„ @command{awk} æ˜¯ä¸å¯ç”¨çš„ã€‚
@ifnotdocbook
æŸ¥çœ‹ @ref{Getline/Coprocess}ï¼Œæ¥è·å–ç®€å•çš„è¯´æ˜ï¼ŒæŸ¥çœ‹ @ref{Two-way I/O}ï¼Œæ¥è·å–æ›´å…¨é¢çš„è®¨è®ºã€‚
@end ifnotdocbook
@ifdocbook
æŸ¥çœ‹ @ref{Getline/Coprocess} ä¸­æœ‰ç®€è¦çš„è®¨è®ºï¼Œä»¥åŠ
 @ref{Two-way I/O} ä¸­æœ‰æ›´å®Œæ•´çš„è®¨è®ºã€‚
@end ifdocbook
@end table

ä½¿ç”¨ @samp{>}ï¼Œ@samp{>>}ï¼Œ@samp{|} æˆ–è€… @samp{|&} è¯·ç¤ºç³»ç»Ÿæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ã€ç®¡é“æˆ–è€…å¹¶ç¨‹ï¼Œ
åªè¦ä½ æ‰€æŒ‡å®šçš„ @var{file} æ–‡ä»¶æˆ–è€… @var{command} å‘½ä»¤è¿˜æ²¡æœ‰è¢«ä½ çš„ç¨‹åºå†™å…¥ï¼Œåˆæˆ–è€…å®ƒå·²ç»åœ¨æœ€åä¸€æ¬¡å†™å…¥åå…³é—­äº†ã€‚

@cindex troubleshooting, printing
ä½¿ç”¨ @samp{>} é‡å®šå‘å…ˆæ‰“å°åˆ°æ–‡ä»¶ï¼Œç„¶åç”¨ @samp{>>} ä¸ºåç»­çš„è¾“å‡ºæ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ï¼š

@example
# clear the file
print "Don't panic" > "guide.txt"
@dots{}
# append
print "Avoid improbability generators" >> "guide.txt"
@end example

@noindent
åœ¨ Shell ä¸­ç¡®å®æ˜¯è¿™ä¹ˆé‡å®šå‘çš„ã€‚ä½†æ˜¯åœ¨ @command{awk} ä¸­ï¼Œå´æ²¡æœ‰å¿…è¦ã€‚
åœ¨è¿™å’±æƒ…å†µä¸‹ï¼Œç¨‹åºåº”è¯¥åœ¨æ‰€æœ‰çš„ @code{print} è¯­å¥ä¸Šä½¿ç”¨ @samp{>}ï¼Œå› ä¸ºè¾“å‡ºæ–‡ä»¶åªä¼šæ‰“å¼€ä¸€æ¬¡ã€‚
ï¼ˆåœ¨æ··åˆä½¿ç”¨ @samp{>} ä¸ @samp{>>} æ—¶ï¼Œä¹Ÿæ˜¯æ‰“å¼€ä¸€æ¬¡ã€‚ä½†æ˜¯ï¼Œæ··ç”¨æ“ä½œç¬¦æ˜¯ä¸€ç§ç³Ÿç³•çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œä¼šè®©ä½ ç¨‹åºçš„è¯»å–å›°æƒ‘ã€‚ï¼‰

@cindex differences in @command{awk} and @command{gawk}, implementation limitations
@cindex implementation issues, @command{gawk}, limits
@cindex @command{awk}, implementation issues, pipes
@cindex @command{gawk}, implementation issues, pipes
@ifnotinfo
å¦‚æ—©å‰æ‰€è¿°ï¼ˆæŸ¥çœ‹ @ref{Getline Notes}ï¼‰ï¼Œè®¸å¤šçš„ @command{awk} å®ç°é™åˆ¶äº† @command{awk} ç¨‹åºå¯ä»¥æ‰“å¼€çš„ç®¡çº¿æ•°é‡ä¸ºä¸€ä¸ªï¼
@command{gawk} åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚@command{gawk} å¯ä»¥æ‰“å¼€çš„ç®¡çº¿çš„æ•°é‡åªèƒ½æ‰€åœ¨çš„æ“ä½œç³»ç»Ÿçš„é™åˆ¶ã€‚

@sidebar ç®¡é“è¾“å‡ºåˆ° @command{sh}
@cindex shells, piping commands into

ä¸€ç§ä½¿ç”¨é‡å®šå‘çš„å¼ºå¤§æ–¹å¼æ˜¯æ„é€ ä¸€ä¸ªå‘½ä»¤è¡Œï¼Œç„¶åå°†ç”¨ç®¡é“è¾“å‡ºåˆ° Shellï¼Œsh ä¸­ã€‚
ä¾‹å¦‚ï¼Œä½ æœ‰ä¸€å †çš„æ–‡ä»¶æ˜¯ä»å…¶ä»–ç³»ç»Ÿä¸­å–æ¥çš„ï¼Œå¹¶ä¸”@value{FN}éƒ½ä»¥å¤§å†™å­˜å‚¨ï¼Œ
è€Œä½ æƒ³æŠŠä»–ä»¬å…¨éƒ¨æ”¹æˆå°å†™çš„ã€‚ä¸‹é¢çš„ç¨‹åºå³ç®€å•ä¹Ÿå¾ˆé«˜æ•ˆï¼š

@c @cindex @command{mv} utility
@example
@{ printf("mv %s %s\n", $0, tolower($0)) | "sh" @}

END @{ close("sh") @}
@end example

@code{tolower()} å‡½æ•°è¿”å›å‚æ•°å­—ä¸²ä¸­æ‰€æœ‰çš„å¤§å†™å­—æ¯è¢«è½¬æ¢ä¸ºå°å†™çš„ä¸²ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚
ç¨‹åºæ„å»ºäº†ä¸€ç³»åˆ—çš„å‘½ä»¤è¡Œï¼Œå¹¶ä½¿ç”¨ @command{mv} å·¥å…·å¯¹æ–‡ä»¶è¿›è¡Œæ”¹åï¼Œç„¶åå°†è¿™äº›å‘½ä»¤åˆ—è¡¨å‘é€ç»™ Shell æ‰§è¡Œã€‚

æŸ¥çœ‹ @ref{Shell Quoting}ï¼Œäº†è§£å¯ä»¥è¾…åŠ©äº§ç”Ÿå¯ä»¥å‘é€åˆ° Shell çš„å‘½ä»¤è¡Œå‡½æ•°ã€‚
@end sidebar

@node Special FD
@section æ ‡å‡†çš„é¢„æ‰“å¼€çš„ç‰¹æ®Šæ–‡ä»¶æ•°æ®æµ
@cindex standard input
@cindex input, standard
@cindex standard output
@cindex output, standard
@cindex error output
@cindex standard error
@cindex file descriptors
@cindex files, descriptors, See file descriptors

ä¸€èˆ¬åœ°ï¼Œæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºå·²ç»æœ‰ä¸‰ä¸ªè¾“å…¥è¾“å‡ºæµå¯ä»¥ç”¨æ¥è¿›è¡Œè¯»å†™ã€‚
è¿™å°±æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„@dfn{æ ‡å‡†è¾“å…¥}ï¼Œ@dfn{æ ‡å‡†è¾“å‡º}ä»¥åŠ@dfn{æ ‡å‡†é”™è¯¯è¾“å‡º}ã€‚
è¿™äº›å·²ç»æ‰“å¼€çš„æµï¼ˆä»¥åŠä»»æ„å·²ç»æ‰“å¼€çš„æ–‡ä»¶æˆ–è€…ç®¡é“ï¼‰æŠ€æœ¯ä¸Šå¯ä»¥ç”±æ‰€è°“çš„@dfn{æ–‡ä»¶æè¿°ç¬¦}æ¥è¡¨ç¤ºã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æµæ˜¯ä½ çš„é”®ç›˜ä¸ä½ çš„å±å¹•ï¼Œä½†æ˜¯ä»–ä»¬å¸¸å¸¸é€šè¿‡ @samp{<}ï¼Œ@samp{<<}ï¼Œ@samp{>}ï¼Œ@samp{>>}ï¼Œ@samp{>&} ä¸ @samp{|} æ“ä½œç¬¦ï¼Œåœ¨ Shell ä¸­è¢«é‡å®šå‘ã€‚
æ ‡å‡†é”™è¯¯ä¸€è‚¡ç”¨äºå†™é”™è¯¯ä¿¡æ¯ï¼Œæœ‰ä¸¤ä¸ªåˆ†ç¦»æµï¼ˆæ ‡å‡†è¾“å‡ºä¸æ ‡å‡†é”™è¯¯è¾“å‡ºï¼‰çš„åŸå› æ˜¯å®ƒä»¬å¯ä»¥è¢«å•ç‹¬åœ°è¿›è¡Œé‡å®šå‘ã€‚

@cindex differences in @command{awk} and @command{gawk}, error messages
@cindex error handling
åœ¨ @command{awk} çš„ä¼ ç»Ÿå®ç°ä¸­ï¼Œåœ¨ @command{awk} ç¨‹åºä¸­å°†é”™è¯¯ä¿¡æ¯å†™åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºçš„å”¯ä¸€æ–¹å¼å¦‚ä¸‹ï¼š

@example
print "Serious error detected!" | "cat 1>&2"
@end example

@noindent
é€šè¿‡æ‰“å¼€ä¸€ä¸ªåˆ° Shell å‘½ä»¤çš„ç®¡çº¿ï¼Œè€Œè¯¥å‘½ä»¤å¯ä»¥è®¿é—®ä» @command{awk} ç»§æ‰¿è€Œæ¥çš„æ ‡å‡†é”™è¯¯æµã€‚
@c 8/2014: Mike Brennan says not to cite this as inefficient. So, fixed.
è¿™æ ·å†™æ²¡é‚£ä¹ˆä¼˜é›…ï¼Œè€Œä¸”ä¹Ÿéœ€è¦å¼€å¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚å› æ­¤ï¼Œäººä»¬åœ¨ @command{awk} ç¨‹åºä¸å¸¸è¿™ä¹ˆå¹²ï¼Œè€Œæ˜¯é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥è¾“å‡ºä¿¡æ¯åˆ°å±å¹•ï¼š

@example
print "Serious error detected!" > "/dev/tty"
@end example

@noindent
ï¼ˆ@file{/dev/tty} æ˜¯ä¸€ä¸ªç”±æ“ä½œç³»ç»Ÿæä¾›çš„ç‰¹æ®Šæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸ä½ çš„é”®ç›˜ä¸å±å¹•è¿æ¥ã€‚å®ƒè¡¨ç¤ºçš„æ˜¯â€œç»ˆç«¯â€ ï¼ˆTerminalï¼‰ï¼Œ
@footnote{åœ¨ @file{/dev/tty} ä¸­çš„â€œttyâ€ä»£è¡¨çš„æ˜¯â€œTeletypeâ€ï¼ˆç”µä¼ æ‰“å­—æœºï¼‰ï¼Œæ˜¯ä¸€ç§ä¸²è¡Œç»ˆç«¯}
åœ¨ç°åœ¨ç³»ç»Ÿä¸­æ˜¯é”®ç›˜ä¸å±å¹•ï¼Œè€Œä¸æ˜¯ä¸²è¡Œæ§åˆ¶å°ã€‚ï¼‰è¿™ä¸€èˆ¬æœ‰ç›¸åŒçš„æ•ˆæœï¼Œä½†æ˜¯å¹¶ä¸æ€»æ˜¯å¦‚æ­¤ï¼š
å°½ç®¡æ ‡å‡†é”™è¯¯è¾“å‡ºä¸€èˆ¬å°±æ˜¯å±å¹•ï¼Œä½†æ˜¯å®ƒå¯ä»¥è¢«é‡å®šå‘ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå†™åˆ°å±å¹•å°±ä¸æ­£ç¡®äº†ã€‚äº‹å®ä¸Šï¼Œå¦‚æœ @command{awk} æ˜¯ä¸€ä¸ªåå°ä»»åŠ¡ï¼Œå®ƒæ ¹æœ¬ä¸»æ²¡æœ‰ç»ˆç«¯ã€‚è¿™æ ·ï¼Œæ‰“å¼€ @file{/dev/tty} å°±ä¼šå¤±è´¥ã€‚

@command{gawk}ï¼ŒBWK @command{awk} ä»¥åŠ @command{mawk} æä¾›äº†è®¿é—®ä¸‰ä¸ªæ ‡å‡†æµçš„ç‰¹æ®Š@value{FN}ã€‚
å¦‚æœ @command{gawk} åœ¨é‡å®šå‘è¾“å…¥è¾“å‡ºæ—¶ï¼Œ@value{FN}åŒ¹é…è¿™å…¶ä¸­ä¹‹ä¸€ï¼Œå®ƒå°±ç›´æ¥ä½¿ç”¨è¿™ä¸ª@value{FN}æ‰€ä»£è¡¨çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
è¿™æ­¤ç‰¹æ®Š@value{FN}åœ¨æ‰€æœ‰çš„ @command{gawk} å·²ç»ç§»æ¤åˆ°çš„æ“ä½œç³»ç»Ÿä¸­éƒ½æœ‰æ•ˆï¼Œå¹¶ä¸ä»…ä»…æ˜¯ POSIX å…¼å®¹çš„ç³»ç»Ÿï¼š

@cindex common extensions, @code{/dev/stdin} special file
@cindex common extensions, @code{/dev/stdout} special file
@cindex common extensions, @code{/dev/stderr} special file
@cindex extensions, common@comma{} @code{/dev/stdin} special file
@cindex extensions, common@comma{} @code{/dev/stdout} special file
@cindex extensions, common@comma{} @code{/dev/stderr} special file
@cindex file names, standard streams in @command{gawk}
@cindex @code{/dev/@dots{}} special files
@cindex files, @code{/dev/@dots{}} special files
@cindex @code{/dev/fd/@var{N}} special files (@command{gawk})
@table @file
@item /dev/stdin
æ ‡å‡†è¾“å…¥ï¼ˆæ–‡ä»¶æè¿°ç¬¦ä¸º 0ï¼‰ã€‚

@item /dev/stdout
æ ‡å‡†è¾“å‡ºï¼ˆæ–‡ä»¶æè¿°ç¬¦ä¸º 1ï¼‰ã€‚

@item /dev/stderr
æ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆæ–‡ä»¶æè¿°ç¬¦ 2ï¼‰ã€‚
@end table

å¤ç”¨è¿™äº›å·¥å…·ï¼Œæ°å½“çš„å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºçš„æ–¹å¼å°±å¦‚ä¸‹ï¼š

@example
print "Serious error detected!" > "/dev/stderr"
@end example

@cindex troubleshooting, quotes with file names
æ³¨æ„åœ¨æ–‡ä»¶ä¸Šä½¿ç”¨çš„åŒå¼•å·ã€‚å¦‚å…¶ä»–çš„é‡å®šå‘ï¼Œå…¶å€¼å¿…é¡»æ˜¯å­—ä¸²ã€‚å¸¸è§çš„é”™è¯¯å°±æ˜¯çœç•¥äº†å¼•å·ï¼Œæ²¡æœ‰å¼•å·ä¼šäº§ç”Ÿä»¤äººç–‘æƒ‘çš„ç»“æœã€‚

@command{gawk} åœ¨ POSIX å…¼å®¹æ¨¡å¼ä¸‹ï¼Œå¹¶ä¸å°†è¿™äº›æ–‡å¥ç‰¹æ®Šå¯¹å¾…ã€‚ä½†æ˜¯ï¼Œå› ä¸º BWK @command{awk} æ”¯æŒå®ƒä»¬ï¼Œ
@command{gawk} ä¹Ÿæ”¯æŒå®ƒä»¬ï¼Œå°±ç®—ä½¿ç”¨äº† @option{--traditional} é€‰é¡¹ä¹Ÿæ˜¯ä¸€æ ·
ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚

@node Special Files
@section @command{gawk} ä¸­çš„ç‰¹æ®Š@value{FFN}
@cindex @command{gawk}, file names in

é™¤äº†æ ‡å‡†è¾“å…¥ï¼Œæ ‡å‡†è¾“å‡ºä¸æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œ
@command{gawk} è¿˜æä¾›äº†è®¿é—®ä»»æ„å·²ç»æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„æ–¹æ³•ã€‚å¦å¤–ï¼Œè¿˜ä¿ç•™äº†ç”¨äº TCP/IP ç½‘ç»œçš„ç‰¹æ®Š@value{FN}ã€‚

@menu
* Other Inherited Files::       Accessing other open files with
                                @command{gawk}.
* Special Network::             Special files for network communications.
* Special Caveats::             Things to watch out for.
@end menu

@node Other Inherited Files
@subsection åœ¨ @command{gawk} è®¿é—®å…¶ä»–å·²å¼€æ–‡ä»¶

é™¤äº† @code{/dev/stdin}ï¼Œ@code{/dev/stdout}ï¼Œä¸ @code{/dev/stderr} è¿™äº›æ—©å‰æè¿‡çš„ç‰¹æ®Š@value{FN}å¤–ï¼Œ
@command{gawk} è¿˜æä¾›äº†è®¿é—®å·²ç»æ‰“å¼€çš„æ–‡ä»¶çš„è¯­æ³•ï¼š

@table @file
@item /dev/fd/@var{N}
ä¸æ–‡ä»¶æè¿°ç¬¦ @var{N} å…³è”çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å¿…é¡»ç”±å¯åŠ¨ @command{awk} ç¨‹åºæ‰§è¡Œçš„ç¨‹åºï¼ˆä¸€èˆ¬æ˜¯ Shell ï¼‰æ‰“å¼€çš„æ–‡ä»¶ã€‚
é™¤éåœ¨è°ƒç”¨ @command{gawk} çš„ Shell ä¸­å¤šèŠ±ä¸€äº›åŠŸå¤«ï¼Œä¸ç„¶åªä¼šæœ‰æè¿°ç¬¦ 0ï¼Œ1 ä¸ 2 æ˜¯æ‰“å¼€çš„ã€‚
@end table

@value{FN} @file{/dev/stdin}ï¼Œ@file{/dev/stdout}ï¼Œä¸ @file{/dev/stderr} å®é™…ä¸Šå°±æ˜¯ @file{/dev/fd/0}ï¼Œ@file{/dev/fd/1}ï¼Œ
ä¸ @file{/dev/fd/2} çš„åˆ«åã€‚ä½†æ˜¯ï¼Œè¿™äº›åå­—æ›´æœ‰è¯´æ˜æ€§ã€‚

æ³¨æ„ï¼Œå¯¹äºæ–‡ä»¶æè¿°ç¬¦å·å¤§äº 2 ä»¥ä¸Šçš„@value{FN}å½¢å¼ @code{"/dev/fd/@var{N}"} æ‰§è¡Œ @code{close()} å‡½æ•°ï¼Œ
æ‰ä¼šçœŸæ­£åœ°æ‰§è¡Œå…³é—­ï¼ˆcloseï¼‰æ“ä½œã€‚

@node Special Network
@subsection ç”¨äºç½‘ç»œçš„ç‰¹æ®Šæ–‡ä»¶
@cindex networks, support for
@cindex TCP/IP, support for

@command{gawk} ç¨‹åºå¯ä»¥æ‰“å¼€åŒå‘é€šä¿¡çš„ TCP/IP è¿æ¥ï¼Œæ­£å¦‚ä¸€ä¸ªå®¢æˆ·ç«¯ä¸ä¸€ä¸ªæœåŠ¡ç«¯ä¸€æ ·ã€‚
è¿™å¯ä»¥é€šè¿‡ä¸‹é¢å½¢å¼çš„ç‰¹æ®Š@value{FN}æ¥å®ç°ï¼š

@example
@file{/@var{net-type}/@var{protocol}/@var{local-port}/@var{remote-host}/@var{remote-port}}
@end example

@var{net-type} æ˜¯ @samp{inet}ï¼Œ@samp{inet4}ï¼Œ æˆ–è€… @samp{inet6} ä¹‹ä¸€ã€‚
@var{protocol} æ˜¯ @samp{tcp} æˆ–è€… @samp{udp} ä¹‹ä¸€ï¼Œå…¶ä»–çš„å‚æ•°åˆ™ä»£è¡¨äº†è¦å¯åŠ¨ä¸€ä¸ªç½‘ç»œè¿æ¥æ‰€éœ€è¦çš„å…¶ä»–ä¿¡æ¯ã€‚
è¿™äº›æ–‡ä»¶åä¸ @samp{|&} ä¸€èµ·ä½¿ç”¨ç”¨æ¥è¿›è¡Œå¹¶ç¨‹é€šä¿¡ï¼ˆæŸ¥çœ‹ @ref{Two-way I/O}ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œä¸ºäº†å®Œæ•´æ€§åœ¨è¿™é‡Œå…ˆè¯´æ˜ä¸€ä¸‹ã€‚å®Œæ•´çš„è®¨è®ºè¦åˆ° @ref{TCP/IP Networking}ã€‚

@node Special Caveats
@subsection ç‰¹æ®Š@value{FFN}è¯´æ˜

å¦‚æœè¦ä½¿ç”¨ @command{gawk} æä¾›çš„ä¸€äº›ç‰¹æ®Š@value{FN}ï¼Œåˆ™ä¸‹é¢æœ‰ä¸€äº›è¦è®°ä½çš„ç‚¹ï¼š

@itemize @value{BULLET}
@cindex compatibility mode (@command{gawk}), file names
@cindex file names, in compatibility mode
@item
å¯¹äºä¸‰ä¸ªé¢„æ‰“å¼€çš„æ ‡å‡†@value{FN}çš„è¯†åˆ«åªæœ‰åœ¨ POSIX æ¨¡å¼ä¸‹æ‰ä¼šè¢«ç¦æ­¢ã€‚

@item
å¯¹äºå…¶ä»–ç‰¹æ®Šæ–‡ä»¶åçš„è¯†åˆ«ï¼Œåªæœ‰ @command{gawk} å¤„äºå…¼å®¹æ¨¡å¼æ—¶æ‰ä¼šè¢«ç¦æ­¢ï¼ˆè¦ä¹ˆä½¿ç”¨ @option{--traditional} ï¼Œ
è¦ä¹ˆæ˜¯ä½¿ç”¨ @option{--posix} é€‰é¡¹ï¼ŒæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚

@item
@command{gawk} @emph{æ€»æ˜¯}ä¼šè§£é‡Šè¿™äº›ç‰¹æ®Šæ–‡ä»¶åã€‚
ä¾‹å¦‚ï¼Œä½¿ç”¨ @samp{/dev/fd/4} ä¸ºè¾“å‡ºï¼Œå®é™…ä¸Šå†™å…¥çš„æ˜¯æè¿°ç¬¦ä¸º 4 çš„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ @code{dup()} å¤åˆ¶ 4 æè¿°ç¬¦çš„æ–°æ–‡ä»¶ã€‚
å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯ï¼Œ@emph{ä¸è¦}å…³é—­ä»»æ„ä¸æ–‡ä»¶æè¿°ç¬¦ 0ï¼Œ1ï¼Œ2 ç›¸å…³çš„æ–‡ä»¶ï¼Œè¿™ä¸ªç›¸å½“é‡è¦ã€‚è¿™ä¹ˆåšçš„è¯ï¼Œä¼šå¯¼è‡´ä¸å¯é¢„çŸ¥çš„è¡Œä¸ºã€‚
@end itemize

@node Close Files And Pipes
@section å…³é—­è¾“å…¥è¾“å‡ºé‡å®šå‘
@cindex files, output, See output files
@cindex input files, closing
@cindex output, files@comma{} closing
@cindex pipe, closing
@cindex coprocesses, closing
@cindex @code{getline} command, coprocesses@comma{} using from

åœ¨ @command{awk} ç¨‹åºæ‰§è¡ŒæœŸé—´ï¼Œå¦‚æœåŒæ ·çš„æ–‡ä»¶åæˆ–è€…åŒä¸€ä¸ª Shell å‘½ä»¤è¢« @code{getline} ä½¿ç”¨è¿‡å¤šäºä¸€æ¬¡
ï¼ˆæŸ¥çœ‹ @ref{Getline}ï¼‰ï¼Œåˆ™æ–‡ä»¶ï¼ˆæˆ–è€…å‘½ä»¤çš„æ‰§è¡Œï¼‰åªåœ¨ç¬¬ä¸€æ¬¡å‘ç”Ÿã€‚ä»é‚£ä»¥åï¼Œä»ä¸­è¯»å–ç¬¬ä¸€ä¸ªè¾“å…¥è®°å½•ã€‚
é€šè¿‡ @code{getline} å†æ¬¡è¯»å–åŒä¸€ä¸ªæ–‡ä»¶æˆ–è€…å‘½ä»¤æ—¶ï¼Œç¬¬äºŒæ¡è®°å½•ä»å…¶ä¸­è·å–ï¼Œä»¥æ­¤ç±»æ¨ã€‚

ç›¸ä¼¼åœ°ï¼Œå½“æ–‡ä»¶æˆ–è€…ç®¡é“è¢«æ‰“å¼€ç”¨äºè¾“å‡ºæ—¶ï¼Œ@command{awk} ä¼šè®°å½•@value{FN}æˆ–è€…ä¸å…¶ç›¸å…³çš„å‘½ä»¤ï¼Œåç»­å¯¹äºåŒä¸€ä¸ªæ–‡ä»¶æˆ–è€…å‘½ä»¤å†™å…¥ï¼Œä¼šè¢«é™„åŠ åˆ°å‰ä¸€ä¸ªå†™æ“ä½œä¹‹åã€‚ç›´åˆ° @command{awk} é€€å‡ºåï¼Œæ–‡ä»¶æˆ–è€…ç®¡é“æ‰ä¼šè¢«å…³é—­ã€‚

@cindexawkfunc{close}
è¿™æ„æ€æ˜¯è¯´ï¼Œä¸ºäº†å†æ¬¡ä»å¤´å¼€å§‹è¯»å–åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…é‡æ–°æ‰§è¡Œä¸€ä¸ª Shell å‘½ä»¤ï¼Œä½ éœ€è¦ä¸€äº›ç‰¹åˆ«æ­¥éª¤ï¼ˆè€Œä¸æ˜¯ä»åŒä¸€ä¸ªå‘½ä»¤ä¸­è¯»å–æ›´å¤šçš„è¾“å‡ºï¼‰ã€‚
@code{close()} å‡½æ•°å°±æ˜¯ç”¨æ¥æ‰§è¡Œè¿™ä¸ªæ­¥éª¤ï¼š

@example
close(@var{filename})
@end example

@noindent
æˆ–è€…ï¼š

@example
close(@var{command})
@end example

@var{filename} ä¸ @var{command} å‚æ•°å¯ä»¥æ˜¯ä»»æ„çš„è¡¨è¾¾å¼ã€‚
å®ƒçš„å€¼å¿…é¡»@emph{å®Œå…¨}åŒ¹é…ç”¨ä»¥æ‰“å¼€çš„æ–‡ä»¶æˆ–è€…å¯åŠ¨çš„å‘½ä»¤è¡Œçš„å­—ä¸²ï¼ˆç©ºæ ¼ä¸å…¶ä»–â€œæ— å…³â€çš„å­—ç¬¦ä¹ŸåŒ…æ‹¬åœ¨å†…ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åƒè¿™æ ·æ‰“å¼€ä¸€ä¸ªç®¡é“ï¼š

@example
"sort -r names" | getline foo
@end example

@noindent
ç„¶åä½ å¿…é¡»è¿™æ ·æ¥å…³é—­å®ƒï¼š

@example
close("sort -r names")
@end example

åªè¦å‡½æ•°è°ƒç”¨æ‰§è¡Œè¿‡ï¼Œä¸‹ä¸€ä¸ªä»é‚£ä¸ªæ–‡ä»¶æˆ–è€…ç®¡é“è¿›è¡Œ @code{getline} æ—¶ï¼Œ
æˆ–è€…ä¸‹ä¸€ä¸ª @code{print} ä¸ @code{printf} åˆ°é‚£ä¸ªæ–‡ä»¶æˆ–è€…ç®¡é“ï¼Œä¼šè¢«é‡æ–°æ‰“å¼€æˆ–è€…é‡æ–°æ‰§è¡Œå‘½ä»¤ã€‚
ç”±äºä½ ç”¨æ¥å…³é—­çš„æ–‡ä»¶æˆ–è€…ç®¡çº¿å¿…é¡»å®Œå…¨åŒ¹é…ä½ ç”¨æ¥æ‰“å¼€çš„æ–‡ä»¶æˆ–è€…æ‰§è¡Œçš„å‘½ä»¤ï¼Œ
æ‰€ä»¥ç”¨ä¸€ä¸ªå˜é‡æ¥å­˜å‚¨@value{FN}æˆ–è€…å‘½ä»¤æ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹å®è·µã€‚ä¸Šé¢çš„ä¾‹å­å› æ­¤å¯ä»¥å˜æˆè¿™æ ·ï¼š

@example
sortcom = "sort -r names"
sortcom | getline foo
@dots{}
close(sortcom)
@end example

@noindent
è¿™å¯ä»¥å¸®åŠ©ä½ é¿å… @command{awk} ç¨‹åºä¸­é‚£äº›å¾ˆéš¾æŸ¥æ‰¾çš„è¾“å‡ºé”™è¯¯ã€‚è¿™ä¹Ÿæœ‰ä¸€äº›ç†ç”±ä¸ºä»€ä¹ˆè¦å…³é—­è¾“å‡ºæ–‡ä»¶ï¼š

@itemize @value{BULLET}
@item
ä¸ºäº†å†™è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¹‹åä¼šåœ¨åŒä¸€ä¸ª @command{awk} ç¨‹åºä¸­è¯»å–å®ƒã€‚
åœ¨å†™å®Œä¹‹åè¦å…³é—­å®ƒï¼Œç„¶åå†ä½¿ç”¨ @code{getline} è¿›è¡Œè¯»å–ã€‚

@item
ä¸ºäº†åœ¨ @command{awk} ç¨‹åºä¸­ï¼Œè¿ç»­åœ°å†™å¤§é‡çš„æ–‡ä»¶ã€‚
å¦‚æœæ–‡ä»¶æ²¡æœ‰è¢«å…³é—­ï¼Œ@command{awk} æœ‰å¯èƒ½æœ€ç»ˆä¼šè¶…è¿‡ç³»ç»Ÿå¯¹äºåŒä¸€ä¸ªè¿›ç¨‹ä¸­æ‰€èƒ½æ‰“å¼€çš„æ–‡ä»¶æ•°çš„é™åˆ¶ã€‚å› æ­¤æœ€å¥½æ˜¯åœ¨å†™å®Œæ¯ä¸ªæ–‡ä»¶æ—¶å…³é—­å®ƒã€‚

@item
ä¸ºäº†å®Œæˆä¸€ä¸ªå‘½ä»¤ã€‚å½“è¾“å‡ºé‡å®šå‘æ˜¯é€šè¿‡ç®¡é“è¿›è¡Œçš„ã€‚
ä»è¿™ä¸ªç®¡é“è¯»å–çš„å‘½ä»¤ä¼šæŒç»­å°è¯•ä»ç®¡é“ä¸­è¯»å–ï¼Œåªè¦ç®¡é“æ˜¯æ‰“å¼€çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç›¸å…³çš„å‘½ä»¤ç›´åˆ°ç®¡é“å…³é—­çš„æƒ…å†µä¸‹æ‰èƒ½ç»§ç»­å¹²è‡ªå·±çš„äº‹æƒ…ã€‚
ä¾‹å¦‚ï¼Œå¦‚æœè¾“å‡ºè¢«é‡å®šå‘åˆ°äº† @command{mail} ç¨‹åºï¼Œæ¶ˆæ¯ç›´åˆ°ç®¡é“è¢«å…³é—­äº†æ‰å®é™…åœ°å‘é€å®Œã€‚

@item
ä¸ºäº†æ‰§è¡Œç¬¬äºŒæ¬¡ï¼Œåˆ©ç”¨ç›¸åŒçš„å‚æ•°ï¼Œæ‰§è¡Œç›¸åŒçš„ç¨‹åºã€‚è¿™ä¸æ¯”ç¬¬ä¸€æ¬¡æ‰§è¡Œè¾“å…¥æ›´å¤šçš„æ•°æ®ä¸æ˜¯ä¸€ä»¶äº‹æƒ…ï¼

ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ç§ç¨‹åºä¼šå°†è¾“å‡ºé€šè¿‡ç®¡é“è¾“å‡ºç»™ @command{mail} ç¨‹åºã€‚å¦‚æœè¾“å‡ºäº†å‡ è¡Œé‡å®šå‘åˆ°äº†è¿™ä¸ªç®¡é“è€Œæ²¡æœ‰å…³é—­ï¼Œ
åˆ™å®ƒä»¬ä¼šç”Ÿæˆä¸€ä¸ªåŒ…æ‹¬å‡ è¡Œæ•°æ®çš„ç®€å•çš„æ¶ˆæ¯ï¼ˆé‚®ä»¶ï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç¨‹åºæ¯è¾“å‡ºä¸€è¡Œå°±å…³é—­ä¸€æ¬¡ç®¡é“ï¼Œåˆ™æ¯ä¸€è¡Œéƒ½æˆä¸€ä¸ªä¸€ç‹¬ç«‹çš„æ¶ˆæ¯ï¼ˆé‚®ä»¶ï¼‰ã€‚
@end itemize

@cindex differences in @command{awk} and @command{gawk}, @code{close()} function
@cindex portability, @code{close()} function and
@cindex @code{close()} function, portability
å¦‚æœä½ ä½¿äº†æ¯”ç³»ç»Ÿæ‰€å…è®¸ä½ æ‰“å¼€çš„æ–‡ä»¶æ•°æ›´å¤šçš„æ–‡ä»¶ï¼Œ@command{gawk} ä¼šå°è¯•å¤ç”¨ä½ çš„@value{DF}ä¸­å·²ç»æ‰“å¼€çš„æ–‡ä»¶ã€‚
@command{gawk} è¿™æ ·çš„èƒ½åŠ›ä¾èµ–äºä½ çš„æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„å·¥å…·ï¼Œå› æ­¤å¹¶ä¸ä¸€å®šæ€»æ˜¯ä¼šæœ‰ç”¨ã€‚æ‰€ä»¥ï¼Œæ— è®ºå¯¹äºæ˜¯å¥½çš„å®è·µä¹Ÿå¥½ï¼Œè¿˜æ˜¯å¥½çš„å¯ç§»æ¤æ€§å»ºè®®ä¹Ÿå¥½ï¼Œå½“å¤„ç†å®Œä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œ
å°±åº”è¯¥é€šè¿‡ @code{close()} å°†å®ƒä»¬å…³é—­ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä½ ä½¿ç”¨äº†å¤§é‡çš„ç®¡é“ï¼Œåœ¨ä½¿ç”¨å®Œåè¿›è¡Œå…³é—­æ˜¯å¾ˆé‡è¦çš„ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼š

@example
@{
    @dots{}
    command = ("grep " $1 " /some/file | my_prog -q " $3)
    while ((command | getline) > 0) @{
        @var{process output of} command
    @}
    # need close(command) here
@}
@end example

åœ¨è¿™ä¸ªä¾‹å­ä¸­åˆ›å»ºäº†åŸºäºæ¯ä¸ªè®°å½•çš„ç®¡çº¿ï¼Œå¦‚æ³¨é‡Šä¸­æ‰€è¿°çš„ï¼Œæ²¡æœ‰è°ƒç”¨ @code{close()} å‡½æ•°ï¼Œ
åˆ™ @command{awk} ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ï¼Œç›´åˆ°æœ€ç»ˆç”±äºè¯·æ±‚æ›´å¤šçš„ç®¡çº¿è€Œè€—å°½æ–‡ä»¶æè¿°ç¬¦ã€‚

å°½ç®¡æ¯ä¸ªå‘½ä»¤éƒ½å·²ç»æ‰§è¡Œå®Œæˆï¼ˆé€šè¿‡ @code{getline} çš„ end-of-file çš„è¿”å›å€¼æŒ‡ç¤ºï¼‰ï¼Œå­è¿›ç¨‹å´æ²¡æœ‰ç»“æŸï¼›
@footnote{æŠ€æœ¯æœ¯è¯­åº”è¯¥æ˜¯ç—…æ€è¿›ç¨‹ï¼ˆmorbidï¼‰ï¼Œå·²ç»å®Œæˆçš„å­è¿›ç¨‹ç§°ä¸ºâ€œåƒµå°¸è¿›ç¨‹ï¼ˆzombieï¼‰â€ï¼Œé€šè¿‡â€œå›æ”¶ï¼ˆreapingï¼‰â€åï¼Œè¿›ç¨‹å°±ä¼šè¢«æ¸…ç†ã€‚}
@c Good old UNIX: give the marketing guys fits, that's the ticket
æ›´é‡è¦çš„æ˜¯ï¼Œä¸ç®¡é“å…³è”çš„æè¿°ç¬¦ç›´åˆ° @command{awk} é€€å‡ºåï¼Œæ‰ä¼šè°ƒç”¨ @code{close()} è¿›è¡Œå…³é—­é‡Šæ”¾ã€‚

@code{close()} å¦‚æœæ¥æ”¶çš„ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€ç®¡é“æˆ–è€…å¹¶ç¨‹è¿™æ ·çš„æ‰“å¼€ç”¨äºé‡å®šå‘çš„å‚æ•°ï¼Œåˆ™é»˜é»˜åœ°ä»€ä¹ˆä¹Ÿä¸å¹²ã€‚
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯è´Ÿå€¼ï¼Œè¡¨ç¤ºé”™è¯¯ã€‚å¦å¤–ï¼Œ@command{gawk} ä¼šè®¾ç½® @code{ERRNO} çš„å€¼ä¸ºæŒ‡ç¤ºå¯¹åº”çš„é”™è¯¯ã€‚

ä¹Ÿè¦æ³¨æ„åˆ° @samp{close(FILENAME)}ï¼Œé’ˆå¯¹ä»å‘½ä»¤è¡Œä¸­è¯»å–æ–‡ä»¶åè¿™æ ·çš„éšå¼å¾ªç¯æ²¡æœ‰ä»€ä¹ˆâ€œé­”æ³•â€æ•ˆåº”ã€‚
æ›´æœ‰å¯èƒ½çš„æ˜¯ï¼Œå¯¹äºæ–‡ä»¶çš„å…³é—­ï¼Œåœ¨é‡å®šå‘ä¸­ä¸ä¼šå†æ‰“å¼€ï¼Œå› æ­¤ @command{awk} ä¼šä»€ä¹ˆä¹Ÿä¸åšï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªè´Ÿå€¼ã€‚

@cindex @code{|} (vertical bar), @code{|&} operator (I/O), pipes@comma{} closing
å½“ä½¿ç”¨ @samp{|&} æ“ä½œç¬¦ä¸å¹¶ç¨‹è¿›è¡Œé€šä¿¡æ—¶ï¼Œå…³é—­åŒå‘é€šä¿¡ä¸­çš„ä¸€ç«¯å¶å°”çš„æƒ…å†µä¸‹ä¼šéå¸¸æœ‰ç”¨ã€‚
è¿™åªéœ€è¦åœ¨è°ƒç”¨ @code{close()} æ—¶æä¾›ç¬¬äºŒä¸ªå‚æ•°å°±å¯ä»¥å®Œæˆã€‚
å¦‚å…¶ä»–åœ°æ–¹è°ƒç”¨ @code{close()} ç±»ä¼¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‘½ä»¤åï¼Œæˆ–è€…æ˜¯ç”¨äºå¼€å¯å¹¶ç¨‹çš„ç‰¹æ®Šæ–‡ä»¶ã€‚
è€Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ä¸²ï¼Œå…¶å€¼æ˜¯ @code{"to"} æˆ–è€…æ˜¯ @code{"from"}ï¼Œå¤§å°å†™æ— å…³ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œ
ä¼šåˆ° @ref{Two-way I/O}ï¼Œè¿›è¡Œè¯¦ç»†çš„è®¨è®ºï¼Œå¹¶æä¾›æ›´å¤šçš„å®é™…ä¾‹å­ã€‚

@sidebar ä½¿ç”¨ @code{close()} çš„è¿”å›å€¼
@cindex dark corner, @code{close()} function
@cindex @code{close()} function, return value
@cindex return value@comma{} @code{close()} function
@cindex differences in @command{awk} and @command{gawk}, @code{close()} function
@cindex Unix @command{awk}, @code{close()} function and

åœ¨è®¸å¤š Unix @command{awk} çš„è€ç‰ˆæœ¬ä¸­ï¼Œ@code{close()} å‡½æ•°å®é™…ä¸Šæ˜¯ä¸€æ¡è¯­å¥ã€‚
@value{DARKCORNER}
å°è¯•åˆ©ç”¨ @code{close()} çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªè¯­æ³•é”™è¯¯ï¼š

@example
command = "@dots{}"
command | getline info
retval = close(command)  # syntax error in many Unix awks
@end example

@cindex @command{gawk}, @code{ERRNO} variable in
@cindex @code{ERRNO} variable, with @command{close()} function
@command{gawk} å°† @code{close()} å½“æˆä¸€ä¸ªå‡½æ•°ã€‚å¦‚æœå…¶å‚æ•°è¡¨ç¤ºä»æœªæ‰“å¼€çš„ä¸œè¥¿ï¼ˆæ–‡ä»¶ã€ç®¡é“ã€å¹¶ç¨‹ï¼‰ï¼Œåˆ™è¿”å›å€¼ @minus{}1 ï¼Œ
æˆ–è€…æ˜¯ç³»ç»Ÿé—®é¢˜å¯¼è‡´æ–‡ä»¶æˆ–è€…è¿›ç¨‹çš„å…³é—­ï¼Œåˆ™ä¹Ÿä¼šè¿”å› @minus{}1 ã€‚
åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œ@command{gawk} å°†é¢„å®šä¹‰çš„å˜é‡ @code{ERRNO} çš„å€¼è®¾å®šä¸ºæè¿°é—®é¢˜çš„å­—ä¸²ã€‚

åœ¨ @command{gawk} ä¸­ï¼Œå½“å…³é—­ç®¡é“æˆ–è€…å¹¶ç¨‹æ—¶ï¼ˆè¾“å…¥æˆ–è¾“å‡ºï¼‰ï¼Œå…¶è¿”å›å€¼å°±æ˜¯å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ã€‚
@footnote{è¿™æ˜¯ä¸€ä¸ªå…¨ 16 ä½çš„ç”± @code{wait()} ç³»ç»Ÿè°ƒç”¨è¿”å›çš„å€¼ã€‚æŸ¥çœ‹ç³»ç»Ÿæ‰‹å†Œæ¥è·å–å¦‚ä½•è§£ç è¿™ä¸ªå€¼çš„ç›¸å…³ä¿¡æ¯ã€‚}
å¦åˆ™ï¼Œå®ƒå°±æ˜¯ä»ç³»ç»Ÿçš„ @code{close()} æˆ–è€… C å‡½æ•° @code{close()} çš„å…³é—­è¾“å…¥è¾“å‡ºæ–‡ä»¶æ—¶çš„è¿”å›å€¼ã€‚
å¦‚æœæˆåŠŸï¼Œåˆ™å€¼è¿”å›ä¸º 0ï¼Œå¤±è´¥ä¸‹è¿”å› @minus{}1 ã€‚

POSIX æ ‡å‡†éå¸¸æ¨¡ç³Šåœ°è¯´ï¼Œ@code{close()} åœ¨æˆåŠŸçš„æ—¶å€™è¿”å› 0ï¼Œè€Œå¤±è´¥æ—¶è¿”å›éé›¶å€¼ã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸åŒçš„å®ç°åœ¨å…³é—­ç®¡é“æ—¶ä¼šæŠ¥å‘Šä¸åŒçš„ç»“æœï¼Œå› æ­¤ï¼Œè¿”å›å€¼æ˜¯ä¸å¯ç§»æ¤çš„ã€‚
@value{DARKCORNER}
åœ¨ POSIX æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ@command{gawk} åœ¨å…³é—­ç®¡é“æ—¶ï¼Œåªè¿”å› 0ã€‚
@end sidebar


@node Output Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
@code{print} æ‰“å°é€—å·åˆ†éš”çš„è¡¨è¾¾å¼ã€‚æ¯ä¸ªè¡¨è¾¾å¼åœ¨è¾“å‡ºæ—¶éƒ½ç”± @code{OFS} çš„å€¼è¿›è¡Œåˆ†éš”ï¼Œå¹¶ä»¥ @code{ORS} çš„å€¼ç»“æŸã€‚@code{OFMT} æä¾›äº†å¯¹æ•°å€¼ @code{print} è¾“å‡ºæ—¶çš„æ ¼å¼è½¬æ¢ã€‚

@item
@code{printf} è¯­å¥æä¾›äº†éå¸¸å¥½çš„è¾“å‡ºæ§åˆ¶ç²’åº¦ï¼Œé€šè¿‡æ ¼å¼æ§åˆ¶å­—æ¯æ¥è¾“å‡ºä¸åŒçš„æ•°æ®ç±»å‹ã€‚åŒæ—¶ï¼Œç”¨ä¸åŒçš„æ ‡å¿—æ¥ä¿®æ”¹æ ¼å¼æ§åˆ¶å­—æ¯çš„è¡Œä¸ºã€‚

@item
@code{print} ä¸ @code{printf} çš„è¾“å‡ºéƒ½å¯ä»¥é‡å®šå‘åˆ°æ–‡ä»¶ã€ç®¡é“ä¸å¹¶ç¨‹ã€‚

@item
@command{gawk} æä¾›äº†ç‰¹æ®Šçš„@value{FN}ç”¨äºè®¿é—®æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºä¸æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œä»¥åŠè¿›è¡Œç½‘ç»œé€šä¿¡ã€‚

@item
ä½¿ç”¨ @code{close()} æ¥å…³é—­æ‰“å¼€çš„æ–‡ä»¶ã€ç®¡é“ä»¥å¹¶å¹¶ç¨‹çš„é‡å®šå‘ã€‚å¯¹äºå¹¶ç¨‹æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡å…³é—­æŸä¸ªæ–¹å‘çš„é€šä¿¡ã€‚

@end itemize

@c EXCLUDE START
@node Output Exercises
@section ç»ƒä¹ 

@enumerate
@item
é€šè¿‡åœ¨è¾“å‡ºä¸­ä½¿ç”¨ @code{OFS} å˜é‡ï¼Œé‡å†™ä¸‹é¢çš„ç¨‹åºï¼š

@example
awk 'BEGIN @{ print "Month Crates"
             print "----- ------" @}
           @{ print $1, "     ", $2 @}' inventory-shipped
@end example

@noindent
å®ƒæ¥è‡ªäº @ref{Output Separators}ã€‚

@item
ä½¿ç”¨ @code{printf} è¯­å¥æ¥å¯¹é½å¤´éƒ¨ä¸æ•°æ®è¡¨ï¼Œä¾‹å­æ¥è‡ªç”± @ref{Print}ï¼Œ@file{inventory-shipped} æ–‡ä»¶ã€‚

@item
åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œå¦‚æœä½ æ²¡æœ‰ç”¨åŒå¼•å·åœ¨é‡å®šå‘è¾“å‡ºæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š

@example
BEGIN @{ print "Serious error detected!" > /dev/stderr @}
@end example

@end enumerate
@c EXCLUDE END


@node Expressions
@chapter è¡¨è¾¾å¼
@cindex expressions

è¡¨è¾¾å¼æ˜¯ @command{awk} æ¨¡å¼ä¸åŠ¨ä½œçš„åŸºæœ¬æ„é€ å—ã€‚è¡¨è¾¾å¼æ±‚å€¼åå¯ç”¨äºæ‰“å°ï¼Œæµ‹è¯•æˆ–è€…ä¼ é€’ç»™å‡½æ•°ã€‚å¦å¤–ï¼Œè¡¨è¾¾å¼è¿˜å¯ä»¥é€šè¿‡èµ‹å€¼æ“ä½œç¬¦å°†ä¸€ä¸ªæ–°å€¼èµ‹ç»™ä¸€ä¸ªå˜é‡ã€‚

è¡¨è¾¾å¼æœ¬èº«å¯ä»¥æˆä¸ºä¸€ä¸ªæ¨¡å¼ï¼Œæˆ–è€…åŠ¨ä½œè¯­å¥ã€‚å¤šæ•°å…¶ä»–ç±»å‹çš„è¯­å¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¡¨è¾¾å¼ï¼Œæ¥æŒ‡å®šè¦æ“ä½œçš„æ•°æ®ã€‚å¦‚åœ¨å…¶ä»–è¯­è¨€ä¸­ä¸€æ ·ï¼Œ
@command{awk} ä¸­çš„è¡¨è¾¾å¼å¯ä»¥åŒ…å«å˜é‡ã€æ•°ç»„å‚è€ƒã€å¸¸é‡ä»¥åŠå‡½æ•°è°ƒç”¨ï¼Œè¿˜å¯ä»¥æ˜¯è¿™äº›å†…å®¹ä¸ä¸åŒçš„æ“ä½œç¬¦çš„å„ç§ç»„åˆã€‚

@menu
* Values::                      Constants, Variables, and Regular Expressions.
* All Operators::               @command{gawk}'s operators.
* Truth Values and Conditions:: Testing for true and false.
* Function Calls::              A function call is an expression.
* Precedence::                  How various operators nest.
* Locales::                     How the locale affects things.
* Expressions Summary::         Expressions summary.
@end menu

@node Values
@section å¸¸é‡ã€å˜é‡ä¸è½¬æ¢

è¡¨è¾¾å¼ç”±å€¼ä¸å¤„ç†è¿™äº›å€¼çš„æ“ä½œç»„æˆã€‚æœ¬@value{SECTION}æè¿°åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„åŸºæœ¬å…ƒç´ å¯¹è±¡ã€‚

@menu
* Constants::                   String, numeric and regexp constants.
* Using Constant Regexps::      When and how to use a regexp constant.
* Variables::                   Variables give names to values for later use.
* Conversion::                  The conversion of strings to numbers and vice
                                versa.
@end menu

@node Constants
@subsection å¸¸é‡è¡¨è¾¾å¼

@cindex constants, types of

æœ€ç®€å•çš„è¡¨è¾¾å¼ç±»å‹å°±æ˜¯@dfn{å¸¸é‡}ï¼Œå®ƒä»¬æ€»æ˜¯æœ‰ä¸å˜çš„å€¼ã€‚æœ‰ä¸‰ä¸ªå¸¸é‡ï¼šæ•°å€¼å¸¸é‡ã€å­—ä¸²å¸¸é‡ä¸è¡¨è¾¾å¼å¸¸é‡ã€‚

å¦‚æœä½ æ‰€éœ€è¦çš„å€¼ä¸éœ€è¦å˜åŒ–ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨é€‚å½“çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å®ƒä»¬ã€‚æ•°å€¼å¸¸é‡åˆæœ‰ä¸åŒçš„å½¢å¼ï¼Œä½†æ˜¯åœ¨å†…éƒ¨ï¼Œå®ƒä»¬éƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚

@menu
* Scalar Constants::            Numeric and string constants.
* Nondecimal-numbers::          What are octal and hex numbers.
* Regexp Constants::            Regular Expression constants.
@end menu

@node Scalar Constants
@subsubsection æ•°å€¼ä¸å­—ä¸²å¸¸é‡

@cindex constants, numeric
@cindex numeric constants
@dfn{æ•°å€¼å¸¸é‡}è¡¨ç¤ºæ•°å€¼ã€‚æ­¤æ•°å€¼å¯ä»¥æ˜¯æ•´æ•°ï¼Œåè¿›åˆ¶å°æ•°æˆ–è€…æ˜¯ç§‘å­¦è®¡æ•°å½¢å¼ï¼ˆå¹‚æŒ‡æ•°ï¼‰çš„å½¢å¼ã€‚
@footnote{æ‰€æœ‰çš„æ•°å€¼ï¼ŒåŒ…æ‹¬æ•´æ•°ï¼Œåœ¨å†…éƒ¨éƒ½è¡¨ç¤ºæˆåŒç²¾åº¦çš„æµ®ç‚¹æ•°ã€‚
åœ¨å¤šæ•°çš„ç°ä»£ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨çš„éƒ½æ˜¯ IEEE754 çš„æ ‡å‡†æ ¼å¼ã€‚æŸ¥çœ‹ @ref{Arbitrary Precision Arithmetic}ï¼Œæ¥å–å¾—æ›´å¤šçš„ä¿¡æ¯ã€‚}
ä¸‹é¢çš„ä¾‹å­åªæ‰€æœ‰å½¢å¼çš„å¸¸é‡çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼š

@example
105
1.05e+2
1050e-1
@end example

@cindex string constants
@dfn{å­—ä¸²å¸¸é‡}ç”±åŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦åºåˆ—ç»„æˆã€‚å¦‚ï¼š

@example
"parrot"
@end example

@noindent
@cindex differences in @command{awk} and @command{gawk}, strings
@cindex strings, length limitations
è¡¨ç¤ºå­—ä¸²å†…å®¹ä¸º @samp{parrot} ã€‚åœ¨ @command{gawk} ä¸­çš„å­—ä¸²å¯ä»¥æœ‰ä»»æ„é•¿åº¦ï¼Œ
å¯ä»¥åŒ…æ‹¬ä»»ä½•å¯èƒ½çš„ 8 æ¯”ç‰¹çš„ ASCII å­—ç¬¦ï¼ŒåŒ…æ‹¬ ASCII çš„ @sc{nul} å­—ç¬¦ï¼ˆå­—ç¬¦ç¼–ç ä¸º 0ï¼‰ã€‚
å…¶ä»–çš„ @command{awk} å®ç°æœ‰å¯èƒ½åœ¨å¤„ç†ä¸€äº›å­—ç¬¦ç¼–ç æ—¶å­˜åœ¨ä¸€äº›å›°éš¾ã€‚

@node Nondecimal-numbers
@subsubsection å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶æ•°å€¼
@cindex octal numbers
@cindex hexadecimal numbers
@cindex numbers, octal
@cindex numbers, hexadecimal

åœ¨ @command{awk} ä¸­ï¼Œæ‰€æœ‰çš„æ•°å€¼éƒ½æ˜¯åè¿›åˆ¶æ•°ï¼ˆä»¥ 10 ä¸ºè¿›åˆ¶ï¼‰ã€‚å¾ˆå¤šçš„å…¶ä»–ç¼–ç¨‹å˜é€Ÿå™¨å…è®¸ä½ æŒ‡å®šå…¶ä»–è¿›åˆ¶çš„æ•°ï¼Œ
ä¸€èˆ¬ä¸ºå…«è¿›åˆ¶ï¼ˆä»¥ 8 ä¸ºè¿›åˆ¶ï¼‰å’Œåå…­è¿›åˆ¶ï¼ˆä»¥ 16 ä¸ºè¿›åˆ¶ï¼‰ã€‚åœ¨å…«è¿›åˆ¶ä¸­ï¼Œæ•°å€¼ä¸º 0ï¼Œ1ï¼Œ2ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ10ï¼Œ11ï¼Œ12 ç­‰ç­‰ã€‚
æ­£å¦‚åè¿›åˆ¶ä¸­çš„ @samp{11}ï¼Œæ˜¯ 1 ä¹˜ 10ï¼Œç„¶ååŠ  1ï¼Œå› æ­¤å…«è¿›åˆ¶ä¸­çš„ @samp{11}ï¼Œè¡¨ç¤ºæ˜¯ 1 ä¹˜ 8ï¼Œç„¶ååŠ  1ã€‚
åœ¨åè¿›åˆ¶ä¸­å®ƒç­‰äº 9ã€‚å¯¹äºåå…­è¿›åˆ¶ï¼Œæœ‰ 16 ä¸ªæ•°å­—ä½ã€‚ç”±äºæˆ‘ä»¬æ—¥å¸¸çš„åè¿›åˆ¶æ•°å€¼ç³»ç»Ÿä¸­åªæœ‰ 10 ä¸ªæ•°å­—ä½ï¼ˆ@samp{0} - @samp{9}ï¼‰ï¼Œ
å› æ­¤ï¼Œ@samp{a} åˆ° @samp{f} è¿™ 6 ä¸ªå­—ç¬¦ç”¨æ¥è¡¨ç¤ºå‰©ä¸‹çš„éƒ¨åˆ†ã€‚
ï¼ˆå¤§å°å†™é€šå¸¸æ˜¯æ— å…³çš„ï¼Œåå…­è¿›åˆ¶çš„ @samp{a} ä¸ @samp{A} æœ‰ç›¸åŒçš„å€¼ã€‚ï¼‰å› æ­¤ï¼Œåå…­è¿›åˆ¶ä¸­çš„ @samp{11} è¡¨ç¤ºçš„æ˜¯ 1 ä¹˜ 16ï¼Œç„¶ååŠ  1ï¼Œåœ¨è¿›åˆ¶ä¸­åˆ™æ˜¯ 17ã€‚

é€šè¿‡ @samp{11} è¿™ä¸ªæ™®é€šå­—ä¸²ï¼Œä½ æ— æ³•çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆè¿›åˆ¶çš„ã€‚
å› æ­¤ï¼Œåœ¨ Cï¼ŒC++ ä»¥åŠå…¶ä»–çš„ä» C æ´¾ç”Ÿå‡ºæ¥çš„è¯­è¨€ä¸­ã€‚æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç¬¦å·ç”¨æ¥æŒ‡æ˜è¿›åˆ¶ã€‚å…«è¿›åˆ¶ä»¥ @samp{0} å¼€å¤´ï¼Œè€Œåå…­è¿›åˆ¶åˆ™ä»¥ @samp{0x} æˆ–è€… @samp{0X} å¼€å¤´ã€‚

@table @code
@item 11
åè¿›åˆ¶å€¼çš„ 11

@item 011
å…«è¿›åˆ¶çš„ 11ï¼Œåè¿›åˆ¶çš„ 9

@item 0x11
åå…­è¿›åˆ¶çš„ 11ï¼Œåè¿›åˆ¶çš„ 17
@end table

è¿™ä¸ªä¾‹å­ä½“ç°äº†å…¶ä¸­çš„ä¸åŒï¼š

@example
$ @kbd{gawk 'BEGIN @{ printf "%d, %d, %d\n", 011, 11, 0x11 @}'}
@print{} 9, 11, 17
@end example

å½“åœ¨ä½ çš„ç¨‹åºä¸­ï¼Œæ‰€å¤„ç†çš„æ•°æ®ä¸èƒ½æ–¹ä¾¿åœ°è¿›è¡Œè¡¨ç¤ºæˆå­—ä¸²æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œä½¿ç”¨è¿™äº›çš„å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶å¸¸æ•°åˆ™éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚å„ç§ä¸åŒçš„äºŒè¿›åˆ¶æ•°æ®ã€‚

@cindex @command{gawk}, octal numbers and
@cindex @command{gawk}, hexadecimal numbers and
@command{gawk} å¯ä»¥è®©ä½ åœ¨ç¨‹åºæ–‡ä»¶ä¸­ä½¿ç”¨å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶æ•°å€¼ã€‚ä½†æ˜¯ï¼Œè¿™æ ·çš„æ•°å€¼åœ¨è¾“å…¥æ—¶ä¼šåŒºåˆ«å¯¹å¾…ï¼Œ
é»˜è®¤è¿™ä¹ˆåšä¼šå¯¼è‡´æ—§çš„ç¨‹åºæ— æ³•æ­£å¸¸æ‰§è¡Œã€‚ï¼ˆå¦‚æœä½ ç¡®å®è¦è¿™ä¹ˆåšï¼Œä½¿ç”¨ @option{--non-decimal-data} è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œ
æŸ¥çœ‹ @ref{Nondecimal Data}ï¼‰å¦‚æœä½ æœ‰å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶çš„æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ @code{strtonum()}
ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰å‡½æ•°æ¥å°†è¿™äº›æ•°æ®è½¬æ¢ä¸ºæ•°å€¼ã€‚
å¤§å¤šæ•°æ—¶å€™ï¼Œä½ åœ¨ä½¿ç”¨å†…å»ºçš„ä½æ“ä½œå‡½æ•°æ—¶ï¼Œä½ éƒ½ä¼šä½¿ç”¨å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶æ•°æ®ã€‚
å¯ä»¥æŸ¥çœ‹ @ref{Bitwise Functions}ï¼Œæ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚

ä¸åƒæ—©æœŸçš„ C å®ç°ï¼Œ@samp{8} ä¸ @samp{9} ä¸æ˜¯æœ‰æ•ˆçš„å…«è¿›åˆ¶å¸¸æ•°ã€‚ä¾‹å¦‚ï¼Œ@command{gawk} ä¼šå°† @samp{018} å½“æˆæ˜¯åè¿›åˆ¶çš„ 18ï¼š

@example
$ @kbd{gawk 'BEGIN @{ print "021 is", 021 ; print 018 @}'}
@print{} 021 is 17
@print{} 18
@end example

@cindex compatibility mode (@command{gawk}), octal numbers
@cindex compatibility mode (@command{gawk}), hexadecimal numbers
å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶æºä»£ç å¸¸é‡æ˜¯ @command{gawk} çš„æ‰©å±•ã€‚å¦‚æœ @command{gawk} å¤„äºå…¼å®¹æ¨¡å¼ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ
åˆ™å®ƒä»¬æ˜¯ä¸å¯ç”¨çš„ã€‚

@sidebar å¸¸é‡çš„è¿›åˆ¶ä¸ä¼šå½±å“å®ƒçš„å€¼

åªè¦æ•°å€¼å¸¸é‡è¢«è½¬æ¢æˆäº†æ•°å€¼çš„å†…éƒ¨è¡¨ç¤ºï¼Œ@command{gawk} å°±ä¸å†è®°ä½å¸¸é‡çš„åŸå§‹æ ¼å¼ï¼Œ@command{gawk} æ€»æ˜¯ä¼šä½¿ç”¨å†…éƒ¨çš„å€¼ã€‚è¿™åœ¨å°†æ•°å€¼è½¬æ¢æˆå­—ä¸²æ—¶æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç»“æœï¼š

@example
$ @kbd{gawk 'BEGIN @{ printf "0x11 is <%s>\n", 0x11 @}'}
@print{} 0x11 is <17>
@end example
@end sidebar

@node Regexp Constants
@subsubsection æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡

@cindex regexp constants
@cindex @code{~} (tilde), @code{~} operator
@cindex tilde (@code{~}), @code{~} operator
@cindex @code{!} (exclamation point), @code{!~} operator
@cindex exclamation point (@code{!}), @code{!~} operator
@dfn{æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡}æ˜¯ä¸€ä¸ªåŒ…å«åœ¨ä¸€å¯¹æ–œæ ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æè¿°ã€‚
ä¾‹å¦‚ @code{@w{/^beginning and end$/}}ã€‚
@command{awk} ç¨‹åºä¸­ä½¿ç”¨çš„å¤§å¤šæ•°æ­£åˆ™è¡¨è¾¾å¼éƒ½æ˜¯å¸¸é‡ï¼Œä½†æ˜¯ @samp{~} ä¸ @samp{!~} åŒ¹é…æ“ä½œç¬¦ä¹Ÿå¯ä»¥åŒ¹é…è®¡ç®—å‹ï¼Œå³åŠ¨æ€å‹æ­£åˆ™è¡¨å¤§å¼ï¼ˆå…¸å‹çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬å°±æ˜¯åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„æ™®é€šçš„å­—ä¸²æˆ–è€…å˜é‡ï¼Œä½†æ˜¯æ˜¯æ›´å¤æ‚çš„è¡¨è¾¾å¼è€Œå·²ï¼‰ã€‚

@node Using Constant Regexps
@subsection ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡

@cindex dark corner, regexp constants
å½“åœ¨ @samp{~} æˆ–è€… @samp{!~} æ“ä½œçš„å³æ‰‹è¾¹æ—¶ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä»…æƒè¡¨ç¤ºè¦åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚
ä½†æ˜¯æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼ˆä¾‹å¦‚ @code{/foo/}ï¼‰å¯ä»¥å½“æˆç®€å•çš„è¡¨è¾¾å¼æ¥ä½¿ç”¨ã€‚
å½“æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡å•ç‹¬å‡ºç°æ—¶ï¼Œä¸å®ƒåœ¨æ¨¡å¼ä¸­å‡ºç°æ—¶æœ‰ç›¸åŒçš„å«ä¹‰ï¼ˆå¦‚ @samp{($0 ~ /foo/)}ï¼‰
@value{DARKCORNER}
æŸ¥çœ‹ @ref{Expression Patterns}ã€‚è¿™è¡¨ç¤ºä¸‹é¢çš„ä¸¤ä¸ªä»£ç ç‰‡æ®µï¼š

@example
if ($0 ~ /barfly/ || $0 ~ /camelot/)
    print "found"
@end example

@noindent
ä¸ï¼š

@example
if (/barfly/ || /camelot/)
    print "found"
@end example

@noindent
æ˜¯å®Œå…¨ç­‰åŒçš„ã€‚è¿™ä¸ªè§„åˆ™çš„ä¸€ä¸ªéå¸¸å¥‡æ€ªçš„ç»“æœå°±æ˜¯ä¸‹é¢çš„å¸ƒæ—è¡¨è¾¾å¼æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ä½œè€…æ‰€è®¤ä¸ºçš„é‚£æ ·æ‰§è¡Œï¼š

@example
# Note that /foo/ is on the left of the ~
if (/foo/ ~ $1) print "found foo"
@end example

@c @cindex automatic warnings
@c @cindex warnings, automatic
@cindex @command{gawk}, regexp constants and
@cindex regexp constants, in @command{gawk}
@noindent
è¿™ä¸ªä»£ç â€œå¾ˆæ˜æ˜¾â€åœ°æ˜¯è¦æµ‹è¯• @code{$1} æ˜¯ä¸æ˜¯åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ @code{/foo/}ã€‚
ä½†æ˜¯å®é™…ä¸Šï¼Œè¡¨è¾¾å¼ @samp{/foo/ ~ $1} è¡¨ç¤ºçš„æ˜¯ @samp{($0 ~ /foo/) ~ $1}ã€‚
æ¢å¥è¯è¯´ï¼Œé¦–å…ˆåŒ¹é…è¾“å…¥è®°å½•ä¸æ­£åˆ™è¡¨è¾¾å¼ @code{/foo/}ï¼Œæ‰€å¾—åˆ°çš„ç»“æœè¦ä¹ˆæ˜¯ 0ï¼Œè¦ä¹ˆæ˜¯ 1ã€‚
è¿™å°±è¦çœ‹åŒ¹é…çš„æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚åŒ¹é…çš„ç»“æœç„¶åå†ä¸è®°å½•çš„ç¬¬ä¸€ä¸ªåŸŸè¿›è¡ŒåŒ¹é…ã€‚
ç”±äºä½ ä¸å¯èƒ½æ˜¯æƒ³åšè¿™æ ·çš„æµ‹è¯•ï¼Œ@command{gawk} ä¼šé’ˆå¯¹ç¨‹åºä¸­è¿™æ ·çš„ç»“æ„å‘å‡ºä¸€ä¸ªå‘Šè­¦ã€‚è¿™ä¸ªè§„åˆ™çš„å¦ä¸€ä¸ªç»“æœå°±æ˜¯å¦‚ä¸‹çš„åŒ¹é…è¯­å¥ï¼š

@example
matches = /foo/
@end example

@noindent
æ˜¯è¦ä¹ˆå°† 0ï¼Œè¦ä¹ˆæ˜¯å°† 1 èµ‹å€¼ç»™å˜é‡ @code{matches}ï¼Œå†…å®¹ä¾èµ–äºå½“å‰çš„è¾“å…¥è®°å½•ã€‚

@cindex differences in @command{awk} and @command{gawk}, regexp constants
@cindex dark corner, regexp constants, as arguments to user-defined functions
@cindexgawkfunc{gensub}
@cindexawkfunc{sub}
@cindexawkfunc{gsub}
æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ç”¨äº @code{gensub()}ï¼Œ@code{sub()} ä¸ @code{gsub()} å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ
æˆ–è€…æ˜¯ @code{match()} å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥åŠ @code{split()} ä¸ @code{patsplit()} å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°
ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚@command{awk} çš„ç°ä»£ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ @command{gawk}ï¼Œ
å…è®¸ @code{split()} çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼Œä½†æ˜¯æ—§ä¸€ç‚¹çš„ç‰ˆæœ¬ä¸å…è®¸ã€‚
@value{DARKCORNER}
ç”±äºä¸€äº›å†…ç½®çš„å‡½æ•°æ¥å—æ­£åˆ™è¡¨è¾¾å¼ä¼šå®ƒçš„å‚æ•°ï¼Œå› æ­¤å°†å…¶ä½œä¸ºç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{User-defined}ï¼‰çš„å‚æ•°æ—¶ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¼šå¸¦æ¥å›°æƒ‘ã€‚å¦‚ï¼š

@example
function mysub(pat, repl, str, global)
@{
    if (global)
        gsub(pat, repl, str)
    else
        sub(pat, repl, str)
    return str
@}

@{
    @dots{}
    text = "hi! hi yourself!"
    mysub(/hi/, "howdy", text, 1)
    @dots{}
@}
@end example

@c @cindex automatic warnings
@c @cindex warnings, automatic
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¨‹åºå‘˜æƒ³å°†æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ä¼ é€’ç»™ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° @code{mysub()}ï¼Œ
è¯¥å‡½æ•°åˆå°†å…¶ä¼ ç»™ @code{sub()} æˆ–è€… @code{gsub()}ã€‚
ä½†æ˜¯çœŸæ­£å‘ç”Ÿçš„äº‹æƒ…æ˜¯ï¼Œ@code{pat} å‚æ•°ä¼šè¢«èµ‹å€¼ä¸º 1 æˆ–è€… 0ï¼Œè¿™å°±è¦çœ‹ @code{$0} æ˜¯å¦åŒ¹é… @code{/hi/}ã€‚
@command{gawk} ä¼šé’ˆå¯¹æ­£åˆ™è¡¨è¾¾å¼å¸¸æ—¦ä¼ é€’ç»™ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°è¿™ç§æƒ…å†µå‘å‡ºä¸€ä¸ªè­¦å‘Šï¼Œå› æ­¤å°†ä¸€ä¸ªçœŸå€¼é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼ é€’æœ‰å¯èƒ½ä¸æ˜¯æœ‰æ„çš„ã€‚

@node Variables
@subsection å˜é‡

@cindex variables, user-defined
@cindex user-defined, variables
@dfn{å˜é‡}æ˜¯åœ¨ä½ ç¨‹åºçš„æŸä¸ªç‚¹å­˜å‚¨å€¼ï¼Œä»¥å¤‡ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†åç»­ä½¿ç”¨çš„æ–¹å¼ã€‚å®ƒä»¬å¯ä»¥åœ¨ç¨‹åºæ–‡æœ¬çš„æ•´ä¸ªéƒ¨åˆ†è¢«æ“ä½œï¼Œ
ä¹Ÿå¯ä»¥åœ¨ @command{awk} çš„å‘½ä»¤è¡Œä¸­è¢«èµ‹å€¼ã€‚

@menu
* Using Variables::             Using variables in your programs.
* Assignment Options::          Setting variables on the command line and a
                                summary of command-line syntax. This is an
                                advanced method of input.
@end menu

@node Using Variables
@subsubsection åœ¨ç¨‹åºä¸­ä½¿ç”¨å˜é‡


å˜é‡å¯è®©ä½ ç»™å€¼èµ‹äºˆä¸€ä¸ªåå­—ï¼Œç„¶åé€šè¿‡è¿™ä¸ªåå­—æ¥ä½¿ç”¨å®ƒã€‚å˜é‡åœ¨å¤šä¸ªä¾‹å­ä¸­éƒ½ä½¿ç”¨åˆ°äº†ã€‚å˜é‡çš„åå­—å¿…é¡»æ˜¯ä¸€ä¸ªå­—æ¯ã€æ•°å­—æˆ–è€…ä¸‹åˆ’çº¿çš„åºåˆ—ï¼Œå¹¶ä¸”ä¸å¯ä»¥ä»¥æ•°å­—å¼€å¤´ã€‚
åœ¨è¿™é‡Œï¼Œ@dfn{å­—æ¯}æ˜¯ä»»ä½•çš„ 52 ä¸ªå¤§å°ä¸å°å­—çš„è‹±æ–‡å­—æ¯ã€‚å…¶ä»–çš„åœ¨éè‹±è¯­è¯­è¨€è®¾ç½®ä¸­å®šä¹‰çš„å­—ç¬¦ä¸å¯ç”¨äºå˜é‡å¥ã€‚å¤§å°å†™åœ¨å˜é‡åä¸­æ˜¯åŒºåˆ†çš„ï¼Œ@code{a} ä¸ @code{A} æ˜¯ä¸åŒçš„å˜é‡ã€‚

å˜é‡æœ¬èº«å°±æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è¡¨è¾¾å¼ï¼š
å› ä¸ºå®ƒä»£è¡¨äº†å˜é‡çš„å½“å‰å€¼ã€‚å˜é‡é€šè¿‡@dfn{èµ‹å€¼æ“ä½œç¬¦}ã€@dfn{é€’å¢æ“ä½œç¬¦}ä¸@dfn{é€’å‡æ“ä½œç¬¦}å¯ä»¥èµ‹äºˆä¸€ä¸ªæ–°å€¼
ï¼ˆæŸ¥çœ‹ @ref{Assignment Ops}ï¼‰ã€‚
å¦å¤–ï¼Œ@code{sub()} ä¸ @code{gsub()} å‡½æ•°å¯ä»¥æ”¹å˜å˜é‡çš„å€¼ï¼Œ
è€Œ @code{match()}ï¼Œ@code{split()} ä¸ @code{patsplit()} å‡½æ•°å¯ä»¥æ”¹å˜æ•°ç»„å‚æ•°çš„å€¼ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚

@cindex variables, built-in
@cindex variables, initializing
å°‘æ•°å‡ ä¸ªå˜é‡æœ‰ä¸€äº›å†…ç½®çš„å«ä¹‰ï¼Œå¦‚ @code{FS}ï¼ˆåŸŸåˆ†éš”ç¬¦ï¼‰ä»¥åŠ @code{NF}ï¼ˆå½“å‰è®°å½•çš„åŸŸæ•°ç›®ï¼‰ã€‚
æŸ¥çœ‹ @ref{Built-in Variables}ï¼Œå¯è·å–é¢„å®šä¹‰çš„å˜é‡åˆ—è¡¨ã€‚è¿™äº›é¢„å®šä¹‰çš„å˜é‡å¯ä»¥åƒå…¶ä»–å˜é‡ä¸€æ ·è¢«ä½¿ç”¨ä¸èµ‹å€¼ï¼Œä½†æ˜¯å®ƒä»¬çš„å€¼ä¹Ÿå¯ä»¥è¢« @command{awk} è‡ªåŠ¨ä½¿ç”¨ä¸æ›´æ”¹ã€‚æ‰€æœ‰çš„é¢„å®šä¹‰çš„å˜é‡çš„åå­—éƒ½æ˜¯å¤§å†™çš„ã€‚

@command{awk} çš„å˜é‡å¯ä»¥è¢«èµ‹å€¼ä¸ºæ•°å€¼ä¸å­—ä¸²ã€‚æŸä¸ªå˜é‡æ‰€æŒæœ‰å€¼çš„ç±»å‹åœ¨ç¨‹åºçš„ç”Ÿå‘½æœŸä¸­æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰åˆå§‹åŒ–çš„å˜é‡çš„å€¼æ˜¯ä¸€ä¸ªç©ºä¸²ï¼Œå¦‚æœè½¬æ¢ä¸ºæ•°å€¼åˆ™ä¸º 0ã€‚
æ²¡æœ‰å¿…è¦æ˜¾å¼åœ°åœ¨ @command{awk} ä¸­åˆå§‹åŒ–å˜é‡ï¼Œè¿™äº›æ˜¯åœ¨ C è¯­è¨€ä¸­ä»¥åŠå…¶ä»–ä¼ ç»Ÿè¯­è¨€ä¸­æ‰éœ€è¦åšçš„ã€‚

@node Assignment Options
@subsubsection åœ¨å‘½ä»¤è¡Œä¸­è¿›è¡Œå˜é‡èµ‹å€¼
@cindex variables, assigning on command line
@cindex command line, variables@comma{} assigning on

@command{awk} å˜é‡å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šé€šè¿‡@dfn{èµ‹å€¼æ“ä½œç¬¦}æ¥è®¾ç½®ï¼ˆæŸ¥çœ‹ @ref{Other Arguments}ï¼‰ã€‚è¿™æ ·çš„èµ‹å€¼æœ‰å¦‚ä¸‹å½¢å¼ï¼š

@example
@var{variable}=@var{text}
@end example

@cindex @option{-v} option
@noindent
é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œå˜é‡è¦ä¹ˆåœ¨ @command{awk} ç¨‹åºè¿è¡Œå¼€å§‹æˆ–è€…åœ¨è¾“å…¥æ–‡ä»¶ä¹‹é—´è¿›è¡Œè®¾ç½®ã€‚å½“ @option{-v} é€‰é¡¹å…ˆäºèµ‹å€¼ï¼Œå¦‚ä¸‹é¢çš„å½¢å¼ï¼š

@example
-v @var{variable}=@var{text}
@end example

@noindent
åˆ™å˜é‡å°†åœ¨ç¨‹åºçš„å¼€å§‹ï¼Œç”šè‡³åœ¨ @code{BEGIN} è§„åˆ™æ‰§è¡Œä¹‹é—´å°±è®¾ç½®äº†ã€‚
@option{-v} é€‰é¡¹ä»¥åŠä»–çš„èµ‹å€¼å¿…é¡»åœ¨æ‰€æœ‰çš„æ–‡ä»¶åå‚æ•°ä»¥åŠç¨‹åºä»£ç ä¹‹å‰ã€‚
ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼Œæ¥è·å–å…³äº @option{-v} é€‰é¡¹çš„æ›´å¤šä¿¡æ¯ã€‚ï¼‰
å¦åˆ™ï¼Œå˜é‡èµ‹å€¼çš„æ‰§è¡Œå†³å®šäºå®ƒåœ¨è¾“å…¥æ–‡ä»¶ä¸­çš„ä½ç½®â€”â€”è¦å…ˆå¤„ç†å…ˆäºè¯¥é€‰é¡¹ä¹‹å‰çš„æ–‡ä»¶ã€‚å¦‚ï¼š

@example
awk '@{ print $n @}' n=4 inventory-shipped n=2 mail-list
@end example

@noindent
ä¼šæ‰“å°æ‰€æœ‰è¾“å…¥è®°å½•çš„åŸŸæ•°å€¼ @code{n}ã€‚åœ¨ç¬¬ä¸€ä¸ªæ–‡ä»¶è¯»å–ä¹‹å‰ï¼Œå‘½ä»¤è¡Œå‚æ•°è®¾ç½®å˜é‡ @code{n} çš„å€¼ä¸º 4ã€‚
è¿™ä¼šæ‰“å°æ¥è‡ª @file{inventory-shipped} æ–‡ä»¶è¡Œä¸­çš„ç¬¬ 4 ä¸ªåŸŸã€‚å½“å¤„ç†å®Œç¬¬ä¸€ä¸ªæ–‡ä»¶åï¼Œä½†æ˜¯åœ¨å¼€å§‹ç¬¬ 2 ä¸ªæ–‡ä»¶ä¹‹å‰ï¼Œ
@code{n} è¢«è®¾ç½®æˆ 2ï¼Œå› æ­¤ä¼šæ‰“å°æ¥è‡ª @file{mail-list} æ–‡ä»¶çš„è¡Œçš„ç¬¬ 2 ä¸ªåŸŸï¼š

@example
$ @kbd{awk '@{ print $n @}' n=4 inventory-shipped n=2 mail-list}
@print{} 15
@print{} 24
@dots{}
@print{} 555-5553
@print{} 555-3412
@dots{}
@end example

@cindex dark corner, command-line arguments
å‘½ä»¤è¡Œå‚æ•°è¿˜å¯ä»¥åœ¨ @code{ARGV} æ•°ç»„ä¸­è·å–ï¼Œå¹¶åˆ©ç”¨ @command{awk} ç¨‹åºè¿›è¡Œæ˜¾ç¤ºæ£€æŸ¥ï¼ˆæŸ¥çœ‹ @ref{ARGC and ARGV}ï¼‰ã€‚
@command{awk} ä¼šå¤„ç†å‘½ä»¤è¡Œèµ‹å€¼å‚æ•°çš„å€¼ä¸­è½¬ä¹‰åºåˆ—ï¼ˆæŸ¥çœ‹ @ref{Escape Sequences}ï¼‰ã€‚
@value{DARKCORNER}

@node Conversion
@subsection åœ¨å­—ä¸²ä¸æ•°å€¼ä¹‹é—´è¿›è¡Œè½¬æ¢

â€œæ•°å€¼åˆ°å­—ä¸²â€ä»¥åŠâ€œå­—ä¸²åˆ°æ•°å€¼â€çš„è½¬æ¢ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥çš„ã€‚ä½†æ˜¯è¦äº†è§£å‡ ä¸ªç»†å¾®çš„åœ°æ–¹ï¼Œ
é€šè¿‡è¿™@value{SECTION}æ¥è¯´æ˜ @command{awk} ä¸­è¿™äº›é‡è¦çš„ç»†èŠ‚ã€‚

@menu
* Strings And Numbers::         How @command{awk} Converts Between Strings And
                                Numbers.
* Locale influences conversions:: How the locale may affect conversions.
@end menu

@node Strings And Numbers
@subsubsection @command{awk} å¦‚ä½•è½¬æ¢å­—ä¸²ä¸æ•°å€¼

@cindex converting, strings to numbers
@cindex strings, converting
@cindex numbers, converting
@cindex converting, numbers to strings
å¦‚æœ @command{awk} ç¨‹åºä¸Šä¸‹æ–‡è¦æ±‚ï¼Œå­—ä¸²ä¼šè½¬æ¢æˆæ•°å€¼ï¼Œæ•°å€¼ä¹Ÿå¯ä»¥è½¬æ¢æˆå­—ä¸²ã€‚ä¾‹å¦‚ï¼Œ
åœ¨è¡¨è¾¾å¼ @samp{foo + bar} ä¸­å¦‚æœ @code{foo} æˆ–è€… @code{bar} å¦‚æœæ˜¯ä¸€ä¸ªä¸²ï¼Œå®ƒå°±ä¼šè½¬åœ¨æ‰§è¡ŒåŠ æ“ä½œä¹‹å‰è½¬æ¢æˆæ•°å€¼ã€‚
å¦‚æœæ•°å€¼å‡ºç°åœ¨å­—ä¸²çš„è¿æ¥æ“ä½œé‡Œï¼Œå®ƒä»¬å°±ä¼šè½¬æ¢æˆå­—ä¸²ã€‚è€ƒè™‘å¦‚ä¸‹çš„ä»£ç ï¼š

@example
two = 2; three = 3
print (two three) + 4
@end example

@noindent
è¿™ä¸ªä»£ç ä¼šæ‰“å°ï¼ˆæ•°å€¼ï¼‰å€¼ 27ã€‚@code{two} ä¸ @code{three} çš„æ•°å€¼å€¼è¢«è½¬æ¢æˆå­—ä¸²å¹¶è¿æ¥åœ¨ä¸€èµ·ã€‚
ç»“æœå­—ä¸²è¢«è½¬æ¢æˆæ•°å€¼ 23ï¼Œç”¨äºä¸ 4 è¿›è¡Œç›¸åŠ ã€‚

@cindex null strings, converting numbers to strings
@cindex type conversion
ç”±äºæŸç§åŸå› ï¼Œå¦‚æœä½ éœ€è¦å¼ºåˆ¶æ•°å€¼è¢«è½¬æ¢æˆå­—ä¸²ï¼Œåˆ™å°†è¿™ä¸ªæ•°å€¼ä¸ç©ºä¸²ï¼ˆ@code{""}ï¼‰è¿æ¥ã€‚
å¼ºåˆ¶ä¸€ä¸ªå­—ä¸²è¦è½¬æ¢æˆæ•°å€¼ï¼Œåˆ™æŠŠè¿™ä¸ªå­—ä¸²åŠ ä¸Š 0 å³å¯ã€‚
å­—ä¸²è½¬æ¢æˆæ•°å€¼æ˜¯é€šè¿‡å°†å­—ä¸²çš„æ•°å­—å½¢å¼çš„å‰ç¼€ä¸²è§£é‡Šå½“æˆæ•°å€¼ï¼š@code{"2.5"} ä¼šè¢«è½¬æ¢æˆ 2.5ï¼Œ@code{"1e3"} ä¼šè¢«è½¬æ¢æˆ 1000ï¼Œ
@code{"25fix"} ä¼šè¢«è½¬æ¢ 25ã€‚æ— æ³•è½¬æ¢æˆæ•°å€¼çš„å­—ä¸²åˆ™ä¼šè½¬æ¢æˆ 0ã€‚

@cindex @code{CONVFMT} variable
å°†æ•°å€¼è½¬æ¢æˆå­—ä¸²ä¸Šçš„å‡†ç¡®æ–¹å¼æ˜¯ç”± @command{awk} çš„é¢„å®šä¹‰å˜é‡ @code{CONVFMT} è¿›è¡Œæ§åˆ¶çš„
ï¼ˆæŸ¥çœ‹ @ref{Built-in Variables}ï¼‰ã€‚æ•°å€¼è½¬æ¢æˆå­—ä¸²æ˜¯ä½¿ç”¨ @code{sprintf()} å‡½æ•°å¹¶å°† @code{CONVFMT} å½“åšæ¨¡å¼æŒ‡å®šç¬¦
ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚

@code{CONVFMT} çš„å€¼é»˜è®¤æ˜¯ @code{"%.6g"}ï¼Œè¡¨ç¤ºçš„æ˜¯åˆ›å»ºçš„å€¼æœ€å¤šæœ‰ 6 ä¸ªæœ‰æ•ˆæ•°å­—ä½ã€‚
å¯¹äºä¸€äº›åº”ç”¨æ¥è¯´ï¼Œä½ å¯ä»¥å°†å…¶æ›´æ”¹å¾—æ›´åŠ ç²¾ç¡®ã€‚åœ¨å¤§å¤šæ•°ç°åœ¨æœºå™¨ä¸Šï¼Œ17 ä½çš„æ•°å€¼é€šå¸¸è¶³å¤Ÿå°†æ•è·æµ®ç‚¹æ•°çš„å€¼äº†ã€‚ 
@footnote{åœ¨ç—…ç†å­¦æƒ…å†µä¸‹éœ€è¦å¤šè¾¾ 752 ä½æ•°ï¼ˆï¼ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬è®¤ä¸ºä½ ä¸éœ€è¦ä¸ºæ­¤æ‹…å¿ƒï¼ˆä½ å¹³æ—¶ç”¨ä¸åˆ°è¿™ä¹ˆé•¿çš„æœ‰æ•ˆä½ï¼‰ã€‚}

@cindex dark corner, @code{CONVFMT} variable
å¦‚æœä½ å°† @code{CONVFMT} çš„å€¼è®¾ç½®æˆä¸€ä¸ªæ— æ³•å‘ŠçŸ¥ @code{sprintf()} å¦‚ä½•æ¥ä»¥ä¸€ç§æœ‰ç”¨çš„æ–¹å¼æ ¼å¼åŒ–æµ®ç‚¹æ•°çš„å­—ä¸²ï¼Œ
åˆ™ä¼šäº§ç”Ÿå¥‡æ€ªçš„ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å¿˜è®°äº†æ ¼å¼æŒ‡å®šç¬¦ä¸­çš„ @samp{%}ï¼Œ@command{awk} ä¼šå°†æ‰€æœ‰æ•°å€¼è½¬æ¢æˆä¸€æ ·çš„å­—ä¸²å¸¸é‡ã€‚

ä½œä¸ºä¸€ä¸ªç‰¹æ®Šä¾‹å­ï¼Œå¦‚æœæ•°å€¼æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè½¬æ¢æˆå­—ä¸²çš„ç»“æœ@emph{æ€»æ˜¯}ä¸€ä¸ªæ•´æ•°ï¼Œæ— è®º @code{CONVFMT} çš„å€¼æ˜¯ä»€ä¹ˆã€‚å¦‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼š

@example
CONVFMT = "%2.2f"
a = 12
b = a ""
@end example

@noindent
@code{b} çš„å€¼ä¸º @code{"12"}ï¼Œè€Œä¸æ˜¯ @code{"12.00"}ã€‚
@value{DARKCORNER}

@sidebar POSIX æ ‡å‡†å‰ @command{awk} ç”¨ @code{OFMT} è¿›è¡Œå­—ç¬¦ä¸²è½¬æ¢
@cindex POSIX @command{awk}, @code{OFMT} variable and
@cindex @code{OFMT} variable
@cindex portability, new @command{awk} vs.@: old @command{awk}
@cindex @command{awk}, new vs.@: old, @code{OFMT} variable
åœ¨ POSIX æ ‡å‡†ä¹‹å‰ï¼Œ@command{awk} ç”¨ @code{OFMT} çš„å€¼æ¥æŠŠæ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚
å½“ç”¨ @code{print} æ‰“å°æ•°å­—çš„æ—¶å€™ï¼Œ@code{OFMT} æŒ‡å®šäº†è¾“å‡ºæ ¼å¼ã€‚
@code{CONVFMT} æ˜¯ä¸ºäº†æŠŠæ‰“å°æ“ä½œå’Œè½¬æ¢æ“ä½œçš„åŒºåˆ†å¼€è€Œå¼•å…¥çš„ã€‚
@code{CONVFMT} å’Œ @code{OFMT} éƒ½æœ‰ç›¸åŒçš„é»˜è®¤å€¼ï¼š@code{"%.6g"}ã€‚
åœ¨å¤§éƒ¨åˆ†çš„ case ä¸­ï¼Œæ—§çš„ @command{awk} ç¨‹åºä¸æ”¹å˜ä»–ä»¬çš„è¡Œä¸ºã€‚
æŸ¥çœ‹ @ref{Print} å…³äºæ›´å¤š @code{print} çš„æè¿°ã€‚
@end sidebar

@node Locale influences conversions
@subsubsection è¯­è¨€è®¾ç½®ä¼šå½±å“è½¬æ¢

å½“è¦åœ¨å­—ä¸²ä¸æ•°å€¼ä¹‹é—´è¿›è¡Œè½¬æ¢æ—¶ï¼Œä»€ä¹ˆåœ°æ–¹ä¼šå¯¹æ­¤äº§ç”Ÿå½±å“ï¼Ÿæœ¬åœ°å­—ç¬¦è®¾ç½®ä¸è¯­è¨€ï¼Œå³ @dfn{locale}ï¼Œä¼šå½±å“æ•°å€¼çš„æ ¼å¼ã€‚
ç‰¹åˆ«æ˜¯ï¼Œå¯¹äº @command{awk} ç¨‹åºï¼Œå®ƒè¿˜ä¼šå½±å“åè¿›åˆ¶å°æ•°ç‚¹å­—ç¬¦ä»¥åŠç™¾åˆ†ä½å­—ç¬¦ã€‚
@code{"C"} è¯­è¨€è®¾ç½®æˆ–è€…å¤§å¤šæ•°çš„è‹±è¯­è¯­è¨€ï¼Œä½¿ç”¨ç‚¹ç¬¦å·ï¼ˆ@samp{.}ï¼‰å½“åšä¸ºåè¿›åˆ¶æ•°å°æ•°ç‚¹ï¼Œå¹¶ä¸”æ²¡æœ‰ç™¾åˆ†ä½ã€‚
ä½†æ˜¯ï¼Œè®¸å¤šï¼ˆå¦‚æœä¸æ˜¯å¤§å¤šæ•°ï¼‰çš„æ¬§æ´²ä»¥åŠéè‹±è¯­è¯­è¨€åŒºåŸŸä½¿ç”¨é€—å·ï¼ˆ@samp{,}ï¼‰ä½œä¸ºåè¿›åˆ¶å°æ•°ç‚¹å­—ç¬¦ã€‚
æ¬§æ´²è¯­è¨€é€šå¸¸åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ç©ºæ ¼æˆ–è€…ç‚¹æ¥ä½œä¸ºç™¾åˆ†ä½ã€‚

@cindex dark corner, locale's decimal point character
POSIX æ ‡å‡†è§„å®šï¼Œå½“è¯»å– @command{awk} ç¨‹åºæºä»£ç ï¼Œä»¥åŠåœ¨è¯»å–å‘½ä»¤è¡Œèµ‹å€¼å˜é‡æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨ç‚¹å·ä½œä¸ºåè¿›åˆ¶å°æ•°ç‚¹
ï¼ˆæŸ¥çœ‹ @ref{Other Arguments}ï¼‰ã€‚ä½†æ˜¯ï¼Œå½“è§£é‡Šè¾“å…¥æ•°æ®æ—¶ã€è¿›è¡Œ @code{print} æˆ–è€… @code{printf} è¾“å‡ºï¼Œä»¥åŠè¿›è¡Œæ•°å€¼ä¸å­—ä¸²è½¬æ¢æ—¶ï¼Œåˆ™ä½¿ç”¨æœ¬åœ°çš„åè¿›åˆ¶å°æ•°ç‚¹ã€‚
@value{DARKCORNER} 
åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œæºä»£ç ä¸­çš„æ•°å€¼ï¼Œä»¥åŠè¾“å…¥æ•°æ®ä¸å¯ä»¥æœ‰ç™¾åˆ†ä½åˆ†éš”ç¬¦ã€‚ä¸‹é¢çš„ä»£ç åœ¨ GNU/Linux ç³»ç»Ÿè§£é‡Šäº†è¿™äº›å·®å¼‚ï¼š

@example
$ @kbd{export POSIXLY_CORRECT=1}                        @ii{Force POSIX behavior}
$ @kbd{gawk 'BEGIN @{ printf "%g\n", 3.1415927 @}'}
@print{} 3.14159
$ @kbd{LC_ALL=en_DK.utf-8 gawk 'BEGIN @{ printf "%g\n", 3.1415927 @}'}
@print{} 3,14159
$ @kbd{echo 4,321 | gawk '@{ print $1 + 1 @}'}
@print{} 5
$ @kbd{echo 4,321 | LC_ALL=en_DK.utf-8 gawk '@{ print $1 + 1 @}'}
@print{} 5,321
@end example

@noindent
@code{en_DK.utf-8} æ˜¯ä¸¹éº¦è‹±è¯­è¯­è¨€ï¼Œåœ¨è¿™ä¸ªè®¾ç½®ä¸­ï¼Œé€—å·æ˜¯ä½œä¸ºå°æ•°ç‚¹ä½¿ç”¨çš„ã€‚
åœ¨æ­£å¸¸çš„ @code{"C"} è¯­è¨€è®¾ç½®ä¸­ï¼Œ@command{gawk} å°† @samp{4,321} å½“æˆæ˜¯ 4ï¼Œ
è€Œåœ¨ä¸¹éº¦è¯­è¨€è®¾ç½®ä¸­ï¼Œåˆ™è¢«å®Œå…¨å½“æˆäº†ä¸€ä¸ªæ•°å€¼ï¼Œå…¶åŒ…å«åˆ†æ•°ä¸º 4.321ã€‚

ä¸€äº›æ—©æœŸçš„ @command{gawk} ç‰ˆæœ¬å®Œå…¨æŒ‰ç…§æ ‡å‡†è¿›è¡Œç¼–è¯‘ã€‚ä½†æ˜¯å¾ˆå¤šçš„éè‹±è¯­è¯­è¨€çš„ç”¨æˆ·æŠ±æ€¨è¿™æ ·çš„è¡Œä¸ºï¼Œ
å› ä¸ºä»–ä»¬ç”¨ç‚¹è¡¨ç¤ºåè¿›åˆ¶é‡Œçš„å°æ•°ç‚¹ï¼Œæ‰€ä»¥ï¼Œé»˜è®¤çš„è¡Œä¸ºåˆæ¢å¤åˆ°ä½¿ç”¨ç‚¹æ¥åšä¸ºå°æ•°ç‚¹ç¬¦å·ã€‚ä½ å¯ä»¥ä½¿ç”¨ @option{--use-lc-numeric}
ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰é€‰é¡¹æ¥å¼ºåˆ¶ @command{gawk} ä½¿ç”¨æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­çš„åè¿›åˆ¶å°æ•°ç‚¹ã€‚
ï¼ˆ@command{gawk} åœ¨ POSIX æ¨¡å¼ä¸­ä¹Ÿä½¿ç”¨æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­çš„åè¿›åˆ¶å°æ•°ç‚¹ï¼Œä¸ç®¡æ˜¯é€šè¿‡ @option{--posix} é€‰é¡¹æˆ–è€…
æ˜¯ @env{POSIXLY_CORRECT} ç¯å¢ƒå˜é‡æ¥æŒ‡å®šã€‚ï¼‰

@ref{table-locale-affects} è¯´æ˜äº†ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­çš„åè¿›åˆ¶å°æ•°ç‚¹ç¬¦å·ï¼Œ
ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç‚¹ä½œä¸ºåè¿›åˆ¶å°æ•°ç‚¹ç¬¦å·ã€‚è¿˜æœ‰ä¸€äº›ç‰¹æ€§è¿˜æ²¡æœ‰æ¶‰åŠåˆ°ã€‚

@float Table,table-locale-affects
@caption{æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­çš„åè¿›åˆ¶å°æ•°ç‚¹ä¸åœ†ç‚¹}
@multitable @columnfractions .15 .20 .45
@headitem Feature @tab Default @tab @option{--posix} or @option{--use-lc-numeric}
@item @code{%'g} @tab Use locale @tab Use locale
@item @code{%g} @tab Use period @tab Use locale
@item Input @tab Use period @tab Use locale
@item @code{strtonum()} @tab Use period @tab Use locale
@end multitable
@end float

æœ€åï¼Œç°åœ¨çš„æ­£å¼æ ‡å‡†ä»¥åŠ IEEE æ ‡å‡†çš„æµ®ç‚¹æ•°è¡¨ç¤ºæ³•å¯¹äº @command{gawk} è½¬æ¢ä¸€äº›ç‰¹å®šçš„å­—ä¸²ä¸ºæ•°å€¼çš„æ–¹å¼ï¼Œ
éƒ½æœ‰ä¸€äº›ä¸å¸¸è§ä½†æ˜¯éå¸¸é‡è¦çš„å½±å“ã€‚ç›¸å…³çš„ç»†èŠ‚å‘ˆç°åœ¨ @ref{POSIX Floating Point Problems}ã€‚

@node All Operators
@section æ“ä½œç¬¦ï¼šå¯¹å€¼è¿›è¡Œå¤„ç†

è¿™ä¸€@value{SECTION}ä»‹ç»åˆ©ç”¨å¸¸é‡ä¸å˜é‡å€¼çš„@dfn{æ“ä½œç¬¦}ã€‚

@menu
* Arithmetic Ops::              Arithmetic operations (@samp{+}, @samp{-},
                                etc.)
* Concatenation::               Concatenating strings.
* Assignment Ops::              Changing the value of a variable or a field.
* Increment Ops::               Incrementing the numeric value of a variable.
@end menu

@node Arithmetic Ops
@subsection ç®—æœ¯æ“ä½œç¬¦
@cindex arithmetic operators
@cindex operators, arithmetic
@c @cindex addition
@c @cindex subtraction
@c @cindex multiplication
@c @cindex division
@c @cindex remainder
@c @cindex quotient
@c @cindex exponentiation

@command{awk} è¯­è¨€ä½¿ç”¨å¸¸ç”¨çš„ç®—æœ¯æ“ä½œç¬¦æ¥å¯¹è¡¨è¾¾å¼æ±‚å€¼ã€‚
æ‰€æœ‰çš„è¿™äº›ç®—æœ¯è¡¨è¾¾å¼éƒ½å…·æœ‰æ­£å¸¸çš„ä¼˜å…ˆçº§ï¼Œå¹¶æŒ‰ä½ æ‰€æœŸæœ›çš„æ–¹å¼å·¥ä½œã€‚

ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶åä¸º @file{grades} çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†å­¦ç”Ÿåå­—ä¸æ¯ä¸ªå­¦ç”Ÿçš„ä¸‰ä¸ªæµ‹è¯•æˆç»©ï¼ˆç­çº§ç¡®å®å°ï¼‰ï¼š

@example
Pat   100 97 58
Sandy  84 72 93
Chris  72 92 89
@end example

@noindent
ä¸‹é¢çš„ç¨‹åºè¯»å–æ–‡ä»¶ @file{grades} å¹¶æ‰“å°å¹³å‡æˆç»©ï¼š

@example
$ @kbd{awk '@{ sum = $2 + $3 + $4 ; avg = sum / 3}
>        @kbd{print $1, avg @}' grades}
@print{} Pat 85
@print{} Sandy 83
@print{} Chris 84.3333
@end example

ä¸‹é¢çš„åˆ—è¡¨åˆ—å‡ºäº† @command{awk} ä¸­çš„ç®—æœ¯æ“ä½œç¬¦ï¼Œå¹¶æŒ‰ä¼˜å…ˆçº§é™åºæ’åºï¼š

@table @code
@cindex common extensions, @code{**} operator
@cindex extensions, common@comma{} @code{**} operator
@cindex POSIX @command{awk}, arithmetic operators and
@item @var{x} ^ @var{y}
@itemx @var{x} ** @var{y}
å¹‚ä¹˜ï¼Œè¡¨ç¤º @var{x} çš„ @var{y} æ¬¡å¹‚ã€‚
@samp{2 ^ 3} çš„å€¼ä¸º 8ï¼Œå­—ç¬¦åºåˆ— @samp{**} ä¸ @samp{^} ç­‰åŒã€‚@value{COMMONEXT}

@item - @var{x}
å–è´Ÿã€‚

@item + @var{x}
ä¸€å…ƒåŠ ï¼Œè¡¨è¾¾å¼ä¼šè¢«è½¬æ¢æˆæ•°å€¼ã€‚

@item @var{x} * @var{y}
ä¹˜ã€‚

@cindex troubleshooting, division
@cindex division
@item @var{x} / @var{y}
é™¤ã€‚ç”±äºåœ¨ @command{awk} ä¸­çš„æ‰€æœ‰æ•°å€¼éƒ½æ˜¯æµ®ç‚¹æ•°ï¼Œç»“æœ@emph{ä¸ä¼š}èˆå…¥è¾“å‡ºä¸ºæ•´æ•°â€”â€”@samp{3 / 4} çš„å€¼ä¸º 0.75ã€‚
ï¼ˆè¿™å¾ˆå®¹æ˜“å‡ºé”™ï¼Œå°¤å…¶å¯¹ C ç¨‹åºå‘˜ï¼Œä¼šå¿˜è®° @command{awk} ä¸­çš„@emph{æ‰€æœ‰}æ•°å€¼éƒ½æ˜¯æµ®ç‚¹æ•°ï¼Œçœ‹èµ·æ¥æ˜¯æ•´æ•°çš„é™¤ï¼Œäº§ç”Ÿä¸€ä¸ªå®æ•°ï¼Œè€Œä¸æ˜¯æ•´æ•°ã€‚ï¼‰

@item @var{x} % @var{y}
æ±‚ä½™ï¼Œè¿›ä¸€æ­¥çš„è®¨è®ºä¼šåœ¨ä¸‹é¢ã€‚

@item @var{x} + @var{y}
åŠ ã€‚

@item @var{x} - @var{y}
å‡ã€‚
@end table

ä¸€å…ƒåŠ ä»¥å‡éƒ½æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¹˜æ³•æ“ä½œç¬¦éƒ½æœ‰ç›¸åŒä¼˜å…ˆçº§ï¼ŒåŠ ä¸å‡å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ã€‚

@cindex differences in @command{awk} and @command{gawk}, trunc-mod operation
@cindex trunc-mod operation
å½“è®¡ç®— @samp{@var{x} % @var{y}} çš„ä½™æ•°æ—¶ï¼Œå•†ä¼šå‘é›¶èˆå…¥èˆå‡ºï¼Œå¹¶è¢« @var{y} ä¹˜ã€‚
è¿™ä¸ªç»“æœå†è¢«ä» @var{x} å‡å»ã€‚æœ¬æ“ä½œæœ‰æ—¶å€™ä¼šç§°ä¸º â€œtrunc-modeâ€ æ“ä½œï¼Œä¸‹é¢çš„å…³ç³»æ€»æ˜¯ä¼šæˆç«‹ï¼š

@example
b * int(a / b) + (a % b) == a
@end example

è¿™ç§å®šä¹‰ä¸‹ï¼Œå¦‚æœåœ¨ @samp{@var{x} % @var{y}} åœ¨ @var{x} ä¸ºè´Ÿå€¼æ—¶ï¼Œå…¶ä¹Ÿä¸ºè´Ÿå€¼ï¼Œ
è¿™å¯èƒ½ä¸æ˜¯é¢„æœŸçš„ç»“æœï¼š

@example
-17 % 8 = -1
@end example

åœ¨å…¶ä»–çš„ @command{awk} å®ç°ä¸­ï¼Œä½™æ•°çš„ç¬¦å·å¯èƒ½è·Ÿæœºå™¨æœ‰å…³ã€‚
@c FIXME !!! what does posix say?

@cindex portability, @code{**} operator and
@cindex @code{*} (asterisk), @code{**} operator
@cindex asterisk (@code{*}), @code{**} operator
@quotation æç¤º
POSIX æ ‡å‡†ä¸­åªæŒ‡å®šäº† @samp{^} ä½œä¸ºå¹‚ä¹˜ã€‚ä¸ºäº†æœ€å¤§çš„å¯ç§»æ¤æ€§ï¼Œä¸è¦ä½¿ç”¨ @samp{**} æ“ä½œç¬¦ã€‚
@end quotation

@node Concatenation
@subsection å­—ä¸²è¿æ¥
@cindex Kernighan, Brian
@quotation
@i{
åœ¨é‚£ä¸ªæ—¶å€™çœ‹èµ·æ¥ç¡®å®æ˜¯ä¸ªå¥½ä¸»æ„ã€‚
}
@author Brian Kernighan
@end quotation

@cindex string operators
@cindex operators, string
@cindex concatenating
åªæœ‰ä¸€ä¸ªå­—ä¸²æ“ä½œç¬¦ï¼šè¿æ¥ã€‚å®é™…ä¸Šå¹¶æ²¡æœ‰ç‰¹å®šçš„æ“ä½œç¬¦æ¥è¡¨ç¤ºå®ƒã€‚ç›¸åï¼Œè¿æ¥æ“ä½œæ˜¯é€šè¿‡å°†è¡¨è¾¾å¼å†™æˆä¸¤ä¸¤ç›¸é‚»ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{awk '@{ print "Field number one: " $1 @}' mail-list}
@print{} Field number one: Amelia
@print{} Field number one: Anthony
@dots{}
@end example

åœ¨å­—ä¸²å¸¸é‡ @samp{:} åé¢æ²¡æœ‰ç©ºæ ¼ï¼Œæ•´è¡Œè¾“å‡ºåœ¨ä¸€èµ·ã€‚æ¯”å¦‚ï¼š

@example
$ @kbd{awk '@{ print "Field number one:" $1 @}' mail-list}
@print{} Field number one:Amelia
@print{} Field number one:Anthony
@dots{}
@end example

@cindex troubleshooting, string concatenation
ç”±äºå­—ä¸²è¿æ¥æ²¡æœ‰æ˜¾å¼çš„æ“ä½œç¬¦ï¼Œå› æ­¤é€šå¸¸éœ€è¦ä¿è¯è¿™å‘ç”Ÿæˆåˆé€‚çš„æ—¶é—´ï¼Œè¿™æ˜¯é€šè¿‡å°†è¦è¿æ¥çš„é¡¹ç”¨æ‹¬å·åŒ…èµ·æ¥ã€‚
ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦ä¸‹é¢çš„ä»£ç æ¥è¿æ¥èµ· @code{file} ä¸ @code{name}ï¼š

@example
file = "file"
name = "name"
print "something meaningful" > file name
@end example

@cindex Brian Kernighan's @command{awk}
@cindex @command{mawk} utility
@noindent
è¿™åœ¨ Unix @command{awk} ä¸­ä¼šäº§ç”Ÿä¸€ä¸ªè¯­æ³•é”™è¯¯ã€‚
@footnote{è¿™åœ¨ BWK @command{awk} ä¸­ä¼šå‘ç”Ÿï¼Œ@command{gawk} ä»¥åŠ @command{mawk} éƒ½â€œæ‰§è¡Œæ­£ç¡®â€ï¼Œä½†æ˜¯åˆ«ä¾èµ–äºè¿™ä¸ªç»“æœã€‚}
åº”è¯¥å¦‚ä¸‹ä½¿ç”¨ï¼š

@example
print "something meaningful" > (file name)
@end example

@cindex order of evaluation, concatenation
@cindex evaluation order, concatenation
@cindex side effects
åœ¨å­—ä¸²è¿æ¥ä¸¤è¾¹ï¼Œæ‹¬å·åœ¨é™¤äº† @samp{=} å³è¾¹çš„æ‰€æœ‰æƒ…å†µä¸‹éƒ½åº”è¯¥ä½¿ç”¨ã€‚åœ¨ç‰¹åˆ«æ³¨æ„åœ¨å­—ä¸²è¿æ¥ä¸­æ‰€ä½¿ç”¨çš„è¡¨è¾¾å¼ã€‚ç‰¹åˆ«æ˜¯ï¼Œè¡¨è¾¾å¼çš„æ±‚å€¼é¡ºåºç”¨æ¥è¿›è¡Œå­—ä¸²è¿æ¥ï¼Œåœ¨ @command{awk} è¯­è¨€ä¸­æ˜¯æ²¡æœ‰å®šä¹‰çš„ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š

@example
BEGIN @{
    a = "don't"
    print (a " " (a = "panic"))
@}
@end example

@noindent
æ˜¯å¦æ˜¯ç¬¬äºŒä¸ªèµ‹å€¼æ“ä½œå‘ç”Ÿåœ¨ @code{a} çš„å€¼è¿”å›ä¹‹å‰è¿˜æ˜¯ä¹‹åè¿™æ˜¯ä¸ç¡®å®šçš„ã€‚
ç»“æœå¯ä»¥æ˜¯ @samp{don't panic}ï¼Œæˆ–è€…æ˜¯ @samp{panic panic}ã€‚
@c see test/nasty.awk for a worse example

åœ¨ä¸å…¶ä»–çš„æ“ä½œç¬¦æ··åˆæ—¶ï¼Œè¿æ¥æ“ä½œçš„ä¼˜å…ˆçº§é€šå¸¸æ˜¯åç›´è§‰çš„ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š

@ignore
> To: bug-gnu-utils@@gnu.org
> CC: arnold@@gnu.org
> Subject: gawk 3.0.4 bug with {print -12 " " -24}
> From: Russell Schulz <Russell_Schulz@locutus.ofB.ORG>
> Date: Tue, 8 Feb 2000 19:56:08 -0700
>
> gawk 3.0.4 on NT gives me:
>
> prompt> cat bad.awk
> BEGIN { print -12 " " -24; }
>
> prompt> gawk -f bad.awk
> -12-24
>
> when I would expect
>
> -12 -24
>
> I have not investigated the source, or other implementations.  The
> bug is there on my NT and DOS versions 2.15.6 .
@end ignore

@example
$ @kbd{awk 'BEGIN @{ print -12 " " -24 @}'}
@print{} -12-24
@end example

å¾ˆâ€œæ˜æ˜¾â€çš„æ˜¯è¦è¿æ¥ @minus{}12ï¼Œä¸€ä¸ªç©ºæ ¼ä¸ @minus{}24ã€‚
ä½†æ˜¯ç©ºæ ¼æ¶ˆå¤±åˆ°å“ªé‡Œå»äº†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åœ¨æ“ä½œç¬¦çš„ä¼˜å…ˆç»„åˆä¸ @command{awk} çš„è‡ªåŠ¨è½¬æ¢è§„åˆ™é‡Œã€‚ä¸ºäº†å¾—åˆ°æ‰€æƒ³è¦çš„ç»“æœï¼Œåƒä¸‹é¢è¿™æ ·å†™ï¼š

@example
$ @kbd{awk 'BEGIN @{ print -12 " " (-24) @}'}
@print{} -12 -24
@end example

è¿™å¼ºåˆ¶ @command{awk} å°† @samp{-24} ä¸­çš„ @samp{-} å½“æˆæ˜¯ä¸€å…ƒæ“ä½œç¬¦ã€‚å¦åˆ™ï¼Œå®ƒä¼šè¿™ä¹ˆæ¥åˆ†æï¼š

@display
    @minus{}12 (@code{"@ "} @minus{} 24)
@result{} @minus{}12 (0 @minus{} 24)
@result{} @minus{}12 (@minus{}24)
@result{} @minus{}12@minus{}24
@end display

å¦‚æ—©å…ˆæ‰€æï¼Œå½“è¿æ¥æ“ä½œä¸å…¶ä»–æ“ä½œç¬¦æ··åˆæ—¶ï¼Œ@emph{ç”¨æ‹¬å·æ‹¬èµ·æ¥}ã€‚å¦åˆ™ï¼Œä½ æ— æ³•ç¡®è®¤ä½ ä¼šå¾—åˆ°ä»€ä¹ˆç»“æœã€‚

@node Assignment Ops
@subsection èµ‹å€¼è¡¨è¾¾å¼
@cindex assignment operators
@cindex operators, assignment
@cindex expressions, assignment
@cindex @code{=} (equals sign), @code{=} operator
@cindex equals sign (@code{=}), @code{=} operator
@dfn{èµ‹å€¼è¡¨è¾¾å¼}æ˜¯å°†ä¸€ä¸ªï¼ˆé€šå¸¸ä¸ä¸€æ ·çš„ï¼‰å€¼å­˜å…¥æŸä¸ªå˜é‡çš„è¡¨è¾¾å¼ã€‚
ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†å˜é‡ @code{z} çš„å€¼èµ‹ä¸º 1ï¼š

@example
z = 1
@end example

å½“è¿™ä¸ªè¡¨è¾¾å¼æ‰§è¡Œåï¼Œå˜é‡ @code{z} çš„å€¼å°±ä¸º 1ã€‚ä¸ç®¡ @code{z} çš„æ—§å€¼æ˜¯ä»€ä¹ˆï¼Œéƒ½å°†ä¸¢å¼ƒã€‚

èµ‹å€¼ä¹Ÿå¯ä»¥å­˜å‚¨å­—ä¸²å€¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢å°†å€¼ @code{"this food is good"} å­˜å‚¨åˆ°å˜é‡ @code{message} ä¸­ï¼š

@example
thing = "food"
predicate = "good"
message = "this " thing " is " predicate
@end example

@noindent
@cindex side effects, assignment expressions
è¿™ä¸ªä¾‹å­ä¹Ÿå‘ˆç°äº†å­—ä¸²è¿æ¥æ“ä½œã€‚
@samp{=} ç¬¦å·ç§°ä¸º@dfn{èµ‹å€¼æ“ä½œç¬¦}ã€‚è¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„æ“ä½œç¬¦ï¼Œå› ä¸ºå…¶å³è¾¹çš„æ“ä½œæ•°çš„å€¼ä¼šåŸå°ä¸åŠ¨åœ°å­˜ä¸‹æ¥ã€‚å¤§å¤šæ•°æ“ä½œç¬¦ï¼ˆåŠ ï¼Œè¿æ¥ç­‰ï¼‰é™¤éè¦è®¡ç®—å€¼ï¼Œå¦åˆ™éƒ½æ²¡æœ‰å®é™…æ•ˆæœã€‚å¦‚æœå€¼æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä¹Ÿæ²¡æœ‰ç†ç”±ä½¿ç”¨è¿™ä¸ªæ“ä½œç¬¦ã€‚èµ‹å€¼æ“ä½œç¬¦åˆ™ä¸åŒï¼šå› ä¸ºå®ƒç¡®å®äº§ç”Ÿä¸€ä¸ªå€¼ï¼Œä½†æ˜¯å°±ç®—ä½ å¿½ç•¥å®ƒï¼Œèµ‹å€¼ä»ç„¶ä½¿è‡ªå·±èµ°å®Œå˜é‡çš„å˜åŒ–è¿‡ç¨‹ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªæ•ˆåº”ä¸º@dfn{å‰¯ä½œç”¨}ã€‚

@cindex lvalues/rvalues
@cindex rvalues/lvalues
@cindex assignment operators, lvalues/rvalues
@cindex operators, assignment
èµ‹å€¼å·¦è¾¹çš„æ“ä½œæ•°ä¸éœ€è¦æ˜¯ä¸€ä¸ªå˜é‡ï¼ˆæŸ¥çœ‹ @ref{Variables}ï¼‰ï¼Œå…¶ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŸŸï¼ˆæŸ¥çœ‹ @ref{Changing Fields}ï¼‰
æˆ–è€…ä¸€ä¸ªæ•°ç»„å…ƒç´ ï¼ˆæŸ¥çœ‹ @ref{Arrays}ï¼‰ã€‚æ‰€æœ‰è¿™äº›éƒ½ç§°ä¸ºå€¼ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥å‡ºç°åœ¨èµ‹å€¼æ“ä½œç¬¦å·¦è¾¹ã€‚
å³è¾¹çš„æ“ä½œæ•°å¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼Œå…¶ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å€¼æ¥èµ‹å€¼å­˜å‚¨åœ¨æŒ‡å®šçš„å˜é‡ã€åŸŸæˆ–è€…æ•°ç»„å…ƒç´ ã€‚ï¼ˆè¿™æ ·çš„å€¼ç§°ä¸º@dfn{å³å€¼ï¼ˆrvaluesï¼‰}ã€‚ï¼‰

@cindex variables, types of
è¦æ³¨æ„çš„æ˜¯ï¼Œå˜é‡@emph{æ²¡æœ‰}å›ºå®šçš„ç±»å‹ã€‚å˜é‡çš„ç±»å‹å°±æ˜¯å…¶æœ€åè¢«èµ‹å€¼çš„æ•°æ®çš„ç±»å‹ã€‚
åœ¨ä¸‹é¢çš„ç¨‹åºç‰‡æ®µä¸­ï¼Œå˜é‡ @code{foo} å…ˆå…·æœ‰æ•°å€¼ç±»å‹ï¼Œç„¶åå…·æœ‰å­—ä¸²ç±»å‹ï¼š

@example
foo = 1
print foo
foo = "bar"
print foo
@end example

@noindent
å½“ç¬¬äºŒä¸ªèµ‹å€¼ç»™äº† @code{foo} ä¸€ä¸ªå­—ä¸²å€¼ï¼Œè€Œè¿™ä¹‹å‰å…¶å…·æœ‰æ•°å€¼ç±»å‹å°±ä¸¢å¼ƒäº†ã€‚

å­—ä¸²å€¼ä¸­ï¼Œå¦‚æœä¸æ˜¯ä¸€ä¸ªä»¥ä¸€ä¸ªæ•°å€¼å¼€å¤´çš„è¯ï¼Œå…¶å¯¹åº”çš„æ•°å€¼å€¼ä¸º 0ã€‚åœ¨æ‰§è¡Œäº†ä¸‹é¢çš„ä»£ç åï¼Œ@code{foo} çš„å€¼ä¸º 5ï¼š

@example
foo = "a string"
foo = foo + 5
@end example

@quotation æç¤º
å°†å˜é‡ä½œä¸ºä¸€ä¸ªæ•°å€¼ï¼Œç„¶åä½œä¸ºå­—ä¸²æœ‰æ—¶å€™ä¼šäº§ç”Ÿå›°æƒ‘ï¼Œè€Œä¸”ä¹Ÿæ˜¯ä¸€ä¸ªä¸å¥½çš„ç¼–ç¨‹é£æ ¼ã€‚
å‰é¢çš„ä¸¤ä¸ªä¾‹å­åªæ˜¯ç”¨æ¥è¯´æ˜ @command{awk} å¦‚ä½•å·¥ä½œï¼Œè€Œ@emph{ä¸æ˜¯}å‘Šè¯‰å¤§å®¶è¿™ä¹ˆæ¥å†™ç¨‹åºçš„ï¼
@end quotation

èµ‹å€¼æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå› æ­¤å®ƒæœ‰å€¼â€”â€”ä¸€ä¸ªä¸å…¶è¢«èµ‹äºˆçš„ç›¸åŒçš„å€¼ã€‚
å› æ­¤ @samp{z = 1} æ˜¯ä¸€ä¸ªå…·æœ‰å€¼ä¸º 1 çš„è¡¨è¾¾å¼ã€‚è¿™ä¸ªç‰¹æ€§çš„ä¸€ä¸ªç»“æœå°±æ˜¯ä½ å¯ä»¥å°†å¤šä¸ªèµ‹å€¼å†™åœ¨ä¸€èµ·ï¼Œå¦‚ï¼š

@example
x = y = z = 5
@end example

@noindent
è¿™ä¸ªä¾‹å­ä¸­ï¼Œ5 è¿™ä¸ªå€¼è¢«èµ‹ç»™äº†ä¸‰ä¸ªå˜é‡ï¼ˆ@code{x}ï¼Œ@code{y} ä¸ @code{z}ï¼‰ã€‚
è¿™æ˜¯å› ä¸º @samp{z = 5} çš„å€¼ä¸º 5ï¼Œç„¶åå†å­˜äº @code{y} ä¸­ï¼Œå› æ­¤ @samp{y = z = 5} çš„å€¼ä¸º 5ï¼Œæœ€åå­˜åˆ° @code{x} ä¸­ã€‚

èµ‹å€¼å¯ä»¥è¢«ç”¨äºä»»ä½•å¯ç§°ä¸ºè¡¨è¾¾å¼çš„åœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œ
è¿™ä¹ˆå†™ @samp{x != (y = 1)} æ˜¯æœ‰æ•ˆçš„å½¢å¼ï¼Œå…¶å°† @code{y} çš„å€¼è®¾æˆ 1ï¼Œç„¶åæµ‹è¯• @code{x} æ˜¯å¦ç­‰äº 1ã€‚
ä½†æ˜¯è¿™æ ·çš„é£æ ¼ä¼šå¯¼è‡´ç¨‹åºéš¾ä»¥é˜…è¯»ï¼Œè¿™æ ·çš„èµ‹å€¼åµŒå¥—åº”è¯¥è¦é¿å…ï¼Œé™¤éæ˜¯åœ¨ä¸€æ¬¡æ€§çš„ç¨‹åºé‡Œã€‚

@cindex @code{+} (plus sign), @code{+=} operator
@cindex plus sign (@code{+}), @code{+=} operator
é™¤äº† @samp{=} å¤–ï¼Œè¿˜æœ‰å‡ ä¸ªå…¶ä»–çš„æ“ä½œç¬¦ç”¨äºæ‰§è¡Œä¸å˜é‡æ—§å€¼çš„ç®—æœ¯è¿ç®—ã€‚
ä¾‹å¦‚ï¼Œæ“ä½œç¬¦ @samp{+=} å°†å³è¾¹çš„å€¼åŠ åˆ°å˜é‡çš„æ—§å€¼ä»¥ç”Ÿæˆæ–°å€¼ã€‚æ‰€ä»¥ï¼Œ
ä¸‹é¢çš„èµ‹å€¼ä¼šåœ¨ @code{foo} å€¼çš„åŸºç¡€ä¸ŠåŠ ä¸Š 5ï¼š

@example
foo += 5
@end example

@noindent
è¿™ä¸ä¸‹é¢çš„ä»£ç æ˜¯ç­‰åŒçš„ï¼š

@example
foo = foo + 5
@end example

@noindent
ç”¨å“ªä¸€ç§å½¢å¼ï¼Œéƒ½å¯ä»¥æ¸…æ™°åœ°è¡¨ç¤ºä½ ç¨‹åºçš„æ„å›¾ã€‚

æœ‰å‡ ä¸ªç§æƒ…å†µä½¿ç”¨ @samp{+=} ï¼ˆæˆ–è€…ä»»æ„çš„èµ‹å€¼è¡¨æ“ä½œç¬¦ï¼‰ä¸ç®€å•åœ°å°†å·¦è¾¹çš„æ“ä½œæ•°ä½œä¸ºå³è¾¹çš„è¡¨è¾¾å¼çš„é‡å¤æ˜¯@emph{ä¸}ä¸€æ ·çš„ï¼Œå¦‚ï¼š

@cindex Rankin, Pat
@example
# Thanks to Pat Rankin for this example
BEGIN  @{
    foo[rand()] += 5
    for (x in foo)
       print x, foo[x]

    bar[rand()] = bar[rand()] + 5
    for (x in bar)
       print x, bar[x]
@}
@end example

@cindex operators, assignment, evaluation order
@cindex assignment operators, evaluation order
@noindent
@code{bar} è¿™ä¸ªä¸‹æ ‡ä¸€èˆ¬åœ¨å®é™…ä¸­éƒ½æ˜¯ä¸ç›¸åŒçš„ï¼Œå› ä¸º @code{rand()} æ¯æ¬¡è°ƒç”¨æ—¶éƒ½äº§ç”Ÿä¸åŒçš„å€¼ã€‚
ï¼ˆæ•°ç»„ä¸ @code{rand()} å‡½æ•°éƒ½è¿˜æ²¡æœ‰è®¨è®ºåˆ°ï¼ŒæŸ¥çœ‹ @ref{Arrays}ï¼Œä¸ 
@ifnotdocbook
@ref{Numeric Functions}
@end ifnotdocbook
@ifdocbook
@ref{Numeric Functions}
@end ifdocbook
ï¼Œæ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚ï¼‰
è¿™ä¸ªä¾‹å­è¯´æ˜äº†èµ‹å€¼æ“ä½œç¬¦çš„ä¸€ä¸ªé‡è¦äº‹å®ï¼šè¡¨è¾¾å¼çš„å·¦è¾¹åªä¼šæ±‚å€¼@emph{ä¸€æ¬¡}ã€‚

ä½†æ˜¯å¯¹äºè¡¨è¾¾å¼çš„æ±‚å€¼é¡ºåºï¼Œæ˜¯å…ˆå·¦è¾¹è¿˜æ˜¯å³è¾¹åˆ™æ˜¯ä¾èµ–äºå®ç°çš„ã€‚å¦‚ä¸‹é¢ï¼š

@example
i = 1
a[i += 2] = i + 1
@end example

@noindent
@code{a[3]} çš„å€¼å¯ä»¥æ˜¯ 2ï¼Œ ä¹Ÿå¯ä»¥æ˜¯ 4ã€‚

@ref{table-assign-ops} åˆ—å‡ºäº†æ‰€æœ‰çš„ç®—æœ¯èµ‹å€¼æ“ä½œç¬¦ï¼Œåœ¨æ¯ç§æƒ…å†µä¸‹ï¼Œå³è¾¹çš„æ“ä½œæ•°æ˜¯ä¸€ä¸ªå€¼ä¼šè¢«è½¬æ¢ä¸ºå€¼çš„è¡¨è¾¾å¼ã€‚

@cindex @code{-} (hyphen), @code{-=} operator
@cindex hyphen (@code{-}), @code{-=} operator
@cindex @code{*} (asterisk), @code{*=} operator
@cindex asterisk (@code{*}), @code{*=} operator
@cindex @code{/} (forward slash), @code{/=} operator
@cindex forward slash (@code{/}), @code{/=} operator
@cindex @code{%} (percent sign), @code{%=} operator
@cindex percent sign (@code{%}), @code{%=} operator
@cindex @code{^} (caret), @code{^=} operator
@cindex caret (@code{^}), @code{^=} operator
@cindex @code{*} (asterisk), @code{**=} operator
@cindex asterisk (@code{*}), @code{**=} operator
@float Table,table-assign-ops
@caption{ç®—æœ¯èµ‹å€¼æ“ä½œç¬¦}
@multitable @columnfractions .30 .70
@headitem æ“ä½œç¬¦ @tab æ•ˆæœ
@item @var{lvalue} @code{+=} @var{increment} @tab å°† @var{increment} æ·»åŠ åˆ° @var{lvalue} çš„å€¼ä¸Šã€‚
@item @var{lvalue} @code{-=} @var{decrement} @tab åœ¨ @var{lvalue} çš„å€¼ä¸Šå‡å» decrementã€‚
@item @var{lvalue} @code{*=} @var{coefficient} @tab å°† @var{lvalue} çš„å€¼ä¹˜ä¸Šä¸€ä¸ª coefficientã€‚
@item @var{lvalue} @code{/=} @var{divisor} @tab å°† @var{lvalue} çš„å€¼é™¤ä¸Šä¸€ä¸ª divisorã€‚
@item @var{lvalue} @code{%=} @var{modulus} @tab è®¾ç½® @var{lvalue} çš„å€¼ä¸å…¶å€¼ä¸ @var{modulus} æ±‚æ¨¡ã€‚
@cindex common extensions, @code{**=} operator
@cindex extensions, common@comma{} @code{**=} operator
@cindex @command{awk} language, POSIX version
@cindex POSIX @command{awk}
@item @var{lvalue} @code{^=} @var{power} @tab å°† @var{lvalue} çš„å€¼è¿›è¡Œå¹‚ä¹˜ powerã€‚
@item @var{lvalue} @code{**=} @var{power} @tab å°† @var{lvalue} çš„å€¼è¿›è¡Œå¹‚ä¹˜ powerã€‚@value{COMMONEXT}
@end multitable
@end float

@cindex POSIX @command{awk}, @code{**=} operator and
@cindex portability, @code{**=} operator and
@quotation æç¤º
POSIX ä¸­åªæŒ‡å®šäº† @samp{^=} ã€‚ä¸ºäº†ç§»æ¤æ€§ï¼Œä¸è¦ä½¿ç”¨ @samp{**=} æ“ä½œç¬¦ã€‚
@end quotation

@sidebar @samp{/=} ä¸æ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´çš„äºŒä¹‰æ€§
@cindex dark corner, regexp constants, @code{/=} operator and
@cindex @code{/} (forward slash), @code{/=} operator, vs. @code{/=@dots{}/} regexp constant
@cindex forward slash (@code{/}), @code{/=} operator, vs. @code{/=@dots{}/} regexp constant
@cindex regexp constants, @code{/=@dots{}/}, @code{/=} operator and

@c derived from email from  "Nelson H. F. Beebe" <beebe@math.utah.edu>
@c Date: Mon, 1 Sep 1997 13:38:35 -0600 (MDT)

@cindex dark corner, @code{/=} operator vs. @code{/=@dots{}/} regexp constant
@cindex ambiguity, syntactic: @code{/=} operator vs. @code{/=@dots{}/} regexp constant
@cindex syntactic ambiguity: @code{/=} operator vs. @code{/=@dots{}/} regexp constant
@cindex @code{/=} operator vs. @code{/=@dots{}/} regexp constant
åœ¨ @code{/=} èµ‹å€¼æ“ä½œç¬¦ä¸æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼ˆå“ªä¸ªè®°å½•çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ @samp{=}ï¼‰ä¹‹é—´æœ‰ä¸€ä¸ªè¯­æ³•ä¸Šçš„äºŒä¹‰æ€§ã€‚
@value{DARKCORNER}
è¿™åœ¨ä¸€äº›å•†ä¸šæ€§çš„ @command{awk} ç‰ˆæœ¬é‡Œæ›´æ˜¾çœ¼ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{awk /==/ /dev/null}
@error{} awk: syntax error at source line 1
@error{}  context is
@error{}         >>> /= <<<
@error{} awk: bailing out at source line 1
@end example

@noindent
è§£å†³æ–¹æ³•æ˜¯ï¼š

@example
awk '/[=]=/' /dev/null
@end example

@command{gawk} æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼ŒBWK @command{awk} ä¸ @command{mawk} ä¹Ÿæ²¡æœ‰ã€‚
@end sidebar

@node Increment Ops
@subsection é€’å¢ä¸é€’å‡æ“ä½œç¬¦

@cindex increment operators
@cindex operators, decrement/increment
@dfn{é€’å¢}ä¸@dfn{é€’å‡æ“ä½œç¬¦}å¯¹å˜é‡çš„å€¼è¿›è¡Œé€’å¢ä¸é€’å‡ 1ã€‚
èµ‹å€¼æ“ä½œç¬¦å¯ä»¥åšç›¸åŒçš„äº‹æƒ…ï¼Œå› æ­¤é€’å¢æ“ä½œç¬¦å¹¶æ²¡æœ‰ç»™ @command{awk} å¸¦æ¥é¢å¤–çš„åŠŸèƒ½ï¼Œ
ä½†æ˜¯å®ƒä»¬å¯¹äºä¸€äº›å¸¸è§çš„æ“ä½œçš„ç¼©å†™éå¸¸æ–¹ä¾¿ã€‚

@cindex side effects
@cindex @code{+} (plus sign), @code{++} operator
@cindex plus sign (@code{+}), @code{++} operator
@cindex side effects, decrement/increment operators
ç”¨äº@dfn{åŠ ä¸€}çš„æ“ä½œç¬¦å†™ä½œ @samp{++} ã€‚å®ƒå¯ä»¥ç”¨åœ¨é€’å¢çš„å˜é‡çš„å‰é¢ä¸åé¢ã€‚åœ¨å˜é‡ @code{v} å‰é¢é€’å¢å†™æˆ @samp{++v}ï¼Œ
è¿™ä¼šå¯¹ @code{v} å€¼è¿›è¡ŒåŠ ä¸€â€”â€”æ–°çš„å€¼ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ï¼ˆèµ‹å€¼è¡¨è¾¾å¼ @samp{v += 1} ä¸å…¶ç­‰åŒã€‚ï¼‰
åœ¨å˜é‡åé¢é€’å¢ä¸ºåç¼€é€’å¢ã€‚è¿™ä¸å‰é¢çš„å½¢å¼ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯é€’å¢è¡¨è¾¾å¼çš„å€¼æ˜¯å˜é‡çš„@emph{æ—§}å€¼ã€‚
å› æ­¤ï¼Œå¦‚æœ @code{foo} çš„å€¼ ä¸º 4ï¼Œåˆ™è¡¨è¾¾å¼ @samp{foo++} çš„å€¼ä¸º 4ï¼Œä½†æ˜¯å˜é‡çš„å€¼ä¼šå˜æˆ 5ã€‚
æ¢å¥è¯è¯´ï¼Œæ“ä½œç¬¦è¿”å›å˜é‡çš„æ—§å€¼ï¼Œä½†æ˜¯ä½œä¸ºå‰¯ä½œç”¨ä¼šå¯¹å…¶é€’å¢ã€‚

åç¼€é€’å¢ @samp{foo++} å‡ ä¹ä¸ @samp{(foo += 1) - 1} ç›¸åŒã€‚
ä½†æ˜¯åˆä¸å®Œå…¨ç›¸åŒï¼Œå› ä¸ºåœ¨ @command{awk} ä¸­æ‰€æœ‰çš„æ•°å€¼éƒ½æ˜¯æµ®ç‚¹æ•°â€”â€”åœ¨æµ®ç‚¹æ•°ä¸­ï¼Œ@samp{foo + 1 - 1} ä¸ä¸€å®šä¸ @code{foo} ç›¸åŒã€‚
ä½†æ˜¯è¿™ä¸ªå·®å¼‚éå¸¸å°ï¼Œåªè¦ä½ è¦å¤„ç†çš„çš„å€¼éå¸¸å°ï¼ˆå°äº
@iftex
@math{10^{12}}ï¼‰ã€‚
@end iftex
@ifinfo
10e12ï¼‰ã€‚
@end ifinfo
@ifnottex
@ifnotinfo
10@sup{12}ï¼‰ã€‚
@end ifnotinfo
@end ifnottex

@cindex @code{$} (dollar sign), incrementing fields and arrays
@cindex dollar sign (@code{$}), incrementing fields and arrays
åŸŸä¸æ•°ç»„å…ƒç´ ä¹Ÿå¯ä»¥åƒå˜é‡ä¸€æ ·é€’å¢ã€‚ï¼ˆå½“ä½ æƒ³æ‰§è¡Œä¸€ä¸ªåŸŸå‚è€ƒï¼Œåˆå¯¹å˜é‡è¿›è¡Œé€’å¢æ—¶ï¼Œä½¿ç”¨ @samp{$(i++)} ã€‚
æ‹¬å·æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºåŸŸæ“ä½œç¬¦ @samp{$} å…ˆäºé€’å¢æ“ä½œç¬¦ã€‚ï¼‰

@cindex decrement operators
é€’å¢æ“ä½œç¬¦ @samp{--} ä¸ @samp{++} ç±»å‹ï¼Œåªæ˜¯å…¶ç”¨äºå‡è€Œä¸æ˜¯ç”¨äºåŠ ã€‚
ä¸ @samp{++} ä¸€æ ·ï¼Œå…¶ç”¨å¯ç”¨åœ¨å·¦ä¼ çš„å‰é¢è¿›è¡Œå‰ç¼€é€’å‡ï¼Œåœ¨åé¢è¿›è¡Œåç¼€é€’å‡ã€‚ä¸‹é¢æ˜¯å¯¹äºé€’å¢ä¸é€’å‡æ“ä½œç¬¦è¡¨è¾¾å¼çš„æ±‡æ€»ï¼š

@table @code
@cindex @code{+} (plus sign), @code{++} operator
@cindex plus sign (@code{+}), @code{++} operator
@item ++@var{lvalue}
ç»™ @var{lvalue} é€’å¢ 1ï¼Œå¹¶è¿”å›æ–°å€¼ä½œä¸ºè¡¨è¾¾å¼çš„å€¼ã€‚

@item @var{lvalue}++
ç»™ @var{lvalue} é€’å¢ 1ï¼Œå¹¶è¿”å›@emph{æ—§}å€¼ä½œä¸ºè¡¨è¾¾å¼çš„å€¼ã€‚

@cindex @code{-} (hyphen), @code{--} operator
@cindex hyphen (@code{-}), @code{--} operator
@item --@var{lvalue}
ç»™ @var{lvalue} é€’å‡ 1ï¼Œå¹¶è¿”å›æ–°å€¼ä½œä¸ºè¡¨è¾¾å¼çš„å€¼ã€‚ï¼ˆè¿™ä¸ªä¸è¡¨è¾¾å¼ @samp{++@var{lvalue}} ä¸€æ ·ï¼Œåªæ˜¯ç”¨äºå‡ï¼Œè€Œä¸æ˜¯ç”¨äºåŠ ã€‚ï¼‰

@item @var{lvalue}--
ç»™ @var{lvalue} é€’å‡1ï¼Œå¹¶è¿”å›@emph{æ—§}å€¼ä½œä¸ºè¡¨è¾¾å¼çš„å€¼ã€‚ï¼ˆè¿™ä¸ªä¸è¡¨è¾¾å¼ @samp{@var{lvalue}++} ä¸€æ ·ï¼Œ
åªæ˜¯ç”¨äºå‡ï¼Œè€Œä¸æ˜¯ç”¨äºåŠ ã€‚ï¼‰
@end table

@sidebar æ“ä½œç¬¦æ±‚å€¼é¡ºåº
@cindex precedence
@cindex operators, precedence
@cindex portability, operators
@cindex evaluation order
@cindex Marx, Groucho
@quotation
@i{åŒ»ç”Ÿï¼Œå½“æˆ‘è¿™ä¹ˆå¹²çš„æ—¶å€™å°±ä¼šå—ä¼¤ï¼@*
é‚£ä¹ˆä½ å°±åˆ«è¿™ä¹ˆå¹²å•Šï¼}
@author Groucho Marx
@end quotation

@noindent
å½“æˆ‘ä»¬åƒä¸‹é¢è¿™æ ·åšï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

@example
b = 6
print b += b++
@end example

@noindent
æˆ–è€…ä¸€äº›æ›´å¥‡æ€ªçš„ï¼š

@example
b = 6
b += ++b + b++
print b
@end example

@cindex side effects
æ¢å¥è¯è¯´ï¼Œå½“æ‰§è¡Œä¸åŒçš„åç¼€æ“ä½œç¬¦ï¼ˆ@samp{b++}ï¼‰æ—¶ï¼Œä¼šæœ‰å“ªäº›å‰¯ä½œç”¨äº§ç”Ÿï¼Ÿäº§ç”Ÿçš„å‰¯ä½œç”¨æ˜¯@dfn{ç”±å®ç°æ¥å®šä¹‰çš„}ï¼Œ
å³ä¾èµ–äº @command{awk} çš„ç‰¹å®šç‰ˆæœ¬ã€‚ç¬¬ä¸€ä¸ªä¾‹å­çš„ç»“æœå¯èƒ½æ˜¯ 12 æˆ–è€… 13ï¼Œå¯¹äºç¬¬äºŒä¸ªä¾‹å­åˆ™å¯èƒ½æ˜¯ 22 æˆ–è€…æ˜¯ 23ã€‚

ä¸€å¥è¯ï¼Œè¿™ä¹ˆå¹²æ˜¯ä¸å»ºè®®çš„å¹¶ä¸”å…¶ç§»æ¤æ€§å®Œå…¨ä¸å¯ä¾èµ–ã€‚ä½ è¦åœ¨ä½ çš„ç¨‹åºä¸­é¿å…è¿™æ ·çš„ä»£ç ã€‚
@c You'll sleep better at night and be able to look at yourself
@c in the mirror in the morning.
@end sidebar

@node Truth Values and Conditions
@section çœŸå€¼ä¸æ¡ä»¶

åœ¨ç‰¹å®šçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¡¨è¾¾å¼çš„å€¼ä¼šç”¨æ¥ä½œä¸ºâ€œçœŸå€¼â€ï¼Œå¦‚ï¼Œç”¨æ¥å†³å®šæ¥ä¸‹æ¥ç¨‹åºåº”è¯¥æ‰§è¡Œä»€ä¹ˆã€‚
è¿™ä¸€@value{SECTION}ä¸­ä¼šæè¿° @command{awk} å¦‚ä½•å®šä¹‰ @samp{true} ä¸ @samp{false} ä»¥åŠå€¼å¦‚ä½•è¿›è¡Œæ¯”è¾ƒã€‚

@menu
* Truth Values::                What is ``true'' and what is ``false''.
* Typing and Comparison::       How variables acquire types and how this
                                affects comparison of numbers and strings with
                                @samp{<}, etc.
* Boolean Ops::                 Combining comparison expressions using boolean
                                operators @samp{||} (``or''), @samp{&&}
                                (``and'') and @samp{!} (``not'').
* Conditional Exp::             Conditional expressions select between two
                                subexpressions under control of a third
                                subexpression.
@end menu

@node Truth Values
@subsection @command{awk} çš„çœŸä¸å‡
@cindex truth values
@cindex logical false/true
@cindex false, logical
@cindex true, logical

@cindex null strings
è®¸å¤šçš„ç¼–ç¨‹è¯­è¨€å¯¹äºâ€œtrueâ€ä¸â€œfalseâ€æ¦‚å¿µéƒ½æœ‰ç‰¹æ®Šçš„è¡¨ç¤ºæ–¹å¼ã€‚
è¿™æ ·çš„è¯­è¨€é€šå¸¸ä½¿ç”¨ç‰¹æ®Šçš„å¸¸é‡ @code{true} ä¸ @code{false}ï¼Œä»¥åŠå¯¹åº”çš„å¤§å†™ã€‚
ä½†æ˜¯ @command{awk} å´ä¸åŒã€‚å®ƒä» C ä¸­å€Ÿé‰´äº† true ä¸ false çš„æ¦‚å¿µã€‚
åœ¨ @command{awk} ä¸­ï¼Œæ‰€æœ‰é 0 çš„æ•°å€¼@emph{æˆ–è€…}éç©ºä¸²éƒ½æ˜¯ trueã€‚
è€Œå…¶ä»–çš„å€¼ï¼ˆ0 æˆ–è€…ç©ºä¸²ï¼Œ@code{""}ï¼‰éƒ½æ˜¯ falseã€‚ä¸‹é¢çš„ç¨‹åºä¼šæ‰“å° @samp{A strange truth value} ä¸‰æ¬¡ï¼š

@example
BEGIN @{
   if (3.1415927)
       print "A strange truth value"
   if ("Four Score And Seven Years Ago")
       print "A strange truth value"
   if (j = 57)
       print "A strange truth value"
@}
@end example

@cindex dark corner, @code{"0"} is actually true
è¿™ä¸ªâ€œé 0 éç©ºâ€çš„è§„åˆ™æœ‰ä¸€ä¸ªä»¤äººæƒŠè®¶çš„ç»“æœï¼šå­—ä¸² @code{"0"} ä¸ºçœŸï¼Œå› ä¸ºå®ƒéç©ºã€‚
@value{DARKCORNER}

@node Typing and Comparison
@subsection å˜é‡ç±»å‹ä¸æ¯”è¾ƒè¡¨è¾¾å¼
@quotation
@i{æŒ‡å—éƒ½æ˜¯ç¡®å®šçš„ï¼Œä½†æ˜¯ç°å®å¸¸å¸¸ä¸ç²¾ç¡®ã€‚}
@author Douglas Adams, @cite{The Hitchhiker's Guide to the Galaxy}
@end quotation
@c 2/2015: Antonio Colombo points out that this is really from
@c The Restaurant at the End of the Universe. But I'm going to
@c leave it alone.

@cindex comparison expressions
@cindex expressions, comparison
@cindex expressions, matching, See comparison expressions
@cindex matching, expressions, See comparison expressions
@cindex relational operators, See comparison operators
@cindex operators, relational, See operators@comma{} comparison
@cindex variable typing
@cindex variables, types of, comparison expressions and
ä¸å…¶ä»–çš„è¯­è¨€ä¸åŒï¼Œ@command{awk} ä¸­çš„å˜é‡æ²¡æœ‰å›ºå®šçš„ç±»å‹ã€‚
ç›¸åï¼Œå®ƒä»¬å³å¯ä»¥æ˜¯æ•°å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ä¸²ï¼Œè¿™ä¸»è¦ä¾èµ–äºæ‰€èµ‹ç»™å®ƒçš„å€¼æ¥ç¡®å®šã€‚æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹å˜é‡æ˜¯å¦‚ä½•æ¥ç¡®å®šç±»å‹çš„ï¼Œ
ä»¥åŠ @command{awk} å¦‚ä½•æ¥æ¯”è¾ƒè¿™äº›å˜é‡ã€‚

@menu
* Variable Typing::             String type versus numeric type.
* Comparison Operators::        The comparison operators.
* POSIX String Comparison::     String comparison with POSIX rules.
@end menu

@node Variable Typing
@subsubsection å­—ä¸²ç±»å‹ä¸æ•°å€¼ç±»å‹

@cindex numeric, strings
@cindex strings, numeric
@cindex POSIX @command{awk}, numeric strings and
POSIX æ ‡å‡†ä¸­å¼•å…¥äº†@dfn{æ•°å€¼å¼å­—ä¸²}çš„æ¦‚å¿µï¼Œ
ç®€å•åœ°è¯´å°±æ˜¯çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªæ•°å€¼çš„å­—ä¸²â€”â€”å¦‚ @code{@w{" +2"}}ã€‚
è¿™ä¸ªæ¦‚å¿µä¹Ÿç”¨æ¥ç¡®å®šå˜é‡çš„ç±»å‹ã€‚å˜é‡çš„ç±»å‹æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºä¸¤å˜é‡çš„ç±»å‹å†³å®šäº†å®ƒä»¬ä¹‹é—´å¦‚ä½•è¿›è¡Œæ¯”è¾ƒã€‚å˜é‡ç±»å‹çš„ç¡®å®šä¾èµ–ä¸‹é¢çš„è§„åˆ™ï¼š


@itemize @value{BULLET}
@item
æ•°å€¼å¸¸é‡æˆ–è€…æ˜¯æ•°å€¼æ“ä½œç»“æœå…·æœ‰@dfn{æ•°å€¼}å±æ€§ã€‚

@item
å­—ä¸²å¸¸é‡æˆ–è€…å­—ä¸²æ“ä½œç»“æœå…·æœ‰@dfn{å­—ä¸²}å±æ€§ã€‚

@item
åŸŸï¼Œ@code{getline} è¾“å‡ºï¼Œ@code{FILENAME}ï¼Œ@code{ARGV} å…ƒç´ ï¼Œ
@code{ENVIRON} å…ƒç´ ä»¥åŠç”± @code{match()}ï¼Œ@code{split()} ä¸ @code{patsplit()} ç”Ÿæˆçš„æ•°ç»„çš„å…ƒç´ ï¼Œ
å¦‚æœæ˜¯æ•°å€¼å­—ä¸²ï¼Œåˆ™å…·æœ‰ @dfn{strnum} å±æ€§ã€‚å¦åˆ™å°±å…·æœ‰@dfn{å­—ä¸²}å±æ€§ã€‚
æœªåˆå§‹åŒ–çš„å˜é‡ä¹Ÿå…·æœ‰ @dfn{strnum} å±æ€§ã€‚

@item
å±æ€§é€šè¿‡èµ‹å€¼æ“ä½œç¬¦è¿›è¡Œä¼ é€’ï¼Œä½†æ˜¯ä½¿ç”¨åˆ™ä¸ä¼šæ”¹å˜ã€‚
@c (Although a use may cause the entity to acquire an additional
@c value such that it has both a numeric and string value, this leaves the
@c attribute unchanged.)
@c This is important but not relevant
@end itemize

æœ€åçš„è§„åˆ™å°¤å…¶é‡è¦ã€‚åœ¨ä¸‹é¢çš„ç¨‹åºä¸­ï¼Œ@code{a} å…·æœ‰æ•°å€¼ç±»å‹ï¼Œå°±ç®—ä¹‹åå®ƒè¢«ç”¨äºå­—ä¸²æ“ä½œä¸­ï¼š

@example
BEGIN @{
     a = 12.345
     b = a " is a cute number"
     print b
@}
@end example

å½“ä¸¤ä¸ªæ“ä½œæ•°è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œè¦ä¹ˆæ˜¯è¿›è¡Œå­—ä¸²æ¯”è¾ƒï¼Œè¦ä¹ˆæ˜¯è¿›è¡Œæ•°å€¼æ¯”è¾ƒã€‚è¿™ä¾èµ–äºæ“ä½œæ•°çš„å±æ€§ï¼Œå¦‚ä¸‹é¢çš„å¯¹ç§°é˜µåˆ—ï¼š

@c thanks to Karl Berry, kb@cs.umb.edu, for major help with TeX tables
@tex
\centerline{
\vbox{\bigskip % space above the table (about 1 linespace)
% Because we have vertical rules, we can't let TeX insert interline space
% in its usual way.
\offinterlineskip
%
% Define the table template. & separates columns, and \cr ends the
% template (and each row). # is replaced by the text of that entry on
% each row. The template for the first column breaks down like this:
%   \strut -- a way to make each line have the height and depth
%             of a normal line of type, since we turned off interline spacing.
%   \hfil -- infinite glue; has the effect of right-justifying in this case.
%   #     -- replaced by the text (for instance, `STRNUM', in the last row).
%   \quad -- about the width of an `M'. Just separates the columns.
%
% The second column (\vrule#) is what generates the vertical rule that
% spans table rows.
%
% The doubled && before the next entry means `repeat the following
% template as many times as necessary on each line' -- in our case, twice.
%
% The template itself, \quad#\hfil, left-justifies with a little space before.
%
\halign{\strut\hfil#\quad&\vrule#&&\quad#\hfil\cr
	&&STRING	&NUMERIC	&STRNUM\cr
% The \omit tells TeX to skip inserting the template for this column on
% this particular row. In this case, we only want a little extra space
% to separate the heading row from the rule below it.  the depth 2pt --
% `\vrule depth 2pt' is that little space.
\omit	&depth 2pt\cr
% This is the horizontal rule below the heading. Since it has nothing to
% do with the columns of the table, we use \noalign to get it in there.
\noalign{\hrule}
% Like above, this time a little more space.
\omit	&depth 4pt\cr
% The remaining rows have nothing special about them.
STRING	&&string	&string		&string\cr
NUMERIC	&&string	&numeric	&numeric\cr
STRNUM  &&string	&numeric	&numeric\cr
}}}
@end tex
@ifnottex
@ifnotdocbook
@display
        +----------------------------------------------
        |       STRING          NUMERIC         STRNUM
--------+----------------------------------------------
        |
STRING  |       string          string          string
        |
NUMERIC |       string          numeric         numeric
        |
STRNUM  |       string          numeric         numeric
--------+----------------------------------------------
@end display
@end ifnotdocbook
@end ifnottex
@docbook
<informaltable>
<tgroup cols="4">
<colspec colname="1" align="left"/>
<colspec colname="2" align="left"/>
<colspec colname="3" align="left"/>
<colspec colname="4" align="left"/>
<thead>
<row>
<entry/>
<entry>STRING</entry>
<entry>NUMERIC</entry>
<entry>STRNUM</entry>
</row>
</thead>

<tbody>
<row>
<entry><emphasis role="bold">STRING</emphasis></entry>
<entry>string</entry>
<entry>string</entry>
<entry>string</entry>
</row>

<row>
<entry><emphasis role="bold">NUMERIC</emphasis></entry>
<entry>string</entry>
<entry>numeric</entry>
<entry>numeric</entry>
</row>

<row>
<entry><emphasis role="bold">STRNUM</emphasis></entry>
<entry>string</entry>
<entry>numeric</entry>
<entry>numeric</entry>
</row>

</tbody>
</tgroup>
</informaltable>

@end docbook

åŸºæœ¬çš„æ€æƒ³å°±æ˜¯ï¼Œç”¨æˆ·çš„è¾“å…¥çœ‹èµ·æ¥åƒæ•°å€¼â€”â€”ä¹Ÿ@emph{ä»…ä»…}åœ¨ç”¨æˆ·è¾“å…¥ä¸­â€”â€”å°±ä¼šè¢«å½“æˆæ•°å€¼å¯¹å¾…ï¼Œ
å°±ç®—å®ƒå®é™…ä¸Šæ˜¯ç”±å­—ç¬¦ç»„æˆçš„å­—ä¸²ã€‚æ‰€ä»¥ï¼Œå¦‚è¿™æ ·çš„å­—ä¸²å¸¸é‡ @w{@code{" +3.14"}}ï¼Œ
å½“å®ƒå‡ºç°åœ¨ç¨‹åºåŸä»£ç ä¸­ï¼Œæ˜¯ä¸€ä¸ªå­—ä¸²â€”â€”å°±ç®—å®ƒæ˜¯ä¸€ä¸ªæ•°å€¼â€”â€”ä¹Ÿ@emph{æ°¸è¿œ}ä¸ä¼šåœ¨æ¯”è¾ƒç›®çš„ä¸­è¢«å½“æˆæ•°å€¼ã€‚

ç®€å•åœ°è¯´ï¼Œå½“æ“ä½œæ•°æ˜¯ä¸€ä¸ªâ€œçº¯ç²¹â€çš„å­—ä¸²ï¼Œå¦‚å­—ä¸²å¸¸é‡ï¼Œåˆ™å°±ä¼šæ‰§è¡Œå­—ä¸²æ¯”è¾ƒã€‚å¦åˆ™å°±ä¼šæ‰§è¡Œæ•°å€¼æ¯”è¾ƒã€‚

å¯¹æ­¤è¿˜è¦å¼ºè°ƒä¸€ä¸‹ï¼šæ‰€æœ‰çš„ç”¨æˆ·è¾“å…¥éƒ½ç”±å­—ç¬¦ç»„æˆï¼Œå› æ­¤é¦–å…ˆå®ƒæ˜¯å­—ä¸²ç±»å‹ï¼Œè¾“å‡ºçš„å­—ä¸²çœ‹èµ·æ¥åƒæ˜¯æ•°å€¼çš„å°±ä¼šèµ‹ç»™ strnum å±æ€§ã€‚
æ‰€ä»¥ï¼Œä¸‹é¢è¿™ä¸ª6å­—ç¬¦çš„è¾“å‡ºä¸² @w{@samp{ +3.14}} ä¼šå…·æœ‰ strnum å±æ€§ã€‚
ç›¸ååœ°ï¼Œä¸‹é¢çš„ 8 å­—ç¬¦ä¸² @w{@code{" +3.14"}} å‡ºç°åœ¨ç¨‹åºæ–‡æœ¬ä¸­åˆ™ç»„æˆäº†ä¸€ä¸ªå­—ä¸²å¸¸é‡ã€‚
ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå½“æ¯”è¾ƒä¸¤ä¸ªä¸åŒçš„å¸¸é‡æ—¶ä¸ºçœŸï¼Œå› æ­¤æ‰“å° @samp{1}ï¼Œå¦åˆ™æ‰“å° @samp{0} ï¼š

@c 22.9.2014: Tested with mawk and BWK awk, got same results.
@example
$ @kbd{echo ' +3.14' | awk '@{ print($0 == " +3.14") @}'}    @ii{True}
@print{} 1
$ @kbd{echo ' +3.14' | awk '@{ print($0 == "+3.14") @}'}     @ii{False}
@print{} 0
$ @kbd{echo ' +3.14' | awk '@{ print($0 == "3.14") @}'}      @ii{False}
@print{} 0
$ @kbd{echo ' +3.14' | awk '@{ print($0 == 3.14) @}'}        @ii{True}
@print{} 1
$ @kbd{echo ' +3.14' | awk '@{ print($1 == " +3.14") @}'}    @ii{False}
@print{} 0
$ @kbd{echo ' +3.14' | awk '@{ print($1 == "+3.14") @}'}     @ii{True}
@print{} 1
$ @kbd{echo ' +3.14' | awk '@{ print($1 == "3.14") @}'}      @ii{False}
@print{} 0
$ @kbd{echo ' +3.14' | awk '@{ print($1 == 3.14) @}'}        @ii{True}
@print{} 1
@end example

@node Comparison Operators
@subsubsection æ¯”è¾ƒæ“ä½œç¬¦

@dfn{æ¯”è¾ƒè¡¨è¾¾å¼}åœ¨æ•°å€¼æˆ–è€…å­—ä¸²ä¸­è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ç›¸ç­‰æ€§ã€‚å®ƒä»¬é€šå¸¸ä½¿ç”¨@dfn{å…³ç³»æ“ä½œç¬¦}æ¥è¡¨ç°ï¼Œ
è¿™äº›æ“ä½œæ˜¯ C ä¸­å¯¹åº”çš„æ“ä½œçš„è¶…é›†ã€‚è¡¨ @ref{table-relational-ops} ä¸­æœ‰è¯´æ˜ã€‚

@cindex @code{<} (left angle bracket), @code{<} operator
@cindex left angle bracket (@code{<}), @code{<} operator
@cindex @code{<} (left angle bracket), @code{<=} operator
@cindex left angle bracket (@code{<}), @code{<=} operator
@cindex @code{>} (right angle bracket), @code{>=} operator
@cindex right angle bracket (@code{>}), @code{>=} operator
@cindex @code{>} (right angle bracket), @code{>} operator
@cindex right angle bracket (@code{>}), @code{>} operator
@cindex @code{=} (equals sign), @code{==} operator
@cindex equals sign (@code{=}), @code{==} operator
@cindex @code{!} (exclamation point), @code{!=} operator
@cindex exclamation point (@code{!}), @code{!=} operator
@cindex @code{~} (tilde), @code{~} operator
@cindex tilde (@code{~}), @code{~} operator
@cindex @code{!} (exclamation point), @code{!~} operator
@cindex exclamation point (@code{!}), @code{!~} operator
@cindex @code{in} operator
@float Table,table-relational-ops
@caption{å…³ç³»æ“ä½œç¬¦}
@multitable @columnfractions .25 .75
@headitem Expression @tab Result
@item @var{x} @code{<} @var{y} @tab å¦‚æœ @var{x} å°äº @var{y} åˆ™ä¸ºçœŸ
@item @var{x} @code{<=} @var{y} @tab å¦‚æœ @var{x} å°äºæˆ–è€…ç­‰äº @var{y} åˆ™ä¸ºçœŸ
@item @var{x} @code{>} @var{y} @tab å¦‚æœ @var{x} å¤§äº @var{y} åˆ™ä¸ºçœŸ
@item @var{x} @code{>=} @var{y} @tab å¦‚æœ @var{x} å¤§äºæˆ–è€…ç­‰äº @var{y} åˆ™ä¸ºçœŸ
@item @var{x} @code{==} @var{y} @tab å¦‚æœ @var{x} ç­‰äº @var{y} åˆ™ä¸ºçœŸ
@item @var{x} @code{!=} @var{y} @tab å¦‚æœ @var{x} ä¸ç­‰äº @var{y} åˆ™ä¸ºçœŸ
@item @var{x} @code{~} @var{y} @tab å¦‚æœå­—ä¸² @var{x} ä¸ @var{y} æ‰€ä»£è¡¨çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ™ä¸ºçœŸ
@item @var{x} @code{!~} @var{y} @tab å¦‚æœå­—ä¸² @var{x} ä¸ @var{y} è¡¨ç¤ºçš„æ­£åˆ™è¡¨è¾¾å¼ä¸åŒ¹é…åˆ™ä¸ºçœŸ
@item @var{subscript} @code{in} @var{array} @tab å¦‚æœæ•°ç»„ @var{array} å­˜åœ¨ä¸‹æ ‡ @var{subscript} æ‰€æŒ‡æ˜çš„å…ƒç´ åˆ™ä¸ºçœŸ
@end multitable
@end float

æ¯”è¾ƒè¡¨è¾¾å¼çš„ç»“æœä¸º trueï¼Œåˆ™å€¼ä¸º 1ï¼Œåä¹‹åˆ™ä¸º 0ã€‚
å½“ä¸åŒçš„ç±»å‹ä¹‹é—´è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œæ•°å€¼ç±»å‹çš„æ“ä½œç¬¦ä¼šæŒ‰ç…§ @code{CONVFMT} ï¼ˆæŸ¥çœ‹ @ref{Conversion}ï¼‰çš„æ ¼å¼è½¬æ¢ä¸ºå­—ä¸²ã€‚

å­—ä¸²çš„æ¯”è¾ƒæ¯ä¸ªä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œç„¶åç¬¬äºŒä¸ªå­—ç¬¦ï¼Œä¾æ¬¡è¿›è¡Œæ¯”è¾ƒã€‚å› æ­¤ï¼Œ@code{"10"} å°äº @code{"9"}ã€‚
å¦‚æœä¸¤ä¸ªä¸²ä¸­ï¼Œä¸€ä¸ªä¸²æ˜¯å¦ä¸€ä¸ªä¸²çš„å‰ç¼€ï¼ŒçŸ­çš„ä¸²å°äºé•¿çš„ä¸²ã€‚æ‰€ä»¥ï¼Œ@code{"abc"} å°äº @code{"abcd"}ã€‚

@cindex troubleshooting, @code{==} operator
å¾ˆå®¹æ˜“ä¸å°å°† @samp{==} æ“ä½œç¬¦å°‘æ‰“ä¸€ä¸ª @samp{=} ç¬¦å·ã€‚
ç»“æœè¿˜æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ @command{awk} ä»£ç ï¼Œä½†æ˜¯ç¨‹åºæ‰§è¡Œçš„å¯å°±ä¸æ˜¯ä½ çš„æ„å›¾äº†ï¼š

@example
if (a = b)   # oops! should be a == b
   @dots{}
else
   @dots{}
@end example

@noindent
é™¤é @code{b} ç¢°å·§ä¸º 0 æˆ–è€…æ˜¯ç©ºä¸²ï¼Œå¦åˆ™ @code{if} çš„æµ‹è¯•éƒ¨åˆ†æ€»ä¼šæ˜¯æˆåŠŸçš„ï¼ˆä¸º trueï¼‰ã€‚
å› æ­¤æ“ä½œç¬¦çœ‹èµ·æ¥è¿™ä¹ˆåƒï¼Œæ­¤ç±»çš„é”™è¯¯ä¼šéå¸¸éš¾å‘ç°ã€‚

ä¸‹é¢çš„è¡¨è¾¾å¼åˆ—è¡¨è¯´æ˜äº† @command{awk} æ‰§è¡Œçš„æ¯”è¾ƒç±»å‹ï¼Œä»¥åŠæ¯”è¾ƒçš„ç»“æœï¼š

@table @code
@item 1.5 <= 2.0
æ•°å€¼æ¯”è¾ƒï¼ˆtrueï¼‰

@item "abc" >= "xyz"
å­—ä¸²æ¯”è¾ƒï¼ˆfalseï¼‰

@item 1.5 != " +2"
å­—ä¸²æ¯”è¾ƒï¼ˆtrueï¼‰


@item "1e2" < "3"
å­—ä¸²æ¯”è¾ƒï¼ˆtrueï¼‰

@item a = 2; b = "2"
@itemx a == b
å­—ä¸²æ¯”è¾ƒï¼ˆtrueï¼‰

@item a = 2; b = " +2"
@itemx a == b
å­—ä¸²æ¯”è¾ƒï¼ˆfalseï¼‰
@end table

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼š

@example
$ @kbd{echo 1e2 3 | awk '@{ print ($1 < $2) ? "true" : "false" @}'}
@print{} false
@end example

@cindex comparison expressions, string vs.@: regexp
@c @cindex string comparison vs.@: regexp comparison
@c @cindex regexp comparison vs.@: string comparison
@noindent
ç»“æœä¸º @samp{false} ï¼Œå› ä¸º @code{$1} ä¸ @code{$2} éƒ½æ˜¯ç”¨æˆ·è¾“å…¥ã€‚å®ƒä»¬éƒ½æ˜¯æ•°å€¼å­—ä¸²â€”â€”å› æ­¤ä¸¤ä¸ªéƒ½æœ‰ strnum å±æ€§ï¼Œ
æ‰€ä»¥æ‰§è¡Œçš„æ˜¯æ•°å€¼æ¯”è¾ƒã€‚æ¯”è¾ƒè§„åˆ™çš„ç›®çš„ä»¥åŠæ•°å€¼å­—ä¸²çš„ä½¿ç”¨æ˜¯è¯•å›¾äº§ç”Ÿâ€œæœ€å°‘æƒŠè®¶â€çš„è¡Œä¸ºï¼ŒåŒæ—¶è¿˜ä¼šâ€œåšæ­£ç¡®çš„äº‹â€ã€‚

å­—ä¸²æ¯”è¾ƒä¸æ­£åˆ™è¡¨è¾¾å¼æ¯”è¾ƒæ˜¯éå¸¸ä¸åŒçš„ï¼Œå¦‚ï¼š

@example
x == "foo"
@end example

@noindent
å…·æœ‰å€¼ 1ï¼Œæˆ–è€… trueï¼Œå¦‚æœå˜é‡ @code{x} ç¡®å®ä¸º @samp{foo} ã€‚ç›¸åï¼š

@example
x ~ /foo/
@end example

@noindent
åˆ™å½“ @code{x} åŒ…å« @samp{foo} æ—¶ä¸º 1ï¼Œå¦‚ @code{"Oh, what a fool am I!"}ï¼ˆå¤©å•Šï¼Œæˆ‘çœŸæ˜¯è ¢å¾—è¦æ­»ï¼ï¼‰

@cindex @code{~} (tilde), @code{~} operator
@cindex tilde (@code{~}), @code{~} operator
@cindex @code{!} (exclamation point), @code{!~} operator
@cindex exclamation point (@code{!}), @code{!~} operator
@samp{~} ä¸ @samp{!~} å³è¾¹çš„æ“ä½œæ•°å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼ˆ@code{/}@dots{}@code{/}ï¼‰ï¼Œ
ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šçš„è¡¨è¾¾å¼ã€‚åœ¨åé¢çš„æƒ…å†µä¸‹ï¼Œè¡¨è¾¾å¼çš„å€¼ä¼šå½“æˆå­—ä¸²ï¼Œå¹¶ä½œä¸ºåŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @ref{Regexp Usage}ï¼Œ
ä¸ @ref{Computed Regexps}ï¼‰ã€‚

@cindex @command{awk}, regexp constants and
@cindex regexp constants
å¸¦æ–œæ çš„æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡å…¶æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚@code{/@var{regexp}/} æ˜¯ä¸‹é¢æ¯”è¾ƒæ“ä½œè¡¨è¾¾å¼çš„ç¼©å†™å½¢å¼ï¼š

@example
$0 ~ /@var{regexp}/
@end example

@code{/foo/} @emph{ä¸æ˜¯} @samp{$0 ~ /foo/} çš„ç¼©å†™çš„ä¸€ä¸ªç‰¹æ®Šåœ°æ–¹å°±æ˜¯å®ƒåœ¨æ“ä½œç¬¦ @samp{~} æˆ–è€… @samp{!~} çš„å³è¾¹ã€‚
æŸ¥çœ‹ @ref{Using Constant Regexps}ï¼Œåœ¨æ­¤å¤„ä¼šæœ‰æ›´è¯¦ç»†çš„è®¨è®ºã€‚

@node POSIX String Comparison
@subsubsection POSIX ä¸­çš„å­—ä¸²æ¯”è¾ƒè§„åˆ™

POSIX æ ‡å‡†è§„å®šï¼Œå­—ä¸²çš„æ¯”è¾ƒæ˜¯æŒ‰ç…§æœ¬åœ°è¯­è¨€è®¾ç½®çš„@dfn{åˆ†ç±»é¡ºåº}è¿›è¡Œçš„ã€‚è¿™ä¸ªé¡ºåºå­—ç¬¦æ˜¯æŒ‰ç…§æœ¬è¯­è¨€è®¾ç½®ç»è¿‡æ’åºçš„
ï¼ˆæ›´å¤šçš„è®¨è®ºå¯æŸ¥çœ‹ @ref{Locales}ï¼‰ã€‚
è¿™ä¸ªé¡ºåºå®Œå…¨ä¸åŒäºè¿›è¡Œç›´æ¥çš„å­—ç¬¦å¯¹å­—ç¬¦çš„æ¯”è¾ƒæ‰€å¾—åˆ°çš„ç»“æœã€‚ 
@footnote{ä»æŠ€æœ¯ä¸Šè¯´ï¼Œå­—ä¸²æ¯”è¾ƒåº”è¯¥çš„è¡Œä¸ºåº”è¯¥ä¸€è‡´ï¼Œå°±å¥½åƒå­—ä¸²çš„çš„æ¯”è¾ƒä½¿ç”¨çš„æ˜¯ C @code{strcoll()} å‡½æ•°ä¸€æ ·ã€‚}

ç”±äºè¿™æ ·çš„è¡Œä¸ºä¸æ—¢æœ‰çš„å®è·µæœ‰å·¨å¤§çš„å·®å¼‚ï¼Œ@command{gawk} åªåœ¨ POSIX æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰å®ç°äº†ã€‚
ä¸‹é¢çš„ä¾‹å­è§£é‡Šäº†åœ¨ @code{en_US.UTF-8} è¯­è¨€è®¾ç½®ä¸‹çš„å·®å¼‚ï¼š

@example
$ @kbd{gawk 'BEGIN @{ printf("ABC < abc = %s\n",}
>                     @kbd{("ABC" < "abc" ? "TRUE" : "FALSE")) @}'}
@print{} ABC < abc = TRUE
$ @kbd{gawk --posix 'BEGIN @{ printf("ABC < abc = %s\n",}
>                             @kbd{("ABC" < "abc" ? "TRUE" : "FALSE")) @}'}
@print{} ABC < abc = FALSE
@end example


@node Boolean Ops
@subsection å¸ƒæ—è¡¨è¾¾å¼
@cindex and Boolean-logic operator
@cindex or Boolean-logic operator
@cindex not Boolean-logic operator
@cindex expressions, Boolean
@cindex Boolean expressions
@cindex operators, Boolean, See Boolean expressions
@cindex Boolean operators, See Boolean expressions
@cindex logical operators, See Boolean expressions
@cindex operators, logical, See Boolean expressions

@dfn{å¸ƒæ—è¡¨è¾¾å¼}æ˜¯ç”±æ¯”è¾ƒè¡¨è¾¾å¼æˆ–è€…æ˜¯åŒ¹é…è¡¨è¾¾å¼ç»„æˆï¼Œ
åˆ©ç”¨æ“ä½œâ€œorâ€ï¼ˆ@samp{||}ï¼‰ï¼Œâ€œandâ€ï¼ˆ@samp{&&}ï¼‰ï¼Œè¿˜æœ‰â€œnotâ€ï¼ˆ@samp{!}ï¼‰ç»„åˆè€Œæˆï¼Œå¹¶åˆ©ç”¨æ‹¬å·æ¥æ§åˆ¶è¡¨è¾¾å¼çš„åµŒå…¥ã€‚
å¸ƒæ—è¡¨è¾¾å¼çš„çœŸå€¼é€šè¿‡è®¡ç®—ç»„æˆè¯¥è¡¨è¾¾å¼çš„ç›´å€¼ç»„åˆè€Œå¾—ã€‚å¸ƒæ—è¡¨è¾¾å¼ä¹Ÿç§°ä¸º@dfn{é€»è¾‘è¡¨è¾¾å¼}ã€‚ä¸¤è€…æ˜¯ä¸€æ ·çš„ã€‚

å¸ƒæ—è¡¨è¾¾å¼å¯ä»¥ç”¨åœ¨æ‰€æœ‰çš„æ¯”è¾ƒä¸åŒ¹é…è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨çš„åœ°æ–¹ã€‚å¯ä»¥ç”¨åœ¨ @code{if}ï¼Œ@code{while}ï¼Œ@code{do} ä¸ @code{for} è¯­è¨€ä¸­
ï¼ˆæŸ¥çœ‹ @ref{Statements}ï¼‰ã€‚å½“å¸ƒæ—è¡¨è¾¾å¼çš„ç»“æœè¦å­˜åœ¨å˜é‡ä¸­æˆ–è€…åœ¨ç®—æ³•è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œåˆ™å…¶å€¼ä¸ºæ•°å€¼ç±»å‹ï¼ˆçœŸåˆ™ä¸º 1ï¼Œå¦åˆ™ä¸º 0ï¼‰ã€‚

å…¶æ¬¡ï¼Œæ¯ä¸€ä¸ªå¸ƒæ—è¡¨è¾¾å¼éƒ½æ˜¯æœ‰æ•ˆçš„æ¨¡å¼ï¼Œå› æ­¤ä½ å¯ä»¥å°†å…¶ç”¨åœ¨æ¨¡å¼ä¸­ï¼Œä»¥æ§åˆ¶è§„åˆ™çš„æ‰§è¡Œã€‚å¸ƒæ—æ“ä½œç¬¦æœ‰å¦‚ä¸‹è¿™äº›ï¼š

@table @code
@item @var{boolean1} && @var{boolean2}
å¦‚æœ @var{boolean1} ä¸ @var{boolean2} éƒ½ä¸º trueï¼Œåˆ™è¿”å› trueã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¯­å¥ï¼Œ
å¦‚æœè¾“å…¥è®°å½•ä¸­åŒ…å« @samp{edu} ä¸ @samp{li} åˆ™æ‰“å°å®ƒï¼š

@example
if ($0 ~ /edu/ && $0 ~ /li/) print
@end example

@cindex side effects, Boolean operators
å­è¡¨è¾¾å¼ @var{boolean2} åªæœ‰åœ¨ @var{boolean1} æ±‚å€¼ä¸º true æ—¶ï¼Œæ‰ä¼šè¿›è¡Œæ±‚å€¼ã€‚
å¦‚æœ @var{boolean2} è¡¨è¾¾å¼åŒ…å«æœ‰å‰¯ä½œç”¨çš„è¡¨è¾¾å¼ï¼Œåˆ™ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚
åœ¨ @samp{$0 ~ /foo/ && ($2 == bar++)} ä¾‹å­ä¸­ï¼Œå˜é‡ @code{bar} åœ¨è®°å½•ä¸­ä¸åŒ…å«å­ä¸² @samp{foo} æ—¶ï¼Œä¸ä¼šè¿›è¡Œé€’å¢ã€‚

@item @var{boolean1} || @var{boolean2}
@var{boolean1} æˆ–è€… @var{boolean2} ä¹‹ä¸€ä¸º true æ˜¯è¿”å› trueã€‚ä¾‹å¦‚ï¼Œ
ä¸‹é¢çš„è¯­å¥ä¸­ï¼Œå¦‚æœè¾“å…¥ä¸­åŒ…å« @samp{edu} @emph{æˆ–è€…} @samp{li}ï¼Œåˆ™æ‰“å°è¿™äº›è®°å½•ï¼š

@example
if ($0 ~ /edu/ || $0 ~ /li/) print
@end example

å­è¡¨è¾¾å¼ @var{boolean2} åªæœ‰åœ¨ @var{boolean1} çš„å€¼ä¸º false æ‰ä¼šè¿›è¡Œæ±‚å€¼ã€‚
å› æ­¤å¦‚æœ @var{boolean2} è¡¨è¾¾å¼æœ‰å‰¯ä½œç”¨ï¼Œåˆ™ä¼šå¸¦æ¥ä¸åŒçš„ç»“æœã€‚ï¼ˆæ‰€ä»¥ï¼Œè¿™é‡Œçš„æµ‹è¯•å¹¶ä¸æ˜¯çœŸæ­£åœ°æµ‹è¯•è®°å½•ä¸­æ˜¯å¦åŒ…å« @samp{edu} ä¸ @samp{li} äºŒè€…â€”â€”åªè¦åŒ¹é… @samp{edu}ï¼Œæ•´ä¸ªæµ‹è¯•å°±æˆåŠŸã€‚ï¼‰

@item ! @var{boolean}
å¦‚æœ @var{boolean} ä¸º falseï¼Œåˆ™ä¸º trueã€‚ä¸‹é¢çš„ä»£ç ï¼Œå½“ @env{HOME} ç¯å¢ƒå˜é‡ä¸å­˜åœ¨è¿™ç§ä¸æ­£å¸¸äº‹ä»¶æ—¶ï¼Œåˆ™æ‰“å° @samp{no home!}ï¼š

@example
BEGIN @{ if (! ("HOME" in ENVIRON))
            print "no home!" @}
@end example

ï¼ˆ@code{in} æ“ä½œç¬¦åœ¨ @ref{Reference to Elements}ï¼Œè¿™é‡Œæè¿°ï¼‰
@end table

@cindex short-circuit operators
@cindex operators, short-circuit
@cindex @code{&} (ampersand), @code{&&} operator
@cindex ampersand (@code{&}), @code{&&} operator
@cindex @code{|} (vertical bar), @code{||} operator
@cindex vertical bar (@code{|}), @code{||} operator
@samp{&&} ä¸ @samp{||} æ“ä½œç¬¦å› ä¸ºå®ƒä»¬çš„æ‰§è¡Œæ–¹å¼è¢«ç§°ä¸ºçŸ­è·¯æ“ä½œç¬¦ã€‚å¯¹äºå®Œæ•´è¡¨è¾¾å¼çš„æ±‚å€¼ï¼Œå¦‚æœå…¶ç»“æœåªéœ€è¦ç”±å…¶éƒ¨åˆ†æ±‚å€¼å³å¯å¾—åˆ°ï¼Œåˆ™æˆ‘ä»¬ç§°è¿™ä¸ªè¡¨è¾¾å¼ @samp{è¢«çŸ­è·¯äº†} ã€‚

@cindex line continuations
å¦‚æœè¯­å¥ç”± @samp{&&} æˆ–è€… @samp{||} ç»“æŸï¼Œå¯ä»¥ç®€å•åœ°åœ¨å…¶åè¿›è¡Œæ¢è¡Œå°±å¯ä»¥è¿›è¡Œç»­è¡Œã€‚ä½†æ˜¯åœ¨å…¶å‰é¢ï¼Œå¦‚æœä½ ä¸åŠ ä¸Šä¸€ä¸ªåæ–œæ ï¼Œéƒ½ä¸èƒ½è¿›è¡Œæ¢è¡Œï¼ˆæŸ¥çœ‹ @ref{Statements/Lines}ï¼‰ã€‚

@cindex @code{!} (exclamation point), @code{!}  operator
@cindex exclamation point (@code{!}), @code{!} operator
@cindex newlines
@cindex variables, flag
@cindex flag variables
ä½¿ç”¨ @samp{!} æ“ä½œç¬¦çš„è¡¨è¾¾å¼çš„å€¼è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯ 0ï¼Œåˆ™è¦è§†å…¶åº”ç”¨æ‰€åœ¨çš„è¡¨è¾¾å¼çš„å€¼ã€‚
@samp{!} æ“ä½œç¬¦åœ¨å°†æ ‡å¿—å˜é‡çš„å€¼ä» false è½¬æ¢ä¸º trueï¼Œå†è½¬å›æ¥çš„æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºå°±æ˜¯ä¸€ç§æ‰“å°ç‰¹æ®Šæ‹¬å·ä¹‹é—´çš„è¡Œçš„æ–¹å¼ï¼š

@example
$1 == "START"   @{ interested = ! interested; next @}
interested      @{ print @}
$1 == "END"     @{ interested = ! interested; next @}
@end example

@noindent
å˜é‡ @code{interested} ä¸å…±ä»–æ‰€æœ‰çš„ @command{awk} å˜é‡ä¸€æ ·ï¼Œä¸€å¼€å§‹è¢«åˆå§‹åŒ–ä¸º 0ï¼Œå…¶è¡¨ç¤º falseã€‚
å½“è¡Œå‘ç°äº†ç¬¬ä¸€ä¸ªåŸŸä¸º @samp{START} çš„è¡Œåï¼Œ@code{interested} å˜é‡çš„å€¼åˆ™åˆ©ç”¨ç”¨ @samp{!} å˜ä¸º trueã€‚
ä¸‹ä¸€ä¸ªè§„åˆ™ä¸­ï¼Œå¦‚æœ @code{interested} ä¸º trueï¼Œåˆ™æ‰“å°è¿™äº›è¡Œã€‚
å½“å‘ç°ç¬¬ä¸€ä¸ªåŸŸä¸º @samp{END} çš„è¡Œåï¼Œåˆ™ @code{interested} å˜é‡åˆä¼šè½¬å› falseã€‚ 
@footnote{è¿™ä¸ªç¨‹åºæœ‰ä¸€ä¸ª BUGï¼Œå®ƒä¼šæ‰“å°ä»¥ @samp{END} å¼€å¤´çš„è¡Œã€‚çœ‹çœ‹ä½ æ€ä¹ˆæ¥ä¿®å¤å®ƒï¼Ÿ}

@ignore
Scott Deifik points out that this program isn't robust against
bogus input data, but the point is to illustrate the use of `!',
so we'll leave well enough alone.
@end ignore

æ›´é€šå¸¸çš„æ˜¯ï¼Œ@samp{!} æ“ä½œç¬¦æ˜¯ç”¨åœ¨ @code{if} ä¸ @code{while} è¯­å¥ä¸­ï¼Œåœ¨è¿™äº›è¯­å¥ä¸­ï¼Œå†™å¦å®šé€»è¾‘å«ä¹‰æ›´åŠ æ˜ç¡®ï¼š

@example
if (! @var{some condition} || @var{some other condition}) @{
    @var{@dots{} do whatever processing @dots{}}
@}
@end example

@cindex @code{next} statement
@quotation æç¤º
@code{next} è¯­å¥å°†åœ¨ @ref{Next Statement}ï¼Œè®¨è®ºã€‚
@code{next} å‘Šè¯‰ @command{awk} è·³è¿‡å‰©ä¸‹çš„è§„åˆ™ï¼Œå¹¶è¯»å–ä¸‹ä¸€ä¸ªè®°å½•ï¼Œå¹¶ä»æœ€å¼€å§‹æ¥å¤„ç†å„ä¸ªè§„åˆ™ã€‚
å†™åœ¨è¿™é‡Œçš„åŸå› æ˜¯é¿å…æ‰“å°æ‹¬èµ·æ–‡æœ¬çš„ @samp{START} ä¸ @samp{END} è¡Œã€‚
@end quotation

@node Conditional Exp
@subsection æ¡ä»¶è¡¨è¾¾å¼
@cindex conditional expressions
@cindex expressions, conditional
@cindex expressions, selecting

@dfn{æ¡ä»¶è¡¨è¾¾å¼}æ˜¯ä¸€ç§æ‹¥æœ‰ä¸‰ä¸ªæ“ä½œæ•°çš„ç‰¹æ®Šçš„è¡¨è¾¾å¼ã€‚è¯¥è¡¨è¾¾å¼å¯ä»¥è®©ä½ ä½¿ç”¨ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œå³å¯ä»¥ä»å…¶ä»–ä¸¤ä¸ªè¡¨è¾¾å¼ä¸­é€‰æ‹©ä¸€ä¸ªã€‚
@command{awk} ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼ä¸ C è¯­è¨€ä¸­çš„è¡¨è¾¾å¼ä¸€æ ·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

@example
@var{selector} ? @var{if-true-exp} : @var{if-false-exp}
@end example

@noindent
è¿™é‡Œæœ‰ä¸‰ä¸ªå­è¡¨è¾¾å¼ã€‚ç¬¬ä¸€ä¸ªå­è¡¨è¾¾å¼æ˜¯ @var{selector}ï¼Œå®ƒæ€»æ˜¯é¦–å…ˆè¢«è®¡ç®—ã€‚å¦‚æœç»“æœä¸º @samp{true}ï¼ˆéé›¶æˆ–è€…éç©ºï¼‰ï¼Œ
åˆ™ @var{if-true-exp} åˆ™æ¥ç€è¢«è®¡ç®—ï¼Œå…¶å€¼å°†æˆä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚å¦åˆ™ï¼Œ@var{if-true-exp} è¢«è®¡ç®—ï¼Œå…¶å€¼æˆä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚
ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¡¨è¾¾å¼äº§ç”Ÿ @code{x} çš„ç»å¯¹å€¼ï¼š

@example
x >= 0 ? x : -x
@end example

@cindex side effects, conditional expressions
æ¡ä»¶è¡¨è¾¾å¼çš„æ¯ä¸€æ¬¡è®¡ç®—ï¼Œ@var{if-true-exp} ä¸ @var{if-false-exp} åªä¼šæœ‰ä¸€ä¸ªè¢«ä½¿ç”¨ï¼Œ
å¦å¤–ä¸€ä¸ªå°±è¢«å¿½ç•¥äº†ã€‚å¦‚æœè¡¨è¾¾å¼ä¸­æœ‰å‰¯ä½œç”¨ï¼Œè¿™å°±å˜å¾—ç›¸å½“é‡è¦ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„æ¡ä»¶è¡¨è¾¾å¼æå–æ•°ç»„ @code{a} æˆ–è€… @code{b} çš„å…ƒç´  @code{i}ï¼Œ
å¹¶é€’å¢ @code{i}ï¼š

@example
x == y ? a[i++] : b[i++]
@end example

@noindent
è¿™ä¿è¯äº† @code{i} åªä¼šè¢«é€’å¢ä¸€æ¬¡ï¼Œå½“è¡¨è¾¾å¼è¢«è®¡ç®—æ—¶ï¼Œä¸¤ä¸ªé€’å¢è¡¨è¾¾å¼åªä¼šæ‰§è¡Œä¸€ä¸ªã€‚
æŸ¥çœ‹ @ref{Arrays}ï¼Œæ¥è·å–æ›´å¤šçš„å…³äºæ•°ç»„çš„ä¿¡æ¯ã€‚

@cindex differences in @command{awk} and @command{gawk}, line continuations
@cindex line continuations, @command{gawk}
@cindex @command{gawk}, line continuation in
ä½œä¸ºä¸€ä¸ªå°çš„ @command{gawk} æ‰©å±•ï¼Œä½¿ç”¨ @samp{?:} çš„è¯­å¥å¯ä»¥åœ¨ä¸¤ä¸ªç¬¦å·ä¸­çš„ä»»æ„å­—ç¬¦å¤„è¿›è¡Œæ¢è¡Œã€‚
ä½†æ˜¯ï¼Œåœ¨è¿™ä¸¤ä¸ªå­—ç¬¦å‰è¿›è¡Œæ¢è¡Œï¼Œå¦‚æœä¸åŠ åæ–œæ æ˜¯ä¸è¡Œçš„ï¼ˆæŸ¥çœ‹ @ref{Statements/Lines}ï¼‰ã€‚
å¦‚ä½•ä½¿ç”¨äº† @option{--posix} å‚æ•°ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œè¿™ä¸ªæ‰©å±•ä¹Ÿä¸è¢«ç¦ç”¨äº†ã€‚

@node Function Calls
@section å‡½æ•°è°ƒç”¨
@cindex function calls

@dfn{å‡½æ•°}æ˜¯ä¸€ä¸ªç‰¹æ®Šè®¡ç®—è¿‡ç¨‹çš„åå­—ã€‚è¿™æ ·ä½ å¯ä»¥é€šè¿‡åå­—åœ¨ç¨‹åºçš„ä»»ä½•ä½ç½®æ¥è¯·æ±‚æ‰§è¡Œã€‚
ä¾‹å¦‚ï¼Œå‡½æ•° @code{sqrt()} è®¡ç®—æ•°å€¼çš„å¹³æ–¹æ ¹ã€‚

@cindex functions, built-in
@command{awk} ä¸­æœ‰å›ºå®šçš„@dfn{å†…å»º}å‡½æ•°é›†åˆï¼Œå®ƒä»¬å¯ä»¥åœ¨ä»»æ„çš„ @command{awk} ç¨‹åºä¸­ä½¿ç”¨ã€‚
@code{sqrt()} å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚æŸ¥çœ‹ @ref{Built-in}ï¼Œå†…å»ºå‡½æ•°çš„åˆ—è¡¨ä»¥åŠå…¶è¯´æ˜ã€‚
å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰åªæœ‰ä½ çš„ç¨‹åºä½¿ç”¨çš„å‡½æ•°ã€‚æŸ¥çœ‹ @ref{User-defined}ï¼Œæ¥è·å–è‡ªå®šä¹‰å‡½æ•°çš„æ–¹æ³•ã€‚
@command{gawk} ä¹Ÿå¯ä»¥è®©ä½ ä½¿ç”¨ C æˆ–è€… C++ æ¥ç¼–å†™å‡½æ•°ï¼Œå¹¶åœ¨ä½ çš„ç¨‹åºä¸­è°ƒç”¨ï¼ˆæŸ¥çœ‹ @ref{Dynamic Extensions}ï¼‰ã€‚

@cindex arguments, in function calls
å‡½æ•°çš„ä½¿ç”¨å¸¦æœ‰ä¸€ä¸ª@dfn{å‡½æ•°è°ƒç”¨}è¡¨è¾¾å¼ï¼Œå…¶åŒ…æ‹¬å‡½æ•°åï¼Œåé¢ç›´æ¥è·Ÿç€åœ¨æ‹¬å·ä¸­çš„@dfn{å‚æ•°}åˆ—è¡¨ã€‚
å‚æ•°æ˜¯ä¸ºè°ƒç”¨å‡½æ•°è®¡ç®—è¿‡ç¨‹è€Œæä¾›çš„åŸå§‹èµ„æ–™çš„è¡¨è¾¾å¼ã€‚å½“å¤šäºä¸€ä¸ªå‚æ•°æ—¶ï¼Œå®ƒä»¬åˆ™é€šè¿‡é€—å·åˆ†éš”ã€‚
å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œåˆ™åªè¦åœ¨å‡½æ•°ååå†™ @samp{()} å³å¯ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç°äº†å¸¦å‚ä¸ä¸å¸¦å‚çš„å‡½æ•°è°ƒç”¨ã€‚

@example
sqrt(x^2 + y^2)        @ii{one argument}
atan2(y, x)            @ii{two arguments}
rand()                 @ii{no arguments}
@end example

@cindex troubleshooting, function call syntax
@quotation æ³¨æ„
ä¸è¦åœ¨å‡½æ•°åä¸å¼€æ‹¬å·ä¹‹é—´è¾“å‡ºä»»ä½•ç©ºæ ¼ï¼
ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°åçœ‹èµ·æ¥å°±åƒæ˜¯å˜é‡åâ€”â€”å› æ­¤ç©ºæ ¼ä¼šå¯¼è‡´è¡¨è¾¾å¼çœ‹èµ·æ¥æ˜¯å˜é‡ä¸æ‹¬å·ä¸­çš„è¡¨è¾¾å¼çš„è¿æ¥æ“ä½œã€‚
è€Œå¯¹äºå†…å»ºçš„å‡½æ•°ï¼Œåœ¨æ‹¬å·ä¹‹å‰çš„ç©ºæ ¼æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æœ€å¥½ä¸è¦å½¢æˆæ’å…¥ç©ºæ ¼çš„ä¹ æƒ¯ï¼Œä»¥é¿å…åœ¨è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°çš„æ—¶å€™çŠ¯é”™ã€‚
@end quotation

æ¯ä¸ªå‡½æ•°éƒ½æœ‰ç‰¹å®šçš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œ@code{sqrt()} å‡½æ•°å¿…é¡»ç”¨å•å‚æ•°è°ƒç”¨ï¼Œå³è¦è®¡ç®—å¹³æ–¹æ ¹çš„æ•°å€¼ï¼š

@example
sqrt(@var{argument})
@end example

ä¸€äº›å†…å»ºçš„å‡½æ•°æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªçš„å¯é€‰å‚æ•°ã€‚å¦‚æœæ²¡æœ‰æä¾›é‚£äº›å‚æ•°ï¼Œåˆ™å‡½æ•°ä¼šä½¿ç”¨åˆé€‚çš„é»˜è®¤å€¼ã€‚
æŸ¥çœ‹ @ref{Built-in}ï¼Œæ¥è·å–æ›´å¤šç»†èŠ‚ã€‚å¦‚æœåœ¨è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°æ—¶çœç•¥äº†å‚æ•°ï¼Œåˆ™è¿™äº›å‚æ•°å°†ä¼šå½“æˆæœ¬å˜é‡ï¼ˆåœ¨å®šä¹‰å‡½æ•°æ—¶çš„æ‹¬å·ä¸­çš„å˜é‡â€”â€”è¯‘è€…æ³¨ï¼‰ã€‚è¿™äº›æœ¬åœ°å˜é‡å½“è¢«ä½¿ç”¨æ—¶ï¼Œå¦‚æœéœ€è¦çš„æ˜¯ä¸€ä¸ªå­—ä¸²ï¼Œåˆ™å…¶ä¸ºç©ºä¸²ï¼Œå¦‚æœéœ€è¦çš„æ•°å€¼ï¼Œåˆ™å…¶å€¼ä¸º 0ï¼ˆæŸ¥çœ‹ @ref{User-defined}ï¼‰ã€‚

ä½œä¸ºä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œ@command{gawk} æä¾›äº†é—´æ¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼ï¼Œ
è¿™æ˜¯ä¸€ç§åœ¨è¿è¡Œæ—¶è¿›è¡Œå‡½æ•°é€‰æ‹©çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯åœ¨ä½ å†™ç¨‹åºçš„æ—¶å€™å°±ç¡®å®šè¦è°ƒç”¨çš„å‡½æ•°ã€‚
æˆ‘ä»¬åé¢å†å¯¹è¿™ä¸ªè¿›è¡Œè®¨è®ºï¼Œå¯ä»¥æŸ¥çœ‹ @ref{Indirect Calls}ã€‚

@cindex side effects, function calls
å¦‚å…¶ä»–çš„è¡¨è¾¾å¼ä¸€æ ·ï¼Œå‡½æ•°è°ƒç”¨ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªå€¼ï¼Œé€šå¸¸ç§°ä¸ºè¿”å›å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯æ ¹æ®å‡½æ•°çš„å‚æ•°è¿›è¡Œè®¡ç®—æ‰€å¾—åˆ°çš„å€¼ã€‚
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ@samp{sqrt(@var{argument})} çš„è¿”å›å€¼å°±æ˜¯ @var{argument} çš„å¹³æ–¹æ ¹ã€‚
ä¸‹é¢çš„ç¨‹åºä¸€è¡Œè¡Œåœ°è¯»å–æ•°å€¼ï¼Œç„¶æ‰£æ‰“å°å®ƒä»¬çš„å¹³æ–¹æ ¹ï¼š

@example
$ @kbd{awk '@{ print "The square root of", $1, "is", sqrt($1) @}'}
@kbd{1}
@print{} The square root of 1 is 1
@kbd{3}
@print{} The square root of 3 is 1.73205
@kbd{5}
@print{} The square root of 5 is 2.23607
@kbd{Ctrl-d}
@end example

å‡½æ•°è°ƒç”¨æœ‰å‰¯ä½œç”¨ï¼Œä¾‹å¦‚å°†å€¼èµ‹ç»™ä¸€ä¸ªæŒ‡å®šçš„å˜é‡æˆ–è€…æ‰§è¡Œ I/O æ“ä½œã€‚è¿™ä¸ªç¨‹åºå±•ç°äº† @code{match()} å‡½æ•°
ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰å¦‚ä½•æ¥æ›´æ”¹å˜é‡ @code{RSTART} ä¸ @code{RLENGTH}ï¼š

@example
@{
    if (match($1, $2))
        print RSTART, RLENGTH
    else
        print "no match"
@}
@end example

@noindent
è¿™æ˜¯è¿è¡Œä¾‹å­ï¼š

@example
$ @kbd{awk -f matchit.awk}
@kbd{aaccdd  c+}
@print{} 3 2
@kbd{foo     bar}
@print{} no match
@kbd{abcdefg e}
@print{} 5 1
@end example

@node Precedence
@section æ“ä½œç¬¦ä¼˜å…ˆçº§ï¼ˆæ“ä½œç¬¦çš„åµŒå¥—ï¼‰
@cindex precedence
@cindex operators, precedence

@dfn{æ“ä½œç¬¦çš„ä¼˜å…ˆçº§}å†³å®šäº†ä¸åŒçš„æ“ä½œç¬¦ç´§æ¥ç€å‡ºç°åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¸­æ—¶å¦‚ä½•ç»“åˆã€‚
ä¾‹å¦‚ï¼Œ@samp{*} æ¯” @samp{+} æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥ @samp{a + b * c} è¡¨ç¤ºå…ˆå°† @code{b} ä¸ @code{c} ç›¸ä¹˜ï¼Œ
ç„¶åå†ä¸ @code{a} ç›¸åŠ ï¼ˆå¦‚ @samp{a + (b * c)}ï¼‰

æ­£å¸¸çš„æ“ä½œä¼˜å…ˆçº§å¯ä»¥é€šè¿‡ä½¿ç”¨æ‹¬å·æ¥è¿›è¡Œé‡æ–°æ’åºã€‚ä¸€æƒ³åˆ°ä¼˜å…ˆçº§è§„åˆ™å°±åƒæ˜¯è¯´ï¼Œæ‹¬å·æ˜¯è¯¥æ”¾åœ¨å“ªä¸ªä½ç½®ã€‚äº‹å®ä¸Šï¼Œå½“æ“ä½œç¬¦çš„ç»„åˆä¸å¸¸å‡ºç°æ—¶ï¼Œä½¿ç”¨æ‹¬å·æ€»æ˜¯å¾ˆæ˜æ™ºçš„åšæ³•ã€‚å°±ç®—æ˜¯å¾ˆæœ‰ç»éªŒçš„æ“ä½œå‘˜ï¼Œä¹Ÿå¶å°”å¿˜è®°ç¡®åˆ‡çš„è§„åˆ™ï¼Œå› æ­¤ä¼šçŠ¯é”™è¯¯ã€‚æ˜¾å¼åœ°ä½¿ç”¨æ‹¬å·åˆ™å¯ä»¥é¿å…è¿™æ ·çš„é”™è¯¯ã€‚

å½“æœ‰ç›¸åŒä¼˜å…ˆçº§çš„æ“ä½œç¬¦å‡ºç°åœ¨ä¸€èµ·æ—¶ï¼Œå…ˆå¯¹æœ€å·¦è¾¹çš„æ“ä½œç¬¦è¿›è¡Œç»“åˆã€‚å¯¹äºèµ‹å€¼ã€æ¡ä»¶ä»¥åŠå¹‚ä¹˜å®ƒä»¬åˆ™æ˜¯ä»¥ç›¸åçš„é¡ºåºè¿›è¡Œç»“åˆçš„ã€‚
æ‰€ä»¥ @samp{a - b + c} ç»“åˆæˆ @samp{(a - b) + c}ï¼Œ è€Œ @samp{a = b = c} åˆ™æ˜¯ç»“åˆæˆ @samp{a = (b = c)}ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‰ç¼€ä¸€å…ƒæ“ä½œç¬¦å¯¹äºä¼˜å…ˆçº§å¹¶ä¸é‡è¦ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªè§£é‡Šå®ƒä»¬çš„æ–¹å¼ï¼šå†…å±‚çš„ä¼˜å…ˆã€‚
æ‰€ä»¥ï¼Œ@samp{$++i} è¡¨ç¤º @samp{$(++i)}ï¼Œè€Œ @samp{++$x} åˆ™è¡¨ç¤º @samp{++($x)}ã€‚
ä½†æ˜¯ï¼Œå½“å¦ä¸€ä¸ªæ“ä½œç¬¦è·Ÿç€æ“ä½œæ•°åé¢ï¼Œåˆ™ä¸€å…ƒæ“ä½œç¬¦çš„ä¼˜å…ˆçº§å°±é‡è¦èµ·æ¥äº†ã€‚
@samp{$x^2} è¡¨ç¤º @samp{($x)^2}ï¼Œä½†æ˜¯ @samp{-x^2} åˆ™ä¸º @samp{-(x^2)}ï¼Œå› ä¸º @samp{-} çš„ä¼˜å…ˆçº§ä½äº @samp{^}ï¼Œè€Œ @samp{$} åˆ™æœ‰è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚
å¦å¤–ï¼Œæ“ä½œç¬¦ä¹Ÿä¸èƒ½ä»¥ä¸€ç§è¿åä¼˜å…ˆçº§è§„åˆ™çš„æ–¹å¼è¿›è¡Œç»„åˆï¼Œä¾‹å¦‚ @samp{$$0++--} å¹¶ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è¡¨è¾¾å¼ï¼Œ
å› ä¸ºç¬¬ä¸€ä¸ª @samp{$} æœ‰æ¯” @samp{++} æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œä¸ºäº†é¿å…äº§ç”Ÿé—®é¢˜ï¼Œè¡¨è¾¾å¼å¯ä»¥å†™æˆ @samp{$($0++)--}ã€‚

ä¸‹é¢çš„åˆ—è¡¨åˆ—å‡ºäº† @command{awk} çš„æ“ä½œç¬¦ï¼Œå¹¶æŒ‰ä¼˜å…ˆçº§çš„é™åºæ’åºï¼š

@c @asis for docbook to come out right
@table @asis
@item @code{(}@dots{}@code{)}
ç»“åˆã€‚

@cindex @code{$} (dollar sign), @code{$} field operator
@cindex dollar sign (@code{$}), @code{$} field operator
@item @code{$}
åŸŸå¼•ç”¨ã€‚

@cindex @code{+} (plus sign), @code{++} operator
@cindex plus sign (@code{+}), @code{++} operator
@cindex @code{-} (hyphen), @code{--} operator
@cindex hyphen (@code{-}), @code{--} operator
@item @code{++ --}
é€’å¢ï¼Œé€’å‡ã€‚

@cindex @code{^} (caret), @code{^} operator
@cindex caret (@code{^}), @code{^} operator
@cindex @code{*} (asterisk), @code{**} operator
@cindex asterisk (@code{*}), @code{**} operator
@item @code{^ **}
å¹‚ä¹˜ã€‚è¿™ä¸ªæ“ä½œç¬¦çš„ç»“åˆç”±å³å¾€å·¦ã€‚

@cindex @code{+} (plus sign), @code{+} operator
@cindex plus sign (@code{+}), @code{+} operator
@cindex @code{-} (hyphen), @code{-} operator
@cindex hyphen (@code{-}), @code{-} operator
@cindex @code{!} (exclamation point), @code{!} operator
@cindex exclamation point (@code{!}), @code{!} operator
@item @code{+ - !}
ä¸€å…ƒåŠ ï¼Œä¸€å…ƒå‡ï¼Œä»¥åŠé€»è¾‘â€œéâ€ã€‚

@cindex @code{*} (asterisk), @code{*} operator, as multiplication operator
@cindex asterisk (@code{*}), @code{*} operator, as multiplication operator
@cindex @code{/} (forward slash), @code{/} operator
@cindex forward slash (@code{/}), @code{/} operator
@cindex @code{%} (percent sign), @code{%} operator
@cindex percent sign (@code{%}), @code{%} operator
@item @code{* / %}
ä¹˜ï¼Œé™¤ï¼Œå–ä½™ã€‚

@cindex @code{+} (plus sign), @code{+} operator
@cindex plus sign (@code{+}), @code{+} operator
@cindex @code{-} (hyphen), @code{-} operator
@cindex hyphen (@code{-}), @code{-} operator
@item @code{+ -}
åŠ ï¼Œå‡ã€‚

@item String concatenation
æ²¡æœ‰é’ˆå¯¹å­—ä¸²è¿æ¥çš„ç‰¹åˆ«ç¬¦å·ã€‚æ“ä½œæ•°ç®€å•åœ°ä¸€ä¸ªæ¥ä¸€ä¸ªè¾“å…¥ï¼ˆæŸ¥çœ‹ @ref{Concatenation}ï¼‰ã€‚

@cindex @code{<} (left angle bracket), @code{<} operator
@cindex left angle bracket (@code{<}), @code{<} operator
@cindex @code{<} (left angle bracket), @code{<=} operator
@cindex left angle bracket (@code{<}), @code{<=} operator
@cindex @code{>} (right angle bracket), @code{>=} operator
@cindex right angle bracket (@code{>}), @code{>=} operator
@cindex @code{>} (right angle bracket), @code{>} operator
@cindex right angle bracket (@code{>}), @code{>} operator
@cindex @code{=} (equals sign), @code{==} operator
@cindex equals sign (@code{=}), @code{==} operator
@cindex @code{!} (exclamation point), @code{!=} operator
@cindex exclamation point (@code{!}), @code{!=} operator
@cindex @code{>} (right angle bracket), @code{>>} operator (I/O)
@cindex right angle bracket (@code{>}), @code{>>} operator (I/O)
@cindex operators, input/output
@cindex @code{|} (vertical bar), @code{|} operator (I/O)
@cindex vertical bar (@code{|}), @code{|} operator (I/O)
@cindex operators, input/output
@cindex @code{|} (vertical bar), @code{|&} operator (I/O)
@cindex vertical bar (@code{|}), @code{|&} operator (I/O)
@cindex operators, input/output
@item @code{< <= == != > >= >> | |&}
å…³ç³»ä¸é‡å®šå‘ã€‚å…³ç³»æ“ä½œç¬¦ä¸é‡å®šå‘æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ã€‚å¦‚ @samp{>} è¿™æ ·çš„å­—ç¬¦ï¼Œå³ä¸ºå…³ç³»æ“ä½œç¬¦ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé‡å®šå‘ç¬¦ã€‚ä¸Šä¸‹æ–‡ç¯å¢ƒç”¨æ¥åŒºåˆ«ä½¿ç”¨çš„æ˜¯å“ªç§å«ä¹‰ã€‚

@cindex @code{print} statement, I/O operators in
@cindex @code{printf} statement, I/O operators in
æ³¨æ„åœ¨ @code{print} ä¸ @code{printf} è¯­å¥ä¸­çš„ I/O é‡å®šå‘ï¼Œæ˜¯è¯­å¥çº§çš„ï¼Œè€Œä¸æ˜¯è¡¨è¾¾å¼çº§çš„ã€‚é‡å®šå‘ä¸ä¼šäº§ç”Ÿè¡¨è¾¾å¼ï¼Œä¸å¯ä»¥æˆä¸ºåˆ«ä¸€ä¸ªæ“ä½œç¬¦çš„æ“ä½œæ•°ã€‚ç»“æœå°±æ˜¯ï¼Œä¸ç”¨æ‹¬å·è€Œåœ¨ä¸€ä¸ªä½ä¼˜å…ˆçº§çš„æ“ä½œç¬¦é™„è¿‘ä½¿ç”¨é‡å®šå‘æ“ä½œç¬¦æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚è¿™æ ·çš„ç»„åˆ
ï¼ˆå¦‚ @samp{print foo > a ? b : c} ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ã€‚æ­£ç¡®åœ°å†™æ³•åº”è¯¥æ˜¯ @samp{print foo > (a ? b : c)}ã€‚

@cindex @code{~} (tilde), @code{~} operator
@cindex tilde (@code{~}), @code{~} operator
@cindex @code{!} (exclamation point), @code{!~} operator
@cindex exclamation point (@code{!}), @code{!~} operator
@item @code{~ !~}
åŒ¹é…ä¸ä¸åŒ¹é…ã€‚

@cindex @code{in} operator
@item @code{in}
æ•°ç»„æˆå‘˜åˆ¤å®šã€‚

@cindex @code{&} (ampersand), @code{&&} operator
@cindex ampersand (@code{&}), @code{&&} operator
@item @code{&&}
é€»è¾‘â€œä¸â€ã€‚

@cindex @code{|} (vertical bar), @code{||} operator
@cindex vertical bar (@code{|}), @code{||} operator
@item @code{||}
é€»è¾‘â€œæˆ–â€ã€‚

@cindex @code{?} (question mark), @code{?:} operator
@cindex question mark (@code{?}), @code{?:} operator
@item @code{?:}
æ¡ä»¶ï¼Œè¿™ä¸ªæ“ä½œç¬¦çš„ç»“åˆæ˜¯ä»å³åˆ°å·¦ã€‚

@cindex @code{+} (plus sign), @code{+=} operator
@cindex plus sign (@code{+}), @code{+=} operator
@cindex @code{-} (hyphen), @code{-=} operator
@cindex hyphen (@code{-}), @code{-=} operator
@cindex @code{*} (asterisk), @code{*=} operator
@cindex asterisk (@code{*}), @code{*=} operator
@cindex @code{*} (asterisk), @code{**=} operator
@cindex asterisk (@code{*}), @code{**=} operator
@cindex @code{/} (forward slash), @code{/=} operator
@cindex forward slash (@code{/}), @code{/=} operator
@cindex @code{%} (percent sign), @code{%=} operator
@cindex percent sign (@code{%}), @code{%=} operator
@cindex @code{^} (caret), @code{^=} operator
@cindex caret (@code{^}), @code{^=} operator
@item @code{= += -= *= /= %= ^= **=}
èµ‹å€¼æ“ä½œç¬¦ï¼Œè¿™äº›æ“ä½œç¬¦ç»“åˆç”±å³è‡³å·¦ã€‚
@end table

@cindex POSIX @command{awk}, @code{**} operator and
@cindex portability, operators, not in POSIX @command{awk}
@quotation æç¤º
@samp{|&} ã€ @samp{**} ä¸ @samp{**=} éƒ½æ²¡æœ‰ç”± POSIX æŒ‡å®šï¼Œä¸ºäº†ç§»æ¤æ€§ï¼Œè¯·ä¸è¦ä½¿ç”¨å®ƒä»¬ã€‚
@end quotation

@node Locales
@section å“ªé‡Œé€ æˆå·®å¼‚
@cindex locale, definition of

ç°ä»£æ“ä½œç³»ç»Ÿéƒ½æœ‰@dfn{æœ¬åœ°è¯­è¨€}çš„æ¦‚å¿µï¼šå³å‘Šè¯‰ç³»ç»Ÿæœ¬åœ°å­—ç¬¦é›†ä¸è¯­è¨€çš„ä¸€ç§æ–¹å¼ã€‚
ISO C æ ‡å‡†å®šä¹‰äº†ä¸€ç§é»˜è®¤çš„ @code{"C"} è¯­è¨€è®¾ç½®ï¼Œè¿™æ˜¯ä¸€ç§å¾ˆå¤š C ç¨‹åºå‘˜æ‰€ä½¿ç”¨çš„ä¸€ç§å…¸å‹ç¯å¢ƒã€‚

ä»¥å‰ï¼Œè¯­è¨€è®¾ç½®ç”¨æ¥å½±å“æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…ï¼Œä½†æ˜¯ç°åœ¨äº‹æƒ…ä¸å†æ˜¯è¿™æ ·çš„ï¼ˆæŸ¥çœ‹ @ref{Ranges and Locales}ï¼‰ã€‚

æœ¬åœ°è¯­è¨€è®¾ç½®ä¹Ÿä¼šå½±å“è®°å½•çš„åˆ†å‰²ã€‚å¯¹äºæ­£å¸¸çš„ @samp{RS = "\n"} è¿™ç§æƒ…å†µï¼Œ
è¯­è¨€è®¾ç½®å¤§å¤šæ˜¯ä¸ç›¸å…³çš„ã€‚å¯¹äºå…¶ä»–å•å­—ç¬¦è®°å½•åˆ†éš”ç¬¦ï¼Œåœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® @samp{LC_ALL=C} å°†ä½¿ä½ åœ¨è¯»å–è®°å½•æ—¶æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚å¦åˆ™ï¼Œ
@command{gawk} å¾—è°ƒç”¨å‡ ä¸ªå‡½æ•°ï¼Œé’ˆå¯¹@emph{æ¯ä¸€ä¸ªè¾“å‡ºå­—ç¬¦}è¿›è¡Œè°ƒç”¨ï¼Œä»¥æŸ¥æ‰¾è®°å½•çš„åˆ†éš”ç¬¦ã€‚

è¯­è¨€è®¾ç½®ä¹Ÿä¼šå½±å“æ—¥æœŸä¸æ—¶é—´çš„æ ¼å¼ï¼ˆæŸ¥çœ‹ @ref{Time Functions}ï¼‰ã€‚
ä¾‹å¦‚ï¼Œå¯¹äº 2015 å¹´ 9 æœˆ 4 å·çš„ä¸€èˆ¬ç¼©å†™æ–¹å¼ï¼Œåœ¨ç¾å›½æ˜¯â€œ9/4/15â€ã€‚ä½†åœ¨æ¬§æ´²çš„è®¸å¤šå›½å®¶ï¼Œåˆ™æ˜¯â€œ4.9.15â€ã€‚
å› æ­¤ï¼Œ@samp{%x} åœ¨ @code{"US"} è¯­è¨€è®¾ç½®ä¸­å¯èƒ½äº§ç”Ÿ @samp{9/4/15}ï¼Œè€Œåœ¨ @code{"EUROPE"} è¯­è¨€è®¾ç½®ä¸­ï¼Œå¯èƒ½äº§ç”Ÿ @samp{4.9.15}ã€‚

æ ¹æ® POSIX æ ‡å‡†ï¼Œå­—ä¸²æ¯”è¾ƒä¹Ÿä¼šå—åˆ°è¯­è¨€è®¾ç½®çš„å½±å“ï¼ˆä¸æ­£åˆ™è¡¨è¾¾å¼ç±»ä¼¼ï¼‰ã€‚å…·ä½“çš„ç»†èŠ‚åœ¨ @ref{POSIX String Comparison}ã€‚

æœ€åï¼Œè¯­è¨€è®¾ç½®ä¹Ÿä¼šå½±å“ @command{gawk} åœ¨åˆ†æè¾“å…¥æ•°æ®æ—¶æ‰€ä½¿ç”¨çš„åè¿›åˆ¶å°æ•°ç‚¹ç¬¦å·çš„å€¼ã€‚
å…³äºè¿™ä¸€ç‚¹çš„ç»†èŠ‚åˆ™åœ¨ @ref{Conversion}ã€‚

@node Expressions Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
è¡¨è¾¾å¼æ˜¯ç¨‹åºä¸­åŸºæœ¬çš„è®¡ç®—å…ƒç´ ã€‚å®ƒä»¬ç”±å¸¸é‡ã€å˜é‡ã€å‡½æ•°è°ƒç”¨ä»¥åŠç”¨æ“ä½œç¬¦ç»„åˆèµ·æ¥çš„å„ç§å€¼ç»„æˆã€‚

@item
@command{awk} æä¾›ä¸‰ç§å¸¸é‡ï¼šæ•°å€¼å¸¸é‡ï¼Œå­—ä¸²å¸¸é‡ä»¥åŠæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ã€‚
@command{gawk} å¯ä»¥è®©ä½ ä»¥å…«è¿›åˆ¶ä»¥åŠåå…­è¿›åˆ¶çš„æ–¹å¼æ¥æŒ‡å®šæ•°å€¼å¸¸é‡ï¼ˆç›¸å…³çš„åŸºæ•°ä¸º 8 ä¸ 16ï¼‰ï¼Œä¹Ÿå¯ä»¥ä»¥åè¿›åˆ¶æ–¹å¼è¿›è¡ŒæŒ‡å®šï¼ˆåŸºæ•°ä¸º 10ï¼‰ã€‚
åœ¨ç‰¹å®šçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå•ç‹¬çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œ
å¦‚ @code{/foo/} ä¸ @samp{$0 ~ /foo/} æœ‰ä¸€æ ·çš„å«ä¹‰ã€‚

@item
å˜é‡åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­æŒæœ‰å€¼ã€‚æœ‰ä¸€äº›å†…ç½®å˜é‡æ¥æä¾› @command{awk} ç¨‹åºçš„ç›¸å…³ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸€äº›å˜é‡ç”¨æ¥æ§åˆ¶ @command{awk} çš„è¡Œä¸ºã€‚

@item
åœ¨ @command{awk} éœ€è¦çš„æ—¶å€™ï¼Œæ•°å€¼ä¼šè‡ªåŠ¨åœ°è½¬æ¢ä¸ºå­—ä¸²ï¼Œå­—ä¸²ä¹Ÿä¼šè½¬æ¢ä¸ºæ•°å€¼ã€‚
æ•°å€¼è½¬æ¢çš„æ–¹å¼å°±å¥½åƒé€šè¿‡ä»¥ @code{CONVFMT} æ ¼å¼æ¥è°ƒç”¨ @code{sprintf()} è¿›è¡Œæ ¼å¼åŒ–ä¸€æ ·ã€‚è¯­è¨€è®¾ç½®å¯ä»¥å½±å“è½¬æ¢ã€‚

@item
@command{awk} æä¾›äº†å¸¸ç”¨çš„ç®—æœ¯æ“ä½œç¬¦ï¼ˆåŠ ã€å‡ã€ä¹˜ã€é™¤ï¼Œå–æ¨¡ï¼‰ï¼Œè¿˜æœ‰ä¸€å…ƒçš„åŠ ä¸å‡ã€‚åŒæ—¶ä¹Ÿæä¾›æ¯”è¾ƒæ“ä½œç¬¦ï¼Œå¸ƒæ—æ“ä½œç¬¦ï¼Œä»¥åŠæ•°ç»„å…ƒç´ æˆå‘˜æµ‹è¯•æ“ä½œç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ“ä½œç¬¦ã€‚å­—ä¸²è¿æ¥é€šè¿‡å°†é€šè¿‡ç®€å•åœ°å°†è¡¨è¾¾å¼é¡ºåºæ’æ”¾æ¥å®Œæˆï¼Œè€Œä¸éœ€è¦æ˜¾å¼çš„æ“ä½œç¬¦ã€‚
ä¸‰å…ƒæ“ä½œç¬¦ @samp{?:} åˆ™æä¾›äº†åœ¨è¡¨è¾¾å¼ä¸­è¿›è¡Œâ€œif-elseâ€çš„æµ‹è¯•ã€‚

@item
èµ‹å€¼æ“ä½œç¬¦ä¸ºé€šç”¨çš„ç®—æœ¯æ“ä½œæä¾›äº†æ–¹ä¾¿çš„ç¼©ç•¥ã€‚

@item
åœ¨ @command{awk} ä¸­ï¼Œå¦‚æœéé›¶@emph{æˆ–è€…}éç©ºï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯ trueï¼Œå¦åˆ™ä¸º falseã€‚

@item
å˜é‡çš„ç±»å‹ä¾èµ–äºèµ‹å€¼ï¼Œå¹¶ä¸”åœ¨ç”Ÿå‘½æœŸä¸­å¯ä»¥å˜åŒ–ã€‚ç±»å‹å†³å®šäº†å®ƒåœ¨æ¯”è¾ƒä¸­çš„è¡Œä¸ºï¼ˆæ˜¯ä»¥å­—ä¸²æ–¹å¼è¿˜æ˜¯ä»¥æ•°å€¼æ–¹å¼è¿›è¡Œï¼‰ã€‚

@item
å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼ å¯ä»¥åšä¸ºä¸€ä¸ªæ›´å¤§çš„è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ã€‚ç”¨äºåœ¨è°ƒç”¨å‡½æ•°æ—¶å‘å‡½æ•°ä¼ é€’çš„å‚æ•°çš„è¡¨è¾¾å¼ä¼šåœ¨è°ƒç”¨ä¹‹å‰è¿›è¡Œæ±‚å€¼ã€‚
@command{awk} å³æä¾›äº†å†…ç½®çš„å‡½æ•°ï¼Œä¹Ÿæä¾›ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œç›¸å…³çš„ç»†èŠ‚åœ¨ @ref{Functions}ã€‚

@item
æ“ä½œç¬¦çš„ä¼˜å…ˆçº§æŒ‡å®šäº†æ“ä½œæ‰§è¡Œçš„é¡ºåºï¼Œé™¤éä½¿ç”¨äº†æ‹¬å·æ¥æ›´æ”¹ã€‚
@command{awk} çš„æ“ä½œç¬¦ä¼˜å…ˆçº§ä¸ C ä¸­çš„ä¼˜å…ˆçº§å…¼å®¹ã€‚

@item
è¯­è¨€è®¾ç½®å¯ä»¥å½±å“ @command{awk} ç¨‹åºè¾“å‡ºæ•°æ®çš„æ ¼å¼ï¼Œå¶å°”ä¹Ÿå½±å“ä½œä¸ºæ•°æ®è¾“å…¥çš„æ ¼å¼ã€‚

@end itemize


@node Patterns and Actions
@chapter æ¨¡å¼ã€åŠ¨ä½œä¸å˜é‡
@cindex patterns

å¦‚æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„ï¼Œæ¯ä¸€ä¸ª @command{awk} è¯­å¥éƒ½ç”±ä¸æ¨¡å¼åŠä¸å…¶å…³è”çš„åŠ¨ä½œç»„æˆã€‚æœ¬@value{CHAPTER}è¿°å¦‚ä½•æ¥åˆ›å»ºæ¨¡å¼ä¸åŠ¨ä½œï¼ŒåŒ…æ‹¬ä½ åœ¨åŠ¨ä½œä¸­å¯ä»¥åšçš„æ“ä½œçš„ç±»å‹ï¼Œ
ä»¥åŠ @command{awk} çš„é¢„å®šä¹‰å˜é‡ã€‚

â€œæ¨¡å¼-åŠ¨ä½œâ€è§„åˆ™ä»¥åŠå¯åœ¨åŠ¨ä½œä¸­ä½¿ç”¨çš„è¯­å¥ç»„æˆäº† @command{awk} ç¼–ç¨‹çš„æ ¸å¿ƒã€‚åœ¨ä¸€å®šæ„ä¹‰ä¸Šï¼Œåˆ°æ­¤ä¸ºæ­¢æ‰€æ¶‰åŠçš„å†…å®¹æ˜¯å»ºç«‹ç¨‹åºçš„åŸºç¡€ã€‚ç›®å‰å¯ä»¥å¼„äº›æœ‰ç”¨çš„æ—¶å€™äº†ã€‚

@menu
* Pattern Overview::            What goes into a pattern.
* Using Shell Variables::       How to use shell variables with @command{awk}.
* Action Overview::             What goes into an action.
* Statements::                  Describes the various control statements in
                                detail.
* Built-in Variables::          Summarizes the predefined variables.
* Pattern Action Summary::      Patterns and Actions summary.
@end menu

@node Pattern Overview
@section æ¨¡å¼å…ƒç´ 

@menu
* Regexp Patterns::             Using regexps as patterns.
* Expression Patterns::         Any expression can be used as a pattern.
* Ranges::                      Pairs of patterns specify record ranges.
* BEGIN/END::                   Specifying initialization and cleanup rules.
* BEGINFILE/ENDFILE::           Two special patterns for advanced control.
* Empty::                       The empty pattern, which matches every record.
@end menu

@cindex patterns, types of
åœ¨ @command{awk} ä¸­çš„æ¨¡å¼æ§åˆ¶ç€è§„åˆ™çš„æ‰§è¡Œï¼Œå½“æ¨¡å¼åŒ¹é…å½“å‰çš„è¾“å…¥è®°å½•æ—¶ï¼Œå°±æ‰§è¡Œå®ƒçš„è§„åˆ™ã€‚ä¸‹é¢æ€»ç»“äº† @command{awk} æ¨¡å¼çš„ç±»å‹ï¼š

@table @code
@item /@var{regular expression}/
æ­£åˆ™è¡¨è¾¾å¼ã€‚å½“è¾“å…¥è®°å½•çš„æ–‡æœ¬é€‚é…äºæ­£åˆ™è¡¨è¾¾å¼åˆ™åŒ¹é…ã€‚ï¼ˆæŸ¥çœ‹ @ref{Regexp}ã€‚ï¼‰

@item @var{expression}
å•ç‹¬çš„è¡¨è¾¾å¼ã€‚å½“è¿™ä¸ªè¡¨è¾¾å¼çš„å€¼ä¸ºéé›¶ï¼ˆå¦‚æœæ˜¯æ•°å€¼çš„è¯ï¼‰æˆ–è€…éç©ºï¼ˆå¦‚æœæ˜¯å­—ä¸²çš„è¯ï¼‰åˆ™åŒ¹é…ã€‚ï¼ˆæŸ¥çœ‹ @ref{Expression Patterns}ã€‚ï¼‰

@item @var{begpat}, @var{endpat}
ä¸€å¯¹ç”±é€—å·åˆ†éš”çš„æ¨¡å¼ï¼ŒæŒ‡å®šäº†è®°å½•çš„@dfn{èŒƒå›´}ã€‚
èŒƒå›´åŒ…æ‹¬åŒ¹é… @var{begpat} çš„å¼€å§‹çš„è®°å½•ä»¥åŠæœ€åä¸€ä¸ªåŒ¹é… @var{endpat} çš„è®°å½•ï¼ˆæŸ¥çœ‹ @ref{Ranges}ã€‚ï¼‰

@item BEGIN
@itemx END
æŒ‡å®š @command{awk} ç¨‹åºå¼€å§‹ä¸ç»“æŸè¡Œä¸ºçš„ç‰¹æ®Šæ¨¡å¼ã€‚ï¼ˆæŸ¥çœ‹ @ref{BEGIN/END}ã€‚ï¼‰

@item BEGINFILE
@itemx ENDFILE
é’ˆå¯¹æ¯ä¸ªæ–‡ä»¶ä¸ºåŸºç¡€çš„åœ¨å¼€å§‹ä¸ç»“æŸä¸­æ‰§è¡Œçš„åŠ¨ä½œçš„ç‰¹æ®Šæ¨¡å¼ã€‚ï¼ˆæŸ¥çœ‹ @ref{BEGINFILE/ENDFILE}ã€‚ï¼‰

@item @var{empty}
ç©ºæ¨¡å¼åŒ¹é…æ¯ä¸€æ¡è®°å½•ã€‚ï¼ˆæŸ¥çœ‹ @ref{Empty}ã€‚ï¼‰
@end table

@node Regexp Patterns
@subsection ä»¥æ­£åˆ™è¡¨è¾¾å¼ä¸ºæ¨¡å¼
@cindex patterns, expressions as
@cindex regular expressions, as patterns

æ­£åˆ™è¡¨è¾¾å¼æ˜¯æœ¬@value{DOCUMENT}ä¸­å‡ºç°çš„ç¬¬ä¸€ç§æ¨¡å¼ã€‚æ­¤ç±»æ¨¡å¼åªæ˜¯ç®€å•çš„å¤„äºæ¨¡å¼è§„åˆ™ä¸­çš„æ­£åˆ™è¡¨è¾¾å·¥å¸¸é‡ã€‚
å®ƒè¡¨ç¤º @samp{$0 ~ /@var{pattern}/}ã€‚å½“è¾“å‡ºè®°å½•åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ˜¯ï¼Œåˆ™è§„åˆ™åŒ¹é…ã€‚å¦‚ï¼š

@example
/foo|bar|baz/  @{ buzzwords++ @}
END            @{ print buzzwords, "buzzwords seen" @}
@end example

@node Expression Patterns
@subsection ä»¥è¡¨è¾¾å¼ä¸ºæ¨¡å¼
@cindex expressions, as patterns

@command{awk} è¡¨è¾¾æ˜¯æœ‰æ•ˆçš„ @command{awk} æ¨¡å¼ã€‚å¦‚æœè¡¨è¾¾å¼çš„å€¼æ˜¯éé›¶ï¼ˆå¦‚æœç»“æœä¸ºæ•°å€¼ï¼‰æˆ–è€…éç©ºï¼ˆå¦‚æœç»“æœä¸ºå­—ä¸²ï¼‰å°±è¡¨ç¤ºæ¨¡å¼æ˜¯åŒ¹é…çš„ã€‚è¡¨è¾¾å¼æ¯æ¬¡åŒ¹é…è¾“å…¥è®°å½•çš„æ—¶å€™éƒ½éœ€è¦é‡æ–°è®¡ç®—ä¸€æ¬¡ã€‚å¦‚æœè¡¨è¾¾å¼ä½¿ç”¨çš„æ˜¯åŸŸï¼Œ
å¦‚ @code{$1}ï¼Œåˆ™å®ƒçš„å€¼ç›´æ¥ä¾èµ–äºæ–°çš„è¾“å…¥è®°å½•æ–‡æœ¬ï¼Œä¸ç„¶ï¼Œå®ƒå°±åªä¾èµ–äº @command{awk} ç¨‹åºåˆ°ç›®å‰ä¸ºæ­¢å·²ç»æ‰§è¡Œçš„ç»“æœã€‚

@cindex comparison expressions, as patterns
@cindex patterns, comparison expressions as
ä½¿ç”¨åœ¨ @ref{Typing and Comparison}ï¼Œæè¿°çš„æ¯”è¾ƒæ“ä½œç¬¦çš„æ¯”è¾ƒè¡¨è¾¾å¼ï¼Œæ˜¯å¾ˆå¸¸ç”¨çš„æ¨¡å¼ç±»å‹ã€‚
æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸ä¸åŒ¹é…ä¹Ÿæ˜¯éå¸¸å¸¸ç”¨çš„è¡¨è¾¾å¼ã€‚
@samp{~} ä¸ @samp{!~} æ“ä½œç¬¦çš„å·¦è¾¹çš„æ“ä½œæ•°æ˜¯ä¸€ä¸ªå­—ä¸²ã€‚å³æ‰‹çš„æ“ä½œæ•°è¦ä¹ˆæ˜¯ä¸€ä¸ªè¢«æ–œæ åŒ…ä½çš„å¸¸é‡æ­£åˆ™è¡¨è¾¾å¼ï¼ˆ@code{/@var{regexp}/}ï¼‰ï¼Œ
è¦ä¹ˆæ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @ref{Computed Regexps}ï¼‰ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­æ‰“å°å…¶ç¬¬ä¸€ä¸ªåŸŸä¸º @samp{li} çš„æ‰€æœ‰è®°å½•çš„ç¬¬äºŒä¸ªåŸŸï¼š

@cindex @code{/} (forward slash), patterns and
@cindex forward slash (@code{/}), patterns and
@cindex @code{~} (tilde), @code{~} operator
@cindex tilde (@code{~}), @code{~} operator
@cindex @code{!} (exclamation point), @code{!~} operator
@cindex exclamation point (@code{!}), @code{!~} operator
@example
$ @kbd{awk '$1 == "li" @{ print $2 @}' mail-list}
@end example

@noindent
ï¼ˆè¿™é‡Œæ²¡æœ‰è¾“å‡ºï¼Œå› ä¸ºæ²¡æœ‰äººçš„åå­—ä¸º @samp{li}ï¼‰ã€‚ä¸ä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç›¸æ¯”ï¼Œåˆ™ä¼šåŒ¹é…ä»»æ„çš„è®°å½•ä¸­ç¬¬ä¸€ä¸ªåŸŸä¸­åŒ…å« @samp{li} çš„è®°å½•ï¼š

@example
$ @kbd{awk '$1 ~ /li/ @{ print $2 @}' mail-list}
@print{} 555-5553
@print{} 555-6699
@end example

@cindex regexp constants, as patterns
@cindex patterns, regexp constants as
æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡æ˜¯è¡¨è¾¾å¼æ¨¡å¼çš„ä¸€ç§ç‰¹ä¾‹ã€‚è¡¨è¾¾å¼ @code{/li/} ä¸­ï¼Œå¦‚æœ @samp{li} å‡ºç°åœ¨å½“å‰çš„è®°å½•ä¸­ï¼Œåˆ™å…¶å€¼ä¸º 1ã€‚
å› æ­¤ï¼Œä½œä¸ºæ¨¡å¼ï¼Œ@code{/li/} åŒ¹é…ä»»æ„çš„åŒ…å« @samp{li} çš„è®°å½•ã€‚

@cindex Boolean expressions, as patterns
å¸ƒæ—è¡¨è¾¾å¼ä¹Ÿæ˜¯å¸¸ç”¨çš„æ¨¡å¼ã€‚æ¨¡å¼æ˜¯å¦åŒ¹é…è¾“å…¥è®°å½•ï¼Œåˆ™ä¾èµ–äºå…¶å­è¡¨è¾¾å¼æ˜¯å¦åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤æ‰“å° @file{mail-list}  æ–‡ä»¶ä¸­ï¼Œ
æ—¢åŒ…å« @samp{edu} ä¹ŸåŒ…å« @samp{li} çš„è®°å½•ï¼š

@example
$ @kbd{awk '/edu/ && /li/' mail-list}
@print{} Samuel       555-3430     samuel.lanceolis@@shu.edu        A
@end example

ä¸‹é¢çš„å‘½ä»¤æ‰“å° @file{mail-list} æ–‡ä»¶ä¸­åŒ…å« @samp{edu} @emph{æˆ–è€…} @samp{li} ï¼ˆæˆ–è€…åŒ…å«äºŒè€…ï¼‰çš„æ‰€æœ‰çš„è®°å½•ã€‚

@example
$ @kbd{awk '/edu/ || /li/' mail-list}
@print{} Amelia       555-5553     amelia.zodiacusque@@gmail.com    F
@print{} Broderick    555-0542     broderick.aliquotiens@@yahoo.com R
@print{} Fabius       555-1234     fabius.undevicesimus@@ucb.edu    F
@print{} Julie        555-6699     julie.perscrutabor@@skeeve.com   F
@print{} Samuel       555-3430     samuel.lanceolis@@shu.edu        A
@print{} Jean-Paul    555-2127     jeanpaul.campanorum@@nyu.edu     R
@end example

ä¸‹é¢çš„å‘½ä»¤æ‰“å° @file{mail-list} æ–‡ä»¶ä¸­ä¸åŒ…å«ä¸² @samp{li} çš„æ‰€æœ‰è®°å½•ï¼š

@example
$ @kbd{awk '! /li/' mail-list}
@print{} Anthony      555-3412     anthony.asserturo@@hotmail.com   A
@print{} Becky        555-7685     becky.algebrarum@@gmail.com      A
@print{} Bill         555-1675     bill.drowning@@hotmail.com       A
@print{} Camilla      555-2912     camilla.infusarum@@skynet.be     R
@print{} Fabius       555-1234     fabius.undevicesimus@@ucb.edu    F
@print{} Martin       555-6480     martin.codicibus@@hotmail.com    A
@print{} Jean-Paul    555-2127     jeanpaul.campanorum@@nyu.edu     R
@end example

@cindex @code{BEGIN} pattern, Boolean patterns and
@cindex @code{END} pattern, Boolean patterns and
@cindex @code{BEGINFILE} pattern, Boolean patterns and
@cindex @code{ENDFILE} pattern, Boolean patterns and
åœ¨æ¨¡å¼ä¸­å¸ƒæ—è¡¨è¾¾å¼æ“ä½œç¬¦çš„å­è¡¨è¾¾å¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ã€æ¯”è¾ƒã€æˆ–è€…ä»»æ„çš„ @command{awk} è¡¨è¾¾å¼ã€‚
èŒƒå›´æ¨¡å¼ä¸æ˜¯è¡¨è¾¾å¼ï¼Œå› æ­¤å®ƒä»¬ä¸å¯ä»¥å‡ºç°åœ¨å¸ƒæ—è¡¨è¾¾å¼ä¸­ã€‚è€Œç‰¹æ®Šæ¨¡å¼ @code{BEGIN}ï¼Œ@code{END}ï¼Œ@code{BEGINFILE} ä¸ @code{ENDFILE}ï¼Œ
å®ƒä»¬ä¸ä¼šåŒ¹é…ä»»ä½•çš„è¾“å…¥è®°å½•ï¼Œä¹Ÿä¸æ˜¯è¡¨è¾¾å¼ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½å‡ºç°åœ¨å¸ƒæ—æ¨¡å¼ä¸­ã€‚

å¯ä»¥å‡ºç°åœ¨æ¨¡å¼ä¸­çš„ä¸åŒçš„æ“ä½œç¬¦ä¼˜å…ˆçº§ï¼Œåœ¨è¿™é‡Œ @ref{Precedence}ï¼Œè¿›è¡Œè®¨è®ºã€‚

@node Ranges
@subsection ç”¨æ¨¡å¼æŒ‡å®šè®°å½•èŒƒå›´

@cindex range patterns
@cindex patterns, ranges in
@cindex lines, matching ranges of
@cindex @code{,} (comma), in range patterns
@cindex comma (@code{,}), in range patterns
@dfn{èŒƒå›´æ¨¡å¼}ç”±ä¸¤ä¸ªé€—å·åˆ†éš”çš„æ¨¡å¼ç»„æˆï¼Œä»¥è¿™æ ·çš„æ–¹å¼ @samp{@var{begpat}, @var{endpat}} å‡ºç°ã€‚
è¿™ä¸ªç”¨æ¥å¯¹è¿ç»­çš„è®°å½•è¿›è¡ŒåŒ¹é…ã€‚ç¬¬ä¸€ä¸ªæ¨¡å¼ @var{begpat} æ§åˆ¶èŒƒå›´ä»ä½•å¤„å¼€å§‹ï¼Œè€Œ @var{endpat} åˆ™æ§åˆ¶åœ¨ä½•å¤„ç»“æŸã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š

@example
awk '$1 == "on", $1 == "off"' myfile
@end example

@noindent
æ‰“å° @file{myfile} ä¸­ @samp{on} ä¸ @samp{off} ä¸­çš„æ‰€æœ‰è®°å½•ï¼ˆåŒ…å«ï¼‰ã€‚

èŒƒå›´æ¨¡å¼é€šè¿‡å°†è¾“å…¥è®°å½•ä¸ @var{begpat} å¼€å§‹ã€‚å½“è®°å½•åŒ¹é… @var{begpat} æ—¶ï¼Œ
èŒƒå›´å°±ä¼šè¢«æ‰“å¼€ï¼ŒåŒæ—¶èŒƒå›´æ¨¡å¼ä¹Ÿä¼šåŒ¹é…è¿™ä¸ªè®°å½•ã€‚åªè¦èŒƒå›´æ¨¡å¼ä¿æŒ@dfn{æ‰“å¼€çŠ¶æ€}ï¼Œå…¶å°±ä¼šåŒ¹é…æ‰€è¯»å–çš„æ¯ä¸ªè®°å½•ã€‚
åŒæ—¶ï¼Œè¾“å…¥è®°å½•ä¹Ÿä¼šä¸ @var{endpat}  è¿›è¡ŒåŒ¹é…ï¼Œ
å½“åŒ¹é…æˆåŠŸæ—¶ï¼ŒèŒƒå›´æ¨¡å¼å°±ä¼šåœ¨ä¸‹ä¸€æ¡è®°å½•ä¹‹å‰@dfn{å…³é—­}ã€‚
ç„¶åï¼ŒèŒƒå›´æ¨¡å¼åˆå›å¤´æ£€æŸ¥ @var{begpat} ä¸æ¯æ¡è®°å½•çš„åŒ¹é…æƒ…å†µã€‚

@cindex @code{if} statement, actions@comma{} changing
æ‰“å¼€èŒƒå›´æ¨¡å¼çš„è®°å½•ä¸å…³é—­èŒƒå›´æ¨¡å¼çš„è®°å½•éƒ½åŒ¹é…èŒƒå›´æ¨¡å¼ã€‚å¦‚æœä½ ä¸æƒ³å¤„ç†è¿™äº›è®°å½•ï¼Œä½ å¯ä»¥åœ¨è§„åˆ™ä¸­é€šè¿‡ @code{if} è¯­å¥æ¥åŒºåˆ†å®ƒä»¬ï¼Œå¹¶å…³æ³¨ä½ æ‰€æ„Ÿå…´è¶£çš„è®°å½•ä¸Šã€‚

ä¹Ÿæœ‰å¯èƒ½åœ¨åŒä¸€æ¡è®°å½•ä¸Šæ‰“å¼€ä¸å…³é—­èŒƒå›´æ¨¡å¼ã€‚å¦‚æœè®°å½•æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œåˆ™åŠ¨ä½œå°±é’ˆå¯¹é‚£æ¡è®°å½•æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ä¸¤ä¸ªç›¸åŒçš„æ ‡å¿—é—´æœ‰æ–‡æœ¬
ï¼ˆå¦‚ @samp{%} ç¬¦å·ï¼‰ï¼Œä¸”æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªè¿™æ ·çš„æ ‡å¿—ï¼Œåˆ™å¿½ç•¥è¿™ä¸¤ä¸ªç¬¦å·ã€‚ç¬¬ä¸€ç§å°è¯•ç»„åˆèŒƒå›´æ¨¡å¼çš„æ–¹å¼æ˜¯æè¿°åˆ†éš”ç¬¦ï¼Œ
ç„¶åè·Ÿç€ @code{next} è¯­å¥ï¼ˆè¿˜æ²¡æœ‰è®¨è®ºåˆ°ï¼Œè¯·çœ‹ @ref{Next Statement}ï¼‰ã€‚
è¿™ä½¿å¾— @command{awk} ä¼šè·³è¿‡å¤„ç†å½“å‰çš„è®°å½•è€Œå¼€å§‹ä¸‹ä¸€ä¸ªè¾“å…¥è®°å½•ã€‚ç¨‹åºçœ‹èµ·æ¥å¦‚ä¸‹ï¼š

@example
/^%$/,/^%$/    @{ next @}
               @{ print @}
@end example

@noindent
@cindex lines, skipping between markers
@c @cindex flag variables
è¿™ä¸ªç¨‹åºä¸ä¼šæˆåŠŸï¼Œå› ä¸ºèŒƒå›´æ¨¡å¼åœ¨åŒ…å« @samp{%} çš„åŒä¸€è¡Œå¼€å¯å¹¶å…³é—­ã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œåº”è¯¥ä½¿ç”¨ä¸€ä¸ªæ ‡å¿—çš„æ–¹å¼æ¥å†™ç¨‹åºï¼š

@cindex @code{!} (exclamation point), @code{!} operator
@example
/^%$/     @{ skip = ! skip; next @}
skip == 1 @{ next @} # skip lines with `skip' set
@end example

åœ¨èŒƒå›´æ¨¡å¼ä¸­ï¼Œé€—å·ï¼ˆ@samp{,}ï¼‰åœ¨æ‰€æœ‰çš„æ“ä½œç¬¦ä¸­å…·æœ‰æœ€ä½çš„ä¼˜å…ˆçº§ï¼ˆå®ƒå°†åœ¨æœ€åè¿›è¡Œæ±‚å€¼ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸‹é¢çš„ç¨‹åºè¯•å›¾ç”¨å¦ä¸€ç§æ›´ç®€å•çš„æµ‹è¯•æ¥ç”ŸæˆèŒƒå›´æ¨¡å¼ï¼š

@example
echo Yes | awk '/1/,/2/ || /Yes/'
@end example

è¿™ä¸ªç¨‹åºçš„æ„å›¾æœ¬æ¥æ˜¯ @samp{(/1/,/2/) || /Yes/} ã€‚
ä½†æ˜¯ @command{awk} å°†å…¶è§£é‡Šæˆäº† @samp{/1/, (/2/ || /Yes/)}ã€‚æ²¡æœ‰åŠæ³•æ”¹å˜æˆ–è€…è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒèŒƒå›´æ¨¡å¼ä¸å¯ä»¥ä¸å…¶ä»–çš„æ¨¡å¼è¿›è¡Œç»„åˆã€‚

@example
$ @kbd{echo Yes | gawk '(/1/,/2/) || /Yes/'}
@error{} gawk: cmd. line:1: (/1/,/2/) || /Yes/
@error{} gawk: cmd. line:1:           ^ syntax error
@end example

@cindex range patterns, line continuation and
ä¸€ä¸ªæœ‰è¶£çš„ç‚¹æ˜¯ï¼Œ POSIX å…è®¸ä½ åœ¨èŒƒå›´æ¨¡å¼çš„é€—å·åé¢è¿›è¡Œæ¢è¡Œï¼Œè™½ç„¶è¿™çœ‹èµ·æ¥ä¸é‚£ä¹ˆå¥½çœ‹ã€‚
@value{DARKCORNER}

@node BEGIN/END
@subsection @code{BEGIN} ä¸ @code{END} ç‰¹æ®Šæ¨¡å¼

@cindex @code{BEGIN} pattern
@cindex @code{END} pattern
åˆ°ç›®å‰ä¸ºæ­¢æ‰€æè¿°çš„æ¨¡å¼éƒ½ç”¨æ¥åŒ¹é…è¾“å…¥è®°å½•ã€‚@code{BEGIN} ä¸ @code{END} ç‰¹æ®Šæ¨¡å¼åˆ™ä¸åŒã€‚å®ƒä»¬ä¸º @command{awk} ç¨‹åºæä¾›å¼€å§‹ä¸ç»“æŸæ“ä½œã€‚
@code{BEGIN} ä¸ @code{END} è§„åˆ™å¿…é¡»æœ‰åŠ¨ä½œã€‚è¿™äº›è§„åˆ™æ²¡æœ‰é»˜è®¤çš„åŠ¨ä½œå› ä¸ºåœ¨è¿è¡Œæ—¶æ²¡æœ‰å½“å‰è®°å½•ã€‚@code{BEGIN} ä¸ @code{END} è§„åˆ™å¸¸å¸¸è¢«é‚£äº›è€çš„ @command{awk} ç¨‹åºå‘˜ç§°ä¸ºâ€œ@code{BEGIN} ä¸ @code{END} å—â€ã€‚

@menu
* Using BEGIN/END::             How and why to use BEGIN/END rules.
* I/O And BEGIN/END::           I/O issues in BEGIN/END rules.
@end menu

@node Using BEGIN/END
@subsubsection å¼€å§‹ä¸ç»“æŸåŠ¨ä½œ

@cindex @code{BEGIN} pattern
@cindex @code{END} pattern
@code{BEGIN} è§„åˆ™åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”æ˜¯åœ¨è¯»å–è®°å½•ä¹‹å‰æ‰§è¡Œã€‚ç›¸åº”åœ°ï¼Œ@code{END} è§„åˆ™ä¹Ÿåªæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰çš„è®°å½•å·²ç»è¯»å–å®Œæˆä¹‹åæ‰§è¡Œã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{awk '}
> @kbd{BEGIN @{ print "Analysis of \"li\"" @}}
> @kbd{/li/  @{ ++n @}}
> @kbd{END   @{ print "\"li\" appears in", n, "records." @}' mail-list}
@print{} Analysis of "li"
@print{} "li" appears in 4 records.
@end example

@cindex @code{BEGIN} pattern, operators and
@cindex @code{END} pattern, operators and
æ­¤ç¨‹åºæŸ¥æ‰¾åœ¨è¾“å…¥æ–‡ä»¶ @file{mail-list} ä¸­ï¼ŒåŒ…å«å­—ä¸² @samp{li} ä¸²çš„è®°å½•ã€‚@code{BEGIN} è§„åˆ™æ‰“å°æŠ¥å‘Šçš„æ ‡é¢˜ã€‚
æ²¡æœ‰å¿…é¡»é€šè¿‡ @code{BEGIN} è§„åˆ™æ¥åˆå§‹åŒ–å˜é‡ @code{n} ä¸ºé›¶ï¼Œ
å› ä¸º @command{awk} ä¼šè‡ªåŠ¨å¤„ç†ï¼ˆæŸ¥çœ‹ @ref{Variables}ï¼‰ã€‚ç¬¬äºŒä¸ªè§„åˆ™æ˜¯å½“è¾“å…¥è®°å½•ä¸­åŒ…å« @samp{li} æ—¶ï¼Œå°±é€’å¢å˜é‡ @code{n}ã€‚
@code{END} è§„åˆ™åœ¨ç¨‹åºæ‰§è¡Œå®Œæˆåï¼Œæ‰“å°å˜é‡ @code{n} çš„å€¼ã€‚

@code{BEGIN} ä¸ @code{END} ç‰¹æ®Šè§„åˆ™ä¸å¯ä»¥ç”¨åœ¨èŒƒå›´è§„åˆ™ä¸­ï¼Œä¹Ÿä¸å¯ä»¥ä¸å¸ƒæ—æ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨ï¼ˆå®é™…ä¸Šï¼Œå®ƒä»¬ä¸å¯ä»¥ä¸ä»»ä½•æ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨ï¼‰ã€‚
ä¸€ä¸ª @command{awk} ç¨‹åºå¯ä»¥æœ‰å¤šä¸ª @code{BEGIN} ä¸/æˆ– @code{END} è§„åˆ™ã€‚å®ƒä»¬ä¼šæŒ‰ç…§å‡ºç°çš„é¡ºåºè¢«æ‰§è¡Œï¼šæ‰€æœ‰çš„ @code{BEGIN} è§„åˆ™åœ¨å¯åŠ¨æ—¶æ‰§è¡Œï¼Œ
è€Œæ‰€æœ‰çš„ @code{END} è§„åˆ™åœ¨ç»“æŸæ—¶æ‰§è¡Œã€‚@code{BEGIN} ä¸ @code{END} è§„åˆ™å¯ä»¥ä¸å…¶ä»–çš„è§„åˆ™äº¤å‰æ··åˆã€‚
è¿™æ ·çš„ç‰¹æ€§æ˜¯åœ¨ @command{awk} çš„ 1987 å¹´çš„ç‰ˆæœ¬è¢«åŠ å…¥ï¼Œå¹¶åŠ å…¥åˆ° POSIX æ ‡å‡†ä¸­ã€‚æœ€å¼€å§‹ï¼ˆ1978ï¼‰çš„ @command{awk} ç‰ˆæœ¬è¦æ±‚ @code{BEGIN} è§„åˆ™è¦æ”¾åœ¨ç¨‹åºçš„å¼€å§‹å¤„ï¼Œ@code{END} è§„åˆ™åˆ™éœ€è¦æ”¾åœ¨ç¨‹åºçš„ç»“å°¾å¤„ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ç›®å‰ä¸å†éœ€è¦è¿™æ ·ï¼Œä½†æ˜¯æŒ‰ç…§è¿™æ ·çš„æ¨¡æ¿æ¥å†™ç¨‹åºå´æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ä½¿ç¨‹åºç»„ç»‡å¾—æ›´å¥½ï¼Œå¹¶ä¸”å¢å¼ºå¯è¯»æ€§ã€‚

å¤šä¸ª @code{BEGIN} ä¸ @code{END} è§„åˆ™åœ¨å†™åº“å‡½æ•°çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºæ¯ä¸ªåº“æ–‡ä»¶éƒ½å¯ä»¥æœ‰å®ƒä»¬è‡ªå·±çš„ @code{BEGIN} ä¸/æˆ– @code{END} è§„åˆ™æ¥å¤„ç†åˆå§‹åŒ–ä¸/æˆ–ç»“æŸå·¥ä½œã€‚åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„åº“å‡½æ•°çš„åå­—ï¼Œå¯ä»¥æ§åˆ¶ä¸å…¶ç›¸å…³çš„ @code{BEGIN} ä¸ @code{END} è§„åˆ™æ‰§è¡Œçš„é¡ºåºã€‚å› æ­¤ï¼Œä½ è¦ä»”ç»†åœ°å¤„ç†åº“æ–‡ä»¶ä¸­çš„è¿™äº›è§„åˆ™ï¼Œä½¿å¾—å®ƒä»¬çš„æ‰§è¡Œé¡ºåºä¸ä¼šå¸¦æ¥å½±å“ã€‚
æŸ¥çœ‹ @ref{Options}ï¼Œæ¥è·å–æ›´å¤šçš„ä½¿ç”¨åº“å‡½æ•°çš„ç›¸å…³ä¿¡æ¯ã€‚æŸ¥çœ‹ @ref{Library Functions}ã€‚

å¦‚æœ @command{awk} åªæœ‰ @code{BEGIN} è§„åˆ™è€Œæ²¡æœ‰å…¶ä»–çš„è§„åˆ™ï¼Œåˆ™ç¨‹åºåœ¨æ‰§è¡Œäº† @code{BEGIN} è§„åˆ™ä¹‹åå°±é€€å‡ºäº†ã€‚ ä½†æ˜¯ï¼Œ
å¦‚æœ @code{END} è§„åˆ™å­˜åœ¨ï¼Œåˆ™è¾“å…¥ä¼šè¢«è¯»å–ï¼Œå°±ç®—ç¨‹åºä¸­æ²¡æœ‰å…¶ä»–çš„è§„åˆ™å­˜åœ¨ã€‚å› ä¸ºå¦‚æœåœ¨ @code{END} è§„åˆ™ä¸­æ£€æŸ¥ @code{FNR} ä¸ @code{NR} å˜é‡ï¼Œå› æ­¤è¿™ä¹ˆåšå°±æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚

@node I/O And BEGIN/END
@subsubsection @code{BEGIN} ä¸ @code{END} è§„åˆ™ä¸­çš„è¾“å…¥è¾“å‡º


@cindex input/output, from @code{BEGIN} and @code{END}
åœ¨ @code{BEGIN} ä¸ @code{END} è§„åˆ™ä¸­è¿›è¡Œ I/O æ“ä½œæ—¶ï¼Œè¦æ³¨æ„å‡ ç‚¹ï¼ˆå…¶ä¸­çš„æŸäº›è¿˜æ¯”è¾ƒå¾®å¦™ï¼‰ã€‚
é¦–å…ˆè¦å…³æ³¨çš„æ˜¯åœ¨ @code{BEGIN} ä¸­ @code{$0} çš„å€¼ã€‚ç”±äº @code{BEGIN} çš„æ‰§è¡Œåœ¨ä»»ä½•çš„è¾“å…¥ä¹‹å‰ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡æœ‰è¾“å…¥è®°å½•ï¼Œä¹Ÿæ²¡æœ‰åŸŸã€‚
å¯¹äº @code{$0} ä»¥åŠåŸŸçš„è®¿é—®éƒ½å°†äº§ç”Ÿç©ºä¸²æˆ–è€… 0 å€¼ï¼Œè¿™è§†ä¸Šä¸‹æ–‡çš„æƒ…å†µã€‚
è¦ä½¿ @code{$0} ä¸­æœ‰å®å€¼ï¼Œå¯ä»¥ä»¥ä¸å¸¦å˜é‡çš„å½¢å¼æ‰§è¡Œ @code{getline}ï¼ˆæŸ¥çœ‹ @ref{Getline}ï¼‰ã€‚å¦ä¸€ä¸ªæ–¹å¼å°±æ˜¯ç»™ @code{$0} èµ‹å€¼ã€‚

@cindex Brian Kernighan's @command{awk}
@cindex differences in @command{awk} and @command{gawk}, @code{BEGIN}/@code{END} patterns
@cindex POSIX @command{awk}, @code{BEGIN}/@code{END} patterns
@cindex @code{print} statement, @code{BEGIN}/@code{END} patterns and
@cindex @code{BEGIN} pattern, @code{print} statement and
@cindex @code{END} pattern, @code{print} statement and
ç¬¬äºŒç‚¹åˆ™è·Ÿç¬¬ä¸€ç‚¹æœ‰ç‚¹ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯åœ¨å¦ä¸€ä¸ªæ–¹å‘ä¸Šã€‚ä¼ ç»Ÿä¸Šï¼Œå¤§éƒ¨ä»½æ˜¯ç”±äºå®ç°çš„é—®é¢˜ï¼Œ
@code{$0} ä¸ @code{NF} åœ¨ @code{END} è§„åˆ™ä¸­éƒ½æ˜¯@emph{æœªå®šä¹‰}çš„ã€‚
POSIX æ ‡å‡†æŒ‡å‡º @code{NF} åœ¨ @code{END} è§„åˆ™ä¸­æ˜¯å¯ç”¨çš„ã€‚å®ƒåŒ…å«çš„æ˜¯æœ€åä¸€è¡Œè®°å½•ä¸­çš„åŸŸæ•°ç›®ã€‚å¾ˆå¤§å¯èƒ½æ˜¯ç”±äºç–å¿½ï¼Œåœ¨æ ‡å‡†ä¸­å´æ²¡æœ‰è¯´ä¹Ÿè¦ä¿ç•™ @code{$0} çš„å€¼ï¼Œå°½ç®¡åœ¨é€»è¾‘ä¸Šå¤§å®¶éƒ½è®¤ä¸ºæ˜¯è¯¥ä¿ç•™ä¸‹æ¥çš„ã€‚äº‹å®ä¸Šï¼Œæ‰€æœ‰çš„ BMW @command{awk}ï¼Œ@command{mawk}ï¼Œä»¥åŠ @command{gawk} éƒ½åœ¨ @code{END} è§„åˆ™ä¸­ä¿ç•™äº† @code{$0} çš„å€¼ã€‚ä½†æ˜¯ä¹Ÿè¦æ³¨æ„ï¼Œä¸€äº›å…¶ä»–çš„å®ç°ï¼Œä¸ä¸€äº›æ—§ç‰ˆæœ¬çš„ UNIX @command{awk} ç‰ˆæœ¬å´æ²¡æœ‰è¿™ä¹ˆå¤„ç†ã€‚

ç¬¬ä¸‰ç‚¹ï¼Œåˆ™æ˜¯å‰é¢ä¸¤ç‚¹çš„å»¶ç»­ã€‚åœ¨ @code{BEGIN} ä¸ @code{END} è§„åˆ™ä¸­çš„ @code{print} çš„å«ä¹‰æ€»æ˜¯ä¸€æ ·çš„ï¼š
@samp{print $0} ã€‚å¦‚æœ @code{$0} çš„å€¼æ˜¯ç©ºä¸²ï¼Œåˆ™æ‰“å°ä¸€ä¸ªç©ºçš„è®°å½•ã€‚
å¾ˆå¤šä½¿ç”¨ @command{awk} å¾ˆé•¿æ—¶é—´çš„ç¨‹åºå‘˜åœ¨ @code{BEGIN} ä¸ @code{END} è§„åˆ™ä¸­ä½¿ç”¨è¿™ç§å…‰å¤´ @code{print} æ¥è¡¨ç¤º @samp{@w{print ""}}ï¼Œ
è¿™ä¾èµ–äº @code{$0} çš„å€¼ä¸ºç©ºä¸²ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨ @code{BEGIN} è§„åˆ™ä¸­å¯ä»¥å®ç°è¿™æ ·çš„æ„å›¾ï¼Œä½†æ˜¯è‡³å°‘åœ¨ @command{gawk} ä¸­ï¼Œåœ¨ @code{END} è§„åˆ™ä¸­è¿™ä¹ˆå†™æ˜¯ä¸€ä¸ªåä¸»æ„ã€‚åŒæ—¶è¿™ä¹ˆå†™ä¹Ÿæ˜¯ä¸€ç§å¾ˆè¹©è„šçš„é£æ ¼ï¼Œå› ä¸ºå¦‚æœç¡®å®éœ€è¦è¾“å‡ºä¸€ä¸ªç©ºä¸²ï¼Œä½ å°±åœ¨æ˜¾å¼åœ°è¿›è¡Œæ‰“å°å°±å¯ä»¥äº†ã€‚

@cindex @code{next} statement, @code{BEGIN}/@code{END} patterns and
@cindex @code{nextfile} statement, @code{BEGIN}/@code{END} patterns and
@cindex @code{BEGIN} pattern, @code{next}/@code{nextfile} statements and
@cindex @code{END} pattern, @code{next}/@code{nextfile} statements and
æœ€åï¼Œ@code{next} ä¸ @code{nextfile} è¯­å¥åœ¨ @code{BEGIN} è§„åˆ™ä¸­æ˜¯ä¸å…è®¸ä½¿ç”¨çš„ï¼Œ
å› ä¸ºéšå¼çš„ read-a-record-and-match-against-the-rules å¾ªç¯éƒ½è¿˜æ²¡æœ‰å¼€å§‹å‘¢ã€‚
ç›¸ä¼¼çš„ï¼Œè¿™æ ·çš„è¯­å¥åœ¨ @code{END} è§„åˆ™ä¸­ä¹Ÿæ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºè¾“å…¥å·²ç»å®Œæˆã€‚ï¼ˆæŸ¥çœ‹ @ref{Next Statement} ï¼Œä¸
@ifnotdocbook
 @ref{Nextfile Statement}ã€‚ï¼‰
@end ifnotdocbook
@ifdocbook
 @ref{Nextfile Statement}ã€‚ï¼‰
@end ifdocbook

@node BEGINFILE/ENDFILE
@subsection @code{BEGINFILE} ä¸ @code{ENDFILE} ç‰¹æ®Šæ¨¡å¼
@cindex @code{BEGINFILE} pattern
@cindex @code{ENDFILE} pattern
@cindex differences in @command{awk} and @command{gawk}, @code{BEGINFILE}/@code{ENDFILE} patterns

æœ¬@value{SECTION}ä¸­æè¿°çš„æ˜¯ @command{gawk} çš„ç‰¹æ€§ã€‚

æœ‰ä¸¤ç§ç‰¹æ®Šçš„è§„åˆ™ï¼Œå³ @code{BEGINFILE} ä¸ @code{ENDFILE}ï¼Œå¯ä»¥è®©ä½ åœ¨å‘½ä»¤è¡ŒæŒ‡å®šçš„æ–‡ä»¶å¤„ç†è¿‡ç¨‹ä¸­æ‰“å…¥â€œå‹¾å­â€ã€‚
ä¸ @code{BEGIN} è·Ÿ @code{END} ç±»ä¼¼
@ifnottex
@ifnotdocbook
ï¼ˆæŸ¥çœ‹ @ref{BEGIN/END}ï¼‰ï¼Œ
@end ifnotdocbook
@end ifnottex
@iftex
ï¼ˆæŸ¥çœ‹å‰@value{SECTION}ï¼‰ï¼Œ
@end iftex
@ifdocbook
ï¼ˆæŸ¥çœ‹å‰@value{SECTION}ï¼‰ï¼Œ
@end ifdocbook
ç¨‹åºä¸­çš„æ‰€æœ‰çš„ @code{BEGINFILE} è§„åˆ™éƒ½ä¼šå®‰æŒ‰ç…§ @command{gawk} è¯»å–çš„é¡ºåºåˆå¹¶èµ·æ¥ï¼Œè€Œæ‰€æœ‰ @code{ENDFILE} è§„åˆ™ä¹Ÿä¼šè¢«åˆå¹¶ã€‚

@code{BEGINFILE} è§„åˆ™çš„æ‰§è¡Œä½“ä¼šåœ¨ @command{gawk} è¯»å–æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½•å‰æ‰§è¡Œã€‚@code{FILENAME} å°†è¢«è®¾ç½®æˆå½“å‰æ–‡ä»¶çš„åå­—ï¼Œ@code{FNR} ä¼šè¢«è®¾ç½®æˆ 0ã€‚

@code{BEGINFILE} ä¸ºä½ æä¾›äº†å®Œæˆä¸¤ä¸ªä»»åŠ¡çš„ä¸€ä¸ªæœºä¼šï¼Œè¿™äº›ä»»åŠ¡å¦‚æœæ²¡æœ‰è¿™ä¸ªæœºåˆ¶æ˜¯ä¸å¯èƒ½å®ç°çš„ï¼š

@itemize @value{BULLET}
@item
ä½ å¯ä»¥æµ‹è¯•æ–‡ä»¶æ˜¯å¦å¯è¯»ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœå‘½ä»¤è¡Œä¸ŠæŒ‡å®šçš„æ–‡ä»¶æ— æ³•æ‰“å¼€è¯»å–æ˜¯ä¸€ä¸ªè‡´ä½¿é”™è¯¯ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ç»•è¿‡è¿™æ ·çš„è‡´ä½¿é”™è¯¯ï¼Œå¹¶ç§»åŠ¨åˆ°å‘½ä»¤è¡Œä¸­çš„ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚

@cindex @command{gawk}, @code{ERRNO} variable in
@cindex @code{ERRNO} variable, with @code{BEGINFILE} pattern
@cindex @code{nextfile} statement, @code{BEGINFILE}/@code{ENDFILE} patterns and
ä½ å¯ä»¥æ£€æŸ¥ @code{ERRNO} çš„å€¼ä¸æ˜¯ä¸€ä¸ªç©ºå€¼ï¼Œå¦‚æœéç©ºï¼Œå°±è¡¨ç¤º @command{gawk} æ²¡åŠæ³•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ã€‚
æ­¤æ—¶ï¼Œä½ çš„ç¨‹åºå¯ä»¥æ‰§è¡Œ @code{nextfile} è¯­å¥ï¼ˆæŸ¥çœ‹ @ref{Nextfile Statement}ï¼‰ã€‚
è¿™ä½¿å¾— @command{gawk} å¯ä»¥å®Œæ•´åœ°è·³è¿‡è¿™ä¸ªæ–‡ä»¶ã€‚å¦åˆ™ï¼Œ@command{gawk} é‡åˆ°è‡´å‘½é”™è¯¯æ—¶ä¼šé€€å‡ºã€‚

@item
å¦‚æœä½ ç¼–å†™äº†ä¿®æ”¹è®°å½•å¤„ç†æ–¹å¼çš„æ‰©å±•ï¼ˆé€šè¿‡æ’å…¥ä¸€ä¸ªâ€œè¾“å…¥åˆ†æå™¨â€ï¼ŒæŸ¥çœ‹ @ref{Input Parsers}ï¼‰ï¼Œ
ä½ å°±å¯ä»¥åœ¨è¿™ä¸ªç‚¹ä¸Šï¼Œåœ¨å¤„ç†æ–‡ä»¶ä¹‹å‰è°ƒç”¨å®ƒä»¬ã€‚ï¼ˆè¿™æ˜¯ä¸€ä¸ª@emph{éå¸¸}é«˜çº§çš„ç‰¹æ€§ï¼Œå½“å‰åªè¢« @uref{http://sourceforge.net/projects/gawkextlib, @code{gawkextlib} é¡¹ç›®} ä½¿ç”¨ã€‚ï¼‰
@end itemize

@code{ENDFILE} è§„åˆ™ä¼šåœ¨ @command{gawk} å¤„ç†å®Œä¸€ä¸ªæ–‡ä»¶çš„è¾“å…¥åæ‰§è¡Œã€‚å¯¹äºæœ€åä¸€ä¸ªè¾“å…¥æ–‡ä»¶ï¼Œå®ƒå°†ä¼šåœ¨è°ƒç”¨ @code{END} ä¹‹å‰è¿›è¡Œè°ƒç”¨ã€‚
@code{ENDFILE} å°±ç®—æ˜¯é’ˆå¯¹ç©ºæ–‡ä»¶ä¹Ÿä¼šæ‰§è¡Œã€‚

æ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œå½“é”™è¯¯å‡ºç°åœ¨æ­£å¸¸çš„è¾“å…¥å¤„ç†å¾ªç¯ä¸­çš„è¯»å–æ—¶ï¼Œé”™è¯¯å°±ä¼šæ˜¯è‡´å‘½çš„ï¼Œ
å¦‚æœæä¾›äº† @code{ENDFILE} è§„åˆ™ï¼Œè¿™æ ·çš„é”™è¯¯å°±ä¸å†æ˜¯è‡´å‘½çš„ï¼Œåªæ˜¯ @code{ERRNO} è¢«è®¾ç½®è€Œå·²ã€‚è¿™ä½¿å¾—èƒ½å¤Ÿåœ¨ @command{awk} ç¨‹åºä¸€çº§æ•è·åˆ°å¤„ç† I/O çš„é”™è¯¯ã€‚

@cindex @code{next} statement, @code{BEGINFILE}/@code{ENDFILE} patterns and
@code{next} è¯­å¥ï¼ˆæŸ¥çœ‹ @ref{Next Statement}ï¼‰ä¸å‡†ä½¿ç”¨åœ¨ @code{BEGINFILE} æˆ–è€… @code{ENDFILE} è§„åˆ™ä¸­ã€‚
è€Œ @code{nextfile} åªå¯ä»¥ä½¿ç”¨åœ¨ @code{BEGINFILE} è§„åˆ™ä¸­ï¼Œè€Œä¸èƒ½ä½¿ç”¨åœ¨ @code{ENDFILE} è§„åˆ™ä¸­ã€‚

@cindex @code{getline} statement, @code{BEGINFILE}/@code{ENDFILE} patterns and
@code{getline} è¯­å¥ï¼ˆæŸ¥çœ‹ @ref{Getline}ï¼‰åœ¨ @code{BEGINFILE} å’Œ @code{ENDFILE} ä¸¤ä¸ªè§„åˆ™ä¸­éƒ½è¢«é™åˆ¶ä½¿ç”¨ï¼šåªæœ‰é‡å®šå‘å½¢å¼çš„ @code{getline} å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨ã€‚

@code{BEGINFILE} ä¸ @code{ENDFILE} æ˜¯ @command{gawk} çš„æ‰©å±•ã€‚åœ¨å¤šæ•°çš„ @command{awk} å®ç°ä¸­ï¼Œæˆ–è€… @command{gawk} çš„å…¼å®¹æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œå®ƒä»¬æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ã€‚

@c FIXME: For 4.2 maybe deal with this?
@ignore
Date:     Tue, 17 May 2011 02:06:10 PDT
From:     rankin@pactechdata.com (Pat Rankin)
Message-Id: <110517015127.20240f4a@pactechdata.com>
Subject:  BEGINFILE
To:       arnold@skeeve.com

     The documentation for BEGINFILE states that FNR is 0, which seems
pretty obvious.  It doesn't mention what the value of $0 is, and that's
not obvious.  I think setting it to null before starting the BEGINFILE
action would be preferable to leaving whatever was there in the last
record of the previous file.

     ENDFILE can retain the last record in $0.  I guess it has to if
the END rule's actions see that value too.  But the beginning of a new
file doesn't just mean that the old one has been closed; the old file
is being superseded, so leaving the old data around feels wrong to me.
[If the user wants to keep it on hand, he or she can use an ENDFILE
rule to grab it before moving on to the next file.]
@end ignore

@node Empty
@subsection ç©ºæ¨¡å¼

@cindex empty pattern
@cindex patterns, empty
ä¸€ä¸ªç©ºæ¨¡å¼ï¼ˆå¦‚ä¸å­˜åœ¨æ¨¡å¼ï¼‰è¢«è§†ä¸ºåŒ¹é…@emph{æ‰€æœ‰çš„}è¾“å…¥è®°å½•ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºï¼š

@example
awk '@{ print $1 @}' mail-list
@end example

@noindent
æ‰“å°æ¯ä¸€ä¸ªè®°å½•çš„ç¬¬ä¸€ä¸ªåŸŸã€‚

@node Using Shell Variables
@section åœ¨ç¨‹åºä¸­ä½¿ç”¨ Shell å˜é‡
@cindex shells, variables
@cindex @command{awk} programs, shell variables in
@c @cindex shell and @command{awk} interaction

@command{awk} ç¨‹åºå¸¸ç”¨äºä¸€ä¸ªç”¨ Shell å†™æˆçš„å¤§ç¨‹åºä¸­çš„ä¸€ä¸ªç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸€ä¸ª Shell å˜é‡æ¥å­˜æ”¾ @command{awk} ç¨‹åºè¦æœç´¢çš„æ¨¡å¼ã€‚æœ‰ä¸¤ä¸ªæ–¹å¼æ¥å–å¾— Shell å˜é‡çš„å€¼ï¼Œå¹¶æ’å…¥åˆ° @command{awk} ç¨‹åºä¸­ã€‚

@cindex shells, quoting
ä¸€ç§é€šç”¨çš„æ–¹å¼æ˜¯ä½¿ç”¨ Shell å¼•å·æ¥åœ¨è„šæœ¬ä¸­æ›¿ä»£å˜é‡çš„å€¼ï¼Œç”±æ­¤æ¥æ’å…¥åˆ°ç¨‹åºä¸­ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºï¼š

@example
printf "Enter search pattern: "
read pattern
awk "/$pattern/ "'@{ nmatches++ @}
     END @{ print nmatches, "found" @}' /path/to/data
@end example

@noindent
@command{awk} ç¨‹åºå°†å¼•å·æ–‡æœ¬çš„ç‰‡æ®µè§†ä½œä¸ºè¿æ¥æ“ä½œæ¥å½¢æˆç¨‹åºã€‚ç¬¬ä¸€éƒ¨åˆ†å°±è¢«åŒå¼•å·å¼•èµ·æ¥ï¼Œè¿™å…è®¸ä½¿ç”¨ Shell å˜é‡ @code{pattern} ä½œä¸ºæ›¿ä»£ã€‚
ç¬¬äºŒéƒ¨åˆ†æ˜¯å•å¼•å·çš„éƒ¨åˆ†ã€‚

é€šè¿‡å¼•å·æ–¹å¼çš„å˜é‡æ›¿æ¢è™½ç„¶å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯æœ‰å¯èƒ½å¯¼è‡´æ½œåœ¨çš„æ··ä¹±ã€‚è¿™éœ€è¦å¯¹ Shell çš„å¼•å·è§„åˆ™æœ‰æ¯”è¾ƒå¥½çš„ç†è§£ï¼ˆæŸ¥çœ‹ @ref{Quoting}ï¼‰ï¼Œ
å¹¶ä¸”å½“è¯»å–ç¨‹åºï¼ŒåŒ¹é…å¼•å·çš„æ—¶å€™ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚

æ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ @command{awk} çš„å˜é‡èµ‹å€¼ç‰¹æ€§ï¼ˆæŸ¥çœ‹ @ref{Assignment Options}ï¼‰æ¥å°† Shell å˜é‡çš„å€¼èµ‹ç»™ @command{awk} å˜é‡ã€‚
ç„¶åä½¿ç”¨åŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ¨¡å¼ï¼ˆæŸ¥çœ‹ @ref{Computed Regexps}ï¼‰ã€‚ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºä½¿ç”¨è¿™ä¸ªæŠ€å·§æ¥é‡å†™ä¸Šé¢çš„åŠŸèƒ½ï¼š

@example
printf "Enter search pattern: "
read pattern
awk -v pat="$pattern" '$0 ~ pat @{ nmatches++ @}
       END @{ print nmatches, "found" @}' /path/to/data
@end example

@noindent
ç°åœ¨ï¼Œ@command{awk} ç¨‹åºåªéœ€è¦å•å¼•å·çš„ä¸²ã€‚èµ‹å€¼æ“ä½œ @samp{-v pat="$pattern"} è¿˜æ˜¯éœ€è¦åŒå¼•å·çš„ï¼Œä»¥é˜²æ­¢åœ¨ @code{$pattern} çš„å€¼ä¸­å‡ºç°ç©ºæ ¼ã€‚
@command{awk} å˜é‡ @code{pat} ä¹Ÿå¯ä»¥ä½¿ç”¨åå­— @code{pattern}ï¼Œ
ä½†æ˜¯çœ‹èµ·æ¥å°±ä»¤äººæ¯”è¾ƒå›°æƒ‘å¾—å¤šã€‚ä½¿ç”¨å˜é‡çš„æ–¹å¼ä¹Ÿæä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå› ä¸ºå˜é‡å¯ä»¥åœ¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨â€”â€”ç”¨äºæ‰“å°ã€ä½œä¸ºæ•°ç»„ä¸‹æ ‡ï¼Œæˆ–è€…å…¶ä»–çš„ç”¨é€”â€”â€”å¹¶ä¸”ä¸éœ€è¦åœ¨ä½¿ç”¨çš„åœ°æ–¹ä½¿ç”¨åŒå¼•å·ã€‚

@node Action Overview
@section åŠ¨ä½œ
@c @cindex action, definition of
@c @cindex curly braces
@c @cindex action, curly braces
@c @cindex action, separating statements
@cindex actions

@command{awk} ç¨‹åºæˆ–è€…è„šæœ¬ç”±ä¸€è¿ä¸²çš„è§„åˆ™ä¸å‡½æ•°å®šä¹‰äº¤å‰å½¢æˆã€‚ï¼ˆå‡½æ•°ä¼šåœ¨åé¢è®ºåŠã€‚æŸ¥çœ‹ @ref{User-defined}ï¼‰è§„åˆ™ä¸­åŒ…å«äº†æ¨¡å¼ä¸åŠ¨ä½œï¼Œä¸¤è€…ä¹‹ä¸€å¯ä»¥çœç•¥ï¼Œä½†ä¸å¯ä»¥éƒ½çœç•¥ã€‚
@dfn{åŠ¨ä½œ}çš„ç›®çš„æ˜¯å‘ŠçŸ¥ @command{awk} åœ¨æŸä¸ªæ¨¡å¼è¢«æ‰¾åˆ°åå¦‚ä½•æ‰§è¡Œã€‚å› æ­¤ï¼Œæ¦‚æ‹¬èµ·æ¥ï¼Œ@command{awk} ç¨‹åºçœ‹èµ·æ¥éƒ½åƒè¿™æ ·ï¼š

@display
[@var{pattern}]  @code{@{ @var{action} @}}
 @var{pattern}  [@code{@{ @var{action} @}}]
@dots{}
@code{function @var{name}(@var{args}) @{ @dots{} @}}
@dots{}
@end display

@cindex @code{@{@}} (braces), actions and
@cindex braces (@code{@{@}}), actions and
@cindex separators, for statements in actions
@cindex newlines, separating statements in actions
@cindex @code{;} (semicolon), separating statements in actions
@cindex semicolon (@code{;}), separating statements in actions
åŠ¨ä½œç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ª @command{awk} @dfn{è¯­å¥}ç»„æˆï¼Œå¹¶ä¸”ç”±èŠ±æ‹¬å·åŒ…èµ·æ¥ï¼ˆ@samp{@{@r{@dots{}}@}}ï¼‰ã€‚
æ¯æ¡è¯­å¥éƒ½æŒ‡å®šäº†ä¸€ä¸ªè¦å¤„ç†çš„è¿‡ç¨‹ã€‚è¯­å¥ç”±æ¢è¡Œç¬¦æˆ–è€…åˆ†å·åˆ†éš”ã€‚
åŠ¨ä½œä¸¤è¾¹çš„èŠ±æ‹¬å·æ˜¯å¿…é¡»ä½¿ç”¨çš„ï¼Œå°±ç®—åªæœ‰ä¸€ä¸ªè¯­å¥ï¼Œç”šè‡³æ²¡æœ‰è¯­å¥ä¹Ÿä¸€æ ·ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æ•´ä¸ªåœ°çœç•¥äº†åŠ¨ä½œï¼Œä¹Ÿè¦çœç•¥èŠ±æ‹¬å·ã€‚
çœç•¥åŠ¨ä½œä¸ @samp{@{ print $0 @}} ç­‰åŒã€‚

@example
/foo/  @{ @}     @ii{match @code{foo}, do nothing --- empty action}
/foo/          @ii{match @code{foo}, print the record --- omitted action}
@end example

@command{awk} æ”¯æŒä¸‹é¢çš„è¯­å¥ç±»å‹ï¼š

@table @asis
@cindex side effects, statements
@item è¡¨è¾¾å¼
è°ƒç”¨å‡½æ•°æˆ–è€…èµ‹å€¼ç»™å˜é‡ï¼ˆæŸ¥çœ‹ @ref{Expressions}ï¼‰ã€‚
è¿™ç±»å‹è¯­å¥çš„æ‰§è¡Œå°±æ˜¯ç®€å•åœ°æ±‚å€¼ã€‚å¦‚æœè¡¨è¾¾å¼æœ‰å‰¯ä½œç”¨ï¼Œè¿™å°±éå¸¸æœ‰ç”¨ï¼ˆæŸ¥çœ‹ @ref{Assignment Ops}ï¼‰ã€‚

@item æ§åˆ¶è¯­å¥
æŒ‡å®š @command{awk} ç¨‹åºçš„æ§åˆ¶æµã€‚@command{awk} è¯­è¨€å¯ä»¥è®©ä½ å†™ C é£æ ¼çš„ç»“æ„ï¼ˆ@code{if}ï¼Œ@code{for}ï¼Œ@code{while}ï¼Œä»¥åŠ @code{do}ï¼‰ï¼Œ
ä¹Ÿæœ‰ä¸€äº›è‡ªå·±ç‰¹æ®Šçš„ç»“æ„ï¼ˆæŸ¥çœ‹ @ref{Statements}ï¼‰ã€‚

@item å¤åˆè¯­å¥
åŒ…æ‹¬åœ¨èŠ±æ‹¬å·ä¸­ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¯­å¥ã€‚å¤åˆè¯­å¥ç”¨äºåœ¨ @code{if}ï¼Œ@code{while}ï¼Œ@code{do}ï¼Œæˆ–è€… @code{for} çš„è¯­å¥ä½“ä¸­ï¼Œå°†å‡ ä¸ªè¯­å¥é¡ºåºåœ°æ”¾åœ¨ä¸€èµ·ã€‚

@item è¾“å…¥è¯­å¥
ä½¿ç”¨ @code{getline} å‘½ä»¤ï¼ˆæŸ¥çœ‹ @ref{Getline}ï¼‰ã€‚
åœ¨ @command{awk} ä¸­ä¹Ÿæä¾› @code{next} è¯­å¥ï¼ˆæŸ¥çœ‹ @ref{Next Statement}ï¼‰ä¸ @code{nextfile} è¯­å¥ï¼ˆæŸ¥çœ‹ @ref{Nextfile Statement}ï¼‰ã€‚

@item è¾“å‡ºè¯­å¥
å¦‚ @code{print} ä¸ @code{printf}ï¼ŒæŸ¥çœ‹ @ref{Printing}ã€‚

@item åˆ é™¤è¯­å¥
ç”¨äºåˆ é™¤æ•°ç»„å…ƒç´ ã€‚æŸ¥çœ‹ @ref{Delete}ã€‚
@end table

@node Statements
@section åŠ¨ä½œä¸­çš„æ§åˆ¶è¯­å¥
@cindex control statements
@cindex statements, control, in actions
@cindex actions, control statements in

å¦‚ @code{if}ï¼Œ@code{while} ç­‰ç­‰çš„@dfn{æ§åˆ¶è¯­å¥}ï¼Œç”¨æ¥æ§åˆ¶ @command{awk} ç¨‹åºçš„æ‰§è¡Œæµã€‚å¤§å¤šæ•°çš„ @command{awk} æ§åˆ¶è¯­å¥éƒ½æ˜¯ä½¿ç”¨ä¸ C ç±»ä¼¼çš„æ¨¡å¼ã€‚

@cindex compound statements@comma{} control statements and
@cindex statements, compound@comma{} control statements and
@cindex body, in actions
@cindex @code{@{@}} (braces), statements, grouping
@cindex braces (@code{@{@}}), statements, grouping
@cindex newlines, separating statements in actions
@cindex @code{;} (semicolon), separating statements in actions
@cindex semicolon (@code{;}), separating statements in actions
æ‰€æœ‰çš„æ§åˆ¶è¯­å¥éƒ½ä»¥ä¸€ä¸ªç‰¹æ®Šå…³é”®è¯å¼€å§‹ï¼Œå¦‚ @code{if} ä¸ @code{while} ç­‰ï¼Œä»¥å°†å®ƒä»¬ä¸ä¸€èˆ¬çš„è¡¨è¾¾å¼è¿›è¡ŒåŒºåˆ†ã€‚å¾ˆå¤šçš„æ§åˆ¶è¯­å¥è¿˜åŒ…å«å…¶ä»–çš„è¯­å¥ã€‚
ä¾‹å¦‚ï¼Œ@code{if} è¯­å¥åŒ…å«å…¶ä»–çš„è¯­å¥ï¼Œå¯èƒ½æ‰§è¡Œä¹Ÿå¯èƒ½ä¸æ‰§è¡Œã€‚
è¢«åŒ…å«çš„è¯­å¥ç§°ä¸ºç›¸åº”è¯­å¥çš„@dfn{è¯­å¥ä½“}ã€‚ä¸ºäº†åœ¨è¯­å¥ä½“ä¸­åŒ…å«å¤šäºä¸€ä¸ªè¯­å¥ï¼Œåˆ™å°†ä»–ä»¬åŒ…å«åœ¨ä¸€ä¸ªæœ‰èŠ±æ‹¬å·çš„@dfn{å¤åˆè¯­å¥}ä¸­ï¼Œ
å°†é€šè¿‡æ¢è¡Œæˆ–è€…åˆ†å·æ¥åˆ†éš”å®ƒä»¬ã€‚

@menu
* If Statement::                Conditionally execute some @command{awk}
                                statements.
* While Statement::             Loop until some condition is satisfied.
* Do Statement::                Do specified action while looping until some
                                condition is satisfied.
* For Statement::               Another looping statement, that provides
                                initialization and increment clauses.
* Switch Statement::            Switch/case evaluation for conditional
                                execution of statements based on a value.
* Break Statement::             Immediately exit the innermost enclosing loop.
* Continue Statement::          Skip to the end of the innermost enclosing
                                loop.
* Next Statement::              Stop processing the current input record.
* Nextfile Statement::          Stop processing the current file.
* Exit Statement::              Stop execution of @command{awk}.
@end menu

@node If Statement
@subsection @code{if}-@code{else} è¯­å¥

@cindex @code{if} statement
@code{if}-@code{else} è¯­å¥æ˜¯ @command{awk} çš„â€œå†³ç­–-æ‰§è¡Œâ€è¯­å¥ï¼Œçœ‹èµ·æ¥å¦‚ä¸‹ï¼š

@display
@code{if (@var{condition}) @var{then-body}} [@code{else @var{else-body}}]
@end display

@noindent
@var{condition} æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”¨æ¥æ§åˆ¶åé¢çš„è¯­å¥çš„æ‰§è¡Œã€‚å¦‚æœ @var{condition} ä¸º trueï¼Œåˆ™æ‰§è¡Œ @var{then-body} çš„éƒ¨åˆ†ï¼Œ
å¦åˆ™æ‰§è¡Œ @var{else-body} çš„éƒ¨åˆ†ã€‚
è¿™ä¸ªè¯­å¥çš„ @code{else} éƒ¨åˆ†æ˜¯å¯é€‰çš„ã€‚@var{condition} çš„å€¼å¦‚æœä¸º 0 æˆ–è€…ä¸ºç©ºä¸²ï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯ falseï¼Œå…¶ä»–æƒ…å†µåˆ™ä¸º trueã€‚å‚è€ƒå¦‚ä¸‹ï¼š

@example
if (x % 2 == 0)
    print "x is even"
else
    print "x is odd"
@end example

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœè¡¨è¾¾å¼ @samp{x % 2 == 0} ä¸ºçœŸï¼ˆæ¯”å¦‚ï¼Œx çš„å€¼æ˜¯å¶æ•°ï¼Œå¯è¢« 2 æ•´é™¤ï¼‰ï¼Œåˆ™ç¬¬ä¸€ä¸ª @code{print} è¯­å¥è¢«æ‰§è¡Œï¼Œ
å¦åˆ™ï¼Œå°±æ‰§è¡Œç¬¬äºŒä¸ª @code{print} è¯­å¥ã€‚å¦‚æœ @code{else} å…³é”®è¯ä¸ @var{then-body} å‡ºç°åœ¨ä¸€è¡Œä¸­ï¼Œ
å¹¶ä¸” @var{then-body} ä¸æ˜¯ä¸€ä¸ªå¤åˆè¯­å¥ï¼ˆæ²¡æœ‰è¢«èŠ±æ‹¬å·åŒ…å«ï¼‰ï¼Œåˆ™å¿…é¡»è¦ç”¨åˆ†å·å°† @var{then-body} çš„éƒ¨åˆ†ä¸ @code{else} éƒ¨åˆ†è¿›è¡Œåˆ†éš”ã€‚
å¦‚ï¼Œä¸Šé¢çš„ä¾‹å­ä»£ç å¯ä»¥å†™åœ¨è¿™æ ·ï¼š

@example
if (x % 2 == 0) print "x is even"; else
        print "x is odd"
@end example

@noindent
å¦‚æœæ²¡æœ‰ @samp{;}ï¼Œåˆ™ @command{awk} æ— æ³•è§£é‡Šä¸Šé¢çš„è¯­å¥ï¼Œå› æ­¤ä¼šç”Ÿæˆä¸€ä¸ªè¯­æ³•é”™è¯¯ã€‚åœ¨å®é™…çš„ç¨‹åºä¸­ä¸è¦è¿™ä¹ˆå†™ï¼Œ
å› ä¸ºç¨‹åºçš„äººç±»é˜…è¯»è€…æœ‰å¯èƒ½ä¸ä¼šçœ‹åˆ° @code{else}ï¼Œå› ä¸ºå®ƒæ²¡å‡ºç°åœ¨å®ƒè‡ªå·±æ‰€åº”åœ¨è¡Œçš„ç¬¬ä¸€ä½ç½®ã€‚

@node While Statement
@subsection @code{while} è¯­å¥
@cindex @code{while} statement
@cindex loops
@cindex loops, @code{while}
@cindex loops, See Also @code{while} statement

åœ¨ç¨‹åºä¸­ï¼Œå¾ªç¯æ˜¯ç¨‹åºçš„ä¸€éƒ¨ä»½ï¼Œå¹¶ä¸”å¯è¢«è¿ç»­ä¸¤æ¬¡æˆ–è€…å¤šæ¬¡åœ°æ‰§è¡Œã€‚
@code{while} è¯­å¥æ˜¯ @command{awk} ä¸­æœ€ç®€å•çš„å¾ªç¯è¯­å¥ã€‚åªè¦æ¡ä»¶ä¸º trueï¼Œå°±ä¼šä¸€ç›´é‡å¤æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š

@example
while (@var{condition})
  @var{body}
@end example

@cindex body, in loops
@noindent
@var{body} è¯­å¥ç§°ä¸º@dfn{å¾ªç¯ä½“}ï¼Œè€Œ @var{condition} æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”¨æ¥æ§åˆ¶å¾ªç¯çš„æ‰§è¡Œã€‚
@code{while} è¯­å¥æ‰€åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æµ‹è¯• @var{condition} çš„å€¼ã€‚
å¦‚æœä¸º trueï¼Œåˆ™æ‰§è¡Œè¯­å¥ @var{body}ã€‚
@ifinfo
ï¼ˆå½“è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªéé›¶æ•°å’Œéç©ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ@var{condition} çš„å€¼ä¸º trueã€‚ï¼‰
@end ifinfo
å®Œæˆåï¼Œ@var{condition} ä¼šè¢«å†æ¬¡æµ‹è¯•ï¼Œå¦‚æœä¾ç„¶ä¸º trueï¼Œåˆ™ @var{body} ä¼šå†æ¬¡è¢«æ‰§è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹ä¸€ç›´æŒç»­åˆ° @var{condition} ä¸å†ä¸º trueã€‚
å¦‚æœ @var{condition} ä¸€å¼€å§‹å°±ä¸º falseï¼Œè€Œå¾ªç¯ä½“å°±æ ¹æœ¬ä¸ä¼šæ‰§è¡Œï¼Œ@command{awk} ä¼šç»§ç»­æ‰§è¡Œå¾ªç¯åçš„è¯­å¥ã€‚
ä¸‹é¢çš„ä¾‹å­æ‰“å°æ¯ä¸ªè®°å½•çš„å¤´ä¸‰ä¸ªåŸŸï¼Œä¸€ä¸ªä¸€è¡Œï¼š

@example
awk '
@{
    i = 1
    while (i <= 3) @{
        print $i
        i++
    @}
@}' inventory-shipped
@end example

@noindent
è¿™ä¸ªå¾ªç¯çš„å¾ªç¯ä¼‘æ˜¯ä¸€ä¸ªåŒ…å«åœ¨èŠ±æ‹¬å·ä¸­çš„å¤åˆè¯­å¥ï¼ŒåŒ…å«ä¸¤ä¸ªè¯­å¥ã€‚å¾ªç¯æŒ‰ä¸‹é¢çš„æ–¹å¼æ‰§è¡Œï¼šé¦–å…ˆï¼Œ@code{i} çš„å€¼è¢«è®¾ç½®ä¸º 1ã€‚
ç„¶å @code{while} è¯­å¥ä¼šæµ‹è¯• @code{i} çš„å€¼æ˜¯å¦ä¸ºå°äºç­‰äº 3ã€‚å½“ @code{i} ä¸º 1 æ—¶ï¼Œè¿™è‚¯å®šä¸º trueï¼Œå› æ­¤ç¬¬ @code{i} ä¸ªåŸŸå°±æ‰“å°å‡ºæ¥ã€‚
ç„¶åæ‰§è¡Œ @samp{i++} ï¼Œé€’å¢ @code{i} çš„å€¼ï¼Œå¹¶é‡å¤å¾ªç¯ã€‚å½“ @code{i} ä¸º 4 æ—¶ï¼Œç»“æŸå¾ªç¯ã€‚

åœ¨æ¡ä»¶ä¸å¾ªç¯ä½“ä¹‹é—´çš„æ¢è¡Œä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯ï¼Œä½¿ç”¨æ¢è¡Œä¼šä½¿å¾—ç¨‹åºæ›´åŠ æ¸…æ™°ï¼Œé™¤éå¾ªç¯ä½“æ˜¯ä¸€ä¸ªå¤åˆè¯­å¥æˆ–è€…æ˜¯éå¸¸ç®€å•ã€‚å¼€èŠ±æ‹¬å·åé¢çš„æ¢è¡Œå¼€å¯å¤åˆè¯­å¥ï¼Œä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯ç¨‹åºä¸è¿™ä¹ˆå¤„ç†å°±æ¯”è¾ƒéš¾é˜…è¯»ã€‚

@node Do Statement
@subsection @code{do}-@code{while} è¯­å¥
@cindex @code{do}-@code{while} statement
@cindex loops, @code{do}-@code{while}

@code{do} å¾ªç¯æ˜¯ @code{while} å¾ªç¯çš„å˜ä½“ã€‚
@code{do} å¾ªç¯ä¸­å…ˆä¼šæ‰§è¡Œ @var{body} ä¸€æ¬¡ï¼Œå¦‚æœæ¡ä»¶ä¸º trueï¼Œåˆ™ä¼šé‡å¤æ‰§è¡Œ @var{body}ã€‚å®ƒçœ‹èµ·æ¥å¦‚ä¸‹ï¼š

@example
do
  @var{body}
while (@var{condition})
@end example

å°±ç®—æ˜¯ @var{condition} ä¸€å¼€å§‹ä¸º falseï¼Œ@var{body} ä¹Ÿä¼šè‡³å°‘æ‰§è¡Œä¸€æ¬¡ï¼ˆå¹¶ä¸”åªæ‰§è¡Œä¸€æ¬¡ï¼Œé™¤é @var{body} å†…å°† @var{condition} å˜æˆ trueï¼‰ã€‚
ä¸ @code{while} è¯­å¥æ¯”è¾ƒèµ·æ¥ï¼š

@example
while (@var{condition})
    @var{body}
@end example

@noindent
è¿™ä¸ªè¯­å¥ä¸­ï¼Œå¦‚æœ @var{condition} ä¸€å¼€å§‹ä¸º falseï¼Œåˆ™ @var{body} ä¸€æ¬¡ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œã€‚ä¸‹é¢æ˜¯ @code{do} è¯­å¥çš„ä¸€ä¸ªä¾‹å­ï¼š

@example
@{
    i = 1
    do @{
        print $0
        i++
    @} while (i <= 10)
@}
@end example

@noindent
è¿™ä¸ªç¨‹åºæ‰“å°è®°å½• 10 æ¬¡ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªéå¸¸ç†æƒ³çš„ä¾‹å­ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ
æ™®é€šçš„ @code{while} å¾ªç¯å°±å¯ä»¥å®Œæˆäº†ã€‚è¿™ä¸ªåæ˜ äº†ä¸€ç§å®é™…ä½¿ç”¨ç»éªŒï¼šåªæœ‰å¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œæ‰éœ€è¦çœŸæ­£ä½¿ç”¨ @code{do} è¯­å¥ã€‚

@node For Statement
@subsection @code{for} è¯­å¥
@cindex @code{for} statement
@cindex loops, @code{for}, iterative

@code{for} è¯­å¥å¯ä»¥æ›´æ–¹ä¾¿åœ°ç»Ÿè®¡å¾ªç¯çš„è¿­ä»£æ¬¡æ•°ã€‚@code{for} è¯­å¥çš„ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š

@example
for (@var{initialization}; @var{condition}; @var{increment})
  @var{body}
@end example

@noindent
@var{initialization}ï¼Œ@var{condition} ä¸ @var{increment} çš„éƒ¨åˆ†å¯ä»¥æ˜¯ä»»æ„çš„ @command{awk} è¡¨è¾¾å¼ï¼Œè€Œ @var{body} è¡¨ç¤ºä»»æ„çš„ @command{awk} è¯­å¥ã€‚

@code{for} è¯­å¥ä»¥æ‰§è¡Œ @var{initialization} å¼€å§‹ï¼Œç„¶åï¼Œåªè¦ @var{condition} ä¸º trueï¼Œåˆ™ä¼šé‡å¤æ‰§è¡Œ @var{body} ä¸ @var{increment}ã€‚
å…¸å‹çš„æƒ…å†µä¸‹ï¼Œ@var{initialization} å°†æŸä¸ªå˜é‡è®¾ç½®æˆ 0 æˆ–è€… 1ï¼Œ@var{increment} å°†å…¶å¢åŠ  1ï¼Œç„¶å @var{condition} å°†å…¶ä¸æ‰€è¦è¿­ä»£çš„æ¬¡æ•°è¿›è¡Œæ¯”è¾ƒã€‚ä¾‹å¦‚ï¼š

@example
awk '
@{
    for (i = 1; i <= 3; i++)
        print $i
@}' inventory-shipped
@end example

@noindent
è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¼šæ‰“å°æ¯ä¸ªè®°å½•çš„å‰ä¸‰ä¸ªåŸŸï¼Œæ¯è¡Œæ‰“å°ä¸€ä¸ªåŸŸã€‚

åœ¨ @var{initialization} éƒ¨åˆ†ï¼Œå¦‚æœä¸ä½¿ç”¨å¤šä¸ªèµ‹å€¼è¯­å¥ï¼Œå¦‚ @samp{x = y = 0}ï¼Œä¸å¯èƒ½è®¾ç½®å¤šäºä¸€ä¸ªå˜é‡çš„å€¼ã€‚è¿™åªæœ‰åœ¨æ‰€æœ‰çš„åˆå§‹å€¼éƒ½æ˜¯ä¸€æ ·çš„æ‰æœ‰æ„ä¹‰ã€‚ï¼ˆä½†æ˜¯ä¸å¯èƒ½åœ¨ @code{for} å¾ªç¯å‰ï¼Œç”¨å‡ ä¸ªèµ‹å€¼è¯­å¥æ¥åˆå§‹åŒ–å…¶ä»–å˜é‡çš„å€¼ã€‚ï¼‰

@c @cindex comma operator, not supported
åœ¨ @var{increment} éƒ¨åˆ†ä¹Ÿæ˜¯ä¸€æ ·ã€‚å¯¹å…¶ä»–çš„å˜é‡çš„é€’å¢ï¼Œéœ€è¦åœ¨å¾ªç¯ç»“æŸæ—¶ç”¨ç‹¬ç«‹çš„è¯­å¥æ¥è¿›è¡Œé€’å¢ã€‚C ç±»å‹çš„å¤åˆè¡¨è¾¾å¼ï¼Œä½¿ç”¨ C çš„é€—å·æ“ä½œç¬¦ï¼Œåœ¨è¿™æ ·çš„ä¸Šä¸‹æ–‡ä¸­å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯åœ¨ @command{awk} ä¸­ä¸è¢«æ”¯æŒã€‚

åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œ@var{increment} æ˜¯ä¸€ä¸ªé€’å¢è¡¨è¾¾å¼ï¼Œå°±å¦‚å‰é¢çš„ä¾‹å­ä¸­çš„ä¸€æ ·ã€‚ä½†æ˜¯å´å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒä¹Ÿå¯ä»¥æ˜¯ä»»æ„çš„è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¯­å¥æ‰“å° 1 åˆ° 100 ä¹‹é—´çš„ 2 æ¬¡å¹‚çš„å€¼ï¼š

@example
for (i = 1; i <= 100; i *= 2)
    print i
@end example

å¦‚æœåœ¨ @code{for} åé¢æ‹¬å·ä¸­çš„è¡¨è¾¾å¼ä»€ä¹ˆä¹Ÿä¸éœ€è¦åšï¼Œåˆ™å¯ä»¥çœç•¥å®ƒä»¬ã€‚å¦‚ @w{@samp{for (; x > 0;)}} ä¸ @w{@samp{while (x > 0)}} æ˜¯ç­‰åŒçš„ã€‚
å¦‚æœ @var{condition} è¢«çœç•¥äº†ï¼Œåˆ™å…¶å°†è¢«è§†ä½œ trueï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°äº§ç”Ÿä¸€ä¸ª@dfn{æ— é™å¾ªç¯}ï¼ˆä¸ä¼šç»ˆæ­¢çš„å¾ªç¯ï¼‰ã€‚

åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œ@code{for} å¾ªç¯æ˜¯ @code{while} å¾ªç¯çš„ä¸€ä¸ªç®€å†™æ–¹å¼ï¼Œå¦‚ä¸‹é¢æ‰€ç¤ºï¼š

@example
@var{initialization}
while (@var{condition}) @{
  @var{body}
  @var{increment}
@}
@end example

@cindex loops, @code{continue} statements and
@noindent
å”¯ä¸€çš„ä¾‹å¤–æ˜¯åœ¨å¾ªç¯ä¸­ä½¿ç”¨ @code{continue} è¯­å¥æ—¶ï¼ˆæŸ¥çœ‹ @ref{Continue Statement}ï¼‰ã€‚
å°† @code{for} å¾ªç¯æ”¹ä¸º @code{while} å¾ªç¯ï¼Œä¹Ÿèƒ½å¤Ÿæ”¹å˜å¾ªç¯å†…çš„ @code{continue} è¯­å¥çš„ç»“æœã€‚

@command{awk} è¯­è¨€é™¤äº† @code{while} è¿˜è¦åŠ ä¸Šä¸€ä¸ª @code{for} å¾ªç¯ï¼Œä¸»è¦æ˜¯å› ä¸º @code{for} å¾ªç¯é€šå¸¸æœ‰æ›´å°‘çš„æ•²å‡»è¾“å…¥ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§å¾ˆè‡ªç„¶çš„è¿‡ç¨‹ã€‚ç»Ÿè®¡è¿­ä»£æ¬¡æ•°åœ¨å¾ªç¯ä¸­æ˜¯ä¸€ç§å¾ˆæ™®éçš„äº‹æƒ…ã€‚å°†è¿™ç§ç»Ÿè®¡ä½œä¸ºå¾ªç¯çš„ä¸€éƒ¨ä»½è¦æ¯”åœ¨å¾ªç¯å†…éƒ¨æ¥åšè¿™äº›äº‹æƒ…è¦æ›´å®¹æ˜“ã€‚

@cindex @code{in} operator
è¿™æ˜¯å¦ä¸€ç§ç‰ˆæœ¬çš„ @code{for} å¾ªç¯ï¼Œ@code{for} è¿­ä»£æ•°ç»„çš„æ‰€æœ‰ä¸‹æ ‡ï¼š

@example
for (i in array)
    @var{do something with} array[i]
@end example

@noindent
æŸ¥çœ‹ @ref{Scanning an Array}ï¼Œæ¥è·å–æ›´å¤šçš„å…³äº @code{for} å¾ªç¯çš„ä¿¡æ¯ã€‚

@node Switch Statement
@subsection @code{switch} è¯­å¥
@cindex @code{switch} statement
@cindex @code{case} keyword
@cindex @code{default} keyword

æœ¬@value{SECTION}æè¿°çš„æ˜¯ä¸€ä¸ª @command{gawk} ä¸“æœ‰çš„ç‰¹æ€§ã€‚å¦‚æœ @command{gawk} æ˜¯åœ¨å…¼å®¹æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œåˆ™è¿™ä¸ªç‰¹æ€§å°±ä¸å¯ç”¨ã€‚

@code{switch} è¯­å¥å…è®¸å¯¹è¡¨è¾¾å¼æ±‚å€¼ï¼Œå¹¶é’ˆå¯¹åŒ¹é…çš„å€¼æ¥æ‰§è¡Œä¸åŒçš„è¯­å¥ã€‚
@code{case} è¯­å¥ç”¨æ¥é¡ºåºåœ°æ£€æŸ¥æ‰€å®šä¹‰çš„åŒ¹é…ã€‚å¦‚æœæ²¡æœ‰åˆé€‚çš„ @code{case}ï¼Œå¦‚æœæä¾›äº† @code{default} æ®µï¼Œåˆ™ @code{default} æ®µä¼šè¢«æ‰§è¡Œã€‚

æ¯ä¸ª @code{case} ä¸­åŒ…å«ä¸€ä¸ªå¸¸é‡ï¼Œå¯ä»¥æ˜¯æ•°å€¼ï¼Œå­—ä¸²æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ã€‚@code{switch} è¡¨è¾¾å¼è¢«æ±‚å€¼åï¼Œä¼šæŒ‰é¡ºåºå¯¹ @code{case} ä¸­çš„å­¦å¸¸é‡è¿›è¡Œæ¯”è¾ƒã€‚
å¸¸é‡çš„ç±»å‹å†³å®šäº†æ¯”è¾ƒçš„ç±»å‹ï¼šæ•°å€¼çš„ï¼Œè¿˜æ˜¯å­—ä¸²çš„ã€‚ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡æ‰§è¡Œçš„æ˜¯é’ˆå¯¹åˆå§‹è¡¨è¾¾å¼çš„å€¼çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ä¸€èˆ¬åœ°ï¼Œ@code{switch} è¯­å¥çœ‹èµ·æ¥å¦‚ä¸‹ï¼š

@example
switch (@var{expression}) @{
case @var{value or regular expression}:
    @var{case-body}
default:
    @var{default-body}
@}
@end example

@code{switch} çš„æ§åˆ¶æµä¸ C ä¸­çš„æ‰§è¡Œä¸€è‡´ã€‚åªè¦ä¸ç»™å®šçš„ @code{case} åŒ¹é…äº†ï¼Œ@code{case} è¯­å¥ä½“ä¸­çš„è¯­å¥å°±ä¼šè¢«æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ° @code{break}ï¼Œ@code{continue}ï¼Œ@code{next}ï¼Œ@code{nextfile}ï¼Œæˆ–è€…æ˜¯ @code{exit}ï¼Œæˆ–è€…æ˜¯ @code{switch} è¯­å¥æœ¬èº«çš„ç»“æŸã€‚

@example
while ((c = getopt(ARGC, ARGV, "aksx")) != -1) @{
    switch (c) @{
    case "a":
        # report size of all files
        all_files = TRUE;
        break
    case "k":
        BLOCK_SIZE = 1024       # 1K block size
        break
    case "s":
        # do sums only
        sum_only = TRUE
        break
    case "x":
        # don't cross filesystems
        fts_flags = or(fts_flags, FTS_XDEV)
        break
    case "?":
    default:
        usage()
        break
    @}
@}
@end example

è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¿™é‡Œæ²¡æœ‰æŒ‡å®šä»»ä½•è¯­å¥ï¼Œåˆ™ä¼šåœæ­¢æ‰§è¡ŒåŒ¹é…çš„ @code{case} è¯­å¥ï¼Œåˆ™æ‰§è¡Œæµç¨‹ä¼šè½å…¥ä¸‹ä¸€ä¸ª @code{case} ä¸­ï¼Œç›´åˆ°æ‰§è¡Œä¸­æ­¢ã€‚
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ@code{"?"} çš„ @code{case} ä¸­ï¼Œä¼šè½å…¥åˆ° @code{default} @code{case} ä¸­æ‰§è¡Œï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨ @code{usage()} å‡½æ•°ã€‚
å…¶ä¸­æ‰€è°ƒç”¨çš„ @code{getopt()} å‡½æ•°åœ¨ @ref{Getopt Function} æè¿°ã€‚ï¼‰

@node Break Statement
@subsection @code{break} è¯­å¥
@cindex @code{break} statement
@cindex loops, exiting
@cindex loops, @code{break} statement and

@code{break} è¯­å¥è·³å‡ºæœ€åŒ…å«è¯¥è¯­å¥çš„æœ€å†…å±‚çš„ @code{for}ï¼Œ@code{while}ï¼Œ@code{do} å¾ªç¯ã€‚ä¸‹é¢çš„ä¾‹å­æŸ¥æ‰¾ä»»æ„æ•´æ•°çš„æœ€å°å› æ•°ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦ä¸ºè´¨æ•°ï¼š

@example
# find smallest divisor of num
@{
    num = $1
    for (divisor = 2; divisor * divisor <= num; divisor++) @{
        if (num % divisor == 0)
            break
    @}
    if (num % divisor == 0)
        printf "Smallest divisor of %d is %d\n", num, divisor
    else
        printf "%d is prime\n", num
@}
@end example

å½“ç¬¬ä¸€ä¸ª @code{if} è¯­å¥ä¸­çš„ä½™æ•°æ˜¯ 0 æ—¶ï¼Œ@command{awk} å°±ç›´æ¥è·³å‡ºå¾ªç¯ã€‚è¿™è¡¨ç¤º @command{awk} ä¼šæ‰§è¡Œç›´æ¥è·Ÿåœ¨å¾ªç¯åé¢çš„è¯­å¥ã€‚
ï¼ˆè¿™ä¸ @code{exit} éå¸¸ä¸åŒï¼Œ@code{exit} ä¼šåœæ­¢æ•´ä¸ª @command{awk} ç¨‹åºï¼ŒæŸ¥çœ‹ @ref{Exit Statement}ã€‚ï¼‰

ä¸‹é¢çš„ç¨‹åºè§£é‡Šäº†åœ¨ @code{for} æˆ–è€… @code{while} å¾ªç¯è¯­å¥ä¸­çš„ @var{condition}ï¼Œå¦‚ä½•ç”¨ @code{if} ä¸­çš„ @code{break} æ¥ä»£æ›¿ï¼š

@example
# find smallest divisor of num
@{
    num = $1
    for (divisor = 2; ; divisor++) @{
        if (num % divisor == 0) @{
            printf "Smallest divisor of %d is %d\n", num, divisor
            break
        @}
        if (divisor * divisor > num) @{
            printf "%d is prime\n", num
            break
        @}
    @}
@}
@end example

@code{break} è¯­å¥ä¹Ÿç”¨æ¥ä¸­æ–­ @code{switch} ä¸­çš„è¯­å¥ã€‚è¿™åœ¨ @ref{Switch Statement}ï¼Œè¿›è¡Œäº†æè¿°ã€‚

@c @cindex @code{break}, outside of loops
@c @cindex historical features
@c @cindex @command{awk} language, POSIX version
@cindex POSIX @command{awk}, @code{break} statement and
@cindex dark corner, @code{break} statement
@cindex @command{gawk}, @code{break} statement in
@cindex Brian Kernighan's @command{awk}
åœ¨å¾ªç¯ä½“æˆ–è€… @code{switch} å¤–é¢ä½¿ç”¨ @code{break} æ²¡æœ‰æ„ä¹‰ã€‚ä½†æ˜¯ï¼Œè™½ç„¶æ²¡æœ‰åœ¨æ–‡æ¡£ä¸­è®°å½•ä¸‹æ¥ï¼Œ@command{awk} çš„å†å²ç‰ˆæœ¬ä¸­å°†å¾ªç¯å¤–çš„ @code{break} è¯­å¥ï¼Œå½“æˆæ˜¯ä¸€ä¸ª @code{next} è¯­å¥ï¼ˆæŸ¥çœ‹ @ref{Next Statement}ï¼‰ã€‚
@value{DARKCORNER}
è¿‘æ¥çš„ BWK @command{awk} ç‰ˆæœ¬ä¸å†å…è®¸è¿™æ ·çš„ç”¨æ³•ï¼Œ@command{gawk} ä¹Ÿä¸å…è®¸ã€‚

@node Continue Statement
@subsection @code{continue} è¯­å¥

@cindex @code{continue} statement
ä¸ @code{break} ç±»å‹ï¼Œ@code{continue} è¯­å¥åªè¦ @code{for}ï¼Œ@code{while}ï¼Œä»¥åŠ @code{do} å¾ªç¯ä¸­ä½¿ç”¨ï¼Œå®ƒè·¯è¿‡å¾ªç¯ä½“åé¢çš„éƒ¨åˆ†ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªå¾ªç¯ç«‹å³å¼€å§‹ã€‚
ä¸ @code{break} ç›¸æ¯”ï¼Œå®ƒåªæ˜¯è·³å‡ºå¾ªç¯ã€‚

@code{for} å¾ªç¯ä¸­çš„ @code{continue} è¯­å¥ï¼Œå¼•å¯¼ @command{awk} è·¯è¿‡å¾ªç¯ä½“åé¢çš„éƒ¨åˆ†ï¼Œå¹¶æ‰§è¡Œ @code{for} è¯­å¥ä¸­çš„é€’å¢è¡¨è¾¾å¼ï¼ˆincrement-expressionï¼‰ã€‚
ä¸‹é¢çš„ç¨‹åºè§£é‡Šäº†è¿™æ ·çš„æƒ…å½¢ï¼š

@example
BEGIN @{
     for (x = 0; x <= 20; x++) @{
         if (x == 5)
             continue
         printf "%d ", x
     @}
     print ""
@}
@end example

@noindent
è¿™ä¸ªç¨‹åºæ‰“å° 0 åˆ° 20 ä¹‹é—´çš„æ•°ï¼Œé™¤äº† 5 å¤–ï¼Œå› ä¸ºåœ¨è¿™ä¸ªæ•°å€¼æ—¶ @code{printf} è¢«è·³è¿‡äº†ã€‚å› ä¸º @samp{x++} å¹¶æ²¡æœ‰è¢«è·³è¿‡ï¼Œå› æ­¤ï¼Œx çš„å€¼ä¸ä¼šå¡åœ¨ 5 ä¸Šã€‚
ä¸‹é¢çš„ @code{while} å¾ªç¯ä¸å‰é¢çš„ @code{for} å¾ªç¯ç›¸æ¯”ï¼š

@example
BEGIN @{
     x = 0
     while (x <= 20) @{
         if (x == 5)
             continue
         printf "%d ", x
         x++
     @}
     print ""
@}
@end example

@noindent
è¿™ä¸ªç¨‹åºä¸­ï¼Œåªè¦ x è¾¾åˆ° 5 å°±ä¼šæˆä¸ºä¸€ä¸ªæ­»å¾ªç¯ï¼Œå› ä¸ºé€’å¢è¯­å¥ï¼ˆ@samp{x++}ï¼‰æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚

@c @cindex @code{continue}, outside of loops
@c @cindex historical features
@c @cindex @command{awk} language, POSIX version
@cindex POSIX @command{awk}, @code{continue} statement and
@cindex dark corner, @code{continue} statement
@cindex @command{gawk}, @code{continue} statement in
@cindex Brian Kernighan's @command{awk}
ä¸ @code{switch} è¯­å¥å¯¹åº”ï¼Œ@code{continue} è¯­å¥å¹¶æ²¡æœ‰ç‰¹åˆ«çš„å«ä¹‰ï¼Œåœ¨å¾ªç¯ä½“ä¹‹å¤–ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å«ä¹‰ã€‚
@command{awk} çš„å†å²ç‰ˆæœ¬å°†å¾ªç¯ä½“ä¹‹å¤–çš„ @code{continue} ä¸å¾ªç¯ä½“ä¹‹å¤–çš„çš„ @code{break} ä¸€æ ·å¯¹å¾…ï¼šå°±åƒå®ƒæ˜¯ä¸€ä¸ª @code{next} è¯­å¥ä¸€æ ·
@ifset FOR_PRINT
ï¼ˆåœ¨åé¢çš„@value{SECTION}ä¸­è®¨è®ºï¼‰ã€‚
@end ifset
@ifclear FOR_PRINT
ï¼ˆæŸ¥çœ‹ @ref{Next Statement}ï¼‰ã€‚
@end ifclear
@value{DARKCORNER}
BWK @command{awk} çš„åé¢çš„ç‰ˆæœ¬ä¸å†è¿™ä¹ˆå¤„ç†ï¼Œ@command{gawk} ä¹Ÿä¸è¿™ä¹ˆåšã€‚

@node Next Statement
@subsection @code{next} è¯­å¥
@cindex @code{next} statement

@code{next} è¯­å¥å¼ºåˆ¶ @command{awk} ç«‹å³åœæ­¢å½“å‰è®°å½•çš„å¤„ç†å¹¶å¤„ç†ä¸‹ä¸€æ¡è®°å½•ã€‚
è¿™è¡¨ç¤ºé’ˆå¯¹å½“å‰çš„è®°å½•ä¸å†è¿›ä¸€æ­¥è¿›è¡Œè§„åˆ™çš„åŒ¹é…ï¼Œå½“å‰è§„åˆ™çš„ä½™ä¸‹éƒ¨åˆ†ä¹Ÿä¸è¢«æ‰§è¡Œã€‚

ä¸ @code{getline} å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{Getline}ï¼‰è¿›è¡Œå¯¹æ¯”ã€‚@code{getline} ä¹Ÿä¼šå¯¼è‡´ @command{awk} ç«‹å³è¯»å–ä¸‹ä¸€æ¡è®°å½•ï¼Œ
ä½†æ˜¯å¹¶æ²¡æœ‰æ”¹å˜æ§åˆ¶æµï¼ˆå³ï¼Œå½“å‰çš„åŠ¨ä½œä¼šåœ¨æ–°çš„è®°å½•ä¸Šæ‰§è¡Œï¼‰ã€‚

@cindex @command{awk} programs, execution of
åœ¨æœ€é«˜çº§ä¸Šï¼Œ@command{awk} ç¨‹åºæ˜¯è¿™æ ·çš„ä¸€ä¸ªå¾ªç¯ï¼Œå³è¯»å–ä¸€æ¡è®°å½•ï¼Œç„¶åä¸æ¯ä¸€ä¸ªæ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚
å¦‚æœä½ æŠŠè¿™æ ·çš„ä¸€ä¸ªå¾ªç¯çœ‹æˆæ˜¯ä¸€ä¸ª @code{for} è¯­å¥ï¼Œå…¶å¾ªç¯ä½“åŒ…å«äº†è¿™äº›è§„åˆ™ï¼Œç„¶åï¼Œ@code{next} è¯­å¥åˆ™ä¸ @code{continue} è¯­å¥ç±»ä¼¼ã€‚å®ƒä¼šè·³è¿‡è¿™ä¸ªéšå¼å¾ªç¯çš„åé¢éƒ¨åˆ†ï¼Œç„¶åæ‰§è¡Œé€’å¢ï¼ˆä¹Ÿå°±æ˜¯è¯»å–ä¸‹ä¸€æ¡è®°å½•ï¼‰ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ª @command{awk} ç¨‹åºå¤„ç†çš„è®°å½•åªæœ‰ 4 ä¸ªåŸŸï¼Œå¹¶ä¸”å½“è¾“å…¥ä¸è§„èŒƒæ—¶ä¸ä¼šå¯¼è‡´å¤±è´¥ã€‚
ä¸ºäº†é¿å…åé¢ç¨‹åºçš„å¤æ‚æ€§ï¼Œç”¨ä¸‹é¢çš„æ–¹å¼ï¼Œåœ¨å¼€å¤´å¤„è¿™ä¸€ä¸ªè¿™æ ·çš„â€œæ’é™¤â€ä»£ç ï¼š

@example
NF != 4 @{
    printf("%s:%d: skipped: NF != 4\n", FILENAME, FNR) > "/dev/stderr"
    next
@}
@end example

@noindent
ç”±äºæœ‰ä¸€ @code{next} è¯­å¥ï¼Œç¨‹åºåé¢çš„è§„åˆ™å°±ä¸ä¼šå†çœ‹åˆ°é‚£äº›ä¸è§„èŒƒçš„è®°å½•ã€‚é”™è¯¯çš„ä¿¡æ¯ä¼šè¢«é‡å®šå‘åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºæµä¸Šï¼Œæ­£å¦‚é”™è¯¯ä¿¡æ¯åº”è¯¥è¿™ä¹ˆè¢«å¤„å¤„ç†ä¸€æ ·ã€‚è¦å–å¾—æ›´å¤šçš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ @ref{Special Files}ã€‚

å¦‚æœ @code{next} è¯­å¥å¯¼è‡´äº†è¾“å…¥æ–‡ä»¶çš„ç»“æŸï¼Œåˆ™åœ¨ @code{END} è§„åˆ™é‡Œçš„ä»£ç å°±ä¼šè¢«æ‰§è¡Œï¼ŒæŸ¥çœ‹ @ref{BEGIN/END}ã€‚

@code{next} è¯­å¥ä¸å¯ä»¥ä½¿ç”¨åœ¨ @code{BEGINFILE} ä¸ @code{ENDFILE} è§„åˆ™ä¸­ï¼ŒæŸ¥çœ‹ @ref{BEGINFILE/ENDFILE}ã€‚

@c @cindex @command{awk} language, POSIX version
@c @cindex @code{next}, inside a user-defined function
@cindex @code{BEGIN} pattern, @code{next}/@code{nextfile} statements and
@cindex @code{END} pattern, @code{next}/@code{nextfile} statements and
@cindex POSIX @command{awk}, @code{next}/@code{nextfile} statements and
@cindex @code{next} statement, user-defined functions and
@cindex functions, user-defined, @code{next}/@code{nextfile} statements and
æ ¹æ® POSIX æ ‡å‡†ï¼Œå¦‚æœ @code{next} è¯­å¥ç”¨åœ¨ @code{BEGIN} ä¸ @code{END} è§„åˆ™ä¸­ï¼Œå…¶è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚
@command{gawk} å°†å…¶è§†ä¸ºè¯­æ³•é”™è¯¯ã€‚å°½ç®¡ POSIX æ²¡æœ‰ç¦æ­¢ï¼Œä½†å¤§å¤šæ•°çš„ @command{awk} å®ç°ä¸å‡†åœ¨å‡½æ•°ä½“å†…
ï¼ˆæŸ¥çœ‹ @ref{User-defined}ï¼‰ä½¿ç”¨ @code{next} è¯­å¥ã€‚ä¸å…±ä»–çš„å¤„çš„ @code{next} è¯­å¥ä¸€æ ·ï¼Œ
åœ¨å‡½æ•°å†…çš„ @code{next} è¯­å¥ä¹Ÿæ˜¯è¯»å–ä¸‹ä¸€æ¡è®°å½•ç„¶åä»ç¨‹åºçš„ç¬¬ä¸€ä¸ªè§„åˆ™å¼€å§‹å¤„ç†ã€‚

@node Nextfile Statement
@subsection @code{nextfile} è¯­å¥
@cindex @code{nextfile} statement

@code{nextfile} ä¸ @code{next} è¯­å¥ç±»ä¼¼ã€‚ä½†æ˜¯ä¸æ˜¯æ”¾å¼ƒå¤„ç†å½“å‰è®°å½•ï¼Œ@code{nextfile} åˆ™æ˜¯é€šçŸ¥ @command{awk} åœæ­¢å¤„ç†å½“å‰çš„@value{DF}ã€‚

éšç€ @code{nextfile} çš„æ‰§è¡Œï¼Œ@code{FILENAME} ä¹Ÿä¼šæ›´æ–°ä»¥åæ˜ å‘½ä»¤è¡Œåˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ª@value{DF}ã€‚
@code{FNR} åˆ™è¢«é‡ç½®ä¸º 0ï¼Œå¤„ç†æµç¨‹å›åˆ°ç¨‹åºä¸­çš„ç¬¬ä¸€ä¸ªè§„åˆ™ä¸­ã€‚
å¦‚æœ @code{nextfile} è¯­å¥å¯¼è‡´äº†è¾“å…¥çš„ç»“æŸï¼Œåˆ™åœ¨ @code{END} è§„åˆ™ä¸­çš„ä»£ç å°±ä¼šè¢«æ‰§è¡Œã€‚ä¸€ä¸ªä¾‹å¤–å°±æ˜¯è¿™ä¸ª @code{nextfile} æ˜¯åœ¨æ‰§è¡Œ @code{END} è§„åˆ™ä¸­è¢«è°ƒç”¨çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ç¨‹åºé€€å‡ºã€‚
æŸ¥çœ‹ @ref{BEGIN/END}ã€‚

å½“æœ‰å¾ˆå¤šçš„æ•°æ®æ–‡ä»¶è¦å¤„ç†ï¼Œä½†æ˜¯ä¸éœ€è¦å¤„ç†æ¯ä¸ªæ–‡ä»¶ä¸­çš„æ¯ä¸ªè®°å½•çš„æƒ…å†µä¸‹ï¼Œ@code{nextfile} è¯­å¥éå¸¸æœ‰ç”¨ã€‚
å¦‚æœæ²¡æœ‰ @code{nextfile}ï¼Œä¸ºäº†è¦å¤„ç†ä¸‹ä¸€ä¸ª@value{DF}ï¼Œç¨‹åºå°±å¾—æ–­ç»­è¾“å…¥é‚£äº›ä¸éœ€è¦çš„è®°å½•ã€‚@code{nextfile} è¯­å¥ä»¥ä¸€ç§æ›´ä¸ºé«˜æ•ˆçš„æ–¹å¼æ¥å®Œæˆè¿™æ ·çš„ç›®æ ‡ã€‚

åœ¨ @command{gawk} ä¸­ï¼Œ@code{nextfile} çš„æ‰§è¡Œä¼šå¯¼è‡´ä¸€äº›å…¶ä»–çš„äº‹æƒ…å‘ç”Ÿï¼šå¦‚æœ @command{gawk} å½“å‰æ²¡æœ‰æ‰§è¡Œ @code{END} æˆ–è€… @code{ENDFILE} è§„åˆ™ï¼Œ
åˆ™ä¼šå¯¼è‡´æ‰€æœ‰ @code{ENDFILE} è¢«æ‰§è¡Œï¼Œ@code{ARGIND} ä¼šè¢«é€’å¢ï¼Œæ‰€æœ‰çš„ @code{BEGINFILE} ä¼šè¢«æ‰§è¡Œã€‚ï¼ˆ@code{ARGIND} è¿˜æ²¡æœ‰ä»‹ç»ã€‚
æŸ¥çœ‹ @ref{Built-in Variables}ã€‚ï¼‰

å¯¹äº @command{gawk}ï¼Œåœ¨ @code{BEGINFILE} è§„åˆ™ä¸­è·³è¿‡ä¸€ä¸ªä¼šå¯¼è‡´ @command{gawk} å› ä¸ºè‡´å‘½é”™è¯¯è€Œé€€å‡ºçš„æ–‡ä»¶ä¹Ÿéå¸¸æœ‰ç”¨ã€‚
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ@code{ENDFILE} ä¸ä¼šè¢«æ‰§è¡Œã€‚æŸ¥çœ‹ @ref{BEGINFILE/ENDFILE}ã€‚

å°½ç®¡æœ‰å¯èƒ½çœ‹åˆ°ç”¨ @samp{close(FILENAME)} æ¥å®Œæˆå¦‚ @code{nextfile} ä¸€æ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯äº‹å®å´ä¸æ˜¯è¿™æ ·çš„ã€‚
@code{close()} ä¿ç•™ç”¨æ¥å…³é—­æ‰“å¼€ç”¨äºé‡å®šå‘çš„æ–‡ä»¶ã€ç®¡é“ä»¥åŠå¹¶ç¨‹ã€‚å®ƒä¸ä¸»è¿‡ç¨‹æ²¡æœ‰å…³ç³»ï¼Œå®ƒä»¬ä¸å¤„ç† @command{awk} çš„ @code{ARGV} ä¸­çš„æ–‡ä»¶ã€‚

@quotation æç¤º
è®¸å¤šå¹´äº†ï¼Œ@code{nextfile} ä¸€ç›´æ˜¯ä¸€ä¸ªæ‰©å±•ã€‚åœ¨ 2012 å¹´ 9 æœˆï¼Œå®ƒæŠ¥æˆå—å¹¶åŒ…å«åœ¨ POSIX æ ‡å‡†ä¸­ï¼ŒæŸ¥çœ‹ @uref{http://austingroupbugs.net/view.php?id=607, Austin Group çš„ç½‘ç«™}ã€‚
@end quotation

@cindex functions, user-defined, @code{next}/@code{nextfile} statements and
@cindex @code{nextfile} statement, user-defined functions and
@cindex Brian Kernighan's @command{awk}
@cindex @command{mawk} utility
BWK @command{awk} ä¸ @command{mawk} çš„æœ€æ–°ç‰ˆæœ¬ä¹Ÿæ”¯æŒ @code{nextfile}ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä¸å…è®¸åœ¨å‡½æ•°ä½“
ï¼ˆæŸ¥çœ‹ @ref{User-defined}ï¼‰ä¸­ä½¿ç”¨ @code{nextfile} è¯­å¥ã€‚@command{gawk} åˆ™å…è®¸ã€‚
åœ¨å‡½æ•°ä½“å†…çš„ @code{nextfile} ä¼šè¯»å–ä¸‹ä¸€ä¸ªè®°å½•ï¼Œç„¶åä»ç¨‹åºçš„ç¬¬ä¸€æ¡è§„åˆ™å¼€å§‹å¤„ç†ï¼Œè¿™ä¸å…¶ä»–å¤„çš„ @code{nextfile} è¯­å¥ä¸€æ ·ã€‚

@node Exit Statement
@subsection @code{exit} è¯­å¥

@cindex @code{exit} statement
@code{exit} è¯­å¥ä¼šå¯¼è‡´ @command{awk} ç«‹å³åœæ­¢æ‰§è¡Œå½“å‰çš„è§„åˆ™ï¼Œå¹¶åœæ­¢å¤„ç†è¾“å…¥ï¼Œæ‰€æœ‰å‰©ä¸‹çš„è¾“å…¥éƒ½å°†è¢«å¿½ç•¥ã€‚@code{exit} çš„å†™æ³•å¦‚ä¸‹ï¼š

@display
@code{exit} [@var{return code}]
@end display

@cindex @code{BEGIN} pattern, @code{exit} statement and
@cindex @code{END} pattern, @code{exit} statement and
å½“åœ¨ @code{BEGIN} è§„åˆ™ä¸­æ‰§è¡Œ @code{exit} è¯­å¥æ—¶ï¼Œç¨‹åºä¼šç«‹å³åœæ­¢ä¸€åˆ‡å¤„ç†ã€‚ä¹Ÿæ²¡æœ‰è¾“å…¥è®°å½•è¢«è¯»å–ï¼Œå¦‚æœæä¾›äº† @code{END} è§„åˆ™ï¼Œ
ä¼šä½œä¸ºæ‰§è¡Œ @code{exit} è¯­å¥çš„ä¸€éƒ¨ä»½ï¼Œè€Œè¢«æ‰§è¡Œï¼ˆæŸ¥çœ‹ @ref{BEGIN/END}ï¼‰ã€‚å¦‚æœåœ¨ @code{END} è§„åˆ™ä¸­ä½¿ç”¨ @code{exit}ï¼Œä¼šå¯¼è‡´ç¨‹åºç«‹å³åœæ­¢ã€‚

@code{exit} è¯­å¥å¦‚æœä¸æ˜¯ @code{BEGIN} æˆ–è€… @code{END} è§„åˆ™ä¸€éƒ¨ä»½ï¼Œåˆ™ä¼šåœæ­¢ä»»ä½•åç»­çš„é’ˆå¯¹å½“å‰è®°å½•çš„è‡ªåŠ¨è§„åˆ™çš„æ‰§è¡Œï¼Œå¹¶ä¸å†è¯»å–å‰©ä¸‹çš„è¾“å…¥è®°å½•ï¼Œ
ç„¶åå¦‚æœæœ‰ @code{END} è§„åˆ™ï¼Œåˆ™æ‰§è¡Œã€‚@command{gawk} ä¹Ÿä¼šè·³è¿‡ @code{ENDFILE} è§„åˆ™ï¼Œå› æ­¤ä¸ä¼šæ‰§è¡Œã€‚

åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ä¸æƒ³ @code{END} è§„åˆ™è¢«æ‰§è¡Œï¼Œå¯ä»¥å°†æŸä¸ªå˜é‡çš„å€¼è®¾ç½®æˆéé›¶å€¼ï¼Œç„¶ååœ¨ @code{END} è§„åˆ™ä¸­çš„ @code{exit} è¯­å¥å‰ï¼Œ
åˆ¤æ–­è¿™ä¸ªå˜é‡çš„å€¼ã€‚æŸ¥çœ‹ @ref{Assert Function}ï¼Œæ¥å‚è€ƒè¿™æ ·çš„å…·ä½“ä¾‹å­ã€‚

@cindex dark corner, @code{exit} statement
å¦‚æœç»™ @code{exit} è¯­å¥æä¾›äº†å‚æ•°ï¼Œå®ƒçš„å€¼å°†ä½œä¸º @command{awk} è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ç ã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œ@command{awk} åˆ™ä¼šä»¥â€œæˆåŠŸâ€çš„æ–¹å¼é€€å‡ºã€‚
åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ @code{exit} æ—¶æä¾›äº†å‚æ•°ï¼Œè€Œç¬¬äºŒæ¬¡ä» @code{END} è§„åˆ™ä¸­è°ƒç”¨ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›å‚æ•°çš„æƒ…å†µä¸‹ï¼Œ@command{awk} ä¼šä½¿ç”¨ä¹‹å‰æä¾›çš„é€€å‡ºå€¼ã€‚
æŸ¥çœ‹ @ref{Exit Status}ï¼Œæ¥å–å¾—æ›´å¤šä¿¡æ¯ã€‚

@cindex programming conventions, @code{exit} statement
ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªé”™è¯¯æ¡ä»¶å‡ºç°ï¼Œå¾ˆéš¾æˆ–è€…æ— æ³•å¤„ç†ã€‚ä¸€èˆ¬çš„ä½œæ³•æ˜¯ç¨‹åºä¼šä»¥ä¸€ä¸ªéé›¶çŠ¶æ€é€€å‡ºã€‚
@command{awk} ç¨‹åºé€šè¿‡å¸¦éé›¶å€¼çš„ @code{exit} è¯­å¥æ¥å¤„ç†ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼š

@example
BEGIN @{
    if (("date" | getline date_now) <= 0) @{
        print "Can't get system date" > "/dev/stderr"
        exit 1
    @}
    print "current date is", date_now
    close("date")
@}
@end example

@quotation æç¤º
ä¸ºäº†å®Œå…¨çš„å¯ç§»æ¤æ€§ï¼Œ@code{exit} çš„å€¼åº”è¯¥åœ¨ 0 äºæ˜¯ 126 ï¼ˆå«ï¼‰ä¹‹é—´ã€‚è´Ÿå€¼ä¸ 127 æˆ–è€…æ›´å¤§çš„å€¼ï¼Œåœ¨ä¸åŒçš„å¹³å°ä¹‹é—´å¯èƒ½ä¸ä¼šäº§ç”Ÿä¸€è‡´çš„ç»“æœã€‚
@end quotation


@node Built-in Variables
@section é¢„å®šä¹‰å˜é‡
@cindex predefined variables
@cindex variables, predefined

å¤§å¤šæ•°çš„ @command{awk} å˜é‡æ˜¯æˆ‘ä»¬è‡ªå·±ä½¿ç”¨ï¼Œå¦‚æœä»–ä»¬æ²¡æœ‰è¢«èµ‹å€¼ï¼Œåˆ™ä¸ä¼šæ”¹å˜ï¼Œå¹¶ä¸”å¦‚æœä½ ä¸æ£€æŸ¥å®ƒä»¬ï¼Œå¯¹ä½ ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚ä½†æ˜¯ï¼Œ
æœ‰ä¸€äº›çš„ @command{awk} å˜é‡æœ‰ä¸€äº›ç‰¹æ®Šçš„å†…ç½®å«ä¹‰ã€‚@command{awk} ä¼šè‡ªåŠ¨æ£€æŸ¥å®ƒä»¬å½“ä¸­çš„ä¸€äº›å€¼ï¼Œ
å› æ­¤ä½¿ä½ å¯ä»¥å‘Šè¯‰ @command{awk} æ‰§è¡Œä¸€äº›ç‰¹å®šçš„äº‹æƒ…ã€‚æœ‰ä¸€äº›æ˜¯è¢« @command{awk} è‡ªåŠ¨è®¾ç½®çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¸ºä½ çš„ç¨‹åºå¸¦æ¥ä¸€äº› @command{awk} æ‰§è¡Œæ—¶çš„å†…éƒ¨ä¿¡æ¯ã€‚

@cindex @command{gawk}, predefined variables and
æœ¬@value{SECTION}è®°å½•äº†æ‰€æœ‰çš„ @command{gawk} é¢„å®šä¹‰çš„å˜é‡ï¼Œå®ƒä»¬ä¸­çš„å¤§å¤šæ•°ä¹Ÿè®°å½•åœ¨äº†æè¿°å®ƒæ‰€åº”ç”¨çš„åœºæ™¯ä¸­çš„@value{CHAPTER}ä¸­ã€‚

@menu
* User-modified::               Built-in variables that you change to control
                                @command{awk}.
* Auto-set::                    Built-in variables where @command{awk} gives
                                you information.
* ARGC and ARGV::               Ways to use @code{ARGC} and @code{ARGV}.
@end menu

@node User-modified
@subsection æ§åˆ¶ @command{awk} çš„å†…ç½®å˜é‡
@cindex predefined variables, user-modifiable
@cindex user-modifiable variables

ä¸‹é¢æ˜¯æŒ‰å­—æ¯é¡ºåºåˆ—å‡ºçš„å˜é‡ï¼Œä½ å¯æ›´æ”¹å®ƒä»¬çš„å€¼æ¥æ§åˆ¶ @command{awk} æ‰€æ‰§è¡Œçš„ç‰¹å®šäº‹æƒ…ã€‚

è¿™äº›å˜é‡å¦‚æœæ˜¯ @command{gawk} ç‰¹æœ‰çš„ï¼Œåˆ™ä¼šè¢«æ ‡å¿—ä¸€ä¸ªäº•å·ï¼ˆ@samp{#}ï¼‰ã€‚
è¿™äº›å˜é‡æ˜¯ @command{gawk} çš„æ‰©å±•ã€‚åœ¨ä¸€äº›å…¶ä»–çš„ @command{awk} å®ç°ä¸­ï¼Œæˆ–è€…åœ¨ @command{gawk} çš„å…¼å®¹æ¨¡å¼ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ä¸‹ï¼Œå®ƒä»¬æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ã€‚ï¼ˆå¦‚æœå˜é‡æœ‰ä»€ä¹ˆä¾‹å¤–ï¼Œåˆ™ä¼šåœ¨å˜é‡çš„è¯´æ˜ä¸­åˆ—å‡ºã€‚ï¼‰

@table @code
@cindex @code{BINMODE} variable
@cindex binary input/output
@cindex input/output, binary
@cindex differences in @command{awk} and @command{gawk}, @code{BINMODE} variable
@item BINMODE #
åœ¨é POSIX ç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªå˜é‡æŒ‡å®šäº†æ‰€æœ‰ I/O æ‰€ä½¿ç”¨çš„äºŒè¿›åˆ¶æ¨¡å¼ã€‚æ•°å€¼ 1ï¼Œ2ï¼Œ3 åˆ†åˆ«æŒ‡å®šä¸ºè¾“å…¥æ–‡ä»¶ï¼Œè¾“å‡ºæ–‡ä»¶ä¸æ‰€æœ‰æ–‡ä»¶ç›¸åº”åœ°è¦ä½¿ç”¨äºŒè¿›åˆ¶ I/O æ¨¡å¼ã€‚
å°äº 0 çš„å€¼ï¼Œåˆ™å½“æˆ 0 å¯¹å¾…ï¼Œè€Œå¤§äº 3 çš„å€¼ï¼Œåˆ™ä¼šè¢«å½“ä¸º 3 å¯¹å¾…ã€‚
ç›¸åº”çš„ï¼Œå­—ä¸²â€œrâ€ä¸â€œwâ€åˆ†åˆ«æŒ‡å®šè¾“å…¥è¾“å‡ºè¦ä½¿ç”¨äºŒè¿›åˆ¶ I/Oã€‚
å­—ä¸²â€œrwâ€æˆ–è€…â€œwrâ€è¡¨ç¤ºæ‰€æœ‰çš„æ–‡ä»¶ä½¿ç”¨äºŒè¿›åˆ¶ I/Oã€‚å…¶ä»–çš„å­—ä¸²å€¼åˆ™è¢«å½“æˆâ€œrwâ€ï¼Œä½†æ˜¯ @command{gawk} ä¼šäº§ç”Ÿä¸€å‘Šè­¦ã€‚
@code{BINMODE} åœ¨ @ref{PC Using}ï¼Œè¿™é‡Œæœ‰æ›´è¯¦ç»†çš„è¯´æ˜ï¼Œ@command{mawk}ï¼ˆæŸ¥çœ‹ @ref{Other Versions}ï¼‰ä¹Ÿæ”¯æŒè¿™ä¸ªå˜é‡ï¼Œä½†æ˜¯åªä½¿ç”¨æ•°å€¼ã€‚

@cindex @code{CONVFMT} variable
@cindex POSIX @command{awk}, @code{CONVFMT} variable and
@cindex numbers, converting, to strings
@cindex strings, converting, numbers to
@item @code{CONVFMT}
ç”¨äºæ§åˆ¶æ•°å€¼è½¬æ¢æˆå­—ä¸²çš„æ ¼å¼ï¼ˆæŸ¥çœ‹ @ref{Conversion}ï¼‰ã€‚
åœ¨æ•ˆæœä¸Šï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯å°†å…¶ä½œä¸º @code{sprintf()} å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚
å®ƒçš„é»˜è®¤å€¼æ˜¯ @code{"%.6g"}ã€‚@code{CONVFMT} ç”± POSIX æ ‡å‡†å¼•å…¥ã€‚

@cindex @command{gawk}, @code{FIELDWIDTHS} variable in
@cindex @code{FIELDWIDTHS} variable
@cindex differences in @command{awk} and @command{gawk}, @code{FIELDWIDTHS} variable
@cindex field separators, @code{FIELDWIDTHS} variable and
@cindex separators, field, @code{FIELDWIDTHS} variable and
@item FIELDWIDTHS #
ä¸€ä¸ªç”±ç©ºæ ¼åˆ†éš”çš„åˆ—ï¼Œç”±ä»¥å‘Šè¯‰ @command{gawk} å¦‚ä½•ç”¨å›ºå®šçš„åˆ—è¾¹ç•Œæ¥åˆ†å‰²è¾“å…¥ã€‚ç»™ @code{FIELDWIDTHS} èµ‹å€¼ï¼Œ
ä¼šè¦†ç›–ç”¨ @code{FS} ä¸ @code{FPAT} è¿›è¡ŒåŸŸåˆ†å‰²çš„æ–¹å¼ã€‚æŸ¥çœ‹ @ref{Constant Size} ï¼Œæ¥è·å–æ›´å¤šä¿¡æ¯ã€‚

@cindex @command{gawk}, @code{FPAT} variable in
@cindex @code{FPAT} variable
@cindex differences in @command{awk} and @command{gawk}, @code{FPAT} variable
@cindex field separators, @code{FPAT} variable and
@cindex separators, field, @code{FPAT} variable and
@item FPAT #
å‘Šè¯‰ @command{gawk} åŸŸçš„åˆ†å‰²æ˜¯ç”±åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼ˆä¸€ä¸ªå­—ä¸²ï¼‰çš„æ–‡æœ¬è¿›è¡Œçš„ã€‚
å¯¹ @code{FPAT} çš„èµ‹å€¼ä¼šè¦†ç›– @code{FS} ä¸ @code{FIELDWIDTHS} çš„åŸŸåˆ†å‰²æ–¹å¼ã€‚æŸ¥çœ‹ @ref{Splitting By Content}ï¼Œæ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚

@cindex @code{FS} variable
@cindex separators, field
@cindex field separators
@item FS
è¾“å…¥çš„åŸŸåˆ†éš”ç¬¦ï¼ˆæŸ¥çœ‹ @ref{Field Separators}ï¼‰ã€‚
å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦æˆ–è€…æ˜¯ä¸€ä¸ªå¤šå­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼åŒ¹é…è¾“å…¥è®°å½•ä¸­åŸŸä¹‹é—´çš„åˆ†éš”å†…å®¹ã€‚
å¦‚æœå®ƒçš„å€¼ä¸ºç©ºä¸²ï¼ˆ@code{""}ï¼‰ï¼Œåˆ™è¾“å…¥è®°å½•ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯åˆ†éš”ç¬¦ã€‚ï¼ˆè¿™ä¸ªè¡Œä¸ºæ˜¯ @command{gawk} æ‰©å±•ã€‚
POSIX @command{awk} æ²¡æœ‰æŒ‡å®šå½“ @code{FS} çš„å€¼ä¸ºçª—å£æ—¶çš„è¡Œä¸ºã€‚å› æ­¤ï¼Œå…¶ä»–ç‰ˆæœ¬çš„ @command{awk} ä¹Ÿæœ‰å¯èƒ½å°† @code{""} ç‰¹æ®Šå¯¹å¾…ã€‚ï¼‰

@cindex POSIX @command{awk}, @code{FS} variable and
å®ƒçš„é»˜è®¤å€¼æ˜¯ @w{@code{" "}}ï¼Œå³åªåŒ…å«ä¸€ä¸ªç©ºæ ¼çš„å­—ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¾‹å¤–ï¼Œè¿™ä¸ªå€¼è¡¨ç¤ºæ‰€æœ‰ç©ºæ ¼ï¼ŒTABs ä¸/æˆ–æ¢è¡Œåºåˆ—ï¼Œ
éƒ½æ˜¯ä¸€ä¸ªåˆ†éš”ç¬¦ã€‚ 
@footnote{åœ¨ POSIX @command{awk} ä¸­ï¼Œæ¢è¡Œç¬¦ä¸è¢«å½“æˆç©ºç™½ã€‚}
åŒæ—¶ï¼Œåœ¨è®°å½•å‰åçš„ç©ºæ ¼ï¼ŒTABs ä¸æ¢è¡Œç¬¦ä¹Ÿè¢«å¿½ç•¥æ‰ã€‚

ä½ ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ç”¨ @option{-F} æ¥æŒ‡å®š @code{FS} çš„å€¼ï¼š

@example
awk -F, '@var{program}' @var{input-files}
@end example

@cindex @command{gawk}, field separators and
å¦‚æœ @command{gawk} ä½¿ç”¨äº† @code{FIELDWIDTHS} æˆ–è€… @code{FPAT} ç”¨æ¥è¿›è¡ŒåŸŸåˆ†å‰²ï¼Œ
å¯¹ @code{FS} çš„èµ‹å€¼ä¼šå¯¼è‡´ @command{gawk} é€€å›åˆ°å¸¸è§„çš„ï¼ŒåŸºäº @code{FS} çš„åŸŸåˆ†å‰²æ–¹å¼ã€‚
ä¸€ä¸ªç®€å•çš„æ–¹æ³•å°±æ˜¯å°±æ˜¯ä½¿ç”¨ @samp{FS = FS}ï¼Œå¹¶åŠ ä¸Šä¸€äº›è§£é‡Šå‹æ³¨é‡Šã€‚

@cindex @command{gawk}, @code{IGNORECASE} variable in
@cindex @code{IGNORECASE} variable
@cindex differences in @command{awk} and @command{gawk}, @code{IGNORECASE} variable
@cindex case sensitivity, and string comparisons
@cindex case sensitivity, and regexps
@cindex regular expressions, case sensitivity
@item IGNORECASE #
å¦‚æœ @code{IGNORECASE} æ˜¯ä¸€ä¸ªéé›¶å€¼æˆ–è€…éç©ºä¸²ï¼Œåˆ™å­—ä¸²çš„æ¯”è¾ƒä¸æ‰€æœ‰çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…éƒ½æ˜¯å¤§å°å†™æ— å…³çš„ã€‚
è¿™åº”ç”¨äºç”¨ @samp{~} ä¸ @samp{!~} è¿›è¡Œçš„æ­£åˆ™åŒ¹é…ï¼Œ ä¹Ÿç”¨äº @code{gensub()}ï¼Œ@code{gsub()}ï¼Œ@code{index()}ï¼Œ@code{match()}ï¼Œ
@code{pat@code{split()}}ï¼Œ@code{split()} ä¸ @code{sub()} ç­‰å‡½æ•°ï¼Œè¿˜æœ‰ä»¥ @code{RS} è¿›è¡Œåˆ†å‰²çš„è®°å½•ï¼Œ
ç”¨ @code{FS} ä¸ @code{FPAT} è¿›è¡Œåˆ†å‰²çš„åŸŸä¸­ã€‚
ä½†æ˜¯ï¼Œ@code{IGNORECASE} çš„å€¼@emph{ä¸ä¼š}å½±å“ç”¨ä¸‹æ ‡ç´¢å¼•æ•°ç»„å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå½±å“å½“ä½¿ç”¨åŠå­—ç¬¦çš„åˆ†å‰²ç¬¦æ—¶çš„åŸŸåˆ†å‰²ã€‚
æŸ¥çœ‹ @ref{Case-sensitivity}ã€‚

@cindex @command{gawk}, @code{LINT} variable in
@cindex @code{LINT} variable
@cindex differences in @command{awk} and @command{gawk}, @code{LINT} variable
@cindex lint checking
@item LINT #
å½“è¿™ä¸ªå˜é‡ä¸º trueï¼ˆéé›¶æˆ–è€…éç©ºï¼‰ï¼Œ@command{gawk} è¡¨ç°å¾—å°±åƒåœ¨å‘½ä»¤è¡Œå‚æ•°ä¸­æŒ‡å®šäº† @option{--lint} å‚æ•°ä¸€æ ·æ•ˆæœ
ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚å½“å®ƒçš„å€¼ä¸º @code{"fatal"} æ—¶ï¼Œlint å‘Šè­¦ä¼šæˆä¸ºè‡´å‘½ï¼ˆfatalï¼‰é”™è¯¯ã€‚å¦‚æœå€¼æ˜¯ @code{"invalid"} æ—¶ï¼Œ
åˆ™åªæœ‰çœŸçš„æ˜¯æ— æ•ˆçš„äº‹æƒ…çš„å‘Šè­¦æ‰ä¼šç”Ÿæˆã€‚ï¼ˆè¿™è¿˜æ²¡æœ‰å®Œå…¨å®ç°ã€‚ï¼‰ä»»æ„çš„å…¶ä»– true å€¼éƒ½æ‰“å°éè‡´å‘½å‘Šè­¦ã€‚
ç»™ @code{LINT}  å˜é‡èµ‹å€¼ä¸º falseï¼Œä¼šå…³é—­ lint å‘Šè­¦ã€‚

æ­¤å˜é‡æ˜¯ä¸€ä¸ª @command{gawk} æ‰©å±•ã€‚åœ¨å…¶ä»–çš„ @command{awk} å®ç°ä¸­åˆ™å¹¶ä¸ç‰¹æ®Šã€‚ä¸å…¶ä»–çš„ç‰¹æ®Šå˜é‡ä¸åŒçš„æ˜¯ï¼Œ
æ”¹å˜ @code{LINT} å˜é‡ä¸ä¼šå½±å“ lint å‘Šè­¦çš„äº§ç”Ÿï¼Œå°±ç®— @command{gawk} æ˜¯å¤„äºå…¼å®¹æ¨¡å¼ã€‚
è™½ç„¶ @option{--lint} ä¸ @option{--traditional} é€‰é¡¹å•ç‹¬åœ°æ§åˆ¶ @command{gawk} è¡Œä¸ºçš„ä¸åŒæ–¹é¢ï¼Œä½†æ˜¯ç¨‹åºæ‰§è¡Œä¸­çš„ lint å‘Šè­¦çš„æ§åˆ¶æ˜¯ä¸ @command{awk} è¢«æ‰§è¡Œçš„æ–¹å¼æ˜¯æ— å…³çš„ã€‚

@cindex @code{OFMT} variable
@cindex numbers, converting, to strings
@cindex strings, converting, numbers to
@item OFMT
æ§åˆ¶ @code{print} è¯­å¥ä¸­ï¼Œæ•°å­—åˆ°å­—ä¸²çš„è½¬æ¢æ–¹å¼çš„å­—ä¸²ï¼ˆæŸ¥çœ‹ @ref{Conversion}ï¼‰ã€‚
å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯å°†å…¶ä½œä¸ºä¼ é€’ç»™ @code{sprintf()} å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚
å®ƒçš„é»˜è®¤å€¼æ˜¯ @code{"%.6g"}ã€‚æ—©æœŸçš„ @command{awk} ç‰ˆæœ¬ä½¿ç”¨ @code{OFMT} æ¥æŒ‡å®šå°†æ•°å€¼è½¬æ¢ä¸ºå­—ä¸²çš„æ ¼å¼çš„ä¸€èˆ¬è¡¨è¾¾å¼ï¼Œ
ä½†æ˜¯è¿™ä¸ªç°åœ¨ç”± @code{CONVFMT} æ¥å®Œæˆã€‚

@cindex @code{sprintf()} function, @code{OFMT} variable and
@cindex @code{print} statement, @code{OFMT} variable and
@cindex @code{OFS} variable
@cindex separators, field
@cindex field separators
@item OFS
è¾“å‡ºåŸŸåˆ†éš”ç¬¦ï¼ˆæŸ¥çœ‹ @ref{Output Separators}ï¼‰ã€‚å®ƒè¢«è¾“å‡ºåœ¨é€šè¿‡ @code{print} è¯­å¥æ‰“å°çš„åŸŸä¹‹é—´ã€‚
å®ƒçš„é»˜è®¤å€¼æ˜¯ @w{@code{" "}}ï¼Œå³ä¸€ä¸ªç©ºæ ¼çš„å­—ä¸²ã€‚

@cindex @code{ORS} variable
@item ORS
è¾“å‡ºè®°å½•çš„åˆ†éš”ç¬¦ã€‚å®ƒä¼šè¢«è¾“å‡ºåœ¨æ¯ä¸ª @code{print} è¯­å¥çš„åé¢ã€‚å…¶é»˜è®¤å€¼æ˜¯ @code{"\n"}ï¼Œ
å³æ¢è¡Œç¬¦ã€‚ï¼ˆæŸ¥çœ‹ @ref{Output Separators}ï¼‰

@cindex @code{PREC} variable
@item PREC #
ä»»æ„ç²¾åº¦æµ®ç‚¹æ•°çš„å·¥ä½œç²¾åº¦ï¼Œé»˜è®¤ä¸º 53 ä½ï¼ˆæŸ¥çœ‹ @ref{Setting precision}ï¼‰ã€‚

@cindex @code{ROUNDMODE} variable
@item ROUNDMODE #
ç”¨äºä»»æ„ç²¾åº¦æ•°å€¼ç®—æœ¯è®¡ç®—çš„èˆå…¥èˆå‡ºæ¨¡å¼ï¼Œé»˜è®¤ä¸º @code{"N"}
ï¼ˆå³ IEEE 754 æ ‡å‡†ä¸­çš„ @code{roundTiesToEven}ï¼‰ã€‚

@cindex @code{RS} variable
@cindex separators, for records
@cindex record separators
@item @code{RS}
è¾“å…¥è®°å½•çš„åˆ†éš”ç¬¦ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯åŒ…å«ä¸€ä¸ªæ¢è¡Œç¬¦çš„å­—ä¸²ï¼Œè¡¨ç¤ºè¾“å…¥çš„è®°å½•ç”±ä¸€è¡Œçš„æ–‡æœ¬ç»„æˆã€‚å®ƒçš„å€¼ä¹Ÿå¯ä»¥æ˜¯ç©ºä¸²ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®°å½•ç”±äºä¸€è¿ä¸²çš„ç©ºè¡Œåˆ†éš”ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™è®°å½•æ˜¯ç”±åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬è¿›è¡Œåˆ†å‰²ã€‚
ï¼ˆæŸ¥çœ‹ @ref{Records}ã€‚ï¼‰

@code{RS} å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„èƒ½åŠ›æ˜¯ @command{gawk} çš„æ‰©å±•ã€‚åœ¨å¤šæ•°çš„å…¶ä»– @command{awk} å®ç°ä¸­ï¼Œæˆ–è€… @command{gawk} æ˜¯å¤„äºå…¼å®¹æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œåªæœ‰ @code{RS} ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è¢«ç”¨æ¥è¿›è¡Œåˆ†å‰²è®°å½•ã€‚

@cindex @code{SUBSEP} variable
@cindex separators, subscript
@cindex subscript separators
@item @code{SUBSEP}
ä¸‹æ ‡åˆ†éš”ç¬¦ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯ @code{"\034"} ï¼Œå¹¶ç”¨æ¥ä½œä¸ºå¤šç»´æ•°ç»„ä¸‹æ ‡ç´¢å¼•çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œ
è¡¨è¾¾å¼ @samp{@w{foo["A", "B"]}} å®é™…ä¸Šæ˜¯è®¿é—® @code{foo["A\034B"]}
ï¼ˆæŸ¥çœ‹ @ref{Multidimensional}ï¼‰ã€‚

@cindex @command{gawk}, @code{TEXTDOMAIN} variable in
@cindex @code{TEXTDOMAIN} variable
@cindex differences in @command{awk} and @command{gawk}, @code{TEXTDOMAIN} variable
@cindex internationalization, localization
@item TEXTDOMAIN #
ç”¨äºåœ¨ @command{awk} å±‚ä¸­çš„ç¨‹åºçš„å›½é™…åŒ–ã€‚å®ƒè®¾ç½®é»˜è®¤çš„æ–‡æœ¬åŸŸï¼Œå…¶ç”¨æ¥åœ¨æºæ–‡æœ¬ä¸­ç”¨æ¥æ ‡è¯†å­—ä¸²å¸¸é‡ï¼Œä¹Ÿç”¨äº @code{dcgettext()}ï¼Œ@code{dcngettext()} ä¸ @code{bindtextdomain()} å‡½æ•°
ï¼ˆæŸ¥çœ‹ @ref{Internationalization}ï¼‰ã€‚@code{TEXTDOMAIN} çš„é»˜è®¤å€¼ä¸º @code{"messages"}ã€‚
@end table

@node Auto-set
@subsection ä¼ é€’ä¿¡æ¯çš„å†…ç½®å˜é‡

@cindex predefined variables, conveying information
@cindex variables, predefined conveying information
ä¸‹é¢çš„å˜é‡ï¼Œä»¥å­—æ¯é¡ºåºæ’åˆ—ï¼Œ@command{awk} åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹ä¼šè‡ªåŠ¨è®¾ç½®å®ƒçš„å€¼ï¼Œä»¥å‘ç¨‹åºä¼ é€’ä¿¡æ¯ã€‚

å¦‚æœæ˜¯ @command{gawk} ç‰¹æœ‰çš„å˜é‡ï¼Œåˆ™è¢«ç”¨äº•å·æ ‡è¯†ï¼ˆ@samp{#}ï¼‰ã€‚
è¿™äº›å˜é‡æ˜¯ @command{gawk} çš„æ‰©å±•ã€‚å¯¹äºå…¶ä»–çš„ @command{awk} å®ç°ï¼Œæˆ–è€…åœ¨å…¼å®¹æ¨¡å¼ä¸‹çš„ @command{gawk}ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œåˆ™å®ƒä»¬æ²¡æœ‰ç‰¹åˆ«å«ä¹‰ï¼š

@c @asis for docbook
@table @asis
@cindex @code{ARGC}/@code{ARGV} variables
@cindex arguments, command-line
@cindex command line, arguments
@item @code{ARGC}, @code{ARGV}
å‘½ä»¤è¡Œä¸­çš„å‚æ•°è¢«å­˜åœ¨äº†åä¸º @code{ARGV} çš„æ•°ç»„ä¸­ï¼Œå¹¶å¯ä»¥è¢« @command{awk} ç¨‹åºä½¿ç”¨ã€‚@code{ARGC} æ˜¯å‘½ä»¤è¡Œä¸­å‚æ•°çš„ä¸ªæ•°ã€‚
æŸ¥çœ‹ @ref{Other Arguments}ã€‚ä¸å¤§å¤šæ•°çš„ @command{awk} æ•°ç»„ä¸åŒï¼Œ@code{ARGV} çš„ä¸‹æ ‡ä» 0 åˆ° @code{ARGC} @minus{} 1ã€‚
åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼š

@example
$ @kbd{awk 'BEGIN @{}
>         @kbd{for (i = 0; i < ARGC; i++)}
>             @kbd{print ARGV[i]}
>      @kbd{@}' inventory-shipped mail-list}
@print{} awk
@print{} inventory-shipped
@print{} mail-list
@end example

@noindent
@code{ARGV[0]} åŒ…å« @samp{awk}ï¼Œ@code{ARGV[1]} åŒ…å« @samp{inventory-shipped}ï¼Œ@code{ARGV[2]} åŒ…å« @samp{mail-list}ã€‚
@code{ARGC} çš„å€¼ä¸º 3ï¼Œæ¯” @code{ARGV} æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡å¤§ 1ï¼Œå› ä¸ºå…ƒç´ æ˜¯ä» 0 å¼€å§‹ç¼–å·çš„ã€‚

@cindex programming conventions, @code{ARGC}/@code{ARGV} variables
@code{ARGC} ä¸ @code{ARGV} çš„åå­—ï¼Œä¸å…¶ä¸‹æ ‡ä¸ºä» 0 åˆ° @code{ARGC} @minus{} 1ï¼Œéƒ½æ˜¯ä» C è¯­è¨€ä¸­è®¿é—®å‘½ä»¤è¡Œå‚æ•°çš„æ–¹æ³•ç»§æ‰¿è€Œæ¥ã€‚

@cindex dark corner, value of @code{ARGV[0]}
@code{ARGV[0]} çš„å€¼ä¼šå› ä¸ºç³»ç»Ÿä¸åŒå¯èƒ½ä¸åŒã€‚åŒæ—¶ï¼Œä½ åº”è¯¥æ³¨æ„ç¨‹åºæ–‡æœ¬ä¸ @command{awk} çš„å‘½ä»¤è¡Œé€‰é¡¹éƒ½@emph{æ²¡æœ‰}åŒ…å«åœ¨ @code{ARGV} ä¸­ã€‚
æŸ¥çœ‹ @ref{ARGC and ARGV}ï¼Œæ¥è·å–ä½¿ç”¨è¿™äº› @command{awk} å˜é‡çš„ä¿¡æ¯ã€‚
@value{DARKCORNER}

@cindex @code{ARGIND} variable
@cindex differences in @command{awk} and @command{gawk}, @code{ARGIND} variable
@item @code{ARGIND #}
å½“å‰æ­£åœ¨è¢«å¤„ç†çš„æ–‡ä»¶åœ¨ @code{ARGV} ä¸­çš„ç´¢å¼•ã€‚æ¯æ¬¡ @command{gawk} æ‰“å¼€ä¸€ä¸ª@value{DF}è¿›è¡Œå¤„ç†ï¼Œ
å®ƒå°±ä¼šè®¾ç½® @code{ARGIND} çš„å€¼ä¸ºæ–‡ä»¶ååœ¨ @code{ARGV} ä¸­çš„ç´¢å¼•ã€‚
å½“ @command{gawk} å¤„ç†è¾“å…¥æ–‡ä»¶æ—¶ï¼Œ@samp{FILENAME == ARGV[ARGIND]} çš„å€¼æ€»æ˜¯ä¸º trueã€‚

@cindex files, processing@comma{} @code{ARGIND} variable and
è¿™ä¸ªå˜é‡åœ¨å¤„ç†æ–‡ä»¶æ—¶å¾ˆæœ‰ç”¨ï¼Œå®ƒå¯ä»¥è®©ä½ çŸ¥é“@value{DF}ä¸­å·²ç»å¤„ç†äº†å¤šå°‘ï¼Œä»¥åŠç”¨æ¥åŒºåˆ†åœ¨å‘½ä»¤è¡Œä¸­ä¸¤ä¸ªè¿ç»­çš„åŒåæ–‡ä»¶ã€‚

@cindex file names, distinguishing
å½“ä½ åœ¨ @command{awk} ç¨‹åºä¸­æ”¹å˜ @code{ARGIND} å˜é‡çš„å€¼æ—¶ï¼Œ@command{gawk} ä¼šåœ¨æ‰“å¼€ä¸‹ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè‡ªåŠ¨è®¾ç½®å®ƒä¸ºæ–°çš„å€¼ã€‚

@cindex @code{ENVIRON} array
@cindex environment variables, in @code{ENVIRON} array
@item @code{ENVIRON}
ä¸€ä¸ªåŒ…å«ç¯å¢ƒå˜é‡ä»¥å…¶å€¼çš„å…³è”æ•°ç»„ã€‚æ•°ç»„çš„ç´¢å¼•æ˜¯ç¯å¢ƒå˜é‡åï¼Œå…ƒç´ åˆ™æ˜¯ç‰¹å®šç¯å¢ƒå˜é‡çš„å€¼ã€‚
ä¾‹å¦‚ @code{ENVIRON["HOME"]} çš„å€¼å¯ä»¥æ˜¯ @code{"/home/arnold"}ã€‚
æ”¹å˜è¿™ä¸ªæ•°ç»„ä¸ä¼šå½±å“ä¼ é€’åˆ°ä»»æ„çš„é€šè¿‡ @code{system()} å‡½æ•°æˆ–è€…é‡å®šå‘å¯åŠ¨çš„ç¨‹åºçš„ç¯å¢ƒå˜é‡ã€‚ï¼ˆåœ¨åç»­çš„ @command{gawk} ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½ä¼šæœ‰å½±å“ã€‚ï¼‰

æœ‰ä¸€äº›æ“ä½œç³»ç»Ÿæ²¡æœ‰ç¯å¢ƒå˜é‡ã€‚åœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œ@code{ENVIRON} æ•°ç»„ä¸ºç©º
ï¼ˆé™¤äº† @w{@code{ENVIRON["AWKPATH"]}} ä¸ @w{@code{ENVIRON["AWKLIBPATH"]}}ï¼Œ
æŸ¥çœ‹ @ref{AWKPATH Variable}ï¼Œä¸ 
@ifdocbook
@ref{AWKLIBPATH Variable}ï¼‰ã€‚
@end ifdocbook
@ifnotdocbook
@ref{AWKLIBPATH Variable}ï¼‰ã€‚
@end ifnotdocbook

@cindex @command{gawk}, @code{ERRNO} variable in
@cindex @code{ERRNO} variable
@cindex differences in @command{awk} and @command{gawk}, @code{ERRNO} variable
@cindex error handling, @code{ERRNO} variable and
@item @code{ERRNO #}
å¦‚æœåœ¨ä¸º @code{getline} è¿›è¡Œé‡å®šå‘ã€è¯»å–æ—¶ï¼Œæˆ–è€…è¿›è¡Œ @code{close()} æ“ä½œä¸­ï¼Œå‘ç”Ÿäº†ç³»ç»Ÿé”™è¯¯ï¼Œ
åˆ™ @code{ERRNO} ä¼šåŒ…å«ä¸€ä¸ªæè¿°é”™è¯¯çš„å­—ä¸²ã€‚

å¦å¤–ï¼Œ@command{gawk} ä¼šåœ¨æ¯ä¸€ä¸ªå‘½ä»¤è¡Œä¸­çš„è¾“å…¥æ–‡ä»¶çš„æ“ä½œå‰æ¸…ç©º @code{ERRNO}ã€‚
è¿™æ ·å¯ä»¥åœ¨ @code{BEGINFILE} æ¨¡å¼ä¸­æ£€æŸ¥æ–‡ä»¶çš„å¯è¯»æ€§ï¼ˆæŸ¥çœ‹ @ref{BEGINFILE/ENDFILE}ï¼‰ã€‚

å…¶ä»–æƒ…å†µï¼Œ@code{ERRNO} çš„ä½œç”¨å°±ç±»ä¼¼äº C å˜é‡ @code{errno}ã€‚
é™¤äº†åˆ™æ‰æ‰€æåˆ°çš„å‡ ä¸ªç§æƒ…å†µï¼Œ@command{gawk} @emph{ç»ä¸ä¼š}æ¸…é™¤å®ƒï¼ˆå³å°†å…¶è®¾ç½®ä¸º 0ï¼Œæˆ–è€… @code{""}ï¼‰ã€‚
å› æ­¤ï¼Œåªæœ‰åœ¨ I/O æ“ä½œè¿”å›ä¸€ä¸ªå¤±è´¥çš„å€¼çš„æƒ…å†µä¸‹ï¼Œä½ æ‰å¯å¯„å¸Œæœ›äºå®ƒçš„å€¼æœ‰æ„ä¹‰ï¼Œä¾‹å¦‚ @code{getline} è¿”å› @minus{}1ã€‚
å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œ I/O æ“ä½œä¹‹å‰è‡ªå·±æ¸…ç†å®ƒã€‚

@cindex @code{FILENAME} variable
@cindex dark corner, @code{FILENAME} variable
@item @code{FILENAME}
å½“å‰è¾“å…¥æ–‡ä»¶çš„åå­—ã€‚å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æ²¡æœ‰è¾“å…¥æ–‡ä»¶æ—¶ï¼Œ@command{awk} ä¼šä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®ï¼ŒåŒæ—¶ @code{FILENAME} çš„å€¼ä¼šè®¾ç½®æˆ @code{"-"}ã€‚
@code{FILENAME} æ¯æ¬¡è¯»å–æ–°æ–‡ä»¶çš„æ—¶å€™éƒ½ä¼šæ”¹å˜ï¼ˆæŸ¥çœ‹ @ref{Reading Files}ï¼‰ã€‚
åœ¨ @code{BEGIN} è§„åˆ™å†…ï¼Œ@code{FILENAME} çš„å€¼ä¸º @code{""}ï¼Œå› ä¸ºè¿™æ—¶è¿˜æ²¡æœ‰è¾“å…¥æ–‡ä»¶è¢«å¤„ç†ã€‚
@footnote{æœ‰ä¸€äº› Unix @command{awk} çš„æ—©æœŸå®ç°å°† @code{FILENAME} çš„å€¼è®¾ç½®æˆ @code{"-"}ï¼Œ
å°±ç®—è¿˜æ²¡æœ‰æ–‡ä»¶è¢«å¤„ç†ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯ä¸æ­£ç¡®çš„ï¼Œåœ¨ä½ çš„ç¨‹åºä¸­ä¸èƒ½ä¾èµ–äºå®ƒã€‚}
@value{DARKCORNER}
ä½†æ˜¯ï¼Œåœ¨ @code{BEGIN} è§„åˆ™ä¸­ä½¿ç”¨ @code{getline} ï¼ˆæŸ¥çœ‹ @ref{Getline}ï¼‰å¯ä»¥ä½¿ @code{FILENAME} æœ‰ä¸€ä¸ªå€¼ã€‚

@cindex @code{FNR} variable
@item @code{FNR}
å½“å‰æ–‡ä»¶çš„å½“å‰è®°å½•æ•°ã€‚@command{awk} æ¯è¯»ä¸€ä¸ªæ–°è®°å½•çš„æ—¶å€™ï¼Œä¼šé€’å¢ @code{FNR}ï¼ˆæŸ¥çœ‹ @ref{Records}ï¼‰ã€‚
@command{awk} æ¯æ¬¡å¼€å§‹è¯»å–ä¸€ä¸ªæ–°æ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šå°† @code{FNR} è®¾ç½®ä¸º 0ã€‚

@cindex @code{NF} variable
@item @code{NF}
å½“å‰è¾“å…¥è®°å½•çš„åŸŸæ•°å€¼ã€‚@code{NF} æ¯è¯»ä¸€ä¸ªæ–°è®°å½•ï¼Œå¹¶ä¸”åŸŸå·²ç»ç”Ÿæˆçš„æ—¶å€™ï¼Œå°±ä¼šè¢«é‡ç½®ï¼Œæˆ–è€…æ˜¯ @code{$0} æ”¹å˜ä¹Ÿä¼šé‡ç½®
ï¼ˆæŸ¥çœ‹ @ref{Fields}ï¼‰ã€‚

ä¸åœ¨æœ¬èŠ‚ä¸­æè¿°çš„å…¶ä»–å¤§å¤šæ•°å˜é‡ä¸åŒï¼Œç»™ @code{NF} èµ‹å€¼å¯¹ @command{awk} çš„å†…éƒ¨å·¥ä½œæœ‰ä¸€äº›æ½œåœ¨çš„æ•ˆæœã€‚å…·ä½“åœ°è¯´ï¼Œ
ç»™ @code{NF} èµ‹å€¼å¯èƒ½åˆ›å»ºæ–°çš„åŸŸï¼Œæˆ–è€…æ˜¯ä»å½“å‰çš„è®°å½•ä¸­åˆ é™¤åŸŸã€‚æŸ¥çœ‹ @ref{Changing Fields}ã€‚

@cindex @code{FUNCTAB} array
@cindex @command{gawk}, @code{FUNCTAB} array in
@cindex differences in @command{awk} and @command{gawk}, @code{FUNCTAB} variable
@item @code{FUNCTAB #}
ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ç´¢å¼•ä»¥åŠå¯¹åº”çš„å€¼å…¨éƒ¨éƒ½æ˜¯å†…å»ºçš„ï¼Œç”¨æˆ·å®šä¹‰çš„ï¼Œä»¥åŠç¨‹åºä¸­æ‰©å±•çš„å‡½æ•°ã€‚

@quotation æç¤º
åœ¨ @code{FUNCTAB} ä¸Šå°è¯•ç”¨ @code{delete} è¯­å¥ä¼šå¯¼è‡´è‡´ä½¿é”™è¯¯ã€‚è€Œå¯¹å…¶å…ƒç´ è¿›è¡Œèµ‹å€¼ï¼Œä¹Ÿä¼šå¯¼è‡´å‘½ä»¤é”™è¯¯ã€‚
@end quotation

@cindex @code{NR} variable
@item @code{NR}
ä»ç¨‹åºæ‰§è¡Œå¼€å§‹åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œ@command{awk} å·²ç»å¤„ç†çš„è®°å½•çš„ä¸ªæ•°ï¼ˆæŸ¥çœ‹ @ref{Records}ï¼‰ã€‚
@command{awk} æ¯è¯»ä¸€ä¸ªæ–°è®°å½•å°±ä¼šå¯¹å…¶è¿›è¡Œé€’å¢ã€‚

@cindex @command{gawk}, @code{PROCINFO} array in
@cindex @code{PROCINFO} array
@cindex differences in @command{awk} and @command{gawk}, @code{PROCINFO} array
@item @code{PROCINFO #}
è¿™ä¸ªæ•°ç»„çš„å…ƒç´ ä¸ºè¿è¡Œä¸­çš„ç¨‹åºçš„ä¿¡æ¯æä¾›äº†è®¿é—®æ‰‹æ®µã€‚ä¸‹é¢çš„å…ƒç´ ï¼ˆæŒ‰å­—æ¯é¡ºåºï¼‰ä¿è¯å¯ç”¨ï¼š

@table @code
@cindex effective group ID of @command{gawk} user
@item PROCINFO["egid"]
ç³»ç»Ÿè°ƒç”¨ @code{getegid()} çš„å€¼ã€‚

@item PROCINFO["euid"]
@cindex effective user ID of @command{gawk} user
ç³»ç»Ÿè°ƒç”¨ @code{geteuid()} çš„å€¼ã€‚

@item PROCINFO["FS"]
å¦‚æœåŸŸåˆ†å‰²æ–¹å¼æ˜¯ @code{FS}ï¼Œåˆ™å…¶å€¼ä¸º â€œ@code{FS}â€ï¼Œå¦‚æœæ˜¯ @code{FIELDWIDTHS} åˆ†å‰²æ–¹å¼èµ·ä½œç”¨ï¼Œåˆ™å…¶å€¼ä¸º â€œ@code{FIELDWIDTHS}â€ï¼Œ
å¦‚æœæ˜¯ @code{FPAT} æ–¹å¼è¿›è¡Œåˆ†å‰²ï¼Œåˆ™å…¶å€¼ä¸º @code{"FPAT"}ã€‚

@item PROCINFO["gid"]
@cindex group ID of @command{gawk} user
ç³»ç»Ÿè°ƒç”¨ @code{getgid()} çš„å€¼ã€‚

@item PROCINFO["identifiers"]
@cindex program identifiers
ä¸€ä¸ªå­æ•°ç»„ï¼Œç”±åœ¨ @command{awk} ç¨‹åºæ–‡ä»¶ä¸­æ‰€ä½¿ç”¨çš„æ ‡è¯†ç¬¦åå­—è¿›è¡Œç´¢å¼•ã€‚ä¸€ä¸ª@dfn{æ ‡è¯†ç¬¦}ç®€å•åœ°è¯´å°±æ˜¯å˜é‡çš„åå­—
ï¼ˆå˜é‡æ˜¯ä¸€ä¸ªæ ‡é‡æˆ–è€…æ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å†…å»ºå‡½æ•°ï¼Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œæˆ–è€…æ˜¯å‡½æ•°æ‰©å±•ã€‚å¯¹æ¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå…ƒç´ çš„å€¼å¯èƒ½æ˜¯ä¸‹é¢å…¶ä¸­ä¹‹ä¸€ï¼š

@table @code
@item "array"
æ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

@item "builtin"
æ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªå†…å»ºå‡½æ•°ã€‚

@item "extension"
æ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªå‡½æ•°æ‰©å±•ï¼Œå¹¶é€šè¿‡ @code{@@load} æˆ–è€… @option{-l} è¿›è¡Œè£…è½½ã€‚

@item "scalar"
æ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªæ ‡é‡ã€‚

@item "untyped"
æ ‡è¯†ç¬¦æ˜¯æ— ç±»å‹çš„ï¼ˆå¯ç”¨äºæ ‡é‡æˆ–è€…æ˜¯æ•°ç»„ï¼Œ@command{gawk} è¿˜ä¸çŸ¥é“è€Œå·²ï¼‰ã€‚

@item "user"
æ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ã€‚
@end table

@noindent
å…¶å€¼æ˜¾ç¤ºäº† @command{gawk} å®Œæˆç¨‹åºçš„åˆ†æåï¼Œ
å¯¹æ‰€äº†è§£åˆ°çš„æ ‡è¯†ç¬¦çš„æƒ…å†µï¼Œå®ƒä»¬çš„å€¼åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­@emph{ä¸èƒ½}æ›´æ–°ã€‚

@item PROCINFO["pgrpid"]
@cindex process group ID of @command{gawk} process
å½“å‰è¿›ç¨‹çš„ç»„ IDã€‚

@item PROCINFO["pid"]
@cindex process ID of @command{gawk} process
å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ IDã€‚

@item PROCINFO["ppid"]
@cindex parent process ID of @command{gawk} process
å½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹çš„è¿›ç¨‹ IDã€‚

@item PROCINFO["strftime"]
@code{strftime()} æ—¶é—´å‡½æ•°çš„é»˜è®¤æ ¼å¼ä¸²ã€‚å¯¹è¿™ä¸ªå€¼è¿›è¡Œèµ‹å€¼å¯ä»¥æ”¹å˜é»˜è®¤ä¸²ï¼ŒæŸ¥çœ‹ @ref{Time Functions}ã€‚

@item PROCINFO["uid"]
ç³»ç»Ÿè°ƒç”¨ @code{getuid()} çš„å€¼ã€‚

@item PROCINFO["version"]
@cindex version of @command{gawk}
@cindex @command{gawk} version
@command{gawk} çš„ç‰ˆæœ¬å·ã€‚
@end table

ä¸‹é¢åœ¨æ•°ç»„ä¸­çš„é¢å¤–å…ƒç´ ï¼Œå¦‚æœä½ çš„ @command{gawk} ç‰ˆæœ¬æ”¯æŒä»»æ„ç²¾åº¦çš„ç®—æœ¯è¿ç®—ï¼ˆæŸ¥çœ‹ @ref{Arbitrary Precision Arithmetic}ï¼‰ï¼Œ
åˆ™å®ƒä»¬ä¼šåœ¨æ•°ç»„ä¸­å­˜åœ¨ï¼Œå¹¶æä¾›å…³äº MPFR ä»¥åŠ GMP åº“çš„ç›¸å…³ä¿¡æ¯ã€‚

@table @code
@item PROCINFO["gmp_version"]
@cindex version of GNU MP library
GNU MP åº“çš„ç‰ˆæœ¬ã€‚

@cindex version of GNU MPFR library
@item PROCINFO["mpfr_version"]
GNU MPFR åº“çš„ç‰ˆæœ¬ã€‚

@item PROCINFO["prec_max"]
@cindex maximum precision supported by MPFR library
MPFR æ”¯æŒçš„æœ€å¤§ç²¾åº¦ã€‚

@item PROCINFO["prec_min"]
@cindex minimum precision required by MPFR library
MPFR æ‰€è¦æ±‚çš„æœ€å°ç²¾åº¦ã€‚
@end table

ä¸‹é¢çš„é™„åŠ å…ƒç´ ï¼Œå¦‚æœä½ çš„ @command{gawk} ç‰ˆæœ¬æ”¯æŒåŠ¨æ€è£…è½½æ‰©å±•å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{Dynamic Extensions}ï¼‰ï¼Œåˆ™ä¼šåœ¨æ•°ç»„ä¸­å­˜åœ¨ï¼Œå¹¶å‘ä½ æä¾›è¿™äº›æ‰©å±• API çš„ç‰ˆæœ¬ä¿¡æ¯ï¼š

@table @code
@item PROCINFO["api_major"]
@cindex version of @command{gawk} extension API
@cindex extension API, version number
æ‰©å±• API çš„ä¸»ç‰ˆæœ¬ã€‚

@item PROCINFO["api_minor"]
æ‰©å±• API çš„æ¬¡ç‰ˆæœ¬ã€‚
@end table

@cindex supplementary groups of @command{gawk} process
åœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œæœ‰å¯èƒ½å­˜åœ¨ @code{"group1"} åˆ°å€¼ä¸º @var{N} çš„ @code{"group@var{N}"} çš„å…ƒç´ å­˜åœ¨ã€‚
@var{N} æ˜¯è¿›ç¨‹æ‰€æœ‰çš„è¡¥å……ç»„çš„æ•°å€¼ã€‚ä½¿ç”¨ @code{in} æ“ä½œç¬¦æ¥æµ‹è¯•è¿™äº›å…ƒç´ ï¼ˆæŸ¥çœ‹ @ref{Reference to Elements}ï¼‰ã€‚

ä¸‹é¢çš„é™„åŠ å…ƒç´ å…è®¸ä½ æ”¹å˜ @command{gawk} çš„è¡Œä¸ºï¼š

@table @code
@item PROCINFO["@var{command}", "pty"]
å¯ä»¥ä½¿ç”¨ pseudo-tty ä»£æ›¿åŒå‘ç®¡é“è¿›è¡ŒåŒå‘é€šä¿¡ã€‚æŸ¥çœ‹ @ref{Two-way I/O} å…³äºæ›´å¤šä¿¡æ¯ã€‚

@item PROCINFO["@var{input_name}", "READ_TIMEOUT"]
åœ¨ä»é‡å®šå‘è¾“å…¥ä¸­è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªè¶…æ—¶æç¤ºã€‚
æŸ¥çœ‹ @ref{Read Timeout} å…³äºæ›´å¤šä¿¡æ¯ã€‚

@item PROCINFO["sorted_in"]
å¦‚æœè¿™ä¸ªå…ƒç´ åœ¨ @code{PROCINFO} ä¸­å­˜åœ¨ï¼Œåˆ™å®ƒçš„å€¼æ§åˆ¶é’ˆå¯¹æ•°ç»„ç´¢å¼•åœ¨ @samp{for (@var{indx} in @var{array})} å¾ªç¯ä¸­çš„å¤„ç†é¡ºåºã€‚
è¿™æ˜¯ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œå› æ­¤æˆ‘ä»¬åå†è¯¦ç»†è®¨è®ºã€‚æŸ¥çœ‹ @ref{Scanning an Array}ã€‚
@end table

@cindex @code{RLENGTH} variable
@item @code{RLENGTH}
@code{match()} å‡½æ•°åŒ¹é…çš„å­ä¸²çš„é•¿åº¦ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚
@code{RLENGTH} åœ¨è°ƒç”¨ @code{match()} å‡½æ•°æ—¶è¢«è®¾ç½®ã€‚å®ƒçš„å€¼æ˜¯åŒ¹é…ä¸²çš„é•¿åº¦ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…æ‰¾åˆ°ï¼Œåˆ™å€¼ä¸º @minus{}1ã€‚

@cindex @code{RSTART} variable
@item @code{RSTART}
è°ƒç”¨ @code{match()} å‡½æ•°æ‰€åŒ¹é…çš„å­ä¸²çš„å¼€å§‹å­—ç¬¦çš„ä¸‹æ ‡ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚
@code{RSTART} åœ¨è°ƒç”¨ @code{match()} å‡½æ•°çš„æ—¶å€™è¢«è®¾ç½®ã€‚å®ƒçš„å€¼æ˜¯åŒ¹é…ä¸²çš„åœ¨ä¸²ä¸­çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸²ï¼Œåˆ™å…¶å€¼ä¸º 0ã€‚

@cindex @command{gawk}, @code{RT} variable in
@cindex @code{RT} variable
@cindex differences in @command{awk} and @command{gawk}, @code{RT} variable
@item @code{RT #}
è¾“å…¥æ–‡ä»¶ä¸­åŒ¹é…ç”± @code{RS}ï¼Œå³è®°å½•åˆ†éš”ç¬¦ï¼Œè¡¨ç¤ºçš„ä¸²ã€‚æ¯æ¬¡è¯»å–ä¸€ä¸ªè®°å½•æ—¶ï¼Œåˆ™å…¶å€¼ä¼šè¢«è®¾ç½®ã€‚

@cindex @command{gawk}, @code{SYMTAB} array in
@cindex @code{SYMTAB} array
@cindex differences in @command{awk} and @command{gawk}, @code{SYMTAB} variable
@item @code{SYMTAB #}
åœ¨ç¨‹åºä¸­ç”±åå­—è¿›è¡Œç´¢å¼•çš„æ‰€æœ‰å…¨å±€å®šä¹‰çš„å˜é‡ä¸æ•°ç»„çš„æ•°ç»„ã€‚
@code{SYMTAB} ä½¿å¾— @command{gawk} çš„ç¬¦å·è¡¨å¯ç”± @command{awk} ç¨‹åºå‘˜çœ‹åˆ°ã€‚å®ƒåœ¨ @command{gawk} åˆ†æç¨‹åºçš„æ—¶å€™å»ºç«‹ï¼Œå¹¶åœ¨ç¨‹åºå¼€å§‹æ‰§è¡Œå‰å®Œæˆã€‚

è¿™ä¸ªæ•°ç»„å¯ä»¥ç”¨æ¥é—´æ¥åœ°è¯»å–ä¸å†™å…¥ä¸€ä¸ªæ•°é‡çš„å€¼ï¼š

@example
foo = 5
SYMTAB["foo"] = 4
print foo    # prints 4
@end example

@noindent
@code{isarray()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{Type Functions}ï¼‰å¯ä»¥ç”¨æ¥æµ‹è¯• @code{SYMTAB} ä¸­çš„å…ƒç´ æ˜¯å¦ä¸ºæ•°ç»„ã€‚
ç±»ä¼¼åœ°ï¼Œä½ ä¹Ÿä¸å¯ä»¥å¯¹ @code{SYMTAB} ä¸­çš„å…ƒç´ ä½¿ç”¨ delete è¯­å¥ã€‚

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ²¡æœ‰å®šä¹‰çš„æ ‡è¯†ç¬¦ä½œä¸º @code{SYMTAB} çš„ä¸‹æ ‡ï¼š

@example
SYMTAB["xxx"] = 5
print SYMTAB["xxx"]
@end example

@noindent
å¦‚ä¸‹æƒ…å†µï¼Œå…¶è¿è¡Œä¸é¢„æœŸä¸€è‡´ï¼š@code{SYMTAB} å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°ç»„ã€‚å”¯ä¸€çš„ä¸åŒå°±æ˜¯ä½ ä¸å¯ä»¥åˆ é™¤ @code{SYMTAB["xxx"]}ã€‚

@cindex Schorr, Andrew
@code{SYMTAB} æ¯”åˆçœ‹èµ·æ¥è¦æœ‰è¶£å¾—å¤šã€‚Andrew Schorr æŒ‡å‡ºæ¥ï¼Œå¯ä»¥ç”¨å…¶ä½œä¸º @command{awk} çš„æ•°ç»„æŒ‡é’ˆã€‚çœ‹çœ‹ä»–çš„ä¾‹å­ï¼š

@example
# Indirect multiply of any variable by amount, return result

function multiply(variable, amount)
@{
    return SYMTAB[variable] *= amount
@}
@end example

@noindent
ä½ å¯ä»¥è¿™ä¹ˆç”¨å®ƒï¼š

@example
BEGIN @{
    answer = 10.5
    multiply("answer", 4)
    print "The answer is", answer
@}
@end example

@noindent
å½“è¿™æ®µç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œäº§ç”Ÿè¿™æ ·çš„ç»“æœï¼š

@example
$ @kbd{gawk -f answer.awk}
@print{} The answer is 42
@end example

@quotation æç¤º
ä¸ºäº†é¿å…ä¸¥é‡çš„é•¿æ—¶é—´æ—…è¡Œæ‚–è®ºï¼Œ
@footnote{æ›´ä¸ç”¨æåœ¨å®ç°ä¸Šçš„å›°éš¾ã€‚}
ä¸ç®¡æ˜¯ @code{FUNCTAB} è¿˜æ˜¯ @code{SYMTAB} éƒ½ä¸èƒ½ä½œä¸º @code{SYMTAB} æ•°ç»„ä¸­çš„å…ƒç´ ã€‚
@end quotation
@end table

@sidebar æ”¹å˜ @code{NR} ä¸ @code{FNR}
@cindex @code{NR} variable, changing
@cindex @code{FNR} variable, changing
@cindex dark corner, @code{FNR}/@code{NR} variables
æ¯æ¬¡è¯»å–ä¸€ä¸ªè®°å½•æ—¶ï¼Œ@command{awk} å°±æ˜¯é€’å¢ @code{NR} ä¸ @code{FNR} çš„å€¼ï¼Œè€Œä¸æ˜¯ç›´æ¥å°†å®ƒä»¬è®¾ç½®æˆå·²è¯»è®°å½•çš„ç»å¯¹å€¼ã€‚è¿™æ„å‘³ç€ï¼Œç¨‹åºå¯ä»¥æ”¹å˜è¿™äº›å˜é‡çš„å€¼ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªè®°å½•é—´éƒ½å°†è¢«é€’å¢ã€‚
@value{DARKCORNER}
ä¸‹é¢çš„ä¾‹å­å¯ä»¥è¯´æ˜ï¼š

@example
$ @kbd{echo '1}
> @kbd{2}
> @kbd{3}
> @kbd{4' | awk 'NR == 2 @{ NR = 17 @}}
> @kbd{@{ print NR @}'}
@print{} 1
@print{} 17
@print{} 18
@print{} 19
@end example

@noindent
åœ¨ @code{FNR} è¢«åŠ å…¥åˆ° @command{awk} è¯­è¨€ä¹‹å‰ï¼ˆæŸ¥çœ‹ @ref{V7/SVR3.1}ï¼‰ï¼Œ
å¾ˆå¤šçš„ @command{awk} ç¨‹åºä½¿ç”¨è¿™ä¸ªç‰¹æ€§æ¥è·Ÿè¸ªæ–‡ä»¶ä¸­çš„è®°å½•æ•°ï¼Œè¿™åªéœ€è¦åœ¨ @code{FILENAME} å˜åŒ–æ—¶ï¼Œå°† @code{NR} çš„å€¼è®¾ç½®æˆ 0 å³å¯ã€‚
@end sidebar

@node ARGC and ARGV
@subsection ä½¿ç”¨ @code{ARGC} ä¸ @code{ARGV}
@cindex @code{ARGC}/@code{ARGV} variables, how to use
@cindex arguments, command-line
@cindex command line, arguments

åœ¨ @ref{Auto-set}ï¼Œä¸­æœ‰æä¾›ä¸‹é¢çš„ç¨‹åºæ¥æè¿°åŒ…å«åœ¨ @code{ARGC} ä¸ @code{ARGV} ä¸­çš„ä¿¡æ¯ï¼š

@example
$ @kbd{awk 'BEGIN @{}
>        @kbd{for (i = 0; i < ARGC; i++)}
>            @kbd{print ARGV[i]}
>      @kbd{@}' inventory-shipped mail-list}
@print{} awk
@print{} inventory-shipped
@print{} mail-list
@end example

@noindent
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ@code{ARGV[0]} åŒ…å« @samp{awk}ï¼Œ@code{ARGV[1]} åŒ…å« @samp{inventory-shipped}ï¼Œ
è€Œ @code{ARGV[2]} åŒ…å« @samp{mail-list} ã€‚æ³¨æ„ @command{awk} ç¨‹åºå¹¶æ²¡æœ‰åœ¨ @code{ARGV} ä¸­ã€‚å…¶ä»–çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œä»¥åŠå®ƒä»¬çš„å‚æ•°éƒ½æ²¡æœ‰è¿›å…¥åˆ°è¿™ä¸ªæ•°ç»„ä¸­ã€‚
è¿™ä¹ŸåŒ…æ‹¬é€šè¿‡ @option{-v} å‚æ•°ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰è¿›è¡Œå˜é‡èµ‹å€¼çš„éƒ¨åˆ†ã€‚
åœ¨å‘½ä»¤è¡Œä¸­çš„æ­£å¸¸çš„å˜é‡èµ‹å€¼@emph{è¢«}å½“æˆå‚æ•°å¯¹å¾…ï¼Œ
å¹¶ä¸”ä¼šåœ¨ @code{ARGV} ä¸­å‡ºç°ã€‚æœ‰ä¸‹é¢çš„åä¸º @file{showargs.awk} çš„æ–‡ä»¶ï¼š

@example
BEGIN @{
    printf "A=%d, B=%d\n", A, B
    for (i = 0; i < ARGC; i++)
        printf "\tARGV[%d] = %s\n", i, ARGV[i]
@}
END   @{ printf "A=%d, B=%d\n", A, B @}
@end example

@noindent
è¿è¡Œç¨‹åºä¼šäº§ç”Ÿå¦‚ä¸‹è¾“å‡ºï¼š

@example
$ @kbd{awk -v A=1 -f showargs.awk B=2 /dev/null}
@print{} A=1, B=0
@print{}        ARGV[0] = awk
@print{}        ARGV[1] = B=2
@print{}        ARGV[2] = /dev/null
@print{} A=1, B=2
@end example

ç¨‹åºå¯ä»¥æ”¹å˜ @code{ARGC} ä¸ @code{ARGV} çš„å…ƒç´ å€¼ã€‚å½“æ¯æ¬¡ @command{awk} è¾¾åˆ°æ–‡ä»¶å°¾æ—¶ï¼Œ
å®ƒä¼šä½¿ç”¨ @code{ARGV} çš„ä¸‹ä¸€ä¸ªå…ƒç´ ä½œä¸ºè¾“å…¥æ–‡ä»¶ã€‚
é€šè¿‡åœ¨é‚£ä¸ªä½ç½®å­˜å…¥ä¸€ä¸ªä¸åŒçš„ä¸²ï¼Œç¨‹åºå°±å¯ä»¥æ”¹å˜è¦è¯»å–çš„æ–‡ä»¶ã€‚ä½¿ç”¨ @code{"-"} æ¥è¡¨ç¤ºæ ‡å‡†è¾“å…¥ã€‚
å­˜å‚¨é¢å¤–çš„å…ƒç´ å¹¶é€’å¢ @code{ARGC} çš„å€¼ï¼Œå¯ä»¥å¤„ç†é¢å¤–çš„æ–‡ä»¶ã€‚

å¦‚æœ @code{ARGC} çš„å€¼è¢«é€’å‡äº†ï¼Œåˆ™ä¼šä»å°†è¾“å…¥æ–‡ä»¶ä»åˆ—è¡¨çš„å°¾éƒ¨åˆ é™¤ã€‚é€šè¿‡åœ¨å…¶ä»–åœ°æ–¹è®°å½• @code{ARGC} çš„æ—§å€¼ï¼Œ
ç¨‹åºå¯ä»¥å°†å–æ¶ˆçš„å‚æ•°å½“åšå…¶ä»–ä¸œè¥¿æ¥å¯¹å¾…ï¼Œè€Œä¸æ˜¯@value{FN}ã€‚

ä¸ºäº†ä»åˆ—è¡¨çš„ä¸­é—´å°†æ–‡ä»¶æ’é™¤ï¼Œå¯ä»¥å°†ç©ºä¸²ï¼ˆ@code{""}ï¼‰å­˜åˆ° @code{ARGV} ä¸­æ¥ä»£æ›¿@value{FN}ã€‚ä½œç”¨ä¸€ä¸ªç‰¹æ®Šçš„ç‰¹æ€§ï¼Œ
@command{awk} ä¼šå¿½ç•¥é‚£äº›ç”¨ç©ºä¸²æ›¿æ¢æ‰çš„æ–‡ä»¶ã€‚å¦ä¸€ä¸ªé€‰æ‹©å°±æ˜¯ç”¨ @code{delete} è¯­å¥æ¥ç§»é™¤ @code{ARGV} ä¸­çš„å…ƒç´ ï¼ˆæŸ¥çœ‹ @ref{Delete}ï¼‰ã€‚

æ‰€æœ‰è¿™äº›åŠ¨ä½œä¸€èˆ¬éƒ½è¦åœ¨ @code{BEGIN} è§„åˆ™ä¸­å®Œæˆï¼Œä¹Ÿå°±æ˜¯åœ¨ç¨‹åºå®é™…å¤„ç†è¾“å…¥å‰ã€‚æŸ¥çœ‹ @ref{Split Program}ï¼Œ
ä»¥åŠ
@ifnotdocbook
@ref{Tee Program}
@end ifnotdocbook
@ifdocbook
@ref{Tee Program}
@end ifdocbook
ä¸­çš„ä¾‹å­ï¼Œæ¥è·å–ä» @code{ARGV} ä¸­åˆ é™¤å…ƒç´ çš„å„ç§æ–¹æ³•ã€‚

ä¸ºäº†å–å¾—è¾“å…¥ @command{awk} ç¨‹åºä¸­çš„é€‰é¡¹ï¼Œç”¨ @option{--} æ¥ç»“æŸ @command{awk} çš„é€‰é¡¹ï¼Œ
ç„¶åå†æä¾› @command{awk} ç¨‹åºçš„é€‰é¡¹ï¼Œå¦‚ä¸‹é¢çš„æ–¹å¼ï¼š

@example
awk -f myprog.awk -- -v -q file1 file2 @dots{}
@end example

ä¸‹é¢çš„å¤„ç† @code{ARGV} çš„ä»£ç ç‰‡æ®µï¼Œå°±æ˜¯ç”¨æ¥æ£€æŸ¥ï¼Œç§»é™¤å‰é¢æ‰€æåˆ°çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼š

@example
BEGIN @{
    for (i = 1; i < ARGC; i++) @{
        if (ARGV[i] == "-v")
            verbose = 1
        else if (ARGV[i] == "-q")
            debug = 1
        else if (ARGV[i] ~ /^-./) @{
            e = sprintf("%s: unrecognized option -- %c",
                    ARGV[0], substr(ARGV[i], 2, 1))
            print e > "/dev/stderr"
        @} else
            break
        delete ARGV[i]
    @}
@}
@end example

@cindex differences in @command{awk} and @command{gawk}, @code{ARGC}/@code{ARGV} variables
åœ¨ @command{gawk} ä¸­ç”¨ @option{--} æ¥ç»“æŸ @command{awk} çš„é€‰é¡¹ä¸æ˜¯å¿…é¡»çš„ï¼Œé™¤éæŒ‡å®šäº† @option{--posix} ï¼Œ
@command{gawk} ä¼šé»˜é»˜åœ°å°†ä¸èƒ½å¤Ÿè¯†åˆ«çš„é€‰é¡¹æ”¾åˆ° @code{ARGV} ä¸­ä»¥å¤‡ @command{awk} ç¨‹åºæ¥å¤„ç†ã€‚ä¸€çœ‹åˆ°ä¸è®¤è¯†çš„é€‰é¡¹ï¼Œ
@command{gawk} ä¼šåœæ­¢æŸ¥æ‰¾å…¶ä»–çš„å¯èƒ½å¯ä»¥è¯†åˆ«çš„é€‰é¡¹ã€‚å‰é¢çš„å‘½ä»¤è¡Œåœ¨ @command{gawk} ä¸­å¯ä»¥å¦‚ä¸‹ï¼š

@example
gawk -f myprog.awk -q -v file1 file2 @dots{}
@end example

@noindent
ç”±äº @option{-q} ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ @command{gawk} é€‰é¡¹ï¼Œå®ƒä»¥åŠåé¢çš„ @option{-v} é€‰é¡¹éƒ½ä¼šè¢«ä¼ é€’ç»™ @command{awk} ç¨‹åºã€‚
ï¼ˆæŸ¥çœ‹ @ref{Getopt Function}ï¼Œæ¥æŸ¥çœ‹åˆ†æå‘½ä»¤é€‰é¡¹çš„åº“å‡½æ•°ã€‚ï¼‰

å½“è®¾è®¡ä½ çš„ç¨‹åºçš„æ—¶å€™ï¼Œä½ åº”è¯¥é€‰æ‹©é‚£äº›ä¸ä¸ @command{gawk} å†²çªçš„é€‰é¡¹ï¼Œ
å› ä¸ºå®ƒå°†åç»­çš„è¦ä¼ é€’ç»™ä½ çš„ç¨‹åºçš„é€‰é¡¹ä¹‹å‰å…ˆå¤„ç†æ‰è‡ªå·±å¯ä»¥æ¥å—çš„é€‰é¡¹ã€‚ä½¿ç”¨ä»¥ @samp{#!} å¹¶ä½¿ç”¨ @option{-E} å‚æ•°ä¹Ÿè®¸æœ‰å¸®åŠ©
ï¼ˆæŸ¥çœ‹ @ref{Executable Scripts}ï¼Œä»¥åŠ 
@ifnotdocbook
@ref{Options}ï¼‰ã€‚
@end ifnotdocbook
@ifdocbook
@ref{Options}ï¼‰ã€‚
@end ifdocbook

@node Pattern Action Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
æ¨¡å¼-è¡Œä¸ºå¯¹ç»„æˆäº† @command{awk} ç¨‹åºçš„åŸºæœ¬å…ƒç´ ã€‚æ¨¡å¼è¦æ˜¯ä¹ˆä¸€ä¸ªæ™®é€šçš„è¡¨è¾¾å¼ï¼ŒèŒƒå›´è¡¨è¾¾å¼ï¼Œæˆ–è€…æ˜¯æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼Œ
æˆ–è€…æ˜¯ç‰¹æ®Šå…³é”®å­— @code{BEGIN}ï¼Œ@code{END}ï¼Œ@code{BEGINFILE}ï¼Œ@code{ENDFILE}ï¼Œæˆ–è€…ä¸ºç©ºã€‚
åŠ¨ä½œåœ¨å½“å‰è®°å½•åŒ¹é…æ¨¡å¼åæ‰§è¡Œã€‚ç©ºçš„ï¼ˆçœç•¥ï¼‰çš„æ¨¡å¼åŒ¹é…æ‰€æœ‰çš„è®°å½•ã€‚

@item
ä» @code{BEGIN} ä¸ @code{END} æ¨¡å¼ä¸­è¿›è¡Œ I/O æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œå¯¹äº @code{BEGINFILE} ä»¥åŠ @code{ENDFILE} ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œ
è€Œä¸”é™åˆ¶æ›´å¤šã€‚åä¸¤è€…å¯ä»¥è®©ä½ åœ¨å¤„ç†æ–‡ä»¶ä¹‹é—´æ‰“å…¥â€œå‹¾å­â€ï¼Œå› æ­¤å¯ä½ ä½¿ç”¨ä»å¯ä»¥å¯¼è‡´è‡´ä½¿é”™è¯¯çš„æ–‡ä»¶ä¸­æ¢å¤å›æ¥ï¼ˆä¾‹å¦‚æ–‡ä»¶ä¸èƒ½è¢«æ‰“å¼€ï¼‰ã€‚

@item
Shell å˜é‡å¯ä»¥é€šè¿‡ä»”ç»†åœ°ä½¿ç”¨ Shell å¼•å·æ¥ç”¨åœ¨ @command{awk} ç¨‹åºä¸­ã€‚
ç”¨ @command{awk} çš„ @option{-v} é€‰é¡¹æ¥ä¼ é€’ Shell å˜é‡åˆ° @command{awk} å˜é‡ä¼šæ›´åŠ å®¹æ˜“ã€‚

@item
åŠ¨ä½œç”±èŠ±æ‹¬å·åŒ…å«çš„è¯­å¥ç»„æˆ ã€‚è¯­å¥ç”±è¡¨è¾¾å¼ï¼Œæ§åˆ¶è¯­å¥ï¼Œå¤åˆè¯­å¥ï¼Œè¾“å…¥è¾“å‡ºè¯­å¥ä»¥åŠåˆ é™¤æ–‡å¥ç»„æˆã€‚

@item
@command{awk} çš„æ§åˆ¶è¯­å¥æ˜¯ @code{if}-@code{else}ï¼Œ@code{while}ï¼Œ@code{for} å’Œ @code{do}-@code{while}ã€‚
@command{gawk} æ·»åŠ äº† @code{switch} è¯­å¥ã€‚@code{for} è¯­å¥æœ‰ä¸¤ä¸ªç”¨å¤„ï¼šä¸€ä¸ªæ˜¯æ‰§è¡Œä¸€èˆ¬çš„å¾ªç¯ï¼Œå¦ä¸€ä¸ªæ˜¯ç”¨æ¥è¿­ä»£æ•°ç»„ã€‚

@item
@code{break} ä¸ @code{continue} å¯ä»¥è®©ä½ æ—©ç‚¹æˆ–è€…å¼€å¯ä¸‹ä¸€ä¸ªå¾ªç¯æ›¿ä»£ï¼ˆæˆ–è€…è·³å‡º @code{switch}ï¼‰ã€‚

@item
@code{next} ä¸ @code{nextfile} å¯ä»¥è®©ä½ è¯»å–ä¸‹ä¸€ä¸ªè®°å½•å¹¶ä»ä½ ç¨‹åºçš„å¼€å¤´æ‰§è¡Œï¼Œæˆ–è€…è·¯è¿‡ä¸‹ä¸€ä¸ªè¾“å…¥æ–‡ä»¶å¹¶é‡æ–°å¼€å§‹ã€‚

@item
@code{exit} è¯­å¥ç”¨æ¥ç»“æŸä½ çš„ç¨‹åºã€‚å½“ä»åŠ¨ä½œä¸­æ‰§è¡Œæ—¶ï¼ˆæˆ–è€…åœ¨å‡½æ•°ä½“å†…æ‰§è¡Œæ—¶ï¼‰ï¼Œå®ƒå°†æ§åˆ¶æµä¼ é€’åˆ° @code{END} è¯­å¥ã€‚ä» @code{END} è¯­å¥ä½“ä¸­æ‰§è¡Œæ—¶ï¼Œåˆ™ä¼šç›´æ¥é€€å‡ºã€‚ä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªå¯é€‰çš„æ•°å€¼å‚æ•°æ¥ä½œä¸º @command{awk} çš„é€€å‡ºçŠ¶æ€ã€‚

@item
ä¸€äº›é¢„å®šä¹‰çš„å‡½æ•°å¯ä»¥æ§åˆ¶ @command{awk} ï¼Œä¸»è¦æ˜¯ç”¨äº I/Oã€‚å…¶ä»–çš„å˜é‡ç”¨æ¥å‘ä½ çš„ç¨‹åºä¼ é€’ä¿¡æ¯ã€‚

@item
@code{ARGC} ä¸ @code{ARGV} å¯ä»¥è®©ä½ çš„ç¨‹åºä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ã€‚ä» @code{BEGIN} è§„åˆ™ä¸­æ“ä½œå®ƒä»¬ï¼Œ
å¯ä»¥ä½¿ä½ æ§åˆ¶ @command{awk} å¦‚ä½•æ¥å¤„ç†@value{DF}ã€‚

@end itemize

@node Arrays
@chapter @command{awk} æ•°ç»„
@cindex arrays

@dfn{æ•°ç»„}æ˜¯è¢«ç§°ä¸º@dfn{å…ƒç´ }çš„å€¼çš„è¡¨ã€‚æ•°ç»„çš„å…ƒç´ éƒ½ç”±@dfn{ç´¢å¼•}æ¥åŒºåˆ†ï¼Œ
ç´¢å¼•å³å¯ä»¥æ˜¯æ•°å€¼ä¹Ÿå¯ä»¥æ˜¯å­—ä¸²ã€‚

æœ¬@value{CHAPTER}æè¿° @command{awk} ä¸­çš„æ•°ç»„å¦‚ä¿æ¥å·¥ä½œï¼Œå¦‚ä½•ä½¿ç”¨å…ƒç´ ï¼Œå¦‚ä½•æ¥æ‰«ææ•°ç»„æˆçš„æ¯ä¸ªå…ƒç´ ï¼Œä»¥åŠå¦‚å¯æ¥åˆ é™¤æ•°ç»„å…ƒç´ ã€‚åŒæ—¶ï¼Œ
ä¹Ÿæè¿° @command{awk} å¦‚ä½•æ¥æ¨¡æ‹Ÿå¤šç»´æ•°ç»„ï¼Œä»¥åŠåœ¨ä½¿ç”¨æ•°ç»„æ—¶çš„ä¸€äº›ä¸å¤ªæ˜æ˜¾çš„åœ°æ–¹ã€‚
æœ¬@value{CHAPTER}è¿˜ä¼šè®¨è®º @command{gawk} ä¸­ç”¨äºå¯¹æ•°ç»„æ’åºçš„å·¥å…·ï¼Œç„¶åä»¥ç®€è¦ä»‹ç»å…³äº @command{gawk} æ”¯æŒçœŸæ­£çš„å¤šç»´æ•°ç»„çš„èƒ½åŠ›ä¸ºç»“å°¾ã€‚

@menu
* Array Basics::                The basics of arrays.
* Numeric Array Subscripts::    How to use numbers as subscripts in
                                @command{awk}.
* Uninitialized Subscripts::    Using Uninitialized variables as subscripts.
* Delete::                      The @code{delete} statement removes an element
                                from an array.
* Multidimensional::            Emulating multidimensional arrays in
                                @command{awk}.
* Arrays of Arrays::            True multidimensional arrays.
* Arrays Summary::              Summary of arrays.
@end menu

@node Array Basics
@section æ•°ç»„åŸºç¡€

æœ¬@value{SECTION}æè¿°ä¸€äº›åŸºç¡€ï¼šä¸€æ¬¡å¤„ç†æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œä»¥åŠéå†æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚

@menu
* Array Intro::                 Introduction to Arrays
* Reference to Elements::       How to examine one element of an array.
* Assigning Elements::          How to change an element of an array.
* Array Example::               Basic Example of an Array
* Scanning an Array::           A variation of the @code{for} statement. It
                                loops through the indices of an array's
                                existing elements.
* Controlling Scanning::        Controlling the order in which arrays are
                                scanned.
@end menu

@node Array Intro
@subsection æ•°ç»„ä»‹ç»

@cindex Wall, Larry
@quotation
@i{
å¯¹ä¸€ä¸ªå…³è”æ•°ç»„è¿›è¡Œçº¿æ€§æ‰«æå°±å¥½åƒç”¨ä¸€ä¸ªå·²ç»è£…å¼¹çš„ Uzi æªå°†äººæ•²æ­»ã€‚ï¼ˆå–»å¤§æ‰å°ç”¨â€”â€”è¯‘è€…ï¼‰
}
@author Larry Wall
@end quotation

@command{awk} è¯­è¨€æä¾›äº†ä¸€ç»´æ•°ç»„ç”¨ä»¥å­˜å‚¨ä¸€ç»„ç›¸å…³çš„ä¸²æˆ–è€…æ•°å­—ã€‚æ¯ä¸€ä¸ª @command{awk} æ•°ç»„éƒ½å¿…é¡»æœ‰ä¸€ä¸ªåå­—ã€‚æ•°ç»„åå­—ä¸å˜é‡åæœ‰ä¸€æ ·çš„è¯­æ³•ï¼Œä»»æ„æœ‰æ•ˆçš„å˜é‡åä¹Ÿéƒ½æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ•°ç»„åã€‚ä½†æ˜¯åœ¨åŒä¸€ä¸ªç¨‹åºä¸­ï¼Œä¸€åä¸èƒ½ä¸¤ç”¨ï¼ˆåŒæ—¶ä½œä¸ºæ•°ç»„åˆä½œä¸ºå˜é‡ï¼‰ã€‚

åœ¨ @command{awk} ä¸­çš„æ•°ç»„è¡¨é¢ä¸Šä¸åœ¨å…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ä¸­çš„æ•°ç»„ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬å´æœ‰ç€æœ¬è´¨çš„ä¸åŒã€‚
åœ¨ @command{awk} ä¸­ï¼Œæ²¡æœ‰å¿…è¦æŒ‡å®šæ•°ç»„çš„å¤§å°å°±å¯ä»¥ä½¿ç”¨ã€‚è€Œä¸”ï¼Œä»»æ„çš„æ•°å­—æˆ–è€…å­—ä¸²ï¼Œä¸ä»…ä»…æ˜¯è¿ç»­çš„æ•´æ•°ï¼Œéƒ½å¯ä»¥ç”¨æ¥ä½œæ•°ç»„çš„ç´¢å¼•ã€‚

å…¶ä»–å¤§å¤šæ•°è¯­è¨€ï¼Œæ•°ç»„å¿…é¡»ç»@dfn{å£°æ˜}æ‰å¯ç”¨ï¼ŒåŒ…æ‹¬æŒ‡å®šåœ¨æ•°ç»„ä¸­åŒ…å«ä»€ä¹ˆæ ·å…ƒç´ ä¸ç»„ä»¶ã€‚åœ¨è¿™æ ·çš„è¯­è¨€ä¸­ï¼Œå£°æ˜ ä¼šå¯¼è‡´å†…å­˜çš„è¿ç»­å—åˆ†é…ç”¨æ¥å­˜å‚¨è¿™äº›å…ƒç´ ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ•°ç»„ä¸­çš„ç´¢å¼•å¿…é¡»æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚ä¾‹å¦‚ï¼Œç´¢å¼• 0 æŒ‡å®šäº†æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå®é™…ä¸Šå°±æ˜¯å­˜å‚¨åœ¨å†…å­˜å—ä¸­å¼€å§‹çš„å…ƒç´ ï¼Œç­‰ç­‰ã€‚æ²¡æœ‰å¯èƒ½ä¸ºæ•°ç»„æ·»åŠ æ›´å¤šçš„å…ƒç´ ï¼Œå› ä¸ºå®ƒåªåŒ…å«å£°æ˜æ—¶æ‰€ç»™å®šçš„å…ƒç´ ä¸ªæ•°ã€‚ï¼ˆä¸€äº›å…¶ä»–è¯­è¨€å¯ä»¥ä½¿ç”¨ä»»æ„çš„èµ·å§‹ä¸ç»“æŸç´¢å¼•ï¼Œå¦‚ @samp{15 .. 27}ï¼Œ
ä½†æ˜¯æ•°ç»„çš„å¤§å°ä¸€ç»å£°æ˜åï¼Œå°±æ˜¯å›ºå®šçš„ã€‚ï¼‰

@c 1/2015: Do not put the numeric values into @code. Array element
@c values are no different than scalar variable values.
ä¸€ä¸ª 4 ä¸ªå…ƒç´ çš„è¿ç»­æ•°ç»„çœ‹èµ·æ¥å¦‚ 
@ifnotdocbook
@ref{figure-array-elements},
@end ifnotdocbook
@ifdocbook
@inlineraw{docbook, <xref linkend="figure-array-elements"/>},
@end ifdocbook
æ‰€ç¤ºï¼Œå…ƒç´ çš„å€¼å‡è®¾ä¸º 8ï¼Œ@code{"foo"}ï¼Œ@code{""} è·Ÿ 30ã€‚

@ifnotdocbook
@float Figure,figure-array-elements
@caption{è¿ç»­æ•°ç»„}
@center @image{array-elements, , , è¿ç»­æ•°ç»„}
@end float
@end ifnotdocbook

@docbook
<figure id="figure-array-elements" float="0">
<title>A contiguous array</title>
<mediaobject>
<imageobject role="web"><imagedata fileref="array-elements.png" format="PNG"/></imageobject>
</mediaobject>
</figure>
@end docbook

@noindent
å…¶ä¸­ä»…å€¼ä¼šè¢«å­˜å‚¨èµ·æ¥ï¼Œç´¢å¼•åˆ™æ˜¯åœ¨å€¼çš„é¡ºåºä¸­éšå«çš„ã€‚è¿™é‡Œï¼Œ8 çš„ç´¢å¼•ä¸º 0ï¼Œå› ä¸º 8 å‡ºç°åœ¨ 0 çš„ä½ç½®ï¼Œå…¶ä¹‹å‰æ²¡æœ‰å…ƒç´ å­˜åœ¨ã€‚

@cindex arrays, indexing
@cindex indexing arrays
@cindex associative arrays
@cindex arrays, associative
@command{awk} çš„æ•°ç»„ä¹Ÿæ˜¯ä¸åŒçš„â€”â€”å®ƒä»¬éƒ½æ˜¯@dfn{å…³è”æ€§}çš„ã€‚
è¿™å°±æ˜¯è¯´ï¼Œæ¯ä¸ªæ•°ç»„éƒ½æ˜¯â€œæˆå¯¹å€¼â€é›†åˆâ€”â€”ä¸‹é¢æ˜¯ç´¢å¼•ä¸å…¶å…³è”çš„æ•°ç»„å…ƒç´ å€¼ï¼š

@ifnotdocbook
@c extra empty column to indent it right
@multitable @columnfractions .1 .1 .1
@headitem @tab Index @tab Value
@item @tab @code{3} @tab @code{30}
@item @tab @code{1} @tab @code{"foo"}
@item @tab @code{0} @tab @code{8}
@item @tab @code{2} @tab @code{""}
@end multitable
@end ifnotdocbook

@docbook
<informaltable>
<tgroup cols="2">
<colspec colname="1" align="left"/>
<colspec colname="2" align="left"/>
<thead>
<row>
<entry>Index</entry>
<entry>Value</entry>
</row>
</thead>

<tbody>
<row>
<entry><literal>3</literal></entry>
<entry><literal>30</literal></entry>
</row>

<row>
<entry><literal>1</literal></entry>
<entry><literal>"foo"</literal></entry>
</row>

<row>
<entry><literal>0</literal></entry>
<entry><literal>8</literal></entry>
</row>

<row>
<entry><literal>2</literal></entry>
<entry><literal>""</literal></entry>
</row>

</tbody>
</tgroup>
</informaltable>

@end docbook

@noindent
æˆå¯¹å€¼ä»¥éšæ„çš„é¡ºåºå‡ºç°ï¼Œå› ä¸ºä»–ä»¬ä¸é¡ºåºæ— å…³ã€‚ 
@footnote{é¡ºåºåœ¨ä¸åŒçš„ @command{awk} å®ç°ä¸­æ˜¯ä¸åŒçš„ï¼Œå…¸å‹çš„æƒ…å†µä¸‹æ˜¯åç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨æ•°ç»„å…ƒç´ ä¸å®ƒçš„å€¼ã€‚}

å…³è”æ•°ç»„çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯æ–°çš„æˆå¯¹å€¼å¯ä»¥åœ¨ä»»æ„æ—¶é—´è¿›è¡Œæ·»åŠ ã€‚ä¾‹å¦‚ï¼Œå‡å¦‚ç¬¬ 10 ä¸ªå…ƒç´ è¢«åŠ åˆ°æ•°ç»„ä¸­ï¼Œè€Œå…¶å€¼ä¸º @w{@code{"number ten"}}ã€‚
åˆ™ç»“æœä¸ºï¼š

@ifnotdocbook
@c extra empty column to indent it right
@multitable @columnfractions .1 .1 .2
@headitem @tab Index @tab Value
@item @tab @code{10} @tab @code{"number ten"}
@item @tab @code{3} @tab @code{30}
@item @tab @code{1} @tab @code{"foo"}
@item @tab @code{0} @tab @code{8}
@item @tab @code{2} @tab @code{""}
@end multitable
@end ifnotdocbook

@docbook
<informaltable>
<tgroup cols="2">
<colspec colname="1" align="left"/>
<colspec colname="2" align="left"/>
<thead>
<row>
<entry>Index</entry>
<entry>Value</entry>
</row>
</thead>
<tbody>

<row>
<entry><literal>10</literal></entry>
<entry><literal>"number ten"</literal></entry>
</row>

<row>
<entry><literal>3</literal></entry>
<entry><literal>30</literal></entry>
</row>

<row>
<entry><literal>1</literal></entry>
<entry><literal>"foo"</literal></entry>
</row>

<row>
<entry><literal>0</literal></entry>
<entry><literal>8</literal></entry>
</row>

<row>
<entry><literal>2</literal></entry>
<entry><literal>""</literal></entry>
</row>

</tbody>
</tgroup>
</informaltable>

@end docbook

@noindent
@cindex sparse arrays
@cindex arrays, sparse
ç°åœ¨æ•°ç»„æ˜¯@dfn{ç¨€ç–}çš„ï¼Œå³æœ‰äº›ç´¢å¼•æ˜¯ç¼ºå¤±çš„ã€‚å®ƒæœ‰å…ƒç´  0--3 ä¸ 10ï¼Œä½†æ˜¯æ²¡æœ‰å…ƒç´  4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8 ä¸ 9ã€‚

å…³è”æ•°ç»„çš„å¦ä¸€ä¸ªç»“æœå°±æ˜¯ç´¢å¼•ä¸å¿…æ˜¯éè´Ÿçš„æ•´æ•°ã€‚ä»»ä½•æ•°å€¼ï¼Œç”šè‡³æ˜¯å­—ä¸²éƒ½å¯ä»¥ä½œä¸ºç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„æ•°ç»„å°†è‹±è¯­å•è¯ç¿»è¯‘ä¸ºæ³•è¯­ï¼š

@ifnotdocbook
@multitable @columnfractions .1 .1 .1
@headitem @tab Index @tab Value
@item @tab @code{"dog"} @tab @code{"chien"}
@item @tab @code{"cat"} @tab @code{"chat"}
@item @tab @code{"one"} @tab @code{"un"}
@item @tab @code{1} @tab @code{"un"}
@end multitable
@end ifnotdocbook

@docbook
<informaltable>
<tgroup cols="2">
<colspec colname="1" align="left"/>
<colspec colname="2" align="left"/>
<thead>
<row>
<entry>Index</entry>
<entry>Value</entry>
</row>
</thead>
<tbody>
<row>
<entry><literal>"dog"</literal></entry>
<entry><literal>"chien"</literal></entry>
</row>

<row>
<entry><literal>"cat"</literal></entry>
<entry><literal>"chat"</literal></entry>
</row>

<row>
<entry><literal>"one"</literal></entry>
<entry><literal>"un"</literal></entry>
</row>

<row>
<entry><literal>1</literal></entry>
<entry><literal>"un"</literal></entry>
</row>

</tbody>
</tgroup>
</informaltable>

@end docbook

@noindent
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å†³å®šå°†æ•°å€¼ 1 ç¿»è¯‘ä¸ºæ‹¼å†™ä¸æ•°å€¼å½¢å¼â€”â€”è¿™ä¸ªä¾‹å­è¯´æ˜äº†ä¸€ä¸ªæ•°ç»„å³å¯ä»¥ç”¨æ•°å­—ä¹Ÿå¯ä»¥ç”¨å­—ä¸²ä½œä¸ºç´¢å¼•ã€‚
ï¼ˆäº‹å®ä¸Šï¼Œæ•°ç»„ä¸‹æ ‡æ€»æ˜¯å­—ä¸²ã€‚è¿™é‡Œé¢ï¼Œæ•°å€¼ç”¨äºæ•°ç»„ä¸‹æ ‡å¦‚ä½•å·¥ä½œï¼Œæœ‰ä¸€äº›å¾®å¦™çš„åœ°æ–¹ï¼Œè¿™ä¼šåœ¨ @ref{Numeric Array Subscripts}ï¼Œè¿›è¡Œæ›´è¯¦ç»†çš„è¯´æ˜ã€‚ï¼‰åœ¨è¿™é‡Œï¼Œæ•°å€¼ @code{1} æ²¡æœ‰åŒå¼•å·å¼•èµ·æ¥ï¼Œ
å› ä¸º @command{awk} ä¼šè‡ªåŠ¨åœ°å°†å…¶è½¬æ¢ä¸ºå­—ä¸²ã€‚

@cindex @command{gawk}, @code{IGNORECASE} variable in
@cindex case sensitivity, array indices and
@cindex arrays, and @code{IGNORECASE} variable
@cindex @code{IGNORECASE} variable, and array indices
@code{IGNORECASE} çš„å€¼ä¸ä¼šå½±å“åœ¨æ•°ç»„è¿›è¡Œä¸‹æ ‡æ“ä½œæ—¶ç»“æœã€‚ç”¨æ¥å­˜å‚¨ä¸è¿”å›æ•°ç»„å…ƒç´ å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å­—ä¸²ã€‚
å½“ @command{awk} åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼ˆæ¯”å¦‚åœ¨ @code{split()} å†…å»ºå‡½æ•°ä¸­ï¼‰ï¼Œé‚£ä¸ªæ•°ç»„çš„ç´¢å¼•å°±æ˜¯ä» 1 å¼€å§‹çš„è¿ç»­æ•´æ•°ã€‚ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰

@command{awk} çš„æ•°ç»„æ˜¯éå¸¸é«˜æ•ˆçš„â€”â€”è®¿é—®å…ƒç´ çš„æ—¶é—´ä¸æ•°ç»„ä¸­çš„å…ƒç´ æ•°é‡æ— å…³ã€‚

@node Reference to Elements
@subsection æŒ‡å‘æ•°ç»„å…ƒç´ 
@cindex arrays, referencing elements
@cindex array members
@cindex elements of arrays

ä½¿ç”¨æ•°ç»„çš„ä¸»è¦æ–¹å¼å°±æ˜¯ä½¿ç”¨å®ƒçš„å…ƒç´ ã€‚@dfn{æ•°ç»„å‚è€ƒ}æ˜¯ä¸€ä¸ªå¦‚ä¸‹é¢è¿™æ ·çš„è¡¨è¾¾å¼ï¼š

@example
@var{array}[@var{index-expression}]
@end example

@noindent
åœ¨è¿™é‡Œï¼Œ@var{array} æ˜¯æ•°ç»„çš„åå­—ã€‚è¡¨è¾¾å¼ @var{index-expression} æ˜¯æ•°ç»„ä¸­æ‰€éœ€è¦å…ƒç´ çš„ç´¢å¼•ã€‚

@c 1/2015: Having the 4.3 in @samp is a little iffy. It's essentially
@c an expression though, so leave be. It's to early in the discussion
@c to mention that it's really a string.
æ•°ç»„å‚è€ƒçš„å€¼æ˜¯æ•°ç»„æŒ‡å®šå…ƒç´ çš„å½“å‰å€¼ã€‚ä¾‹å¦‚ @code{foo[4.3]} æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼å‚è€ƒï¼Œ
æ˜¯æŒ‡æ•°ç»„ @code{foo} åœ¨ç´¢å¼• @samp{4.3} çš„å…ƒç´ ã€‚

@cindex arrays, unassigned elements
@cindex unassigned array elements
@cindex empty array elements
å¯¹æœªå­˜åœ¨æ•°ç»„æ•°ç»„å…ƒç´ çš„å‚è€ƒï¼Œä¼šäº§ç”Ÿä¸€ä¸ª @code{""} å€¼ï¼Œå³ç©ºä¸²ã€‚
è¿™ä¹ŸåŒ…æ‹¬äº†é‚£äº›è¿˜æ²¡æœ‰è¢«èµ‹å€¼çš„å…ƒç´ ï¼Œä»¥åŠå·²ç»åˆ é™¤çš„å…ƒç´ ï¼ˆæŸ¥çœ‹ @ref{Delete}ï¼‰ã€‚

@cindex non-existent array elements
@cindex arrays, elements that don't exist
@quotation æç¤º
å¯¹ä¸å­˜åœ¨å…ƒç´ çš„å‚è€ƒä¼š@emph{è‡ªåŠ¨åœ°}åˆ›å»ºè¿™ä¸ªæ•°ç»„å…ƒç´ ï¼Œå¹¶å°†çª—å£ä½œä¸ºå®ƒçš„å€¼ã€‚ï¼ˆåœ¨æŸç§æƒ…å†µä¸‹ï¼Œè¿™å´æ˜¯ä¸å¹¸çš„ï¼Œå› ä¸ºè¿™ä¼šæµªè´¹ @command{awk} ä¸­çš„å†…å­˜ã€‚ï¼‰

@command{awk} æ–°æ‰‹ç¨‹åºå‘˜å¸¸å¸¸çŠ¯é€šè¿‡æ£€æŸ¥å…¶å€¼æ˜¯å¦ä¸ºç©ºæ¥æ£€æŸ¥å…ƒç´ å­˜ä¸å­˜åœ¨çš„é”™è¯¯ï¼š

@example
# Check if "foo" exists in a:         @ii{Incorrect!}
if (a["foo"] != "") @dots{}
@end example

@noindent
è¿™æ˜¯ä¸æ­£ç¡®çš„ï¼Œæœ‰ä¸¤ä¸ªåŸå› ï¼šç¬¬ä¸€ï¼Œå¦‚æœä¹‹å‰ä¸å­˜åœ¨ @code{a["foo"]}ï¼Œåˆ™ä¼š@emph{åˆ›å»º}å®ƒã€‚
ç¬¬äºŒï¼Œï¼ˆçœ‹èµ·æ¥ä¸å¯»å¸¸ï¼‰å°†æ•°ç»„å…ƒç´ çš„å€¼è®¾ç½®æˆç©ºä¸²æ˜¯æœ‰æ•ˆçš„ã€‚
@end quotation

@c @cindex arrays, @code{in} operator and
@cindex @code{in} operator, testing if array element exists
ä¸ºäº†ç¡®å®šç‰¹å®šç´¢å¼•çš„å…ƒç´ æ˜¯å¦å­˜åœ¨æ•°ç»„ä¸­ï¼Œä½¿ç”¨ä¸‹é¢çš„è¡¨è¾¾å¼ï¼š

@example
@var{indx} in @var{array}
@end example

@cindex side effects, array indexing
@noindent
è¿™ä¸ªè¡¨è¾¾å¼æµ‹è¯•ç‰¹å®šçš„ç´¢å¼• @var{indx} æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”ä¸ä¼šäº§ç”Ÿå¦‚æœå…ƒç´ ä¸å­˜åœ¨ä¼šåˆ›å»ºè¿™ä¸ªå…ƒç´ çš„å‰¯ä½œç”¨ã€‚
å¦‚æœ @code{@var{array}[@var{indx}]} å­˜åœ¨ï¼Œåˆ™è¡¨è¾¾å¼çš„å…·æœ‰å€¼ 1 ï¼ˆtrueï¼‰ï¼Œå¦åˆ™ä¸º 0 ï¼ˆfalseï¼‰ã€‚
ï¼ˆæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨çš„æ˜¯ @var{indx}ï¼Œæ˜¯å› ä¸º @samp{index} æ˜¯å†…å»ºå‡½æ•°çš„åå­—ã€‚ï¼‰
ä¾‹å¦‚ï¼Œè¿™ä¸ªè¯­å¥æµ‹è¯•æ•°ç»„ @code{frequencies} æ˜¯ä¸å­˜åœ¨ç´¢å¼• @samp{2} ï¼š

@example
if (2 in frequencies)
    print "Subscript 2 is present."
@end example

æ³¨æ„ï¼Œè¿™@emph{ä¸æ˜¯}æµ‹è¯•æ•°ç»„ @code{frequencies} æ˜¯å¦åŒ…å«@emph{å€¼}ä¸º 2 çš„å…ƒç´ ã€‚
é™¤äº†æ‰«ææ‰€æœ‰çš„å…ƒç´ ï¼Œå¦åˆ™çš„è¯æ²¡æœ‰å…¶ä»–çš„åŠæ³•ã€‚åŒæ—¶ï¼Œè¿™ä¹Ÿ@emph{ä¸ä¼š}åˆ›å»º @code{frequencies[2]}ï¼Œ
è€Œä¸‹é¢çš„ä»£ç åˆ™ä¼šï¼ˆæ˜¯ä¸æ­£ç¡®çš„ï¼‰ï¼š

@example
if (frequencies[2] != "")
    print "Subscript 2 is present."
@end example

@node Assigning Elements
@subsection ç»™æ•°ç»„å…ƒç´ èµ‹å€¼
@cindex arrays, elements, assigning values
@cindex elements in arrays, assigning values

æ•°ç»„å…ƒç´ å¯ä»¥åƒ @command{awk} å˜é‡ä¸€æ ·è¢«èµ‹å€¼ï¼š

@example
@var{array}[@var{index-expression}] = @var{value}
@end example

@noindent
@var{array} æ˜¯æ•°ç»„çš„åå­—ã€‚è¡¨è¾¾å¼ @var{index-expression} æ˜¯ @var{value} è¦è¢«èµ‹å€¼çš„å…ƒç´ çš„ç´¢å¼•ã€‚
è¡¨è¾¾å¼çš„å€¼æ˜¯èµ‹ç»™æ•°ç»„å…ƒç´ çš„å€¼ã€‚

@node Array Example
@subsection åŸºæœ¬æ•°ç»„å®ä¾‹
@cindex arrays, an example of using

ä¸‹é¢çš„ç¨‹åºæå–ä¸€ç³»åˆ—çš„è¡Œï¼Œæ¯ä¸€è¡Œä»¥æ•°å­—å¼€å§‹ï¼Œå¹¶æŒ‰è¡Œå·çš„é¡ºåºæ‰“å°å®ƒä»¬ã€‚è¡Œå·ç¬¬ä¸€æ¬¡è¯»å–çš„æ—¶å€™ä¸æ˜¯é¡ºåºçš„â€”â€”ç›¸åï¼Œå®ƒä»¬æ˜¯æ‰“ä¹±çš„ã€‚ç¨‹åºå¯¹è¡Œè¿›è¡Œæ’åºï¼Œä½¿æ•°ç»„ç”¨è¡Œå·ä½œä¸ºä¸‹æ ‡ã€‚ç¨‹åºç„¶åæŒ‰ç…§è¡Œå·çš„é¡ºåºæ‰“å°å®ƒä»¬ã€‚è¿™æ˜¯ä¸ªéå¸¸ç®€å•çš„ç¨‹åºï¼Œä½†æ˜¯åœ¨é‡åˆ°é‡å¤çš„è¡Œå·ï¼Œç©ºæ ¼æˆ–è€…ä¸æ˜¯ä»¥æ•°å€¼å¼€å§‹çš„è¡Œçš„æ—¶å€™ä¼šå¯¼è‡´å›°æƒ‘ï¼š

@example
@c file eg/misc/arraymax.awk
@{
    if ($1 > max)
        max = $1
    arr[$1] = $0
@}

END @{
    for (x = 1; x <= max; x++)
        print arr[x]
@}
@c endfile
@end example

ç¬¬ä¸€ä¸ªè§„åˆ™è·Ÿè¸ªå½“å‰å·²ç»çœ‹åˆ°çš„æœ€å¤§çš„è¡Œå·ï¼ŒåŒæ—¶ä¹Ÿå°†æ¯ä¸€è¡Œå­˜å‚¨åœ¨æ•°ç»„ @code{arr} ä¸­ï¼Œ
å¹¶ä»¥è¡Œå·ä½œä¸ºç´¢å¼•ã€‚æ¯äºŒä¸ªè§„åˆ™åˆ™æ˜¯æ‰“å°æ‰€æœ‰çš„è¡Œã€‚å½“ç¨‹åºæ‰§è¡Œæ—¶ï¼Œæœ‰ä¸‹é¢çš„è¾“å…¥ï¼š

@example
@c file eg/misc/arraymax.data
5  I am the Five man
2  Who are you?  The new number two!
4  . . . And four on the floor
1  Who is number one?
3  I three you.
@c endfile
@end example

@noindent
Its output is:

@example
1  Who is number one?
2  Who are you?  The new number two!
3  I three you.
4  . . . And four on the floor
5  I am the Five man
@end example

å¦‚æœè¡Œå·æ˜¯é‡å¤çš„ï¼Œå·²ç»å­˜åœ¨çš„è¡Œçš„æœ€åä¸€è¡Œå°†è¦†ç›–å…¶ä»–çš„ã€‚
åœ¨è¡Œå·é—´çš„ç©ºéš™å¯ä»¥é€šè¿‡åœ¨ç¨‹åºçš„ @code{END} è§„åˆ™ä¸­åšä¸€ä¸ªç®€å•çš„å¢å¼ºå°±å¯ä»¥å¤„ç†ï¼Œå¦‚ä¸‹ï¼š

@example
END @{
    for (x = 1; x <= max; x++)
        if (x in arr)
            print arr[x]
@}
@end example

@node Scanning an Array
@subsection éå†æ•°ç»„å…ƒç´ 
@cindex elements in arrays, scanning
@cindex scanning arrays
@cindex arrays, scanning
@cindex loops, @code{for}, array scanning

åœ¨ä½¿ç”¨æ•°ç»„çš„ç¨‹åºä¸­ï¼Œå¸¸å¸¸éœ€è¦ä½¿ç”¨å¾ªç¯æ¥æ‰§è¡Œé’ˆå¯¹æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„æ“ä½œã€‚åœ¨å…¶ä»–çš„è¯­è¨€ä¸­ï¼Œæ•°ç»„æ˜¯è¿ç»­çš„ï¼Œå¹¶ä¸”è¿‡äº›é™åˆ¶ä¸ºéè´Ÿæ•´æ•°ï¼Œå¤„ç†èµ·æ¥å°±éå¸¸çš„ç®€å•ï¼šæ‰€æœ‰æœ‰æ•ˆçš„ç´¢å¼•éƒ½å¯ä»¥ä¸ºæœ€ä½ç´¢å¼•åˆ°æœ€å¤§çš„ç´¢å¼•ã€‚è¿™ä¸ªæŠ€å·§åœ¨ @command{awk} ä¸­å¹¶ä¸å¯ç”¨ï¼Œå› æ­¤ä»»æ„çš„æ•°å­—ä¸å­—ä¸²éƒ½å¯ä»¥ä½œä¸ºæ•°ç»„çš„ç´¢å¼•ã€‚å› æ­¤ï¼Œ@command{awk} æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ @code{for} è¯­å¥æ¥æ‰«ææ•°ç»„ï¼š

@example
for (@var{var} in @var{array})
    @var{body}
@end example

@noindent
@cindex @code{in} operator, use in loops
è¿™ä¸ªå¾ªç¯ä¸ºç¨‹åºä¸­ä½¿ç”¨è¿‡çš„æ•°ç»„ @var{array} ä¸­çš„æ¯ä¸€ä¸ªç´¢å¼•æ‰§è¡Œä¸€æ¬¡ @var{body}ï¼Œ
å¹¶å°† @var{var} å˜é‡è®¾ç½®æˆç´¢å¼•å€¼ã€‚

@cindex arrays, @code{for} statement and
@cindex @code{for} statement, looping over arrays
ä¸‹é¢çš„ç¨‹åºä½¿ç”¨è¿™ç§å½¢å¼çš„ @code{for} è¯­å¥ã€‚ç¬¬ä¸€ä¸ªè§„åˆ™æ‰«æè¾“å…¥è®°å½•ï¼Œå¹¶ä¸”æ³¨æ„å‡ºç°åœ¨è¾“å…¥ä¸­çš„å•è¯ï¼ˆè‡³å°‘å‡ºç°ä¸€æ¬¡ï¼‰ï¼Œ
é€šè¿‡ç”¨å…¶ä¸­ä¸€ä¸ªå•è¯ä½œä¸ºç´¢å¼•æ¥å¹¶å°†å€¼ 1 å­˜åˆ°å­˜å‚¨æ•°ç»„ @code{used} ä¸­ã€‚
ç¬¬äºŒä¸ªè§„åˆ™æ‰«æå·²ç»ä½¿ç”¨è¿‡çš„å…ƒç´ æ¥æŸ¥æ‰¾æ‰€æœ‰çš„åœ¨è¾“å…¥ä¸­å‡ºç°çš„ä¸åŒçš„å•è¯ã€‚ç„¶åæ‰“å°å…¶é•¿åº¦å¤§äº 10 ä¸ªå­—ç¬¦çš„å•è¯ï¼Œ
åŒæ—¶ä¹Ÿæ‰“å°æ­¤ç±»å•è¯å‡ºç°çš„æ¬¡æ•°ã€‚æŸ¥çœ‹ @ref{String Functions}ï¼Œæ¥è·å–å†…å»ºå‡½æ•° @code{length()} çš„æ›´å¤šä¿¡æ¯ã€‚

@example
# Record a 1 for each word that is used at least once
@{
    for (i = 1; i <= NF; i++)
        used[$i] = 1
@}

# Find number of distinct words more than 10 characters long
END @{
    for (x in used) @{
        if (length(x) > 10) @{
            ++num_long_words
            print x
        @}
    @}
    print num_long_words, "words longer than 10 characters"
@}
@end example

@noindent
æŸ¥çœ‹ @ref{Word Sorting}ï¼Œæ¥è·å–æ›´å¤šçš„æ›´å¤šæ›´è¯¦ç»†çš„æ­¤ç±»ä¾‹å­ã€‚

@cindex arrays, elements, order of access by @code{in} operator
@cindex elements in arrays, order of access by @code{in} operator
@cindex @code{in} operator, order of array access
é€šè¿‡è¿™ä¸ªè¯­å¥è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ çš„é¡ºåºåˆ™æ˜¯ç”± @command{awk} å†…éƒ¨å¯¹æ•°ç»„å…ƒç´ çš„å®‰æ’ç¡®å®šçš„ï¼Œ
å¹¶ä¸”åœ¨æ ‡å‡†çš„ @command{awk} ä¸­æ˜¯æ— æ³•æ§åˆ¶ä¸æ”¹å˜çš„ã€‚å¦‚æœæ–°å…ƒç´ è¢«åœ¨å¾ªç¯ä½“å†…çš„è¯­å¥åŠ å…¥åˆ°æ•°ç»„ @var{array} ä¸­ï¼Œ
å‰é¢çš„è§„åˆ™å¯ä¼šå¯¼è‡´é—®é¢˜çš„äº§ç”Ÿï¼Œå³åœ¨ @code{for} å¾ªç¯ä¸­ä»€ä¹ˆæ—¶å€™æŒ‡å‘å®ƒä»¬æ˜¯ä¸å¯é¢„æµ‹çš„ã€‚ç›¸ä¼¼çš„ï¼Œæ”¹å˜å¾ªç¯ä½“å†…çš„ @var{var} ä¼šå¯¼è‡´å¥‡æ€ªçš„ç»“æœã€‚
å› æ­¤æœ€å¥½åˆ«åšè¿™æ ·çš„äº‹æƒ…ã€‚

ä½œä¸ºä¿¡æ¯ç‚¹ï¼Œ@command{gawk} å¼€å§‹å¾ªç¯ä¹‹å‰ï¼ŒæŒ‚èµ·è¢«è¿­ä»£çš„å…ƒç´ çš„åˆ—è¡¨ï¼Œå¹¶ä¸å¯ä»¥æ”¹å˜å®ƒã€‚
ä½†æ˜¯ä¸æ˜¯æ‰€æœ‰çš„ @command{awk} ç‰ˆæœ¬éƒ½è¿™ä¹ˆåšã€‚è€ƒè™‘ä¸‹é¢çš„ç¨‹åºï¼Œåä¸º @file{loopcheck.awk}ï¼š

@example
BEGIN @{
    a["here"] = "here"
    a["is"] = "is"
    a["a"] = "a"
    a["loop"] = "loop"
    for (i in a) @{
        j++
        a[j] = j
        print i
    @}
@}
@end example

è¿™æ˜¯ç”¨ @command{gawk}ï¼ˆä¸ @command{mawk}ï¼‰æ‰§è¡Œæ—¶çš„ç»“æœï¼š

@example
$ @kbd{gawk -f loopcheck.awk}
@print{} here
@print{} loop
@print{} a
@print{} is
@end example

è€Œä¸‹é¢æ˜¯ BWK @command{awk} çš„æ‰§è¡Œç»“æœï¼š

@example
$ @kbd{nawk -f loopcheck.awk}
@print{} loop
@print{} here
@print{} is
@print{} a
@print{} 1
@end example

@node Controlling Scanning
@subsection åœ¨ @command{gawk} ä¸­ä½¿ç”¨é¢„å®šä¹‰çš„æ•°ç»„éå†é¡ºåº

æœ¬@value{SUBSECTION}æè¿°çš„æ˜¯ @command{gawk} ç‰¹æœ‰çš„ç‰¹æ€§ã€‚

åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ @code{for} åœ¨éå†æ•°ç»„æ—¶ï¼Œå…¶é¡ºåºæ˜¯æœªå®šä¹‰çš„ï¼Œå³æ˜¯è¯´ï¼Œ@command{awk} çš„å®ç°å†³å®šäº†åœ¨éå†æ•°ç»„æ—¶çš„é¡ºåºã€‚è¿™ä¸ªé¡ºåºé€šå¸¸æ˜¯åŸºäºæ•°ç»„çš„å†…éƒ¨å®ç°ï¼Œå¹¶åœ¨ä¸åŒç‰ˆæœ¬çš„ @command{awk} æœ‰å·®å¼‚ã€‚

@cindex array scanning order, controlling
@cindex controlling array scanning order
å°½ç®¡ä½ é€šå¸¸åšçš„éƒ½æ˜¯ä¸€äº›ç®€å•çš„äº‹æƒ…ï¼Œå¦‚â€œé€šè¿‡ä»¥å‡åºçš„æ–¹å¼æ¯”è¾ƒç´¢å¼•æ¥éå†æ•°ç»„â€ï¼Œæˆ–è€…æ˜¯â€œé€šè¿‡ä»¥é™åºçš„æ–¹å¼æ¯”è¾ƒå€¼æ¥éå†æ•°ç»„â€ã€‚
@command{gawk} é€šè¿‡ä¸¤ç§æœºåˆ¶è®©ä½ æ¥æ‰§è¡Œè¿™æ ·çš„æ§åˆ¶ï¼š

@itemize @value{BULLET}
@item
è®¾ç½® @code{PROCINFO["sorted_in"]} çš„å€¼ä¸ºé¢„å®šä¹‰å€¼ä¹‹ä¸€ã€‚åé¢ä¼šè®²åˆ°ã€‚

@item
è®¾ç½® @code{PROCINFO["sorted_in"]} ä¸ºç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ç”¨æ¥æ¯”è¾ƒæ•°ç»„ä¸­çš„å…ƒç´ ã€‚è¿™ä¸ªé«˜çº§ç‰¹æ€§åœ¨åé¢çš„ç« èŠ‚ @ref{Array Sorting}ï¼Œ
ä¸­è¿›è¡Œæè¿°ã€‚
@end itemize

@cindex @code{PROCINFO}, values of @code{sorted_in}
ä¸‹é¢æ˜¯å¯è·å–çš„ @code{PROCINFO["sorted_in"]} å€¼ï¼š

@table @code
@item "@@unsorted"
æ•°ç»„å…ƒç´ ä»¥ä»»æ„é¡ºåºå¤„ç†ï¼Œè¿™æ˜¯é»˜è®¤çš„ @command{awk} è¡Œä¸ºã€‚

@item "@@ind_str_asc"
ä»¥å­—ä¸²æ¯”è¾ƒç´¢å¼•å‡åºæ–¹å¼ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„æ’åºã€‚ï¼ˆåœ¨å†…éƒ¨ï¼Œæ•°ç»„ç´¢å¼•æ€»æ˜¯å­—ä¸²ï¼Œå› æ­¤ @samp{a[2*5] = 1} ä¸­çš„ç´¢å¼•æ˜¯ @code{"10"}ï¼Œ
è€Œä¸æ˜¯æ•°å­—çš„ 10ã€‚ï¼‰

@item "@@ind_num_asc"
ä»¥ç´¢å¼•å‡åºçš„æ–¹å¼ï¼Œä½†æ˜¯å¼ºåˆ¶ç´¢å¼•ä»¥æ•°å€¼å¯¹å¾…ã€‚å¯¹äºä¸æ˜¯æ•°å€¼çš„ç´¢å¼•ï¼Œå°±å½“æˆæ˜¯ 0 çš„æ–¹å¼è¿›è¡Œå®šä½ã€‚

@item "@@val_type_asc"
ä»¥å…ƒç´ å€¼çš„å‡åºæ–¹å¼æ’åºï¼ˆè€Œä¸æ˜¯ç´¢å¼•ï¼‰ã€‚æ’åºæ˜¯é€šè¿‡ç»™å…ƒç´ æ‰€èµ‹å€¼çš„ç±»å‹è¿›è¡Œçš„ï¼ˆæŸ¥çœ‹ @ref{Typing and Comparison}ï¼‰ã€‚
æ‰€æœ‰çš„æ•°å€¼éƒ½åœ¨å­—ä¸²ä¹‹å‰ï¼Œåé¢å†æ¥å­æ•°ç»„ã€‚ï¼ˆå­æ•°ç»„è¿˜æ²¡æœ‰è®¨è®ºåˆ°ï¼ŒæŸ¥çœ‹ @ref{Arrays of Arrays}ï¼‰ã€‚

@item "@@val_str_asc"
æŒ‰å…ƒç´ å€¼çš„å‡åºæ’åºï¼ˆä¸æ˜¯æŒ‰ç´¢å¼•ï¼‰ã€‚æ ‡é‡å€¼ä¸å­—ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰å­æ•°ç»„ï¼Œåˆ™æœ€åä¸å…¶æ¯”è¾ƒã€‚

@item "@@val_num_asc"
æŒ‰å…ƒç´ å€¼çš„å‡åºæ’åºï¼ˆä¸æ˜¯æŒ‰ç´¢å¼•ï¼‰ã€‚æ ‡é‡å€¼ä¸å­—ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰å­æ•°ç»„ï¼Œåˆ™æœ€åä¸å…¶æ¯”è¾ƒã€‚å½“æ•°å€¼ç›¸åŒæ—¶ï¼Œç”¨å­—ä¸²æ¯”è¾ƒæ¥ç¡®å®šé¡ºåºã€‚è¿™ä¿è¯äº†åœ¨ä¸åŒç‰ˆæœ¬çš„ C @code{qsort()} å‡½æ•°é—´çš„ä¸€è‡´ç»“æœï¼Œ
@footnote{å½“ä¸¤ä¸ªå…ƒç´ æ¯”è¾ƒç›¸åŒæ—¶ï¼ŒC çš„ @code{qsort()} å‡½æ•°ä¸ä¿è¯å®ƒä»¬æ¯”è¾ƒä¹‹åä¿æŒæ¯”è¾ƒä¹‹å‰çš„ç›¸å¯¹é¡ºåºï¼ˆä¸ç¨³å®šæ’åºï¼‰ã€‚
é€šè¿‡å­—ä¸²æ¯”è¾ƒï¼Œå¯ä»¥ä¿è¯åœ¨æ•°å€¼æ¯”è¾ƒä¸ºç›¸åŒæ—¶ï¼Œå¯æä¾›å”¯ä¸€çš„é¡ºåºï¼Œå› æ­¤ @command{gawk} å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­è¡Œä¸ºä¸€è‡´ã€‚}
åœ¨å†…éƒ¨å®ƒè¢« @command{gawk} ç”¨æ¥æ‰§è¡Œæ’åºã€‚

@item "@@ind_str_desc"
ä¸ @code{"@@ind_str_asc"} ç›¸ä¼¼ï¼Œä½†æ˜¯å­—ä¸²é¡ºåºæ˜¯ä»é«˜åˆ°ä½ï¼Œå³é™åºã€‚

@item "@@ind_num_desc"
ä¸ @code{"@@ind_num_asc"} ç›¸ä¼¼ï¼Œä½†æ˜¯æ•°å€¼ç´¢å¼•æ˜¯ä»é«˜åˆ°ä½ï¼Œå³é™åºã€‚

@item "@@val_type_desc"
ä¸ @code{"@@val_type_asc"} ç›¸ä¼¼ï¼Œä½†æ˜¯åŸºäºå…ƒç´ å€¼çš„ç±»å‹åˆ™æ˜¯ä»é«˜åˆ°ä½ã€‚å¦‚æœæœ‰å­æ•°ç»„ï¼Œåˆ™æœ€å…ˆæ¯”è¾ƒå­æ•°ç»„ã€‚

@item "@@val_str_desc"
ä¸ @code{"@@val_str_asc"} ç›¸ä¼¼ï¼Œä½†æ˜¯åŸºäºå…ƒç´ å€¼çš„å­—ä¸²åˆ™æ˜¯ä»é«˜åˆ°ä½ã€‚å¦‚æœæœ‰å­æ•°ç»„ï¼Œåˆ™æœ€å…ˆæ¯”è¾ƒå­æ•°ç»„ã€‚

@item "@@val_num_desc"
ä¸ @code{"@@val_num_asc"} ç›¸ä¼¼ï¼Œä½†æ˜¯åŸºäºå…ƒç´ å€¼çš„æ•°å€¼åˆ™æ˜¯ä»é«˜åˆ°ä½ã€‚å¦‚æœæœ‰å­æ•°ç»„ï¼Œåˆ™æœ€å…ˆæ¯”è¾ƒå­æ•°ç»„ã€‚
@end table

æ•°ç»„çš„éå†é¡ºåºæ˜¯åœ¨ @code{for} å¾ªç¯å¼€å§‹æ‰§è¡Œä¹‹å‰å°±ç¡®å®šçš„ã€‚åœ¨å¾ªç¯ä½“å†…æ”¹å˜ @code{PROCINFO["sorted_in"]} çš„å€¼ä¸ä¼šå½±å“å¾ªç¯ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{gawk '}
> @kbd{BEGIN @{}
> @kbd{   a[4] = 4}
> @kbd{   a[3] = 3}
> @kbd{   for (i in a)}
> @kbd{       print i, a[i]}
> @kbd{@}'}
@print{} 4 4
@print{} 3 3
$ @kbd{gawk '}
> @kbd{BEGIN @{}
> @kbd{   PROCINFO["sorted_in"] = "@@ind_str_asc"}
> @kbd{   a[4] = 4}
> @kbd{   a[3] = 3}
> @kbd{   for (i in a)}
> @kbd{       print i, a[i]}
> @kbd{@}'}
@print{} 3 3
@print{} 4 4
@end example

å½“é€šè¿‡å…ƒç´ å€¼çš„æ–¹å¼æ¥æ’åºï¼Œå¦‚æœæŸä¸ªå€¼ä¸ºå­æ•°ç»„ï¼Œåˆ™å…¶è¢«è®¤ä¸ºæ¯”ä»»æ„çš„å­—ä¸²ä¸æ•°ç»„éƒ½å¤§ï¼Œè€Œä¸ç®¡å­æ•°ç»„ä¸­åŒ…å«çš„å†…å®¹ï¼Œ
è€Œæ‰€æœ‰çš„å­æ•°ç»„éƒ½å½“æˆç›¸åŒæ¥å¯¹å¾…ã€‚è€Œå®ƒä»¬ä¹‹é—´çš„ç›¸å¯¹é¡ºåºåˆ™ç”±å®ƒä»¬çš„ç´¢å¼•å­—ä¸²æ¥å†³å®š ã€‚

ä¸‹é¢æ˜¯ä¸€äº›åœ¨è¿›è¡Œæ’åºæ•°ç»„éå†æ—¶è¦è®°ä½çš„ç‚¹ï¼š

@itemize @value{BULLET}
@item
@code{PROCINFO["sorted_in"]} çš„å€¼æ˜¯å…¨å±€çš„ï¼Œå®ƒå½±å“æ‰€æœ‰çš„æ•°ç»„éå† @code{for} å¾ªç¯ã€‚
å¦‚æœä½ è¦åœ¨ä½ çš„ä»£ç ä¸­æ”¹å˜å®ƒï¼Œåˆ™ä½ éœ€è¦ç¡®å®šå®ƒæ˜¯å¦å­˜åœ¨ï¼ŒåŒæ—¶è¦ä¿å­˜ä¸æ¢å¤å®ƒçš„å€¼ï¼š

@example
@dots{}
if ("sorted_in" in PROCINFO) @{
    save_sorted = PROCINFO["sorted_in"]
    PROCINFO["sorted_in"] = "@@val_str_desc" # or whatever
@}
@dots{}
if (save_sorted)
    PROCINFO["sorted_in"] = save_sorted
@end example

@item
å¦‚æ—©å‰æ‰€æåˆ°çš„ï¼Œé»˜è®¤çš„æ•°ç»„éå†ç”± @code{"@@unsorted"} è¡¨ç¤ºã€‚
ä½ ä¹Ÿå¯ä»¥ç»™ @code{PROCINFO["sorted_in"]} èµ‹ä¸€ä¸ªç©ºä¸²æ¥è·å¾—è¿™æ ·çš„é»˜è®¤è¡Œä¸ºï¼Œ
æˆ–è€…åªéœ€è¦ç”¨ @code{delete} è¯­å¥å°† @code{"sorted_in"} ä» @code{PROCINFO} ä¸­åˆ é™¤ã€‚
ï¼ˆ@code{delete} è¯­å¥è¿˜æ²¡æœ‰è®¨è®ºåˆ°ï¼Œè¯·æŸ¥çœ‹ @ref{Delete}ã€‚ï¼‰
@end itemize

å¦å¤–ï¼Œ@command{gawk} æä¾›äº†å†…å»ºçš„ç”¨äºæ•°ç»„æ’åºçš„å‡½æ•°ï¼ŒæŸ¥çœ‹ @ref{Array Sorting Functions}ã€‚

@node Numeric Array Subscripts
@section ç”¨æ•°å€¼ä½œä¸ºæ•°ç»„ä¸‹æ ‡

@cindex numbers, as array subscripts
@cindex arrays, numeric subscripts
@cindex subscripts in arrays, numbers as
@cindex @code{CONVFMT} variable, and array subscripts
è¦è®°ä½æ•°ç»„çš„ä¸€ä¸ªé‡è¦ç‚¹å°±æ˜¯@emph{æ•°ç»„çš„ä¸‹æ ‡æ€»æ˜¯å­—ä¸²}ã€‚
å½“æ•°å€¼ç”¨äºä¸‹æ ‡ï¼Œå®ƒä¼šåœ¨ç”¨äºä¸‹æ ‡å‰è¢«è½¬æ¢ä¸ºå­—ä¸²ï¼ˆæŸ¥çœ‹ @ref{Conversion}ï¼‰ã€‚
è¿™æ„å‘³ç€ï¼Œé¢„å®šä¹‰å˜é‡ @code{CONVFMT} ä¼šå½±å“ä½ çš„ç¨‹åºè®¿é—®æ•°ç»„çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š

@example
xyz = 12.153
data[xyz] = 1
CONVFMT = "%2.2f"
if (xyz in data)
    printf "%s is in data\n", xyz
else
    printf "%s is not in data\n", xyz
@end example

@noindent
ç¨‹åºä¼šæ‰“å° @samp{12.15 is not in data}ã€‚
ç¬¬ä¸€æ¡è¯­å¥ç»™äº† @code{xyz} ä¸€ä¸ªæ•°å€¼å€¼ã€‚
@code{data[xyz]} ç”¨å­—ä¸² @code{"12.153"} èµ‹ç»™ @code{data} çš„ä¸‹æ ‡
ï¼ˆä½¿ç”¨é»˜è®¤çš„ @code{CONVFMT} è½¬æ¢å€¼ @code{"%.6g"}ï¼‰ã€‚
å› æ­¤ï¼Œæ•°ç»„å…ƒç´  @code{data["12.153"]} è¢«èµ‹å€¼ä¸º 1ã€‚ç¨‹åºç„¶åæ”¹å˜ @code{CONVFMT} çš„å€¼ã€‚
æµ‹è¯•è¯­å¥ @samp{(xyz in data)} äº§ç”Ÿä¸€ä¸ª @code{xyz} çš„æ–°å­—ä¸²å€¼â€”â€”è¿™æ¬¡åˆ™æ˜¯ @code{"12.15"}
â€”â€”å› ä¸º @code{CONVFMT} çš„å€¼åªå…è®¸æœ‰ä¸¤ä¸ªæœ‰æ•ˆä½ã€‚è¿™ä¸ªæµ‹è¯•ä¼šå¤±è´¥ï¼Œå› ä¸º @code{"12.15"} ä¸ @code{"12.153"} æ˜¯ä¸åŒçš„ã€‚

@cindex converting integer array subscripts
@cindex integer array indices
æ ¹æ®è½¬æ¢è§„åˆ™ï¼ˆæŸ¥çœ‹ @ref{Conversion}ï¼‰ï¼Œæ•´æ•°æ€»æ˜¯ä¼šè½¬æ¢ä¸ºæ•´æ•°çš„å­—ä¸²ï¼Œä¸ç®¡ @code{CONVFMT} çš„å€¼æ˜¯ä»€ä¹ˆã€‚å› æ­¤ä¸‹é¢çš„ä¾‹å­å¯ä»¥å·¥ä½œï¼š

@example
for (i = 1; i <= maxsub; i++)
    @ii{do something with} array[i]
@end example

â€œæ•´æ•°æ€»æ˜¯è½¬æ¢ä¸ºæ•´æ•°å­—ä¸²â€è§„åˆ™åœ¨æ•°ç»„ç´¢å¼•ä¸­æœ‰å¦ä¸€ä¸ªç»“æœã€‚å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶å¸¸é‡
@ifnotdocbook
ï¼ˆæŸ¥çœ‹ @ref{Nondecimal-numbers}ï¼‰
@end ifnotdocbook
@ifdocbook
ï¼ˆæŸ¥çœ‹ @ref{Nondecimal-numbers}ï¼‰
@end ifdocbook
åœ¨å†…éƒ¨ä¼šè½¬æ¢ä¸ºæ•°å€¼ï¼Œå®ƒä»¬çš„åŸå‹å½¢å¼ä¼šè¢«ä¸¢å¼ƒã€‚è¿™å°±æ˜¯è¯´ï¼Œ@code{array[17]}ï¼Œ@code{array[021]} ä¸ @code{array[0x11]} éƒ½æ˜¯æŒ‡å‘åŒä¸€ä¸ªå…ƒç´ ï¼

ä¸ @command{awk} è®¸å¤šçš„äº‹æƒ…ä¸€æ ·ï¼Œå¤§éƒ¨ä»½æ—¶é—´ä¸‹ï¼Œäº‹æƒ…éƒ½ä¸ä½ æ‰€æœŸæœ›å®ƒæ‰€åº”è¯¥æ˜¯é‚£æ ·çš„æ–¹å¼å·¥ä½œã€‚ä½†æ˜¯å¯¹äºå®é™…è§„åˆ™å…·æœ‰ç²¾ç¡®çŸ¥è¯†æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒä»¬æœ‰æ—¶ä¼šè®©ä½ çš„ç¨‹åºè¡¨ç°å‡ºä¸€äº›å¾ˆå¾®å¦™çš„ç»“æœã€‚

@node Uninitialized Subscripts
@section ç”¨æœªåˆå§‹åŒ–çš„æ•°å€¼ä½œä¸ºæ•°ç»„ä¸‹æ ‡

@cindex variables, uninitialized@comma{} as array subscripts
@cindex uninitialized variables, as array subscripts
@cindex subscripts in arrays, uninitialized variables as
@cindex arrays, subscripts, uninitialized variables as
å‡å¦‚æœ‰å¿…è¦å†™ä¸€ä¸ªç¨‹åºæ¥å°†è¾“å…¥çš„æ•°æ®é€†åºæ‰“å°ã€‚ä¸€ä¸ªåˆç†çš„å°è¯•æ¥è¿™ä¹ˆåšï¼ˆå¸¦ä¸Šä¸€äº›æµ‹è¯•æ•°æ®ï¼‰å¯èƒ½å¦‚ä¸‹ï¼š

@example
$ @kbd{echo 'line 1}
> @kbd{line 2}
> @kbd{line 3' | awk '@{ l[lines] = $0; ++lines @}}
> @kbd{END @{}
>     @kbd{for (i = lines - 1; i >= 0; i--)}
>        @kbd{print l[i]}
> @kbd{@}'}
@print{} line 3
@print{} line 2
@end example

ä¸å¹¸çš„æ˜¯ï¼Œç¬¬ä¸€è¡Œçš„æ•°æ®ä¸ä¼šå‡ºç°åœ¨è¾“å‡ºä¸­ï¼

åˆçœ‹èµ·æ¥ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™ä¸ªç¨‹åºåº”è¯¥å¯ä»¥å·¥ä½œã€‚å˜é‡ @code{lines} æ˜¯æœªåˆå§‹åŒ–çš„ï¼Œ
è€Œä¸€ä¸ªæœªåˆå§‹åŒ–çš„å˜é‡å…·æœ‰å€¼ä¸º 0ã€‚å› æ­¤ï¼Œ@command{awk} åº”è¯¥ä¼šæ‰“å° @code{l[0]} çš„å€¼ã€‚

è¿™é‡Œçš„é—®é¢˜æ˜¯ @command{awk} æ•°ç»„ä¸­çš„ä¸‹æ ‡@emph{æ€»æ˜¯}å­—ç¬¦ä¸²ã€‚
æœªåˆå§‹åŒ–çš„å˜é‡è¢«ç”¨ä½œå­—ç¬¦ä¸²æ—¶ï¼Œå…¶å€¼ä¸º @code{""}ï¼Œè€Œä¸æ˜¯ 0ã€‚
æ‰€ä»¥ï¼Œ@samp{line 1} æœ€ç»ˆè¢«å­˜åœ¨ @code{l[""]} ä¸­ã€‚ä¸‹é¢çš„ç‰ˆæœ¬åˆ™å¯ä»¥æ­£ç¡®å·¥ä½œï¼š

@example
@{ l[lines++] = $0 @}
END @{
    for (i = lines - 1; i >= 0; i--)
       print l[i]
@}
@end example

åœ¨è¿™é‡Œï¼Œ@samp{++} å¼ºåˆ¶ @code{lines} æˆä¸ºä¸€æ•°å€¼ï¼Œæ‰€åœ¨ä½¿å¾—å…¶â€œæ—§å€¼â€
ï¼ˆå› ä¸ºæ˜¯æœªåˆå§‹åŒ–çš„å˜é‡ï¼Œå› æ­¤å°±æ— æ‰€è°“æ—§å€¼ï¼Œè¿™é‡Œæ˜¯ä¸ºè¡¨è¿°æ–¹ä¾¿ã€‚â€”â€”è¯‘è€…ï¼‰ä¸ºæ•°å€¼ 0ã€‚ç„¶åå…¶è¢«è½¬æ¢ä¸º @code{"0"} ä½œä¸ºæ•°ç»„çš„ä¸‹æ ‡ã€‚

@cindex null strings, as array subscripts
@cindex dark corner, array subscripts
@cindex lint checking, array subscripts
å°±ç®—ä¸æ˜¯ç‰¹åˆ«å¸¸ç”¨ï¼Œç©ºä¸²ï¼ˆ@code{""}ï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ•°ç»„ä¸‹æ ‡ã€‚
@value{DARKCORNER}
@command{gawk} ä¼šå¯¹ä½¿ç”¨ç©ºä¸²ä½œä¸ºä¸‹æ ‡å‘å‡ºè­¦å‘Šï¼Œä½†è¿™åªåœ¨å‘½ä»¤è¡Œå‚æ•°ä¸­æŒ‡å®šäº† @option{--lint} å‚æ•°ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚

@node Delete
@section @code{delete} è¯­å¥
@cindex @code{delete} statement
@cindex deleting elements in arrays
@cindex arrays, elements, deleting
@cindex elements in arrays, deleting

ä¸ºäº†åˆ é™¤æ•°ç»„çš„ä¸€ä¸ªç‹¬ç«‹å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ @code{delete} è¯­å¥ï¼š

@example
delete @var{array}[@var{index-expression}]
@end example

ä¸€æ—¦æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ è¢«åˆ é™¤ï¼Œé‚£ä¸ªå…ƒç´ çš„å€¼å°±ä¸å†å¯ç”¨ã€‚
å°±å¥½åƒé‚£ä¸ªå…ƒç´ ä»æ¥æ²¡æœ‰è¢«ä½¿ç”¨åˆ°æˆ–è€…ä¹Ÿä»æ¥æ²¡æœ‰è¢«èµ‹å€¼ã€‚ä¸‹é¢çš„ä¾‹å­ä»æ•°ç»„ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼š

@example
for (i in frequencies)
    delete frequencies[i]
@end example

@noindent
è¿™ä¸ªä¾‹å­åˆ é™¤æ•°ç»„ @code{frequencies} çš„æ‰€æœ‰å…ƒç´ ã€‚åªè¦ä¸€ä¸ªå…ƒç´ è¢«åˆ é™¤äº†ï¼Œ
åç»­çš„ @code{for} è¯­å¥æ¥æ‰«ææ•°ç»„æ—¶å°±ä¸ä¼šå†æŠ¥å‘Šè¢«åˆ é™¤çš„å…ƒç´ ï¼Œå¹¶ä¸”ç”¨ @code{in} æ“ä½œç¬¦æ¥æ£€æŸ¥è¢«åˆ é™¤çš„å…ƒç´ çš„æ˜¯å¦å­˜åœ¨ä¼šè¿”å› 0ï¼ˆå³ falseï¼‰ï¼š

@example
delete foo[4]
if (4 in foo)
    print "This will never be printed"
@end example

@cindex null strings, and deleting array elements
è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ é™¤ä¸€ä¸ªå…ƒç´ ç»™å…ƒç´ èµ‹ä¸€ä¸ªç©ºå€¼ï¼ˆç©ºä¸²ï¼Œ@code{""}ï¼‰æ˜¯@emph{ä¸¤ç äº‹}ã€‚å¦‚ï¼š

@example
foo[4] = ""
if (4 in foo)
  print "This is printed, even though foo[4] is empty"
@end example

@cindex lint checking, array elements
åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´ å¹¶ä¸æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šäº† @option{--lint} å‚æ•°ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ
å½“åˆ é™¤æ•°ç»„ä¸­ä¸å­˜åœ¨çš„å…ƒç´ çš„æ—¶å€™ï¼Œ@command{gawk} ä¼šäº§ç”Ÿä¸€ä¸ªå‘Šè­¦ä¿¡æ¯ã€‚

@cindex common extensions, @code{delete} to delete entire arrays
@cindex extensions, common@comma{} @code{delete} to delete entire arrays
@cindex arrays, deleting entire contents
@cindex deleting entire arrays
@cindex @code{delete} @var{array}
@cindex differences in @command{awk} and @command{gawk}, array elements, deleting
é€šè¿‡åœ¨ @code{delete} è¯­å¥åé¢çš„æ•°ç»„ä¸­ï¼Œä¸å†™ä¸‹æ ‡æ—¶ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªè¯­å¥å°±å¯åˆ é™¤æ•°ç»„çš„æ‰€æœ‰å…ƒç´ ï¼Œå¦‚ä¸‹ï¼š


@example
delete @var{array}
@end example

ä½¿ç”¨è¿™ç§ç‰ˆæœ¬çš„ @code{delete} è¯­å¥å¤§æ¦‚è¦æ¯”ä½¿ç”¨ç­‰åŒçš„ä¸€æ¬¡åˆ é™¤ä¸€ä¸ªå…ƒç´ çš„å¾ªç¯è¦å¿«å¤§æ¦‚ 3 å€ã€‚

è¿™ç§ç±»å‹çš„ @code{delete} è¯­å¥ä¹Ÿè¢« BWK @command{awk} ä¸ @command{mawk} æ‰€æ”¯æŒï¼Œå¾ˆå¤šå…¶ä»–ç‰ˆæœ¬çš„å®ç°ä¹Ÿæ”¯æŒã€‚

@cindex Brian Kernighan's @command{awk}
@quotation æç¤º
å¾ˆå¤šå¹´ä»¥æ¥ï¼Œä½¿ç”¨ @code{delete} è¯­å¥ä¸å¸¦ä¸‹æ ‡æ˜¯ä¸€ä¸ªé€šç”¨çš„æ‰©å±•ã€‚åœ¨ 2012 å¹´çš„ 9 æœˆï¼Œå®ƒè¢«æ¥å—å¹¶åŒ…å«åˆ° POSIX æ ‡å‡†ä¸­ã€‚
æŸ¥çœ‹ @uref{http://austingroupbugs.net/view.php?id=544,
Austin Group ç½‘ç«™}ã€‚
@end quotation

@cindex portability, deleting array elements
@cindex Brennan, Michael
ä¸‹é¢çš„è¯­å¥æä¾›äº†ä¸€ç§å¯ç§»æ¤ä½†æ˜¯ä¸æ˜¯ç‰¹åˆ«æ˜æ˜¾çš„æ–¹å¼æ¥å°†æ•°ç»„æ¸…é™¤ï¼š 
@footnote{æ„Ÿè°¢ Michael Brennan æå‡ºè¿™ç‚¹ã€‚}

@example
split("", array)
@end example

@cindex @code{split()} function, array elements@comma{} deleting
@code{split()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ä¼šé¦–å…ˆæ¸…é™¤ç›®æ ‡æ•°ç»„ã€‚è¿™ä¸ªè°ƒç”¨è¯·æ±‚åˆ†å‰²ä¸€ä¸ªç©ºä¸²ã€‚å› ä¸ºæ²¡æœ‰æ•°æ®ç”¨æ¥åˆ†å‰²ï¼Œå‡½æ•°åªæ˜¯ç®€å•åœ°æ¸…é™¤æ•°ç»„ç„¶åè¿”å›ã€‚

@quotation CAUTION
æ³¨æ„ï¼šåˆ é™¤æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ä¸ä¼šæ”¹å˜å®ƒçš„ç±»å‹ï¼Œä½ ä¸å¯æ¸…é™¤ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åä½¿ç”¨æ•°ç»„çš„åå­—æ¥ä½œä¸ºä¸€ä¸ªæ ‡é‡åï¼ˆæ¯”å¦‚ä¸€ä¸ªå¸¸è§„çš„å˜é‡ï¼‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä¾‹å­ä¸ä¼šå·¥ä½œï¼š

@example
a[1] = 3
delete a
a = 3
@end example
@end quotation

@node Multidimensional
@section å¤šç»´æ•°ç»„

@menu
* Multiscanning::               Scanning multidimensional arrays.
@end menu

@cindex subscripts in arrays, multidimensional
@cindex arrays, multidimensional
@dfn{å¤šç»´æ•°ç»„}æ˜¯è¿™æ ·çš„æ•°ç»„ï¼Œå…¶å…ƒç´ çš„æ ‡è¯†æ˜¯é€šè¿‡ä¸€è¿ä¸²çš„ç´¢å¼•è€Œä¸æ˜¯å•ä¸ªç´¢å¼•æ¥æ ‡è¯†çš„ã€‚ä¾‹å¦‚ï¼Œä¸¤ç»´æ•°ç»„éœ€è¦ä¸¤ä¸ªç´¢å¼•ã€‚
ä¸€èˆ¬çš„æ–¹å¼ï¼ˆåŒ…æ‹¬ @command{awk} åœ¨å†…çš„è®¸å¤šè¯­è¨€ï¼‰è¦å‚è€ƒåˆ°ä¸¤ç»´æ•° @code{grid} ä¸­çš„å…ƒç´ ï¼Œåˆ™ç”¨ @code{grid[@var{x},@var{y}]}ã€‚

@cindex @code{SUBSEP} variable, and multidimensional arrays
åœ¨ @command{awk} ä¸­çš„å¤šç»´æ•°ç»„æ˜¯é€šè¿‡å°†ç´¢å¼•è¿æ¥æˆå­—ä¸²æ¥å®ç°çš„ã€‚@command{awk} å°†ç´¢å¼•è½¬æ¢ä¸ºå­—ä¸²
ï¼ˆæŸ¥çœ‹ @ref{Conversion}ï¼‰ç„¶åå°†å®ƒä»–è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹é—´å­˜æ”¾åˆ†éš”ç¬¦ã€‚
è¿™æ ·å¯ä»¥åˆ›å»ºä¸€ä¸ªå•ä¸€çš„å­—ä¸²æ¥æè¿°åˆ†ç¦»ç´¢å¼•çš„å€¼ã€‚åˆå¹¶åçš„å­—ä¸²ç”¨ä½œæ™®é€šçš„ä¸€ç»´æ•°ç»„çš„ä¸€ä¸ªç´¢å¼•ã€‚åˆ†éš”ç¬¦åˆ™ä½¿ç”¨å†…å»ºå˜é‡ @code{SUBSEP} çš„å€¼ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬å¯¹è¡¨è¾¾å¼ @samp{foo[5,12] = "value"} æ±‚å€¼ï¼Œå¹¶ä¸” @code{SUBSEP} çš„å€¼ä¸º @code{"@@"} çš„æ—¶å€™ã€‚
æ•°å€¼ 5 ä¸ 12 ä¼šè¢«è½¬æ¢æˆå­—ä¸²å¹¶ä¸”ç”¨ @samp{@@} è¿æ¥å®ƒä»¬ï¼Œä»è€Œäº§ç”Ÿ @code{"5@@12"}ï¼›
æ‰€ä»¥ï¼Œæ•°ç»„å…ƒç´  @code{foo["5@@12"]} çš„å€¼è¢«è®¾ç½®æˆ @code{"value"}ã€‚

ä¸€æ—¦å…ƒç´ è¢«å­˜å‚¨ï¼Œ@command{awk} å°±ä¸å†è®°å¾—å®ƒæ˜¯å­˜æˆå•ä¸ªçš„ç´¢å¼•è¿˜æ˜¯ç”¨ä¸€ä¸²ç´¢å¼•ã€‚
@samp{foo[5,12]} ä¸ @w{@samp{foo[5 SUBSEP 12]}} æ€»æ˜¯ç­‰åŒçš„ã€‚

@code{SUBSEP} çš„é»˜è®¤å€¼æ˜¯ @code{"\034"}ï¼Œè¿™åŒ…å«äº†éæ‰“å°å­—ç¬¦ï¼Œå¹¶ä¸ä¼šå‡ºç°åœ¨ @command{awk} ç¨‹åºä¸­ï¼Œ
æˆ–è€…ä¸ä¼šå‡ºç°åœ¨è¾“å…¥æ•°æ®ä¸­ã€‚ä½¿ç”¨ä¸€ä¸ªä¸å¤ªå¯èƒ½çš„å­—ç¬¦çš„ç”¨å¤„æ¥è‡ªäºè¿™æ ·çš„äº‹å®ï¼Œ
å³ç´¢å¼•å€¼ä¸­åŒ…å«ä¸€ä¸ªä¸²åŒ¹é… @code{SUBSEP} å¯ä»¥å¯¼è‡´åˆå¹¶åçš„å­—ä¸²çš„å«ä¹‰ä¸æ˜ã€‚
å¦‚ @code{SUBSEP} æ˜¯ @code{"@@"}ï¼Œåˆ™ @w{@samp{foo["a@@b", "c"]}} ä¸ @w{@samp{foo["a",
"b@@c"]}} åˆ™æ²¡åŠæ³•åŒºåˆ†å¼€æ¥ï¼Œå› ä¸ºä¸¤è€…éƒ½ä¼šå­˜æˆ @samp{foo["a@@b@@c"]} ã€‚

@cindex @code{in} operator, index existence in multidimensional arrays
è¦æµ‹è¯•ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•åºåˆ—æ˜¯å¦å­˜åœ¨äºå¤šç»´æ•°ç»„ä¸­ï¼Œä½¿ç”¨ä¸ä¸€ç»´æ•°ç»„ç›¸åŒçš„ @code{in} æ“ä½œç¬¦ã€‚
å°†æ•´ä¸ªåºåˆ—å†™åœ¨æ°”æ‹¬å·ä¸­ï¼Œå¹¶ç”¨é€—å·åˆ†éš”ï¼Œå¹¶åšä¸º @code{in} çš„å·¦æ“ä½œæ•°ï¼š

@example
if ((@var{subscript1}, @var{subscript2}, @dots{}) in @var{array})
    @dots{}
@end example

ä¸‹é¢æ˜¯ä¸€ä¸ªå°†è¾“å…¥ä½œä¸ºä¸€ä¸ªåŸŸçš„äºŒç»´æ•°ç»„çš„ä¾‹å­ï¼Œç„¶åå°†æ•°ç»„é¡ºæ—¶é’ˆè½¬ 90 åº¦ï¼ˆæ³¨ä¸‹ï¼‰ï¼Œå†æ‰“å°ç»“æœã€‚å‡è®¾æ‰€æœ‰çš„è¡Œéƒ½ç›¸ç›¸åŒæ•°ç›®çš„å…ƒç´ ï¼š

@example
@{
     if (max_nf < NF)
          max_nf = NF
     max_nr = NR
     for (x = 1; x <= NF; x++)
          vector[x, NR] = $x
@}

END @{
     for (x = 1; x <= max_nf; x++) @{
          for (y = max_nr; y >= 1; --y)
               printf("%s ", vector[x, y])
          printf("\n")
     @}
@}
@end example

@noindent
å¦‚æœè¾“å…¥å¦‚ä¸‹ï¼š

@example
1 2 3 4 5 6
2 3 4 5 6 1
3 4 5 6 1 2
4 5 6 1 2 3
@end example

@noindent
åˆ™ç¨‹åºä¼šäº§ç”Ÿä¸‹é¢çš„è¾“å‡ºï¼š

@example
4 3 2 1
5 4 3 2
6 5 4 3
1 6 5 4
2 1 6 5
3 2 1 6
@end example

@node Multiscanning
@subsection éå†å¤šç»´æ•°ç»„

æ²¡æœ‰ç‰¹æ®Šçš„ @code{for} è¯­å¥ç”¨æ¥è¿›è¡Œâ€œå¤šç»´â€æ•°ç»„çš„éå†ã€‚ä¹Ÿä¸ä¼šæœ‰è¿™ä¹ˆä¸€ä¸ªï¼Œå› ä¸ºäº‹å®ä¸Šï¼Œ@command{awk} æ ¹æœ¬å°±æ²¡æœ‰äºŒç»´æ•°ç»„æˆ–è€…å…ƒç´ ã€‚
åªæœ‰ä¸€ä¸ªå¤šç»´@emph{æ–¹å¼}æ¥è®¿é—®æ•°ç»„ã€‚

@cindex subscripts in arrays, multidimensional, scanning
@cindex arrays, multidimensional, scanning
@cindex scanning multidimensional arrays
ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ç¨‹åºæœ‰è¿™æ ·çš„æ•°ç»„æ€»æ˜¯åƒå¤šç»´æ•°ç»„ä¸€æ ·æ¥è®¿é—®ï¼Œä½ å¯ä»¥ç”¨ @code{split()} å‡½æ•°
ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰æ¥è·å¾— @code{for} è¯­å¥ä¸€æ ·çš„æ‰«ææ•ˆæœï¼ˆæŸ¥çœ‹ @ref{Scanning an Array}ï¼‰ã€‚
å®ƒæ˜¯ä»¥ä¸‹é¢çš„æ–¹å¼æ¥å·¥ä½œçš„ï¼š

@example
for (combined in array) @{
    split(combined, separate, SUBSEP)
    @dots{}
@}
@end example

@noindent
è¿™é‡Œå°†å˜é‡ @code{combined} ä¸ºæ•°ç»„ä¸­æ¯ä¸ªç´¢å¼•çš„è¿æ¥ç»„åˆï¼Œç„¶åç”¨ @code{SUBSEP} çš„å€¼ï¼Œ
å°†å®ƒåˆ†å‰²ä¸ºç‹¬ç«‹çš„ç´¢å¼•ã€‚å•ç‹¬çš„ç´¢å¼•ç„¶åå°±å¯ä»¥æˆä¸ºæ•°ç»„ @code{separate} çš„å…ƒç´ ã€‚

å› æ­¤ï¼Œå¦‚æœå‰é¢çš„å€¼å­˜åœ¨ @code{array[1, "foo"]} é‡Œï¼Œåˆ™ä¼šæœ‰ç´¢å¼•ä¸º @code{"1\034foo"} çš„å…ƒç´ å­˜åœ¨æ•°ç»„ä¸­ã€‚
ï¼ˆå›å¿†ä¸€ä¸‹ @code{SUBSEP} çš„é»˜è®¤å€¼æ˜¯ â€œ\034â€ã€‚ï¼‰
æ—©æ—©æ™šæ™šï¼Œ@code{for} è¯­å¥ä¼šæ‰¾åˆ°ç´¢å¼•ï¼Œå¹¶å°†å˜é‡ @code{combined} è®¾ç½®æˆ @code{"1\034foo"} æ¥è¿›è¡Œè¿­ä»£ã€‚
ç„¶å @code{split()} å‡½æ•°ä¼šåƒä¸‹é¢è¿™æ ·æ¥è°ƒç”¨ï¼š

@example
split("1\034foo", separate, "\034")
@end example

@noindent
ç»“æœä¼šå°† @code{separate[1]} è®¾ç½®æˆ @code{"1"}ï¼Œ@code{separate[2]} ä¸º @code{"foo"}ã€‚
å¤ªç¥å¥‡äº†ï¼ŒåŸæ¥çš„åˆ†ç¦»çš„ç´¢å¼•åºåˆ—åˆè¢«æ¢å¤äº†ã€‚


@node Arrays of Arrays
@section å¤šç»´æ•°ç»„
@cindex arrays of arrays

@command{gawk} è¶…è¶Šäº†æ ‡å‡†çš„ @command{awk} çš„å¤šç»´æ•°ç»„çš„è®¿é—®ï¼Œå¹¶æä¾›äº†çœŸæ­£çš„å¤šç»´æ•°ç»„ã€‚å­æ•°ç»„çš„å…ƒç´ é€šè¿‡å®ƒä»¬åœ¨æ–¹æ‹¬å·ä¸­çš„ä¸‹æ ‡æ¥å–å¾—ï¼Œå°±æ˜¯ä¸»æ•°ç»„å…ƒç´ ä¸€æ ·ã€‚
ä¾‹å¦‚ï¼Œä¸‹é¢åˆ›å»ºä¸€ä¸ªä¸¤å…ƒç´ çš„å­æ•°ç»„ï¼Œç´¢å¼•ä¸ºä¸»æ•°ç»„ @code{a} çš„ @code{1}ï¼š

@example
a[1][1] = 1
a[1][2] = 2
@end example

è¿™é‡Œæ¨¡æ‹Ÿäº†ä¸€ä¸ªçœŸæ­£çš„ä¸¤ç»´æ•°ç»„ã€‚æ¯ä¸€ä¸ªå­æ•°ç»„å…ƒç´ åŒ…å«å¦ä¸€ä¸ªå­æ•°ç»„ä½œä¸ºå€¼ï¼Œè¿›è€Œä¹Ÿå¯ä»¥åŒ…å«å…¶ä»–çš„æ•°ç»„ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œä½ å¯ä»¥åˆ›å»ºä¸‰ç»´æˆ–è€…å¤šç»´çš„æ•°ç»„ã€‚
ç´¢å¼•å¯ä»¥æ˜¯ @command{awk} æ‰€ä»»æ„è¡¨è¾¾å¼ï¼ŒåŒ…æ‹¬ç”¨é€—å·åˆ†éš”çš„æ ‡é‡ï¼ˆä¾‹å¦‚å¸¸è§„çš„ @command{awk} æ¨¡æ‹Ÿå¤šç»´çš„ä¸‹æ ‡ï¼‰ã€‚å› æ­¤ï¼Œä¸‹é¢ä»£ç åœ¨ @command{gawk} ä¸­æ˜¯æœ‰æ•ˆçš„ï¼š

@example
a[1][3][1, "name"] = "barney"
@end example

æ¯ä¸€ä¸ªå­æ•°ç»„ä¸ä¸»æ•°ç»„å¯ä»¥æœ‰ä¸åŒçš„é•¿åº¦ã€‚å®é™…ä¸Šï¼Œæ•°ç»„çš„å…ƒç´ ï¼Œæˆ–è€…å®ƒçš„å­æ•°ç»„ä¸å¿…è¦éƒ½åŒ…å«ç›¸åŒç±»å‹ã€‚
è¿™æ„å‘³ç€ï¼Œä¸»æ•°ç»„ä¸å®ƒçš„å­æ•°ç»„åœ¨ç»“æ„ä¸Šï¼Œå¯ä»¥æ˜¯éçŸ©å½¢çš„ï¼Œå³æ˜¯é”¯é½¿å½¢çš„ã€‚
ä½ å¯ä»¥ç»™ä¸»æ•°ç»„ @code{a} ç´¢å¼•ä¸º @code{4} çš„å…ƒç´ èµ‹å€¼ä¸€ä¸ªæ ‡é‡ï¼Œå°±ç®—æ˜¯ @code{a[1]} æœ¬èº«æ˜¯ä¸€ä¸ªæ•°ç»„è€Œä¸æ˜¯ä¸€ä¸ªæ ‡é‡ï¼š

@example
a[4] = "An element in a jagged array"
@end example

@dfn{ç»´åº¦}ï¼Œ@dfn{è¡Œ}ï¼Œ@dfn{åˆ—}è¿™æ ·çš„æœ¯è¯­ç”¨åœ¨è¿™æ ·çš„æ•°ç»„ä¸­æ˜¯æ²¡æœ‰å«ä¹‰çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨â€œç»´åº¦â€è¡¨ç¤ºè¦è®¿é—®ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å…ƒç´ çš„æ‰€éœ€è¦çš„ç´¢å¼•æ•°çš„æœ€å¤§å€¼ã€‚
ä»»æ„å…ƒç´ çš„ç±»å‹ï¼Œä¸€æ—¦è¢«èµ‹å€¼ï¼Œå°±ä¸èƒ½é€šè¿‡èµ‹å€¼ä¸€ä¸ªä¸åŒç±»å‹çš„å€¼æ¥æ”¹å˜å®ƒçš„ç±»å‹ã€‚ä½ å¿…é¡»å…ˆåˆ é™¤å½“å‰çš„å…ƒç´ ï¼Œè¿™æ ·ä½¿ @command{gawk} å¯ä»¥æœ‰æ•ˆåœ°ä¸¢å¼ƒåœ¨é‚£ä¸ªç´¢å¼•ä¸‹çš„å…ƒç´ ï¼š

@example
delete a[4]
a[4][5][6][7] = "An element in a four-dimensional array"
@end example

@noindent
è¿™é‡Œåˆ é™¤ç´¢å¼•ä¸º @code{4} çš„æ ‡é‡å€¼ï¼Œç„¶åæ’å…¥ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæ ‡é‡çš„ä¸‰å±‚çš„å†…åµŒå­æ•°ç»„ã€‚ä½ ä¹Ÿå¯ä»¥åˆ é™¤æ•´ä¸ªçš„å­æ•°ç»„çš„å­æ•°ç»„çš„äº†æ•°ç»„ï¼š

@example
delete a[4][5]
a[4][5] = "An element in subarray a[4]"
@end example

ä½†æ˜¯è¦è®°ä½ï¼Œä½ ä¸å¯ä»¥åˆ é™¤ä¸»æ•°ç»„ @code{a}ï¼Œç„¶åå°†å…¶ç”¨ä½œä¸€ä¸ªæ ‡é‡ã€‚

å†…ç½®å‡½æ•°ä¸­ä½¿ç”¨æ•°ç»„ä½œä¸ºå‚æ•°æ—¶ï¼Œå‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨å­æ•°ç»„ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ®µä½¿ç”¨ @code{length()}
ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰æ¥ç¡®å®šä¸»æ•°ç»„ @code{a} ä¸å…¶å­æ•°ç»„çš„å…ƒç´ ä¸ªæ•°ï¼š

@example
print length(a), length(a[1]), length(a[1][3])
@end example

@noindent
å¯¹ä¸»æ•°ç»„ @code{a} çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

@example
2, 3, 1
@end example

@noindent
@samp{@var{subscript} in @var{array}} è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @ref{Reference to Elements}ï¼‰
å·¥ä½œåŸç†ä¸æ­£è§„çš„ @command{awk} æ•°ç»„ä»¥åŠå¤šç»´æ•°ç»„çš„æ–¹å¼ç›¸ä¼¼ã€‚
ä¾‹å¦‚æµ‹è¯•è¯­å¥ @samp{1 in a}ï¼Œ@samp{3 in a[1]} ä¸ @samp{(1, "name") in a[1][3]} å¯¹äºæ•°ç»„ @code{a} éƒ½ä¼šæ±‚å€¼ä¸º 1ï¼ˆtrueï¼‰ã€‚

@samp{for (item in array)} è¯­å¥ï¼ˆæŸ¥çœ‹ @ref{Scanning an Array}ï¼‰å¯ä»¥åµŒå¥—ï¼Œç”¨æ¥æ‰«æä¸€ä¸ªå¤šç»´æ•°ç»„çš„æ‰€æœ‰å…ƒç´ ï¼Œ
åªè¦å®ƒåœ¨ç»“æ„ä¸Šæ˜¯çŸ©å½¢çš„ã€‚ä¸ºäº†æ‰“å°ä¸¤ç»´å¤šç»´æ•°ç»„çš„å†…å®¹ï¼ˆæ ‡é‡ï¼‰ï¼ˆåœ¨æ•°ç»„ä¸­ï¼Œå®ƒçš„ç¬¬ä¸€å±‚æœ¬èº«æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†ä¸å¿…æ˜¯æœ‰ç›¸åŒçš„é•¿åº¦ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼š

@example
for (i in array)
    for (j in array[i])
        print array[i][j]
@end example

@code{isarray()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{Type Functions}ï¼‰
å¯ä»¥è®©ä½ æµ‹è¯•æ•°ç»„çš„å…ƒç´ æ˜¯å¦ä¸ºæ•°ç»„ï¼š

@example
for (i in array) @{
    if (isarray(array[i]) @{
        for (j in array[i]) @{
            print array[i][j]
        @}
    @}
    else
        print array[i]
@}
@end example

å¦‚æœä¸€ä¸ªäº‹å…ˆçŸ¥é“æ˜¯ä¸€ä¸ªé”¯é½¿å½¢çš„æ•°ç»„ï¼Œä½ é€šå¸¸è¦é€šè¿‡æ§åˆ¶è¯­å¥æ¥è§£å†³éå†é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ‰“å°ä¸»æ•°ç»„ @code{a} çš„å…ƒç´ ï¼š

@example
for (i in a) @{
    for (j in a[i]) @{
        if (j == 3) @{
            for (k in a[i][j])
                print a[i][j][k]
        @} else
            print a[i][j]
    @}
@}
@end example

@noindent
æŸ¥çœ‹ @ref{Walking Arrays}ï¼Œæ¥è·å–ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå…¶åŠŸèƒ½å°±æ˜¯ç”¨æ¥éå†ä»»æ„ç»´åº¦çš„å¤šç»´æ•°ç»„ã€‚

å›å¿†ä¸€ä¸‹å‚è€ƒä¸€ä¸ªæœªåˆå§‹åŒ–çš„æ•°ç»„å…ƒç´ ä¼šäº§ç”Ÿä¸€ä¸ª @code{""} å€¼ï¼Œå³ç©ºä¸²ã€‚
è¿™æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å«ä¹‰ï¼Œå³å½“ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªå­æ•°ç»„ä½œä¸ºå‚æ•°å‘å‡½æ•°ä¼ é€’ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€å‘ˆç°çš„ï¼š

@example
$ @kbd{gawk 'BEGIN @{ split("a b c d", b[1]); print b[1][1] @}'}
@error{} gawk: cmd. line:1: fatal: split: second argument is not an array
@end example

è¦è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œé¦–å…ˆè¦é€šè¿‡åˆ›å»ºä¸€ä¸ªä»»æ„çš„ç´¢å¼•ï¼Œä»¥å¼ºåˆ¶ @code{b[1]} æˆæ˜¯ä¸€ä¸ªæ•°ç»„ï¼š

@example
$ @kbd{gawk 'BEGIN @{ b[1][1] = ""; split("a b c d", b[1]); print b[1][1] @}'}
@print{} a
@end example

@node Arrays Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
æ ‡å‡†çš„ @command{awk} æä¾›ä¸€ç»´å…³è”æ•°ç»„ï¼ˆé€šè¿‡å­—ä¸²è¿›è¡Œç´¢å¼•çš„æ•°ç»„ï¼‰ã€‚æ‰€æœ‰çš„æ•°ç»„éƒ½æ˜¯å…³è”çš„ï¼Œæ•°å€¼ç´¢å¼•ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºå­—ä¸²ã€‚

@item
æ•°ç»„å…ƒç´ é€šè¿‡ @code{@var{array}[@var{indx}]} è¿›è¡Œå‚è€ƒã€‚å‚è€ƒä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´ ï¼Œåˆ™ä¼šåˆ›å»ºè¿™ä¸ªå…ƒç´ ã€‚

@item
æ­£ç¡®çš„æŸ¥çœ‹æ˜¯å¦ç»™å®šç´¢å¼•çš„å…ƒç´ æ˜¯å¦å­˜åœ¨æ•°ç»„ä¸­çš„æ–¹å¼æ˜¯ä½¿ç”¨ @code{in} æ“ä½œç¬¦ï¼š@samp{@var{indx} in @var{array}}

@item
ä½¿ç”¨ @samp{for (@var{indx} in @var{array}) @dots{}} æ¥æè¿°æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚
åœ¨ç¯å¢ƒä½“ä¸­ï¼Œ@var{indx} ä¼šè½®æµåœ°è®¾ç½®ä¸ºå…ƒç´ çš„ç´¢å¼•å€¼ã€‚

@item
ç”¨ @samp{for (@var{indx} in @var{array})} æ¥éå†æ•°ç»„çš„é¡ºåºåœ¨ POSIX @command{awk} ä¸­æ˜¯æœªå®šä¹‰çš„ï¼Œå¹¶ä¸”ä¸åŒçš„ç‰ˆæœ¬å®ç°æ˜¯ä¸åŒçš„ã€‚
@command{gawk} ä½¿ç”¨é€šè¿‡è®¾ç½®é¢„å®šä¹‰å˜é‡ @code{PROCINFO["sorted_in"]} çš„å€¼æ¥æ§åˆ¶éå†çš„é¡ºåºã€‚

@item
ä½¿ç”¨ @samp{delete @var{array}[@var{indx}]} æ¥åˆ é™¤å•ä¸ªå…ƒç´ ã€‚è¦åˆ é™¤æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œ
åˆ™ä½¿ç”¨ @samp{delete @var{array}} ã€‚åè€…çš„ç‰¹æ€§å¤šå¹´æ¥éƒ½æ˜¯ä¸€ä¸ªé€šç”¨æ‰©å±•ï¼Œä½†æ˜¯ç°åœ¨å·²ç»æ ‡å‡†åŒ–äº†ï¼Œ
ä½†æ˜¯å¯èƒ½ä¸æ˜¯æ‰€æœ‰çš„è¢«å•†ä¸šç‰ˆæœ¬çš„ @command{awk} éƒ½æ”¯æŒã€‚

@item
æ ‡å‡†çš„ @command{awk} é€šè¿‡ç”¨é€—å·æ¥åˆ†éš”ä¸åŒçš„ä¸‹æ ‡æ¥æ¨¡æ‹Ÿå¤šç»´æ•°ç»„ã€‚è¿™äº›ä¸‹æ ‡å€¼ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„ä¸²ï¼Œ
å¹¶ä¸”ä½¿ç”¨ @code{SUBSEP} çš„å€¼æ¥è¿›è¡Œåˆ†ç¦»ã€‚é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„ä¸‹æ ‡æ˜¯æ²¡æœ‰ä¿å­˜çš„ï¼Œæ‰€ä»¥æ”¹å˜ @code{SUBSEP} çš„å€¼ä¼šå¯¼è‡´æœªé¢„æœŸçš„ç»“æœã€‚
ä½ å¯ä»¥ä½¿ç”¨ @samp{(@var{sub1}, @var{sub2}, @dots{}) in @var{array}} æ¥æŸ¥çœ‹ä¸€ä¸ªå¤šç»´æ•°ç»„çš„ç›¸åº”ä¸‹æ ‡æ˜¯å¦å­˜åœ¨æ•°ç»„ä¸­ã€‚

@item
@command{gawk} æä¾›äº†çœŸæ­£çš„å¤šç»´æ•°ç»„ã€‚åœ¨è¿™æ ·çš„æ•°ç»„ä¸­ï¼Œä½ å¯ä»¥åœ¨æ–¹æ‹¬å·ä¸­ä½¿ç”¨ç‹¬ç«‹çš„é›†åˆæ¥è¡¨ç¤ºæ¯ä¸€ç»´ã€‚ä¾‹å¦‚ @code{data[row][col]}ã€‚
æ•°ç»„å…ƒç´ å³å¯ä»¥æ˜¯æ ‡é‡ï¼ˆæ•°å€¼æˆ–è€…å­—ä¸²ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„æ•°ç»„ç±»å‹ã€‚

@item
ä½¿ç”¨ @code{isarray()} å†…ç½®å‡½æ•°æ¥ç¡®å®šä¸€ä¸ªæ•°ç»„å…ƒç´ æ˜¯ä¸æ˜¯å­æ•°ç»„ã€‚

@end itemize


@node Functions
@chapter å‡½æ•°

@cindex functions, built-in
@cindex built-in functions
æœ¬@value{CHAPTER}æè¿° @command{awk} çš„å†…ç½®å‡½æ•°ï¼Œå®ƒä»¬è¢«åˆ†æˆä¸‰ç±»ï¼šæ•°å€¼ç±»ï¼Œå­—ä¸²ç±»ä¸ I/O ç±»ã€‚
@command{gawk} è¿˜æä¾›é¢å¤–çš„ä¸€äº›å‡½æ•°ç”¨æ¥è¡¨ç¤ºæ—¶é—´çš„å€¼ã€æˆ–è€…è¿›è¡Œä½æ“ä½œï¼Œæ•°ç»„æ’åºï¼Œæä¾›ç±»å‹ä¿¡æ¯ï¼Œå›½é™…åŒ–ä¸æœ¬åœ°åŒ–ç¨‹åºã€‚

é™¤äº†å†…ç½®å‡½æ•°ï¼Œ@command{awk} ä¹Ÿæä¾›å†™æ–°å‡½æ•°çš„èƒ½åŠ›ï¼Œè¿™æ ·å¯ä»¥åœ¨ç¨‹åºçš„åé¢è¿›è¡Œè°ƒç”¨ã€‚
æœ¬@value{CHAPTER}çš„ä¸‹åŠéƒ¨ä»½æè¿°äº†@dfn{ç”¨æˆ·è‡ªå®šä¹‰}å‡½æ•°ã€‚
æœ€åï¼Œæˆ‘ä»¬æ¢è®¨é—´æ¥å‡½æ•°è°ƒç”¨ï¼Œä¸€ç§ @command{gawk} æ‰æœ‰çš„æ‰©å±•ï¼Œè¿™æ ·å¯ä»¥è®©ä½ åœ¨è¿è¡Œæ—¶æ¥ç¡®å®šæœ€ç»ˆæ¥è°ƒç”¨ä»€ä¹ˆæ ·çš„å‡½æ•°ã€‚

@menu
* Built-in::                    Summarizes the built-in functions.
* User-defined::                Describes User-defined functions in detail.
* Indirect Calls::              Choosing the function to call at runtime.
* Functions Summary::           Summary of functions.
@end menu

@node Built-in
@section å†…ç½®å‡½æ•°

@dfn{å†…ç½®}å‡½æ•°åœ¨ä½ çš„ @command{awk} ç¨‹åºæ€»æ˜¯å¯ç”¨çš„ã€‚æœ¬@value{SECTION}å®šä¹‰äº†æ‰€æœ‰çš„ @command{awk} ä¸­çš„å‡½æ•°ï¼Œå®ƒä»¬ä¸­çš„ä¸€äº›åœ¨å…¶ä»–çš„@value{SECTION}ä¸­å·²ç»è¢«æåˆ°è¿‡ï¼Œåœ¨è¿™é‡Œè¿›è¡Œæ±‡æ€»ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°å‚è€ƒã€‚

@menu
* Calling Built-in::            How to call built-in functions.
* Numeric Functions::           Functions that work with numbers, including
                                @code{int()}, @code{sin()} and @code{rand()}.
* String Functions::            Functions for string manipulation, such as
                                @code{split()}, @code{match()} and
                                @code{sprintf()}.
* I/O Functions::               Functions for files and shell commands.
* Time Functions::              Functions for dealing with timestamps.
* Bitwise Functions::           Functions for bitwise operations.
* Type Functions::              Functions for type information.
* I18N Functions::              Functions for string translation.
@end menu

@node Calling Built-in
@subsection è°ƒç”¨å†…ç½®å‡½æ•°

ä¸ºäº†è°ƒç”¨ @command{awk} çš„å†…ç½®å‡½æ•°ï¼Œåªéœ€è¦è¾“å…¥å‡½æ•°çš„åå­—ï¼Œåé¢è·Ÿç€æ”¾ç½®åœ¨æ‹¬å·å†…çš„å‚æ•°åˆ—è¡¨å³å¯ã€‚
ä¾‹å¦‚ï¼Œ@samp{atan2(y + z, 1)} ä¸ºè°ƒç”¨å‡½æ•° @code{atan2()}ï¼Œå¹¶å¸¦æœ‰ä¸¤ä¸ªå‚æ•°ã€‚

@cindex programming conventions, functions, calling
@cindex whitespace, functions@comma{} calling
å†…å»ºå‡½æ•°ä¸­å‡½æ•°åä¸å¼€æ‹¬å·ä¹‹é—´çš„ç©ºæ ¼ä¼šè¢«å¿½ç•¥ï¼Œä½†æ˜¯è¿™ä¸æ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œåº”è¯¥è¦é¿å…åœ¨å®ƒä»¬ä¹‹é—´è¾“å…¥ç©ºæ ¼ã€‚ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ä¸å…è®¸åœ¨è¿™ä¸ªä½ç½®æœ‰ç©ºæ ¼ï¼Œå› æ­¤ä¸€ä¸ªç®€å•çš„ç¼–ç¨‹ä¹ æƒ¯å°±å¯ä»¥é¿å…è¿™æ ·çš„é”™è¯¯â€”â€”å°±æ˜¯ä¸è¦åœ¨å‡½æ•°ååé¢æ’å…¥ç©ºæ ¼ã€‚

@cindex troubleshooting, @command{gawk}, fatal errors@comma{} function arguments
@cindex @command{gawk}, function arguments and
@cindex differences in @command{awk} and @command{gawk}, function arguments (@command{gawk})
æ¯ä¸ªå†…ç½®å‡½æ•°éƒ½æ¥æ”¶ç‰¹å®šæ•°ç›®çš„å‚æ•°ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå‚æ•°å¯ä»¥çœç•¥ã€‚å¯¹äºçœç•¥å‚æ•°çš„é»˜è®¤å€¼å‡½æ•°ä¸å‡½æ•°é—´æ˜¯ä¸åŒçš„ï¼Œå¹¶ä¸”ä¼šå•ç‹¬è¿›è¡Œè¯´æ˜ã€‚
ä¸€äº› @command{awk} å®ç°ä¸­ï¼Œæœ‰ä¸€äº›é¢å¤–ä¼šè¢«å¿½ç•¥ã€‚ä½†æ˜¯ï¼Œåœ¨ @command{gawk} ä¸­ï¼Œç»™å†…ç½®å‡½æ•°ä¸€ä¸ªé¢å¤–çš„å‚æ•°æ˜¯ä¸€ä¸ªè‡´ä½¿é”™è¯¯ã€‚

å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œç”Ÿæˆå‡½æ•°å®é™…å‚æ•°çš„è¡¨è¾¾å¼ä¼šåœ¨è°ƒç”¨æ‰§è¡Œå‰è¿›è¡Œæ±‚å€¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­ï¼š

@example
i = 4
j = sqrt(i++)
@end example

@cindex evaluation order, functions
@cindex functions, built-in, evaluation order
@cindex built-in functions, evaluation order
@noindent
å˜é‡ @code{i} ä¼šåœ¨è°ƒç”¨ @code{sqrt()} ä¹‹å‰é€’å¢ä¸ºå€¼ 5ï¼Œä½†æ˜¯è°ƒç”¨æ—¶ä¼šç”¨å€¼ 4 ä½œä¸ºå®é™…çš„å‚æ•°ã€‚ä½œä¸ºå‡½æ•°å‚æ•°çš„è¡¨è¾¾å¼çš„æ±‚å€¼çš„é¡ºåºæ˜¯æœªå®šä¹‰çš„ã€‚æ‰€ä»¥ï¼Œè¦é¿å…å†™ä»å·¦åˆ°å³ï¼Œæˆ–è€…ä»å³åˆ°å·¦è¿›è¡Œæ±‚å€¼çš„ç¨‹åºã€‚å¦‚ï¼š

@example
i = 5
j = atan2(++i, i *= 2)
@end example

å¦‚æœæ±‚å€¼çš„é¡ºåºæ˜¯ä»å·¦åˆ°å³ï¼Œåˆ™ @code{i} ä¼šä¸º 6ï¼Œç„¶åæˆä¸º 12ã€‚åˆ™ä¼šç”¨ 6 ä¸ 12 ä¸¤ä¸ªå€¼è°ƒç”¨ @code{atan2()}ã€‚ä½†æ˜¯å¦‚æœé¡ºåºä¸ºä»å³åˆ°å·¦ï¼Œ@code{i} é¦–å…ˆä¸º 10ï¼Œç„¶åä¸º 11ï¼Œåˆ™ @code{atan2()} ä¼šç”¨ 11ï¼Œä¸ 10 æ¥è¿›è¡Œè°ƒç”¨ã€‚

@node Numeric Functions
@subsection æ•°å€¼å‡½æ•°
@cindex numeric functions

ä¸‹é¢çš„åˆ—è¡¨æè¿°äº†æ‰€æœ‰çš„ç”¨äºæ•°å€¼å¤„ç†çš„å†…ç½®å‡½æ•°ã€‚å¯é€‰çš„å‚æ•°ç”¨æ–¹æ‹¬å·@w{ ([ ]):} åŒ…å«èµ·æ¥ï¼š

@c @asis for docbook
@table @asis
@item @code{atan2(@var{y}, @var{x})}
@cindexawkfunc{atan2}
@cindex arctangent
è¿”å› @code{@var{y} / @var{x}} å¼§åº¦çš„åæ­£åˆ‡å€¼ã€‚ä½ å¯ä»¥ä½¿ç”¨ @samp{pi = atan2(0, -1)} æ¥æ±‚å¾— @value{PI} çš„å€¼ã€‚

@item @code{cos(@var{x})}
@cindexawkfunc{cos}
@cindex cosine
è¿”å› @var{x} çš„ä½™å¼¦å€¼ï¼Œ@var{x} ä¸ºå¼§åº¦ã€‚

@item @code{exp(@var{x})}
@cindexawkfunc{exp}
@cindex exponent
è¿”å› @var{x} çš„è‡ªç„¶å¹‚ï¼ˆ@code{e ^ @var{x}}ï¼‰æˆ–è€… @var{x} çš„å€¼è¶…è¿‡èŒƒå›´åˆ™æŠ¥é”™ã€‚@var{x} çš„èŒƒå›´ä¾èµ–äºä½ çš„æœºå™¨çš„æµ®ç‚¹æ•°è¡¨ç¤ºã€‚

@item @code{int(@var{x})}
@cindexawkfunc{int}
@cindex round to nearest integer
è¿”å›æœ€æ¥è¿‘äº @var{x} çš„æ•´æ•°ï¼Œå…¶å€¼åœ¨ @var{x} ä¸ 0 ä¹‹é—´ï¼Œå¹¶å‘ 0 è¿›è¡Œæˆªå–ã€‚
å¦‚ @code{int(3)} ä¸º 3ï¼Œ@code{int(3.9)} ä¸º 3ï¼Œ@code{int(-3.9)} ä¸º @minus{}3ï¼Œ@code{int(-3)} ä¹Ÿä¸º @minus{}3ã€‚

@item @code{log(@var{x})}
@cindexawkfunc{log}
@cindex logarithm
å¦‚æœ @var{x} ä¸ºæ­£æ•°ï¼Œè¿”å› @var{x} çš„è‡ªç„¶å¯¹æ•°ï¼Œå¦åˆ™åœ¨ IEEE 754 çš„ç³»ç»Ÿä¸Šè¿”å› @code{NaN} ï¼ˆâ€œnot a numberâ€ï¼‰ã€‚
æ­¤å¤–ï¼Œå¦‚æœ @var{x} ä¸ºè´Ÿæ•°ï¼Œ@command{gawk} è¿˜ä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ã€‚

@item @code{rand()}
@cindexawkfunc{rand}
@cindex random numbers, @code{rand()}/@code{srand()} functions
è¿”å›ä¸€ä¸ªéšæœºæ•°ã€‚@code{rand()} çš„å€¼ä¸€è‡´åœ°åˆ†å¸ƒåœ¨ 0 ä¸ 1 ä¹‹é—´ï¼Œå€¼å¯ä»¥ä¸º 0ï¼Œä½†ä¸ä¼šç­‰äº 1ã€‚ 
@footnote{å¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨å¾ˆå¤š Unix ç³»ç»Ÿä¸Šçš„ C ç‰ˆæœ¬çš„ @code{rand()}ï¼Œäº§ç”Ÿçš„éšæœºæ•°åºåˆ—éå¸¸ä¸å¥½ã€‚
ä½†æ˜¯ @command{awk} ç‰ˆæœ¬çš„å®ç°ä¸€ç‚¹éƒ½æ²¡æœ‰ä½¿ç”¨ C ç‰ˆæœ¬çš„ @code{rand()}ã€‚
äº‹å®ä¸Šï¼Œ@command{gawk} ä½¿ç”¨ BSD çš„ @code{random()} å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°äº§ç”Ÿçš„éšæœºæ•°è¦æ¯” @code{rand()} å¥½å¾ˆå¤šã€‚}

é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ éœ€è¦çš„æ˜¯éšæœºçš„æ•´æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œæ­¤å‡½æ•°å¯ä»¥ç”¨æ¥äº§ç”Ÿå°äº @var{n} çš„éšæœºéè´Ÿæ•´æ•°ï¼š

@example
function randint(n)
@{
    return int(n * rand())
@}
@end example

@noindent
ä¹˜æ³•äº§ç”Ÿä¸€ä¸ªéšæœºæ•°å¤§äºç­‰äº 0ï¼Œä½†å°äº @code{n}ã€‚ä½¿ç”¨ @code{int()} å› æ­¤å¯ä»¥ä½¿å¾—ç»“æœæˆä¸º 0 åˆ° @code{n} @minus{} 1 ä¹‹é—´çš„æ•´æ•°ã€‚

ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨ä¸€ä¸ªç›¸ä¼¼çš„å‡½æ•°æ¥äº§ç”Ÿåœ¨ 1 åˆ° @var{n} ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚è¿™ä¸ªç¨‹åºä¼šä¸ºæ¯ä¸ªè¾“å…¥è®°å½•æ‰“å°ä¸€ä¸ªæ–°çš„éšæœºæ•°ï¼š

@example
# Function to roll a simulated die.
function roll(n) @{ return 1 + int(rand() * n) @}

# Roll 3 six-sided dice and
# print total number of points.
@{
    printf("%d points\n", roll(6) + roll(6) + roll(6))
@}
@end example

@cindex seeding random number generator
@cindex random numbers, seed of
@quotation æ³¨æ„
åœ¨å¤§å¤šæ•°çš„ @command{awk} å®ç°ä¸­ï¼ŒåŒ…æ‹¬ @command{gawk}ï¼Œæ¯æ¬¡è¿è¡Œ @command{awk} æ—¶ï¼Œ@code{rand()} éƒ½ä»ç›¸åŒçš„å¼€å§‹æ•°ï¼Œæˆ–è€…ç§å­èµ·äº§ç”Ÿéšæœºæ•°ã€‚
@footnote{@command{mawk} æ¯æ¬¡éƒ½ä½¿ç”¨ä¸åŒçš„ç§å­ã€‚}
æ‰€ä»¥ï¼Œç¨‹åºæ¯æ¬¡è¿è¡Œéƒ½äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚åœ¨ @command{awk} ä¸€æ¬¡è¿è¡Œä¸­äº§ç”Ÿçš„æ•°å€¼æ˜¯éšæœºçš„ï¼Œä½†æ˜¯æ¯æ¬¡è¿è¡Œæ—¶äº§ç”Ÿçš„éšæœºæ•°å´æ˜¯å¯é¢„æµ‹çš„ã€‚è¿™ç”¨ä¸€è°ƒè¯•æ—¶éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³ç¨‹åºæ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™åšä¸åŒçš„äº‹æƒ…ï¼Œä½ å¿…é¡»æ”¹å˜ seed ä¸ºæ¯æ¬¡è¿è¡Œéƒ½ä¸ç›¸åŒçš„å€¼ã€‚è¦è¿™ä¹ˆåšï¼Œå°±è°ƒç”¨ @code{srand()} å‡½æ•°ã€‚
@end quotation

@item @code{sin(@var{x})}
@cindexawkfunc{sin}
@cindex sine
è¿”å›å¼§åº¦ @var{x} çš„æ­£å¼¦å€¼ã€‚

@item @code{sqrt(@var{x})}
@cindexawkfunc{sqrt}
@cindex square root
è¿”å› @var{x} çš„æ­£å¹³æ–¹æ ¹ã€‚@command{gawk} åœ¨ @var{x} ä¸ºè´Ÿå€¼æ—¶ä¼šæ‰“å°ä¸€ä¸ªå‘Šè­¦ã€‚@code{sqrt(4)} çš„å€¼æ˜¯ 2ã€‚

@item @code{srand(}[@var{x}]@code{)}
@cindexawkfunc{srand}
è®¾ç½®å¼€å§‹ç‚¹ï¼Œæˆ–è€…ç§å­ï¼Œç”¨æ¥äº§ç”Ÿç›¸å¯¹äº @var{x} çš„éšæœºæ•°ã€‚

æ¯ä¸€ä¸ªç§å­éƒ½ä¼šäº§ç”Ÿç‰¹å®šåºåˆ—çš„éšæœºæ•°ã€‚
@footnote{è®¡ç®—æœºäº§ç”Ÿçš„éšæœºæ•°ä¸æ˜¯çœŸæ­£çš„éšæœºæ•°ã€‚åœ¨æŠ€æœ¯ä¸Šï¼Œå®ƒä»¬éƒ½æ˜¯@dfn{ä¼ªéšæœº}çš„ã€‚
è¿™å°±æ˜¯è¯´ï¼Œå°½ç®¡æ•°å€¼åºåˆ—çœ‹èµ·æ¥æ˜¯éšæœºçš„ï¼Œä½†æ˜¯äº‹å®ä¸Šä¼šä¸€æ¬¡æ¬¡åœ°äº§ç”Ÿç›¸åŒçš„éšæœºåºåˆ—ã€‚}
æ‰€ä»¥ï¼Œå¦‚æœç§å­æ¯æ¬¡éƒ½è®¾ç½®æˆç›¸åŒçš„å€¼ï¼Œåˆ™éšæœºæ•°æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸€æ ·ã€‚

@quotation æ³¨æ„
ä¸åŒçš„ @command{awk} å®ç°ä½¿ç”¨ä¸åŒçš„å†…éƒ¨éšæœºæ•°äº§ç”Ÿå™¨ã€‚ä¸è¦å¸Œæœ› @command{awk} ç¨‹åºè¢«ä¸åŒç‰ˆæœ¬çš„ @command{awk} æ‰§è¡Œæ—¶ä¼šäº§ç”Ÿç›¸åŒçš„éšæœºæ•°åºåˆ—ã€‚
@end quotation

å¦‚æœåœ¨ @samp{srand()} å‡½æ•°ä¸­çœç•¥äº† @var{x}ï¼Œåˆ™ä¼šä½¿ç”¨å½“å‰çš„æ—¥æœŸä¸å½“å¤©çš„æ—¶é—´æ¥ä½œä¸ºç§å­ã€‚è¿™ç§æ–¹å¼ä¸‹å–å¾—çš„éšæœºæ•°æ˜¯çœŸæ­£ä¸å¯é¢„æµ‹çš„ã€‚

@code{srand()} è¿”å›çš„å€¼æ˜¯å‰ä¸€ä¸ªç§å­çš„å€¼ã€‚è¿™å¯ä»¥ä½¿å¾—å¾ˆå®¹æ˜“æ¥è·Ÿè¸ªç§å­ï¼Œä»¥ä¾¿ä½ éœ€è¦äº§ç”Ÿä¸€è‡´çš„éšæœºæ•°åºåˆ—ã€‚

POSIX æ²¡æœ‰æŒ‡å®šåˆå§‹çš„ç§å­å€¼ï¼Œå› æ­¤åœ¨ä¸åŒçš„ @command{awk} å®ç°ä¸­æ˜¯ä¸åŒçš„ã€‚
@end table

@node String Functions
@subsection å­—ä¸²æ“ä½œå‡½æ•°

@cindex string-manipulation functions

æœ¬@value{SECTION}æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹æŸ¥æ‰¾æˆ–è€…æ›´æ”¹ä¸€ä¸ªæˆ–è€…ä¸€äº›ä¸²çš„æ–‡æœ¬ã€‚

@command{gawk} å¯ä»¥ç†è§£æœ¬æœ¬è¯­è¨€è®¾ç½®ï¼ˆæŸ¥çœ‹ @pxref{Locales}ï¼‰å¹¶ä¸”å¯¹å­—ä¸²çš„å¤„ç†éƒ½æ˜¯æ ¹æ®@emph{å­—ç¬¦}æ¥çš„ï¼Œè€Œä¸æ˜¯@emph{å­—èŠ‚}ã€‚
è¿™ä¸ªåŒºåˆ«åœ¨ç†è§£æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­ï¼Œä¸€ä¸ªå­—ç¬¦éœ€è¦å¤šä¸ªå­—èŠ‚æ¥è¡¨ç¤ºçš„æ—¶å€™éå¸¸é‡è¦ã€‚æ‰€ä»¥ï¼Œåƒ @code{length()} å‡½æ•°ä¼šè¿”å›å­—ä¸²ä¸­çš„å­—ç¬¦æ•°ï¼Œè€Œä¸æ˜¯ç”¨æ¥è¡¨ç¤ºè¿™äº›å­—ç¬¦çš„å­—èŠ‚æ•°ã€‚
ç›¸ä¼¼åœ°ï¼Œ@code{index()} æ˜¯è¿”å›å­—ç¬¦çš„ç´¢å¼•ï¼Œè€Œä¸æ˜¯å­—èŠ‚çš„ç´¢å¼•ã€‚

@quotation æ³¨æ„
æœ‰å¾ˆå¤šçš„å‡½æ•°ä¼šå¤„ç†å­—ä¸²çš„ç´¢å¼•ã€‚å¯¹äºè¿™æ­¤å‡½æ•°ï¼Œå­—ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•ä¸º 1ã€‚è¿™ä¸ªä¸ C ä»¥åŠå…¶æ´¾ç”Ÿçš„è¯­è¨€ä¸åŒï¼Œåœ¨è¿™äº›è¯­è¨€ä¸­ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•ä½ç½®ä¸º 0ã€‚ä½ éœ€è¦è®°ä½è¿™ä¸ªåŒºåˆ«ï¼Œä»¥æ­£ç¡®å¤„ç†ç´¢å¼•çš„è®¡ç®—ï¼Œå°¤å…¶æ˜¯ä½ å·²ç»ä¹ æƒ¯äº† C çš„æƒ…å†µã€‚
@end quotation

ä¸‹é¢çš„åˆ—è¡¨ä¸­ï¼Œå¯é€‰çš„å‚æ•°æ”¾åœ¨æ–¹æ‹¬å·ä¸­@w{ ([ ]).}ã€‚æœ‰å‡ ä¸ªå‡½æ•°ç”¨æ¥å¤„ç†å­—ä¸²æ›¿æ¢ï¼Œå®Œæ•´çš„è®¨è®ºä¼šåœ¨ @code{sub()} å‡½æ•°çš„è¯´æ˜ä¸­ç»™å‡ºï¼Œå¹¶ä¸”ä»¥æ­¤ä¸ºç»“æŸï¼Œå› ä¸ºåˆ—è¡¨æ˜¯æŒ‰å­—æ¯é¡ºåºæ’åºçš„ã€‚

é‚£äº›ç‰¹å®šäº @command{gawk} çš„å‡½æ•°ç”¨äº•å·å­—ç¬¦ï¼ˆ@samp{#}ï¼‰æ ‡è¯†ã€‚å®ƒä»¬åœ¨å…¼å®¹æ¨¡å¼ä¸­ä¸å¯ç”¨ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼š


@menu
* Gory Details::                More than you want to know about @samp{\} and
                                @samp{&} with @code{sub()}, @code{gsub()}, and
                                @code{gensub()}.
@end menu

@c @asis for docbook
@table @asis
@item @code{asort(}@var{source} [@code{,} @var{dest} [@code{,} @var{how} ] ]@code{) #}
@itemx @code{asorti(}@var{source} [@code{,} @var{dest} [@code{,} @var{how} ] ]@code{) #}
@cindexgawkfunc{asorti}
@cindex sort array
@cindex arrays, elements, retrieving number of
@cindexgawkfunc{asort}
@cindex sort array indices
è¿™ä¸¤ä¸ªå‡½æ•°çš„è¡Œä¸ºæ˜¯ç±»ä¼¼çš„ï¼Œå› æ­¤åœ¨ä¸€èµ·æè¿°ã€‚

@quotation æç¤º
ä¸‹é¢çš„æè¿°å¿½ç•¥äº†ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œ@var{how}ï¼Œå› ä¸ºéœ€è¦ç†è§£ç›®å‰æˆ‘ä»¬è¿˜æ²¡æœ‰è®¨è®ºåˆ°çš„ç‰¹æ€§ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œè®¨è®ºæœ‰æ„ç®€åŒ–äº†ã€‚ï¼ˆæˆ‘ä»¬åé¢ä¼šæä¾›æ‰€æœ‰çš„ç»†èŠ‚ï¼ŒæŸ¥çœ‹ @ref{Array Sorting Functions}ï¼Œæ¥è·å–æ‰€æœ‰çš„ä¿¡æ¯ã€‚ï¼‰
@end quotation

ä¸¤ä¸ªå‡½æ•°éƒ½è¿”å›æ•°ç»„ @var{source} ä¸­çš„å…ƒç´ çš„ä¸ªæ•°ã€‚å¯¹äº @command{asort()}ï¼Œ@command{gawk} å¯¹ @var{source} çš„å€¼è¿›è¡Œæ’åºï¼Œå¹¶æ›¿æ¢ç»è¿‡æ’åºçš„å€¼çš„ç´¢å¼•ä¸ºç”± 1 å¼€å§‹è¿ç»­æ•´æ•°ã€‚å¦‚æœå¯é€‰çš„æ•°ç»„ @var{dest} å­˜åœ¨ï¼Œåˆ™ @var{source} çš„å€¼ä¼šå¤åˆ¶åˆ° @var{dest} ä¸­ã€‚@var{dest} åˆ™ä¹Ÿæ˜¯ç»è¿‡æ’åºçš„ï¼Œè€Œ @var{source} çš„ç´¢å¼•åˆ™ä¿æŒä¸å˜ã€‚

@cindex @command{gawk}, @code{IGNORECASE} variable in
å½“è¿›è¡Œå­—ä¸²æ¯”è¾ƒæ—¶ï¼Œ@code{IGNORECASE} ä¼šå½±å“æ’åºï¼ˆæŸ¥çœ‹ @pxref{Array Sorting Functions}ï¼‰ã€‚
å¦‚æœ @var{source} æ•°ç»„åŒ…å«äº†å­æ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{Arrays of Arrays}ï¼‰ï¼Œå®ƒä»¬ä¼šåœ¨æ‰€æœ‰çš„æ ‡é‡å€¼çš„åé¢ã€‚
å­æ•°ç»„@emph{ä¸ä¼š}å†è¿›è¡Œé€’å½’æ’åºã€‚

ä¾‹å¦‚ï¼Œ@code{a} çš„å†…å®¹å¦‚ä¸‹ï¼š

@example
a["last"] = "de"
a["first"] = "sac"
a["middle"] = "cul"
@end example

@noindent
è°ƒç”¨ @code{asort()}:

@example
asort(a)
@end example

@noindent
@code{a} å†…å®¹çš„ç»“æœå¦‚ä¸‹ï¼š

@example
a[1] = "cul"
a[2] = "de"
a[3] = "sac"
@end example

@code{asorti()} å‡½æ•°ä¸ @code{asort()} ç±»å‹ï¼Œä½†æ˜¯åªå¯¹@emph{ç´¢å¼•}æ’åºï¼Œè€Œä¸æ˜¯é’ˆå¯¹å€¼è¿›è¡Œæ’åºã€‚
æ‰€ä»¥ï¼Œåœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œ@code{a} ç”¨åŒæ ·çš„ç´¢å¼•ä¸å€¼ï¼Œè°ƒç”¨ @samp{asorti(a)} åˆ™äº§ç”Ÿå¦‚ä¸‹ç»“æœï¼š

@example
a[1] = "first"
a[2] = "last"
a[3] = "middle"
@end example

@item @code{gensub(@var{regexp}, @var{replacement}, @var{how}} [@code{, @var{target}}]@code{) #}
@cindexgawkfunc{gensub}
@cindex search and replace in strings
@cindex substitute in string
æœç´¢åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ @var{regexp} çš„ç›®æ ‡å­—ä¸²ï¼Œå¦‚æœ @var{how} æ˜¯ä»¥ @samp{g} æˆ–è€… @samp{G} å¼€å¦‚çš„å­—ä¸²ï¼Œ
åˆ™ç”¨ @var{replacement} æ›¿æ¢æ‰€æœ‰åŒ¹é…çš„ @var{regexp}ã€‚
å¦åˆ™ @var{how} å°†ä¼šå½“é¢æˆä¸€ä¸ªæŒ‡ç¤ºå“ªä¸€ä¸ªè¦è¿›è¡Œæ›¿æ¢çš„æ•°å€¼ã€‚å¦‚æœæ²¡æœ‰æä¾› @var{target} å‚æ•°ï¼Œåˆ™ä½¿ç”¨ @code{$0} ã€‚
å‡½æ•°è¿”å›ç»è¿‡ä¿®æ”¹çš„å­—ä¸²ï¼ŒåŸå§‹çš„å­—ä¸²åˆ™@emph{ä¸ä¼š}å˜åŒ–ã€‚

@code{gensub()} æ˜¯ä¸€ä¸ªé€šç”¨çš„æ›¿æ¢å‡½æ•°ã€‚å®ƒçš„ç›®çš„æ˜¯æä¾›æ¯”æ ‡å‡†çš„ @code{sub()} ä¸ @code{gsub()} å‡½æ•°å¤šä¸€ä¸ªç‰¹æ€§ã€‚

@code{gensub()} æä¾›ä¸€ä¸ªé¢å¤–çš„ç‰¹æ€§æ˜¯ @code{sub()} ä¸ @code{gsub()} æ‰€æ²¡æœ‰çš„ï¼Œå³ï¼šåœ¨ @var{replacement} æ–‡æœ¬ä¸­ï¼ŒæŒ‡å®šä¸€ä¸ª @var{regexp} ç»„ä»¶çš„èƒ½åŠ›ã€‚è¿™ä¸ªé€šè¿‡åœ¨ @var{regexp} ä¸­ä½¿ç”¨æ‹¬å·æ¥æ ‡å¿—ç»„ä»¶ï¼Œç„¶åé€šè¿‡åœ¨ @var{replacement} ä¸­ç”¨ @samp{\@var{N}} æ¥æŒ‡å®šï¼Œè¿™é‡Œ @var{N} æ˜¯ä¸€ä¸ªä» 0 åˆ° 9 çš„æ•°å­—ã€‚å¦‚ï¼š

@example
$ @kbd{gawk '}
> @kbd{BEGIN @{}
>      @kbd{a = "abc def"}
>      @kbd{b = gensub(/(.+) (.+)/, "\\2 \\1", "g", a)}
>      @kbd{print b}
> @kbd{@}'}
@print{} def abc
@end example

@noindent
ç”¨ @code{sub()} å‡½æ•°ï¼Œä½ å¿…é¡»æŒ‡å®šä¸¤ä¸ªåæ–œæ æ¥åœ¨å­—ä¸²ä¸­åŒ…å«ä¸€ä¸ªã€‚åœ¨æ›¿æ¢æ–‡æœ¬ä¸­ï¼Œ@samp{\0} çš„åºåˆ—è¡¨ç¤ºæ•´ä¸ªåŒ¹é…çš„æ–‡æœ¬ï¼Œå¦‚å­—ç¬¦ @samp{&} æ‰€è¡¨ç¤ºçš„ä¸€æ ·ã€‚

ä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä½ å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰ä¸ªå‚æ•°æ¥æ§åˆ¶å“ªä¸ªåŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥è¢«æ›¿æ¢ï¼š

@example
$ @kbd{echo a b c a b c |}
> @kbd{gawk '@{ print gensub(/a/, "AA", 2) @}'}
@print{} a b c AA b c
@end example

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ@code{$0} æ˜¯é»˜è®¤çš„ @var{target} å­—ä¸²ã€‚@code{gensub()} è¿”å›æ–°çš„ä¸²ä½œä¸ºå®ƒçš„ç»“æœï¼Œè¿™ä¸ªç»“æœç›´æ¥ä¼ é€’ç»™ @code{print} ç”¨æ¥æ‰“å°ã€‚

@c @cindex automatic warnings
@c @cindex warnings, automatic
å¦‚æœ @var{how} è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªä¸ä»¥ @samp{g} æˆ–è€… @samp{G} å¼€å¤´çš„ä¸²ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå°äºç­‰äº 0 çš„æ•°å€¼ï¼Œåˆ™åªæœ‰ä¸€ä¸ªæ›¿æ¢ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœ @var{how} æ˜¯ 0ï¼Œ@command{gawk} ä¼šäº§ç”Ÿä¸€ä¸ªå‘Šè­¦ã€‚

å¦‚æœ @var{regexp} æ²¡æœ‰åŒ¹é… @var{target}ï¼Œåˆ™ @code{gensub()} çš„è¿”å›å€¼å°±æ˜¯åŸæ¥æœªç»æ›´æ”¹çš„ @var{target} çš„å€¼ã€‚

@item @code{gsub(@var{regexp}, @var{replacement}} [@code{, @var{target}}]@code{)}
@cindexawkfunc{gsub}
æœç´¢ @var{target} ä¸­@emph{æ‰€æœ‰çš„}æœ€å·¦æœ€é•¿çš„ï¼Œ@emph{æ— é‡å }çš„åŒ¹é…å­ä¸²ï¼Œå¹¶ä¸”ç”¨ @var{replacement} è¿›è¡Œæ›¿æ¢ã€‚
@code{gsub()} ä¸­çš„ @samp{g} è¡¨ç¤ºâ€œglobalâ€ï¼Œå…¶è¡¨ç¤ºæ›¿æ¢æ‰€æœ‰å‡ºç°çš„å­—ä¸²ã€‚ä¾‹å¦‚ï¼š

@example
@{ gsub(/Britain/, "United Kingdom"); print @}
@end example

@noindent
ä¼šç”¨ @samp{United Kingdom} æ›¿æ¢è¾“å…¥è®°å½•æ‰€æœ‰çš„ @samp{Britain} å­—ä¸²ã€‚

@code{gsub()} å‡½æ•°è¿”å›æ‰§è¡Œäº†æ›¿æ¢çš„ä¸ªæ•°ã€‚å¦‚æœè¦æœç´¢åŠå˜æ›´ï¼ˆ@var{target}ï¼‰çš„å˜é‡è¢«çœç•¥äº†ï¼Œå°±æ˜¯ä½¿ç”¨æ•´ä¸ªè¾“å…¥è®°å½• @code{$0} ã€‚å¦‚åœ¨ @code{sub()} ä¸­ï¼Œå­—ä¸² @samp{&} ä¸ @samp{\} æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œå¹¶ä¸”ç¬¬ä¸‰ä¸ªå‚æ•°å¿…é¡»æ˜¯å¯èµ‹å€¼çš„ã€‚

@item @code{index(@var{in}, @var{find})}
@cindexawkfunc{index}
@cindex search in string
@cindex find substring in string
åœ¨ @var{in} è¿™ä¸ªå­—ä¸²ä¸­æœç´¢ç¬¬ä¸€æ¬¡å‡ºç°çš„ @var{find} ä¸²ï¼Œå¹¶ä¸”è¿”å›åœ¨å­—ä¸² @var{in} ä¸­å‡ºç°çš„æœ€å¼€å§‹çš„ä½ç½®ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š

@example
$ @kbd{awk 'BEGIN @{ print index("peanut", "an") @}'}
@print{} 3
@end example

@noindent
å¦‚æœ @var{find} æ²¡æœ‰è¢«æ‰¾åˆ°ï¼Œ@code{index()} ä¼šè¿”å› 0ã€‚
If @var{find} is not found, @code{index()} returns zero.

@cindex dark corner, regexp as second argument to @code{index()}
å¯¹äº BWK @command{awk} ä¸ @command{gawk} ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡æ¥ä½œä¸º @var{find} å‚æ•°ä¼šæ˜¯ä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚å…¶ä»–çš„å®åˆ™å…è®¸ï¼Œä»–ä»¬ä»…æ˜¯ç®€å•åœ°å°†æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡å½“æˆä¸ @samp{$ 0 ~ /regexp/} ä¸€æ ·çš„è¡¨è¾¾å¼ã€‚

@item @code{length(}[@var{string}]@code{)}
@cindexawkfunc{length}
@cindex string length
@cindex length of string
è¿”å›å­—ä¸² @var{string} çš„å­—ç¬¦æ•°ã€‚å¦‚æœ @var{string} æ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªæ•°å€¼ä¸²çš„æ•°å­—ä½æ•°è¢«è¿”å›ã€‚
ä¾‹å¦‚ @code{length("abcde")} çš„å€¼ä¸º 5ã€‚æ¯”è¾ƒ @code{length(15 * 35)} å…¶å€¼åˆ™ä¸º 3ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ
@iftex
@math{15 @cdot 35 = 525},
@end iftex
@ifnottex
@ifnotdocbook
15 * 35 = 525,
@end ifnotdocbook
@end ifnottex
@docbook
15 &sdot; 35 = 525,
@end docbook
è€Œ 525 è½¬æ¢æˆå­—ä¸² @code{"525"}ï¼Œè¿™é‡Œé¢æœ‰ä¸‰ä¸ªå­—ç¬¦ã€‚

@cindex length of input record
@cindex input record, length of
å¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œ@code{length()} åˆ™è¿”å› @code{$0} çš„é•¿åº¦ã€‚

@c @cindex historical features
@cindex portability, @code{length()} function
@cindex POSIX @command{awk}, functions and, @code{length()}
@quotation æç¤º
åœ¨æ—§ç‰ˆæœ¬çš„ @command{awk} ä¸­ï¼Œ@code{length()} å‡½æ•°å¯ä»¥ä¸å¸¦æ‹¬å·è¿›è¡Œè°ƒç”¨ã€‚è¿™ä¹ˆåšè¢«è§†ä¸ºå¾ˆä¸å¥½çš„å®è·µï¼Œå°½ç®¡ 2008 ç‰ˆæœ¬çš„ POSIX æ ‡å‡†è¿˜æ˜¯æ˜¾å¼åœ°å…è®¸å®ƒï¼Œä½†é‚£ä¹Ÿæ˜¯ä¸ºäº†æ”¯æŒå†å²å®è·µã€‚ä¸ºäº†ç¨‹åºçš„æœ€å¤§å¯ç§»æ¤æ€§ï¼Œåœ¨è°ƒç”¨æ—¶æ€»æ˜¯ä½¿ç”¨æ‹¬å·ã€‚
@end quotation

@cindex dark corner, @code{length()} function
å¦‚æœè°ƒç”¨ @code{length()} æ—¶ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªè¿˜æ²¡æœ‰è¢«ä½¿ç”¨çš„å˜é‡ï¼Œ@command{gawk} ä¼šå¼ºåˆ¶å˜é‡ä¸ºä¸€ä¸ªæ ‡é‡ã€‚å…¶ä»–çš„ @command{awk} å®ç°ä¼šå°†å˜é‡ä¿ç•™ä¸ºä¸€ä¸ªæ— ç±»å‹çš„å˜é‡ã€‚
@value{DARKCORNER}
å¦‚ï¼š

@example
$ @kbd{gawk 'BEGIN @{ print length(x) ; x[1] = 1 @}'}
@print{} 0
@error{} gawk: fatal: attempt to use scalar `x' as array

$ @kbd{nawk 'BEGIN @{ print length(x) ; x[1] = 1 @}'}
@print{} 0
@end example

@noindent
å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šäº† @option{--lint} å‚æ•°ï¼Œ@command{gawk} ä¼šå¯¹è¿™ä½¿ç”¨äº§ç”Ÿä¸€ä¸ªå‘Šè­¦ã€‚

@cindex common extensions, @code{length()} applied to an array
@cindex extensions, common@comma{} @code{length()} applied to an array
@cindex differences between @command{gawk} and @command{awk}
@cindex number of array elements
@cindex array, number of elements
@command{gawk} ä¸å…¶ä»–çš„å‡ ä¸ª @command{awk} å®ç°ï¼Œå½“å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œ@code{length()} è¿”å›çš„æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚ @value{COMMONEXT}
åˆçœ‹èµ·æ¥ï¼Œè¿™æ²¡ä»€ä¹ˆä½œç”¨ï¼Œå› ä¸ºæ•°ç»„çš„ç´¢å¼•å¹¶ä¸ä¿è¯æ˜¯ä» 1 åˆ°æ•°ç»„ä¸­çš„å…ƒç´ æ•°ç›®ã€‚å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨äº† @option{--lint} é€‰é¡¹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ@command{gawk} ä¼šè­¦å‘Šè¯´ï¼Œä¼ é€’æ•°ç»„å‚æ•°å¹¶ä¸æ˜¯å¯ç§»æ¤çš„ã€‚å¦‚æœæŒ‡å®šäº† @option{--posix} é€‰é¡¹ï¼Œåˆ™ä½¿ç”¨æ•°ç»„ä½œä¸ºå‚æ•°ä¼šæ˜¯ä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼ˆæŸ¥çœ‹ @pxref{Arrays}ï¼‰ã€‚

@item @code{match(@var{string}, @var{regexp}} [@code{, @var{array}}]@code{)}
@cindexawkfunc{match}
@cindex string, regular expression match
@cindex match regexp in string
æœç´¢åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ @var{regexp} çš„æœ€é•¿æœ€å·¦è¾¹çš„å­ä¸²ï¼Œå¹¶è¿”å›å­ä¸²å¼€å§‹çš„å­—ç¬¦ä½ç½®ï¼ˆç´¢å¼•ï¼Œå¦‚æœå­ä¸²æ˜¯å­—ä¸² @var{string} çš„å¼€å§‹ï¼Œåˆ™è¿”å› 1 ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œåˆ™è¿”å› 0ã€‚

@var{regexp} å‚æ•°å³å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼ˆ@code{/}@dots{}@code{/}ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå­—ä¸²å¸¸é‡ï¼ˆ@code{"}@dots{}@code{"}ï¼‰ã€‚
å¦‚æœæ˜¯åè€…ï¼Œå­—ä¸²è¢«å½“æˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼ç”¨æ¥è¿›è¡ŒåŒ¹é…ã€‚æŸ¥çœ‹ @ref{Computed Regexps}ï¼Œå¯ä»¥äº†è§£åˆ°ä¸¤ç§æ–¹å¼ä¹‹é—´ä¸åŒçš„è®¨è®ºï¼Œä»¥åŠå¦‚ä½•æ¥å†™å‡ºæ­£ç¡®çš„ç¨‹åºçš„ä¸€äº›æç¤ºã€‚

ä¸¤ä¸ªå‚æ•°çš„é¡ºåºï¼Œä¸å¤§å¤šæ•°çš„å…¶ä»–ç”¨æ­£åˆ™è¡¨è¾¾å¼å¤„ç†å­—ä¸²å‡½æ•°çš„ç›¸åï¼Œæ¯”å¦‚ @code{sub()} ï¼Œ@code{gsub()}ã€‚
è®°ä½ @code{match()} å‡½æ•°çš„å‚æ•°é¡ºåºä¸ @samp{~} æ“ä½œç¬¦æ˜¯ä¸€æ ·çš„ï¼š@samp{@var{string} ~ @var{regexp}}

@cindex @code{RSTART} variable, @code{match()} function and
@cindex @code{RLENGTH} variable, @code{match()} function and
@cindex @code{match()} function, @code{RSTART}/@code{RLENGTH} variables
@code{match()} å‡½æ•°ä¼šè®¾ç½®é¢„å®šä¹‰çš„å˜é‡ @code{RSTART} ä¸ºç´¢å¼•ï¼ŒåŒæ—¶ä¹Ÿè®¾ç½®é¢„å®šä¹‰çš„å˜é‡ @code{RLENGTH} ä¸ºåŒ¹é…å­ä¸²çš„é•¿åº¦ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œ@code{RSTART} çš„å€¼è¢«è®¾ç½®æˆ 0ï¼Œè€Œ @code{RLENGTH} çš„å€¼ä¸º @minus{}1ã€‚

å¦‚ï¼š

@example
@c file eg/misc/findpat.awk
@{
    if ($1 == "FIND")
        regex = $2
    else @{
        where = match($0, regex)
        if (where != 0)
            print "Match of", regex, "found at", where, "in", $0
       @}
@}
@c endfile
@end example

@noindent
è¿™ä¸ªç¨‹åºæŸ¥æ‰¾é‚£äº›åŒ¹é…å­˜å‚¨åœ¨å˜é‡ @code{regex} ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼çš„è¡Œã€‚
è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥è¢«æ›´æ”¹ã€‚å¦‚æœè¡Œä¸­çš„ç¬¬ä¸€ä¸ªå•è¯æ˜¯ @samp{FIND} ï¼Œåˆ™ @code{regex} ä¼šè¢«æ”¹æˆé‚£ä¸€è¡Œçš„ç¬¬äºŒä¸ªå•è¯ã€‚
æ‰€ä»¥ï¼Œå‡å¦‚æœ‰ä¸‹é¢çš„æ•°æ®ï¼š

@example
@c file eg/misc/findpat.data
FIND ru+n
My program runs
but not very quickly
FIND Melvin
JF+KM
This line is property of Reality Engineering Co.
Melvin was here.
@c endfile
@end example

@noindent
åˆ™ @command{awk} ä¼šæ‰“å°ï¼š

@example
Match of ru+n found at 12 in My program runs
Match of Melvin found at 1 in Melvin was here.
@end example

@cindex differences in @command{awk} and @command{gawk}, @code{match()} function
å¦‚æœæä¾›äº† @var{array} å‚æ•°ï¼Œå®ƒé¦–å…ˆä¼šè¢«æ¸…é™¤ï¼Œç„¶åæ•°ç»„ @var{array} çš„ç¬¬ 0 ä¸ªå…ƒç´ ä¼šè¢«è®¾ç½®ä¸ºåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ @var{regexp} çš„æ•´ä¸ªå­—ä¸² @var{string}ã€‚
å¦‚æœ @var{regexp} åŒ…å«äº†æ‹¬å·ï¼Œæ•°ç»„ @var{array} çš„æ•´æ•°ç´¢å¼•å…ƒç´ ä¼šè¢«è®¾ç½®æˆåŒ¹é…ç›¸åº”åŒ¹é…æ‹¬å·å­è¡¨è¾¾å¼çš„å­—ä¸² @var{string} çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{echo foooobazbarrrrr |}
> @kbd{gawk '@{ match($0, /(fo+).+(bar*)/, arr)}
>         @kbd{print arr[1], arr[2] @}'}
@print{} foooo barrrrr
@end example

å¦å¤–ï¼Œå¤šç»´ä¸‹æ ‡ä¹Ÿå¯ç”¨æ¥æä¾› start ç´¢å¼•ä¸æ¯ä¸ªåŒ¹é…å­è¡¨è¾¾å¼çš„é•¿åº¦ length ç´¢å¼•ï¼š

@example
$ @kbd{echo foooobazbarrrrr |}
> @kbd{gawk '@{ match($0, /(fo+).+(bar*)/, arr)}
>           @kbd{print arr[1], arr[2]}
>           @kbd{print arr[1, "start"], arr[1, "length"]}
>           @kbd{print arr[2, "start"], arr[2, "length"]}
> @kbd{@}'}
@print{} foooo barrrrr
@print{} 1 5
@print{} 9 7
@end example

æœ‰å¯èƒ½æ²¡æœ‰ä¸ºæ¯ä¸€ä¸ªæ‹¬å·å­è¡¨è¾¾å¼æä¾› start ä»¥åŠ index çš„ä¸‹æ ‡ï¼Œå› ä¸ºæœ‰å¯èƒ½å¹¶ä¸æ˜¯æ‰€æœ‰éƒ½åŒ¹é…ï¼›
æ‰€ä»¥ï¼Œå®ƒä»¬åº”è¯¥ç”¨ @code{in} æ“ä½œç¬¦æ¥è¿›è¡Œæµ‹è¯•ï¼ˆæŸ¥çœ‹ @ref{Reference to Elements}ï¼‰ã€‚

@cindex troubleshooting, @code{match()} function
@code{match()} çš„ @var{array} å‚æ•°æ˜¯ @command{gawk} æ‰©å±•ã€‚åœ¨å…¼å®¹æ¨¡å¼ä¸­ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œä½¿ç”¨ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè‡´ä½¿é”™è¯¯ã€‚

@item @code{patsplit(@var{string}, @var{array}} [@code{, @var{fieldpat}} [@code{, @var{seps}} ] ]@code{) #}
@cindexgawkfunc{patsplit}
@cindex split string into array
å°† @var{string} ç”¨ @var{fieldpat} å®šä¹‰çš„åˆ†éš”ç¬¦åˆ†å‰²æˆç‰‡ï¼Œå¹¶å­˜å‚¨åœ¨ @var{array} ä¸­ï¼Œ
å¹¶å°†å­—ä¸²ä¸­åˆ†éš”ç¬¦å­˜å‚¨åœ¨ @var{seps} æ•°ç»„ä¸­ã€‚
ç¬¬ä¸€å—ç‰‡å­˜å‚¨åœ¨ @code{@var{array}[1]} ä¸­ï¼Œç¬¬äºŒç‰‡å­˜å‚¨åœ¨ @code{@var{array}[2]} ä¸­ï¼Œä¾æ­¤ç±»æ¨ã€‚
ç¬¬ä¸‰ä¸ªå‚æ•° @var{fieldpat} æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æè¿°åœ¨ @var{string} ä¸­çš„åŸŸï¼ˆå°±å¥½åƒ @code{FPAT} æ˜¯ä¸€ä¸ªæè¿°è¾“å…¥è®°å½•åŸŸçš„æ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚å®ƒå³å¯ä»¥æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå­—ä¸²ã€‚
å¦‚æœçœç•¥äº† @var{fieldpat}ï¼Œåˆ™ä¼šä½¿ç”¨ @code{FPAT} çš„å€¼ã€‚
@code{patsplit()} è¿”å›åˆ›å»ºå…ƒç´ çš„ä¸ªæ•°ã€‚@code{@var{seps}[@var{i}]} æ˜¯åœ¨ @code{@var{array}[@var{i}]} ä¸ @code{@var{array}[@var{i}+1]} ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚æ‰€æœ‰å‰å¯¼çš„åˆ†éš”ç¬¦éƒ½å­˜å‚¨åœ¨ @code{@var{seps}[0]} ä¸­ã€‚

@code{patsplit()} å‡½æ•°å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸ºç‰‡ï¼Œå…¶æ–¹å¼æ˜¯ä¸ç”¨ @code{FPAT} å°†è¾“å…¥è¡Œåˆ†å‰²æˆåŸŸçš„æ–¹å¼ç›¸ä¼¼ï¼ˆæŸ¥çœ‹ @pxref{Splitting By Content}ï¼‰ã€‚

åœ¨åˆ†å‰²å­—ç¬¦ä¸²ä¹‹å‰ï¼Œ@code{patsplit()} ä¼šåˆ é™¤åœ¨ @var{array} ä¸ @var{seps} ä¸­å·²ç»å­˜åœ¨çš„å…ƒç´ ã€‚

@item @code{split(@var{string}, @var{array}} [@code{, @var{fieldsep}} [@code{, @var{seps}} ] ]@code{)}
@cindexawkfunc{split}
å°† @var{string} ç”¨ @var{fieldsep} å®šä¹‰çš„åˆ†éš”ç¬¦åˆ†å‰²æˆç‰‡ï¼Œå¹¶å­˜å‚¨åœ¨ @var{array} ä¸­ï¼Œå¹¶å°†å­—ä¸²ä¸­åˆ†éš”ç¬¦å­˜å‚¨åœ¨ @var{seps} ä¸­ã€‚
ç¬¬ä¸€å—ç‰‡å­˜å‚¨åœ¨ @code{@var{array}[1]} ä¸­ï¼Œç¬¬äºŒç‰‡å­˜å‚¨åœ¨ @code{@var{array}[1]} ä¸­ï¼Œä¾æ­¤ç±»æ¨ã€‚
ç¬¬ä¸‰ä¸ªå‚æ•° @var{fieldsep} çš„å­—ä¸²å€¼æ˜¯ä¸€ä¸ªç”¨æ¥æè¿°åœ¨ä½•ç‰‡åˆ†å‰² @var{string} çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ­£å¦‚ @code{FS} å¯ä»¥ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ¥æè¿°åœ¨ä½•å¤„æ¥åˆ†å‰²è¾“å…¥è®°å½•ä¸€æ ·ï¼‰ã€‚
å¦‚æœ @var{fieldsep} è¢«çœç•¥äº†ï¼Œåˆ™ä½¿ç”¨ @code{FS} çš„å€¼ã€‚@code{split()} è¿”å›è¢«åˆ›å»ºçš„å…ƒç´ ä¸ªæ•°ã€‚@var{seps} æ˜¯ @command{gawk} æ‰©å±•ï¼Œ@code{@var{seps}[@var{i}]} æ˜¯åœ¨ @code{@var{array}[@var{i}]} ä¸ @code{@var{array}[@var{i}+1]} ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚
å¦‚æœ @var{fieldsep} æ˜¯ä¸€ä¸ªç©ºæ ¼ï¼Œåˆ™å‰å¯¼çš„ç©ºæ ¼ä¼šå…¨éƒ¨å­˜å‚¨ @code{@var{seps}[0]} ä¸­ï¼Œè€Œåç¼€çš„ç©ºæ ¼ä¼šå­˜å‚¨åœ¨ @code{@var{seps}[@var{n}]} ä¸­ï¼Œ
å…¶ä¸­ @var{n} æ˜¯ @code{split()} è¿”å›çš„å€¼ï¼ˆå³ @var{array} æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼‰ã€‚

@code{split()} å‡½æ•°å°†å­—ä¸²åˆ†å‰²æˆç‰‡çš„æ–¹å¼ä¸å°†è¾“å…¥è¡Œåˆ†å‰²æˆåŸŸçš„æ–¹å¼ç±»ä¼¼ã€‚æ¯”å¦‚ï¼š

@example
split("cul-de-sac", a, "-", seps)
@end example

@noindent
@cindex strings splitting, example
å°†å­—ä¸² @code{"cul-de-sac"} ç”¨ @samp{-} åˆ†å‰²æˆä¸‰ä¸ªåŸŸã€‚å®ƒå°†æ•°ç»„ @code{a} çš„å†…å®¹è®¾ç½®æˆå¦‚ä¸‹ï¼š

@example
a[1] = "cul"
a[2] = "de"
a[3] = "sac"
@end example

åŒæ—¶è®¾ç½®æ•°ç»„ @code{seps} çš„å€¼ä¸ºï¼š

@example
seps[1] = "-"
seps[2] = "-"
@end example

@noindent
è°ƒç”¨ @code{split()} çš„è¿”å›å€¼ä¸º 3ã€‚

@cindex differences in @command{awk} and @command{gawk}, @code{split()} function
éšç€è¾“å…¥çš„åŸŸåˆ†å‰²ï¼Œå½“ @var{fieldsep} çš„å€¼ä¸º @w{@code{" "}} æ—¶ï¼Œ
å‰ç¼€å’Œåç¼€çš„ç©ºæ ¼éƒ½ä¼šåœ¨èµ‹å€¼ç»™æ•°ç»„ @var{array} ä¸­çš„å…ƒç´ çš„æ—¶å€™è¢«å¿½ç•¥ï¼Œä½†æ˜¯åœ¨ @var{seps} ä¸­ä¸ä¼šè¢«å¿½ç•¥ï¼Œ@var{array} æ•°ç»„å…ƒç´ æ˜¯youè¿ç»­çš„ç©ºæ ¼åˆ†å‰²ã€‚
åŒæ—¶ï¼Œéšç€è¾“å…¥è®°å½•çš„åˆ†å‰²ï¼Œå¦‚æœ @var{fieldsep} æ˜¯ä¸€ä¸ªç©ºä¸²ï¼Œåœ¨å­—ä¸²ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦éƒ½å°†åˆ†å‰²åˆ°æ•°ç»„çš„å…ƒç´ ä¸­ã€‚@value{COMMONEXT}

ä½†æ˜¯è¦æ³¨æ„ï¼Œ@code{RS} çš„å€¼å¯¹ @code{split()} å‡½æ•°çš„å·¥ä½œæ²¡æœ‰å½±å“ã€‚å°±ç®—æ˜¯ @samp{RS = ""} ä¼šå¯¼è‡´æ¢è¡Œç¬¦æˆä¸ºåŸŸåˆ†å‰²ç¬¦ï¼Œè¿™ä¹Ÿä¸ä¼šå½±å“ @code{split()} åˆ†å‰²å­—ä¸²çš„æ–¹å¼ã€‚

@cindex dark corner, @code{split()} function
ç°ä»£çš„ @command{awk} å®ç°ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ @command{gawk}ï¼Œå…è®¸ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼ˆ@w{@code{/}@dots{}@code{/}}ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å­—ä¸²ã€‚
POSIX æ ‡å‡†å…è®¸è¿™æ ·çš„å‚æ•°ã€‚æŸ¥çœ‹ @ref{Computed Regexps}ï¼Œå¯äº†è§£ä½¿ç”¨å­—ä¸²å¸¸é‡ä¸æ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´çš„å¸¸é‡ï¼Œå¹¶è·å–ä¸€äº›å¦‚ä½•æ­£ç¡®åœ°å†™ç¨‹åºçš„æç¤ºã€‚

åœ¨åˆ†å‰²å­—ç¬¦ä¸²å‰ï¼Œ@code{split()} ä¼šåˆ é™¤åœ¨æ•°ç»„ @var{array} ä¸ @var{seps} ä¸­å·²ç»å­˜åœ¨çš„å…ƒç´ ã€‚

å¦‚æœ @var{string} ä¸ºç©ºï¼Œåˆ™æ•°ç»„å°±ä¸ä¼šæœ‰å…ƒç´ ã€‚ï¼ˆæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¯ç§»æ¤çš„ä»¥ä¸€ä¸ªè¯­å¥æ¥åˆ é™¤æ•´ä¸ªæ•°ç»„çš„æ–¹æ³•ã€‚æŸ¥çœ‹ @ref{Delete}ã€‚ï¼‰

å¦‚æœ @var{string} æ²¡æœ‰åŒ¹é… @var{fieldsep}ï¼ˆä½†ä¸æ˜¯ç©ºï¼‰ï¼Œåˆ™ @var{array} åªä¼šæœ‰ä¸€ä¸ªå…ƒç´ ã€‚å…ƒç´ çš„å€¼å°±æ˜¯åŸæ¥çš„å­—ä¸² @var{string}ã€‚

åœ¨ POSIX æ¨¡å¼ä¸‹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯ä¸å…è®¸çš„ã€‚

@item @code{sprintf(@var{format}, @var{expression1}, @dots{})}
@cindexawkfunc{sprintf}
@cindex formatting strings
è¿”å› @code{printf} é‡‡ç”¨ç›¸åŒçš„å‚æ•°æ—¶çš„è¾“å‡ºï¼ˆä½†æ˜¯ä¸è¾“å‡ºï¼‰çš„å­—ä¸²ã€‚ï¼ˆæŸ¥çœ‹ @pxref{Printf}ï¼‰ã€‚ä¾‹å¦‚ï¼š

@example
pival = sprintf("pi = %.2f (approx.)", 22/7)
@end example

@noindent
å°†å­—ä¸² @w{@samp{pi = 3.14 (approx.)}} èµ‹å€¼ç»™å˜é‡ @code{pival}ã€‚

@cindexgawkfunc{strtonum}
@cindex convert string to number
@item @code{strtonum(@var{str}) #}
æ£€æŸ¥ @var{str} å¹¶è¿”å›å®ƒçš„æ•°å€¼å€¼ã€‚å¦‚æœ @var{str} ä»¥ @samp{0} å¼€å¤´ï¼Œåˆ™ @code{strtonum()} ä¼šå‡è®¾ @var{str} æ˜¯ä¸€ä¸ªå…«è¿›åˆ¶æ•°ã€‚
å¦‚æœ @var{str} æ˜¯ä»¥ @samp{0x} å¼€å¤´ï¼Œæˆ–è€… @samp{0X} å¼€å¤´ï¼Œ@code{strtonum()} ä¼šå‡è®¾ @var{str} æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶æ•°ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{echo 0x11 |}
> @kbd{gawk '@{ printf "%d\n", strtonum($1) @}'}
@print{} 17
@end example

ä½¿ç”¨ @code{strtonum()} å‡½æ•°ä¸ç»™å­—ä¸²æ·»åŠ ä¸€ä¸ªé›¶ä¸åŒï¼Œè‡ªåŠ¨å¼ºåˆ¶æ€§åœ°å°†å­—ä¸²è½¬æ¢ä¸ºæ•°å€¼åªä¼šåœ¨åè¿›åˆ¶æ•°ä¸‹æœ‰æ•ˆï¼Œå¯¹äºå…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶éƒ½æ˜¯æ— æ•ˆçš„ã€‚ 
@footnote{é™¤éä½ ä½¿ç”¨äº† @option{--non-decimal-data} é€‰é¡¹ï¼Œä½†æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆä½¿ç”¨ã€‚æŸ¥çœ‹ @ref{Nondecimal Data}ï¼Œå–å¾—æ›´å¤šçš„ä¿¡æ¯ã€‚}

åŒæ—¶ä¹Ÿè¦æ³¨æ„ @code{strtonum()} ä¼šä½¿ç”¨å½“å‰çš„æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­çš„ç”¨äºè¯†åˆ«æ•°å€¼çš„åè¿›åˆ¶ä½ï¼ˆæŸ¥çœ‹ @pxref{Locales}ï¼‰ã€‚

@item @code{sub(@var{regexp}, @var{replacement}} [@code{, @var{target}}]@code{)}
@cindexawkfunc{sub}
@cindex replace in string
åœ¨è¢«å½“æˆå­—ä¸²çš„ @var{target} ä¸­æœç´¢åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ @var{regexp} çš„æœ€å·¦æœ€é•¿çš„åŒ¹é…å­ä¸²ã€‚å¹¶ç”¨ @var{replacement} æ¥è§„åˆ™åŒ¹é…çš„å­ä¸²ã€‚
è¢«ä¿®æ”¹è¿‡çš„å­—ä¸²æˆä¸º @var{target} çš„æ–°å€¼ã€‚è¿”å›æ›¿æ¢çš„æ¬¡æ•°ï¼ˆ0 æˆ–è€… 1ï¼‰ã€‚

@var{regexp} å‚æ•°å³å¯ä»¥æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼ˆ@code{/}@dots{}@code{/}ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå­—ä¸²å¸¸é‡ï¼ˆ@code{"}@dots{}@code{"}ï¼‰ã€‚å¯¹äºåè€…ï¼Œå­—ä¸²ä¼šè¢«å½“é¢æˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡ŒåŒ¹é…ã€‚æŸ¥çœ‹ @ref{Computed Regexps}ï¼Œä»¥äº†è§£è¿™ä¸¤ç§å½¢å¼ä¹‹é—´çš„å·®å¼‚ï¼Œä»¥åŠäº†è§£ä¸€äº›å¦‚ä½•æ­£ç¡®åœ°å†™è¿™æ ·çš„ç¨‹åºçš„æç¤ºã€‚

è¿™ä¸ªå‡½æ•°éå¸¸ç‰¹åˆ«ï¼Œæ˜¯å› ä¸º @var{target} å¹¶ä¸æ˜¯ç®€å•åœ°ä½¿ç”¨æ¥è¿›è¡Œè®¡ç®—å‡ºä¸€ä¸ªå€¼ï¼Œä¹Ÿä¸åƒå…¶ä»–çš„è¡¨è¾¾å¼ä¸€æ ·â€”â€”å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªå˜é‡ï¼ŒåŸŸæˆ–è€…ä¸€ä¸ªæ•°ç»„å…ƒç´ ï¼Œå› æ­¤ @code{sub()} å¯ä»¥å°†ä¿®æ”¹çš„å€¼å­˜åœ¨é‚£ä¸ªåœ°æ–¹ã€‚å¦‚æœè¿™ä¸ªå‚æ•°è¢«çœç•¥äº†ï¼Œåˆ™é»˜è®¤çš„å€¼ä¼šä½¿ç”¨ @code{$0}ã€‚
@footnote{æ³¨æ„è¿™æ„å‘³ç€é‚£æ¡è®°å½•é¦–å…ˆä¼šä½¿ç”¨ @code{OFS} æ¥é‡æ–°ç”Ÿæˆï¼Œå› ä¸ºæœ‰åŸŸå·²ç»è¢«æ”¹å˜äº†ï¼Œå¹¶ä¸”åœ¨æ›¿æ¢ä¹‹åï¼ŒåŸŸä¼šæ›´æ–°ï¼Œå°±ç®—æ“ä½œæ˜¯ä¸€ä¸ªâ€œno-opâ€ï¼Œä¾‹å¦‚ @samp{sub(/^/, "")}ã€‚}
ä¾‹å¦‚ï¼š

@example
str = "water, water, everywhere"
sub(/at/, "ith", str)
@end example

@noindent
é€šè¿‡å°†å‡ºç° @samp{at} çš„åœ°æ–¹æ›¿æ¢æˆ @samp{ith} æ¥å°† @code{str} è®¾ç½®æˆ @w{@samp{wither, water, everywhere}}ã€‚

å¦‚æœç‰¹æ®Šå­—ç¬¦ @samp{&} å‡ºç°åœ¨ @var{replacement} ä¸­ï¼Œå®ƒå°±è¡¨ç¤ºåŒ¹é… @var{regexp} çš„ç²¾ç¡®å­ä¸²ã€‚ï¼ˆå¦‚æœ @var{regexp} å¯ä»¥åŒ¹é… 1 åˆ°å¤šä¸ªä¸²ï¼Œåˆ™ç²¾ç¡®çš„åŒ¹é…ä¸²å¯èƒ½ä¸åŒã€‚ï¼‰ä¾‹å¦‚ï¼š

@example
@{ sub(/candidate/, "& and his wife"); print @}
@end example

@noindent
ä¼šå°†è¾“å…¥çš„è¡Œä¸­å‡ºç°çš„ç¬¬ä¸€ä¸ª @samp{candidate} æ›¿æ¢æˆ @samp{candidate and his wife} ã€‚ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š

@example
$ @kbd{awk 'BEGIN @{}
>         @kbd{str = "daabaaa"}
>         @kbd{sub(/a+/, "C&C", str)}
>         @kbd{print str}
> @kbd{@}'}
@print{} dCaaCbaaa
@end example

@noindent
è¿™é‡Œæ˜¾ç¤ºäº† @samp{&} å¯ä»¥è¡¨ç¤ºä¸€ä¸ªéå¸¸é‡çš„å­—ä¸²ï¼Œä¹Ÿè¯´æ˜äº†æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æœ€å·¦æœ€é•¿è§„åˆ™çš„å«ä¹‰ï¼ˆæŸ¥çœ‹ @pxref{Leftmost Longest}ï¼‰ã€‚

è¿™ä¸ªç‰¹æ®Šå­—ç¬¦ @samp{&} çš„æ•ˆæœå¯ä»¥è¢«å…³é—­ï¼Œåªéœ€è¦åœ¨å­—ä¸²ä¸­è¿™ä¸ªå­—ç¬¦å‰åŠ ä¸€ä¸ªåæ–œæ å³å¯ã€‚é€šå¸¸ï¼Œä¸ºäº†æ’å…¥ä¸€ä¸ªåæ–œæ åˆ°å­—ä¸²ä¸­ï¼Œä½ å¿…é¡»å†™ä¸¤ä¸ªåæ–œæ ã€‚å› æ­¤åœ¨å­—ä¸²å¸¸é‡ä¸­è¦å†™ @samp{\\&} æ¥åœ¨æ›¿æ¢æ–‡æœ¬ä¸­ç”Ÿæˆä¸€ä¸ªå­—é¢çš„ @samp{&} å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•æ¥è¡Œä¸­å°†ç¬¬ä¸€ä¸ª @samp{|} æ›¿æ¢æˆ @samp{&} ï¼š

@example
@{ sub(/\|/, "\\&"); print @}
@end example

@cindex @code{sub()} function, arguments of
@cindex @code{gsub()} function, arguments of
å¦‚ä¸Šé¢æ‰€æåˆ°çš„ï¼Œ@code{sub()} çš„ç¬¬ä¸‰ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå˜é‡ï¼ŒåŸŸæˆ–è€…æ•°ç»„å…ƒç´ ã€‚æŸäº›ç‰ˆæœ¬çš„ @command{awk} å…è®¸ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ä¸æ˜¯ä¸ªå·¦ä¼ ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ@code{sub()} ä¾ç„¶ä¼šæœç´¢æ¨¡å¼å¹¶è¿”å› 0 æˆ–è€… 1ï¼Œä½†æ˜¯æ›¿æ¢çš„ç»“æœä¼šè¢«ä¸¢å¼ƒï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œè€Œä¸ä¼šå‘ç”Ÿæ›¿æ¢ã€‚è¿™ç§ç‰ˆæœ¬çš„ @command{awk} æ¥å—ä¸‹é¢è¿™æ ·çš„è¡¨è¾¾å¼ï¼š

@example
sub(/USA/, "United States", "the USA and Canada")
@end example

@noindent
@cindex troubleshooting, @code{gsub()}/@code{sub()} functions
ä¸ºäº†å†å²çš„å…¼å®¹ï¼Œ@command{gawk} ä¼šæˆå—è¿™æ ·çš„é”™è¯¯ä»£ç ã€‚ä½†æ˜¯ä½¿ç”¨ä»»ä½•ä¸å¯æ›´æ”¹çš„å¯¹è±¡ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¼šå¯¼è‡´è‡´å‘½é”™è¯¯ï¼Œä½ çš„ç¨‹åºä¹Ÿæ²¡åŠæ³•æ‰§è¡Œä¸‹å»ã€‚

æœ€åï¼Œå¦‚æœ @var{regexp} ä¸æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¸¸é‡ï¼Œåˆ™å®ƒä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªå­—ä¸²ï¼Œç„¶åå®ƒçš„å€¼ä¼šè¢«å½“æˆæ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡ŒåŒ¹é…ã€‚

@item @code{substr(@var{string}, @var{start}} [@code{, @var{length}} ]@code{)}
@cindexawkfunc{substr}
@cindex substring
è¿”å›å­—ä¸­ @var{string} çš„ä» @var{start} å¼€å§‹çš„ï¼Œ@var{length} å­—ç¬¦é•¿åº¦çš„å­ä¸²ã€‚å­—ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç¼–å·ä¸º 1ã€‚
@footnote{è¿™é‡Œä¸åŒ C å’Œ C++ï¼Œåœ¨ C å’Œ C++ ä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯æ•°å­— 0ã€‚}
ä¾‹å¦‚ @code{substr("washington", 5, 3)} è¿”å› @code{"ing"}ã€‚

å¦‚æœæ²¡æœ‰æä¾› @var{length} å‚æ•°ï¼Œ@code{substr()} åˆ™è¿”å› @var{string} ä» @var{start} å­—ç¬¦æ•°å¼€å§‹çš„å…¨éƒ¨åé¢çš„å­—ä¸²ã€‚
ä¾‹å¦‚ï¼Œ@code{substr("washington", 5)} è¿”å› @code{"ington"}ã€‚
å¦‚æœ @var{length} å¤§äº @var{string} åé¢å‰©ä¸‹çš„å­—ç¬¦æ•°ï¼Œåˆ™ä¹Ÿä¼šè¿”å›æ•´ä¸ªåç¼€çš„å­—ä¸²ï¼Œè¿™å…¶ä¸­åŒ…æ‹¬ @var{start} å¤„çš„å­—ç¬¦ã€‚

@cindex Brian Kernighan's @command{awk}
å¦‚æœ @var{start} çš„å€¼å°äº 1ï¼Œ@code{substr()} ä¼šå°†å…¶å½“ä¸º 1ã€‚
ï¼ˆPOSIX æ²¡æœ‰æŒ‡å®šè¿™ç§æƒ…å†µä¸‹å¦‚ä½•å¤„ç†ï¼šBWK @command{awk} ä¼šå¦‚ä¸Šè¿™ä¹ˆå¤„ç†ï¼Œ@command{gawk} ä¹Ÿè¿™ä¹ˆå¤„ç†ã€‚ï¼‰
å¦‚æœ @var{start} å¤§äº @var{string} ä¸­çš„å­—ç¬¦æ•°ï¼Œ@code{substr()} è¿”å›ç©ºä¸²ã€‚ç›¸ä¼¼çš„ï¼Œå¦‚æœ @var{length} æä¾›äº†ï¼Œä½†æ˜¯å°äºç­‰äº 0ï¼Œä¹Ÿè¿”å›ç©ºä¸²ã€‚

@cindex troubleshooting, @code{substr()} function
ç”± @code{substr()} è¿”å›çš„ä¸²@emph{ä¸å¯ä»¥}è¢«èµ‹å€¼ã€‚æ‰€ä»¥ï¼Œè¯•å›¾æ”¹å˜ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ä¸­æ‰€ç¤ºçš„ï¼š

@example
string = "abcdef"
# try to get "abCDEf", won't work
substr(string, 3, 3) = "CDE"
@end example

@noindent
å°† @code{substr()} çš„è¿”å›ä½œä¸º @code{sub()} æˆ–è€… @code{gsub()} çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¹Ÿæ˜¯é”™è¯¯çš„ï¼š

@example
gsub(/xyz/, "pdq", substr($0, 5, 20))  # WRONG
@end example

@cindex portability, @code{substr()} function
ï¼ˆæœ‰ä¸€äº›å•†ä¸šç‰ˆæœ¬çš„ @command{awk} ä¼šæŠŠ @code{substr()} çš„è¿”å›ä½œä¸ºå¯èµ‹å€¼çš„ï¼Œä½†æ˜¯è¿™ä¹ˆåšæ˜¯ä¸å¯ç§»æ¤çš„ã€‚ï¼‰

å¦‚æœä½ æƒ³æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œå°† @code{substr()} ä¸å­—ä¸²è¿æ¥ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚ä¸‹é¢çš„æ–¹å¼ï¼š

@example
string = "abcdef"
@dots{}
string = substr(string, 1, 2) "CDE" substr(string, 6)
@end example

@cindex case sensitivity, converting case
@cindex strings, converting letter case
@item @code{tolower(@var{string})}
@cindexawkfunc{tolower}
@cindex convert string to lower case
è¿”å› @var{string} çš„å¤æœ¬ï¼Œä½†æ˜¯å°†æ‰€æœ‰çš„å¤§å†™å­—æ¯ç”¨å®ƒå¯¹åº”çš„å°å†™å­—æ¯è¿›è¡Œæ›¿æ¢ã€‚éå­—æ¯å­—ç¬¦åˆ™ä¸å˜åŒ–ã€‚ä¾‹å¦‚ @code{tolower("MiXeD cAsE 123")} è¿”å› @code{"mixed case 123"}ã€‚

@item @code{toupper(@var{string})}
@cindexawkfunc{toupper}
@cindex convert string to upper case
è¿”å› @var{string} çš„å¤æœ¬ï¼Œä½†æ˜¯å°†æ‰€æœ‰çš„å°å†™å­—æ¯ç”¨å®ƒå¯¹åº”çš„å¤§å†™å­—æ¯è¿›è¡Œæ›¿æ¢ã€‚éå­—æ¯å­—ç¬¦åˆ™ä¸å˜åŒ–ã€‚ä¾‹å¦‚ @code{toupper("MiXeD cAsE 123")} è¿”å› @code{"MIXED CASE 123"}ã€‚
@end table

@sidebar åŒ¹é…ç©ºä¸²
@cindex matching, null strings
@cindex null strings, matching
@cindex @code{*} (asterisk), @code{*} operator, null strings@comma{} matching
@cindex asterisk (@code{*}), @code{*} operator, null strings@comma{} matching

åœ¨ @command{awk} ä¸­ï¼Œ@samp{*} æ“ä½œç¬¦å¯ä»¥åŒ¹é…ç©ºä¸²ã€‚è¿™å¯¹äº @code{sub()}ï¼Œ@code{gsub()} ä¸ @code{gensub()} å‡½æ•°å°¤å…¶é‡è¦ã€‚å¦‚ï¼š

@example
$ @kbd{echo abc | awk '@{ gsub(/m*/, "X"); print @}'}
@print{} XaXbXcX
@end example

@noindent
å°½ç®¡è¿™æœ‰ä¸€äº›æ„ä¹‰ï¼Œä½†çœ‹èµ·æ¥è¿˜æ˜¯è®©äººæœ‰ç‚¹æƒŠè®¶ã€‚
@end sidebar


@node Gory Details
@subsubsection @code{sub()}ã€@code{gsub()} ä¸ @code{gensub()} å‡½æ•°ä¸­çš„ @samp{\} ä¸ @samp{&} 
@cindex escape processing, @code{gsub()}/@code{gensub()}/@code{sub()} functions
@cindex @code{sub()} function, escape processing
@cindex @code{gsub()} function, escape processing
@cindex @code{gensub()} function (@command{gawk}), escape processing
@cindex @code{\} (backslash), @code{gsub()}/@code{gensub()}/@code{sub()} functions and
@cindex backslash (@code{\}), @code{gsub()}/@code{gensub()}/@code{sub()} functions and
@cindex @code{&} (ampersand), @code{gsub()}/@code{gensub()}/@code{sub()} functions and
@cindex ampersand (@code{&}), @code{gsub()}/@code{gensub()}/@code{sub()} functions and

@quotation æ³¨æ„
æœ¬å°èŠ‚æ®æŠ¥è¯´æ˜¯ä¼šé€ æˆå¤´ç—›ï¼Œæœ‰å¯èƒ½ç¬¬ä¸€æ¬¡é˜…è¯»æ—¶æƒ³è·³è¿‡ã€‚
@end quotation

å½“ä½¿ç”¨ @code{sub()}ï¼Œ@code{gsub()} æˆ–è€… @code{gensub()} ï¼Œå¹¶ä¸”è¯•å›¾è·å–å­—é¢çš„åæ–œæ ä¸æ˜Ÿå·ï¼Œå¹¶æ”¾åœ¨æ›¿æ¢æ–‡æœ¬ä¸­ï¼Œä½ éœ€è¦è®°ä½ï¼Œåˆ°åº•æœ‰å‡ çº§@dfn{è½¬ä¹‰å¤„ç†}ã€‚

é¦–å…ˆï¼Œæœ‰ä¸€ä¸ª@dfn{è¯æ±‡}å±‚ï¼Œå°±æ˜¯å½“ @command{awk} è¯»å–ä½ çš„ç¨‹åºï¼Œå¹¶å»ºç«‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å†…éƒ¨å¤æœ¬çš„æ—¶å€™ã€‚ç„¶åä¸€ä¸ªæ˜¯è¿è¡Œæ—¶å±‚ï¼Œå°±æ˜¯å½“ @command{awk} å®é™…æ‰«ææ›¿æ¢æ–‡æœ¬ä¸²ç”¨äºç¡®å®šæ‰€äº§ç”Ÿçš„ç»“æœçš„æ—¶å€™ã€‚

@cindex Brian Kernighan's @command{awk}
åœ¨ä¸¤ä¸ªå±‚ä¸Šï¼Œ@command{awk} ä¼šæœç´¢å·²ç»å®šä¹‰å¥½çš„å¯ä»¥æ”¾åœ¨åæ–œæ ä¹‹åçš„å­—ç¬¦é›†ã€‚åœ¨è¯æ±‡å±‚ï¼Œå®ƒä¼šæœç´¢åœ¨ @ref{Escape Sequences} ä¸­åˆ—å‡ºçš„è½¬ä¹‰åºåˆ—ã€‚
æ‰€ä»¥ï¼Œå¯¹æ¯ä¸€ä¸ª @command{awk} åœ¨è¿è¡Œå±‚å¤„ç†çš„ @samp{\} ï¼Œä½ å¿…é¡»åœ¨è¯æ±‡å±‚è¾“å…¥ä¸¤ä¸ªåæ–œæ ã€‚å½“è·Ÿåœ¨ @samp{\} ä¹‹åçš„å­—ç¬¦ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è½¬æ¢åºåˆ—ï¼ŒGWK @command{awk} ä¸ @command{gawk} ä¸¤è€…éƒ½æ˜¯ç®€å•åœ°ç§»é™¤ @samp{\} å¹¶å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ”¾åœ¨å­—ä¸²ä¸­ã€‚
å› æ­¤ï¼Œå¦‚ @code{"a\qb"} ä¼šè¢«å½“æˆ @code{"aqb"}ã€‚

åœ¨è¿è¡Œå±‚ï¼Œä¸åŒçš„å‡½æ•°åœ¨å¤„ç† @samp{\} ä¸ @samp{&} åºåˆ—æ—¶æ˜¯ä¸åŒçš„ã€‚è¿™ç§æƒ…å†µå¾ˆï¼ˆè›‹ç–¼ï¼‰åœ°æœ‰ç‚¹å¤æ‚ã€‚ç”±äºå†å²åŸå› ï¼Œ@code{sub()} ä¸ @code{gsub()} å‡½æ•°éƒ½å°†ä¸¤å­—ç¬¦ @samp{\&} åºåˆ—ç‰¹æ®Šå¯¹å¾…ï¼Œè¿™ä¸ªåºåˆ—åœ¨äº§ç”Ÿçš„æ–‡æœ¬ä¸­è¢«æ›¿æ¢ä¸º @samp{&} ã€‚ä»»ä½•åœ¨ @var{replacement} ä¸­çš„å…¶ä»–çš„ä¸åœ¨ @samp{&} ä¹‹å‰çš„ @samp{\} éƒ½åŸæ ·åœ°ä¼ é€’ã€‚è¿™ä¸ªå°†åœ¨ @ref{table-sub-escapes} ä¸­è§£é‡Šã€‚

@c Thank to Karl Berry for help with the TeX stuff.
@float Table,table-sub-escapes
@caption{ç”±äºå†å²åŸå›  @code{sub()} ä¸ @code{gsub()} å¤„ç†è½¬ä¹‰åºåˆ—æƒ…å†µ}
@tex
\vbox{\bigskip
% We need more characters for escape and tab ...
\catcode`_ = 0
\catcode`! = 4
% ... since this table has lots of &'s and \'s, so we unspecialize them.
\catcode`\& = \other \catcode`\\ = \other
_halign{_hfil#!_qquad_hfil#!_qquad#_hfil_cr
      è¾“å…¥!@code{sub()} æ‰€è§!@code{sub()} äº§ç”Ÿ_cr
_hrulefill!_hrulefill!_hrulefill_cr
     @code{\&}!       @code{&}!åŒ¹é…çš„å­—ä¸²_cr
    @code{\\&}!      @code{\&}!å­—ç¬¦ @samp{&}_cr
   @code{\\\&}!      @code{\&}!å­—ç¬¦ @samp{&}_cr
  @code{\\\\&}!     @code{\\&}!å­—ç¬¦ @samp{\&}_cr
 @code{\\\\\&}!     @code{\\&}!å­—ç¬¦ @samp{\&}_cr
@code{\\\\\\&}!    @code{\\\&}!å­—ç¬¦ @samp{\\&}_cr
    @code{\\q}!      @code{\q}!å­—ç¬¦ @samp{\q}_cr
}
_bigskip}
@end tex
@ifdocbook
@multitable @columnfractions .20 .20 .60
@headitem è¾“å…¥ @tab @code{sub()} æ‰€è§ @tab @code{sub()} æ‰€äº§ç”Ÿ
@item @code{\&}      @tab @code{&}    @tab åŒ¹é…çš„å­—ä¸²
@item @code{\\&}     @tab @code{\&}   @tab å­—ç¬¦ @samp{&}
@item @code{\\\&}    @tab @code{\&}   @tab å­—ç¬¦ @samp{&}
@item @code{\\\\&}   @tab @code{\\&}  @tab å­—ç¬¦ @samp{\&}
@item @code{\\\\\&}  @tab @code{\\&}  @tab å­—ç¬¦ @samp{\&}
@item @code{\\\\\\&} @tab @code{\\\&} @tab å­—ç¬¦ @samp{\\&}
@item @code{\\q}     @tab @code{\q}   @tab å­—ç¬¦ @samp{\q}
@end multitable
@end ifdocbook
@ifnottex
@ifnotdocbook
@display
 è¾“å…¥         @code{sub()} æ‰€è§          @code{sub()} æ‰€äº§ç”Ÿ
 --------         ----------          ---------------
     @code{\&}              @code{&}            The matched text
    @code{\\&}             @code{\&}            å­—ç¬¦ @samp{&}
   @code{\\\&}             @code{\&}            å­—ç¬¦ @samp{&}
  @code{\\\\&}            @code{\\&}            å­—ç¬¦ @samp{\&}
 @code{\\\\\&}            @code{\\&}            å­—ç¬¦ @samp{\&}
@code{\\\\\\&}           @code{\\\&}            å­—ç¬¦ @samp{\\&}
    @code{\\q}             @code{\q}            å­—ç¬¦ @samp{\q}
@end display
@end ifnotdocbook
@end ifnottex
@end float

@noindent
ä¸Šè¡¨æ˜¾ç¤ºäº†è¯æ±‡å±‚çš„å¤„ç†ï¼Œåœ¨é‡Œé¢ï¼Œä¸€ä¸ªå¥‡æ•°ä¸ªçš„åæ–œæ åœ¨è¿è¡Œæ—¶ï¼Œå°±å˜æˆäº†å¶æ•°ï¼Œè¿™ä¸ @code{sub()} çš„è¿è¡Œæ—¶çš„å¤„ç†ä¸€æ ·ã€‚ï¼ˆä¸ºäº†ç®€å•èµ·è§ï¼Œåé¢çš„è¡¨åªæ˜¾ç¤ºåœ¨è¯æ±‡å±‚è¾“å…¥å¶æ•°çš„åæ–œæ çš„æƒ…å½¢ã€‚ï¼‰

å†å²æ–¹å¼çš„é—®é¢˜æ˜¯ï¼Œæ²¡æœ‰åŠæ³•å–å¾—åé¢è·Ÿç€åŒ¹é…å­—ä¸²çš„å­—é¢çš„ @samp{\} ã€‚

POSIX æ ‡å‡†çš„å‡ ä¸ªç‰ˆæœ¬éƒ½å°è¯•æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯éƒ½ä¸æˆåŠŸã€‚ç»†èŠ‚åœ¨æ­¤æ— å…³ã€‚

åœ¨æŸä¸ªæ—¶å€™ï¼Œ@command{gawk} çš„ç»´æŠ¤è€…æäº¤äº†å»ºè®®æ–‡æœ¬ï¼Œå½¢æˆä¸€ä¸ªä¿®è®¢ç‰ˆæœ¬çš„æ ‡å‡†ï¼Œä»¥é€†è½¬åˆ°ä¸æœ€åˆå­˜åœ¨çš„å®è·µæ›´åŠ æ¥è¿‘çš„è§„åˆ™ä¸Šã€‚æäº¤çš„è§„åˆ™å­˜åœ¨ç‰¹æ®Šæƒ…å½¢ï¼Œä»¥æœ‰å¯èƒ½äº§ç”Ÿåœ¨åŒ¹é…çš„æ–‡æœ¬å‰çš„ @samp{\}ã€‚è¿™ä¸ªåœ¨ @ref{table-sub-proposed} ä¸­æ˜¾ç¤ºã€‚

@float Table,table-sub-proposed
@caption{@command{gawk} é’ˆå¯¹ @code{sub()} ä¸åæ–œæ çš„è§„åˆ™}
@tex
\vbox{\bigskip
% We need more characters for escape and tab ...
\catcode`_ = 0
\catcode`! = 4
% ... since this table has lots of &'s and \'s, so we unspecialize them.
\catcode`\& = \other \catcode`\\ = \other
_halign{_hfil#!_qquad_hfil#!_qquad#_hfil_cr
    è¾“å…¥!@code{sub()} æ‰€è§!@code{sub()} äº§ç”Ÿ_cr
_hrulefill!_hrulefill!_hrulefill_cr
@code{\\\\\\&}!     @code{\\\&}!å­—ç¬¦ @samp{\&}_cr
@code{\\\\&}!     @code{\\&}!å­—ç¬¦ @samp{\}ï¼Œåé¢è·Ÿç€åŒ¹é…æ–‡æœ¬_cr
  @code{\\&}!      @code{\&}!å­—ç¬¦ @samp{&}_cr
  @code{\\q}!      @code{\q}!å­—ç¬¦ @samp{\q}_cr
 @code{\\\\}!      @code{\\}!@code{\\}_cr
}
_bigskip}
@end tex
@ifdocbook
@multitable @columnfractions .20 .20 .60
@headitem è¾“å…¥ @tab @code{sub()} æ‰€è§ @tab @code{sub()} äº§ç”Ÿ
@item @code{\\\\\\&} @tab @code{\\\&} @tab å­—ç¬¦ @samp{\&}
@item @code{\\\\&}   @tab @code{\\&}  @tab å­—ç¬¦ @samp{\}ï¼Œåé¢è·Ÿç€åŒ¹é…æ–‡æœ¬
@item @code{\\&}     @tab @code{\&}   @tab å­—ç¬¦ @samp{&}
@item @code{\\q}     @tab @code{\q}   @tab å­—ç¬¦ @samp{\q}
@item @code{\\\\}    @tab @code{\\}   @tab @code{\\}
@end multitable
@end ifdocbook
@ifnottex
@ifnotdocbook
@display
 è¾“å…¥         @code{sub()} æ‰€è§         @code{sub()} äº§ç”Ÿ
 --------         ----------         ---------------
@code{\\\\\\&}           @code{\\\&}            å­—ç¬¦ @samp{\&}
  @code{\\\\&}            @code{\\&}            å­—ç¬¦ @samp{\}ï¼Œåé¢è·Ÿç€åŒ¹é…æ–‡æœ¬
    @code{\\&}             @code{\&}            å­—ç¬¦ @samp{&}
    @code{\\q}             @code{\q}            å­—ç¬¦ @samp{\q}
   @code{\\\\}             @code{\\}            @code{\\}
@end display
@end ifnotdocbook
@end ifnottex
@end float

æ€»çš„æ¥è¯´ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œç°åœ¨æœ‰ä¸‰ä¸ªç‰¹æ®Šçš„å­—ç¬¦åºåˆ—ï¼ˆ@samp{\\\&}ï¼Œ@samp{\\&} å’Œ @samp{\&}ï¼‰ï¼Œç”±äºå†å²åŸå› åªä¼šå­˜åœ¨ä¸€ä¸ªã€‚ä½†æ˜¯åœ¨å†å²æƒ…å†µä¸‹ï¼Œ@samp{\} å¹¶ä¸æ˜¯è¿™ä¸‰ä¸ªåºåˆ—çš„ä¸€éƒ¨ä»½ä¹Ÿå¹¶ä¸ç‰¹æ®Šï¼Œå¹¶ä»¥å­—ç¬¦æœ¬èº«è¾“å‡ºã€‚

@command{gawk} 3.0 ä¸ 3.1 ä¼šé’ˆå¯¹ @code{sub()} ä¸ @code{gsub()} æ¥åŒ¹é…è¿™äº›è§„åˆ™ã€‚POSIX æ ‡å‡†çš„ä¿®æ”¹è¦æ¯”æœŸæœ›çš„æ—¶é—´é•¿å¾—å¤šã€‚å¦å¤–ï¼Œ@command{gawk} çš„ç»´æŠ¤è€…çš„å»ºè®®åœ¨æ ‡å‡†åŒ–çš„è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ã€‚æœ€åçš„è§„åˆ™çœ‹èµ·æ¥æ›´ç®€å•ã€‚ç»“æœé™¤äº†ä¸€ä¸ªæƒ…å½¢å¤–éƒ½ç±»ä¼¼ã€‚

@cindex POSIX @command{awk}, functions and, @code{gsub()}/@code{sub()}
POSIX è§„åˆ™æè¿°è¯´ï¼Œåœ¨æ›¿æ¢æ–‡æœ¬ä¸­çš„ @samp{\&} äº§ç”Ÿä¸€ä¸ª @samp{&}ï¼Œ@samp{\\} äº§ç”Ÿä¸€ä¸ªå­—é¢ @samp{\}ï¼Œ@samp{\} åé¢å†è·Ÿå…¶ä»–çš„å­—ç¬¦éƒ½æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œ@samp{\} ä¼šè¢«ç›´æ¥æ”¾åˆ°è¾“å‡ºä¸­ã€‚è¿™äº›è§„åˆ™åœ¨åé¢çš„ @ref{table-posix-sub}ã€‚

@float Table,table-posix-sub
@caption{POSIX é’ˆå¯¹ @code{sub()} ä¸ @code{gsub()} çš„è§„åˆ™}
@tex
\vbox{\bigskip
% We need more characters for escape and tab ...
\catcode`_ = 0
\catcode`! = 4
% ... since this table has lots of &'s and \'s, so we unspecialize them.
\catcode`\& = \other \catcode`\\ = \other
_halign{_hfil#!_qquad_hfil#!_qquad#_hfil_cr
    è¾“å…¥!@code{sub()} æ‰€è§!@code{sub()} ç”Ÿæˆ_cr
_hrulefill!_hrulefill!_hrulefill_cr
@code{\\\\\\&}!     @code{\\\&}!å­—ç¬¦ @samp{\&}_cr
@code{\\\\&}!     @code{\\&}!å­—ç¬¦ @samp{\}ï¼Œåé¢è·ŸåŒ¹é…æ–‡æœ¬_cr
  @code{\\&}!      @code{\&}!å­—ç¬¦ @samp{&}_cr
  @code{\\q}!      @code{\q}!å­—ç¬¦ @samp{\q}_cr
 @code{\\\\}!      @code{\\}!@code{\}_cr
}
_bigskip}
@end tex
@ifdocbook
@multitable @columnfractions .20 .20 .60
@headitem è¾“å…¥ @tab @code{sub()} æ‰€è§ @tab @code{sub()} ç”Ÿæˆ
@item @code{\\\\\\&} @tab @code{\\\&} @tab å­—ç¬¦ @samp{\&}
@item @code{\\\\&}   @tab @code{\\&}  @tab å­—ç¬¦ @samp{\}ï¼Œåé¢è·ŸåŒ¹é…æ–‡æœ¬
@item @code{\\&}     @tab @code{\&}   @tab å­—ç¬¦ @samp{&}
@item @code{\\q}     @tab @code{\q}   @tab å­—ç¬¦ @samp{\q}
@item @code{\\\\}    @tab @code{\\}   @tab @code{\}
@end multitable
@end ifdocbook
@ifnottex
@ifnotdocbook
@display
 è¾“å…¥         @code{sub()} æ‰€è§         @code{sub()} ç”Ÿæˆ
 --------         ----------         ---------------
@code{\\\\\\&}           @code{\\\&}            å­—ç¬¦ @samp{\&}
  @code{\\\\&}            @code{\\&}            å­—ç¬¦ @samp{\}ï¼Œåé¢è·ŸåŒ¹é…æ–‡æœ¬
    @code{\\&}             @code{\&}            å­—ç¬¦ @samp{&}
    @code{\\q}             @code{\q}            å­—ç¬¦ @samp{\q}
   @code{\\\\}             @code{\\}            @code{\}
@end display
@end ifnotdocbook
@end ifnottex
@end float

å”¯ä¸€å¯æ³¨æ„çš„ä¸åŒçš„æƒ…å½¢æ˜¯æœ€åä¸€ä¸ªï¼š@samp{\\\\} è¢«çœ‹æˆ @samp{\\} å¹¶äº§ç”Ÿ @samp{\} ï¼Œè€Œä¸æ˜¯ @samp{\\} ã€‚

ä» 3.1.4 @value{PVERSION}å¼€å§‹ï¼Œå¦‚æœæŒ‡å®šäº† @option{--posix} é€‰é¡¹ï¼Œ@command{gawk} æŒ‰ç…§ POSIX çš„æ ‡å‡†æ¥ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚å¦åˆ™ï¼Œå®ƒè¿˜æ˜¯ä¼šä½¿ç”¨æ‰€å»ºè®®çš„æ–¹æ¡ˆï¼Œå› ä¸ºé‚£æ˜¯å¤šå¹´æ¥çš„è¡Œä¸ºã€‚

å½“å‘å¸ƒäº† 4.0.0 @value{PVERSION}åï¼Œ@command{gawk} ç»´æŠ¤è€…å°† POSIX è§„åˆ™ä¸ºé»˜è®¤è§„åˆ™ï¼Œæ‰“ç ´äº† 10 å‡ å¹´æ¥åå‘å…¼å®¹æ€§çš„ä»·å€¼ã€‚
@footnote{é‚£ä¸ªäººçœŸæ˜¯å¹¼ç¨šï¼Œå°½ç®¡è¿™ä¸ª@value{SECTION}ä¸­æœ‰ä¸€ä¸ªæç¤ºè¯´ä¸‹ä¸ªä¸»è¦çš„ç‰ˆæœ¬ä¼šè·Ÿ POSIX ä¿æŒä¸€è‡´ã€‚}
æ— é¡»å¤šè¯´ï¼Œè¿™ä¸ªæ˜¯éå¸¸ç³Ÿç³•çš„ä¸»æ„ï¼Œå½“ 4.0.1 @value{PVERSION}æ—¶ï¼Œ@command{gawk} æ¢å¤äº†å®ƒçš„å†å²è¡Œä¸ºï¼Œå½“æŒ‡å®šäº† @option{--posix} é€‰é¡¹æ—¶ï¼Œåˆ™åªéµå®ˆ POSIX è§„åˆ™ã€‚

@code{gensub()} çš„è§„åˆ™åˆ™ç›¸å½“ç®€å•ã€‚åœ¨è¿è¡Œå±‚ï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™ @command{gawk} çœ‹åˆ°ä¸€ä¸ª @samp{\}ï¼Œå¦‚æœåé¢è·Ÿç€ä¸€ä¸ªæ•°å­—ï¼Œåˆ™åŒ¹é…ç›¸åº”æ‹¬å·çš„å­è¡¨è¾¾å¼çš„æ–‡ä»¶æ¥äº§ç”Ÿè¾“å‡ºã€‚å¦åˆ™ï¼Œä¸ç®¡ @samp{\} åé¢è·Ÿç€ä»€ä¹ˆå­—ç¬¦ï¼Œå®ƒéƒ½å‡ºç°åœ¨äº§ç”Ÿçš„æ–‡æœ¬ä¸­ï¼Œè€Œ @samp{\} åˆ™ä¸å‡ºç°ã€‚
å¦‚ @ref{table-gensub-escapes} æ‰€ç¤ºã€‚

@float Table,table-gensub-escapes
@caption{@code{gensub()} çš„è½¬ä¹‰å­—ç¬¦}
@tex
\vbox{\bigskip
% We need more characters for escape and tab ...
\catcode`_ = 0
\catcode`! = 4
% ... since this table has lots of &'s and \'s, so we unspecialize them.
\catcode`\& = \other \catcode`\\ = \other
_halign{_hfil#!_qquad_hfil#!_qquad#_hfil_cr
    è¾“å…¥!@code{gensub()} æ‰€è§!@code{gensub()} äº§ç”Ÿ_cr
_hrulefill!_hrulefill!_hrulefill_cr
      @code{&}!           @code{&}!åŒ¹é…æ–‡æœ¬_cr
    @code{\\&}!          @code{\&}!å­—ç¬¦ @samp{&}_cr
   @code{\\\\}!          @code{\\}!å­—ç¬¦ @samp{\}_cr
  @code{\\\\&}!         @code{\\&}!å­—ç¬¦ @samp{\}ï¼Œåé¢è·Ÿç€åŒ¹é…æ–‡æœ¬
@code{\\\\\\&}!        @code{\\\&}!å­—ç¬¦ @samp{\&}_cr
    @code{\\q}!          @code{\q}!å­—ç¬¦ @samp{q}_cr
}
_bigskip}
@end tex
@ifdocbook
@multitable @columnfractions .20 .20 .60
@headitem è¾“å…¥ @tab @code{gensub()} æ‰€è§ @tab @code{gensub()} äº§ç”Ÿ
@item @code{&}       @tab @code{&}    @tab åŒ¹é…æ–‡æœ¬
@item @code{\\&}     @tab @code{\&}   @tab å­—ç¬¦ @samp{&}
@item @code{\\\\}    @tab @code{\\}   @tab å­—ç¬¦ @samp{\}
@item @code{\\\\&}   @tab @code{\\&}  @tab å­—ç¬¦ @samp{\}ï¼Œåé¢è·Ÿç€åŒ¹é…æ–‡æœ¬
@item @code{\\\\\\&} @tab @code{\\\&} @tab å­—ç¬¦ @samp{\&}
@item @code{\\q}     @tab  @code{\q}  @tab å­—ç¬¦ @samp{q}
@end multitable
@end ifdocbook
@ifnottex
@ifnotdocbook
@display
  è¾“å…¥          @code{gensub()} æ‰€è§         @code{gensub()} äº§ç”Ÿ
  --------          -------------         ------------------
      @code{&}                    @code{&}            åŒ¹é…æ–‡æœ¬
    @code{\\&}                   @code{\&}            å­—ç¬¦ @samp{&}
   @code{\\\\}                   @code{\\}            å­—ç¬¦ @samp{\}
  @code{\\\\&}                  @code{\\&}            å­—ç¬¦ @samp{\}ï¼Œåé¢è·Ÿç€åŒ¹é…æ–‡æœ¬
@code{\\\\\\&}                 @code{\\\&}            å­—ç¬¦ @samp{\&}
    @code{\\q}                   @code{\q}            å­—ç¬¦ @samp{q}
@end display
@end ifnotdocbook
@end ifnottex
@end float

ç”±äºè¯æ±‡å±‚ä¸è¿è¡Œå±‚å¤„ç†çš„å¤æ‚æ€§ï¼Œä»¥åŠ @code{sub()} ä¸ @code{gsub()} çš„ç‰¹æ®Šæƒ…å½¢ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ @command{gawk} ä¸ @code{gensub()} æ¥æ‰§è¡Œæ›¿æ¢æ“ä½œã€‚

@node I/O Functions
@subsection è¾“å…¥è¾“å‡ºå‡½æ•°
@cindex input/output functions

ä¸‹é¢çš„å‡½æ•°ä¸ I/O ç›¸å…³ã€‚å¯é€‰æ‹©çš„å‚æ•°æ”¾åœ¨æ–¹æ‹¬å·ä¸­ï¼ˆ[ ]ï¼‰ï¼š

@table @asis
@item @code{close(}@var{filename} [@code{,} @var{how}]@code{)}
@cindexawkfunc{close}
@cindex files, closing
@cindex close file or coprocess
å…³é—­ç”¨äºè¾“å…¥æˆ–è€…è¾“å‡ºçš„æ–‡ä»¶ @var{filename}ã€‚å¦å¤–ï¼Œå‚æ•°ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç”¨æ¥åˆ›å»ºå¹¶ç¨‹æˆ–è€…ç”¨äºé‡å®šå‘è¾“å‡ºï¼Œæˆ–è€…ä»ç®¡é“ä¸­è¾“å…¥çš„ Shell å‘½ä»¤ã€‚å¦‚æœå‚æ•°æ˜¯è¿™ä¸ªï¼Œåˆ™ä¼šå…³é—­ç›¸åº”çš„å¹¶ç¨‹ä¸ç®¡é“ã€‚æŸ¥çœ‹ @ref{Close Files And Pipes}ï¼Œè·å–æ›´å¤šä¿¡æ¯ã€‚

 å½“å…³é—­ä¸€ä¸ªå¹¶ç¨‹æ—¶ï¼Œæœ‰æ—¶å…ˆå…³é—­ä¸¤è·¯ç®¡é“ä¸­çš„ä¸€ç«¯ç„¶åå†å…³é—­å¦ä¸€ç«¯éå¸¸æœ‰ç”¨ã€‚è¿™é€šè¿‡å‘ @code{close()} ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°æ¥å®Œæˆã€‚è¿™ç¬¬äºŒä¸ªå‚æ•°ï¼ˆ@var{how}ï¼‰è¦æ˜¯ä¸‹é¢ä¸¤ä¸ªä¸²ä¸­çš„ä¸€ä¸ªï¼Œ
 å³ @code{"to"} æˆ–è€… @code{"from"}ï¼Œä»¥è¡¨ç¤ºå…³é—­ç®¡é“çš„å“ªä¸€ç«¯ã€‚å­—ä¸²çš„å¤§å°å†™æ˜¯æ— å…³çš„ã€‚æŸ¥çœ‹ @ref{Two-way I/O}ï¼Œåœ¨é‡Œé¢æ›´è¯¦ç»†åœ°è®¨è®ºäº†è¿™ä¸ªç‰¹æ€§ï¼Œå¹¶ä¸”è¿˜ä¸¾äº†ä¸€ä¸ªä¾‹å­ã€‚

æ³¨æ„ @code{close()} çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ @command{gawk} æ‰©å±•ï¼Œåœ¨å…¼å®¹æ¨¡å¼ä¸‹æ˜¯ä¸å¯ç”¨çš„ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚

@item @code{fflush(}[@var{filename}]@code{)}
@cindexawkfunc{fflush}
@cindex flush buffered output
å°†ä¸ @var{filename} ç›¸å…³çš„ç¼“å­˜è¾“å‡ºåˆ·å‡ºï¼Œ@var{filename} è¦ä¹ˆæ˜¯ä¸€ä¸ªæ‰“å¼€çš„ç”¨äºå†™çš„æ–‡ä»¶ï¼Œæˆ–è€…ç”¨äºé‡å®šå‘è¾“å‡ºçš„ç®¡é“ï¼Œæˆ–è€…å¹¶ç¨‹ã€‚

@cindex buffers, flushing
@cindex output, buffering
å¾ˆå¤šçš„å·¥å…·ç¨‹åºéƒ½ä¼š@dfn{ç¼“å­˜}å®ƒä»¬çš„è¾“å‡ºï¼ˆå³å®ƒä»¬ä¼šå°†å†™åˆ°ç£ç›˜çš„æ–‡ä»¶æˆ–è€…å±å¹•çš„ä¿¡æ¯ä¿å­˜ï¼Œå¹¶ç­‰å¾…è¶³å¤Ÿçš„æ—¶é—´ä»¥å€¼å¾—å°†è¿™äº›æ•°æ®è¾“å‡ºåˆ°è¾“å‡ºè®¾å¤‡ä¸­ï¼‰ã€‚è¿™æ¯”èµ·æ¯æ¬¡å‡†å¤‡å¥½ä¸€ç‚¹æ•°æ®å°±å†™è¦é«˜æ•ˆå¾—å¤šã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å¾ˆæœ‰å¿…è¦å¼ºåˆ¶ç¨‹åºè¦@dfn{åˆ·å‡º}å®ƒçš„ç¼“å­˜ï¼ˆå³å°†ä¿¡æ¯å†™åˆ°å®ƒçš„ç›®çš„åœ°ï¼Œå°±æ˜¯ç¼“å­˜è¿˜æ²¡æœ‰æ»¡ï¼‰ã€‚
è¿™å°±æ˜¯ @code{fflush()} å‡½æ•°çš„ç›®çš„â€”â€”@command{gawk} ä¹Ÿä¼šç¼“å­˜å®ƒçš„è¾“å‡ºï¼Œè€Œ @code{fflush()} å‡½æ•°å¼ºåˆ¶ @command{gawk} åˆ·å‡ºå®ƒçš„ç¼“å­˜ã€‚

@cindex extensions, common@comma{} @code{fflush()} function
@cindex Brian Kernighan's @command{awk}
Brian Kernighan åœ¨ 1992 å¹´ 4 æœˆå°† @code{fflush()} åŠ å…¥åˆ°ä»–çš„ @command{awk} ä¸­ã€‚äºŒåå¹´è¿‡å»äº†ï¼Œå®ƒç°åœ¨æˆä¸ºäº†ä¸€ä¸ªé€šè¿‡æ‰©å±•ã€‚2012 å¹´ 12 æœˆï¼Œå®ƒè¢«æ¥å—åŒ…å«åˆ° POSIX æ ‡å‡†ä¸­ã€‚
å¯ä»¥æŸ¥çœ‹@uref{http://austingroupbugs.net/view.php?id=634, Austin Group ç½‘ç«™}æ¥äº†è§£ã€‚

POSIX æ ‡å‡†åŒ–äº† @code{fflush()} ä¸‹é¢å‡ ä¸ªæ–¹é¢ï¼šå¦‚æœæ²¡æœ‰å‚æ•°ï¼Œæˆ–è€…å‚æ•°æ˜¯ç©ºä¸²ï¼ˆ@w{@code{""}}ï¼‰ï¼Œåˆ™ @command{awk} åˆ·å‡ºæ‰€æœ‰å·²ç»æ‰“å¼€çš„æ–‡ä»¶ä¸ç®¡é“çš„ç¼“å­˜ã€‚

@quotation æç¤º
åœ¨ 4.0.2 ä¹‹å‰çš„@value{PVERSION}ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°ï¼Œ@command{gawk} ä¼šåªåˆ·å‡ºæ ‡å‡†è¾“å‡ºï¼Œè€Œä¸ºç©ºä¸²æ—¶ï¼Œæ‰ä¼šåˆ·å‡ºæ‰€æœ‰çš„è¾“å‡ºæ–‡ä»¶ä¸ç®¡é“ã€‚ä¸ºäº†ä¸ Brian Kernighan çš„ @command{awk} å…¼å®¹ï¼Œåˆ™å¯¹å…¶ä½œäº†æ›´æ”¹ï¼Œå¹¶å¸Œæœ›åœ¨ POSIX ä¸­å¯¹è¿™ä¸ªç‰¹æ€§çš„æ ‡å‡†åŒ–å¯ä»¥æ›´åŠ å®¹æ˜“ï¼ˆå®é™…ä¸Šä¹Ÿç¡®å®æ˜¯è¿™æ ·ï¼‰ã€‚

å¯¹äº @command{gawk}ï¼Œä½ å¯ä»¥ä½¿ç”¨ @samp{fflush("/dev/stdout")} æ¥åªåˆ·å‡ºæ ‡å‡†è¾“å‡ºã€‚
@end quotation

@c @cindex automatic warnings
@c @cindex warnings, automatic
@cindex troubleshooting, @code{fflush()} function
å¦‚æœç¼“å­˜è¢«æˆåŠŸåˆ·å‡ºï¼Œåˆ™ @code{fflush()} è¿”å› 0ï¼Œå¦åˆ™ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªéé›¶å€¼ã€‚ï¼ˆ@command{gawk} è¿”å› @minus{}1ã€‚ï¼‰åœ¨æ‰€æœ‰çš„ç¼“å­˜éƒ½åˆ·å‡ºçš„æƒ…å†µä¸‹ï¼Œå½“åªæœ‰æ‰€æœ‰çš„ç¼“å­˜éƒ½æˆåŠŸåˆ·å‡ºåæ‰ä¼šè¿”å› 0ã€‚å¦åˆ™ä¼šè¿”å› @minus{}1ï¼Œå¹¶å¯¹æœ‰é—®é¢˜çš„ @var{filename} å‘é€å‘Šè­¦ã€‚

å¦‚æœä½ åˆ·å‡ºçš„æ–‡ä»¶æˆ–è€…ç®¡é“æ˜¯æ‰“å¼€ç”¨äºè¯»å–çš„ï¼ˆå¦‚ @code{getline}ï¼‰ï¼Œæˆ–è€… @code{fflush()} ä¸æ˜¯æ‰“å¼€çš„æ–‡ä»¶ï¼Œç®¡é“æˆ–è€…å¹¶ç¨‹ï¼Œ@command{gawk} ä¹Ÿä¼šå‘å‡ºä¸€ä¸ªå‘Šè­¦ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ@code{fflush()} ä¹Ÿè¿”å› @minus{}1ã€‚

@sidebar äº¤äº’å¼ä¸éäº¤äº’å¼ç¼“å­˜
@cindex buffering, interactive vs.@: noninteractive

å¤šè¯´ä¸€ç‚¹ï¼Œå¦‚æœä½ çš„ç¨‹åºæ˜¯@dfn{äº¤äº’å¼}çš„ï¼ˆå°±æ˜¯ä¸ååœ¨é”®ç›˜å‰çš„ç”¨æˆ·è¿›è¡Œé€šä¿¡ï¼‰ï¼Œç¼“å­˜é—®é¢˜æœ‰æ—¶ä¼šéå¸¸è®©äººç–‘æƒ‘ã€‚
@footnote{å¦‚æœæ ‡å‡†è¾“å‡ºè¿æ¥åˆ°ä¸€ä¸ªç»ˆç«¯è®¾å¤‡ï¼Œåˆ™ç¨‹åºæ˜¯äº¤äº’å¼çš„ã€‚åœ¨ç°ä»£ç³»ç»Ÿä¸­ï¼Œè¿™è¡¨ç¤ºè®¾å¤‡æ˜¯ä½ çš„é”®ç›˜æˆ–è€…å±å¹•ã€‚}

@c Thanks to Walter.Mecky@dresdnerbank.de for this example, and for
@c motivating me to write this section.
äº¤äº’å¼çš„ç¨‹åºä¸€èˆ¬éƒ½æ˜¯@dfn{è¡Œç¼“å­˜}å®ƒä»¬çš„è¾“å‡ºï¼ˆå³å®ƒä»¬ä¸€è¡Œè¡Œåœ°å†™è¾“å‡ºï¼‰ã€‚éäº¤äº’å¼çš„ç¨‹åºç›´åˆ°ç¼“å­˜æ»¡åæ‰ä¼šè¾“å‡ºï¼Œè€Œè¿™å¯èƒ½åŒ…å«å¾ˆå¤šè¡Œè¾“å‡ºã€‚ä¸‹é¢æ˜¯å…¶å·®å¼‚çš„ä¾‹å­ï¼š

@example
$ @kbd{awk '@{ print $1 + $2 @}'}
@kbd{1 1}
@print{} 2
@kbd{2 3}
@print{} 5
@kbd{Ctrl-d}
@end example

@noindent
è¾“å‡ºçš„æ¯ä¸€è¡Œæ˜¯ç«‹å³æ‰“å°çš„ã€‚ä¸ä¸‹é¢è¿™ä¸ªä¾‹å­çš„è¡Œä¸ºè¿›è¡Œæ¯”è¾ƒï¼š

@example
$ @kbd{awk '@{ print $1 + $2 @}' | cat}
@kbd{1 1}
@kbd{2 3}
@kbd{Ctrl-d}
@print{} 2
@print{} 5
@end example

@noindent
åœ¨è¿™é‡Œï¼Œç›´åˆ°é”®å…¥ @kbd{Ctrl-d} åæ‰æœ‰è¾“å‡ºæ‰“å°ï¼Œå› æ­¤å®ƒå°†æ‰€æœ‰çš„ç¼“å­˜ï¼Œç„¶åä¸€æ¬¡æ€§å‘é€åˆ°ç®¡é“è¾“å‡ºåˆ° @command{cat}ã€‚
@end sidebar

@item @code{system(@var{command})}
@cindexawkfunc{system}
@cindex invoke shell command
@cindex interacting with other programs
æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤ @var{command} å¹¶è¿”å›åˆ° @command{awk} ç¨‹åºä¸­ã€‚åŒæ—¶è¿”å› @var{command} çš„é€€å‡ºçŠ¶æ€ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä¸‹é¢çš„ä»£ç ç‰‡æ®µæ”¾åœ¨ä½ çš„ @command{awk} ç¨‹åºä¸­ï¼š

@example
END @{
     system("date | mail -s 'awk run done' root")
@}
@end example

@noindent
å½“ @command{awk} ç¨‹åºå®Œæˆå¤„ç†è¾“å…¥ï¼Œå¹¶ä¸”å¼€å¯è¾“å…¥ç»“æŸå¤„ç†æµç¨‹æ—¶ï¼Œä¼šå‘ç³»ç»Ÿç®¡ç†å‘˜å‘é€é‚®ä»¶ã€‚

æ³¨æ„é‡å®šå‘ @code{print} æˆ–è€… @code{printf} åˆ°ç®¡é“ä¸€èˆ¬æ¥å°±å°±å¤Ÿæ¥å®Œæˆä½ çš„å·¥ä½œã€‚å¦‚æœä½ éœ€è¦è¿è¡Œè®¸å¤šå‘½ä»¤ï¼Œåˆ™ç®€å•åœ°å°†å®ƒä»¬é€šè¿‡ç®¡çº¿æ‰“å°åˆ° Shell æ›´é«˜æ•ˆï¼š

@example
while (@var{more stuff to do})
    print @var{command} | "/bin/sh"
close("/bin/sh")
@end example

@noindent
@cindex troubleshooting, @code{system()} function
@cindex @option{--sandbox} option, disabling @code{system()} function
ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ @command{awk} ç¨‹åºæ˜¯äº¤äº’å¼çš„ï¼Œ@code{system()} ç”¨äºå¤§å‹çš„è‡ªåŒ…å«çš„ç¨‹åºå°±éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ Shell æˆ–è€…ç¼–è¾‘å™¨ã€‚ä¸€äº›æ“ä½œç³»ç»Ÿä¸èƒ½å®ç° @code{system()} å‡½æ•°ã€‚@code{system()} åœ¨ä¸å…¶ä¸æ”¯æŒçš„æƒ…å†µä¸‹ç”Ÿæˆä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚

@quotation æ³¨æ„
å½“æŒ‡å®šäº† @option{--sandbox} é€‰é¡¹ï¼Œ@code{system()} å‡½æ•°ä¼šè¢«ç¦ç”¨ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚
@end quotation

åœ¨ POSIX ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€æ˜¯ä¸€ä¸ª 16 ä½çš„æ•°ã€‚ä¼ é€’ç»™ C è¯­è¨€çš„ @code{exit()} å‡½æ•°çš„æ˜¯é€€å‡ºçŠ¶æ€å€¼çš„é«˜ 8 ä½ã€‚
ä½ä½æ•°è¡¨ç¤ºè¿™ä¸ªè¿›ç¨‹æ˜¯å¦æ˜¯è¢«ä¸€ä¸ªä¿¡å·ï¼ˆç¬¬ 7 ä½ï¼‰æ€æ­»çš„ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œå‰©ä¸‹çš„ä½æ•°è¡¨ç¤ºå‡ºé”™çš„ä¿¡å·æ•°ï¼ˆç¬¬ 0-6 ä½ï¼‰ã€‚

ä¼ ç»Ÿä¸Šï¼Œ@command{awk} çš„ @code{system()} å‡½æ•°ç®€å•åœ°è¿”å›é€€å‡ºçŠ¶æ€å€¼é™¤ä»¥ 256 çš„å€¼ã€‚
åœ¨ä¸€èˆ¬çš„ä¾‹å­ä¸­ï¼Œå°±æŒ‰ç…§è¿™æ ·è¿”å›é€€å‡ºçŠ¶æ€å€¼ã€‚ä½†æ˜¯åœ¨è¿›ç¨‹è¢«ä¿¡å·æ€æ­»çš„æƒ…å†µä¸‹ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªæå°çš„æµ®ç‚¹æ•°å€¼ã€‚
@footnote{åœ¨ç§äººé€šä¿¡ä¸­ï¼ŒDr.@: Kernighan æ›¾ç»å‘æˆ‘è¡¨æ˜ï¼Œå·²æœ‰çš„è¿™ä¸ªå¤„ç†æ–¹å¼å¯èƒ½æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚}
POSIX å£°æ˜ @command{awk} çš„ @code{system()} å‡½æ•°åº”è¯¥è¿”å›å®Œæ•´çš„ 16 ä½æ•°å€¼ã€‚

@command{gawk} é‡‡å–äº†æŠ˜ä¸­æ–¹æ¡ˆã€‚è¿”å›å€¼æ€»ç»“åœ¨ @ref{table-system-return-values}ã€‚

@float Table,table-system-return-values
@caption{@code{system()} çš„è¿”å›å€¼}
@multitable @columnfractions .40 .60
@headitem åœºæ™¯ @tab @code{system()} çš„è¿”å›å€¼
@item @option{--traditional} @tab C @code{system()} çš„å€¼é™¤ä»¥ 256
@item @option{--posix} @tab C @code{system()} çš„å€¼
@item ä¸€èˆ¬çš„é€€å‡ºå‘½ä»¤ @tab å‘½ä»¤çš„é€€å‡ºçŠ¶æ€
@item è¢«ä¿¡å·æ€æ­»çš„å‘½ä»¤ @tab 256 + è¿™ç§ä¿¡å·çš„ç¼–å·
@item è¢«å¸¦ core dump çš„ä¿¡å·æ€æ­»çš„å‘½ä»¤ @tab 512 + è¿™ç§ä¿¡å·çš„ç¼–å·
@item æŸç§é”™è¯¯ @tab @minus{}1
@end multitable
@end float
@end table

@sidebar é€šè¿‡ @code{system()} æ¥æ§åˆ¶è¾“å‡ºç¼“å­˜
@cindex buffers, flushing
@cindex buffering, input/output
@cindex output, buffering

@code{system()} å‡½æ•°æä¾›äº†æ˜¾å¼çš„æ§åˆ¶è¾“å‡ºå•ç‹¬æ–‡ä»¶æˆ–è€…ç®¡é“ç¼“å­˜çš„æ–¹å¼ã€‚ä½†æ˜¯ï¼Œå¯¹äºè®¸å¤šçš„æ—§çš„ @command{awk} å®ç°å´æ˜¯ä¸å¯ç§»æ¤çš„ã€‚ä¸€ä¸ªå¯ç”¨çš„æ–¹æ³•å°±æ˜¯é€šè¿‡è°ƒç”¨ @code{system()} å‡½æ•°ï¼Œå¹¶ç»™å…¶æä¾›ä¸€ä¸ªç©ºä¸²ä½œä¸ºå…¶å‚æ•°æ¥åˆ·å‡ºè¾“å‡ºç¼“å­˜ï¼š

@example
system("")   # flush output
@end example

@noindent
@command{gawk} å°†è¿™ç§ä½¿ç”¨ @code{system()} å‡½æ•°çš„æ–¹å¼ä½œä¸ºä¸€ç§ç‰¹æ®Šæ–¹å¼æ¥å¯¹å¾…ï¼Œå¹¶ä¸”èªæ˜åœ°ä¸ç”¨ç©ºå‘½ä»¤æ¥è¿è¡Œä¸€ä¸ª Shellï¼ˆæˆ–è€…å…¶ä»–çš„å‘½ä»¤è§£é‡Šå™¨ï¼‰ã€‚å› æ­¤ï¼Œåœ¨ @command{gawk} ä¸­ï¼Œè¿™ç§èŒƒå¼ä¸ä»…å¾ˆæœ‰ç”¨ï¼ŒåŒæ—¶ä¹Ÿéå¸¸é«˜æ•ˆã€‚å°½ç®¡è¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šåœ¨å…¶ä»–çš„ @command{awk} å®ç°ä¸­å¯å·¥ä½œï¼Œä½†æ˜¯å´ä¸æ˜¯å¿…é¡»è¦é¿å…å¼€å¯ä¸€ä¸ªä¸å¿…è¦ Shellã€‚ï¼ˆå…¶ä»–çš„å®ç°å¯èƒ½åªåˆ·å‡ºä¸æ ‡å‡†è¾“å‡ºå…³é”®çš„ç¼“å­˜ï¼Œè€Œå¿…æ˜¯æ‰€æœ‰çš„ç¼“å­˜è¾“å‡ºã€‚ï¼‰

å¦‚æœä½ è€ƒè™‘ä¸€ä¸‹ä¸€ä¸ªç¨‹åºå‘˜çš„é¢„æœŸï¼Œ@code{system()} ä¼šåˆ·å‡ºæ‰€æœ‰çš„æŒ‚èµ·çš„è¾“å‡ºçœ‹èµ·æ¥å°±æœ‰æ„æ€äº†ã€‚ä¸‹é¢çš„ç¨‹åºï¼š

@example
BEGIN @{
     print "first print"
     system("echo system echo")
     print "second print"
@}
@end example

@noindent
å¿…é¡»æ‰“å°ï¼š

@example
first print
system echo
second print
@end example

@noindent
è€Œä¸æ˜¯ï¼š

@example
system echo
first print
second print
@end example

å¦‚æœ @command{awk} ä¸åœ¨è°ƒç”¨ @code{system()} å‰åˆ·å‡ºå®ƒçš„ç¼“å­˜ï¼Œä½ å°±å¯ä»¥ä¼šçœ‹åˆ°åé¢ï¼ˆä¸å¸Œæœ›çœ‹åˆ°çš„ï¼‰è¾“å‡ºã€‚
@end sidebar

@node Time Functions
@subsection æ—¶é—´å‡½æ•°
@cindex time functions

@cindex timestamps
@cindex log files, timestamps in
@cindex files, log@comma{} timestamps in
@cindex @command{gawk}, timestamps
@cindex POSIX @command{awk}, timestamps and
@command{awk} ç¨‹åºå¸¸å¸¸ç”¨æ¥å¤„ç†å¸¦æ—¶é—´æˆ³ä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶ï¼Œä»¥æç¤ºç‰¹å®šçš„æ—¥å¿—è®°å½•æ˜¯ä½•æ—¶è¢«å†™å…¥çš„ã€‚è®¸å¤šçš„ç¨‹åºå°†æ—¥å¿—çš„æ—¶é—´ä¿¡æ¯è®°å½•æˆ @code{time()} ç³»ç»Ÿè°ƒç”¨è¿”å›çš„æ ¼å¼ï¼Œå³æ˜¯ä»ç‰¹å®šæ—¶åˆ»å¼€å§‹çš„ç§’æ•°ã€‚åœ¨ POSIX å…¼å®¹çš„ç³»ç»Ÿä¸Šï¼Œå®ƒæ˜¯ä» 1970-01-01 00:00:00 UTC æ—¶é—´å¼€å§‹ä»¥æ¥çš„ç§’æ•°ï¼Œæ²¡æœ‰åŒ…å«æ¶¦ç§’ã€‚
@ifclear FOR_PRINT
@footnote{@ref{Glossary}ï¼Œç‰¹åˆ«æ˜¯ â€œEpochâ€ ä¸ â€œUTCâ€ é¡¹ã€‚}
@end ifclear
æ‰€æœ‰çŸ¥åçš„ POSIX å…¼å®¹çš„ç³»ç»Ÿæ”¯æŒä» 0 åˆ°
@iftex
@math{2^{31} - 1},
@end iftex
@ifinfo
2^31 - 1,
@end ifinfo
@ifnottex
@ifnotinfo
2@sup{31} @minus{} 1,
@end ifnotinfo
@end ifnottex
ä¹‹é—´çš„æ—¶é—´æˆ³ï¼Œè¿™ä¸ªæ—¶é—´å¯ä»¥è¡¨ç¤ºåˆ° 2038-01-19 03:14:07 UTC çš„æ—¶é—´ã€‚
å¾ˆå¤šçš„ç³»ç»Ÿæ”¯æŒæ›´å®½çš„æ—¶é—´æˆ³èŒƒå›´ï¼ŒåŒ…æ‹¬è´Ÿçš„æ—¶é—´æˆ³ï¼Œä»¥è¡¨ç¤º epoch ä¹‹é—´çš„æ—¶é—´ã€‚

@cindex @command{date} utility, GNU
@cindex time, retrieving
ä¸ºäº†æ›´å®¹æ˜“å¤„ç†è¿™æ ·çš„å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—æ–‡ä»¶å¹¶ä¸”äº§ç”Ÿæœ‰ç”¨çš„æŠ¥è¡¨ï¼Œ@command{gawk} æä¾›äº†ä¸‹é¢çš„å‡½æ•°æ¥å¤„ç†æ—¶é—´æˆ³ã€‚å®ƒä»¬éƒ½æ˜¯ @command{gawk} çš„æ‰©å±•ï¼Œå¹¶æ²¡æœ‰åœ¨ POSIX æ ‡å‡†ä¸­æŒ‡å®šã€‚
@footnote{GNU çš„ @command{date} å·¥å…·ä¹Ÿå¯ä»¥åšè¿™é‡Œæ‰€æè¿°çš„å¾ˆå¤šçš„äº‹æƒ…ã€‚å¦‚æœåœ¨ Shell ä¸­å¤„ç†çš„æ˜¯ç®€å•çš„ä¸æ—¶é—´æœ‰å…³çš„æ“ä½œï¼Œåˆ™å¯ä¼˜å…ˆä½¿ç”¨å®ƒã€‚}
ä½†æ˜¯ï¼Œ@command{mawk} çš„æ–°è¿‘çš„ç‰ˆæœ¬ï¼ˆæŸ¥çœ‹ @pxref{Other Versions}ï¼‰ä¹Ÿæ”¯æŒè¿™äº›å‡½æ•°ã€‚å¯é€‰çš„å‚æ•°è¢«åŒ…å«åœ¨æ–¹æ‹¬å·ä¸­ï¼ˆ[ ]ï¼‰ï¼š

@c @asis for docbook
@table @asis
@item @code{mktime(@var{datespec})}
@cindexgawkfunc{mktime}
@cindex generate time values
å°† @var{datespec} è½¬æ¢ä¸ºä¸ @code{systime()} è¿”å›çš„ç›¸åŒæ ¼å¼çš„æ—¶é—´æˆ³ã€‚å®ƒä¸åœ¨ ISO C ä¸­åŒåçš„å‡½æ•°ç›¸ä¼¼ã€‚
@var{datespec} å‚æ•°æ˜¯ä¸€ä¸ª @w{@code{"@var{YYYY} @var{MM} @var{DD} @var{HH} @var{MM} @var{SS} [@var{DST}]"}} æ ¼å¼çš„å­—ä¸²ã€‚
å­—ä¸²åŒ…å« 6 ä¸ªæˆ–è€… 7 ä¸ªæ•°å­—ï¼Œä»¥ç›¸åº”åœ°è¡¨ç¤ºå¹´çš„å…¨çš„ä¸–çºªå¹´ï¼Œä» 1 åˆ° 12 çš„æœˆï¼Œ1 åˆ° 31 çš„æ—¥ï¼Œä¸€å¤©ä¸­ä» 0 åˆ° 23 çš„å°æ—¶ï¼Œ0 åˆ° 59 åˆ†é’Ÿï¼Œ0 åˆ° 60 ç§’ï¼Œ@footnote{åœ¨å¶å°”çš„æƒ…å†µä¸‹ï¼Œä¸€å¹´ä¸­æœ‰å‡ åˆ†é’Ÿä¼šæœ‰æ¶¦ç§’ï¼Œå› æ­¤ç§’æ•°å¯ä»¥åˆ° 60ã€‚}
ä»¥åŠä¸€ä¸ªå¯é€‰çš„å¤ä»¤æ—¶æ ‡å¿—ã€‚

è¿™äº›æ•°å­—çš„å€¼ä¸æ˜¯å¿…é¡»åœ¨æ‰€æŒ‡å®šçš„èŒƒå›´å†…ï¼Œä¾‹å¦‚ @minus{}1 å°æ—¶è¡¨æ—¶åˆå¤œå‰çš„ 1 å°æ—¶ã€‚åˆå§‹çš„æ ¼æ—æ—¥å†çš„ 0 ä¸ºå§‹ï¼Œ0 å¹´è¡¨ç¤º 1 å¹´ä¹‹å‰ï¼Œè€Œ @minus{}1 å¹´è¡¨ç¤ºåœ¨ 0 å¹´å‰ã€‚æ—¶é—´ä¹Ÿå¯ä»¥å‡è®¾ä¸ºæœ¬åœ°æ—¶é—´ã€‚å¦‚æœå¤ä»¤æ—¶æ ‡å¿—ä¸ºæ­£ï¼Œåˆ™æ—¶é—´å‡è®¾ä¸ºå¤ä»¤æ—¶æ—¶é—´ï¼Œå¦‚æœä¸º 0ï¼Œåˆ™æ—¶é—´å‡è®¾ä¸ºæ ‡å‡†æ—¶é—´ï¼Œå¦‚æœä¸ºè´Ÿï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œ@code{mktime()} ä¼šè¯•å›¾ç¡®å®šç‰¹å®šçš„æ—¶é—´æ˜¯å¦æ˜¯å¤ä»¤æ—¶æ—¶é—´ã€‚

å¦‚æœ @var{datespec} æ²¡æœ‰åŒ…å«è¶³å¤Ÿçš„å…ƒç´ æˆ–è€…ç»“æœçš„æ—¶é—´è¶…å‡ºäº†èŒƒå›´ï¼Œ@code{mktime()} è¿”å› @minus{}1 ã€‚

@cindex @command{gawk}, @code{PROCINFO} array in
@cindex @code{PROCINFO} array
@item @code{strftime(}[@var{format} [@code{,} @var{timestamp} [@code{,} @var{utc-flag}] ] ]@code{)}
@cindexgawkfunc{strftime}
@cindex format time string
æ ¹æ®å­—ä¸²æ ¼å¼ @var{format} çš„å†…å®¹ï¼Œå°†æŒ‡å®šçš„æ—¶é—´æˆ³ @var{timestamp} è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶è¿”å›ç»“æœã€‚è¿™ä¸ ISO C ä¸­åŒåçš„å‡½æ•°çš„åŠŸèƒ½ç±»ä¼¼ã€‚å¦‚æœæä¾›äº† @var{utc-flag} å‚æ•°ï¼Œå¹¶ä¸”æ˜¯é 0ï¼Œæˆ–è€…éç©ºï¼Œåˆ™å€¼ä¼šæ ¼å¼åŒ–ä¸º UTCï¼ˆç»Ÿä¸€åè°ƒæ—¶é—´ï¼Œä¹‹å‰ä¸º GMTï¼Œæ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ï¼‰ã€‚å¦åˆ™ï¼Œå€¼å°†è¢«æ ¼å¼åŒ–ä¸ºæœ¬åœ°æ—¶åŒºæ—¶é—´ã€‚@var{timestamp} çš„æ ¼å¼ä¸ @code{systime()} è¿”å›çš„å€¼çš„æ ¼å¼ä¸€æ ·ã€‚
å¦‚æœæ²¡æœ‰æŒ‡å®š @var{timestamp} å‚æ•°ï¼Œ@command{gawk} åˆ™ä½¿ç”¨å½“å¤©çš„å½“æ—¶æ—¶é—´ä½œä¸º @var{timestamp}ã€‚å¦‚æœæ²¡æœ‰æ ¼å¼å‚æ•°ï¼Œ@code{strftime()} åˆ™ä½¿ç”¨ @code{PROCINFO["strftime"]} çš„å€¼ä½œä¸ºæ ¼å¼å­—ä¸²ï¼ˆæŸ¥çœ‹ @ref{Built-in Variables}ï¼‰ã€‚
é»˜è®¤çš„å­—ä¸²å€¼ä¸º @code{@w{"%a %b %e %H:%M:%S %Z %Y"}}ã€‚è¿™ä¸ªæ ¼å¼å­—ä¸²äº§ç”Ÿçš„è¾“å‡ºä¸ @command{date} å·¥å…·äº§ç”Ÿçš„è¾“å‡ºä¸€æ ·ã€‚ä½ å¯ä»¥ç»™ @code{PROCINFO["strftime"]} èµ‹ä¸€ä¸ªæ–°å€¼ï¼Œä»¥æ”¹å˜é»˜è®¤æ ¼å¼ï¼ŒæŸ¥çœ‹ä¸‹é¢çš„åˆ—è¡¨æ¥è·å–æ ¼å¼æŒ‡ç¤ºç¬¦ã€‚

@item @code{systime()}
@cindexgawkfunc{systime}
@cindex timestamps
@cindex current system time
è¿”å›ä»ç³»ç»Ÿ epoch å¼€å§‹å½“å‰æ—¶é—´çš„ç§’æ•°ã€‚åœ¨ POSIX ç³»ç»Ÿä¸­ï¼Œè¿™æ˜¯ä» 1970-01-01 00:00:00 UTC å¼€å§‹çš„ç§’æ•°ï¼Œä¸åŒ…å«æ¶¦ç§’ã€‚åœ¨å…¶ä»–ç³»ç»Ÿä¸­å¯èƒ½æ˜¯ä¸åŒçš„å€¼ã€‚
@end table

@code{systime()} å‡½æ•°å¯ä»¥è®©ä½ æ¯”è¾ƒæ—¥å¿—æ–‡ä»¶çš„æ—¶é—´æˆ³ä¸å½“å‰çš„æ—¶é—´ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¾ˆå®¹æ˜“ç¡®å®šç›¸åº”çš„è®°å½•æ˜¯å¤šä¹…ä¹‹å‰è®°å½•çš„ã€‚å®ƒä¹Ÿå¯ä»¥è®©ä½ ç”¨ä» epoch å¼€å§‹æ ¼å¼çš„æ—¶é—´æ¥äº§ç”Ÿæ—¥å¿—è®°å½•ã€‚

@cindex converting, dates to timestamps
@cindex dates, converting to timestamps
@cindex timestamps, converting dates to
@code{mktime()} å‡½æ•°å¯ä»¥è®©ä½ å°†æ–‡æœ¬å½¢å¼çš„æ—¥æœŸä¸æ—¶é—´çš„è¡¨ç¤ºè½¬æ¢ä¸ºä¸€ä¸ªæ—¶é—´æˆ³ã€‚å› æ­¤å¾ˆå®¹æ˜“æ¥ä½œæ—¥æœŸä¸æ—¶é—´çš„å‰åæ¯”è¾ƒï¼Œå°¤å…¶æ˜¯å½“å¤„ç†çš„æ—¥æœŸä¸æ—¶é—´æ•°æ®æ¥è‡ªäºå¤–éƒ¨ï¼Œæ¯”å¦‚ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ã€‚

@code{strftime()} å‡½æ•°å¯ä»¥è®©ä½ å¾ˆå®¹æ˜“å°†ä¸€ä¸ªæ—¶é—´æˆ³è½¬æ¢æˆä¸€ä¸ªäººå¯è¯»çš„ä¿¡æ¯ã€‚è¿™æœ‰ç‚¹åƒ @code{printf} å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰çš„ç‰¹ç‚¹ä¸€æ ·ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­å°†éæ ¼å¼åŒ–çš„èŒƒå›´å­—ç¬¦ä¸€å­—ä¸å˜åœ°åŠ å…¥åˆ°è¿”å›ä¸²ä¸­ã€‚å°†æ—¥æœŸä¸æ—¶é—´å€¼æ›¿æ¢ä¸ºæ ¼å¼ä¸² @var{format} ä¸­æ‰€æŒ‡å®šçš„æ ¼å¼è§„èŒƒã€‚

@cindex format specifiers, @code{strftime()} function (@command{gawk})
@code{strftime()} ä½¿ç”¨çš„æ˜¯ 1999 ISO C çš„æ ‡å‡†ï¼Œ
@footnote{ä¸å¹¸çš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿçš„ @code{strftime()} éƒ½å¿…é¡»æ”¯æŒè¿™é‡Œæ‰€åˆ—çš„æ‰€æœ‰è½¬æ¢ã€‚}
å¯ä»¥æ”¯æŒä¸‹é¢çš„æ—¥æœŸæ ¼å¼è§„èŒƒï¼š

@table @code
@item %a
æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­ç¼©å†™çš„æ˜ŸæœŸåã€‚

@item %A
æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­çš„å®Œæ•´çš„æ˜ŸæœŸåã€‚

@item %b
æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­ç¼©å†™çš„æœˆä»½åã€‚

@item %B
æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­å®Œæ•´çš„æœˆä»½åã€‚

@item %c
æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­â€œæ°å½“çš„â€æ—¥æœŸä¸æ—¶é—´è¡¨ç¤ºã€‚ï¼ˆè¿™åœ¨ @code{"C"} è¯­è¨€è®¾ç½®ä¸­ä¸º @samp{%A %B %d %T %Y}ï¼‰

@item %C
å½“å‰å¹´çš„ä¸–çºªéƒ¨åˆ†ã€‚è¿™æ˜¯å¹´é™¤ä»¥ 100ï¼Œå¹¶å‘ä¸‹æ•´æ•°è¿›è¡Œæˆªå–å¾—åˆ°çš„æ•°å€¼ã€‚

@item %d
æœˆä¸­çš„ 10 è¿›åˆ¶æ—¥æœŸï¼ˆ01-31ï¼‰ã€‚

@item %D
ä¸æŒ‡å®š @samp{%m/%d/%y} ç›¸åŒã€‚

@item %e
æœˆä¸­çš„æ—¥æœŸï¼Œå¦‚æœåªæœ‰ä¸€ä½ï¼Œåˆ™è¿›è¡Œç©ºæ ¼è¡¥å…¨ã€‚

@item %F
ä¸æŒ‡å®š @samp{%Y-%m-%d} ç­‰åŒã€‚è¿™æ˜¯ ISO 8601 çš„æ ¼å¼ã€‚

@item %g
ISO 8601 æ ‡å‡†ä¸­å¹´ä¸ 100 çš„æ¨¡çš„å‘¨æ•°å€¼ï¼Œæ ¼å¼ä¸ºåè¿›åˆ¶æ•°ï¼ˆ00-99ï¼‰ã€‚ä¾‹å¦‚ï¼Œ2012 å¹´çš„ 1 æœˆ 1 æ—¥ï¼Œ æ˜¯ 2011 å¹´çš„ 53 å‘¨ã€‚å› æ­¤ï¼Œå¹´åœ¨ ISO 8601 ä¸­çš„å‘¨æ•°åœ¨ 2011 å¹´ï¼Œå°±ç®—å¹´å·²ç»æ˜¯ 2012 å¹´äº†ã€‚ç›¸ä¼¼çš„ï¼Œ2012 å¹´ 12 æœˆ 31 æ—¥æ˜¯ 2013 å¹´çš„ç¬¬ 1 å‘¨ã€‚æ‰€ä»¥ï¼Œå¹´çš„ ISO å‘¨æ˜¯ 2013 å¹´ï¼Œå°±ç®—å¹´è¿˜æ˜¯ 2012 å¹´ã€‚

@item %G
ISO å‘¨æ•°çš„å®Œæ•´å¹´ï¼Œä¸ºåè¿›åˆ¶æ•°ã€‚

@item %h
ä¸ @samp{%b} ç­‰åŒã€‚

@item %H
åè¿›åˆ¶çš„å°æ—¶ï¼ˆ24 å°æ—¶åˆ¶ï¼Œ00-23ï¼‰ã€‚

@item %I
åè¿›åˆ¶çš„å°æ—¶ï¼ˆ12 å°æ—¶åˆ¶ï¼Œ01-12 ï¼‰ã€‚

@item %j
ä¸€å¹´ä¸­çš„å¤©æ•°çš„åè¿›åˆ¶æ•°ï¼ˆ001-366ï¼‰ã€‚

@item %m
æœˆä»½çš„åè¿›åˆ¶æ•°ï¼ˆ01-12ï¼‰ã€‚

@item %M
åˆ†é’Ÿçš„åè¿›åˆ¶æ•°ï¼ˆ00-59ï¼‰ã€‚

@item %n
æ¢è¡Œç¬¦ï¼ˆASCII LFï¼‰ã€‚

@item %p
ä¸æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­ AM/PM çš„ç­‰åŒï¼Œä¸ 12 å°æ—¶é—´åˆ¶å…³è”çš„è¡¨ç¤ºæ³•ã€‚

@item %r
æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­ 12 å°æ—¶åˆ¶çš„æ—¶é’Ÿæ—¶é—´ã€‚ï¼ˆè¿™åœ¨ @code{"C"} è¯­è¨€è®¾ç½®ä¸­ä¸º @samp{%I:%M:%S %p}ã€‚ï¼‰

@item %R
ä¸ @samp{%H:%M} ç­‰åŒã€‚

@item %S
åè¿›åˆ¶çš„ç§’æ•°ï¼ˆ00-60ï¼‰ã€‚

@item %t
TAB å­—ç¬¦ã€‚

@item %T
ä¸ @samp{%H:%M:%S} ç­‰åŒã€‚

@item %u
åè¿›åˆ¶çš„æ˜ŸæœŸæ•°ï¼ˆ1-7ï¼‰ã€‚æ˜ŸæœŸä¸€ä¸º 1ã€‚

@item %U
ä¸€å¹´ä¸­çš„åè¿›åˆ¶çš„å‘¨æ•°ï¼ˆ0-53ï¼Œç¬¬ä¸€ä¸ªæ˜ŸæœŸæ—¥ä½œä¸ºç¬¬ä¸€å‘¨çš„ç¬¬ä¸€å¤©ï¼‰ã€‚

@c @cindex ISO 8601
@item %V
ä¸€å¹´ä¸­çš„åè¿›åˆ¶çš„å‘¨æ•°ï¼ˆ01-53ï¼Œç¬¬ä¸€ä¸ªæ˜ŸæœŸä¸€ä½œä¸ºç¬¬ä¸€å‘¨çš„ç¬¬ä¸€å¤©ï¼‰ã€‚ç¡®å®šå‘¨æ•°çš„æ–¹æ³•ç”± ISO 8601 ä¸­æ‰€æŒ‡å®šçš„ä¸€æ ·ã€‚ï¼ˆå³ï¼šå¦‚æœåŒ…å« 1 æœˆ 1 æ—¥æ˜ŸæœŸä¸­æœ‰åœ¨æ–°çš„ä¸€å¹´ä¸­æœ‰ 4 å¤©ï¼Œæˆ–è€…æ›´å¤šçš„å¤©æ•°ï¼Œåˆ™å°±æ˜¯ç®—æˆä¸€å‘¨ï¼Œå¦åˆ™å‰ä¸€å¹´å°±æ˜¯ 53 å‘¨ï¼Œä¸‹ä¸€å‘¨å°±ç®—æˆç¬¬ä¸€å‘¨ã€‚ï¼‰

@item %w
åè¿›åˆ¶çš„æ˜ŸæœŸå‡ ï¼ˆ0-6ï¼‰ã€‚æ˜ŸæœŸå¤©æ˜¯ 0 å¤©ã€‚

@item %W
ä¸€å¹´çš„å‘¨æ•°ï¼ˆ00-53ï¼Œç¬¬ä¸€ä¸ªæ˜ŸæœŸä¸€ä½œä¸ºç¬¬ä¸€å‘¨çš„ç¬¬ä¸€å¤©ï¼‰ã€‚

@item %x
æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­â€œæ°å½“çš„â€æ—¥æœŸè¡¨ç¤ºã€‚ï¼ˆå¯¹äº @code{"C"} çš„è¯­è¨€è®¾ç½®åˆ™ä¸º @samp{%A %B %d %Y} ã€‚ï¼‰

@item %X
æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­â€œæ°å½“çš„â€æ—¶é—´è¡¨ç¤ºã€‚ï¼ˆå¯¹äº @code{"C"} çš„è¯­è¨€è®¾ç½®åˆ™ä¸º @samp{%T} ã€‚ï¼‰

@item %y
å¹´ä¸ 100 çš„æ¨¡çš„åè¿›åˆ¶æ•°ï¼ˆ00-99ï¼‰ã€‚

@item %Y
å¹´çš„åè¿›åˆ¶å…¨å†™ï¼ˆå¦‚ 2015 ï¼‰ã€‚

@c @cindex RFC 822
@c @cindex RFC 1036
@item %z
æ—¶åŒºå·®ï¼Œç”¨ @samp{+@var{HHMM}} æ ¼å¼è¡¨ç¤ºï¼ˆå³æ ¼å¼éœ€è¦äº§ç”Ÿ RFC 822/RFC 1036 çš„æ—¥æœŸå¤´ï¼‰ã€‚

@item %Z
æ—¶åŒºåæˆ–è€…æ˜¯å…¶ç¼©å†™ï¼Œå¦‚æœæ—¶åŒºä¸èƒ½ç¡®å®šåˆ™æ²¡æœ‰å­—ç¬¦ã€‚

@item %Ec %EC %Ex %EX %Ey %EY %Od %Oe %OH
@itemx %OI %Om %OM %OS %Ou %OU %OV %Ow %OW %Oy
åœ¨è§„èŒƒä¸­åªä½¿ç”¨ç¬¬äºŒä¸ªå­—ç¬¦çš„â€œæ›¿ä»£è¡¨ç¤ºâ€ï¼ˆ@samp{%c}ï¼Œ@samp{%C}ï¼Œç­‰ç­‰ï¼‰ã€‚
@footnote{å¦‚æœä½ ä¸ç†è§£è¿™ä¸ªï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œè¿™ä¸ªè®¾æ–½ä¸»è¦ç”¨äºæ–¹ä¾¿å®ç° â€œå›½é™…åŒ–â€ ç¨‹åºã€‚å…¶ä»–çš„å›½é™…åŒ–ç‰¹æ€§åœ¨ @ref{Internationalization}ï¼Œè¿™é‡Œæè¿°ã€‚}
ï¼ˆè¿™ä¸ªè®¾æ–½æ˜¯ä¸ POSIX çš„ @command{date} å·¥å…·å…¼å®¹çš„ã€‚ï¼‰

@item %%
A literal @samp{%}.
@end table

å¦‚æœè½¬æ¢æŒ‡å®šç¬¦ä¸æ˜¯ä¸Šé¢æ‰€åˆ—ä¹‹ä¸€ï¼Œè¡Œä¸ºå°±æ˜¯æœªå®šä¹‰çš„ã€‚ 
@footnote{è¿™æ˜¯å› ä¸º ISO C å°† C ç‰ˆæœ¬çš„ @code{strftime()} ä¿ç•™å…¶è¡Œä¸ºä¸ºæœªå®šä¹‰çš„ï¼Œ@command{gawk} å°±ä½¿ç”¨å…¶æ‰€åœ¨ç³»ç»Ÿçš„ @code{strftime()} çš„ç‰ˆæœ¬ã€‚å…¸å‹çš„æƒ…å†µä¸‹ï¼Œè½¬æ¢æŒ‡å®šç¬¦è¦ä¹ˆä¸ä¼šå‡ºç°åœ¨è¿”å›çš„å­—ä¸²é‡Œï¼Œè¦ä¹ˆå°±ä»¥è¿™é¢çš„æ–¹å¼å‡ºç°ã€‚}

å¯¹äºæ²¡æœ‰å®Œå…¨ä¸æ ‡å‡†å…¼å®¹çš„ç³»ç»Ÿï¼Œ@command{gawk} æä¾›ä¸€ä¸ªæ¥è‡ªäº GNU C åº“çš„ @code{strftime()} çš„ä¸€ä¸ªå¤æœ¬ã€‚å®ƒæ”¯æŒä¸Šé¢æ‰€åˆ—çš„æ‰€æœ‰æ ¼å¼æŒ‡å®šç¬¦ã€‚å¦‚æœé‚£ä¸ªç‰ˆæœ¬ç”¨äºç¼–è¯‘ @command{gawk} ï¼ˆæŸ¥çœ‹ @pxref{Installation}ï¼‰ï¼Œåˆ™ä¸‹é¢çš„é¢å¤–çš„æ ¼å¼æŒ‡å®šç¬¦ä¹Ÿå¯ç”¨ï¼š

@table @code
@item %k
24 å°æ—¶åˆ¶çš„åè¿›åˆ¶å°æ—¶ï¼ˆ0-23ï¼‰ã€‚ä¸€ä¸ªä½çš„æ•°å€¼ä¼šç”¨ç©ºæ ¼è¿›è¡Œå¡«è¡¥ã€‚

@item %l
12 å°æ—¶åˆ¶çš„åè¿›åˆ¶å°æ—¶ï¼ˆ1-12ï¼‰ã€‚ä¸€ä¸ªä½çš„æ•°å€¼ä¼šç”¨ç©ºæ ¼è¿›è¡Œå¡«è¡¥ã€‚

@ignore
@item %N
The ``Emperor/Era'' name.
Equivalent to @samp{%C}.

@item %o
The ``Emperor/Era'' year.
Equivalent to @samp{%y}.
@end ignore

@item %s
åè¿›åˆ¶çš„æ—¶é—´æˆ³ï¼Œä» epoch å¼€å§‹çš„ç§’æ•°ã€‚

@ignore
@item %v
The date in VMS format (e.g., @samp{20-JUN-1991}).
@end ignore
@end table

å¦å¤–ï¼Œæ›¿ä»£çš„è¡¨ç¤ºå¯ä»¥è¢«è¯†åˆ«åˆ°ï¼Œä½†æ˜¯åªä½¿ç”¨å®ƒä»¬çš„å¸¸è§„è¡¨ç¤ºã€‚

@cindex @code{date} utility, POSIX
@cindex POSIX @command{awk}, @code{date} utility and
ä¸‹é¢çš„ä¾‹å­æ˜¯ POSIX @command{date} å·¥å…·çš„ @command{awk} å®ç°ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œ@command{date} å·¥å…·ä»¥ä¸€ç§å¤§å®¶éƒ½äº†è§£çš„æ ¼å¼æ‰“å°å½“å‰çš„æ—¥æœŸä¸æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æä¾›äº†å‰é¢å¸¦ @samp{+} çš„å‚æ•°ï¼Œ@command{date} åˆ™ä¼šå¤æ‚éæ ¼å¼æŒ‡å®šç¬¦åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼Œå¹¶ä¸”æŒ‰ç…§ä¸²ä¸­æ‰€æ ¼å¼æŒ‡å®šç¬¦æ¥è§£é‡Šå½“å‰çš„æ—¶é—´ã€‚å¦‚ï¼š

@example
$ @kbd{date '+Today is %A, %B %d, %Y.'}
@print{} Today is Monday, September 22, 2014.
@end example

ä¸‹é¢æ˜¯ @command{gawk} ç‰ˆæœ¬çš„ @command{date} å·¥å…·ã€‚å®ƒæœ‰ä¸€ä¸ªå£³ä¸ºâ€œwrapperâ€æ¥å¤„ç† @option{-u} é€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹è¦æ±‚ @command{date} è¿è¡Œæ—¶å‡è®¾æ—¶åŒºæ˜¯ UTCï¼š

@example
#! /bin/sh
#
# date --- approximate the POSIX 'date' command

case $1 in
-u)  TZ=UTC0     # use UTC
     export TZ
     shift ;;
esac

gawk 'BEGIN  @{
    format = PROCINFO["strftime"]
    exitval = 0

    if (ARGC > 2)
        exitval = 1
    else if (ARGC == 2) @{
        format = ARGV[1]
        if (format ~ /^\+/)
            format = substr(format, 2)   # remove leading +
    @}
    print strftime(format)
    exit exitval
@}' "$@@"
@end example

@node Bitwise Functions
@subsection ä½æ“ä½œå‡½æ•°
@cindex bit-manipulation functions
@cindex bitwise, operations
@cindex AND bitwise operation
@cindex OR bitwise operation
@cindex XOR bitwise operation
@cindex operations, bitwise
@quotation
@i{
æˆ‘å¯ä»¥å‘ä½ è§£é‡Šï¼Œä½†æ˜¯æ²¡åŠæ³•å¸®ä½ ç†è§£ã€‚
}
@author Anonymous
@end quotation

å¾ˆå¤šçš„è¯­è¨€æä¾›äº†åœ¨ä¸¤ä¸ªæ•´æ•°ä¹‹é—´æ‰§è¡Œ@dfn{ä½}æ“ä½œçš„èƒ½åŠ›ã€‚æ¢å¥è¯è¯´ï¼Œæ“ä½œåœ¨ä¸¤ä¸ªåœ¨æ“ä½œæ•°ä¸Šçš„è¿ç»­ä½å¯¹è¿›è¡Œæ“ä½œã€‚ä¸‰ä¸ªå¸¸ç”¨çš„æ“ä½œä¸ºæŒ‰ä½ ANDï¼ŒOR ä¸ XORã€‚æ“ä½œåœ¨ @ref{table-bitwise-ops} ä¸­æè¿°ã€‚

@c 11/2014: Postprocessing turns the docbook informaltable
@c into a table. Hurray for scripting!
@float Table,table-bitwise-ops
@caption{ä½æ“ä½œ}
@ifnottex
@ifnotdocbook
@display
                ä½æ“ä½œç¬¦
          |  AND  |   OR  |  XOR
          |---+---+---+---+---+---
æ“ä½œæ•°  | 0 | 1 | 0 | 1 | 0 | 1
----------+---+---+---+---+---+---
    0     | 0   0 | 0   1 | 0   1
    1     | 0   1 | 1   1 | 1   0
@end display
@end ifnotdocbook
@end ifnottex
@tex
\centerline{
\vbox{\bigskip % space above the table (about 1 linespace)
% Because we have vertical rules, we can't let TeX insert interline space
% in its usual way.
\offinterlineskip
\halign{\strut\hfil#\quad\hfil  % operands
        &\vrule#&\quad#\quad    % rule, 0 (of and)
        &\vrule#&\quad#\quad    % rule, 1 (of and)
        &\vrule#                % rule between and and or
        &\quad#\quad            % 0 (of or)
        &\vrule#&\quad#\quad    % rule, 1 (of of)
        &\vrule#                % rule between or and xor
        &\quad#\quad            % 0 of xor
        &\vrule#&\quad#\quad    % rule, 1 of xor
        \cr
&\omit&\multispan{11}\hfil\bf Bit operator\hfil\cr
\noalign{\smallskip}
&     &\multispan3\hfil AND\hfil&&\multispan3\hfil  OR\hfil
                           &&\multispan3\hfil XOR\hfil\cr
\bf Operands&&0&&1&&0&&1&&0&&1\cr
\noalign{\hrule}
\omit&height 2pt&&\omit&&&&\omit&&&&\omit\cr
\noalign{\hrule height0pt}% without this the rule does not extend; why?
0&&0&\omit&0&&0&\omit&1&&0&\omit&1\cr
1&&0&\omit&1&&1&\omit&1&&1&\omit&0\cr
}}}
@end tex

@docbook
<informaltable>

<tgroup cols="7" colsep="1">
<colspec colname="c1"/>
<colspec colname="c2"/>
<colspec colname="c3"/>
<colspec colname="c4"/>
<colspec colname="c5"/>
<colspec colname="c6"/>
<colspec colname="c7"/>
<spanspec spanname="optitle" namest="c2" nameend="c7" align="center"/>
<spanspec spanname="andspan" namest="c2" nameend="c3" align="center"/>
<spanspec spanname="orspan" namest="c4" nameend="c5" align="center"/>
<spanspec spanname="xorspan" namest="c6" nameend="c7" align="center"/>

<tbody>
<row>
<entry colsep="0"></entry>
<entry spanname="optitle"><emphasis role="bold">Bit operator</emphasis></entry>
</row>

<row rowsep="1">
<entry rowsep="0"></entry>
<entry spanname="andspan">AND</entry>
<entry spanname="orspan">OR</entry>
<entry spanname="xorspan">XOR</entry>
</row>

<row rowsep="1">
<entry ><emphasis role="bold">Operands</emphasis></entry>
<entry colsep="0">0</entry>
<entry colsep="1">1</entry>
<entry colsep="0">0</entry>
<entry colsep="1">1</entry>
<entry colsep="0">0</entry>
<entry colsep="1">1</entry>
</row>

<row>
<entry align="center">0</entry>
<entry colsep="0">0</entry>
<entry>0</entry>
<entry colsep="0">0</entry>
<entry>1</entry>
<entry colsep="0">0</entry>
<entry>1</entry>
</row>

<row>
<entry align="center">1</entry>
<entry colsep="0">0</entry>
<entry>1</entry>
<entry colsep="0">1</entry>
<entry>1</entry>
<entry colsep="0">1</entry>
<entry>0</entry>
</row>

</tbody>
</tgroup>
</informaltable>
@end docbook
@end float

@cindex bitwise, complement
@cindex complement, bitwise
å¦‚ä½ æ‰€è§ï¼ŒAND æ“ä½œçš„ç»“æœæ˜¯åªæœ‰å½“ä¸¤ä¸ªä½@emph{éƒ½}ä¸º 1 æ—¶æ‰ä¸º 1ã€‚OR çš„æ“ä½œç»“æœæ˜¯å½“ä¸¤ä¸ªä½@emph{æœ‰ä¸€ä¸ª}ä¸º 1 åˆ™ä¸º 1ã€‚
XOR çš„æ“ä½œç»“æœæ˜¯æœ‰ä¸€ä¸ªä½ 1 åˆ™ä¸º 1ï¼Œä½†ä¸èƒ½ä¸¤ä¸ªéƒ½ä¸º 1ã€‚ä¸‹ä¸€ä¸ªå‚æ•°æ˜¯@dfn{â€œè¡¥â€}ï¼ˆå–åï¼‰ï¼Œ1 çš„è¡¥ä¸º 0ï¼Œ0 çš„è¡¥ä¸º 1ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ“ä½œâ€œç¿»è½¬â€æ‰€ç»™å€¼çš„æ‰€æœ‰ä½ã€‚

@cindex bitwise, shift
@cindex left shift, bitwise
@cindex right shift, bitwise
@cindex shift, bitwise
æœ€åï¼Œè¿˜æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„æ“ä½œå°†ä½ä»å·¦æˆ–è€…ä»å³è¿›è¡Œå¹³ç§»ã€‚å¦‚ï¼Œå¦‚æœä½ æœ‰å€¼ä¸² @samp{10111001}ï¼Œç„¶åä½ å°†å®ƒå‘å³å¹³ç§» 3 ä½ï¼Œæœ€ç»ˆå¾—åˆ°çš„å€¼ä¸º @samp{00010111}ã€‚
@footnote{è¿™ä¸ªä¾‹å­æ˜¾ç¤ºåœ¨å·¦è¾¹ä¼šç”¨ 0 è¿›è¡Œå¡«è¡¥ã€‚å¯¹äº @command{gawk}ï¼Œè¿™æ€»æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯åœ¨å…¶ä»–è¯­è¨€ä¸­ï¼Œæœ‰å¯èƒ½ä¼šç”¨ 1 è¿›è¡Œå¡«è¡¥ã€‚}
å¦‚æœä½ åˆç”¨åŒæ ·çš„å€¼ @samp{10111001} è¿›è¡Œå·¦ç§»ä¸‰ä½ï¼Œåˆ™å¾—åˆ° @samp{11001000}ã€‚ä¸‹é¢çš„åˆ—è¡¨ä¸­æè¿°äº† @command{gawk} ä¸­å†…å»ºçš„å®ç°ä½æ“ä½œçš„å‡½æ•°ã€‚å¯é€‰çš„å‚æ•°åŒ…å«åœ¨æ–¹æ‹¬å·ä¸­ï¼ˆ[ ]ï¼‰ï¼š

@cindex @command{gawk}, bitwise operations in
@table @code
@cindexgawkfunc{and}
@cindex bitwise AND
@item @code{and(}@var{v1}@code{,} @var{v2} [@code{,} @dots{}]@code{)}
è¿”å›å‚æ•°çš„ AND ç»“æœã€‚è‡³å°‘æœ‰ä¸¤ä¸ªå‚æ•°ã€‚

@cindexgawkfunc{compl}
@cindex bitwise complement
@item @code{compl(@var{val})}
è¿”å› @var{val} çš„ä½â€œè¡¥â€ç»“æœã€‚

@cindexgawkfunc{lshift}
@cindex left shift
@item @code{lshift(@var{val}, @var{count})}
 è¿”å› @var{val} å·¦ç§» @var{count} ä½çš„å€¼ã€‚

@cindexgawkfunc{or}
@cindex bitwise OR
@item @code{or(}@var{v1}@code{,} @var{v2} [@code{,} @dots{}]@code{)}
è¿”å›å‚æ•°çš„ OR ç»“æœã€‚è‡³å°‘æœ‰ä¸¤ä¸ªå‚æ•°ã€‚

@cindexgawkfunc{rshift}
@cindex right shift
@item @code{rshift(@var{val}, @var{count})}
è¿”å› @var{val} å³ç§» @var{count} ä½çš„å€¼ã€‚

@cindexgawkfunc{xor}
@cindex bitwise XOR
@item @code{xor(}@var{v1}@code{,} @var{v2} [@code{,} @dots{}]@code{)}
è¿”å›å‚æ•°çš„ XOR ç»“æœã€‚è‡³å°‘æœ‰ä¸¤ä¸ªå‚æ•°ã€‚
@end table

å¯¹æ‰€æœ‰è¿™äº›å‡½æ•°ï¼Œäº§ç”ŸåŒç²¾åº¦çš„æµ®ç‚¹æ•°ä¼šè¢«è½¬æ¢ä¸ºæœ€å®½çš„ C çš„æ— ç¬¦å·æ•´æ•°ï¼Œç„¶åå†æ‰§è¡Œä½æ“ä½œã€‚å¦‚æœç»“æœä¸èƒ½è¢« C çš„ @code{double} ç²¾ç¡®è¡¨ç¤ºï¼Œå…¶å‰å¯¼çš„éé›¶ä½ä¼šä¸€ä½ä½åœ°ç§»é™¤ï¼Œç›´åˆ°å¯ä»¥è¢«ç²¾ç¡®è¡¨ç¤ºã€‚ç»“æœå†è½¬æ¢åŠ  @code{double} ç±»å‹ã€‚ï¼ˆå¦‚æœä½ ä¸ç†è§£è¿™ä¸ªè½¬æ¢å›¾ï¼Œä¹Ÿä¸è¦æ‹…å¿ƒã€‚ï¼‰

è¿™é‡Œæ˜¯ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{User-defined}ï¼‰ï¼Œå…¶ä¸­è§£é‡Šäº†è¿™äº›å‡½æ•°çš„ä½¿ç”¨ï¼š

@cindex @code{bits2str()} user-defined function
@cindex @code{testbits.awk} program
@example
@group
@c file eg/lib/bits2str.awk
# bits2str --- turn a byte into readable ones and zeros

function bits2str(bits,        data, mask)
@{
    if (bits == 0)
        return "0"

    mask = 1
    for (; bits != 0; bits = rshift(bits, 1))
        data = (and(bits, mask) ? "1" : "0") data

    while ((length(data) % 8) != 0)
        data = "0" data

    return data
@}
@c endfile
@end group

@c this is a hack to make testbits.awk self-contained
@ignore
@c file eg/prog/testbits.awk
# bits2str --- turn a byte into readable 1's and 0's

function bits2str(bits,        data, mask)
@{
    if (bits == 0)
        return "0"

    mask = 1
    for (; bits != 0; bits = rshift(bits, 1))
        data = (and(bits, mask) ? "1" : "0") data

    while ((length(data) % 8) != 0)
        data = "0" data

    return data
@}
@c endfile
@end ignore
@c file eg/prog/testbits.awk
BEGIN @{
    printf "123 = %s\n", bits2str(123)
    printf "0123 = %s\n", bits2str(0123)
    printf "0x99 = %s\n", bits2str(0x99)
    comp = compl(0x99)
    printf "compl(0x99) = %#x = %s\n", comp, bits2str(comp)
    shift = lshift(0x99, 2)
    printf "lshift(0x99, 2) = %#x = %s\n", shift, bits2str(shift)
    shift = rshift(0x99, 2)
    printf "rshift(0x99, 2) = %#x = %s\n", shift, bits2str(shift)
@}
@c endfile
@end example

@noindent
å½“æ‰§è¡Œæ—¶ï¼Œäº§ç”Ÿå¦‚ä¸‹è¾“å‡ºï¼š

@example
$ @kbd{gawk -f testbits.awk}
@print{} 123 = 01111011
@print{} 0123 = 01010011
@print{} 0x99 = 10011001
@print{} compl(0x99) = 0x3fffffffffff66 = 00111111111111111111111111111111111111111111111101100110
@print{} lshift(0x99, 2) = 0x264 = 0000001001100100
@print{} rshift(0x99, 2) = 0x26 = 00100110
@end example

@cindex converting, strings to numbers
@cindex strings, converting
@cindex numbers, converting
@cindex converting, numbers to strings
@cindex number as string of bits
@code{bits2str()} å‡½æ•°å°†ä¸€ä¸ªäºŒè¿›åˆ¶æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ç»™ @code{mask} åˆå§‹åŒ–ä¸º 1 æ¥åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå…¶æœ€å³è¾¹çš„ä½è¢«è®¾ç½®ä¸º 1ã€‚ä½¿ç”¨è¿™ä¸ª @code{mask}ï¼Œå‡½æ•°é‡å¤åœ°æ£€æŸ¥æœ€å³è¾¹çš„ä½ã€‚å°† @code{mask} ä¸å€¼è¿›è¡Œ AND æ“ä½œï¼Œå¯ä»¥æ˜¾ç¤ºå‡ºæœ€å³è¾¹çš„ä½æ˜¯ 1 è¿˜æ˜¯ 0ã€‚å¦‚æœæ˜¯ 1ï¼Œå°±ä¼šåœ¨å­—ä¸²çš„å‰é¢è¿æ¥ä¸€ä¸ª @code{"1"}ï¼Œå¦åˆ™è¿æ¥ä¸€ä¸ª @code{"0"}ã€‚å€¼ç„¶åå‘å³ç§° 1 ä½ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„ 1 å­˜åœ¨ã€‚

å¦‚æœåˆå§‹å€¼ä¸º 0ï¼Œå®ƒä¼šç®€å•åœ°è¿”å› @code{"0"}ã€‚å¦åˆ™æœ€åï¼Œä¼šå°†å€¼è¿›è¡Œå¡«è¡¥ä»¥äº§ç”Ÿ 8 ä½æ•°é‡çš„æ•´å€æ•°ã€‚åœ¨ç°ä»£çš„è®¡ç®—æœºä¸­è¿™æ˜¯ä¸€ç§å…¸å‹çš„å¤„ç†ã€‚

åœ¨ @code{BEGIN} ä¸­çš„ä¸»ä»£ç è§„åˆ™æ˜¾ç¤ºäº†åè¿›åˆ¶ä¸å…«è¿›åˆ¶æ•°æ®çš„åŒä¸€ä¸ªå€¼çš„ä¸åŒï¼ˆæŸ¥çœ‹ @pxref{Nondecimal-numbers}ï¼‰ï¼Œç„¶åå±•ç¤ºäº† @code{compl()}ï¼Œ@code{lshift()}ï¼Œ ä¸ @code{rshift()} å‡½æ•°çš„ç»“æœã€‚

@node Type Functions
@subsection è·å–ç±»å‹ä¿¡æ¯

@command{gawk} æä¾›äº†ä¸€ä¸ªå‡½æ•°æ¥è®©ä½ å¯ä»¥åŒºåˆ†æ•°ç»„ä¸æ ‡é‡å˜é‡ã€‚è¿™åœ¨éå†å¤šç»´æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™æ˜¯éå¸¸æœ‰ç”¨çš„ï¼ˆæŸ¥çœ‹ @pxref{Arrays of Arrays}ï¼‰ã€‚

@table @code
@cindexgawkfunc{isarray}
@cindex scalar or array
@item isarray(@var{x})
å¦‚æœ @var{x} æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
@end table

@code{isarray()} ä¸»è¦ç”¨åœ¨ä¸¤ç§ç¯å¢ƒä¸­ã€‚ç¬¬ä¸€ç§æ˜¯å½“éå†å¤šç»´æ•°ç»„æ—¶ï¼Œä½ å¯ä»¥æµ‹è¯•æŸä¸ªå…ƒç´ æ˜¯å¦æ˜¯æ•°ç»„ã€‚ç¬¬äºŒä¸ªåœºæ™¯æ˜¯åœ¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¸­ï¼ˆè¿˜æœªè®¨è®ºåˆ°ï¼ŒæŸ¥çœ‹ @ref{User-defined}ï¼‰ï¼Œç”¨æ¥æµ‹è¯•å‚æ•°æ˜¯å¦ä¸ºæ•°ç»„ã€‚

@quotation æç¤º
åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ @code{isarray()} æ¥æµ‹è¯•å˜é‡å¹¶æ²¡æœ‰å«ä¹‰ã€‚å› ä¸ºä½ å°±æ˜¯å†™ç¨‹åºçš„äººï¼Œä½ å½“ç„¶çŸ¥é“ä½ çš„å˜é‡æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œå®é™…ä¸Šï¼Œç”±äº @command{gawk} çš„å·¥å…·æ–¹å¼ï¼Œå¦‚æœä½ å˜é‡çš„åå­—åœ¨ @code{isarray()} ä¹‹å‰è¿˜æ²¡æœ‰ç”¨åˆ°ï¼Œ@command{gawk} ä¼šå°†å…¶è½¬æ¢æˆä¸€ä¸ªæ ‡é‡ã€‚
@end quotation

@node I18N Functions
@subsection å­—ä¸²ç¿»è¯‘å‡½æ•°
@cindex @command{gawk}, string-translation functions
@cindex functions, string-translation
@cindex string-translation functions
@cindex internationalization
@cindex @command{awk} programs, internationalizing

@command{gawk} æä¾›äº†ä¸€äº›è®¾æ–½ç”¨æ¥å›½é™…åŒ– @command{awk} ç¨‹åºã€‚è¿™äº›åŒ…å«äº†ä¸‹é¢åˆ—è¡¨ä¸­æè¿°çš„å‡½æ•°ã€‚è¿™äº›çš„æè¿°åªæ˜¯ç›®çš„æ€§çš„ã€‚
æŸ¥çœ‹ @ref{Internationalization}ï¼Œæ¥æŸ¥çœ‹å…¨éƒ¨çš„è¯´æ˜ã€‚å¯é€‰çš„å‚æ•°æ”¾åœ¨æ–¹æ‹¬å·ä¸­ï¼ˆ[ ]ï¼‰ï¼š

@table @asis
@cindexgawkfunc{bindtextdomain}
@cindex set directory of message catalogs
@item @code{bindtextdomain(@var{directory}} [@code{,} @var{domain}]@code{)}
è®¾ç½®ç›®å½•ï¼Œå½“ä¸ä¼šæˆ–è€…ä¸èƒ½å®šä½åˆ°â€œæ ‡å‡†â€çš„ä½ç½®æ—¶ï¼Œ@command{gawk} ä¼šåœ¨è¿™ä¸ªç›®å½•é‡ŒæŸ¥æ‰¾ä¿¡æ¯ç¿»è¯‘æ–‡ä»¶ï¼ˆå¦‚åœ¨æµ‹è¯•æœŸé—´ï¼‰ã€‚
å®ƒè¿”å›ç»‘å®š @var{domain} çš„ç›®å½•ã€‚

é»˜è®¤çš„ @var{domain} æ˜¯ @code{TEXTDOMAIN} çš„å€¼ã€‚å¦‚æœç›®å½•æ˜¯ä¸€ä¸ªç©ºä¸²ï¼ˆ@code{""}ï¼‰ï¼Œåˆ™ @code{bindtextdomain()} è¿”å›ç»™å®š @var{domain} çš„å½“å‰ç»‘å®šã€‚

@cindexgawkfunc{dcgettext}
@cindex translate string
@item @code{dcgettext(@var{string}} [@code{,} @var{domain} [@code{,} @var{category}] ]@code{)}
è¿”å›åœ¨æ–‡æœ¬åŸŸ @var{domain} ä¸­ï¼Œå¯¹äºæœ¬åœ°è¯­è¨€è®¾ç½® @var{category} çš„ä¸² @var{string} çš„ç¿»è¯‘ä¸²ã€‚
é»˜è®¤çš„ @var{domain} å€¼æ˜¯å½“å‰ @code{TEXTDOMAIN} çš„å€¼ã€‚
@var{category} çš„é»˜è®¤å€¼æ˜¯ @code{"LC_MESSAGES"}ã€‚

@cindexgawkfunc{dcngettext}
@item @code{dcngettext(@var{string1}, @var{string2}, @var{number}} [@code{,} @var{domain} [@code{,} @var{category}] ]@code{)}
è¿”å›åœ¨åˆ†ç±» @var{category} çš„æ–‡æœ¬åŸŸ @var{domain} ä¸­ï¼Œç”¨äºè¿›è¡Œ @var{string1} ä¸ @var{string2} ç¿»è¯‘çš„æ•°ç›® @var{number} çš„å¤æ•°å½¢å¼ã€‚@var{string1} æ˜¯æŸä¸ªæ¶ˆæ¯çš„è‹±è¯­å•ä¸€å˜ä½“ï¼Œ@var{string2} åŒä¸€ä¸ªæ¶ˆæ¯çš„è‹±è¯­å¤æ•°å½¢å¼ã€‚@var{domain} çš„é»˜è®¤å€¼å°±æ˜¯ @code{TEXTDOMAIN} çš„å½“å‰å€¼ã€‚@var{category} çš„é»˜è®¤å€¼æ˜¯ @code{"LC_MESSAGES"}ã€‚
@end table

@node User-defined
@section ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°

@cindex user-defined functions
@cindex functions, user-defined
å¤æ‚çš„ @command{awk} ç¨‹åºå¸¸å¸¸é€šè¿‡å®šä¹‰è‡ªå·±çš„å‡½æ•°æ¥è¿›è¡Œç®€åŒ–ã€‚ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¹Ÿå¯ä»¥åƒå†…ç½®å‡½æ•°ä¸€æ ·è°ƒç”¨ï¼ˆæŸ¥çœ‹ @pxref{Function Calls}ï¼‰ï¼Œä½†æ˜¯å®šä¹‰ä»–ä»¬åˆ™æ˜¯ä½ çš„è‡ªç”±ï¼ˆå³å‘Šè¯‰ @command{awk} ä½ æ‰€è¦åšçš„äº‹æƒ…ï¼‰ã€‚

@menu
* Definition Syntax::           How to write definitions and what they mean.
* Function Example::            An example function definition and what it
                                does.
* Function Caveats::            Things to watch out for.
* Return Statement::            Specifying the value a function returns.
* Dynamic Typing::              How variable types can change at runtime.
@end menu

@node Definition Syntax
@subsection å‡½æ•°å®šä¹‰è¯­æ³•

@quotation
@i{
è¯´ @command{awk} æœ¬åœ°å˜é‡çš„å®šä¹‰è¯­æ³•æƒŠäººçš„ç³Ÿç³•æ˜¯å¾ˆå…¬æ­£çš„ã€‚
}
@author Brian Kernighan
@end quotation

@cindex functions, defining
å‡½æ•°çš„å®šä¹‰å¯ä»¥å‡ºç°åœ¨ @command{awk} ç¨‹åºè§„åˆ™ä¹‹é—´çš„ä»»ä½•åœ°æ–¹ã€‚
æ‰€ä»¥ï¼Œ@command{awk} ç¨‹åºçš„ä¸€èˆ¬å½¢å¼æ˜¯è¢«æ‰©å±•ä¸ºåŒ…å«ä¸€ç³»åˆ—çš„è§„åˆ™@emph{ä¸}ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å®šä¹‰ã€‚æ²¡æœ‰å¿…é¡»å°†å‡½æ•°å®šä¹‰æ”¾åœ¨æ‰€æœ‰ä½¿ç”¨å‡½æ•°çš„åœ°æ–¹ä¹‹é—´ã€‚è¿™æ˜¯å› ä¸º @command{awk} è¯»å–ç¨‹åºæ˜¯åœ¨å¼€å§‹æ‰§è¡Œä»»ä½•éƒ¨ä»½ä¹‹å‰ã€‚

æŸä¸ªå‡½æ•°åä¸º @var{name} çš„å®šä¹‰çœ‹èµ·æ¥å¦‚ä¸‹ï¼š

@display
@code{function} @var{name}@code{(}[@var{parameter-list}]@code{)}
@code{@{}
     @var{body-of-function}
@code{@}}
@end display

@cindex names, functions
@cindex functions, names of
@cindex namespace issues, functions
@noindent
åœ¨è¿™é‡Œï¼Œ@var{name} æ˜¯è¦å®šä¹‰å‡½æ•°çš„åå­—ã€‚æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å‡½æ•°åå°±åƒä¸€ä¸ªæœ‰æ•ˆçš„å˜é‡åä¸€æ ·ï¼šä¸€ç³»åˆ—çš„å­—æ¯ã€æ•°å­—ä»¥åŠä¸‹åˆ’çº¿ï¼ŒåŒæ—¶ä¸ä»¥æ•°å­—å¼€å¤´çš„åºåˆ—ã€‚å› æ­¤ï¼Œåªæœ‰ 52 ä¸ªå¤§å†™è·Ÿå°å†™çš„è‹±æ–‡å­—æ¯å¯ä»¥ç”¨äºå‡½æ•°åã€‚
åœ¨ä¸€ä¸ªå•ç‹¬çš„ @command{awk} ç¨‹åºä¸­ï¼Œä»»ä½•ç‰¹å®šçš„åå­—åªèƒ½è¢«ä½œä¸ºå˜é‡ã€æ•°ç»„æˆ–è€…å‡½æ•°æ¥ä½¿ç”¨ã€‚

@var{parameter-list} æ˜¯ä¸€ä¸ªå¯é€‰çš„å‡½æ•°å‚æ•°ï¼Œä»¥åŠæœ¬åœ°å˜é‡åçš„åˆ—è¡¨ï¼Œé€šè¿‡é€—å·åˆ†éš”ã€‚å½“å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå‚æ•°åç”¨äºåœ¨è°ƒç”¨æ—¶ä¼ é€’çš„å‚æ•°å€¼ã€‚

å‡½æ•°ä¸å¯ä»¥ç”¨ä¸¤ä¸ªç›¸åŒåå­—çš„å‚æ•°ï¼Œä¹Ÿä¸å¯ä»¥ä¸å‡½æ•°çš„åå­—åŒåã€‚

@quotation æ³¨æ„
æ ¹æ® POSIX æ ‡å‡†ï¼Œå‡½æ•°å‚æ•°ä¸å¯ä»¥ä¸ç‰¹æ®Šçš„é¢„å®šä¹‰å˜é‡åŒåï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ï¼Œå‡½æ•°å‚æ•°ä¹Ÿä¸å¯ä»¥ä¸å¦ä¸€ä¸ªå‡½æ•°ååŒåã€‚

å¹¶ä¸æ˜¯æ‰€æœ‰çš„ @command{awk} ç‰ˆæœ¬éƒ½å¼ºåˆ¶è¿™äº›é™åˆ¶ã€‚@command{gawk} æ€»æ˜¯å¼ºåˆ¶ç¬¬ä¸€æ¡é™åˆ¶ã€‚åœ¨æŒ‡å®š @option{--posix} é€‰é¡¹æ—¶ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œå®ƒä¹Ÿå¼ºåˆ¶ç¬¬äºŒä¸ªé™åˆ¶ã€‚
@end quotation

å¦‚æœè¢«å‚è€ƒçš„åœ°æ–¹éœ€è¦ä¸€ä¸ªå­—ä¸²å€¼çš„æ—¶å€™ï¼Œæœ¬å˜é‡è¡¨ç°åƒä¸€ä¸ªç©ºä¸²ï¼Œå¦‚æœå‚è€ƒåˆ°çš„åœ°æ–¹éœ€è¦ä¸€ä¸ªæ•°å€¼çš„æ—¶å€™ï¼Œå°±è¡¨ç°ä¸º 0ã€‚è¿™ä¸å¸¸è§„çš„å˜é‡åœ¨è¿˜æ²¡æœ‰è¢«èµ‹å€¼æ—¶çš„è¡¨ç°ä¸€æ ·ã€‚ï¼ˆè¦æ›´å¤šåœ°ç†è§£æœ¬åœ°å˜é‡ï¼ŒæŸ¥çœ‹ @pxref{Dynamic Typing}ï¼‰

@var{body-of-function} ç”± @command{awk} çš„è¯­å¥ç»„æˆã€‚è¿™æ˜¯å®šä¹‰çš„æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå› æ­¤å®ƒå®šä¹‰äº†å‡½æ•°å®é™…è¦@emph{åš}çš„äº‹æƒ…ã€‚å‚æ•°åå­˜åœ¨ç»™äº†å‡½æ•°ä½“ä¸å‚æ•°è¿›è¡Œå¯¹è¯çš„æ–¹å¼ï¼Œæœ¬åœ°å˜é‡çš„å­˜åœ¨å¯ä»¥ä½¿å‡½æ•°ä½“æ¥ä¿å­˜ä¸´æ—¶å€¼ã€‚

å‚æ•°åä¸æœ¬åœ°å˜é‡åæ²¡æœ‰è¯­æ³•ä¸Šçš„åŒºåˆ«ã€‚ç›¸åï¼Œè°ƒç”¨å‡½æ•°æ—¶æä¾›çš„å‚æ•°ä¸ªæ•°å†³å®šäº†æœ‰å¤šå°‘ä¸ªå‚æ•°å˜é‡ã€‚å› æ­¤ï¼Œå¦‚æœç»™äº†ä¸‰ä¸ªå‚æ•°å€¼ï¼Œ@var{parameter-list} ä¸­çš„å¤´ä¸‰ä¸ªåå­—å°±æ˜¯å‚æ•°ï¼Œè€Œå‰©ä¸‹çš„å°±æ˜¯æœ¬åœ°å˜é‡ã€‚

è§„åˆ™æ˜¯è¿™æ ·çš„ï¼Œå¦‚æœå‚æ•°çš„ä¸ªæ•°ä¸æ‰€æœ‰çš„å‡½æ•°çš„æ‰€æœ‰è°ƒç”¨éƒ½ä¸ä¸€æ ·ï¼Œåœ¨ @var{parameter-list} ä¸­çš„ä¸€äº›åå­—æœ‰æ—¶æ˜¯å‚æ•°ï¼Œè€Œåœ¨å…¶ä»–æ—¶é—´åˆ™æ˜¯æœ¬åœ°å˜é‡ã€‚å¦ä¸€ä¸ªæ€è€ƒè¿™ä¸ªé—®é¢˜çš„æ–¹å¼æ˜¯ï¼Œè¢«çœç•¥çš„å‚æ•°çš„é»˜è®¤å€¼ä¸ºç©ºä¸²ã€‚

@cindex programming conventions, functions, writing
é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ å†™ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä½ çŸ¥é“ä½ è¦ä½¿ç”¨çš„åå­—æ•°ï¼Œä»¥åŸºä½œä¸ºå‚æ•°ï¼Œè€Œæœ‰ç›¸åº”çš„ä¸ªæ•°ç”¨æ¥ä½œæœ¬åœ°å˜é‡ã€‚å°†ä¸€äº›é¢å¤–çš„ç©ºæ ¼æ”¾åœ¨å‚æ•°ä¸æœ¬åœ°å˜é‡ä¹‹é—´å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ¥åŠ ä»¥åŒºåˆ†ï¼Œè¿™å¯ä»¥ä½œä¸ºå¦‚ä½•æ¥ä½¿ç”¨å‡½æ•°çš„æ–‡æ¡£ã€‚

@cindex variables, shadowing
@cindex shadowing of variable values
åœ¨å‡½æ•°ä½“çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‚æ•°ä¸æœ¬åœ°å˜é‡ä¼šè¢«éšè—ï¼Œæˆ–è€…@dfn{é®ç›–}æ‰ï¼Œç¨‹åºåé¢æ‰€æœ‰ä½¿ç”¨åˆ°çš„åŒåçš„å˜é‡ã€‚è¢«é®ç›–æ‰çš„å˜é‡åœ¨å‡½æ•°å®šä¹‰ä¸­æ˜¯ä¸å¯è®¿é—®çš„ï¼Œå› æ­¤æ²¡æœ‰æ–¹æ³•åœ¨å®ƒä»¬çš„åå­—è¢«ç”¨äºå‚æ•°æˆ–è€…æœ¬åœ°å˜é‡æ—¶è¿›è¡Œå‘½åã€‚æ‰€ä»¥å…¶ä»–çš„åœ¨ @command{awk} ç¨‹åºä¸­ä½¿ç”¨çš„å˜é‡å¯ä»¥åœ¨å‡½æ•°ä½“ä¸­è¢«å‚è€ƒï¼Œæˆ–è€…è®¾ç½®ã€‚å‚æ•°ä¸æœ¬åœ°å˜é‡åªæŒç»­åˆ°å‡½æ•°ä½“æ‰§è¡Œå®Œæˆã€‚åªè¦å‡½æ•°ä½“ä¸€å®Œæˆï¼Œä½ å°±å†ä¸€æ¬¡å¯ä»¥è®¿é—®é‚£äº›åœ¨å‡½æ•°æ‰§è¡Œæ—¶è¢«é®ç›–æ‰çš„å˜é‡ã€‚

å‡½æ•°ä½“å¯ä»¥åŒ…å«è°ƒç”¨å‡½æ•°çš„è¡¨è¾¾å¼ã€‚ä»–ä»¬ç”šè‡³å¯ä»¥è°ƒç”¨å‡½æ•°æœ¬èº«ï¼Œç›´æ¥åœ°æˆ–è€…é€šè¿‡å¦ä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚å½“å‘ç”Ÿäº†è¿™æ ·çš„äº‹æƒ…æ—¶ï¼Œæˆ‘ä»¬ç§°å‡½æ•°æ˜¯é€’å½’çš„ã€‚å‡½æ•°è°ƒç”¨å…¶æœ¬èº«çš„åŠ¨ä½œç§°ä¸ºé€’å½’ã€‚

@cindex recursive functions
@cindex functions, recursive
å‡½æ•°ä½“å¯ä»¥åŒ…å«è°ƒç”¨å‡½æ•°çš„è¡¨è¾¾å¼ã€‚ä»–ä»¬ç”šè‡³å¯ä»¥è°ƒç”¨å‡½æ•°æœ¬èº«ï¼Œç›´æ¥åœ°æˆ–è€…é€šè¿‡å¦ä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚å½“å‘ç”Ÿäº†è¿™æ ·çš„äº‹æƒ…æ—¶ï¼Œæˆ‘ä»¬ç§°å‡½æ•°æ˜¯@dfn{é€’å½’çš„}ã€‚å‡½æ•°è°ƒç”¨å…¶æœ¬èº«çš„åŠ¨ä½œç§°ä¸º@dfn{é€’å½’}ã€‚

æ‰€æœ‰çš„å†…å»ºå‡½æ•°è¿”å›ä¸€ä¸ªå€¼ç»™å®ƒä»–çš„è°ƒç”¨è€…ã€‚ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¹Ÿå¯ä»¥è¿™ä¹ˆåšï¼Œåªéœ€è¦ä½¿ç”¨ @code{return} è¯­å¥ï¼Œå®ƒåœ¨ @ref{Return Statement}ï¼Œè¿›è¡Œè¯¦ç»†çš„æè¿°ã€‚æœ¬@value{SECTION}ä¸­åç»­çš„å¾ˆå¤šä¾‹å­éƒ½ä½¿ç”¨ @code{return} è¯­å¥ã€‚

@cindex common extensions, @code{func} keyword
@cindex extensions, common@comma{} @code{func} keyword
@c @cindex @command{awk} language, POSIX version
@c @cindex POSIX @command{awk}
@cindex POSIX @command{awk}, @code{function} keyword in
åœ¨å¾ˆå¤šçš„ @command{awk} å®ç°ä¸­ï¼ŒåŒ…æ‹¬ @command{gawk}ï¼Œå…³é”®è¯ @code{function} å¯ä»¥ç®€å†™ä¸º @code{func}ã€‚@value{COMMONEXT}
ä½†æ˜¯ POSIX åªæŒ‡å®šäº†ä½¿ç”¨å…³é”®è¯ @code{function}ã€‚å®é™…ä¸Šæœ‰ä¸€äº›å®è·µä¸Šçš„éšä¹‰ã€‚å¦‚æœ @command{gawk} æ˜¯ POSIX å…¼å®¹æ¨¡å¼ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œåˆ™ä¸‹é¢çš„è¯­å¥@emph{ä¸ä¼š}å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼š

@example
func foo() @{ a = sqrt($1) ; print a @}
@end example

@noindent
ç›¸åï¼Œå®ƒå®šä¹‰äº†è¿™æ ·çš„ä¸€ä¸ªè§„åˆ™ï¼šå¯¹æ¯ä¸€ä¸ªè®°å½•ï¼Œè¿æ¥å˜é‡ @samp{func} çš„å€¼ä¸å‡½æ•° @samp{foo} çš„è¿”å›å€¼ã€‚å¦‚æœç»“æœå­—ä¸²æ˜¯éç©ºçš„ï¼ŒåŠ¨ä½œå°±ä¼šè¢«æ‰§è¡Œã€‚è¿™å¯èƒ½ä¸æ˜¯æ‰€æƒ³è¦çš„ã€‚ï¼ˆ@command{awk} æ¥æ”¶è¿™æ ·çš„è¾“å…¥ä¸ºè¯­æ³•æœ‰æ•ˆï¼Œå› æ­¤å‡½æ•°å¯ä»¥åœ¨å®ƒä»¬åœ¨ @command{awk} ç¨‹åºä¸­å®šä¹‰ä¹‹å‰è¢«è°ƒç”¨ã€‚@footnote{è¿™ä¸ªç¨‹åºå®é™…ä¸Šä¸ä¼šè¿è¡Œï¼Œå› ä¸º @code{foo()} æ˜¯æœªå®šä¹‰çš„ã€‚}ï¼‰

@cindex portability, functions@comma{} defining
ä¸ºäº†ä¿è¯ä½ çš„ @command{awk} ç¨‹åºæ˜¯å¯ç§»æ¤çš„ï¼Œåœ¨å®šä¹‰å‡½æ•°æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨å…³é”®å­— @code{function}ã€‚

@node Function Example
@subsection å‡½æ•°å®šä¹‰èŒƒä¾‹
@cindex function definition example

ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°çš„ä¾‹å­ï¼Œå‡½æ•°åå­—å« @code{myprint()}ï¼Œè¯¥å‡½æ•°å–å¾—ä¸€ä¸ªæ•°å€¼ï¼Œå¹¶ä»¥æŒ‡å®šçš„æ ¼å¼æ‰“å°å®ƒï¼š

@example
function myprint(num)
@{
     printf "%6.3g\n", num
@}
@end example

@noindent
ä¸ºäº†è§£æ¸…æ¥šï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ @code{myprint()} å‡½æ•°çš„ @command{awk} è§„åˆ™ï¼š

@example
$3 > 0     @{ myprint($3) @}
@end example

@noindent
æ­¤ç¨‹åºç”¨æˆ‘ä»¬ç‰¹å®šçš„æ ¼å¼æ‰“å°æ‰€æœ‰è¾“å…¥ä¸­ç¬¬ä¸‰ä¸ªåŸŸæ˜¯æ­£æ•°çš„åŸŸã€‚å› æ­¤ï¼Œå½“æœ‰ä¸‹é¢çš„è¾“å…¥æ—¶ï¼š

@example
 1.2   3.4    5.6   7.8
 9.10 11.12 -13.14 15.16
17.18 19.20  21.22 23.24
@end example

@noindent
ç”¨æˆ‘ä»¬çš„ç¨‹åºæ ¼å¼ï¼Œåˆ™ä¼šæ‰“å°ï¼š

@example
   5.6
  21.2
@end example

ä¸‹é¢è¿™ä¸ªå‡½æ•°åˆ é™¤æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆå›å¿†ä¸€ä¸‹é¢å¤–çš„ç©ºæ ¼æ¥æ ‡è¯†æœ¬åœ°å˜é‡åˆ—è¡¨ï¼‰ï¼š

@example
function delarray(a,    i)
@{
    for (i in a)
        delete a[i]
@}
@end example

å½“ä¸æ•°ç»„ä¸€èµ·æ‰§è¡Œæ—¶ï¼Œå¸¸å¸¸éœ€è¦åˆ é™¤æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¹¶å¼€å§‹ä¸€ä¸ªæ–°çš„å…ƒç´ åˆ—è¡¨ï¼ˆæŸ¥çœ‹ @pxref{Delete}ï¼‰ã€‚ä¸ºäº†ä¸åœ¨æ¯ä¸ªè¦æ¸…é™¤æ•°ç»„çš„åœ°æ–¹éƒ½è¦é‡å¤åœ°å†™è¿™æ ·çš„å¾ªç¯ï¼Œä½ çš„ç¨‹åºå°±åªè°ƒç”¨ @code{delarray()}ã€‚ï¼ˆè¿™ä¿è¯äº†ç§»æ¤æ€§ã€‚@samp{delete @var{array}} çš„ä½¿ç”¨ç”¨æ¥åˆ é™¤æ•´ä¸ªæ•°ç»„æ˜¯æœ€æ–°è¿‘ æ‰åŠ å…¥åˆ° POSIX æ ‡å‡†ä¸­çš„ã€‚@footnote{2012 å¹´çš„æ™šäº›æ—¶å€™ã€‚}ï¼‰

ä¸‹é¢æ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°çš„ä¾‹å­ã€‚å®ƒå–ä¸€ä¸ªå­—ä¸²ä½œä¸ºè¾“å‡ºå‚æ•°ï¼Œå¹¶è¿”å›é€†åºå­—ä¸²ã€‚é€’å½’å‡½æ•°å¿…é¡»æœ‰ä¸€ä¸ªæµ‹è¯•æ¡ä»¶æ¥åœæ­¢é€’å½’ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨è¾“å…¥ä¸²ä¸ºç©ºæ—¶å°±ç»“æŸé€’å½’ï¼š

@c 8/2014: Thanks to Mike Brennan for the improved formulation
@cindex @code{rev()} user-defined function
@example
function rev(str)
@{
    if (str == "")
        return ""

    return (rev(substr(str, 2)) substr(str, 1, 1))
@}
@end example

å¦‚æœè¿™ä¸ªå‡½æ•°åœ¨ä¸€ä¸ªåå­—ä¸º @file{rev.awk} çš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæ¥æµ‹è¯•ï¼š

@example
$ @kbd{echo "Don't Panic!" |}
> @kbd{gawk -e '@{ print rev($0) @}' -f rev.awk}
@print{} !cinaP t'noD
@end example

C çš„ @code{ctime()} å‡½æ•°è¾“å…¥ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå¹¶è¿”å›ä¸€ä¸ªç”¨å¸¸ç”¨çš„å½¢å¼æ ¼å¼åŒ–çš„å­—ä¸²ã€‚ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨å†…ç½®å‡½æ•° @code{strftime()}ï¼ˆæŸ¥çœ‹ @ref{Time Functions}ï¼‰æ¥åˆ›å»ºä¸€ä¸ª @command{awk} ç‰ˆæœ¬çš„ @code{ctime()}ã€‚

@cindex @code{ctime()} user-defined function
@example
@c file eg/lib/ctime.awk
# ctime.awk
#
# awk version of C ctime(3) function

function ctime(ts,    format)
@{
    format = "%a %b %e %H:%M:%S %Z %Y"

    if (ts == 0)
        ts = systime()       # use current time as default
    return strftime(format, ts)
@}
@c endfile
@end example

ä½ å¯èƒ½è®¤ä¸º @code{ctime()} å¯ä»¥ä½¿ç”¨ @code{PROCINFO["strftime"]} æ¥ä½œä¸ºæ ¼å¼ä¸²ã€‚ä½†é‚£ä¼šæ˜¯ä¸ªé”™è¯¯ï¼Œå› ä¸º @code{ctime()} å‡è®¾è¿”å›çš„æ˜¯æ ‡å‡†çš„æ ¼å¼ï¼Œè€Œç”¨æˆ·çº§çš„ä»£ç å¯èƒ½å·²ç»æ›´æ”¹äº† @code{PROCINFO["strftime"]}ã€‚

@node Function Caveats
@subsection è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°

@cindex functions, user-defined, calling
è°ƒ@dfn{ç”¨ä¸€ä¸ªå‡½æ•°}ä¼šå¯¼è‡´é‚£ä¸ªå‡½æ•°è¢«æ‰§è¡Œã€‚è°ƒç”¨è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå…¶å€¼å°±æ˜¯å‡½æ•°è¿”å›çš„å€¼ã€‚

@menu
* Calling A Function::          Don't use spaces.
* Variable Scope::              Controlling variable scope.
* Pass By Value/Reference::     Passing parameters.
@end menu

@node Calling A Function
@subsubsection å¦‚ä½•è°ƒç”¨å‡½æ•°

å‡½æ•°è°ƒç”¨åŒ…å«å‡½æ•°åï¼Œåé¢å†è·Ÿç€åœ¨æ‹¬å·ä¸­çš„å‚æ•°ã€‚@command{awk} è¡¨è¾¾å¼å°±æ˜¯ç”¨æŠŠå‚æ•°å†™åœ¨å‡½æ•°è°ƒç”¨ä¸­ã€‚æ¯æ¬¡è°ƒç”¨æ‰§è¡Œæ—¶ï¼Œè¿™äº›è¡¨è¾¾å¼ä¼šå…ˆæ±‚å€¼ï¼Œç„¶åå€¼ä¸ºæˆä¸ºå®é™…çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç”¨ä¸‰ä¸ªå‚æ•°è°ƒç”¨ @code{foo()} å‡½æ•°ä¾‹å­ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ä¸²è¿æ¥ï¼‰ï¼š

@example
foo(x y, "lose", 4 * z)
@end example

@quotation æ³¨æ„
åœ¨å‡½æ•°åäº†å‚æ•°åˆ—è¡¨çš„å¼€æ‹¬å·ä¹‹é—´çš„ç©ºç™½ï¼ˆç©ºæ ¼ä¸ TABsï¼‰æ˜¯ä¸å…è®¸çš„ã€‚å¦‚æœä½ ä¸å°å¿ƒå†™äº†ä¸ªç©ºç™½åœ¨é‡Œé¢ï¼Œ@command{awk} å¯èƒ½å°†ä½ çš„æ„æ€ç†è§£æˆæ¥è¿æ¥ä¸€ä¸ªå˜é‡ä¸æ‹¬å·è¡¨è¾¾å¼çš„å€¼ã€‚ä½†æ˜¯ï¼Œæœ€åå®ƒä¼šæ³¨æ„åˆ°ä½ ä½¿ç”¨äº†ä¸€ä¸ªå‡½æ•°åï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå˜é‡åï¼Œå› æ­¤ä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ã€‚
@end quotation

@node Variable Scope
@subsubsection æ§åˆ¶å˜é‡ä½œç”¨åŸŸ

@cindex local variables, in a function
@cindex variables, local to a function
ä¸åƒå…¶ä»–çš„å¾ˆå¤šè¯­è¨€ï¼Œåœ¨ @command{awk} æ²¡æœ‰åŠæ³•ä½¿ä¸€ä¸ªå˜é‡åªåœ¨ @code{@{} @dots{} @code{@}} å—ä¸­æœ‰ä½œç”¨ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ä¸€ä¸ªå˜é‡æˆä¸ºä¸€ä¸ªå‡½æ•°çš„æœ¬åœ°å˜é‡ã€‚è¿™ä¹ˆåšæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µï¼Œåœ¨ä»»ä½•æ—¶å€™åœ¨å‡½æ•°ä¸­ä½¿ç”¨ä¸€ä¸ªå˜é‡æ—¶ï¼Œéƒ½å°†å…¶ç½®æˆæœ¬åœ°å˜é‡ã€‚

ä¸ºäº†ä½¿ä¸€ä¸ªå˜é‡æˆä¸ºå‡½æ•°çš„æœ¬åœ°å˜é‡ï¼Œåªéœ€è¦ç®€å•åœ°åœ¨å®é™…çš„å‚æ•°ï¼ˆæŸ¥çœ‹ @pxref{Definition Syntax}ï¼‰çš„åé¢å£°æ˜å°±å¯ä»¥ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œå˜é‡ @code{i} æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå³å¯ä»¥è¢« @code{foo()} ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è¢« @code{bar()} ä½¿ç”¨ï¼š

@example
function bar()
@{
    for (i = 0; i < 3; i++)
        print "bar's i=" i
@}

function foo(j)
@{
    i = j + 1
    print "foo's i=" i
    bar()
    print "foo's i=" i
@}

BEGIN @{
      i = 10
      print "top's i=" i
      foo(0)
      print "top's i=" i
@}
@end example

æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œåˆ™ä¼šäº§ç”Ÿä¸‹é¢çš„è¾“å‡ºï¼Œå› ä¸º @code{i} åœ¨ @code{foo()} å‡½æ•°ä¸ @code{bar()} å‡½æ•°ä¸­ä»¥åŠåœ¨æœ€é¡¶å±‚éƒ½æŒ‡å‘åŒä¸€ä¸ªå˜é‡å®ä½“ï¼š

@example
top's i=10
foo's i=1
bar's i=0
bar's i=1
bar's i=2
foo's i=3
top's i=3
@end example

å¦‚æœä½ æƒ³ @code{i} æˆä¸º @code{foo()} ä¸ @code{bar()} çš„æœ¬åœ°å˜é‡ï¼Œè¿‘ä¸‹é¢è¿™ä¹ˆåšï¼ˆåœ¨ @code{i} ä¹‹å‰çš„é¢å¤–ç©ºæ ¼æ˜¯ä¸€ç§ç¼–ç ä¹ æƒ¯ï¼Œä»¥ç”¨æ¥è¡¨ç¤º @code{i} æ˜¯ä¸€ä¸ªæœ¬åœ°å˜é‡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå‚æ•°ï¼‰ï¼š

@example
function bar(    i)
@{
    for (i = 0; i < 3; i++)
        print "bar's i=" i
@}

function foo(j,    i)
@{
    i = j + 1
    print "foo's i=" i
    bar()
    print "foo's i=" i
@}

BEGIN @{
      i = 10
      print "top's i=" i
      foo(0)
      print "top's i=" i
@}
@end example

æ‰§è¡Œä¿®æ­£è¿‡çš„è„šæœ¬äº§ç”Ÿå¦‚ä¸‹è¾“å‡ºï¼š

@example
top's i=10
foo's i=1
bar's i=0
bar's i=1
bar's i=2
foo's i=1
top's i=10
@end example

é™¤äº†æ ‡é‡ï¼ˆå­—ä¸²ä¸æ•°å€¼ï¼‰å¤–ï¼Œä½ ä¹Ÿå¯ä»¥æœ‰æœ¬åœ°æ•°ç»„ã€‚é€šè¿‡å°†æŸä¸ªå˜é‡åç”¨ä½œæ•°ç»„ï¼Œ@command{awk} å°±ä¼šå°†å…¶å½“ä¸ºæ•°ç»„ï¼Œå¹¶ä¸”æ˜¯å‡½æ•°çš„æœ¬åœ°æ•°ç»„ã€‚å¦å¤–ï¼Œé€’å½’è°ƒç”¨ä¼šåˆ›å»ºæ–°çš„æ•°ç»„ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š

@example
function some_func(p1,      a)
@{
    if (p1++ > 3)
        return

    a[p1] = p1

    some_func(p1)

    printf("At level %d, index %d %s found in a\n",
         p1, (p1 - 1), (p1 - 1) in a ? "is" : "is not")
    printf("At level %d, index %d %s found in a\n",
         p1, p1, p1 in a ? "is" : "is not")
    print ""
@}

BEGIN @{
    some_func(1)
@}
@end example

å½“æ‰§è¡Œæ—¶ï¼Œç¨‹åºäº§ç”Ÿä¸‹é¢çš„è¾“å‡ºï¼š

@example
At level 4, index 3 is not found in a
At level 4, index 4 is found in a

At level 3, index 2 is not found in a
At level 3, index 3 is found in a

At level 2, index 1 is not found in a
At level 2, index 2 is found in a
@end example

@node Pass By Value/Reference
@subsubsection å‡½æ•°å˜é‡ä¸­çš„ä¼ å‚ä¸ä¼ å¼•ç”¨

åœ¨ @command{awk} ä¸­ï¼Œå½“ä½ å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œæ²¡æœ‰åŠæ³•æ˜¾å¼åœ°å£°æ˜å‚æ•°æ˜¯é€šè¿‡ä¼ @dfn{å€¼}è¿˜æ˜¯ä¼ @dfn{å¼•ç”¨}ã€‚

ç›¸åï¼Œä¼ é€’è§„èŒƒæ˜¯åœ¨å‡½æ•°è°ƒç”¨æ—¶æ ¹æ®ä¸‹é¢çš„è§„åˆ™æ¥åŠ¨æ€ç¡®å®šçš„ï¼šå¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„å˜é‡ï¼Œåˆ™æ˜¯é€šè¿‡ä¼ å¼•ç”¨ã€‚å¦åˆ™ï¼Œå‚æ•°å°±æ˜¯é€šè¿‡ä¼ å€¼ã€‚

@cindex call by value
å½“è°ƒç”¨å‚æ•°å¯¹å‚æ•°è¿›è¡Œä¼ å€¼ï¼Œæ„æ˜¯æ˜¯è¯´ï¼Œå®ƒç»™äº†å‚æ•°ä¸€ä¸ª@emph{å¤æœ¬}ã€‚è°ƒç”¨è€…ä½¿ç”¨å˜é‡æ¥ä½œç”¨å‚æ•°çš„è¡¨è¾¾å¼ï¼Œä½†æ˜¯è¢«è°ƒç”¨çš„å‡½æ•°å´å¹¶ä¸çŸ¥é“è¿™å›äº‹â€”â€”å®ƒåªçŸ¥é“å‚æ•°å…·æœ‰ä»€ä¹ˆæ ·çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å†™äº†ä¸‹é¢çš„ä»£ç ï¼š

@example
foo = "bar"
z = myfunc(foo)
@end example

@noindent
åˆ™ä½ ä¸è¦å°† @code{myfunc()} çš„å‚æ•°æƒ³è±¡ä¸ºâ€œ@code{foo} å˜é‡â€ã€‚ç›¸åï¼Œåˆ™åº”è¯¥å°†å‚æ•°æƒ³ä¸ºå­—ä¸²å€¼ @code{"bar"}ã€‚
å¦‚æœå‡½æ•° @code{myfunc()} æ”¹å˜äº†å®ƒæœ¬åœ°å˜é‡çš„å€¼ï¼Œå®ƒå¯¹äºå…¶ä»–çš„å˜é‡æ²¡æœ‰ä»»ä½•å½±å“ã€‚æ‰€ä»¥ï¼Œå¦‚æœ @code{myfunc()} æ‰§è¡Œï¼š

@example
function myfunc(str)
@{
   print str
   str = "zzz"
   print str
@}
@end example

@noindent
æ¥æ”¹å˜å®ƒçš„å‚æ•°å˜é‡ @code{str}ï¼Œå®ƒ@emph{ä¸ä¼š}æ›´æ”¹è°ƒç”¨è€… @code{foo} çš„å€¼ã€‚åœ¨è°ƒç”¨ @code{myfunc()} ä¸­ @code{foo} çš„è§’è‰²å°±åœ¨å®ƒçš„å€¼ï¼ˆ@code{"bar"}ï¼‰è¢«è®¡ç®—å®Œåç»“æŸäº†ã€‚å¦‚æœ @code{str} ä¹Ÿåœ¨ @code{myfunc()} ä¹‹å¤–å­˜åœ¨ï¼Œåˆ™å‡½æ•°ä½“ä¸èƒ½æ›´æ”¹å¤–é¢çš„å€¼ï¼Œå› ä¸ºå®ƒå·²ç»åœ¨ @code{myfunc()} æ‰§è¡Œæ—¶è¢«é®ç›–æ‰äº†ï¼Œä¸èƒ½ä»é‚£ä¸ªåœ°æ–¹è¢«çœ‹åˆ°ï¼Œä¹Ÿä¸èƒ½è¢«æ”¹å˜ã€‚

@cindex call by reference
@cindex arrays, as parameters to functions
@cindex functions, arrays as parameters to
ä½†æ˜¯ï¼Œå½“è°ƒç”¨å‡½æ•°ä¼ é€’çš„æ˜¯ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œå°±@emph{ä¸ä¼š}æ‰§è¡Œå¤åˆ¶ã€‚ç›¸åï¼Œæ•°ç»„å˜é‡æœ¬èº«ä¼šè¢«å‡½æ•°è¿›è¡Œç›´æ¥æ“ä½œã€‚è¿™ä¸ªåœ¨æœ¯è¯­ä¸Šä¸€èˆ¬å«ä½œ@dfn{å¼•ç”¨è°ƒç”¨}ã€‚åœ¨å‡½æ•°ä½“å†…å¯¹äºæ•°ç»„çš„æ›´æ”¹åœ¨å‡½æ•°å¤–éƒ¨ä¹Ÿ@emph{æ˜¯}å¯è§çš„ã€‚

@quotation æç¤º
å¦‚æœä½ çœ‹ä¸åˆ°ä½ æ‰€åšçš„äº‹æƒ…ï¼Œåœ¨å‡½æ•°ä¸­æ”¹å˜æ•°ç»„å‚æ•°ä¼šéå¸¸å±é™©ã€‚å¦‚ï¼š

@example
function changeit(array, ind, nvalue)
@{
     array[ind] = nvalue
@}

BEGIN @{
    a[1] = 1; a[2] = 2; a[3] = 3
    changeit(a, 2, "two")
    printf "a[1] = %s, a[2] = %s, a[3] = %s\n",
            a[1], a[2], a[3]
@}
@end example

@noindent
ä¼šæ‰“å° @samp{a[1] = 1, a[2] = two, a[3] = 3}ï¼Œå› ä¸º @code{changeit()} ä¼šå°† @code{"two"} å­˜å‚¨åˆ° @code{a} çš„ç¬¬äºŒä¸ªå…ƒç´ ä¸­ã€‚
@end quotation

@cindex undefined functions
@cindex functions, undefined
æœ‰ä¸€äº› @command{awk} å®ç°å¯ä»¥è®©ä½ è°ƒç”¨è¿˜æ²¡æœ‰å®šä¹‰çš„å‡½æ•°ã€‚å½“ç¨‹åºå®é™…ä¸Šè¯•å›¾è°ƒç”¨æ—¶ï¼Œå®ƒåªåœ¨è¿è¡Œæ—¶æŠ¥å‘Šé—®é¢˜ã€‚å¦‚ï¼š

@example
BEGIN @{
    if (0)
        foo()
    else
        bar()
@}
function bar() @{ @dots{} @}
# note that `foo' is not defined
@end example

@noindent
å› ä¸º @samp{if} è¯­å¥å†³ä¸ä¼šä¸º trueï¼Œ@code{foo()} æ²¡æœ‰å®šä¹‰ä¹Ÿä¸ä¼šæ˜¯ä¸ªçœŸæ­£çš„é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœç¨‹åºè°ƒç”¨ä¸€ä¸ªæ²¡æœ‰å®šä¹‰çš„å‡½æ•°ç¡®å®æ˜¯ä¸ªé—®é¢˜ã€‚

@cindex lint checking, undefined functions
å¦‚æœæŒ‡å®šäº† @option{--lint} å‚æ•°ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼Œ@command{gawk} ä¼šæŠ¥å‘Šè°ƒç”¨ç”¨äº†æœªå®šä¹‰çš„å‡½æ•°ã€‚

@cindex portability, @code{next} statement in user-defined functions
å¦‚æœä½ åœ¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¸­ä½¿ç”¨äº† @code{next} è¯­å¥æˆ–è€… @code{nextfile} è¯­å¥ï¼ˆæŸ¥çœ‹ @ref{Next Statement}ï¼Œä»¥åŠä¸€äº› 
@ifdocbook
 @ref{Next Statement}ï¼‰ï¼Œ
@end ifdocbook
@ifnotdocbook
 @ref{Next Statement}ï¼‰ï¼Œ
@end ifnotdocbook
@command{awk} å®ç°ä¼šäº§ç”Ÿä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ã€‚@command{gawk} åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚ 

@node Return Statement
@subsection @code{return} è¯­å¥
@cindex @code{return} statement@comma{} user-defined functions

å¦‚åœ¨ä¹‹å‰çš„å‡ ä¸ªä¾‹å­ä¸­æ‰€è§åˆ°çš„ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ä½“å†…å¯ä»¥åŒ…å«ä¸€ä¸ª @code{return} è¯­å¥ã€‚è¿™ä¸ªè¯­å¥å°†æ§åˆ¶è¿”å›åˆ° @command{awk} ç¨‹åºè°ƒç”¨çš„åœ°æ–¹ã€‚ä¹Ÿå¯ä»¥ç”¨äºè¿”å›ä¸€ä¸ªå€¼ï¼Œä»¥åœ¨ @command{awk} ç¨‹åºçš„åé¢æ¥ä½¿ç”¨ã€‚çœ‹æ¥èµ·å…¶å½¢å¼å¦‚ä¸‹ï¼š

@display
@code{return} [@var{expression}]
@end display

@var{expression} çš„éƒ¨åˆ†æ˜¯å¯é€‰çš„ã€‚ææœ‰å¯èƒ½æ˜¯å› ä¸ºç–å¿½ï¼ŒPOSIX æ²¡æœ‰å®šä¹‰å¦‚æœ @var{expression} è¢«çœç•¥çš„æƒ…å†µä¸‹è¯¥è¿”å›ä»€ä¹ˆæ ·çš„å€¼ã€‚ä»æŠ€æœ¯ä¸Šè¯´ï¼Œè¿™ä¼šä½¿è¿”å›çš„å€¼æ˜¯æœªå®šä¹‰çš„ï¼Œå› æ­¤ä¹Ÿæ˜¯ä¸å¯é¢„æµ‹çš„ã€‚ä½†æ˜¯åœ¨å®è·µä¸­ï¼Œæ‰€æœ‰çš„ @command{awk} ç‰ˆæœ¬éƒ½æ˜¯ç®€å•åœ°è¿”å›ä¸€ä¸ªç©ºä¸²ï¼Œåœ¨éœ€è¦æ•°å€¼çš„ä¸Šä¸‹æ–‡åˆ™ä¸º 0ã€‚

@code{return} è¯­å¥ä¸­æ²¡æœ‰ @var{expression} è¢«å‡è®¾ä¸ºæ¯ä¸€ä¸ªå‡½æ•°å®šä¹‰çš„å®Œæˆå¤„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ§åˆ¶åˆ°è¾¾äº†å‡½æ•°ä½“çš„å°¾éƒ¨ï¼Œå‡½æ•°æŠ€æœ¯æ€§åœ°è¿”å›ä¸€ä¸ªä¸å¯é¢„æµ‹çš„å€¼ã€‚åœ¨å®è·µä¸­ï¼Œå®ƒè¿”å›ä¸€ä¸ªç©ºä¸²ã€‚@command{awk} åœ¨ä½ ä½¿ç”¨è¿™æ ·çš„å‡½æ•°è¿”å›å€¼æ˜¯@emph{ä¸ä¼š}äº§ç”Ÿå‘Šè­¦ã€‚

æœ‰æ—¶ï¼Œä½ æƒ³å†™çš„å‡½æ•°ä½ å…³æ³¨çš„æ˜¯å®ƒæ‰€åšçš„ï¼Œè€Œä¸æ˜¯å®ƒæ‰€è¿”å›çš„ã€‚è¿™æ ·çš„å‡½æ•°ä¸ C ã€C++ æˆ–è€… Java ä¸­çš„ @code{void} å‡½æ•°ä»¥åŠ Ada ä¸­çš„ @code{procedure} å‡½æ•°å¯¹åº”ã€‚æ‰€ä»¥ï¼Œä¸è¿”å›ä»»ä½•å€¼æ˜¯æ°å½“çš„ï¼Œåªéœ€è¦ç®€å•åœ°è®°ä½ä¸è¦ä½¿ç”¨è¿™äº›å‚æ•°çš„è¿”å›å€¼å³å¯ã€‚

ä¸‹é¢çš„ä¾‹å­æ˜¯ä¸€ä¸ªè¿”å›æ•°ç»„å…ƒç´ ä¸­æœ€å¤§çš„æ•°å€¼çš„ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼š

@example
function maxelt(vec,   i, ret)
@{
     for (i in vec) @{
          if (ret == "" || vec[i] > ret)
               ret = vec[i]
     @}
     return ret
@}
@end example

@cindex programming conventions, function parameters
@noindent
ä½ ç”¨ä¸€ä¸ªå‚æ•°æ¥è°ƒç”¨ @code{maxelt()}ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„åã€‚æœ¬åœ°å˜é‡ @code{i} ä»¥åŠ @code{ret} éƒ½ä¸æ˜¯ç”¨æ¥ä½œå‚æ•°çš„ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢ä½ ä¼ é€’å¤šäºä¸€ä¸ªå‚æ•°åˆ° @code{maxelt()} ä¸­ï¼Œä½†é‚£ä¼šäº§ç”Ÿå¥‡æ€ªçš„ç»“æœã€‚åœ¨å‚æ•°åˆ—è¡¨ä¸­ï¼Œ@code{i} ä¹‹å‰é¢å¤–çš„ç©ºæ ¼è¡¨ç¤º @code{i} ä¸ @code{ret} éƒ½æ˜¯æœ¬åœ°å˜é‡ã€‚ä½ åœ¨å®šä¹‰å‡½æ•°æ—¶åº”è¯¥ä½¿ç”¨è¿™äº›çš„ä¹ æƒ¯ã€‚

ä¸‹é¢çš„ç¨‹åºä¼šä½¿ç”¨ @code{maxelt()} å‡½æ•°ã€‚å®ƒè£…å…¥ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åè°ƒç”¨ @code{maxelt()} ç„¶åæŠ¥å‘Šæ•°ç»„ä¸­çš„æœ€å¤§å…ƒç´ ï¼š

@example
function maxelt(vec,   i, ret)
@{
     for (i in vec) @{
          if (ret == "" || vec[i] > ret)
               ret = vec[i]
     @}
     return ret
@}

# Load all fields of each record into nums.
@{
     for(i = 1; i <= NF; i++)
          nums[NR, i] = $i
@}

END @{
     print maxelt(nums)
@}
@end example

å¦‚æœæœ‰ä¸‹é¢çš„è¾“å…¥ï¼š

@example
 1 5 23 8 16
44 3 5 2 8 26
256 291 1396 2962 100
-6 467 998 1101
99385 11 0 225
@end example

@noindent
åˆ™ç¨‹åºæŠ¥å‘Šï¼ˆå¯é¢„æµ‹çš„ï¼‰99,385 æ˜¯æ•°ç»„ä¸­æœ€å¤§çš„å€¼ã€‚

@node Dynamic Typing
@subsection å‡½æ•°ä¸å…¶åœ¨å˜é‡ç±»å‹ä¸Šçš„å½±å“

@command{awk} æ˜¯ä¸€ç§éå¸¸éšæ„çš„è¯­è¨€ã€‚@command{awk} æœ‰å¯èƒ½åŠæ³•å‘Šè¯‰ä½ ä¸€ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªæ ‡é‡å˜é‡è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç›´åˆ°è¿è¡Œæ—¶æ‰ä¼šçŸ¥é“ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨æ¥è¯´æ˜çš„ä¾‹å­ç¨‹åºï¼š

@example
function foo(a)
@{
    a[1] = 1   # parameter is an array
@}

BEGIN @{
    b = 1
    foo(b)  # invalid: fatal type mismatch

    foo(x)  # x uninitialized, becomes an array dynamically
    x = 1   # now not allowed, runtime error
@}
@end example

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ @code{foo()} ä¼šäº§ç”Ÿä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼Œæ‰€ä»¥ @command{awk} ä¸ä¼šæŠ¥å‘Šç¬¬äºŒä¸ªé”™è¯¯ã€‚å¦‚æœä½ å°†è¿™ä¸ªè°ƒç”¨æ³¨é‡Šæ‰ï¼Œåˆ™ @command{awk} ä¼šæŠ¥ç¬¬äºŒä¸ªé”™è¯¯ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§äº‹ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯å€¼å¾—æ³¨æ„ã€‚

@node Indirect Calls
@section é—´æ¥å‡½æ•°è°ƒç”¨

@cindex indirect function calls
@cindex function calls, indirect
@cindex function pointers
@cindex pointers to functions
@cindex differences in @command{awk} and @command{gawk}, indirect function calls

è¿™ä¸€èŠ‚æè¿°äº†ä¸€ç§é«˜çº§çš„ï¼Œç‰¹å®šäº @command{gawk} çš„æ‰©å±•ã€‚

ç»å¸¸çš„ï¼Œä½ å¸Œæœ›åœ¨ç›´æ¥è¿è¡Œæ—¶æ‰ç¡®å®šä½ è¦è°ƒç”¨çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œä½ æœ‰ä¸åŒç±»å‹çš„è®°å½•ï¼Œæ¯ä¸€ä¸ªéƒ½è¦æœ‰ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚

æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½ ä¸å¾—ä¸ç”¨ä¸€ç³»åˆ—çš„ @code{if}-@code{else} è¯­å¥æ¥å†³å®šè¦è°ƒç”¨å“ªä¸€ä¸ªå‡½æ•°ã€‚é€šè¿‡ä½¿ç”¨@dfn{é—´æ¥}å‡½æ•°è°ƒç”¨ï¼Œä½ å¯ä»¥æŒ‡å®šå‡½æ•°çš„åå­—ä¸ºä¸€ä¸ªå­—ä¸²ï¼Œç„¶åæ¥å†è°ƒç”¨å‡½æ•°ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€ä¾‹å­ï¼š

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢æœ‰ä½ çš„é€‰æ‹©çš„è¯¾ç¨‹çš„æµ‹è¯•æˆç»©ï¼Œå¹¶ä¸”ä½ å¸Œæœ›å–å¾—è¿™äº›æˆç»©çš„æ€»åˆä¸å¹³å‡å€¼ã€‚ç¬¬ä¸€ä¸ªåŸŸæ˜¯ä¸€ä¸ªè¯¾ç¨‹åã€‚åé¢çš„åŸŸæ˜¯å‡½æ•°è°ƒç”¨è¦å¤„ç†çš„æ•°ç»„ï¼Œç›´åˆ°ä¸€ä¸ªåŸŸæ ‡è¯† @samp{data:} ä¸ºæ­¢ï¼Œåœ¨æ ‡è¯†åé¢åˆ°è®°å½•çš„æœ«å°¾ï¼Œéƒ½æ˜¯ä¸€ç³»åˆ—çš„æµ‹è¯•æˆç»©ã€‚

è¿™é‡Œæœ€å¼€å§‹çš„æ–‡ä»¶ï¼š

@example
@c file eg/data/class_data1
Biology_101 sum average data: 87.0 92.4 78.5 94.9
Chemistry_305 sum average data: 75.2 98.3 94.7 88.2
English_401 sum average data: 100.0 95.6 87.1 93.4
@c endfile
@end example

ä¸ºäº†å¤„ç†æ•°æ®ï¼Œä½ å¯èƒ½å¼€å§‹è¿™ä¹ˆå†™ï¼š

@example
@{
    class = $1
    for (i = 2; $i != "data:"; i++) @{
        if ($i == "sum")
            sum()   # processes the whole record
        else if ($i == "average")
            average()
        @dots{}           # and so on
    @}
@}
@end example

@noindent
è¿™æ ·é£æ ¼çš„ç¨‹åºä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯çœ‹èµ·æ¥æœ‰ç‚¹åˆ«æ‰­ã€‚é€šè¿‡@dfn{é—´æ¥}å‡½æ•°è°ƒç”¨ï¼Œä½ å‘Šè¯‰ @command{gawk} ä½¿ç”¨å‡½æ•°@emph{åç§°}å˜é‡çš„@emph{å€¼}ä½œä¸ºå‡½æ•°æ¥è°ƒç”¨ã€‚

@cindex @code{@@}-notation for indirect function calls
@cindex indirect function calls, @code{@@}-notation
@cindex function calls, indirect, @code{@@}-notation for
è¯­æ³•éå¸¸ç±»ä¼¼äºå¸¸è§„çš„å‡½æ•°è°ƒç”¨ï¼šä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œåé¢è·Ÿç€ä¸€ä¸ªå¼€æ‹¬å·ï¼Œæ‰€æœ‰çš„å‚æ•°ï¼Œç„¶åæ˜¯ä¸€ä¸ªé—­æ‹¬å·ï¼ŒåŠ ä¸Šä¸€ä¸ªå‰å¯¼çš„ @samp{@@} ç¬¦å·ï¼š

@example
the_func = "sum"
result = @@the_func()   # calls the sum() function
@end example

è¿™æ˜¯å¤„ç†å‰æ‰€ç¤ºçš„æ•°æ®çš„å®Œæ•´ç¨‹åºï¼Œä½¿ç”¨çš„æ˜¯é—´æ¥å‡½æ•°è°ƒç”¨ï¼š

@example
@c file eg/prog/indirectcall.awk
# indirectcall.awk --- Demonstrate indirect function calls
@c endfile
@ignore
@c file eg/prog/indirectcall.awk
#
# Arnold Robbins, arnold@skeeve.com, Public Domain
# January 2009
@c endfile
@end ignore

@c file eg/prog/indirectcall.awk
# average --- return the average of the values in fields $first - $last

function average(first, last,   sum, i)
@{
    sum = 0;
    for (i = first; i <= last; i++)
        sum += $i

    return sum / (last - first + 1)
@}

# sum --- return the sum of the values in fields $first - $last

function sum(first, last,   ret, i)
@{
    ret = 0;
    for (i = first; i <= last; i++)
        ret += $i

    return ret
@}
@c endfile
@end example

è¿™ä¸¤ä¸ªå‡½æ•°æœŸæœ›æ˜¯å·¥ä½œäºåŸŸï¼Œå› æ­¤ï¼Œå‚æ•° @code{first} ä¸ @code{last} è¡¨ç¤ºåŸŸå¤„ç†çš„å¼€å§‹ä¸ç»“æŸã€‚å¦åˆ™ï¼Œå®ƒä»¬æ‰§è¡Œæ˜¯æœŸæœ›çš„è®¡ç®—ä½†ä¸æ­£ç¡®ï¼š

@example
@c file eg/prog/indirectcall.awk
# For each record, print the class name and the requested statistics
@{
    class_name = $1
    gsub(/_/, " ", class_name)  # Replace _ with spaces

    # find start
    for (i = 1; i <= NF; i++) @{
        if ($i == "data:") @{
            start = i + 1
            break
        @}
    @}

    printf("%s:\n", class_name)
    for (i = 2; $i != "data:"; i++) @{
        the_function = $i
        printf("\t%s: <%s>\n", $i, @@the_function(start, NF) "")
    @}
    print ""
@}
@c endfile
@end example

è¿™æ˜¯å¤„ç†æ¯ä¸ªè®°å½•çš„ä¸»è¿‡ç¨‹ã€‚å®ƒæ‰“å°è¯¾ç¨‹åï¼ˆå°†ä¸‹åˆ’çº¿æ›¿æ¢æˆç©ºæ ¼ï¼‰ã€‚ç„¶åæŸ¥æ‰¾å®é™…æ•°æ®çš„å¼€å§‹ï¼Œå¹¶å°†å®ƒä¿å­˜åœ¨ @code{start} ä¸­ã€‚
ä»£ç çš„æœ€åä¸€éƒ¨åˆ†æ˜¯å¾ªç¯æ¯ä¸€ä¸ªå‡½æ•°åï¼ˆä» @code{$2} åˆ° @samp{data:} æ ‡è¯†ï¼‰ï¼Œè°ƒç”¨åŸŸæ‰€è¡¨ç¤ºçš„åå­—ã€‚é—´æ¥è°ƒç”¨å‡½æ•°å°†å…¶ä½œä¸º @code{printf} å‡½æ•°çš„ä¸€ä¸ªå‚æ•°ã€‚
ï¼ˆ@code{printf} çš„æ ¼å¼ä¸²ä½¿ç”¨ @samp{%s} ä½œä¸ºæ ¼å¼æŒ‡å®šç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿”å›å­—ä¸²çš„å‡½æ•°ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬æ•°å€¼ã€‚æ³¨æ„ä»é—´æ¥è°ƒç”¨è¿”å›çš„ç»“æœä¸ç©ºä¸²è¿›è¡Œåˆå¹¶ï¼Œæ˜¯ä¸ºå°†å…¶å¼ºåˆ¶è½¬æ¢ä¸ºå­—ä¸²å€¼ã€‚ï¼‰

è¿™æ˜¯æ‰§è¡Œç¨‹åºçš„ç»“æœï¼š

@example
$ @kbd{gawk -f indirectcall.awk class_data1}
@print{} Biology 101:
@print{}     sum: <352.8>
@print{}     average: <88.2>
@print{}
@print{} Chemistry 305:
@print{}     sum: <356.4>
@print{}     average: <89.1>
@print{}
@print{} English 401:
@print{}     sum: <376.1>
@print{}     average: <94.025>
@end example

å¯ä»¥ä½¿ç”¨é—´æ¥å‡½æ•°è°ƒç”¨çš„èƒ½åŠ›æ¯”åˆçœ‹èµ·æ¥è¦å¼ºå¤§å¾—å¤šã€‚C ä¸ C++ è¯­è¨€æä¾›äº†â€œå‡½æ•°æŒ‡é’ˆâ€ï¼Œé‚£ä¹Ÿæ˜¯ä¸€ä¸ªåœ¨æ‰§è¡Œæ—¶é€‰æ‹©è°ƒç”¨å‡½æ•°çš„æœºåˆ¶ã€‚è¿™ä¸ªèƒ½åŠ›ç”¨å¾—æœ€å¤šçš„æ˜¯ C @code{qsort()} å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½¿ç”¨æœ‰åçš„å¿«é€Ÿæ’åº
ï¼ˆæŸ¥çœ‹ @uref{http://en.wikipedia.org/wiki/Quicksort, Wikipedia çš„æ–‡æ¡£} æ¥äº†è§£æ›´å¤šçš„ä¿¡æ¯ï¼‰ç®—æ³•æ¥å¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚ä¸ºäº†ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œä½ éœ€è¦æŒ‡å®šä¸€ä¸ªç”¨äºæ¯”è¾ƒçš„å‡½æ•°æŒ‡é’ˆã€‚è¿™ä¸ªæœºåˆ¶å¯ä»¥ä½¿ç”¨å¯¹ä»»æ„ä»¥åŠä»»ä½•æ–¹å¼å¯¹æ•°æ®è¿›è¡Œæ’åºã€‚

æˆ‘ä»¬ç”¨ @command{gawk} ä¹Ÿå¯ä»¥åšåŒæ ·çš„äº‹æƒ…ï¼Œå¦‚ï¼š

@example
@c file eg/lib/quicksort.awk
# quicksort.awk --- Quicksort algorithm, with user-supplied
#                   comparison function
@c endfile
@ignore
@c file eg/lib/quicksort.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# January 2009

@c endfile
@end ignore
@c file eg/lib/quicksort.awk

# quicksort --- C.A.R. Hoare's quicksort algorithm. See Wikipedia
#               or almost any algorithms or computer science text.
@c endfile
@ignore
@c file eg/lib/quicksort.awk
#
# Adapted from K&R-II, page 110
@c endfile
@end ignore
@c file eg/lib/quicksort.awk

function quicksort(data, left, right, less_than,    i, last)
@{
    if (left >= right)  # do nothing if array contains fewer
        return          # than two elements

    quicksort_swap(data, left, int((left + right) / 2))
    last = left
    for (i = left + 1; i <= right; i++)
        if (@@less_than(data[i], data[left]))
            quicksort_swap(data, ++last, i)
    quicksort_swap(data, left, last)
    quicksort(data, left, last - 1, less_than)
    quicksort(data, last + 1, right, less_than)
@}

# quicksort_swap --- helper function for quicksort, should really be inline

function quicksort_swap(data, i, j,      temp)
@{
    temp = data[i]
    data[i] = data[j]
    data[j] = temp
@}
@c endfile
@end example

@code{quicksort()} å‡½æ•°æ¥æ”¶ @code{data} æ•°ç»„ï¼Œä»¥åŠè¦è¿›è¡Œæ’åºçš„å¼€å§‹ä¸ç»“æŸä¸‹æ ‡ï¼ˆ@code{left} ä¸ @code{right}ï¼‰ï¼Œä»¥åŠæ‰§è¡Œâ€œless thanâ€æ¯”è¾ƒçš„å‡½æ•°åã€‚ä¹‹åå®ç° quicksort ç®—æ³•ã€‚

ä¸ºä½¿ç”¨è¿™ä¸ªæ’åºå‡½æ•°ï¼Œæˆ‘ä»¬å†å›åˆ°ä¹‹å‰çš„ä¾‹å­ã€‚ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦å†™ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼š

@example
@c file eg/prog/indirectcall.awk
# num_lt --- do a numeric less than comparison

function num_lt(left, right)
@{
    return ((left + 0) < (right + 0))
@}

# num_ge --- do a numeric greater than or equal to comparison

function num_ge(left, right)
@{
    return ((left + 0) >= (right + 0))
@}
@c endfile
@end example

@code{num_ge()} å‡½æ•°åœ¨æ‰§è¡Œé™åºæ’åºæ—¶éœ€è¦ï¼Œå½“æ‰§è¡Œ â€œless thanâ€ çš„æµ‹è¯•æ—¶ï¼Œå…¶æ‰§è¡Œçš„åˆšæ‰æ˜¯ç›¸åçš„ï¼ˆå³å¤§äºæˆ–è€…ç­‰äºï¼‰ï¼Œè¿™ä¼šäº§ç”Ÿä¸€ä¸ªé™åºã€‚

ä¸‹é¢åˆ™æ˜¯æ’åºå‡½æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªå‚æ•°åŒ–äº† starting ä¸ ending åŸŸæ•°å€¼ä¸æ¯”è¾ƒå‡½æ•°çš„å‡½æ•°ã€‚å®ƒåˆ›å»ºæœ‰ data æ•°ç»„å¹¶è°ƒç”¨ @code{quicksort()} å‡½æ•°ã€‚ç„¶åå°†ç»“æœä½œä¸ºä¸€ä¸ªå­—ä¸²è¾“å‡ºï¼š

@example
@c file eg/prog/indirectcall.awk
# do_sort --- sort the data according to `compare'
#             and return it as a string

function do_sort(first, last, compare,      data, i, retval)
@{
    delete data
    for (i = 1; first <= last; first++) @{
        data[i] = $first
        i++
    @}

    quicksort(data, 1, i-1, compare)

    retval = data[1]
    for (i = 2; i in data; i++)
        retval = retval " " data[i]

    return retval
@}
@c endfile
@end example

æœ€åï¼Œä¸¤ä¸ªæ’åºå‡½æ•°è°ƒç”¨ @code{do_sort()}ï¼Œå¹¶å°†ä¸¤ä¸ªæ¯”è¾ƒå‡½æ•°åä¼ é€’è¿›å»ï¼š

@example
@c file eg/prog/indirectcall.awk
# sort --- sort the data in ascending order and return it as a string

function sort(first, last)
@{
    return do_sort(first, last, "num_lt")
@}

# rsort --- sort the data in descending order and return it as a string

function rsort(first, last)
@{
    return do_sort(first, last, "num_ge")
@}
@c endfile
@end example

è¿™æ˜¯@value{DF}çš„æ‰©å±•ç‰ˆæœ¬ï¼š

@example
@c file eg/data/class_data2
Biology_101 sum average sort rsort data: 87.0 92.4 78.5 94.9
Chemistry_305 sum average sort rsort data: 75.2 98.3 94.7 88.2
English_401 sum average sort rsort data: 100.0 95.6 87.1 93.4
@c endfile
@end example

æœ€åï¼Œè¿™æ˜¯å¢å¼ºè¿‡çš„ç¨‹åºçš„è¿è¡Œç»“æœï¼š

@example
$ @kbd{gawk -f quicksort.awk -f indirectcall.awk class_data2}
@print{} Biology 101:
@print{}     sum: <352.8>
@print{}     average: <88.2>
@print{}     sort: <78.5 87.0 92.4 94.9>
@print{}     rsort: <94.9 92.4 87.0 78.5>
@print{}
@print{} Chemistry 305:
@print{}     sum: <356.4>
@print{}     average: <89.1>
@print{}     sort: <75.2 88.2 94.7 98.3>
@print{}     rsort: <98.3 94.7 88.2 75.2>
@print{}
@print{} English 401:
@print{}     sum: <376.1>
@print{}     average: <94.025>
@print{}     sort: <87.1 93.4 95.6 100.0>
@print{}     rsort: <100.0 95.6 93.4 87.1>
@end example

å¦ä¸€ä¸ªä½¿ç”¨é—´æ¥å‡½æ•°éå¸¸æœ‰ç”¨çš„åœ°æ–¹å¯ä»¥åœ¨å¤„ç†æ•°ç»„çš„åœ°æ–¹æ‰¾åˆ°ã€‚è¿™åœ¨ @ref{Walking Arrays}ï¼Œä¸­æœ‰æè¿°ã€‚

è¦è®°ä½ï¼Œåœ¨è°ƒç”¨é—´æ¥å‡½æ•°ä¹‹å‰ï¼Œå¿…é¡»åœ¨å…¶å‰é¢æ”¾ç½®ä¸€ä¸ª @samp{@@} ç¬¦å·ã€‚

ä» 4.1.2 @value{PVERSION}å¼€å§‹ï¼Œ@command{gawk} é—´æ¥è°ƒç”¨ä¹Ÿå¯ä»¥ç”¨äºå†…ç½®å‡½æ•°ä»¥åŠæ‰©å±•å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Dynamic Extensions}ï¼‰ã€‚ä»–ä»¬åœ¨ä½¿ç”¨é—´æ¥è°ƒç”¨å†…ç½®å‡½æ•°æ—¶æœ‰ä¸€äº›é™åˆ¶ï¼Œå¦‚ä¸‹ï¼š

@itemize @value{BULLET}
@item
é€šè¿‡é—´æ¥è°ƒç”¨ï¼Œä½ ä¸å¯ä»¥ä¼ é€’æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡åˆ°ä¸€ä¸ªå†…ç½®å‡½æ•°ä¸­ã€‚
@footnote{è¿™ä¸ªåœ¨æœªæ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šæ”¹å˜ï¼šè¦æ£€æŸ¥ä¸ä½ çš„ @command{gawk} ä¸€èµ·çš„æ–‡æ¡£æ¥æŸ¥çœ‹æ˜¯å¦å·²ç»æ”¹å˜ã€‚}
è¿™åŒæ—¶ä¹Ÿé€‚ç”¨äº @code{sub()}ï¼Œ@code{gsub()}ï¼Œ@code{gensub()}ï¼Œ@code{match()}ï¼Œ@code{split()} ä¸ @code{patsplit()} å‡½æ•°ã€‚

@item
å¦‚æœè°ƒç”¨ @code{sub()} æˆ–è€… @code{gsub()}ï¼Œä½ åªå¯ä»¥ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°é€šå¸¸ä¼šæ›´æ”¹å®ƒå®ƒä»¬çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚è¿™è¡¨ç¤º @code{$0} ä¼šè¢«æ”¹å˜ã€‚
@end itemize

@command{gawk} ä¼šå°½åŠ›åœ°ä½¿é—´æ¥å‡½æ•°è°ƒç”¨éå¸¸é«˜æ•ˆã€‚å¦‚ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼š

@example
for (i = 1; i <= n; i++)
    @@the_func()
@end example

@noindent
@command{gawk} å®é™…ä¸ŠåªæŸ¥æ‰¾ä¸€æ¬¡è¦è°ƒç”¨çš„å‡½æ•°ã€‚

@node Functions Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
@command{awk} æä¾›äº†å†…ç½®å‡½æ•°ï¼Œä¹Ÿå¯ä»¥è®©ä½ è‡ªå·±å®šä¹‰å‡½æ•°ã€‚

@item
POSIX @command{awk} æä¾›äº†ä¸‰ç§å†…ç½®å‡½æ•°ï¼šæ•°å€¼ï¼Œå­—ä¸²ä¸ I/Oã€‚@command{gawk} æä¾›äº†å¯¹æ•°ç»„æ’åºçš„å‡½æ•°ï¼Œå¤„ç†æ—¶é—´çš„å‡½æ•°ï¼Œæ‰§è¡Œä½æ“ä½œçš„å‡½æ•°ï¼Œç¡®å®šå˜é‡ç±»å‹çš„å‡½æ•°ï¼ˆæ•°ç»„è¿˜æ˜¯æ ‡é‡ï¼‰ï¼Œä¸å›½é™…åŒ–ä¸æœ¬åœ°åŒ–çš„å‡½æ•°ã€‚@command{gawk} ä¹Ÿæä¾›äº†æ ‡å‡†å‡½æ•°çš„æ‰©å±•ï¼Œå…¸å‹çš„æ˜¯é’ˆå¯¹é¢å¤–å‚æ•°çš„å½¢å¼ã€‚

@item
å‡½æ•°æ¥æ”¶ 0 ä¸ªæˆ–è€…æ›´å¤šçš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚æä¾›å‚æ•°å€¼çš„è¡¨è¾¾å¼åœ¨å‡½æ•°è°ƒç”¨å‰ä¼šé¦–å…ˆå…¨éƒ¨æ±‚å€¼ã€‚æ±‚å€¼çš„é¡ºåºæ˜¯æœªå®šä¹‰çš„ã€‚è¿”å›å€¼å¯ä»¥è¢«å¿½ç•¥ã€‚

@item
@code{sub()} ä¸ @code{gsub()} å‡½æ•°å¯¹äºåæ–œæ çš„å¤„ç†æœ‰ç‚¹å¤æ‚ã€‚åœ¨ @command{gawk} çš„ @code{gensub()} å‡½æ•°ä¸­åˆ™æ›´ç›´æ¥ä¸€ç‚¹ï¼Œä½†æ˜¯ä½¿ç”¨è¿™ä¸ªå‡½æ•°ä¹Ÿéœ€è¦æ³¨æ„ã€‚

@item
ç”¨æˆ·å®šä¹‰çš„å‡½æ•°æä¾›äº†å¾ˆé‡è¦çš„èƒ½åŠ›ï¼Œä½†æ˜¯å…¶è¯­æ³•ç¡®å¹¶ä¸ä¼˜é›…ã€‚åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œåœ¨å‡½æ•°åä¸å‚æ•°åˆ—è¡¨çš„å¼€æ‹¬å·ä¹‹é—´ä¸å¯ä»¥æœ‰ç©ºæ ¼ã€‚ä¹Ÿæ²¡æœ‰æä¾›æœ¬åœ°å˜é‡ï¼Œæ‰€ä»¥ä¹ æƒ¯æ˜¯æ·»åŠ é¢å¤–çš„å‚æ•°ï¼Œå¹¶ç”¨ç©ºæ ¼å¯è§†åŒ–åœ°å°†å®ƒä»¬ä¸å‚æ•°åˆ—è¡¨åˆ†å¼€ã€‚

@item
ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å¯ä»¥è°ƒç”¨å…¶ä»–çš„ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆä»¥åŠå†…ç½®å‡½æ•°ï¼‰ï¼Œä¹Ÿå¯ä»¥é€’å½’åœ°è°ƒç”¨å®ƒä»¬è‡ªå·±ã€‚å‡½æ•°å‚æ•°ä¼šâ€œéšè—â€ä»»ä½•çš„åŒåçš„å…¨å±€å‚æ•°ã€‚ä½ ä¸å¯ä»¥ä½¿ç”¨ä¿ç•™çš„å˜é‡ï¼ˆå¦‚ @code{ARGC} æ¥ä½œä¸ºè‡ªå®šä¹‰å‡½æ•°çš„å‚æ•°åå­—ã€‚

@item
æ ‡é‡å€¼æ˜¯é€šè¿‡ä¼ å€¼æ–¹å¼ä¼ é€’åˆ°ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°çš„ã€‚æ•°ç»„å‚æ•°åˆ™æ˜¯é€šè¿‡ä¼ å¼•ç”¨ï¼Œå‡½æ•°å¯¹äºæ•°ç»„çš„ä»»ä½•æ”¹å˜éƒ½ä¼šåœ¨å‡½æ•°è¿”å›ä¹‹åå¯è§ã€‚

@item
ä½¿ç”¨ @code{return} è¯­è¨€æ¥ä»ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¸­è¿”å›ã€‚å¯é€‰çš„è¡¨è¾¾å¼æˆä¸ºå‡½æ•°çš„è¿”å›å€¼ã€‚å‡½æ•°åªå¯ä»¥è¿”å›æ ‡é‡å€¼ã€‚

@item
å¦‚æœä¼ é€’åˆ°ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¸­çš„å˜é‡ä»æ¥æ²¡æœ‰è¢«ä½¿ç”¨è¿‡ï¼Œé‚£ä¹ˆå‡½æ•°å¦‚ä½•æ¥çœ‹å¾…è¿™ä¸ªå˜é‡ï¼šè¦ä¹ˆæ˜¯æ ‡é¢˜è¦ä¹ˆæ˜¯æ•°ç»„ã€‚

@item
@command{gawk} ä½¿ç”¨ç‰¹æ®Šè¯­æ³•ï¼Œæä¾›äº†é—´æ¥å‡½æ•°è°ƒç”¨ã€‚é€šè¿‡å°†æŸä¸ªå˜é‡çš„å€¼è®¾ç½®æˆå‡½æ•°åï¼Œä½ å¯ä»¥åœ¨è¿è¡Œæ—¶ç¡®å®šåœ¨æƒ³è¯´ç‚¹è¦è°ƒç”¨çš„å‡½æ•°ã€‚è¿™ä¸ªä¸ C è·Ÿ C++ ä¸­çš„å‡½æ•°æŒ‡é’ˆç­‰åŒã€‚

@end itemize


@ifnotinfo
@part @value{PART2}ç”¨ @command{awk} æ¥è§£å†³é—®é¢˜
@end ifnotinfo

@ifdocbook
Part II shows how to use @command{awk} and @command{gawk} for problem solving.
There is lots of code here for you to read and learn from.
It contains the following chapters:

@itemize @value{BULLET}
@item
@ref{Library Functions}

@item
@ref{Sample Programs}
@end itemize
@end ifdocbook

@node Library Functions
@chapter @command{awk} å‡½æ•°åº“
@cindex libraries of @command{awk} functions
@cindex functions, library
@cindex functions, user-defined, library of

åœ¨ @ref{User-defined}ï¼Œæè¿°äº†å¦‚ä½•æ¥å†™ä½ è‡ªå·±çš„ @command{awk} å‡½æ•°ã€‚å†™å‡½æ•°æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©ä½ å°†ç®—æ³•ä¸ç¨‹åºä»»åŠ¡å°é—­åœ¨ä¸€ä¸ªå•ç‹¬çš„åœ°æ–¹ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿç®€åŒ–ç¼–ç¨‹ï¼Œä½¿å¾—ç¨‹åºå¼€å‘æ›´æœ‰å¯ç®¡ç†æ€§ï¼Œæ›´å¯è¯»ã€‚

@cindex Kernighan, Brian
@cindex Plauger, P.J.@:
Brian Kernighan ä¸ P.J.@: Plauger åœ¨ä»–ä»¬ 1976 å¹´çš„ä¹¦ï¼Œ@cite{Software Tools} 
@footnote{å¾ˆæƒ¨çš„æ˜¯ï¼Œ35 å¹´ä¹‹åï¼Œè¿™æœ¬ä¹¦ä¸­æ‰€æ•™çš„ç»éªŒè¿˜æ²¡æœ‰è¢«å¤§é‡çš„å®è·µä¸­çš„ç¨‹åºå‘˜æ‰€å­¦åˆ°ã€‚}
ä¸­å†™åˆ°ï¼š

@quotation
å¥½çš„ç¼–ç¨‹ä¸æ˜¯ä»ä¸€èˆ¬æ€§æ¥å­¦ä¹ ï¼Œè€Œæ˜¯é€šè¿‡è¿ç”¨å¸¸è¯†ä¸ç¼–ç¨‹å®è·µï¼Œçœ‹ç¨‹åºå¦‚ä½•èƒ½å¤Ÿå†™å¾—æ¸…æ™°ï¼Œæ˜“è¯»ï¼Œæ˜“ç»´æŠ¤ä¸ä¿®æ”¹ï¼Œå¯è¢«äººå·¥ç¨‹åŒ–ï¼Œé«˜æ•ˆä¸å¯é ã€‚ä»”ç»†å­¦ä¹ ä¸æ¨¡æ‹Ÿå¥½çš„ç¼–ç¨‹å¯ä»¥å†™å¾—æ›´å¥½ã€‚
@end quotation

å®é™…ä¸Šï¼Œä»–ä»¬è§‰å¾—è¿™äº›æ€æƒ³æ˜¯å¦‚ä½•é‡è¦ï¼Œä»¥è‡´äºå®ƒä»¬å°†è¿™ä¸ªè¡¨è¿°æ”¾åœ¨ä¹¦çš„å°é¢ä¸Šã€‚ç”±äºæˆ‘ä»¬å¼ºçƒˆåœ°è®¤ä¸ºè¿™ä¸ªè¡¨è¿°æ˜¯æ— æ­¤æ­£ç¡®çš„ï¼Œæ‰€åœ¨åœ¨è¿™@value{CHAPTER}ä¸­ä¸ @ref{Sample Programs}ï¼Œæä¾›äº†å¤§å°åˆé€‚çš„ä»£ç æ¥è®©ä½ å­¦ä¹ ï¼Œæˆ‘ä»¬å¸Œæœ›ä½ èƒ½ä»ä¸­å­¦åˆ°ä»€ä¹ˆã€‚

è¿™ä¸€@value{CHAPTER}å‘ˆç°äº† @command{awk} ä¸­æœ‰å¾ˆæœ‰ç”¨çš„å‡½æ•°åº“ã€‚å¾ˆå¤šåé¢çš„ä¾‹å­ä»£ç éƒ½ä½¿ç”¨è¿™äº›å‡½æ•°ã€‚è¿™é‡Œå‘ˆç°çš„å‡½æ•°ä»ç®€å•åˆ°å¤æ‚è¿›è¡Œå˜åŒ–ã€‚

@cindex Texinfo
åœ¨ @ref{Extract Program}ï¼Œä¸­æäº¤äº†ä¸€ä¸ªç¨‹åºï¼Œä½ å¯ä»¥ç”¨æ¥ä»è¿™äº›ä¾‹å­åº“å‡½æ•°ä¸­æå–æºä»£ç ï¼Œä»¥åŠä»æœ¬@value{DOCUMENT}çš„ Texinfo æºä»£ç ä¸­æå‡ºç¨‹åºã€‚ï¼ˆè¿™å·²ç»ä½œä¸º @command{gawk} å‘è¡Œç‰ˆæœ¬çš„ä¸€éƒ¨ä»½å®Œæˆäº†ã€‚ï¼‰

@ifclear FOR_PRINT
å¦‚æœä½ å†™äº†ä¸€äº›æœ‰ç”¨çš„ï¼Œé€šç”¨ç›®çš„çš„ @command{awk} ç¨‹åºï¼Œå¹¶ä¸”æƒ³å°†å®ƒä»¬è´¡çŒ®ç»™ @command{awk} ç¤¾åŒºï¼ŒæŸ¥çœ‹ @ref{How To Contribute}ï¼Œæ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚
@end ifclear

@cindex portability, example programs
è¿™ä¸€@value{CHAPTER}ä»¥åŠ @ref{Sample Programs} ä¸­çš„ç¨‹åºï¼Œå¯ä»¥è‡ªç”±åœ°ä½¿ç”¨ @command{gawk} ç‰¹æœ‰çš„ç‰¹æ€§ã€‚ä¸ºä¸åŒçš„ @command{awk} å®ç°é‡å†™è¿™äº›ç¨‹åºä¹Ÿç›¸å½“åœ°ç›´æ¥ï¼š

@itemize @value{BULLET}
@item
åŒºåˆ«é”™è¯¯ä¿¡æ¯å¹¶å‘é€åˆ° @file{/dev/stderr}ã€‚å¦‚æœä½ çš„ç³»ç»Ÿä¸­æ²¡æœ‰ @file{/dev/stderr}ï¼Œæˆ–è€…ä½ æ— æ³•ä½¿ç”¨ @command{gawk}ï¼Œ
åˆ™ä½¿ç”¨ @samp{| "cat 1>&2"} è€Œä¸æ˜¯ @samp{> "/dev/stderr"}ã€‚

@item
æœ‰å¾ˆå¤šçš„ç¨‹åºä¸­ä½¿ç”¨ @code{nextfile}ï¼ˆæŸ¥çœ‹ @pxref{Nextfile Statement}ï¼‰æ¥è·³è¿‡ä»»æ„å‰©ä¸‹çš„è¾“å…¥æ–‡ä»¶çš„è¾“å…¥ã€‚

@item
@c 12/2000: Thanks to Nelson Beebe for pointing out the output issue.
@cindex case sensitivity, example programs
@cindex @code{IGNORECASE} variable, in example programs
æœ€åï¼ŒæŸäº›ç¨‹åºé€‰æ‹©å¿½ç•¥è¾“å…¥ä¸­çš„å¤§å°å†™ã€‚å®ƒä»¬æ˜¯é€šè¿‡å°† @code{IGNORECASE} èµ‹å€¼ä¸º 1 æ¥å®ç°çš„ã€‚ä½ å¯ä»¥å¾—åˆ°å‡ ä¹ç›¸åŒçš„æ•ˆæœï¼Œ
@footnote{æ•ˆæœæ˜¯ä¸å®Œå…¨ç›¸åŒã€‚å˜åŒ–è®°å½•çš„è¾“å‡ºæ‰€æœ‰çš„éƒ½æ˜¯å°å†™ã€‚è€Œ @code{IGNORECASE} ä¿æŒäº†è¾“å…¥è®°å½•çš„æœ€åˆå€¼ã€‚}
åªè¦å°†ä¸‹é¢çš„è§„åˆ™åŠ åˆ°ç¨‹åºçš„å¼€å§‹ï¼š

@example
# ignore case
@{ $0 = tolower($0) @}
@end example

@noindent
åŒæ—¶ï¼Œç¡®å®šæ‰€æœ‰çš„æ­£åˆ™è¡¨è¾¾å¼ä»¥åŠç”¨åœ¨æ¯”è¾ƒä¸­çš„å­—ä¸²å¸¸é‡å…¨éƒ½æ˜¯å°å†™å­—æ¯ã€‚
@end itemize

@menu
* Library Names::               How to best name private global variables in
                                library functions.
* General Functions::           Functions that are of general use.
* Data File Management::        Functions for managing command-line data
                                files.
* Getopt Function::             A function for processing command-line
                                arguments.
* Passwd Functions::            Functions for getting user information.
* Group Functions::             Functions for getting group information.
* Walking Arrays::              A function to walk arrays of arrays.
* Library Functions Summary::   Summary of library functions.
* Library Exercises::           Exercises.
@end menu

@node Library Names
@section å‘½åå‡½æ•°åº“çš„å…¨å±€å˜é‡

@cindex names, arrays/variables
@cindex names, functions
@cindex namespace issues
@cindex @command{awk} programs, documenting
@cindex documentation, of @command{awk} programs
ç”±äº @command{awk} è¯­è¨€çš„æ¼”åŒ–æ–¹æ¡ˆï¼Œå˜é‡è¦ä¹ˆæ˜¯@dfn{å…¨å±€}çš„ï¼ˆå¯ä»¥åœ¨æ•´ä¸ªç¨‹åºä¸­ä½¿ç”¨ï¼‰ï¼Œè¦ä¹ˆæ˜¯@dfn{æœ¬åœ°}çš„ï¼ˆåªåœ¨ç‰¹å®šçš„å‡½æ•°ä¸­ä½¿ç”¨ï¼‰ã€‚æ²¡æœ‰ä¸ C ä¸­çš„ @code{static} å˜é‡ç±»ä¼¼çš„ä¸­é—´çŠ¶æ€ã€‚

@cindex variables, global, for library functions
@cindex private variables
@cindex variables, private
åº“å‡½æ•°å¸¸å¸¸éœ€è¦æœ‰å…¨å±€å˜é‡æ¥ä¿å­˜åœ¨è°ƒç”¨å‡½æ•°ä¹‹é—´çš„çŠ¶æ€ä¿¡æ¯â€”â€”æ¯”å¦‚ï¼Œ@code{getopt()} çš„å˜é‡ @code{_opti}ï¼ˆæŸ¥çœ‹ @pxref{Getopt Function}ï¼‰ã€‚è¿™æ ·çš„å˜é‡ç§°ä¸º@dfn{ç§æœ‰}å˜é‡ï¼Œå› ä¸ºåœ¨åº“ä¸­ä½¿ç”¨å®ƒä»¬çš„å‡½æ•°åªæœ‰ä¸€ä¸ªã€‚

å½“å†™ä¸€ä¸ªåº“å‡½æ•°çš„æ—¶å€™ï¼Œä½ åº”è¯¥è¦å°è¯•é€‰æ‹©ä½ è‡ªå·±çš„ç§æœ‰å˜é‡çš„åå­—ï¼Œè¿™æ ·ä¸ä¼šä¸å…¶ä»–çš„åº“å‡½æ•°æˆ–è€…ç”¨æˆ·ä¸»ç¨‹åºæ‰€ä½¿ç”¨çš„å˜é‡å†²çªã€‚å¦‚åƒåå­— @code{i} æˆ–è€… @code{j} å°±ä¸æ˜¯å¥½çš„é€‰æ‹©ï¼Œå› æ­¤ç”¨æˆ·ç¨‹åºå¸¸å¸¸ä½¿ç”¨è¿™äº›ç±»ä¼¼çš„åå­—æ¥ç”¨ä»»è‡ªå·±çš„ç›®çš„ã€‚

@cindex programming conventions, private variable names
åœ¨æœ¬@value{CHAPTER}ä¸­å‘ˆç°çš„ä¾‹å­ä»£ç ä¸­ï¼Œæ‰€æœ‰ç§æœ‰å˜é‡çš„åå­—éƒ½ä»¥ä¸‹åˆ’çº¿å¼€å§‹ï¼ˆ@samp{_}ï¼‰ã€‚ç”¨æˆ·ä¸€èˆ¬æ¥è¯´ä¸ä¼šä½¿ç”¨å‰å¯¼çš„ä¸‹åˆ’çº¿æ¥å‘½åå˜é‡ï¼Œæ‰€ä»¥è¿™æ ·çš„æƒ¯ä¾‹ç«‹å³é™ä½äº†å˜é‡åå­—å¶ç„¶ä¸ç”¨æˆ·ç¨‹åºå†²çªçš„æœºç‡ã€‚

@cindex @code{_} (underscore), in names of private variables
@cindex underscore (@code{_}), in names of private variables
å¦å¤–ï¼Œæœ‰å‡ ä¸ªåº“å‡½æ•°è¿˜ä½¿ç”¨ç›¸åº”çš„å‰ç¼€ï¼Œç”¨æ¥æŒ‡ç¤ºä»€ä¹ˆæ ·çš„å‡½æ•°æˆ–è€…å‡½æ•°é›†æ¥ä½¿ç”¨å˜é‡â€”â€”å¦‚ï¼Œåœ¨ç”¨æˆ·æ•°æ®åº“ä¾‹ç¨‹ä¸­çš„ @code{_pw_byname()}ï¼ˆæŸ¥çœ‹ @pxref{Passwd Functions}ï¼‰ã€‚è¿™æ ·çš„æƒ¯ä¾‹æˆ‘ä»¬æ˜¯æ¨èçš„ï¼Œå› ä¸ºè¿™æ›´è¿›ä¸€æ­¥é™ä½äº†ä¸å°å¿ƒçš„å˜é‡åå­—å†²çªæœºç‡ã€‚è¦æ³¨æ„ï¼Œè¿™æ ·çš„æƒ¯ä¾‹ä¹Ÿå¯ç”¨äºå˜é‡åä¸ç§æœ‰å‡½æ•°åã€‚ 
@footnote{å°½ç®¡æ‰€æœ‰çš„åº“ä¾‹ç¨‹éƒ½ä½¿ç”¨è¿™æ ·çš„æƒ¯ä¾‹è¿›è¡Œäº†é‡å†™ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å®Œæˆã€‚ä¸ºäº†æ˜¾ç¤ºæˆ‘ä»¬è‡ªå·±çš„ @command{awk} ç¨‹åºé£æ ¼çš„æ¼”åŒ–ï¼Œä¹Ÿä¸ºäº†è¿™äº›è®¨è®ºæä¾›ä¸€äº›åŸºç¡€ç´ æã€‚}

åœ¨å‡½æ•°å‘½åä¸Šè¿˜æœ‰æœ€åä¸€ä¸ªæç¤ºï¼Œå¦‚æœå‡½æ•°ä½¿å…¨å±€å˜é‡å¯è¢«ä¸»ç¨‹åºä½¿ç”¨ï¼Œé‚£ä¹ˆæƒ¯ä¾‹ä¸Šéœ€è¦ä»¥ä¸€ä¸ªå¤§å†™å­—æ¯æ¥å¼€å§‹å˜é‡çš„åå­—â€”â€”å¦‚ @code{getopt()} çš„ @code{Opterr} ä¸ @code{Optind} å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{Getopt Function}ï¼‰ã€‚å‰å¯¼çš„å¤§å†™å­—æ¯è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè€Œå˜é‡çš„åå­—ä¸å…¨æ˜¯å¤§å†™å­—æ¯åˆ™æ˜¯è¡¨ç¤ºå˜é‡ä¸æ˜¯ @command{awk} é¢„å®šä¹‰çš„å˜é‡ï¼Œæ¯”å¦‚ @code{FS}ã€‚

@cindex @option{--dump-variables} option, using for library functions
åœ¨åº“ä¸­çš„å‡½æ•°çš„@emph{æ‰€æœ‰}å˜é‡å®é™…ä¸Šä¸ç”¨äºå­˜å‚¨çŠ¶æ€çš„å˜é‡éƒ½å£°æ˜ä¸ºæœ¬åœ°å˜é‡ä¹Ÿéå¸¸é‡è¦ã€‚
@footnote{@command{gawk} çš„ @option{--dump-variables} å‘½ä»¤è¡Œé€‰é¡¹ç”¨æ¥éªŒè¯è¿™ä¸ªéå¸¸æœ‰ç”¨ã€‚}
å¦‚æœä¸æ˜¯è¿™ä¹ˆåšçš„ï¼Œå˜é‡æœ‰å¯èƒ½å¶ç„¶åœ¨ç”¨æˆ·ç¨‹åºä¸­ä½¿ç”¨ï¼Œä»è€Œå¯¼è‡´éå¸¸éš¾ä»¥è¿½è¸ªçš„ Bugã€‚

@example
function lib_func(x, y,    l1, l2)
@{
    @dots{}
    # some_var should be local but by oversight is not
    @var{use variable} some_var
    @dots{}
@}
@end example

@cindex arrays, associative, library functions and
@cindex libraries of @command{awk} functions, associative arrays and
@cindex functions, library, associative arrays and
@cindex Tcl
åœ¨ Tcl ç¤¾åŒºä¸­ä¹Ÿæœ‰ç›¸åŒçš„é—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨ä¸åŒçš„æƒ¯ä¾‹ï¼Œå³ç”¨å•ä¸€çš„å…³è”æ•°ç»„æ¥å­˜å‚¨åº“å‡½æ•°æˆ–è€…â€œåŒ…â€æ‰€ä½¿ç”¨çš„å€¼ã€‚è¿™æ›´è¿›ä¸€æ­¥åœ°é™ä½äº†å®é™…å…¨å±€ä½¿ç”¨çš„å˜é‡çš„æ•°ç›®ã€‚
ä¾‹å¦‚ï¼Œåœ¨ @ref{Passwd Functions} ä¸­æè¿°çš„å‡½æ•°ï¼Œå·²ç»ä½¿ç”¨æ•°ç»„å…ƒç´  @code{@w{PW_data["inited"]}}ï¼Œ@code{@w{PW_data["total"]}}ï¼Œ@code{@w{PW_data["count"]}} ä¸ @code{@w{PW_data["awklib"]}}ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ @code{@w{_pw_inited}}ï¼Œ@code{@w{_pw_awklib}}ï¼Œ@code{@w{_pw_total}} ä¸ @code{@w{_pw_count}}ã€‚

è¿™@value{SECTION}ä¸­æ‰€å‘ˆç°çš„æƒ¯ä¾‹å°±æ˜¯ï¼šçº¦å®šä¿—æˆã€‚ä½†ä½ ä¸éœ€è¦æŒ‰è¿™ç§æ–¹å¼æ¥å†™ä½ çš„ç¨‹åºâ€”â€”æˆ‘ä»¬åªæ˜¯å»ºè®®ä½ è¿™ä¹ˆåšã€‚

@node General Functions
@section é€šç”¨ç¼–ç¨‹

è¿™ä¸€@value{SECTION}ä¸­å‘ˆç°äº†åœ¨é€šç”¨ç¼–ç¨‹ä¸­ä½¿ç”¨åˆ°çš„å‡ ä¸ªå‡½æ•°ã€‚

@menu
* Strtonum Function::           A replacement for the built-in
                                @code{strtonum()} function.
* Assert Function::             A function for assertions in @command{awk}
                                programs.
* Round Function::              A function for rounding if @code{sprintf()}
                                does not do it correctly.
* Cliff Random Function::       The Cliff Random Number Generator.
* Ordinal Functions::           Functions for using characters as numbers and
                                vice versa.
* Join Function::               A function to join an array into a string.
* Getlocaltime Function::       A function to get formatted times.
* Readfile Function::           A function to read an entire file at once.
* Shell Quoting::               A function to quote strings for the shell.
@end menu

@node Strtonum Function
@subsection å°†æ•°å€¼è½¬æ¢æˆå­—ä¸²

@code{strtonum()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰æ˜¯ä¸€ä¸ª @command{gawk} æ‰©å±•ã€‚ä¸‹é¢çš„å‡½æ•°æä¾›äº† @command{awk} ä¸­å¦ä¸€ä¸ªç‰ˆæœ¬çš„å®ç°ï¼š

@example
@c file eg/lib/strtonum.awk
# mystrtonum --- convert string to number

@c endfile
@ignore
@c file eg/lib/strtonum.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# February, 2004
# Revised June, 2014

@c endfile
@end ignore
@c file eg/lib/strtonum.awk
function mystrtonum(str,        ret, n, i, k, c)
@{
    if (str ~ /^0[0-7]*$/) @{
        # octal
        n = length(str)
        ret = 0
        for (i = 1; i <= n; i++) @{
            c = substr(str, i, 1)
            # index() returns 0 if c not in string,
            # includes c == "0"
            k = index("1234567", c)

            ret = ret * 8 + k
        @}
    @} else if (str ~ /^0[xX][[:xdigit:]]+$/) @{
        # hexadecimal
        str = substr(str, 3)    # lop off leading 0x
        n = length(str)
        ret = 0
        for (i = 1; i <= n; i++) @{
            c = substr(str, i, 1)
            c = tolower(c)
            # index() returns 0 if c not in string,
            # includes c == "0"
            k = index("123456789abcdef", c)

            ret = ret * 16 + k
        @}
    @} else if (str ~ \
  /^[-+]?([0-9]+([.][0-9]*([Ee][0-9]+)?)?|([.][0-9]+([Ee][-+]?[0-9]+)?))$/) @{
        # decimal number, possibly floating point
        ret = str + 0
    @} else
        ret = "NOT-A-NUMBER"

    return ret
@}

# BEGIN @{     # gawk test harness
#     a[1] = "25"
#     a[2] = ".31"
#     a[3] = "0123"
#     a[4] = "0xdeadBEEF"
#     a[5] = "123.45"
#     a[6] = "1.e3"
#     a[7] = "1.32"
#     a[8] = "1.32E2"
#
#     for (i = 1; i in a; i++)
#         print a[i], strtonum(a[i]), mystrtonum(a[i])
# @}
@c endfile
@end example

å‡½æ•°é¦–å…ˆæ‰¾ C é£æ ¼çš„å…«è¿›åˆ¶æ•°ï¼ˆä»¥ 8 ä¸ºåº•ï¼‰ã€‚å¦‚æœè¾“å‡ºä¸²åŒ¹é…ä¸€ä¸ªæè¿°å…«è¿›åˆ¶çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™ @code{mystrtonum()} è¿­ä»£åœ¨ä¸²ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ã€‚å®ƒå°† @code{k} è®¾ç½®æˆå½“å‰å…«è¿›åˆ¶æ•°åœ¨ @code{"1234567"} ä¸­çš„ç´¢å¼•ã€‚è¿”å›å€¼è¦ä¹ˆæ˜¯ä¸æ•°å­—ç›¸åŒçš„å€¼ï¼Œæˆ–è€…åœ¨ä¸å­˜åœ¨è¿™ä¸ªå­—ç¬¦æ—¶è¿”å› 0ã€‚é‚£å°±æ˜¯çœŸæ­£çš„ @samp{0}ã€‚è¿™æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºåœ¨ @code{if} ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ä¿è¯äº†åªæœ‰å…«è¿›åˆ¶æ‰ä¼šè¿›è¡Œè½¬æ¢ã€‚

ç›¸åŒçš„é€»è¾‘ä¹Ÿå¯ä»¥åº”ç”¨åˆ°è½¬æ¢åå…­è¿›åˆ¶çš„ä»£ç ä¸­ï¼Œè¿™äº›å€¼ä»¥ @samp{0x} æˆ–è€… @samp{0X} å¼€å¤´ã€‚ä½¿ç”¨ @code{tolower()} å¯ä»¥ç®€åŒ–æŸ¥æ‰¾æ¯ä¸ªåå…­è¿›åˆ¶ä½æ•°å­—çš„è®¡ç®—ã€‚

æœ€åï¼Œå¦‚æœå­—ä¸²åŒ¹é…ï¼ˆç›¸å½“å¤æ‚çš„ï¼‰å¸¸è§„åè¿›åˆ¶æˆ–è€…æµ®ç‚¹æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™ @samp{ret = str + 0} çš„è®¡ç®—å¯ä»¥è®© @command{awk} å°†è¿™ä¸ªå€¼è½¬æ¢æˆä¸€ä¸ªæ•°ã€‚

è¢«æ³¨é‡Šæ‰çš„æ˜¯æµ‹è¯•ç¨‹åºï¼Œæ‰€ä»¥å‡½æ•°å¯ä»¥ç”¨ @command{gawk} æ¥æµ‹è¯•ï¼Œå¹¶ä¸”ç»“æœå¯ä»¥ç”¨æ¥ä¸å†…ç½®çš„ @code{strtonum()} å‡½æ•°ç»“æœæ¥æ¯”è¾ƒã€‚

@node Assert Function
@subsection æ–­è¨€

@cindex assertions
@cindex @code{assert()} function (C library)
@cindex libraries of @command{awk} functions, assertions
@cindex functions, library, assertions
@cindex @command{awk} programs, lengthy, assertions
å½“å†™ä¸€ä¸ªå¾ˆå¤§çš„ç¨‹åºçš„æ—¶å€™ï¼Œå¸¸å¸¸äº†è§£ä¸€äº›æ¡ä»¶æˆ–è€…æŸé›†åˆçš„æ¡ä»¶ä¸º true æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚åœ¨æ‰§è¡Œç‰¹å®šè®¡ç®—ä¹‹å‰ï¼Œä½ è¦å†™ä¸€æ¡è¯­å¥ä½ ç¡®ä¿¡æ¡ä»¶æˆç«‹ã€‚è¿™æ ·çš„è¯­å¥è¢«ç§°ä¸º@dfn{æ–­è¨€}ã€‚
C è¯­è¨€æä¾›äº† @code{<assert.h>} å¤´æ–‡ä»¶ä»¥åŠç›¸åº”çš„ @code{assert()} å®ï¼Œè¿™æ ·ç¨‹åºå¯ä»¥ç”¨å®ƒæ¥ä½œæ–­è¨€ã€‚å¦‚æœæ–­è¨€å¤±è´¥ï¼Œ@code{assert()} å®ä¼šæ‰“å°ä¸€äº›è¯Šæ–­ä¿¡æ¯ä»¥æè¿°æ¡ä»¶åº”è¯¥ä¸º trueï¼Œä½†å®é™…ä¸Šä¸æ˜¯ï¼Œç„¶åæ€æ­»ç¨‹åºã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œåƒè¿™æ ·æ¥ä½¿ç”¨ @code{assert()}ï¼š

@example
#include <assert.h>

int myfunc(int a, double b)
@{
     assert(a <= 5 && b >= 17.1);
     @dots{}
@}
@end example

å¦‚æœæ–­è¨€å¤±è´¥ï¼Œç¨‹åºæ‰“å°åƒä¸‹é¢è¿™æ ·çš„ä¿¡æ¯ï¼š

@example
prog.c:5: assertion failed: a <= 5 && b >= 17.1
@end example

@cindex @code{assert()} user-defined function
C è¯­è¨€å¯ä»¥ä½¿æ¡ä»¶è½¬æ¢ä¸ºå­—ä¸²ï¼Œå¹¶åœ¨æ‰“å°è¯Šæ–­ä¿¡æ¯é‡Œä½¿ç”¨ã€‚ä½†åœ¨ @command{awk} ä¸­å´ä¸å¯èƒ½ï¼Œæ‰€ä»¥ @code{assert()} å‡½æ•°ä¹Ÿéœ€è¦ä¸€ä¸ªæµ‹è¯•æ¡ä»¶çš„å­—ä¸²ç‰ˆæœ¬ã€‚ä¸‹é¢åˆ™æ˜¯å­—ä¸²å‡½æ•°ï¼š

@example
@c file eg/lib/assert.awk
# assert --- assert that a condition is true. Otherwise, exit.

@c endfile
@ignore
@c file eg/lib/assert.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May, 1993

@c endfile
@end ignore
@c file eg/lib/assert.awk
function assert(condition, string)
@{
    if (! condition) @{
        printf("%s:%d: assertion failed: %s\n",
            FILENAME, FNR, string) > "/dev/stderr"
        _assert_exit = 1
        exit 1
    @}
@}

@group
END @{
    if (_assert_exit)
        exit 1
@}
@end group
@c endfile
@end example

@code{assert()} å‡½æ•°æµ‹è¯• @code{condition} å‚æ•°ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™æ‰“å°ä¸€ä¸ªä¿¡æ¯åˆ°æ ‡å‡†è¾“å‡ºï¼Œå¹¶ä½¿ç”¨ @code{string} å‚æ•°æ¥æè¿°å¤±è´¥çš„æ¡ä»¶ã€‚
ç„¶åå®ƒå°†å˜é‡ @code{_assert_exit} è®¾ç½®æˆ 1ï¼Œå¹¶æ‰§è¡Œ @code{exit} è¯­å¥ã€‚@code{exit} è¯­å¥ä¼šè·³åˆ° @code{END} è§„åˆ™ä¸­æ¥æ‰§è¡Œã€‚å¦‚æœ @code{END} è§„åˆ™å‘ç° @code{_assert_exit} ä¸º trueï¼Œå°±ä¼šç«‹å³é€€å‡ºã€‚

åœ¨ @code{END} è§„åˆ™ä¸­æµ‹è¯•çš„ç›®çš„æ˜¯è¦ä¿è¯ä»»æ„çš„å…¶ä»– @code{END} è§„åˆ™ä¸è¢«æ‰§è¡Œã€‚å½“æ–­è¨€å¤±è´¥ï¼Œç¨‹åºåº”è¯¥ç«‹å³é€€å‡ºã€‚å¦‚æœæ–­è¨€é€šè¿‡ï¼Œåˆ™ @code{_assert_exit} åˆ™ä¾ç„¶æ˜¯ falseï¼Œå½“ @code{END} è§„åˆ™æ‰§è¡Œæ—¶ï¼Œç¨‹åºçš„å…¶ä»–çš„ @code{END} è§„åˆ™åˆ™ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚ä¸ºäº†ä½¿è¿™ä¸€åˆ‡éƒ½æ­£ç¡®æ‰§è¡Œï¼Œ@file{assert.awk} å¿…é¡»æˆä¸º @command{awk} è¯»å–çš„ç¬¬ä¸€ä¸ªæºä»£ç æ–‡ä»¶ã€‚å‡½æ•°å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è¢«ä½¿ç”¨ï¼š

@example
function myfunc(a, b)
@{
     assert(a <= 5 && b >= 17.1, "a <= 5 && b >= 17.1")
     @dots{}
@}
@end example

@noindent
å¦‚æœæ–­è¨€å¤±è´¥ï¼Œä½ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ä¿¡æ¯ï¼š

@example
mydata:1357: assertion failed: a <= 5 && b >= 17.1
@end example

@cindex @code{END} pattern, @code{assert()} user-defined function and
è¿™ä¸ªç‰ˆæœ¬çš„ @code{assert()} æœ‰ä¸€ä¸ªå°é—®é¢˜ã€‚ä¸€ä¸ª @code{END} è§„åˆ™ä¼šè‡ªåŠ¨åŠ åˆ°è°ƒç”¨ @code{assert()} å‡½æ•°çš„ç¨‹åºä¸­ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœç¨‹åºç”± @code{BEGIN} è§„åˆ™ç»„æˆï¼Œè¾“å…¥æ–‡ä»¶ä¸/æˆ–è€…æ ‡å‡†è¾“å…¥ä¸ä¼šè¢«è¯»å–ã€‚ä½†æ˜¯ï¼Œç°åœ¨ç¨‹åºæœ‰ä¸€ä¸ª @code{END} è§„åˆ™ï¼Œ@command{awk} ä¼šå°è¯•è¯»å–è¾“å…¥æ–‡ä»¶çš„æ•°æ®æˆ–è€…æ ‡å‡†è¾“å…¥çš„æ•°æ®ï¼ˆæŸ¥çœ‹ @pxref{Using BEGIN/END}ï¼‰ï¼Œå¾ˆæœ‰å¯èƒ½å¯¼è‡´ç¨‹åºæŒ‚èµ·ï¼Œå› å¼•å®ƒå¯èƒ½ä¼šä¸€ç›´ç­‰å¾…è¾“å…¥ã€‚

@cindex @code{BEGIN} pattern, @code{assert()} user-defined function and
æœ‰ä¸€ä¸ªå¾ˆç®€å•çš„è§£å†³æ–¹æ³•ï¼šç¡®ä¿è¿™è¿™æ ·çš„ @code{BEGIN} è§„åˆ™æ€»æ˜¯ç”¨ä¸€ä¸ª @code{exit} è¯­å¥æ¥ç»“æŸã€‚

@node Round Function
@subsection æ•°å€¼èˆå…¥èˆå‡º

@cindex rounding numbers
@cindex numbers, rounding
@cindex libraries of @command{awk} functions, rounding numbers
@cindex functions, library, rounding numbers
@cindex @code{print} statement, @code{sprintf()} function and
@cindex @code{printf} statement, @code{sprintf()} function and
@cindex @code{sprintf()} function, @code{print}/@code{printf} statements and
@code{printf} ä¸ @code{sprintf} çš„å·¥ä½œæ–¹å¼ï¼ˆæŸ¥çœ‹ @pxref{Printf}ï¼‰æ‰§è¡Œçš„èˆå…¥èˆå‡ºå¸¸å¸¸ä¾èµ–äºç³»ç»Ÿçš„ C å‡½æ•° @code{sprintf} ä¾‹ç¨‹ã€‚åœ¨å¾ˆå¤šçš„æœºå™¨ä¸Šï¼Œ@code{sprintf} èˆå…¥èˆå‡ºæ˜¯@dfn{æ²¡æœ‰åå‘çš„}ï¼Œå³æ˜¯è¯´ï¼Œå®ƒå¹¶ä¸æ€»æ˜¯æŠŠ 0.5 å‘ä¸Šèˆå…¥ï¼Œè¿™ä¸å¾ˆè‡ªç„¶çš„é¢„æœŸç›¸åã€‚åœ¨æ²¡æœ‰åå‘çš„èˆå…¥èˆå‡ºä¸­ã€‚.5 ä¼šå¶æ•°èˆå…¥èˆå‡ºï¼Œè€Œå¹¶ä¸æ€»æ˜¯èˆå…¥ï¼Œæ‰€ä»¥ï¼Œ1.5 èˆå…¥ä¸º 2ï¼Œè€Œ 4.5 åˆ™èˆå‡ºä¸º 4ã€‚è¿™å°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªä¸èˆå…¥èˆå‡ºçš„æ ¼å¼ï¼ˆæ¯”å¦‚ @code{"%.0f"}ï¼‰ï¼Œä½ åº”è¯¥æ£€æŸ¥ä½ çš„ç³»ç»Ÿæ‰€æ‰§è¡Œçš„ç»“æœã€‚ä¸‹é¢çš„å‡½æ•°æ€»æ˜¯æ‰§è¡Œä¼ è¾“çš„èˆå…¥èˆå‡ºï¼Œå¦‚æœä½ çš„ @command{awk} çš„ @code{printf} æ‰§è¡Œçš„æ˜¯æ²¡æœ‰åå‘çš„èˆå…¥èˆå‡ºï¼Œåˆ™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚

@cindex @code{round()} user-defined function
@example
@c file eg/lib/round.awk
# round.awk --- do normal rounding
@c endfile
@ignore
@c file eg/lib/round.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# August, 1996
@c endfile
@end ignore
@c file eg/lib/round.awk

function round(x,   ival, aval, fraction)
@{
   ival = int(x)    # integer part, int() truncates

   # see if fractional part
   if (ival == x)   # no fraction
      return ival   # ensure no decimals

   if (x < 0) @{
      aval = -x     # absolute value
      ival = int(aval)
      fraction = aval - ival
      if (fraction >= .5)
         return int(x) - 1   # -2.5 --> -3
      else
         return int(x)       # -2.3 --> -2
   @} else @{
      fraction = x - ival
      if (fraction >= .5)
         return ival + 1
      else
         return ival
   @}
@}
@c endfile
@c don't include test harness in the file that gets installed

# test harness
# @{ print $0, round($0) @}
@end example

@node Cliff Random Function
@subsection Cliff éšæœºæ•°ç”Ÿæˆå™¨
@cindex random numbers, Cliff
@cindex Cliff random numbers
@cindex numbers, Cliff random
@cindex functions, library, Cliff random numbers

@uref{http://mathworld.wolfram.com/CliffRandomNumberGenerator.html, Cliff éšæœºæ•°äº§ç”Ÿå™¨}æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„éšæœºä¸ºæ•°ç”Ÿæˆå™¨ï¼Œå³â€œé€šè¿‡æ— ç»“æ„æ˜¾ç¤ºæ¥ä¸ºéšæœºæ€§ä¼ é€’å™ªå£°çƒæµ‹è¯•â€ã€‚ä»–å¾ˆå®¹æ˜“ç¼–ç¨‹ï¼Œä¸åˆ° 10 è¡Œçš„ @command{awk} ä»£ç å°±å¯ä»¥å®Œæˆï¼š

@cindex @code{cliff_rand()} user-defined function
@example
@c file eg/lib/cliff_rand.awk
# cliff_rand.awk --- generate Cliff random numbers
@c endfile
@ignore
@c file eg/lib/cliff_rand.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# December 2000
@c endfile
@end ignore
@c file eg/lib/cliff_rand.awk

BEGIN @{ _cliff_seed = 0.1 @}

function cliff_rand()
@{
    _cliff_seed = (100 * log(_cliff_seed)) % 1
    if (_cliff_seed < 0)
        _cliff_seed = - _cliff_seed
    return _cliff_seed
@}
@c endfile
@end example

ç®—æ³•éœ€è¦ä¸€ä¸ªåˆå§‹çš„ç§å­å€¼ï¼Œä¸º 0.1ã€‚æ¯ä¸ªæ–°å€¼éƒ½ä½¿ç”¨å½“å‰çš„ç§å­çš„ä½œä¸ºè¾“å‡ºæ¥è¿›è¡Œè®¡ç®—ã€‚å¦‚æœå†…ç½® @code{rand()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Numeric Functions}ï¼‰ä¸å¤Ÿéšæœºï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥ä»£æ›¿ã€‚

@node Ordinal Functions
@subsection åœ¨å­—ç¬¦ä¸æ•°å€¼ä¹‹é—´å˜æ¢

@cindex libraries of @command{awk} functions, character values as numbers
@cindex functions, library, character values as numbers
@cindex characters, values of as numbers
@cindex numbers, as values of characters
ä¸€ä¸ªå•†ä¸šç‰ˆæœ¬çš„ @command{awk} å®ç°æä¾›äº†å†…ç½®çš„å‡½æ•° @code{ord()}ï¼Œè¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œç„¶åè¿”å›é‚£ä¸ªå­—ç¬¦åœ¨æœºå™¨çš„å­—ç¬¦é›†ä¸­çš„æ•°å€¼å€¼ã€‚å¦‚æœä¼ é€’åˆ° @code{ord()} å‡½æ•°ä¸ºå­—ä¸²ï¼Œåˆ™ä¼šæœ‰å¤šä¸ªå­—ç¬¦ï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªå­—ç¬¦è¢«è½¬æ¢ã€‚

è¿™ä¸ªå‡½æ•°ç›¸åçš„å‡½æ•°åˆ™ä¸º @code{chr()}ï¼ˆæ¥è‡ªç”± Pascal åŒåå‡½æ•°ï¼‰ï¼Œå®ƒè¾“å…¥ä¸€ä¸ªæ•°å€¼ï¼Œç„¶åè¿”å›ç›¸åº”çš„å­—ç¬¦ã€‚è¿™ä¸¤ä¸ªå‡½æ•°åœ¨ @command{awk} ä¸­éƒ½å¯ä»¥å¾ˆå®¹æ˜“å®ç°ï¼Œå› æ­¤æ²¡æœ‰çœŸå®çš„ç†ç”±è¦å°†ä»–ä»¬æ„å»ºè¿›è¡Œ @command{awk} è§£æå™¨ï¼š

@cindex @code{ord()} user-defined function
@cindex @code{chr()} user-defined function
@cindex @code{_ord_init()} user-defined function
@example
@c file eg/lib/ord.awk
# ord.awk --- do ord and chr

# Global identifiers:
#    _ord_:        numerical values indexed by characters
#    _ord_init:    function to initialize _ord_
@c endfile
@ignore
@c file eg/lib/ord.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# 16 January, 1992
# 20 July, 1992, revised
@c endfile
@end ignore
@c file eg/lib/ord.awk

BEGIN    @{ _ord_init() @}

function _ord_init(    low, high, i, t)
@{
    low = sprintf("%c", 7) # BEL is ascii 7
    if (low == "\a") @{    # regular ascii
        low = 0
        high = 127
    @} else if (sprintf("%c", 128 + 7) == "\a") @{
        # ascii, mark parity
        low = 128
        high = 255
    @} else @{        # ebcdic(!)
        low = 0
        high = 255
    @}

    for (i = low; i <= high; i++) @{
        t = sprintf("%c", i)
        _ord_[t] = i
    @}
@}
@c endfile
@end example

@cindex character sets (machine character encodings)
@cindex ASCII
@cindex EBCDIC
@cindex Unicode
@cindex mark parity
è¢« @code{_ord_init()} æ‰€ä½¿ç”¨çš„æ•°å€¼éœ€è¦ä¸€äº›è§£é‡Šã€‚ä»Šå¤©æ‰€ä½¿ç”¨çš„æœ€é‡è¦çš„å­—ç¬¦é›†å°±æ˜¯ ASCIIã€‚
@footnote{è¿™ä¸ªæ­£åœ¨æ”¹å˜ï¼šå¾ˆå¤šçš„ç³»ç»Ÿä½¿ç”¨ Unicodeã€‚è¿™æ˜¯ä¸€ç§å¾ˆå¤§çš„å­—ç¬¦é›†ï¼ŒASCII æ˜¯å®ƒçš„ä¸€ä¸ªå­é›†ã€‚åœ¨å®Œå…¨æ”¯æŒ Unicode çš„ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªå­—ç¬¦å¯ä»¥å åˆ° 32 ä½ã€‚ä½¿å¾—è¿™é‡Œæ‰€ä½¿ç”¨çš„ç®€å•æµ‹è¯•æœ‰å¯èƒ½ä¹Ÿéå¸¸æ¶ˆè€—æ€§èƒ½ã€‚}
å°½ç®¡ 8 ä½çš„å­—èŠ‚å¯ä»¥è¡¨ç¤º 256 ä¸ªä¸åŒçš„å€¼ï¼ˆä» 0 åˆ° 255 ï¼‰ï¼ŒASCII åªå®šä¹‰äº†ä» 0 åˆ° 127 ä¹‹é—´çš„å­—ç¬¦ã€‚
@footnote{ASCII è¢«æ‰©å±•åˆ°å¾ˆå¤šçš„å›½å®¶ï¼Œå¹¶ä½¿ç”¨åˆ° 128 åˆ° 255 ä¹‹é—´çš„å€¼è¡¨ç¤ºç‰¹å®šå›½å®¶çš„å­—ç¬¦ã€‚å¦‚æœä½ çš„ç³»ç»Ÿä½¿ç”¨è¿™äº›æ‰©å±•ï¼Œä½ å¯ç®€åŒ– @code{_ord_init()} æ¥è¿­ä»£ä»0 åˆ° 255 çš„æ•°å€¼ã€‚}
åœ¨å¾ˆä¹…çš„è¿‡å»ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªè¿·ä½ è®¡ç®—æœºå‚å•†
@c Pr1me, blech
ä½¿ç”¨ ASCIIï¼Œä½†æ˜¯å¸¦ä¸€ä¸ªæ ¡éªŒä½ï¼Œå³å­—èŠ‚çš„æœ€é«˜ä½æ€»æ˜¯ 1ã€‚è¿™è¡¨ç¤ºï¼Œåœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œå­—ç¬¦çš„å€¼æ˜¯ä» 128 åˆ° 255ã€‚æœ€åï¼Œå¾ˆå¤šçš„å¤§å‹æœºä½¿ç”¨ EBCDIC å­—ç¬¦é›†ã€‚è¿™ä¸ªé›†ä¸­ä½¿ç”¨æ‰€æœ‰çš„ 256 ä¸ªå­—ç¬¦ã€‚åœ¨ä¸€äº›æ—§ç³»ç»Ÿä¸­ä¹Ÿä½¿ç”¨å…¶ä»–çš„å­—ç¬¦é›†ï¼Œä½†æ˜¯æ²¡æœ‰å¿…é¡»ä¸ºæ­¤æ“å¿ƒäº†ã€‚

@example
@c file eg/lib/ord.awk
function ord(str,    c)
@{
    # only first character is of interest
    c = substr(str, 1, 1)
    return _ord_[c]
@}

function chr(c)
@{
    # force c to be numeric by adding 0
    return sprintf("%c", c + 0)
@}
@c endfile

#### test code ####
# BEGIN @{
#    for (;;) @{
#        printf("enter a character: ")
#        if (getline var <= 0)
#            break
#        printf("ord(%s) = %d\n", var, ord(var))
#    @}
# @}
@c endfile
@end example

è¿™ä¸ªå‡½æ•°çš„ä¸€ä¸ªæ˜æ˜¾æ”¹è¿›æ˜¯å°† @code{@w{_ord_init}} å‡½æ•°çš„ä»£ç ç§»åˆ°äº† @code{BEGIN} è§„åˆ™ä¸­ã€‚è¿™ä¹ˆåšçš„æœ€åˆç›®çš„æ˜¯ä¸ºäº†å¼€å‘çš„æ–¹ä¾¿ã€‚

@node Join Function
@subsection å°†æ•°ç»„åˆå¹¶æˆå­—ä¸²

@cindex libraries of @command{awk} functions, merging arrays into strings
@cindex functions, library, merging arrays into strings
@cindex strings, merging arrays into
@cindex arrays, merging into strings
å½“å¤„ç†å­—ä¸²æ—¶ï¼Œå¯ä»¥å°†æ•°ç»„çš„æ‰€æœ‰å­—ä¸²è¿æ¥ä¸ºä¸€ä¸ªé•¿çš„å­—ä¸²å¸¸å¸¸å¾ˆæœ‰ç”¨ã€‚ä¸‹é¢çš„ @code{join()} å‡½æ•°æ¥åšè¿™æ ·çš„å·¥ä½œã€‚å®ƒåœ¨åé¢çš„å‡ ä¸ªåº”ç”¨ç¨‹åºä¸­è¢«ä½¿ç”¨åˆ°ï¼ˆæŸ¥çœ‹ @pxref{Sample Programs}ï¼‰ã€‚

å¥½çš„å‡½æ•°è®¾è®¡æ˜¯å¾ˆé‡è¦çš„ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥æ˜¯é€šç”¨çš„ï¼Œä½†æ˜¯å®ƒä¹Ÿåº”è¯¥æœ‰ä¸€ä¸ªåˆç†çš„é»˜è®¤è¡Œä¸ºã€‚è¿™ä¸ªå‡½æ•°åˆç”¨ä¸€ä¸ªæ•°ç»„ä»¥åŠè¦åˆå¹¶çš„å¼€å§‹ä¸ç»“æŸç´¢å¼•ï¼Œä½œä¸ºå‚æ•°ã€‚å®ƒå‡è®¾æ•°ç»„çš„ç´¢å¼•æ˜¯æ•°å€¼çš„â€”â€”è¿™æ˜¯åˆç†çš„å‡å……ï¼Œå› æ­¤æ•°ç»„æœ‰å¯èƒ½ä½¿ç”¨ @code{split()} å‡½æ•°åˆ›å»ºçš„ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ï¼š

@cindex @code{join()} user-defined function
@example
@c file eg/lib/join.awk
# join.awk --- join an array into a string
@c endfile
@ignore
@c file eg/lib/join.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
@c endfile
@end ignore
@c file eg/lib/join.awk

function join(array, start, end, sep,    result, i)
@{
    if (sep == "")
       sep = " "
    else if (sep == SUBSEP) # magic value
       sep = ""
    result = array[start]
    for (i = start + 1; i <= end; i++)
        result = result sep array[i]
    return result
@}
@c endfile
@end example

ä¸€ä¸ªå¯é€‰çš„å‚æ•°æ˜¯ç”¨æ¥è¿æ¥å­—ä¸²çš„åˆ†éš”ç¬¦ã€‚å¦‚æœè°ƒç”¨è€…æä¾›äº†éç©ºçš„å€¼ï¼Œ@code{join()} åˆ™ä½¿ç”¨å®ƒï¼Œå¦‚æœæ²¡æœ‰æä¾›ï¼Œå…¶å€¼åˆ™ä¸ºç©ºå€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ@code{join()} ä½¿ç”¨ä¸€ä¸ªç©ºæ ¼æ¥ä½œä¸ºé»˜è®¤çš„å­—ä¸²åˆ†éš”ç¬¦ã€‚å¦‚æœå€¼ä¸ @code{SUBSEP} çš„å€¼ç›¸åŒï¼Œåˆ™ @code{join()} ä¼šåœ¨è¿æ¥çš„å­—ä¸²ä¸­ä¸ä½¿ç”¨åˆ†éš”ç¬¦ã€‚@code{SUBSEP} ä½œä¸ºä¸€ä¸ªâ€œé­”æ³•â€å€¼æ¥æŒ‡ç¤ºä¸è¦åœ¨å­—ä¸²ç»„ä»¶ä¹‹é—´ä½¿ç”¨åˆ†éš”ç¬¦ã€‚ 
@footnote{å¦‚æœ @command{awk} æœ‰ä¸€ä¸ªèµ‹å€¼æ“ä½œç¬¦æ¥è¿›è¡Œè¿æ¥å°±å¾ˆå¥½äº†ã€‚ç¼ºå°‘ä¸€ä¸ªæ˜¾å¼çš„è¿æ¥æ“ä½œç¬¦ä½¿å¾—å­—ä¸²æ“ä½œæ¯”å®é™…éœ€è¦çš„è¦éš¾ä¸€äº›ã€‚}

@node Getlocaltime Function
@subsection ç®¡ç†æ—¶é—´

@cindex libraries of @command{awk} functions, managing, time
@cindex functions, library, managing time
@cindex timestamps, formatted
@cindex time, managing
åœ¨ @ref{Time Functions}ï¼Œæè¿°çš„ @code{systime()} ä¸ @code{strftime()} å‡½æ•°ï¼Œæä¾›äº†æœ€å°çš„åŠŸèƒ½éœ€æ±‚æ¥å¤„ç†äººå¯è¯»å½¢å¼çš„æ—¶é—´å¤„ç†ã€‚å°½ç®¡ @code{strftime()} æ˜¯æ‰©å±•çš„ï¼Œæ ¼å¼æ§åˆ¶ä¸å®¹æ˜“è®°ä½ï¼Œæˆ–è€…åœ¨è¯»ç¨‹åºæ—¶æ„æ€ä¸è¿™ä¹ˆæ˜æ˜¾ã€‚

ä¸‹é¢çš„å‡½æ•° @code{getlocaltime()} ä½¿ç”¨ç”¨æˆ·æä¾›çš„é¢„å®šä¹‰æ—¶é—´æ ¼å¼ä¿¡æ¯æ•°ç»„ã€‚å®ƒè¿”å›ä¸€ä¸ªä¸ @command{date} å·¥å…·äº§ç”Ÿä¸€æ ·çš„çš„æ—¶é—´æ ¼å¼çš„å­—ä¸²ï¼š

@cindex @code{getlocaltime()} user-defined function
@example
@c file eg/lib/gettime.awk
# getlocaltime.awk --- get the time of day in a usable format
@c endfile
@ignore
@c file eg/lib/gettime.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain, May 1993
#
@c endfile
@end ignore
@c file eg/lib/gettime.awk

# Returns a string in the format of output of date(1)
# Populates the array argument time with individual values:
#    time["second"]       -- seconds (0 - 59)
#    time["minute"]       -- minutes (0 - 59)
#    time["hour"]         -- hours (0 - 23)
#    time["althour"]      -- hours (0 - 12)
#    time["monthday"]     -- day of month (1 - 31)
#    time["month"]        -- month of year (1 - 12)
#    time["monthname"]    -- name of the month
#    time["shortmonth"]   -- short name of the month
#    time["year"]         -- year modulo 100 (0 - 99)
#    time["fullyear"]     -- full year
#    time["weekday"]      -- day of week (Sunday = 0)
#    time["altweekday"]   -- day of week (Monday = 0)
#    time["dayname"]      -- name of weekday
#    time["shortdayname"] -- short name of weekday
#    time["yearday"]      -- day of year (0 - 365)
#    time["timezone"]     -- abbreviation of timezone name
#    time["ampm"]         -- AM or PM designation
#    time["weeknum"]      -- week number, Sunday first day
#    time["altweeknum"]   -- week number, Monday first day

function getlocaltime(time,    ret, now, i)
@{
    # get time once, avoids unnecessary system calls
    now = systime()

    # return date(1)-style output
    ret = strftime("%a %b %e %H:%M:%S %Z %Y", now)

    # clear out target array
    delete time

    # fill in values, force numeric values to be
    # numeric by adding 0
    time["second"]       = strftime("%S", now) + 0
    time["minute"]       = strftime("%M", now) + 0
    time["hour"]         = strftime("%H", now) + 0
    time["althour"]      = strftime("%I", now) + 0
    time["monthday"]     = strftime("%d", now) + 0
    time["month"]        = strftime("%m", now) + 0
    time["monthname"]    = strftime("%B", now)
    time["shortmonth"]   = strftime("%b", now)
    time["year"]         = strftime("%y", now) + 0
    time["fullyear"]     = strftime("%Y", now) + 0
    time["weekday"]      = strftime("%w", now) + 0
    time["altweekday"]   = strftime("%u", now) + 0
    time["dayname"]      = strftime("%A", now)
    time["shortdayname"] = strftime("%a", now)
    time["yearday"]      = strftime("%j", now) + 0
    time["timezone"]     = strftime("%Z", now)
    time["ampm"]         = strftime("%p", now)
    time["weeknum"]      = strftime("%U", now) + 0
    time["altweeknum"]   = strftime("%W", now) + 0

    return ret
@}
@c endfile
@end example

è¿™äº›å­—ä¸²ä¸‹æ ‡å¾ˆå®¹æ˜“ä½¿ç”¨å¹¶æ¯” @code{strftime()} æ‰€ä½¿ç”¨çš„ä¸€ç³»åˆ—çš„æ ¼å¼è¦å®¹æ˜“ã€‚åœ¨ @ref{Alarm Program}ï¼Œå‘ˆç°çš„ @code{alarm} ç¨‹åºï¼Œä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°ã€‚@code{getlocaltime()} å‡½æ•°æ›´é€šç”¨çš„è®¾è®¡å¯ä»¥å…è®¸ç”¨æˆ·æä¾›ä¸€ä¸ªå¯é€‰çš„æ—¶é—´æˆ³å€¼ï¼Œè€Œä¸æ˜¯ä»…ä½¿ç”¨å½“å‰æ—¶é—´ã€‚

@node Readfile Function
@subsection ä¸€æ¬¡è¯»å–æ•´ä¸ªæ–‡ä»¶

å¦‚æœå°†æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹éƒ½æ”¾åœ¨å†…å­˜ä¸­ä½œä¸ºä¸€ä¸ªå­—ä¸²ç»å¸¸å¾ˆæœ‰ç”¨ã€‚ä¸€ä¸ªç›´æ¥çš„ï¼Œä½†æ˜¯æ¯”è¾ƒå¹¼ç¨šçš„æ–¹æ³•å¯èƒ½å¦‚ä¸‹ï¼š

@example
function readfile(file,    tmp, contents)
@{
    if ((getline tmp < file) < 0)
        return

    contents = tmp
    while (getline tmp < file) > 0)
        contents = contents RT tmp

    close(file)
    return contents
@}
@end example

è¿™ä¸ªå‡½æ•°ä¸€æ¬¡ä»æ–‡ä»¶ @code{file} è¯»å–ä¸€ä¸ªè®°å½•ï¼Œç„¶åç”¨æ–‡ä»¶çš„å†…å®¹æ¥æ„å»ºæœ¬åœ°å˜é‡ @code{contents}ã€‚è¿™æœ‰ç”¨ï¼Œä½†æ˜¯ä¸å¤Ÿé«˜æ•ˆã€‚

ä¸‹é¢çš„å‡½æ•°ï¼Œä½¿ç”¨ç”± Denis Shirokov æçš„å»ºè®®ï¼Œæ¥ä¸€æ¬¡è¯»å–æŒ‡å®šåå­—çš„æ–‡ä»¶å†…å®¹ï¼š

@cindex @code{readfile()} user-defined function
@example
@c file eg/lib/readfile.awk
# readfile.awk --- read an entire file at once
@c endfile
@ignore
@c file eg/lib/readfile.awk
#
# Original idea by Denis Shirokov, cosmogen@@gmail.com, April 2013
#
@c endfile
@end ignore
@c file eg/lib/readfile.awk

function readfile(file,     tmp, save_rs)
@{
    save_rs = RS
    RS = "^$"
    getline tmp < file
    close(file)
    RS = save_rs

    return tmp
@}
@c endfile
@end example

é€šè¿‡å°† @code{RS} è®¾ç½®æˆ @samp{^$}ï¼Œå³ä¸€ä¸ªä¸€å®šä¸ä¼šåŒ¹é…æ–‡ä»¶å†…å®¹çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚@command{gawk} ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹åˆ° @code{tmp} ä¸­ï¼Œå¹¶å°è¯•åŒ¹é… @code{RS}ã€‚æ¯æ¬¡è¯»åçš„åŒ¹é…éƒ½å¤±è´¥ï¼Œä½†å¾ˆåŒ¹é…å¤±è´¥å¾ˆå¿«ï¼Œè¿™æ · @command{gawk} å°† @code{tmp} çš„å†…å®¹ç”¨æ–‡ä»¶çš„å†…å®¹æ¥è¿›è¡Œå¡«å……ã€‚
ï¼ˆæŸ¥çœ‹ @ref{Records}ï¼Œæ¥è·å– @code{RT} ä¸ @code{RS} çš„ä¿¡æ¯ï¼‰

å¦‚æœæ–‡ä»¶ @code{file} ä¸ºç©ºï¼Œåˆ™è¿”å›å€¼ä¸ºç©ºä¸²ã€‚æ‰€ä»¥ï¼Œè°ƒç”¨ä»£ç å¯ä»¥ä½¿ç”¨è¿™æ ·çš„ä»£ç ï¼š

@example
contents = readfile("/some/path")
if (length(contents) == 0)
    # file was empty @dots{}
@end example

è¿™é‡Œæµ‹è¯•ç»“æœçœ‹å…¶æ˜¯å¦ä¸ºç©ºè¿˜æ˜¯ä¸ä¸ºç©ºï¼Œä¸€ä¸ªç­‰åŒçš„æµ‹è¯•ä¸º @samp{contents == ""}ã€‚

æŸ¥çœ‹ @ref{Extension Sample Readfile}ï¼Œæ¥æŸ¥çœ‹æ‰©å±•çš„å‡½æ•°ï¼Œå®ƒä¹Ÿå°†æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹è¯»å–åˆ°å†…å­˜ä¸­ã€‚

@node Shell Quoting
@subsection å°†å­—ä¸²ç”¨å¼•å·å¼•èµ·å¹¶ä¼ é€’ç»™ Shell

@c included by permission
@ignore
Date: Sun, 27 Jul 2014 17:16:16 -0700
Message-ID: <CAKuGj+iCF_obaCLDUX60aSAgbfocFVtguG39GyeoNxTFby5sqQ@mail.gmail.com>
Subject: Useful awk function
From: Mike Brennan <mike@madronabluff.com>
To: Arnold Robbins <arnold@skeeve.com>
@end ignore

Michael Brennan æä¾›äº†ä¸‹é¢çš„ç¼–ç¨‹æ¨¡å¼ï¼Œä»–ç»å¸¸æ˜¯è¿™ä¹ˆä½¿ç”¨ï¼š

@example
#! /bin/sh

awkp='
   @dots{}
   '

@var{input_program} | awk "$awkp" | /bin/sh
@end example

æ¯”å¦‚ï¼Œä»–çš„ä¸€ä¸ªç¨‹åºåä¸º @command{flac-edit} å°±ä½¿ç”¨è¿™ç§å½¢å¼ï¼š

@example
$ @kbd{flac-edit -song="Whoope! That's Great" file.flac}
@end example

å®ƒäº§ç”Ÿä¸‹é¢çš„è¾“å‡ºï¼Œè¿™äº›è¾“å‡ºé€šè¿‡ç®¡é“è¾“å‡ºç»™ Shellï¼ˆ@file{/bin/sh}ï¼‰ï¼š

@example
chmod +w file.flac
metaflac --remove-tag=TITLE file.flac
LANG=en_US.88591 metaflac --set-tag=TITLE='Whoope! That'"'"'s Great' file.flac
chmod -w file.flac
@end example

æ³¨æ„ Shell éœ€è¦å¼•å·ã€‚å‡½æ•° @code{shell_quote()} å°±æ˜¯æ¥åšè¿™ä¸ªäº‹æƒ…çš„ã€‚@code{SINGLE} æ˜¯ä¸€ä¸ªä¸€å­—ç¬¦çš„ä¸² @code{"'"}ï¼Œè€Œ @code{QSINGLE} æ˜¯ä¸€ä¸ªä¸‰å­—ç¬¦çš„ä¸² @code{"\"'\""}ï¼š

@example
@c file eg/lib/shellquote.awk
# shell_quote --- quote an argument for passing to the shell
@c endfile
@ignore
@c file eg/lib/shellquote.awk
#
# Michael Brennan
# brennan@@madronabluff.com
# September 2014
@c endfile
@end ignore
@c file eg/lib/shellquote.awk

function shell_quote(s,             # parameter
    SINGLE, QSINGLE, i, X, n, ret)  # locals
@{
    if (s == "")
        return "\"\""

    SINGLE = "\x27"  # single quote
    QSINGLE = "\"\x27\""
    n = split(s, X, SINGLE)

    ret = SINGLE X[1] SINGLE
    for (i = 2; i <= n; i++)
        ret = ret QSINGLE SINGLE X[i] SINGLE

    return ret
@}
@c endfile
@end example

@node Data File Management
@section @value{DDF}ç®¡ç†


@cindex files, managing
@cindex libraries of @command{awk} functions, managing, data files
@cindex functions, library, managing data files
æœ¬@value{SECTION}å‘ˆç°çš„å‡½æ•°ç”¨äºç®¡ç†å‘½ä»¤è¡Œ@value{DF}éå¸¸æœ‰ç”¨ã€‚

@menu
* Filetrans Function::          A function for handling data file transitions.
* Rewind Function::             A function for rereading the current file.
* File Checking::               Checking that data files are readable.
* Empty Files::                 Checking for zero-length files.
* Ignoring Assigns::            Treating assignments as file names.
@end menu

@node Filetrans Function
@subsection æ³¨æ„@value{DDF}çš„è¾¹ç•Œ

@cindex files, managing, data file boundaries
@cindex files, initialization and cleanup
@code{BEGIN} ä¸ @code{END} è§„åˆ™ç›¸åº”åœ°åœ¨ä½ çš„ @command{awk} ç¨‹åºçš„å¼€å§‹ä¸ç»“æŸæ‰§è¡Œä¸€æ¬¡ï¼ˆæŸ¥çœ‹ @pxref{BEGIN/END}ï¼‰ã€‚æˆ‘ä»¬ï¼ˆ@command{gawk} çš„ä½œè€…ä»¬ï¼‰é‡åˆ°è¿‡ä¸€ä¸ªç”¨æˆ·ï¼Œé”™è¯¯åœ°è®¤ä¸º @code{BEGIN} è§„åˆ™åœ¨æ¯ä¸ª@value{DF}çš„å¼€å§‹éƒ½æ‰§è¡Œï¼Œè€Œ @code{END} è§„åˆ™åœ¨æ¯ä¸ª@value{DF}çš„ç»“æŸæ—¶æ‰§è¡Œã€‚

å½“è¢«é€šçŸ¥è¯´äº‹æƒ…ä¸æ˜¯è¿™æ ·çš„ï¼Œç”¨æˆ·è¯·æ±‚æˆ‘ä»¬åŠ ä¸€ä¸ªæ–°çš„ç‰¹å®šæ¨¡å¼åˆ° @command{gawk} ä¸­ï¼Œç§°ä¸º @code{BEGIN_FILE} ä¸ @code{END_FILE}ï¼Œè¿™äº›éƒ½åˆ™å…·æœ‰æ‰€æœŸæœ›çš„è¡Œä¸ºã€‚ä»–ç”šè‡³ä¸ºæˆ‘ä»¬æä¾›è¿™ä¹ˆåšçš„ä»£ç ã€‚

ç»™ @command{gawk} åŠ è¿™ä¸ªç‰¹æ®Šæ¨¡å¼å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œ@command{awk} è‡ªå·±éƒ½å°±å¯ä»¥å¾ˆæ¸…æ¥šåœ°å®Œæˆè¿™ä¸ªäº‹æƒ…ï¼Œå¦‚ä¸‹é¢çš„å‡½æ•°ç¨‹åºæ‰€è§£é‡Šçš„ä¸€æ ·ã€‚å®ƒä¼šè°ƒç”¨ä¸¤ä¸ªç”¨æˆ·è‡ªå·±æä¾›çš„å‡½æ•° ï¼Œ@code{beginfile()} ä¸ @code{endfile()} åˆ†åˆ«åœ¨æ¯ä¸ª@value{DF}çš„å¼€å§‹ä¸ç»“æŸã€‚ä¸ä½†@emph{å¾ˆå¥½åœ°}ç”¨ 9 è¡Œä»£ç è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œè€Œä¸”è¿˜å¯ç§»æ¤ç§°ï¼Œè¿™åœ¨ä»»ä½• @command{awk} å®ç°ç‰ˆæœ¬éƒ½å¯å·¥ä½œã€‚

@example
# transfile.awk
#
# Give the user a hook for filename transitions
#
# The user must supply functions beginfile() and endfile()
# that each take the name of the file being started or
# finished, respectively.
@c #
@c # Arnold Robbins, arnold@@skeeve.com, Public Domain
@c # January 1992

FILENAME != _oldfilename @{
    if (_oldfilename != "")
        endfile(_oldfilename)
    _oldfilename = FILENAME
    beginfile(FILENAME)
@}

END @{ endfile(FILENAME) @}
@end example

è¿™ä¸ªæ–‡ä»¶å¿…é¡»åœ¨ç”¨æˆ·çš„ä¸»ç¨‹åºä¹‹å‰è£…å…¥ï¼Œå› æ­¤è¿™é‡Œæ‰€æä¾›çš„è§„åˆ™ä¼šé¦–å…ˆæ‰§è¡Œã€‚

è¿™ä¸ªè§„åˆ™ä¾èµ–äº @command{awk} çš„ @code{FILENAME} å˜é‡ï¼Œè¿™ä¸ªå˜é‡åœ¨å¤„ç†æ¯ä¸ªæ–°çš„@value{DF}æ—¶è‡ªåŠ¨å˜åŒ–ã€‚
å½“å‰çš„@value{DF}å­˜å‚¨åœ¨ä¸€ä¸ªç§æœ‰å˜é‡ï¼Œ@code{_oldfilename} ä¸­ã€‚å¦‚æœ @code{FILENAME} ä¸ @code{_oldfilename} ä¸ç›¸åŒï¼Œåˆ™ä¸€ä¸ªæ–°çš„æ•°æ®æ–‡ä»¶æ­£åœ¨è¢«å¤„ç†ï¼Œåˆ™æœ‰å¿…é¡»ä¸ºæ—§æ–‡ä»¶è°ƒç”¨ @code{endfile()}ã€‚å› ä¸º @code{endfile()} ä»…åœ¨ä¸€ä¸ªæ–‡ä»¶è¢«å¤„ç†å®Œåä¼šè°ƒç”¨ï¼Œæ‰€ä»¥ï¼Œç¨‹åºé¦–å…ˆè¦æ£€æŸ¥ç¡®å®š @code{_oldfilename} ä¸æ˜¯ä¸€ä¸ªç©ºä¸²ã€‚ç¨‹åºç„¶åå°†å½“å‰@value{FN}èµ‹å€¼ç»™ @code{_oldfilename} ç„¶åä¸ºå½“å‰æ–‡ä»¶è°ƒç”¨ @code{beginfile()}ã€‚åƒ @command{awk} çš„å˜é‡ä¸€æ ·ï¼Œå› ä¸º @code{_oldfilename} è¢«åˆå§‹åŒ–ä¸ºç©ºä¸²ï¼Œè¿™ä¸ªè§„åˆ™ç”šè‡³åœ¨è¯»å–ç¬¬ä¸€ä¸ª@value{DF}æ—¶ä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚

ç¨‹åºä¹Ÿæä¾›ä¸€ä¸ª @code{END} è§„åˆ™æ¥å¤„ç†æœ€åä¸€ä¸ªæ–‡ä»¶ã€‚å› ä¸ºè¿™ä¸ª @code{END} è§„åˆ™åœ¨ä»»ä½•å…¶ä»–çš„ç”±ä¸»ç¨‹åºæä¾› @code{END} è§„åˆ™ä¹‹å‰ï¼Œå› æ­¤ @code{endfile()} ä¼šé¦–å…ˆè¢«è°ƒç”¨ã€‚å†ä¸€æ¬¡åœ°ï¼Œ å¤šä¸ª @code{BEGIN} ä¸ @code{END} è§„åˆ™çš„å€¼åº”è¯¥è¢«æ¸…é™¤ã€‚

@cindex @code{beginfile()} user-defined function
@cindex @code{endfile()} user-defined function
å¦‚æœåŒæ ·çš„@value{DF}åœ¨ä¸€ä¸ªå‘½ä»¤ä¸­å‡ºç°äº†ä¸¤æ¬¡ï¼Œåˆ™ @code{endfile()} ä¸ @code{beginfile()} åœ¨ç¬¬ä¸€è½®ç»“æŸçš„æ—¶å€™ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œåœ¨ç¬¬äºŒè½®å¼€å§‹çš„æ—¶å€™æ‰§è¡Œã€‚ä¸‹é¢çš„ç‰ˆæœ¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š

@example
@c file eg/lib/ftrans.awk
# ftrans.awk --- handle datafile transitions
#
# user supplies beginfile() and endfile() functions
@c endfile
@ignore
@c file eg/lib/ftrans.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# November 1992
@c endfile
@end ignore
@c file eg/lib/ftrans.awk

FNR == 1 @{
    if (_filename_ != "")
        endfile(_filename_)
    _filename_ = FILENAME
    beginfile(FILENAME)
@}

END @{ endfile(_filename_) @}
@c endfile
@end example

åœ¨ @ref{Wc Program}ï¼Œä¸­å±•ç¤ºäº†è¿™ä¸ªåº“å‡½æ•°å¯ä»¥ç”¨äºä»¥åŠå¦‚ä½•æ¥ç®€åŒ–ä¸»ç¨‹åºçš„ç¼–å†™ã€‚

@sidebar é‚£ä¹ˆä¸ºä»€ä¹ˆ @command{gawk} éœ€è¦ @code{BEGINFILE} ä¸ @code{ENDFILE}?

ä½ å¯èƒ½å¾ˆå¥‡æ€ªï¼Œå¦‚æœ @code{beginfile()} ä¸ @code{endfile()} å‡½æ•°å¯ä»¥åšç›¸åŒçš„äº‹æƒ…ï¼Œä¸ºä»€ä¹ˆ @command{gawk} è¿˜è¦æœ‰ @code{BEGINFILE} ä¸ @code{ENDFILE} æ¨¡å¼å‘¢ï¼Ÿ

é—®é¢˜å¾ˆå¥½ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœ @command{awk} æ²¡æ³•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¼šç«‹å³å¯¼è‡´ä¸€ä¸ªè‡´ä½¿é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºç”¨æˆ·è‡ªå·±å®šä¹‰çš„å‡½æ•°æ¥è®²ï¼Œå°±æ²¡æœ‰åŠæ³•æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚å› ä¸ºè°ƒç”¨å‡½æ•°çš„æœºåˆ¶ä¾èµ–äºæ­£åœ¨è¢«æ‰“å¼€çš„æ–‡ä»¶åŠå…¶ç¬¬ä¸€æ¡è®°å½•ã€‚æ‰€ä»¥ï¼Œ@code{BEGINFILE} çš„ä¸»è¦åŸå› æ˜¯ç»™ä½ ä¸€ä¸ªâ€œå‹¾å­â€æ¥æ•è·ä¸èƒ½è¢«å¤„ç†çš„æ–‡ä»¶ã€‚è¦å–å¾—æ›´å¤šçš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ @ref{BEGINFILE/ENDFILE}ã€‚
@end sidebar

@node Rewind Function
@subsection é‡æ–°è¯»å–å½“å‰æ–‡ä»¶

@cindex files, reading
å¯¹äºå†…ç½®å‡½æ•°çš„å¦ä¸€ä¸ªè¯·æ±‚åˆ™æ˜¯åŠ å…¥è¿™æ ·çš„ä¸€ä¸ªå‡½æ•°ä½¿å…¶å¯ä»¥é‡æ–°è¯»å–å½“å‰æ–‡ä»¶ã€‚è¯·æ±‚çš„ç”¨æˆ·ä¸æƒ³åœ¨å¾ªç¯ä¸­ä½¿ç”¨ @code{getline}ï¼ˆæŸ¥çœ‹ @pxref{Getline}ï¼‰ã€‚

ä½†æ˜¯ï¼Œåªè¦ä½ è¿˜ä¸åœ¨ @code{END} è§„åˆ™ä¸­ï¼Œå°±éå¸¸å®¹æ˜“å®‰æ’ç«‹å³å…³é—­å½“å‰æ–‡ä»¶ï¼Œç„¶æ–°å¤´å¼€å§‹å¤„ç†è¿™ä¸ªæ–‡ä»¶ã€‚ç”±äºç¼ºå°‘å¥½åå­—ï¼Œæˆ‘ä»¬æŠŠå®ƒå–åä¸º @code{rewind()}ï¼š

@cindex @code{rewind()} user-defined function
@example
@c file eg/lib/rewind.awk
# rewind.awk --- rewind the current file and start over
@c endfile
@ignore
@c file eg/lib/rewind.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# September 2000
@c endfile
@end ignore
@c file eg/lib/rewind.awk

function rewind(    i)
@{
    # shift remaining arguments up
    for (i = ARGC; i > ARGIND; i--)
        ARGV[i] = ARGV[i-1]

    # make sure gawk knows to keep going
    ARGC++

    # make current file next to get done
    ARGV[ARGIND+1] = FILENAME

    # do it
    nextfile
@}
@c endfile
@end example

@code{rewind()} å‡½æ•°ä¾èµ–äº @code{ARGIND} å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{Auto-set}ï¼‰ï¼Œè¿™ä¸ªå˜é‡æ˜¯ @command{gawk} ç‰¹æœ‰çš„ã€‚åŒæ—¶ä¹Ÿä¾èµ–äº @code{nextfile} å…³é”®è¯ï¼ˆæŸ¥çœ‹ @pxref{Nextfile Statement}ï¼‰ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œä½ ä¸å¯ä»¥åœ¨ @code{ENDFILE} è§„åˆ™ä¸­è°ƒç”¨å®ƒã€‚ï¼ˆä¹Ÿæ²¡æœ‰å¿…è¦ï¼Œå› æ­¤ @command{gawk} åªè¦ @code{ENDFILE} ä¸€ç»“æŸå°±å¼€å§‹äº†ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼ï¼‰

ä½ éœ€è¦å°å¿ƒåœ°è°ƒç”¨ @code{rewind()}ã€‚å¦‚æœä½ ä¸æ³¨æ„çš„è¯ï¼Œå¯èƒ½ä¼šå¼•å‘æ— é™å¾ªç¯è€Œç»“æŸç¨‹åºã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªä½¿ç”¨çš„ä¾‹å­ï¼š

@example
$ @kbd{cat data}
@print{} a
@print{} b
@print{} c
@print{} d
@print{} e

$ cat @kbd{test.awk}
@print{} FNR == 3 && ! rewound @{
@print{} 	rewound = 1
@print{} 	rewind()
@print{} @}
@print{} 
@print{} @{ print FILENAME, FNR, $0 @}

$ @kbd{gawk -f rewind.awk -f test.awk data }
@print{} data 1 a
@print{} data 2 b
@print{} data 1 a
@print{} data 2 b
@print{} data 3 c
@print{} data 4 d
@print{} data 5 e
@end example

@node File Checking
@subsection æ£€æŸ¥å¯è¯»çš„@value{DDF}

@cindex troubleshooting, readable data files
@cindex readable data files@comma{} checking
@cindex files, skipping
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æä¾› @command{awk} ä¸€ä¸ª@value{DF}æ˜¯ä¸å¯è¯»çš„ï¼Œå®ƒä¼šä»¥è‡´ä½¿é”™è¯¯è€Œç»“æŸã€‚æœ‰ä¸€äº›æ—¶å€™ï¼Œä½ å¯èƒ½æƒ³å¿½ç•¥è¿™æ ·çš„é—®é¢˜å¹¶å¾€ä¸‹èµ°ã€‚
@footnote{@code{BEGINFILE} ç‰¹å®šæ¨¡å¼ï¼ˆæŸ¥çœ‹ @pxref{BEGINFILE/ENDFILE}ï¼‰æä¾›äº†å¦ä¸€ç§æœºåˆ¶æ¥å¤„ç†é‚£äº›ä¸å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œçš„ä»£ç æä¾›äº†ä¸€ç§å¯ç§»æ¤çš„æ–¹æ¡ˆã€‚}
ä½ å¯ä»¥å°†ä¸‹é¢çš„ç¨‹åºæ’å…¥åˆ°ä½ çš„ @command{awk} ç¨‹åºä¸­ï¼š

@cindex @code{readable.awk} program
@example
@c file eg/lib/readable.awk
# readable.awk --- library file to skip over unreadable files
@c endfile
@ignore
@c file eg/lib/readable.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# October 2000
# December 2010
@c endfile
@end ignore
@c file eg/lib/readable.awk

BEGIN @{
    for (i = 1; i < ARGC; i++) @{
        if (ARGV[i] ~ /^[a-zA-Z_][a-zA-Z0-9_]*=.*/ \
            || ARGV[i] == "-" || ARGV[i] == "/dev/stdin")
            continue    # assignment or standard input
        else if ((getline junk < ARGV[i]) < 0) # unreadable
            delete ARGV[i]
        else
            close(ARGV[i])
    @}
@}
@c endfile
@end example

@cindex troubleshooting, @code{getline} function
è¿™ä¸ªå¯ä»¥å·¥ä½œï¼Œå› ä¸º @code{getline} ä¸ä¼šå¯¼è‡´è‡´ä½¿é”™è¯¯ã€‚å°† @code{delete} ä» @code{ARGV} æ•°ç»„ä¸­ç§»é™¤å…ƒç´ ä»¥è·³è¿‡è¿™äº›æ–‡ä»¶ï¼ˆå› æ­¤å®ƒä¸å†åœ¨åˆ—è¡¨ä¸­ï¼‰ã€‚æŸ¥çœ‹ @ref{ARGC and ARGV}ã€‚

ç”±äº @command{awk} å˜é‡åå­—åªå…è®¸æ˜¯è‹±æ–‡å­—æ¯ï¼Œæ‰€ä»¥æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥æœ‰æ„ä¸ä½¿ç”¨å­—ç¬¦ç±»ï¼Œå¦‚ @samp{[:alpha:]} ä¸ @samp{[:alnum:]} ï¼ˆæŸ¥çœ‹ 
@pxref{Bracket Expressions}ï¼‰ã€‚

@node Empty Files
@subsection æ£€æŸ¥é•¿åº¦ä¸ºé›¶çš„æ–‡ä»¶

æ‰€æœ‰å·²çŸ¥çš„ @command{awk} å®ç°éƒ½é»˜é»˜åœ°è·³è¿‡é•¿åº¦ä¸ºé›¶çš„æ–‡ä»¶ã€‚è¿™æ˜¯ç”± @command{awk} éšå¼è§„åˆ™â€œè¯»å–è®°å½•å¹¶åŒ¹é…è§„åˆ™â€å¾ªç¯äº§ç”Ÿçš„ç»“æœã€‚å½“ @command{awk} å°è¯•è¯»å–ç©ºæ–‡ä»¶è®°å½•æ—¶ï¼Œå®ƒç«‹å³ä¼šæ¥æ”¶åˆ°æ–‡ä»¶ç»“æŸçš„æŒ‡ç¤ºï¼Œç„¶åä¼šå…³é—­æ–‡ä»¶ï¼Œå¹¶å¤„ç†å‘½ä»¤è¡Œä¸­çš„ä¸‹ä¸€ä¸ª@value{DF}ï¼Œè€Œ@emph{ä¸ä¼š}æ‰§è¡Œä»»åŠ¡ç”¨æˆ·å±‚çš„ @command{awk} ç¨‹åºä»£ç ã€‚

ä½¿ç”¨ @command{gawk} çš„ @code{ARGIND} å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ï¼Œæœ‰å¯èƒ½æ¥æ£€æµ‹å½“é‡åˆ°ä¸€ä¸ªç©º@value{DF}æ—¶åˆ™è·³è¿‡ã€‚
ä¸åœ¨ @ref{Filetrans Function}ï¼Œå‘ˆç°çš„åº“æ–‡ä»¶ç›¸ä¼¼ï¼Œä¸‹é¢çš„åº“æ–‡ä»¶ä¼šè°ƒç”¨ç”¨æˆ·å¿…é¡»æä¾›çš„å‡½æ•°ï¼Œåä¸º @code{zerofile()}ã€‚ä¼ é€’çš„å‚æ•°ä¸º@value{FN}ï¼Œä»¥åŠå…¶åœ¨ @code{ARGV} ä¸­çš„ä½ç½®ï¼š

@cindex @code{zerofile.awk} program
@example
@c file eg/lib/zerofile.awk
# zerofile.awk --- library file to process empty input files
@c endfile
@ignore
@c file eg/lib/zerofile.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# June 2003
@c endfile
@end ignore
@c file eg/lib/zerofile.awk

BEGIN @{ Argind = 0 @}

ARGIND > Argind + 1 @{
    for (Argind++; Argind < ARGIND; Argind++)
        zerofile(ARGV[Argind], Argind)
@}

ARGIND != Argind @{ Argind = ARGIND @}

END @{
    if (ARGIND > Argind)
        for (Argind++; Argind <= ARGIND; Argind++)
            zerofile(ARGV[Argind], Argind)
@}
@c endfile
@end example

ç”¨æˆ·å±‚çš„å˜é‡ @code{Argind} å…è®¸ @command{awk} ç¨‹åºè·Ÿè¸ªå®ƒçš„ @code{ARGV} è¿›åº¦ã€‚
æ— è®ºä»€ä¹ˆæ—¶å€™ç¨‹åºæ£€æµ‹åˆ°äº† @code{ARGIND} å¤§äº @samp{Argind + 1}ï¼Œè¿™å°±è¡¨ç¤ºä¸€åˆ°å¤šä¸ªçš„æ–‡ä»¶åå·²ç»è¢«è·³è¿‡äº†ã€‚ç„¶åè°ƒç”¨ @code{zerofile()} çš„åŠ¨ä½œæ¥å¤„ç†æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶é€’å¢ Argind å˜é‡ã€‚

@samp{Argind != ARGIND} ä¸­æ˜¯ç®€å•åœ°æ¥ä½¿ @code{Argind} åœ¨æ­£å¸¸æƒ…å†µä¸‹æ›´æ–°ä¸ºæœ€æ–°çŠ¶æ€ã€‚

æœ€å @code{END} è§„åˆ™ä¼šæ•è·åœ¨å‘½ä»¤è¡Œæœ€åçš„å‚æ•°ä¸­çš„ç©ºæ–‡ä»¶ã€‚æ³¨æ„åœ¨ @code{for} å¾ªç¯ä¸­ä½¿ç”¨çš„æµ‹è¯•æ¡ä»¶ï¼Œæ˜¯ ä½¿ç”¨ @samp{<=} æ“ä½œç¬¦è€Œä¸æ˜¯ @samp{<}ã€‚

@node Ignoring Assigns
@subsection å°†èµ‹å€¼å½“æˆæ˜¯@value{FFN}

@cindex assignments as filenames
@cindex filenames, assignments as
æœ‰æ—¶å€™ï¼Œä½ ä¸æƒ³ @command{awk} æ¥å¤„ç†å‘½ä»¤è¡Œçš„å˜é‡èµ‹å€¼ï¼ˆæŸ¥çœ‹ @pxref{Assignment Options}ï¼‰ã€‚
å°¤å…¶æ˜¯ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸­åŒ…å« @samp{=} ç¬¦å·ï¼Œ@command{awk} ä¼šå°†è¿™ä¸ª@value{FN}å½“æˆä¸€ä¸ªèµ‹å€¼ï¼Œè€Œä¸ä¼šå¤„ç†å®ƒã€‚

ä¸€äº›ç”¨æˆ·æ›¾å»ºè®®äº†ä¸€ä¸ªé¢å¤–çš„å‘½ä»¤è¡Œé€‰é¡¹æ¥ç»™ @command{gawk} å»ç¦ç”¨å‘½ä»¤è¡Œçš„èµ‹å€¼ã€‚ä½†æ˜¯ï¼Œä¸€äº›åº“æ–‡ä»¶ä¸­çš„ç®€å•çš„ç¨‹åºå°±å¯ä»¥è§£å†³ï¼š

@cindex @code{noassign.awk} program
@example
@c file eg/lib/noassign.awk
# noassign.awk --- library file to avoid the need for a
# special option that disables command-line assignments
@c endfile
@ignore
@c file eg/lib/noassign.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# October 1999
@c endfile
@end ignore
@c file eg/lib/noassign.awk

function disable_assigns(argc, argv,    i)
@{
    for (i = 1; i < argc; i++)
        if (argv[i] ~ /^[a-zA-Z_][a-zA-Z0-9_]*=.*/)
            argv[i] = ("./" argv[i])
@}

BEGIN @{
    if (No_command_assign)
        disable_assigns(ARGC, ARGV)
@}
@c endfile
@end example

ç„¶åä½ è¿™ä¹ˆæ¥è¿è¡Œç¨‹åºï¼š

@example
awk -v No_command_assign=1 -f noassign.awk -f yourprog.awk *
@end example

å‡½æ•°ä¼šè¿­ä»£æ‰€æœ‰çš„å‚æ•°ã€‚å®ƒä¼šåœ¨åŒ¹é…å˜é‡èµ‹å€¼å½¢å¼çš„å‚æ•°å‰æ’å…¥ @samp{./}ï¼Œæ¥å°†å‚æ•°è½¬æ¢ä¸º@value{FN}ã€‚

é€šè¿‡ç»™ @code{No_command_assign} åœ¨è°ƒç”¨æ—¶èµ‹å€¼ä¸º trueï¼Œå¯ä»¥è®©ä½ è°ƒç”¨æ—¶ç¦ç”¨å‘½ä»¤è¡Œä¸­çš„èµ‹å€¼ã€‚å½“æ²¡æœ‰è®¾ç½®æ—¶ï¼Œå®ƒçš„åˆå§‹å€¼ä¸º 0ï¼ˆå³ falseï¼‰ï¼Œæ‰€ä»¥å‘½ä»¤è¡Œå‚æ•°å°±ä¸ä¼šå˜åŒ–ã€‚

@node Getopt Function
@section å¤„ç†å‘½ä»¤è¡Œé€‰é¡¹

@cindex libraries of @command{awk} functions, command-line options
@cindex functions, library, command-line options
@cindex command-line options, processing
@cindex options, command-line, processing
@cindex functions, library, C library
@cindex arguments, processing
åœ¨ POSIX å…¼å®¹çš„ç³»ç»Ÿä¸Šçš„å¤§å¤šæ•°å·¥å…·éƒ½ä»å‘½ä»¤è¡Œä¸­å–å¾—é€‰é¡¹ï¼Œç”¨æ­¤æ¥æ”¹å˜ç¨‹åºçš„è¡Œä¸ºæ–¹å¼ã€‚@command{awk} æ˜¯ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚
ç»å¸¸åœ°ï¼Œé€‰é¡¹éƒ½ä¼šæœ‰@dfn{å‚æ•°}ï¼ˆå³ç¨‹åºå‘½ä»¤è¡Œè¦æ­£ç¡®éµå®ˆé€‰é¡¹çš„æ‰€éœ€è¦çš„æ•°æ®ï¼‰ã€‚ä¾‹å¦‚ @command{awk} çš„ @option{-F} é€‰é¡¹ï¼Œéœ€è¦ä¸€ä¸ªä¸²æ¥ä½œä¸ºåŸŸçš„åˆ†éš”ç¬¦ã€‚ç¬¬ä¸€ä¸ªå‡ºç°åœ¨å‘½ä»¤è¡Œä¸­çš„ @option{--} æˆ–è€…ä¸èƒ½ @samp{-} å¼€å¤´çš„å­—ä¸²ç»“æŸé€‰é¡¹ã€‚

@cindex @code{getopt()} function (C library)
ç°åœ¨çš„ Unix ç³»ç»Ÿæä¾›äº† C å‡½æ•°ï¼Œåå­—ä¸º @code{getopt()} æ¥å¤„ç†å‘½ä»¤è¡Œå‚æ•°ã€‚ç¨‹åºå‘˜æä¾›ä¸€ä¸ªå­—ä¸²ç”¨æ¥æè¿°å•å­—æ¯çš„é€‰é¡¹ã€‚å¦‚æœé€‰é¡¹éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œåˆ™å®ƒåœ¨å­—ä¸²ååé¢ä¼šè·Ÿä¸€ä¸ªå†’å·ã€‚@code{getopt()} åŒæ—¶ä¹Ÿä¼ é€’å‘½ä»¤è¡Œå‚æ•°çš„æ•°é‡ä¸å€¼ï¼Œå¹¶åœ¨å¾ªç¯ä¸­è¿›è¡Œè°ƒç”¨ã€‚@code{getopt()} ä¸ºé€‰é¡¹å­—æ¯å¤„ç†å‘½ä»¤è¡Œå‚æ•°ã€‚æ¯æ¬¡è¿­ä»£å¾ªç¯ï¼Œå®ƒå°±è¿”å›ä¸€ä¸ªä»£è¡¨ä¸‹ä¸€ä¸ªå®ƒæ‰€å‘ç°çš„é€‰é¡¹å­—æ¯ï¼Œæˆ–è€…ä¸ºæ— æ•ˆçš„é€‰é¡¹çš„æ—¶å€™ï¼Œè¿”å› @samp{?}ã€‚å½“è¿”å› @minus{}1 æ—¶ï¼Œè¡¨ç¤ºå‘½ä»¤è¡Œä¸­æ²¡æœ‰è¦å¤„ç†çš„é€‰é¡¹äº†ã€‚

å½“ä½¿ç”¨ @code{getopt()} æ—¶ï¼Œæ²¡æœ‰å¸¦å‚æ•°çš„é€‰é¡¹å¯ä»¥è¢«åˆå¹¶åœ¨ä¸€èµ·ã€‚å¦å¤–ï¼Œéœ€è¦å¸¦å‚æ•°é€‰é¡¹éœ€è¦å‚æ•°ä¸è¦æä¾›ã€‚å‚æ•°å¯ä»¥ç›´æ¥è·Ÿåœ¨é€‰é¡¹å­—æ¯åé¢ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ†ç¦»çš„å‘½ä»¤è¡Œå‚æ•°ã€‚

å‡è®¾æœ‰ä¸€ä¸ªå‡æƒ³çš„ç¨‹åºï¼Œæ¥æ”¶ä¸‰ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œ@option{-a}ï¼Œ@option{-b} ä¸ @option{-c}ï¼Œè€Œ @option{-b} éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä¸‹é¢æ‰€æœ‰çš„è¯¥å½“éƒ½æ˜¯æœ‰æ•ˆçš„è°ƒç”¨ç¨‹åºçš„æ–¹å¼ï¼š

@example
prog -a -b foo -c data1 data2 data3
prog -ac -bfoo -- data1 data2 data3
prog -acbfoo data1 data2 data3
@end example

æ³¨æ„åˆ°ï¼Œå½“å‚æ•°ä¸å®ƒçš„é€‰é¡¹è¿›è¡Œç»„åˆæ—¶ï¼Œå‚æ•°åé¢çš„éƒ¨åˆ†éƒ½è¢«å½“æˆæ˜¯é€‰é¡¹çš„å‚æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ@option{-abcfoo} è¡¨ç¤ºæ‰€æœ‰çš„ @option{-a}ï¼Œ@option{-b} ä¸ @option{-c} é€‰é¡¹ï¼Œå¹¶ä¸” @samp{foo} æ˜¯ @option{-b} é€‰é¡¹çš„å‚æ•°ã€‚

@code{getopt()} æä¾›äº† 4 ä¸ªå¤–éƒ¨çš„å˜é‡ï¼Œä¾›ç¨‹åºå‘˜ä½¿ç”¨ï¼š

@table @code
@item optind
åœ¨å‚æ•°å€¼æ•°ç»„ï¼ˆ@code{argv}ï¼‰ä¸­çš„ç´¢å¼•ï¼Œåœ¨è¿™ä¸ªæ•°ç»„ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸æ˜¯é€‰é¡¹çš„å‘½ä»¤å‚æ•°ã€‚

@item optarg
æŸæ­¤é€‰é¡¹çš„å‚æ•°çš„å­—ä¸²å€¼ã€‚

@item opterr
é€šå¸¸æƒ…å†µä¸‹ï¼Œ@code{getopt()} åœ¨æ‰¾åˆ°ä¸€ä¸ªæ— æ•ˆçš„é€‰é¡¹çš„æ—¶å€™ä¼šæ‰“å°ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ã€‚å°† @code{opterr} è®¾ç½®ä¸º 0 å¯ä»¥ç¦ç”¨è¿™ä¸ªç‰¹æ€§ã€‚ï¼ˆåº”ç”¨ç¨‹åºå¯èƒ½æƒ³æ‰“å°è‡ªå·±çš„é”™è¯¯æ¶ˆæ¯ã€‚ï¼‰

@item optopt
ä»£è¡¨å‘½ä»¤è¡Œé€‰é¡¹çš„å­—æ¯ã€‚
@end table

ä¸‹é¢çš„ C ä»£ç ç‰ˆæœ¬å±•ç¤ºäº† @code{getopt()} å¦‚ä½•æ¥å¤„ç† @command{awk} å‘½ä»¤è¡Œå‚æ•°çš„å¯èƒ½æ–¹å¼ï¼š

@example
int
main(int argc, char *argv[])
@{
    @dots{}
    /* print our own message */
    opterr = 0;
    while ((c = getopt(argc, argv, "v:f:F:W:")) != -1) @{
        switch (c) @{
        case 'f':    /* file */
            @dots{}
            break;
        case 'F':    /* field separator */
            @dots{}
            break;
        case 'v':    /* variable assignment */
            @dots{}
            break;
        case 'W':    /* extension */
            @dots{}
            break;
        case '?':
        default:
            usage();
            break;
        @}
    @}
    @dots{}
@}
@end example

æ’ä¸€å¥ï¼Œ@command{gawk} å®é™…ä¸Šæ˜¯ä½¿ç”¨ GNU çš„ @code{getopt_long()} å‡½æ•°æ¥å¤„ç†å¸¸è§„çš„é€‰é¡¹ä»¥åŠ GNU é£æ ¼çš„é•¿é€‰é¡¹ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚

ç”± @code{getopt()} æä¾›çš„æŠ½è±¡éå¸¸æœ‰ç”¨ï¼Œå¹¶ä¸”åœ¨ @command{awk} ç¨‹åºä¸­ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª @command{awk} ç‰ˆæœ¬çš„ @code{getopt()}ã€‚
è¿™ä¸ªå‡½æ•°çªå‡ºäº† @command{awk} ä¸­æœ€å¼±çš„ä¸€ä¸ªæ–¹é¢ï¼Œå³å®ƒåœ¨å¤„ç†å•ä¸ªå­—ç¬¦çš„æ—¶å€™éå¸¸å·®ã€‚é‡å¤åœ°è°ƒç”¨ @code{substr()} åœ¨è¯»å–å•ä¸ªå­—ç¬¦æ—¶æ˜¯å¿…é¡»çš„ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚ 
@footnote{è¿™ä¸ªç‰ˆæœ¬åœ¨ @command{gawk} è¦æ±‚ç”¨ @code{""} å°†å­—ä¸²åˆ†éš”ä¸ºå­—ç¬¦çš„èƒ½åŠ›ä¹‹å‰å†™æˆçš„ã€‚æˆ‘ä»¬å·²ç»ä¸ç®¡å®ƒäº†ï¼Œå› ä¸ºç”¨ @code{substr()} å¯ç§»æ¤æ€§æ›´å¥½ã€‚}

ä¸‹é¢ä¸€ç‚¹ç‚¹åœ°æ¥è§£é‡Šä»£ç ï¼š

@cindex @code{getopt()} user-defined function
@example
@c file eg/lib/getopt.awk
# getopt.awk --- Do C library getopt(3) function in awk
@c endfile
@ignore
@c file eg/lib/getopt.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
#
# Initial version: March, 1991
# Revised: May, 1993
@c endfile
@end ignore
@c file eg/lib/getopt.awk

# External variables:
#    Optind -- index in ARGV of first nonoption argument
#    Optarg -- string value of argument to current option
#    Opterr -- if nonzero, print our own diagnostic
#    Optopt -- current option letter

# Returns:
#    -1     at end of options
#    "?"    for unrecognized option
#    <c>    a character representing the current option

# Private Data:
#    _opti  -- index in multiflag option, e.g., -abc
@c endfile
@end example

å‡½æ•°ä»¥æ³¨é‡Šå¼€å§‹ï¼Œè¯´æ˜äº†å®ƒæ‰€ä½¿ç”¨çš„å…¨å±€å˜é‡çš„ä¸€ä¸ªåˆ—è¡¨ï¼Œè¿”å›çš„å€¼æ˜¯ä»€ä¹ˆï¼Œä»–ä»¬åˆè¡¨ç¤ºä»€ä¹ˆï¼Œä»¥åŠè¿™ä¸ªåº“å‡½æ•°æ‰€ç§æœ‰çš„å…¨å±€å˜é‡ã€‚è¿™æ ·çš„æ–‡æ¡£å¯¹äºä»»ä½•ç¨‹åºæ¥è®²éƒ½æ˜¯å¾ˆé‡è¦çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºåº“å‡½æ•°ã€‚

@code{getopt()} å‡½æ•°é¦–å…ˆæ£€æŸ¥ç¡®å®æ˜¯ä»¥é€‰é¡¹çš„ä¸²æ¥è¿›è¡Œè°ƒç”¨çš„ï¼ˆ@code{options} å‚æ•°ï¼‰ã€‚
å¦‚æœ @code{options} çš„é•¿åº¦ä¸º 0ï¼Œåˆ™ @code{getopt()} ä¼šç«‹å³è¿”å› @minus{}1 ï¼š

@cindex @code{getopt()} user-defined function
@example
@c file eg/lib/getopt.awk
function getopt(argc, argv, options,    thisopt, i)
@{
    if (length(options) == 0)    # no options given
        return -1

@group
    if (argv[Optind] == "--") @{  # all done
        Optind++
        _opti = 0
        return -1
@end group
    @} else if (argv[Optind] !~ /^-[^:[:space:]]/) @{
        _opti = 0
        return -1
    @}
@c endfile
@end example

ä¸‹ä¸ªè¦åšçš„äº‹æƒ…æ˜¯è¦æ£€æŸ¥é€‰é¡¹çš„ç»“æŸã€‚@option{--} ç”¨äºç»“æŸå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•çš„å‘½ä»¤è¡Œå‚æ•°ä¸æ˜¯ä»¥ @samp{-} å¼€å§‹ã€‚@code{Optind} ç”¨æ¥ä¸€ä¸ªä¸ªåœ°è¿­ä»£å‘½ä»¤è¡Œå‚æ•°æ•°ç»„ï¼Œå®ƒåœ¨è°ƒç”¨ @code{getopt()} çš„è¿‡ç¨‹ä¸­ä¸€ç›´ä¿ç•™å®ƒçš„å€¼ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ã€‚

åœ¨è¿™é‡Œä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ @code{@w{/^-[^:[:space:]/}}ï¼Œç”¨äºæ£€æŸ¥ @samp{-} åé¢è·Ÿä»»æ„çš„ä¸æ˜¯ç©ºæ ¼ä¸å†’å·çš„å­—ç¬¦ã€‚å¦‚æœå‘½ä»¤è¡Œå‚æ•°ä¸åŒ¹é…è¿™ä¸ªæ¨¡å¼ï¼Œåˆ™å®ƒå°±ä¸æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œç„¶åç»“æŸå¤„ç†ã€‚åç»­ï¼š

@example
@c file eg/lib/getopt.awk
    if (_opti == 0)
        _opti = 2
    thisopt = substr(argv[Optind], _opti, 1)
    Optopt = thisopt
    i = index(options, thisopt)
    if (i == 0) @{
        if (Opterr)
            printf("%c -- invalid option\n", thisopt) > "/dev/stderr"
        if (_opti >= length(argv[Optind])) @{
            Optind++
            _opti = 0
        @} else
            _opti++
        return "?"
    @}
@c endfile
@end example

@code{_opti} å˜é‡ç”¨äºè·Ÿè¸ªå½“å‰å‘½ä»¤è¡Œå‚æ•°çš„ä½ç½®ï¼ˆ@code{argv[Optind]}ï¼‰ã€‚å¦‚æœæœ‰å¤šä¸ªé€‰é¡¹ç”¨ @samp{-} åˆå¹¶åœ¨ä¸€èµ·ï¼ˆå¦‚ï¼Œ@option{-abx}ï¼‰ï¼Œåˆ™æœ‰å¿…è¦ä¸€æ¬¡è¿”å›ä¸€ä¸ªã€‚

å¦‚æœ @code{_opti} çš„ç­‰äº 0ï¼Œåˆ™è¢«è®¾ç½®ä¸º 2ï¼Œè¿™ä¸ªå€¼æ˜¯å­—ä¸²ä¸­ä¸‹ä¸€ä¸ªè¦æŸ¥æ‰¾å­—ç¬¦çš„ä½ç½®ï¼ˆæˆ‘ä»¬è·³è¿‡ @samp{-}ï¼Œè€Œå®ƒçš„ä½ç½®æ˜¯ 1 ï¼‰ã€‚å˜é‡ @code{thisopt} ä¿å­˜ç”¨ @code{substr()} å–å¾—çš„å­—ç¬¦ã€‚å®ƒè¢«ä¿å­˜äº @code{Optopt} ä»¥å¤‡ä¸»ç¨‹åºçš„ä½¿ç”¨ã€‚

å¦‚æœ @code{thisopt} ä¸åœ¨é€‰é¡¹ä¸² @code{options} ä¸­ï¼Œåˆ™å®ƒä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é€‰é¡¹ã€‚å¦‚æœ @code{Opterr} çš„å€¼ä¸ºé 0ï¼Œ@code{getopt()} æ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºä¸Šï¼Œè¿™ä¸ªä¸ C ç‰ˆæœ¬çš„ @code{getopt()} çš„ä¿¡æ¯ç±»ä¼¼ã€‚

ç”±äºé€‰é¡¹æ˜¯æ— æ•ˆçš„ï¼Œå°±æœ‰å¿…é¡»è·³è¿‡å®ƒå¹¶å¤„ç†ä¸‹ä¸€ä¸ªé€‰é¡¹å­—ç¬¦ã€‚å¦‚æœ @code{_opti} å¤§äºæˆ–è€…ç­‰äºå½“å‰å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªé•¿åº¦ï¼Œåˆ™æœ‰å¿…è¦ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå‚æ•°ã€‚æ‰€ä»¥ï¼Œ@code{Optind} è¢«é€’å¢ï¼Œ@code{_opti} è¢«è®¾ç½®ä¸º 0ã€‚å¦åˆ™çš„è¯ï¼Œ@code{Optind} ä¸ä¼šæ”¹å˜ï¼Œè€Œåªé€’å¢ @code{_opti}ã€‚

åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œç”±äºé€‰é¡¹æ˜¯æ— æ•ˆçš„ï¼Œ@code{getopt()} éƒ½è¿”å› @code{"?"}ã€‚ä¸»ç¨‹åºå¯ä»¥æ£€æŸ¥ @code{Optopt} ä»¥ç¡®å®šæ— æ•ˆçš„é€‰é¡¹åˆ°åº•æ˜¯ä»€ä¹ˆã€‚ç»§ç»­ï¼š

@example
@c file eg/lib/getopt.awk
    if (substr(options, i + 1, 1) == ":") @{
        # get option argument
        if (length(substr(argv[Optind], _opti + 1)) > 0)
            Optarg = substr(argv[Optind], _opti + 1)
        else
            Optarg = argv[++Optind]
        _opti = 0
    @} else
        Optarg = ""
@c endfile
@end example

å¦‚æœé€‰é¡¹éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œåœ¨é€‰é¡¹å­—ä¸² @code{options} ä¸­çš„é€‰é¡¹å­—æ¯åé¢ä¼šè·Ÿç€ä¸€ä¸ªå†’å·ã€‚å¦‚æœåœ¨å½“å‰çš„å‘½ä»¤å‚æ•°åˆ—è¡¨ä¸­ï¼ˆ@code{argv[Optind]}ï¼‰è¿˜æœ‰å­—ç¬¦ï¼Œåˆ™å­—ä¸²åé¢çš„å†…å®¹ä¼šè¢«èµ‹å€¼ç»™ @code{Optarg}ã€‚å¦åˆ™å°±ä½¿ç”¨ä¸‹ä¸€ä¸ªå‘½ä»¤å‚æ•°ï¼ˆ@samp{-xFOO} å¯¹ @samp{@w{-x FOO}}ï¼‰ã€‚
åœ¨ä»»ä¸€æƒ…å†µä¸‹ï¼Œ@code{_opti} éƒ½è¢«è®¾ç½®ä¸º 0ï¼Œå› ä¸ºæ²¡æœ‰æ›´å¤šçš„å­—ç¬¦å‰©ä¸‹æ¥æ£€æŸ¥å½“å‰çš„å‘½ä»¤è¡Œå‚æ•°ã€‚ç»§ç»­ï¼š

@example
@c file eg/lib/getopt.awk
    if (_opti == 0 || _opti >= length(argv[Optind])) @{
        Optind++
        _opti = 0
    @} else
        _opti++
    return thisopt
@}
@c endfile
@end example

æœ€åï¼Œå¦‚æœ @code{_opti} ä¸º 0 æˆ–è€…å¤§äºå½“å‰å‘½ä»¤è¡Œå‚æ•°çš„é•¿åº¦ï¼Œåˆ™å®ƒè¡¨ç¤ºå…ƒç´ åœ¨ argv ä¸­å·²ç»å¤„ç†äº†ï¼Œæ‰€ä»¥ï¼Œ@code{Optind} è¢«é€’å¢ä»¥æŒ‡å‘ä¸‹ä¸€ä¸ª @code{argv} ä¸­çš„å…ƒç´ ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªæ¡ä»¶ä¸º trueï¼Œåˆ™åªæœ‰ @code{_opti} è¢«é€’å¢ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªé€‰é¡¹å­—æ¯å¯ä»¥åœ¨ä¸‹æ¬¡è°ƒç”¨ @code{getopt()} æ—¶è¢«å¤„ç†ã€‚

@code{BEGIN} è§„åˆ™ä¸­å°† @code{Opterr} ä¸ @code{Optind} éƒ½è®¾ç½®ä¸º 1ã€‚@code{Opterr} è¢«è®¾ç½®ä¸º 1 çš„åŸå› æ˜¯ @code{getopt()} çš„é»˜è®¤è¡Œä¸ºå°±æ˜¯åœ¨å‘ç°æ— æ•ˆé€‰é¡¹çš„æ—¶å€™æ‰“å°è¯Šæ–­ä¿¡æ¯ã€‚@code{Optind} è®¾ç½®ä¸º 1 æ˜¯å› ä¸ºæ²¡æœ‰åŸå› è¦å»æŸ¥çœ‹ç¨‹åºåï¼Œå› ä¸ºç¨‹åºåå­˜åœ¨ @code{ARGV[0]} ä¸­ï¼š

@example
@c file eg/lib/getopt.awk
BEGIN @{
    Opterr = 1    # default is to diagnose
    Optind = 1    # skip ARGV[0]

    # test program
    if (_getopt_test) @{
        while ((_go_c = getopt(ARGC, ARGV, "ab:cd")) != -1)
            printf("c = <%c>, Optarg = <%s>\n",
                                       _go_c, Optarg)
        printf("non-option arguments:\n")
        for (; Optind < ARGC; Optind++)
            printf("\tARGV[%d] = <%s>\n",
                                    Optind, ARGV[Optind])
    @}
@}
@c endfile
@end example

@code{BEGIN} è§„åˆ™çš„å‰©ä¸‹éƒ¨åˆ†å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æµ‹è¯•ç¨‹åºã€‚è¿™æ˜¯ä¸¤ä¸Šä¾‹å­ï¼Œè¿è¡Œæµ‹è¯•ç¨‹åºæ—¶çš„ç»“æœï¼š

@example
$ @kbd{awk -f getopt.awk -v _getopt_test=1 -- -a -cbARG bax -x}
@print{} c = <a>, Optarg = <>
@print{} c = <c>, Optarg = <>
@print{} c = <b>, Optarg = <ARG>
@print{} non-option arguments:
@print{}         ARGV[3] = <bax>
@print{}         ARGV[4] = <-x>

$ @kbd{awk -f getopt.awk -v _getopt_test=1 -- -a -x -- xyz abc}
@print{} c = <a>, Optarg = <>
@error{} x -- invalid option
@print{} c = <?>, Optarg = <>
@print{} non-option arguments:
@print{}         ARGV[4] = <xyz>
@print{}         ARGV[5] = <abc>
@end example

åœ¨ä¸¤æ¬¡è¿è¡Œé‡Œï¼Œç¬¬ä¸€ä¸ª @option{--} ä¼šç»ˆç»“ @command{awk} ä¸­çš„å‚æ•°ï¼Œæ‰€ä»¥å®ƒä¸ä¼šè¯•å›¾å»å°† @option{-a} ç­‰ç­‰æ¥å½“æˆè‡ªå·±çš„é€‰é¡¹ã€‚

@quotation æç¤º
åœ¨ @code{getopt()} å®Œæˆåï¼Œç”¨æˆ·å±‚ä»£ç å¿…é¡»æ¸…é™¤æ‰€æœ‰çš„ @code{ARGV} å…ƒç´ ï¼Œä»ç´¢å¼• 1 åˆ° @code{Optind}ï¼Œæ‰€ä»¥ï¼Œ@command{awk} ä¸ä¼šè¯•å›¾å»æŠŠå‘½ä»¤è¡Œé€‰é¡¹å½“æˆ@value{FN}æ¥å¤„ç†ã€‚
@end quotation

ä½¿ç”¨ @samp{#!} å¹¶å¸¦ä¸Š @option{-E} é€‰é¡¹å¯ä»¥é¿å…å°†ä½ çš„ç¨‹åºçš„é€‰é¡¹ä¸ @command{gawk} çš„é€‰é¡¹çš„å†²çªï¼Œå› ä¸º @option{-E} é€‰é¡¹ä¼šå¯¼è‡´ @command{gawk} æ”¾å¼ƒå¤„ç†åç»­çš„é€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Executable Scripts}ï¼Œä»¥åŠ 
@ifnotdocbook
@ref{Options}ï¼‰ã€‚
@end ifnotdocbook
@ifdocbook
@ref{Options}ï¼‰ã€‚
@end ifdocbook

åœ¨ @ref{Sample Programs}ï¼Œä¸­çš„å‡ ä¸ªä¾‹å­ä½¿ç”¨ @code{getopt()} æ¥å¤„ç†å®ƒä»¬çš„å‚æ•°ã€‚

@node Passwd Functions
@section è¯»å–ç”¨æˆ·æ•°æ®åº“

@cindex libraries of @command{awk} functions, user database, reading
@cindex functions, library, user database@comma{} reading
@cindex user database@comma{} reading
@cindex database, users@comma{} reading
@cindex @code{PROCINFO} array
@code{PROCINFO} æ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰æä¾›äº†è®¿é—®å½“å‰ç”¨æˆ·ç›´å®ä¸æœ‰æ•ˆçš„ç”¨æˆ·ä¸ç»„ ID æ•°å€¼çš„æ–¹å¼ï¼Œå¹¶ä¸”å¦‚æœå¯ç”¨ï¼Œç”¨æˆ·çš„è¡¥å……çš„ç»„é›†ä¹Ÿå¯ä»¥è®¿é—®ã€‚ä½†æ˜¯ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯äº›æ•°å€¼ï¼Œå®ƒä»¬æ²¡æœ‰æä¾›éå¸¸æœ‰ç”¨çš„ä¿¡æ¯ç»™åˆ°æ™®é€šçš„ç”¨æˆ·ã€‚å¿…é¡»æœ‰ä»€ä¹ˆæ ·çš„æ–¹æ³•æ¥æ‰¾åˆ°ä¸ç”¨æˆ·ä¸ç»„ ID æ•°ç»„ç›¸å…³çš„ç”¨æˆ·ä¿¡æ¯ã€‚
è¿™ä¸€@value{SECTION}å°±æ˜¯æä¾›ä¸€ç»„å‡½æ•°æ¥ä»ç”¨æˆ·æ•°æ®åº“ä¸­è¿”å›ä¿¡æ¯ã€‚æŸ¥çœ‹ @ref{Group Functions}ï¼Œå¯äº†è§£ä»ç»„æ•°æ®åº“ä¸­è¿”å›ä¿¡æ¯çš„ä¸€ç»„å‡½æ•°ã€‚

@cindex @code{getpwent()} function (C library)
@cindex @code{getpwent()} user-defined function
@cindex users, information about, retrieving
@cindex login information
@cindex account information
@cindex password file
@cindex files, password
POSIX æ ‡å‡†æ²¡æœ‰å®šä¹‰ç”¨æˆ·çš„ä¿¡æ¯å­˜åœ¨å“ªã€‚ç›¸åï¼Œå®ƒæä¾›äº† @code{<pwd.h>} å¤´æ–‡ä»¶ä»¥åŠå‡ ä¸ª C è¯­è¨€ä¾‹ç¨‹æ¥è·å–ç”¨æˆ·çš„ä¿¡æ¯ã€‚ä¸»è¦çš„å‡½æ•°æœ‰ @code{getpwent()}ï¼Œç”¨æ¥â€œget password entryâ€ï¼ˆè·å–å¯†ç é¡¹ï¼‰ã€‚å¯†ç æ¥è‡ªäºæœ€åˆçš„ç”¨æˆ·æ•°æ®åº“æ–‡ä»¶ï¼Œ@file{/etc/passwd}ï¼Œåœ¨é‡Œé¢å­˜å‚¨äº†ç”¨æˆ·ä¿¡æ¯ä»¥åŠåŠ å¯†è¿‡çš„å¯†ç ï¼ˆä¸åå­—æœ‰ç›¸å…³ï¼‰ã€‚

@cindex @command{pwcat} program
å°½ç®¡ @command{awk} ç¨‹åºå¯ä»¥ç®€å•ç›´æ¥åœ°è¯»å– @file{/etc/passwd} æ–‡ä»¶ï¼Œä½†æ˜¯æ–‡ä»¶å¹¶æ²¡æœ‰åŒ…å«ç³»ç»Ÿä¸­ç”¨æˆ·é›†çš„å®Œæ•´ä¿¡æ¯ã€‚
@footnote{ç”¨æˆ·çš„å¯†ç ä¿¡æ¯å¾ˆå¤šæƒ…å†µä¸‹éƒ½å­˜å‚¨åœ¨ç½‘ç»œæ•°æ®åº“ä¸­ã€‚}
ä¸ºäº†ç¡®ä¿ä½ èƒ½å¤Ÿäº§ç”Ÿå¯è¯»çš„ä»¥åŠå®Œæ•´çš„ç”¨æˆ·æ•°æ®ç‰ˆæœ¬ï¼Œæœ‰å¿…è¦è°ƒç”¨ @code{getpwent()} æ¥å†™ä¸€ä¸ªå°çš„ C ç¨‹åºã€‚@code{getpwent()} å®šä¹‰ä¸ºè¿”å› @code{struct passwd} çš„æŒ‡é’ˆã€‚æ¯æ¬¡è°ƒç”¨ï¼Œå®ƒéƒ½è¿”å›ä¸‹ä¸€ä¸ªé¡¹ã€‚å½“æ²¡æœ‰æ›´å¤šçš„é¡¹æ—¶ï¼Œåˆ™è¿”å› @code{NULL}ï¼Œå³ç©ºæŒ‡é’ˆã€‚
å½“å‡ºç°è¿™ä¸ªç»“æœåï¼ŒC ç¨‹åºåˆ™è¦è°ƒç”¨ @code{endpwent()} æ¥å…³é—­æ•°æ®åº“ã€‚ä¸‹é¢æ˜¯ @command{pwcat}ï¼Œä¸€ä¸ª C ç¨‹åºç”¨æ¥â€œè¿æ¥â€å¯†ç æ•°æ®åº“ï¼š

@example
@c file eg/lib/pwcat.c
/*
 * pwcat.c
 *
 * Generate a printable version of the password database.
 */
@c endfile
@ignore
@c file eg/lib/pwcat.c
/*
 * Arnold Robbins, arnold@@skeeve.com, May 1993
 * Public Domain
 * December 2010, move to ANSI C definition for main().
 */

#if HAVE_CONFIG_H
#include <config.h>
#endif

@c endfile
@end ignore
@c file eg/lib/pwcat.c
#include <stdio.h>
#include <pwd.h>

@c endfile
@ignore
@c file eg/lib/pwcat.c
#if defined (STDC_HEADERS)
#include <stdlib.h>
#endif

@c endfile
@end ignore
@c file eg/lib/pwcat.c
int
main(int argc, char **argv)
@{
    struct passwd *p;

    while ((p = getpwent()) != NULL)
@c endfile
@ignore
@c file eg/lib/pwcat.c
#ifdef HAVE_STRUCT_PASSWD_PW_PASSWD
@c endfile
@end ignore
@c file eg/lib/pwcat.c
        printf("%s:%s:%ld:%ld:%s:%s:%s\n",
            p->pw_name, p->pw_passwd, (long) p->pw_uid,
            (long) p->pw_gid, p->pw_gecos, p->pw_dir, p->pw_shell);
@c endfile
@ignore
@c file eg/lib/pwcat.c
#else
        printf("%s:*:%ld:%ld:%s:%s\n",
            p->pw_name, (long) p->pw_uid,
            (long) p->pw_gid, p->pw_dir, p->pw_shell);
#endif
@c endfile
@end ignore
@c file eg/lib/pwcat.c

    endpwent();
    return 0;
@}
@c endfile
@end example

å¦‚æœä½ ä¸ç†è§£ C ä»£ç ï¼Œä¹Ÿæ²¡æœ‰å…³ç³»ã€‚@command{pwcat} çš„è¾“å‡ºå°±æ˜¯ä»¥ä¼ ç»Ÿçš„ @file{/etc/passwd} çš„å†’å·åˆ†éš”åŸŸçš„æ ¼å¼è¾“å‡ºç”¨æˆ·æ•°æ®åº“ã€‚è¿™äº›åŸŸæ˜¯ï¼š

@table @asis
@item Login name
ç”¨æˆ·çš„ç™»å½•åã€‚

@item Encrypted password
ç”¨æˆ·åŠ å¯†è¿‡çš„å¯†ç ã€‚è¿™åœ¨æŸäº›ç³»ç»Ÿä¸Šå¯èƒ½å¾—ä¸åˆ°ã€‚

@item User-ID
ç”¨æˆ·çš„æ•°å€¼ IDã€‚ï¼ˆåœ¨ä¸€äº›ç³»ç»Ÿä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ª C çš„ @code{long} ç±»å‹ï¼Œè€Œä¸æ˜¯ @code{int} å‹ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹éƒ½è½¬æ¢ä¸º @code{long}ã€‚ï¼‰

@item Group-ID
ç”¨æˆ·çš„ç»„æ•°å€¼ IDã€‚ï¼ˆå†…å®¹ä¸åˆšæ‰æ‰€è¿°çš„ @code{long} ä¸ @code{int} ç±»å‹çš„è§£é‡Šç±»ä¼¼ã€‚ï¼‰

@item Full name
ç”¨æˆ·çš„å…¨åï¼Œä»¥åŠä¸è¿™ä¸ªç”¨æˆ·ç›¸å…³çš„å…¶ä»–ä¿¡æ¯ã€‚

@item Home directory
ç”¨æˆ·çš„ç™»å½•ç›®å½•ï¼ˆæˆ–è€…â€œhomeâ€ï¼‰ï¼ˆShell ç¨‹åºå‘˜ç†Ÿæ‚‰çš„ @code{$HOME}ï¼‰ã€‚

@item Login shell
å½“ç”¨æˆ·ç™»å½•æ—¶æ‰€è¦è¿è¡Œçš„ç¨‹åºã€‚ä¸€èˆ¬æ¥è¯´æ˜¯ä¸€ä¸ª Shell ç¨‹åºï¼Œå¦‚ Bashã€‚
@end table

@command{pwcat} çš„è¾“å‡ºçš„å‡ è¡Œå†…å®¹ä¾‹å­å¦‚ä¸‹ï¼š

@cindex Jacobs, Andrew
@cindex Robbins, Arnold
@cindex Robbins, Miriam
@example
$ @kbd{pwcat}
@print{} root:x:0:1:Operator:/:/bin/sh
@print{} nobody:*:65534:65534::/:
@print{} daemon:*:1:1::/:
@print{} sys:*:2:2::/:/bin/csh
@print{} bin:*:3:3::/bin:
@print{} arnold:xyzzy:2076:10:Arnold Robbins:/home/arnold:/bin/sh
@print{} miriam:yxaay:112:10:Miriam Robbins:/home/miriam:/bin/sh
@print{} andy:abcca2:113:10:Andy Jacobs:/home/andy:/bin/sh
@dots{}
@end example

æ ¹æ®ä¹‹å‰çš„ä¸€äº›è¯´æ˜ï¼Œä¸‹é¢æ˜¯ä¸€ç»„å‡½æ•°ç”¨æ¥å–å¾—ç”¨æˆ·çš„ä¿¡æ¯çš„å‡½æ•°ã€‚è¿™é‡Œæœ‰å‡ ä¸ªå‡½æ•°ä¸ C ä¸­åŒåçš„å‡½æ•°å¯¹åº”ï¼š

@cindex @code{_pw_init()} user-defined function
@example
@c file eg/lib/passwdawk.in
# passwd.awk --- access password file information
@c endfile
@ignore
@c file eg/lib/passwdawk.in
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
# Revised October 2000
# Revised December 2010
@c endfile
@end ignore
@c file eg/lib/passwdawk.in

BEGIN @{
    # tailor this to suit your system
    _pw_awklib = "/usr/local/libexec/awk/"
@}

function _pw_init(    oldfs, oldrs, olddol0, pwcat, using_fw, using_fpat)
@{
    if (_pw_inited)
        return

    oldfs = FS
    oldrs = RS
    olddol0 = $0
    using_fw = (PROCINFO["FS"] == "FIELDWIDTHS")
    using_fpat = (PROCINFO["FS"] == "FPAT")
    FS = ":"
    RS = "\n"

    pwcat = _pw_awklib "pwcat"
    while ((pwcat | getline) > 0) @{
        _pw_byname[$1] = $0
        _pw_byuid[$3] = $0
        _pw_bycount[++_pw_total] = $0
    @}
    close(pwcat)
    _pw_count = 0
    _pw_inited = 1
    FS = oldfs
    if (using_fw)
        FIELDWIDTHS = FIELDWIDTHS
    else if (using_fpat)
        FPAT = FPAT
    RS = oldrs
    $0 = olddol0
@}
@c endfile
@end example

@cindex @code{BEGIN} pattern, @code{pwcat} program
@code{BEGIN} è§„åˆ™å°†ç§æœ‰å˜é‡è®¾ç½®ä¸º @command{pwcat} æ‰€åœ¨çš„ç›®å½•ã€‚å› ä¸ºå®ƒç”¨äºè¾…åŠ© @command{awk} çš„åº“ä¾‹ç¨‹ã€‚æˆ‘ä»¬å·²ç»å°†å…¶æ”¾åœ¨ @file{/usr/local/libexec/awk} ä¸­ï¼Œä½†æ˜¯ï¼Œä½ å¯èƒ½æƒ³æ”¾åˆ°ä½ çš„ç³»ç»Ÿä¸­çš„å¦å¤–ä¸€ä¸ªä½ç½®ã€‚

å‡½æ•° @code{_pw_init()} ä¼šå°†ç”¨æˆ·ä¿¡æ¯çš„ä¸‰ä¸ªå¤æœ¬å¡«å…¥åˆ°ä¸‰ä¸ªç›¸å…³çš„æ•°ç»„ã€‚æ•°ç»„ç”±ç”¨æˆ·åè¿›è¡Œï¼ˆ@code{_pw_byname})ï¼Œç”¨æˆ· IDï¼ˆ@code{_pw_byuid})ï¼Œä»¥åŠå‡ºç°çš„é¡ºåºï¼ˆ@code{_pw_bycount}ï¼‰è¿›è¡Œç´¢å¼•ã€‚å˜é‡ @code{_pw_inited} ä¸ºäº†é«˜æ•ˆè€Œè®¾ç½®ï¼Œå› æ­¤ @code{_pw_init()} åªéœ€è¦è°ƒç”¨ä¸€æ¬¡ã€‚

@cindex @code{PROCINFO} array, testing the field splitting
@cindex @code{getline} command, @code{_pw_init()} function
ç”±äºå‡½æ•°ä½¿ç”¨ @code{getline} æ¥ä» @command{pwcat} ä¸­è¯»å–ä¿¡æ¯ï¼Œå®ƒé¦–å…ˆå°† @code{FS}ï¼Œ@code{RS} ä¸ @code{$0} çš„å€¼å­˜èµ·æ¥ã€‚ä½¿ç”¨ @code{using_fw} å˜é‡æ¥è¡¨ç¤ºåŸŸæ˜¯å¦æ˜¯ç”¨ @code{FIELDWIDTHS} æ¥è¿›è¡Œåˆ†å‰²ã€‚è¿™ä¹ˆåšæ˜¯æœ‰å¿…è¦çš„ï¼Œå› ä¸ºè¿™äº›å‡½æ•°ä¹Ÿå¯ä»ç”¨æˆ·ç¨‹åºçš„ä»»ä½•åœ°æ–¹è¿›è¡Œè°ƒç”¨ï¼Œå¹¶ä¸”ç”¨æˆ·æœ‰å®ƒè‡ªå·±çš„è®°å½•åŸŸçš„åˆ†å‰²æ–¹å¼ã€‚è¿™æ ·ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼ä½¿æˆ‘ä»¬å¯ä»¥æ¢å¤æ­£ç¡®çš„åˆ†å‰²æœºåˆ¶ã€‚æµ‹è¯•åªé’ˆå¯¹ @command{gawk}ã€‚åœ¨æŸæ­¤ @command{awk} å®ç°ä¸­ï¼Œå¦‚æœä½¿ç”¨ @code{FS} æˆ–è€… @code{FPAT}ï¼Œåˆ™è¿™ä¸ªå€¼ä¸º falseã€‚

æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ @code{FPAT} çš„ä»£ç åˆ©ç”¨ @code{using_fpat} å˜é‡ä¸ @code{PROCINFO["FS"]} ä¹Ÿæ˜¯ç±»ä¼¼çš„æƒ…å†µã€‚

å‡½æ•°çš„ä¸»ä½“éƒ¨åˆ†ä½¿ç”¨å¾ªç¯æ¥è¯»å–æ•°æ®åº“è¡Œï¼Œå¹¶å°†å®ƒä»¬åˆ†å‰²ä¸ºä¸åŒçš„åŸŸï¼Œç„¶åå°†è¡Œå­˜å‚¨åˆ°æ•°ç»„ä¸­ä»¥å¤‡ä½¿ç”¨ã€‚å½“å¾ªç¯ç»“æŸæ—¶ï¼Œ@code{@w{_pw_init()}} é€šè¿‡å…³é—­ç®¡çº¿æ¸…ç†ï¼Œå¹¶å°† @code{@w{_pw_inited}} è®¾ç½®ä¸º 1ï¼Œç„¶åæ¢å¤ @code{FS} çš„å€¼ï¼ˆå¦‚æœå¿…è¦çš„æƒ…å†µä¸‹ä¹Ÿæ¢å¤ @code{FIELDWIDTHS} ä¸ @code{FPAT}ï¼‰ï¼Œ@code{RS} çš„å€¼ä¸ @code{$0} çš„å€¼ã€‚@code{@w{_pw_count}} çš„ä½¿ç”¨åé¢å†è§£é‡Šã€‚

@cindex @code{getpwnam()} function (C library)
@code{getpwnam()} å‡½æ•°å–ç”¨æˆ·åçš„å­—ä¸²ä¸ºå‚æ•°ã€‚å¦‚æœç”¨æˆ·åœ¨æ•°æ®åº“ä¸­ï¼Œåˆ™å…¶è¿”å›ç›¸åº”çš„è¡Œã€‚å¦åˆ™ï¼Œé€šè¿‡æŒ‡å‘ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´ çš„å¼•ç”¨ä¼šåˆ›å»ºä¸€ä¸ªå€¼ä¸ºç©ºä¸²çš„å…ƒç´ ã€‚

@cindex @code{getpwnam()} user-defined function
@example
@group
@c file eg/lib/passwdawk.in
function getpwnam(name)
@{
    _pw_init()
    return _pw_byname[name]
@}
@c endfile
@end group
@end example

@cindex @code{getpwuid()} function (C library)
ç±»ä¼¼åœ°ï¼Œ@code{getpwuid()} å‡½æ•°ä½¿ç”¨ç”¨æˆ·çš„ ID å€¼ä½œä¸ºå‚æ•°ã€‚å¦‚æœç”¨æˆ·æ•°ç»„åœ¨æ•°æ®åº“ä¸­ï¼Œåˆ™è¿”å›ç›¸åº”çš„è¡Œï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºä¸²ï¼š

@cindex @code{getpwuid()} user-defined function
@example
@c file eg/lib/passwdawk.in
function getpwuid(uid)
@{
    _pw_init()
    return _pw_byuid[uid]
@}
@c endfile
@end example

@cindex @code{getpwent()} function (C library)
@code{getpwent()} å‡½æ•°ç®€å•åœ°éå†æ•°æ®åº“ï¼Œä¸€æ¬¡ä¸€é¡¹ã€‚å®ƒä½¿ç”¨ @code{_pw_count} æ¥è·Ÿè¸ª @code{_pw_bycount} æ•°ç»„ä¸­çš„ä½ç½®ï¼š

@cindex @code{getpwent()} user-defined function
@example
@c file eg/lib/passwdawk.in
function getpwent()
@{
    _pw_init()
    if (_pw_count < _pw_total)
        return _pw_bycount[++_pw_count]
    return ""
@}
@c endfile
@end example

@cindex @code{endpwent()} function (C library)
@code{@w{endpwent()}} å‡½æ•°é‡æ–°å°† @code{@w{_pw_count}} è®¾ç½®ä¸º 0ï¼Œæ‰€ä»¥åç»­å¯¹äº @code{getpwent()} çš„è°ƒç”¨ä¼šé‡å¤´å¼€å§‹ï¼š

@cindex @code{endpwent()} user-defined function
@example
@c file eg/lib/passwdawk.in
function endpwent()
@{
    _pw_count = 0
@}
@c endfile
@end example

åœ¨è¿™ä¸€ç»„ä¾‹ç¨‹çš„ä¸€è‡´è®¾è®¡å†³ç­–æ˜¯æ¯ä¸€ä¸ªä¾‹ç¨‹éƒ½è°ƒç”¨ @code{@w{_pw_init()}} æ¥åˆå§‹åŒ–æ•°ç»„åº“æ•°ç»„ã€‚è¿è¡Œå¦ä¸€ä¸ªè¿›ç¨‹æ¥äº§ç”Ÿç”¨æˆ·æ•°ç»„åº“ï¼Œä»¥åŠæ‰«ææ•°æ®åº“çš„è´Ÿæ‹…ä»…åœ¨ç”¨æˆ·çš„ä¸»ç¨‹åºç¨‹åºè°ƒç”¨å…¶ä¸­çš„æŸä¸ªå‡½æ•°æ‰ä¼šäº§ç”Ÿã€‚å¦‚æœè¿™ä¸ªåº“æ–‡ä»¶ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·è£…è½½ï¼Œä½†æ˜¯åˆæ²¡æœ‰è°ƒç”¨å…¶ä¸­çš„ä»»ä½•ä¾‹ç¨‹ï¼Œåˆ™ä¸ä¼šæœ‰ä»»ä½•çš„è¿è¡Œæ—¶è´Ÿæ‹…ã€‚ï¼ˆå¦ä¸€ä¸ªé€‰æ‹©æ˜¯å°† @code{@w{_pw_init()}} çš„æ‰§è¡Œä½“ç§»åˆ° @code{BEGIN} è§„åˆ™ä¸­ï¼Œåœ¨è¿™é‡Œéƒ¨ä¼šæ‰§è¡Œ pwcatã€‚è¿™ç®€åŒ–äº†ä»£ç ï¼Œä½†æ˜¯ä¼šè¿è¡Œä¸€äº›ä»æ¥ä¸ä¼šéœ€è¦çš„é¢å¤–è¿‡ç¨‹ã€‚ï¼‰

å†è€…ï¼Œè°ƒç”¨ @code{_pw_init()} ä»£ä»·ä¹Ÿä¸é«˜ï¼Œå› ä¸º @code{_pw_inited} å˜é‡ä¼šä½¿ç¨‹åºä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®æ¬¡æ•°ä¸ä¼šå‡ºäºä¸€æ¬¡ã€‚å¦‚æœä½ æ‹…å¿ƒè¿™æ ·çš„æµ‹è¯•ä¼šéå†åœ¨ä½ çš„ç¨‹åºä¸­ï¼Œä½ ä¹Ÿå¯ä»¥å°†æ£€æŸ¥ @code{_pw_inited} çš„ä»£ç è¡¨ä» @code{_pw_init()} ç§»å‡ºå»ï¼Œå¹¶å¤åˆ¶åˆ°æ‰€æœ‰çš„å…¶ä»–å‡½æ•°ä¸­ã€‚åœ¨å®è·µä¸­ï¼Œè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œå› ä¸ºå¤§å¤šæ•°çš„ @command{awk} ç¨‹åºéƒ½æ˜¯ I/O å‹çš„ï¼Œè¿™æ ·æ”¹å˜ä¼šå¼„ä¹±ä»£ç ã€‚

åœ¨ @ref{Id Program}ï¼Œä¸­çš„ @command{id} ç¨‹åºä¼šä½¿ç”¨åˆ°è¿™äº›å‡½æ•°ã€‚

@node Group Functions
@section è¯»å–ç»„æ•°æ®åº“

@cindex libraries of @command{awk} functions, group database, reading
@cindex functions, library, group database@comma{} reading
@cindex group database, reading
@cindex database, group, reading
@cindex @code{PROCINFO} array, and group membership
@cindex @code{getgrent()} function (C library)
@cindex @code{getgrent()} user-defined function
@cindex groups@comma{} information about
@cindex account information
@cindex group file
@cindex files, group
åœ¨ @ref{Passwd Functions}ï¼Œä¸­è®¨è®ºçš„å¾ˆå¤šé—®é¢˜ä¹Ÿéƒ½å¯ä»¥ç”¨äºç»„æ•°æ®åº“ä¸­ã€‚å°½ç®¡ä¼ ç»Ÿä¸Šä»¥å¤§å®¶éƒ½äº†è§£çš„æ ¼å¼ä¸æ–‡ä»¶ï¼ˆ@file{/etc/group}ï¼‰å­˜å‚¨ï¼Œä½†æ˜¯ POSIX æ ‡å‡†åªæä¾›äº†ä¸€ç»„ C åº“å‡½æ•°ï¼ˆ@code{<grp.h>} ä¸ @code{getgrent()}ï¼‰æ¥è®¿é—®ä¿¡æ¯ã€‚å°±ç®—å­˜åœ¨è¿™äº›æ–‡ä»¶ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½æ²¡æœ‰å®Œæ•´çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œä¸ç”¨æˆ·æ•°æ®åº“ä¸€æ ·ï¼Œä¹Ÿæœ‰å¿…è¦æ¥å†™ä¸€ä¸ªå°çš„ C ç¨‹åºæ¥äº§ç”Ÿç»„ä¿¡æ¯ã€‚
@command{grcat} åˆ™æ˜¯ä¸€ä¸ªè¿™æ ·çš„ C ç¨‹åºç”¨æ¥â€œcatâ€ç»„æ•°æ®åº“ï¼Œå¦‚ä¸‹ï¼š

@cindex @command{grcat} program
@example
@c file eg/lib/grcat.c
/*
 * grcat.c
 *
 * Generate a printable version of the group database.
 */
@c endfile
@ignore
@c file eg/lib/grcat.c
/*
 * Arnold Robbins, arnold@@skeeve.com, May 1993
 * Public Domain
 * December 2010, move to ANSI C definition for main().
 */

/* For OS/2, do nothing. */
#if HAVE_CONFIG_H
#include <config.h>
#endif

#if defined (STDC_HEADERS)
#include <stdlib.h>
#endif

#ifndef HAVE_GETGRENT
int main() { return 0; }
#else
@c endfile
@end ignore
@c file eg/lib/grcat.c
#include <stdio.h>
#include <grp.h>

int
main(int argc, char **argv)
@{
    struct group *g;
    int i;

    while ((g = getgrent()) != NULL) @{
@c endfile
@ignore
@c file eg/lib/grcat.c
#ifdef HAVE_STRUCT_GROUP_GR_PASSWD
@c endfile
@end ignore
@c file eg/lib/grcat.c
        printf("%s:%s:%ld:", g->gr_name, g->gr_passwd,
                                     (long) g->gr_gid);
@c endfile
@ignore
@c file eg/lib/grcat.c
#else
        printf("%s:*:%ld:", g->gr_name, (long) g->gr_gid);
#endif
@c endfile
@end ignore
@c file eg/lib/grcat.c
        for (i = 0; g->gr_mem[i] != NULL; i++) @{
            printf("%s", g->gr_mem[i]);
@group
            if (g->gr_mem[i+1] != NULL)
                putchar(',');
        @}
@end group
        putchar('\n');
    @}
    endgrent();
    return 0;
@}
@c endfile
@ignore
@c file eg/lib/grcat.c
#endif /* HAVE_GETGRENT */
@c endfile
@end ignore
@end example

åœ¨ç»„æ•°æ®åº“ä¸­çš„ä¸€è¡Œä»£è¡¨ä¸€ä¸ªç»„ã€‚åŸŸåˆ™é€šè¿‡å†’å·æ¥åˆ†éš”ï¼Œè¡¨ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š

@table @asis
@item Group Name
ç»„åã€‚

@item Group Password
ç»„çš„åŠ å¯†å¯†ç ã€‚åœ¨å®è·µä¸­ï¼Œè¿™ä¸ªåŸŸä¸ä¼šä½¿ç”¨åˆ°ï¼Œé€šè¿‡ä¸ºç©ºæˆ–è€…è®¾ç½®ä¸º @samp{*}ã€‚

@item Group ID Number
ç»„çš„æ•°å€¼ IDï¼Œå°†åå­—ä¸æ•°å€¼å…³è”åœ¨æ–‡ä»¶ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ï¼ˆåœ¨ä¸€äº›ç³»ç»Ÿä¸Šï¼Œå®ƒæ˜¯ C çš„ @code{long} ç±»å‹ï¼Œè€Œä¸æ˜¯ @code{int} ç±»å‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éƒ½å°†å…¶è½¬æ¢ä¸º @code{long}ã€‚ï¼‰
The group's numeric group ID number;

@item Group Member List
ä¸€ä¸ªé€—å·åˆ†éš”çš„ç”¨æˆ·åˆ—è¡¨ã€‚è¿™äº›ç”¨æˆ·æ˜¯ç»„çš„æˆå‘˜ã€‚ç°ä»£çš„ Unix ç³»ç»Ÿå…è®¸ç”¨æˆ·åŒæ—¶æ˜¯å¤šä¸ªç»„çš„æˆå‘˜ã€‚å¦‚æœä½ çš„ç³»ç»Ÿå¯ä»¥æ”¯æŒï¼Œåˆ™åœ¨ @code{PROCINFO} ä¸­ä¼šä¸ºè¿™äº›ç»„ ID å­˜å‚¨å…ƒç´  @code{"group1"} åˆ° @code{"group@var{N}"}ã€‚ï¼ˆæ³¨æ„ï¼Œ@code{PROCINFO} æ˜¯ä¸€ä¸ª @command{gawk} æ‰©å±•ï¼ŒæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰
@end table

è¿è¡Œ @command{grcat} æ—¶äº§ç”Ÿçš„è¾“å‡ºå¯èƒ½å¦‚ä¸‹ï¼š

@example
$ @kbd{grcat}
@print{} wheel:*:0:arnold
@print{} nogroup:*:65534:
@print{} daemon:*:1:
@print{} kmem:*:2:
@print{} staff:*:10:arnold,miriam,andy
@print{} other:*:20:
@dots{}
@end example

è¿™äº›å‡½æ•°ç”¨æ¥ä»ç»„æ•°æ®åº“ä¸­è·å–ä¿¡æ¯ã€‚æœ‰å‡ ä¸ªï¼ŒæŒ‰ç…§ C åº“å‡½æ•°çš„æ–¹å¼æ¥å‘½åï¼š

@cindex @code{getline} command, @code{_gr_init()} user-defined function
@cindex @code{_gr_init()} user-defined function
@example
@c file eg/lib/groupawk.in
# group.awk --- functions for dealing with the group file
@c endfile
@ignore
@c file eg/lib/groupawk.in
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
# Revised October 2000
# Revised December 2010
@c endfile
@end ignore
@c line break on _gr_init for smallbook
@c file eg/lib/groupawk.in

BEGIN @{
    # Change to suit your system
    _gr_awklib = "/usr/local/libexec/awk/"
@}

function _gr_init(    oldfs, oldrs, olddol0, grcat,
                             using_fw, using_fpat, n, a, i)
@{
    if (_gr_inited)
        return

    oldfs = FS
    oldrs = RS
    olddol0 = $0
    using_fw = (PROCINFO["FS"] == "FIELDWIDTHS")
    using_fpat = (PROCINFO["FS"] == "FPAT")
    FS = ":"
    RS = "\n"

    grcat = _gr_awklib "grcat"
    while ((grcat | getline) > 0) @{
        if ($1 in _gr_byname)
            _gr_byname[$1] = _gr_byname[$1] "," $4
        else
            _gr_byname[$1] = $0
        if ($3 in _gr_bygid)
            _gr_bygid[$3] = _gr_bygid[$3] "," $4
        else
            _gr_bygid[$3] = $0

        n = split($4, a, "[ \t]*,[ \t]*")
        for (i = 1; i <= n; i++)
            if (a[i] in _gr_groupsbyuser)
                _gr_groupsbyuser[a[i]] = gr_groupsbyuser[a[i]] " " $1
            else
                _gr_groupsbyuser[a[i]] = $1

        _gr_bycount[++_gr_count] = $0
    @}
    close(grcat)
    _gr_count = 0
    _gr_inited++
    FS = oldfs
    if (using_fw)
        FIELDWIDTHS = FIELDWIDTHS
    else if (using_fpat)
        FPAT = FPAT
    RS = oldrs
    $0 = olddol0
@}
@c endfile
@end example

@code{BEGIN} è§„åˆ™å°†å­˜å‚¨ @command{grcat} æ‰€æœ‰çš„ç›®å½•å­˜å‚¨åœ¨ç§æœ‰å˜é‡ä¸­ã€‚å› æ­¤è¿™ç”¨äºæŒ‡å‡º @command{awk} åº“å‡½æ•°çš„ä½ç½®ã€‚æˆ‘ä»¬å°†å…¶æ”¾åœ¨ @file{/usr/local/libexec/awk} ä¸­ã€‚å¯èƒ½ä½ ä¼šé€‰æ‹©å­˜åœ¨å¦ä¸€ä¸ªåœ°æ–¹ã€‚

è¿™äº›ä¾‹ç¨‹éµå¾ªä¸ç”¨æˆ·æ•°æ®åº“ä¾‹ç¨‹ä¸€æ ·çš„æ¡†æ¶ï¼ˆæŸ¥çœ‹ @pxref{Passwd Functions}ï¼‰ã€‚@code{@w{_gr_inited}} å˜é‡ç”¨äºä¿è¯æ•°æ®åº“åªè¢«æ‰«æä¸€æ¬¡ã€‚@code{@w{_gr_init()}} å‡½æ•°é¦–å…ˆå­˜å‚¨ @code{FS}ï¼Œ@code{RS} ä»¥åŠ @code{$0} å€¼ï¼Œç„¶åå°† @code{FS} ä¸ @code{RS} çš„å€¼è®¾ç½®æˆæ­£åˆ™æ‰«æç»„ä¿¡æ¯çš„æ ¼å¼ã€‚åŒæ—¶ä¹Ÿä¼šæ³¨æ„æ˜¯å¦æ˜¯ç”¨ @code{FIELDWIDTHS} æˆ–è€… @code{FPAT}ï¼Œåé¢ä»¥ç”¨æ¥æ¢å¤æ°å½“çš„åŸŸåˆ†å‰²æœºåˆ¶ã€‚

ç»„ä¿¡æ¯å­˜å‚¨åœ¨å‡ ä¸ªå…³è”çš„æ•°ç»„ä¸­ã€‚æ•°ç»„ç”±ç»„åï¼ˆ@code{@w{_gr_byname}})ï¼Œç»„IDï¼ˆ@code{@w{_gr_bygid}}ï¼‰ï¼Œä»¥åŠåœ¨æ•°æ®åº“ä¸­çš„ä½ç½®ï¼ˆ@code{@w{_gr_bycount}}ï¼‰æ¥ç´¢å¼•ã€‚è¿˜æœ‰ä¸€ä¸ªæ•°ç»„ç”±ç”¨æˆ·åæ¥ç´¢å¼•ï¼ˆ@code{@w{_gr_groupsbyuser}}ï¼‰ï¼Œè¿™æ˜¯æ¯ä¸ªç”¨æˆ·æ‰€å±çš„ç»„ï¼Œæ¯ä¸€ä¸ªç”¨ç©ºæ ¼åˆ†å‰²ã€‚

ä¸ç”¨æˆ·æ•°æ®åº“ä¸åŒï¼Œå®ƒæœ‰å¯èƒ½åœ¨ä¸€ä¸ªæ•°æ®åº“æœ‰å¤šä¸ªè®°å½•æœ‰ç›¸åŒçš„ç»„åã€‚å½“è¿™ä¸ªç»„æœ‰å¾ˆå¤šçš„æˆå‘˜çš„æ—¶å€™è¿™å¾ˆæ­£å¸¸ã€‚ä¸¤ä¸ªè¿™æ ·çš„é¡¹çœ‹èµ·æ¥åƒï¼š

@example
tvpeople:*:101:johnny,jay,arsenio
tvpeople:*:101:david,conan,tom,joan
@end example

å› ä¸ºè¿™ä¸ªï¼Œ@code{_gr_init()} è¦æŸ¥çœ‹æ˜¯å¦æœ‰ç›¸åŒçš„ç»„åä¸ç»„ ID å€¼ã€‚å¦‚æœæœ‰ï¼Œç”¨æˆ·ååªæ˜¯ç®€å•åœ°è¿æ¥åˆ°å‰é¢çš„ç”¨æˆ·åˆ—è¡¨ä¸­ã€‚ 
@footnote{åˆšæ‰å±•ç¤ºçš„ä»£ç æœ‰ä¸€ä¸ªå¾ˆç»†å¾®çš„é—®é¢˜ã€‚å‡è®¾ç¬¬ä¸€æ¬¡æ—¶æ˜¯æ²¡æœ‰åå­—çš„ï¼Œåˆ™è¿™ä¸ªä»£ç ä¼šå°†åå­—å‰é¢å¸¦é€—å·åŠ å…¥ã€‚åŒæ—¶ä¹Ÿæ²¡æœ‰æ£€æµ‹æ˜¯å¦æœ‰ç¬¬ 4 ä¸ªåŸŸï¼Œ@code{$4}ã€‚}

æœ€åï¼Œ@code{_gr_init()} å…³é—­ @command{grcat} çš„ç®¡çº¿ï¼Œæ¢å¤ @code{FS} ï¼ˆå¦‚æœæœ‰å¿…è¦ä¹Ÿæ¢å¤ @code{FIELDWIDTHS} æˆ–è€… @code{FPAT}ï¼‰ï¼Œ@code{RS} ä¸ @code{$0} çš„å€¼ï¼Œå°† @code{_gr_count} çš„å€¼æ¢å¤ä¸º 0 ï¼ˆåé¢ä¼šä½¿ç”¨åˆ°ï¼‰ï¼Œå¹¶ä½¿ @code{_gr_inited} ä¸ºéé›¶ã€‚

@cindex @code{getgrnam()} function (C library)
@code{getgrnam()} å‡½æ•°å–ç»„åä¸ºå‚æ•°ï¼Œå¦‚æœå­˜åœ¨ç›¸åº”çš„ç»„ï¼Œåˆ™è¿”å›ã€‚å¦åˆ™å…¶æ‰€ä¾èµ–çš„æ•°ç»„ï¼Œä¼šä»¥ç©ºä¸²åˆ›å»ºä¸€ä¸ªå…ƒç´ ï¼š

@cindex @code{getgrnam()} user-defined function
@example
@c file eg/lib/groupawk.in
function getgrnam(group)
@{
    _gr_init()
    return _gr_byname[group]
@}
@c endfile
@end example

@cindex @code{getgrgid()} function (C library)
@code{getgrgid()} å‡½æ•°ç±»ä¼¼ï¼Œä»¥æ•°å€¼çš„ç»„ ID ä¸ºå‚æ•°ï¼Œæ¥æŸ¥æ‰¾ä¸è¿™ä¸ª ID ç›¸å…³çš„ç»„çš„ä¿¡æ¯ï¼š

@cindex @code{getgrgid()} user-defined function
@example
@c file eg/lib/groupawk.in
function getgrgid(gid)
@{
    _gr_init()
    return _gr_bygid[gid]
@}
@c endfile
@end example

@cindex @code{getgruser()} function (C library)
@code{getgruser()} å‡½æ•°æ²¡æœ‰ç›¸åº”çš„ C ä¾‹ç¨‹å¯¹åº”ã€‚å®ƒå–ç”¨æˆ·åä¸ºå‚æ•°ï¼Œå¹¶è¿”å›è¯¥ç»„ä¸­çš„æˆå‘˜ç”¨æˆ·çš„åˆ—è¡¨ï¼š

@cindex @code{getgruser()} function, user-defined
@example
@c file eg/lib/groupawk.in
function getgruser(user)
@{
    _gr_init()
    return _gr_groupsbyuser[user]
@}
@c endfile
@end example

@cindex @code{getgrent()} function (C library)
@code{getgrent()} å‡½æ•°è¿­ä»£æ•°æ®åº“ï¼Œä¸€æ¬¡ä¸€ä¸ªã€‚å®ƒä½¿ç”¨ @code{_gr_count} æ¥è·Ÿè¸ªåœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ï¼š

@cindex @code{getgrent()} user-defined function
@example
@c file eg/lib/groupawk.in
function getgrent()
@{
    _gr_init()
    if (++_gr_count in _gr_bycount)
        return _gr_bycount[_gr_count]
    return ""
@}
@c endfile
@end example

@cindex @code{endgrent()} function (C library)
@code{endgrent()} å‡½æ•°å°† @code{_gr_count} è®¾ç½®ä¸º 0ï¼Œå› æ­¤ @code{getgrent()} å¯ä»¥é‡å¤´å¼€å§‹ï¼š

@cindex @code{endgrent()} user-defined function
@example
@c file eg/lib/groupawk.in
function endgrent()
@{
    _gr_count = 0
@}
@c endfile
@end example

ä¸ç”¨æˆ·æ•°æ®åº“åˆ—è¡¨ç›¸ä¼¼ï¼Œæ¯ä¸€ä¸ªå‡½æ•°éƒ½è°ƒç”¨ @code{_gr_init()} æ¥åˆå§‹åŒ–æ•°ç»„ã€‚è¿™ä¹ˆåšï¼Œä½¿ç”¨ @command{grcat} æ—¶å¯¼è‡´ä¸€äº›é¢å¤–çš„è´Ÿæ‹…ï¼ˆç›¸å¯¹äºå°† @code{_gr_init()} çš„æ‰§è¡Œä½“ç§»åˆ° @code{BEGIN} è§„åˆ™ä¸­ï¼‰ã€‚

å¤§å¤šæ•°çš„å·¥ä½œéƒ½é›†ä¸­äºæ‰«ææ•°æ®åº“ï¼Œå¹¶ä¸”å»ºç«‹å¤šä¸ªå…³è”æ•°ç»„ã€‚ç”¨æˆ·è‡ªå·±æ‰€è°ƒç”¨çš„å‡½æ•°åˆ™ç›¸å½“ç®€å•ï¼Œè¿™ä¾èµ–äº @command{awk} çš„å…³è”æ•°ç»„æ‰€åšçš„å·¥ä½œã€‚

åœ¨ @ref{Id Program}ï¼Œä¸­çš„ @command{id} ç¨‹åºä¼šä½¿ç”¨åˆ°è¿™äº›å‡½æ•°ã€‚

@node Walking Arrays
@section éå†å¤šç»´æ•°ç»„

åœ¨ @ref{Arrays of Arrays}ï¼Œä¸­æè¿°äº† @command{gawk} å¦‚ä½•æ¥æä¾›å¤šç»´æ•°ç»„ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ•°ç»„çš„ä»»æ„å…ƒç´ å³å¯ä»¥æ˜¯æ ‡é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªæ•°ç»„ã€‚@code{isarray()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Type Functions}ï¼‰å¯ä»¥è®©ä½ å°†æ ‡é‡ä¸æ•°ç»„åŒºåˆ†ã€‚ä¸‹é¢çš„å‡½æ•°ï¼Œ@code{walk_array()} é€’å½’åœ°éå†æ•°ç»„ï¼Œæ‰“å°æ•°ç»„çš„ç´¢å¼•ä»¥åŠå€¼ã€‚ä½ å¯ä»¥é€šè¿‡æ•°ç»„ä¸ä»£è¡¨è¿™ä¸ªæ•°ç»„çš„å­—ä¸²åæ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š

@cindex @code{walk_array()} user-defined function
@example
@c file eg/lib/walkarray.awk
function walk_array(arr, name,      i)
@{
    for (i in arr) @{
        if (isarray(arr[i]))
            walk_array(arr[i], (name "[" i "]"))
        else
            printf("%s[%s] = %s\n", name, i, arr[i])
    @}
@}
@c endfile
@end example

@noindent
å‡½æ•°é€šè¿‡å¾ªç¯è¿­ä»£æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ æ¥å·¥ä½œã€‚å¦‚æœæ•°ç»„çš„å…ƒç´ æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™å‡½æ•°ä¼šé€’å½’åœ°è°ƒç”¨è‡ªå·±ï¼Œå°†å­æ•°ç»„ä¸è¡¨ç¤ºå½“å‰ç´¢å¼•çš„å­—ä¸²ä¼ é€’è¿‡å»ã€‚å¦åˆ™ï¼Œå‡½æ•°ç®€å•åœ°æ‰“å°å…ƒç´ çš„åå­—ï¼Œç´¢å¼•ä»¥åŠå®ƒçš„å€¼ã€‚è¿™é‡Œæ˜¯æ¼”ç¤ºçš„ä¸»ç¨‹åºï¼š

@example
BEGIN @{
    a[1] = 1
    a[2][1] = 21
    a[2][2] = 22
    a[3] = 3
    a[4][1][1] = 411
    a[4][2] = 42

    walk_array(a, "a")
@}
@end example

å½“æ‰§è¡Œæ—¶ï¼Œäº§ç”Ÿä¸‹é¢çš„è¾“å‡ºï¼š

@example
$ @kbd{gawk -f walk_array.awk}
@print{} a[1] = 1
@print{} a[2][1] = 21
@print{} a[2][2] = 22
@print{} a[3] = 3
@print{} a[4][1][1] = 411
@print{} a[4][2] = 42
@end example

å‡½æ•°ä»…æ˜¯ç®€å•åœ°æ‰“å°åå­—ä¸æ¯ä¸ªæ ‡é‡çš„æ•°ç»„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œä¹Ÿå¾ˆå®¹æ˜“æ¥è¿›è¡Œé€šç”¨åŒ–ï¼Œåªè¦ä¼ é€’ä¸€ä¸ªè¦éå†æ•°ç»„çš„å‡½æ•°åå°±å¯ä»¥åšåˆ°ã€‚ä¿®æ”¹è¿‡åçš„å‡½æ•°çœ‹èµ·æ¥å¦‚ä¸‹ï¼š

@example
@c file eg/lib/processarray.awk
function process_array(arr, name, process, do_arrays,   i, new_name)
@{
    for (i in arr) @{
        new_name = (name "[" i "]")
        if (isarray(arr[i])) @{
            if (do_arrays)
                @@process(new_name, arr[i])
            process_array(arr[i], new_name, process, do_arrays)
        @} else
            @@process(new_name, arr[i])
    @}
@}
@c endfile
@end example

å‚æ•°å¦‚ä¸‹ï¼š

@table @code
@item arr
ç›¸åº”çš„æ•°ç»„ã€‚

@item name
æ•°ç»„åï¼ˆå­—ä¸²ï¼‰ã€‚

@item process
è¦è°ƒç”¨çš„å‡½æ•°åã€‚

@item do_arrays
å¦‚æœä¸º trueï¼Œå‡½æ•°å¯ä»¥å¤„ç†ä¸ºå­æ•°ç»„çš„å…ƒç´ ã€‚
@end table

å¦‚æœå­æ•°ç»„è¦è¢«å¤„ç†ï¼Œåˆ™åœ¨è¿›ä¸€æ­¥è¿­ä»£æ—¶è¿›è¡Œå¤„ç†ã€‚

å½“å±•å¼€æ‰§è¡Œæ—¶ï¼Œå‡½æ•°äº§ç”Ÿä¸æ—©å‰çš„ @code{walk_array()} å‡½æ•°ä¸€æ ·çš„è¾“å‡ºç»“æœï¼š

@example
BEGIN @{
    a[1] = 1
    a[2][1] = 21
    a[2][2] = 22
    a[3] = 3
    a[4][1][1] = 411
    a[4][2] = 42

    process_array(a, "a", "do_print", 0)
@}

function do_print(name, element)
@{
    printf "%s = %s\n", name, element
@}
@end example

@node Library Functions Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
é˜…è¯»ç¨‹åºæ˜¯å­¦ä¹ ç¼–ç¨‹çš„æœ€å¥½æ–¹æ³•ã€‚åœ¨è¿™ç« ä»¥åŠä¸‹ä¸€@value{CHAPTER}ä¸­æä¾›çš„å‡½æ•°ä»¥åŠç¨‹åºå°±ç”¨äºè¿™æ ·çš„ç›®çš„ã€‚

@item
å½“å†™é€šç”¨ç›®çš„çš„åº“å‡½æ•°æ—¶ï¼Œè¦ç”¨ä¸€æ­¤äº›è§„åˆ™æ¥å‘½ä»¤ä»»æ„çš„å…¨å±€å˜é‡ï¼Œè¿™æ ·å®ƒä»–ä¸ä¼šä¸ç”¨æˆ·ç¨‹åºçš„å˜é‡å†²çªã€‚

@item
è¿™é‡Œå‘ˆç°çš„å‡½æ•°å¯ä»¥åˆ†ä¸ºä¸‹é¢çš„ç±»å‹ï¼š

@c nested list
@table @asis
@item ä¸€èˆ¬é—®é¢˜
æ•°ç»„åˆ°å­—ä¸²çš„è½¬æ¢ï¼Œæµ‹è¯•æ–­è¨€ï¼Œèˆå…¥èˆå‡ºï¼Œéšæœºæ•°äº§ç”Ÿï¼Œå°†å­—ç¬¦è½¬æ¢ä¸ºæ•°ç»„ï¼Œè¿æ¥å­—ä¸²ï¼Œæ–¹ä¾¿åœ°å–å¾—æ—¶é—´é—´ä¿¡æ¯ï¼Œä¸€æ¬¡è¯»å–æ‰€æœ‰æ–‡ä»¶ã€‚

@item ç®¡ç†@value{DF}
æç¤º@value{DF}çš„è¾¹ç•Œï¼Œé‡è¯»å½“å‰æ–‡ä»¶ï¼Œæ£€æŸ¥æ–‡ä»¶çš„å¯è¯»æ€§ï¼Œæ£€æŸ¥ 0 é•¿åº¦æ–‡ä»¶ï¼Œä»¥åŠå°†èµ‹å€¼å½“æˆ@value{FN}å¤„ç†ã€‚

@item å¤„ç†å‘½ä»¤è¡Œé€‰é¡¹
@command{awk} ç‰ˆæœ¬çš„æ ‡å‡† C å‡½æ•° @code{getopt()}ã€‚

@item è¯»å–ç”¨æˆ·ä¸ç»„æ•°æ®åº“
ä¸¤ä¸ªä¸ C ç‰ˆæœ¬çš„åº“å‡½æ•°ç›¸åŒçš„å‡½æ•°é›†ã€‚

@item éå†æ•°
ä¸¤ä¸ªå‡½æ•°ç”¨æ¥è¿›è¡Œä»»æ„æ·±åº¦çš„å¤šç»´æ•°ç»„çš„éå†ã€‚
@end table
@c end nested list

@end itemize

@c EXCLUDE START
@node Library Exercises
@section ç»ƒä¹ 

@enumerate
@item
åœ¨ @ref{Empty Files}ï¼Œä¸­æˆ‘ä»¬å‘ˆç°äº† @file{zerofile.awk} ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºåˆ©ç”¨ @command{gawk} çš„ @code{ARGIND} å˜é‡ã€‚è¿™ä¸ªé—®é¢˜æ˜¯å¦ä¸ä¾èµ– @code{ARGIND} å˜é‡å°±å¯ä»¥è§£å†³ï¼Ÿå¦‚æœå¯ä»¥ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ

@ignore
# zerofile2.awk --- same thing, portably

BEGIN @{
    ARGIND = Argind = 0
    for (i = 1; i < ARGC; i++)
        Fnames[ARGV[i]]++

@}
FNR == 1 @{
    while (ARGV[ARGIND] != FILENAME)
        ARGIND++
    Seen[FILENAME]++
    if (Seen[FILENAME] == Fnames[FILENAME])
        do
            ARGIND++
        while (ARGV[ARGIND] != FILENAME)
@}
ARGIND > Argind + 1 @{
    for (Argind++; Argind < ARGIND; Argind++)
        zerofile(ARGV[Argind], Argind)
@}
ARGIND != Argind @{
    Argind = ARGIND
@}
END @{
    if (ARGIND < ARGC - 1)
        ARGIND = ARGC - 1
    if (ARGIND > Argind)
        for (Argind++; Argind <= ARGIND; Argind++)
            zerofile(ARGV[Argind], Argind)
@}
@end ignore

@item
ä½œä¸ºç›¸å…³çš„æŒ‘æˆ˜ï¼Œä¿®æ”¹ä»£ç æ¥å¤„ç†è¿™æ ·çš„æƒ…å½¢ï¼Œåœ¨ @code{ARGV} ä¸­çš„æ’å…¥å€¼æ˜¯ä¸€ä¸ªå˜é‡èµ‹å€¼ã€‚

@ignore
@c June 13 2015: Antonio points out that this is answered in the text. Ooops.
@item
åœ¨ @ref{Walking Arrays}ï¼Œä¸­å‘ˆç°äº†ä¸€ä¸ªéå†ä¸€ä¸ªå¤šç»´æ•°ç»„å¹¶æ‰“å°å…¶å…ƒç´ çš„å‡½æ•°ã€‚ä½†æ˜¯ï¼Œéå†ä¸å¤„ç†æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªé€šç”¨çš„æ“ä½œã€‚é€šç”¨åŒ– @code{walk_array()} å‡½æ•°åªéœ€è¦åŠ å…¥åä¸º @code{process} çš„é¢å¤–å‚æ•°ã€‚

ç„¶åï¼Œåœ¨å¾ªç¯ä¸­ï¼Œå°†æ‰“å°æ•°ç»„å…ƒç´ ç´¢å¼•ä¸å€¼çš„æ“ä½œï¼Œæ›¿æ¢ä¸ºä»¥é—´æ¥å‡½æ•°è°ƒç”¨ @code{process} çš„è¯­æ³•ï¼ˆæŸ¥çœ‹ @ref{Indirect Calls}ï¼‰ï¼Œå¹¶å°†ç´¢å¼•ä¸å€¼ä¼ é€’è¿›å»ã€‚

å½“è°ƒç”¨ @code{walk_array()} æ—¶ï¼Œä½ è¦ä¼ é€’ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æœŸæœ›æ¥æ”¶ç´¢å¼•ä¸å€¼ï¼Œç„¶åæ¥å¤„ç†ç›¸åº”çš„å…ƒç´ ã€‚

é€šè¿‡æ‰“å°æ•°ç»„æ¥æµ‹è¯•ä½ çš„æ–°ç‰ˆæœ¬çš„ä»£ç ï¼Œä½ æ‰“å°çš„æ ¼å¼åº”ä¸æœ€åˆç‰ˆæœ¬çš„æ‰“å°æ ¼å¼ç›¸åŒã€‚
@end ignore

@end enumerate
@c EXCLUDE END


@node Sample Programs
@chapter å®ç”¨çš„ @command{awk} ç¨‹åº
@cindex @command{awk} programs, examples of

@c FULLXREF ON
åœ¨ @ref{Library Functions} ä¸­å‘ˆç°äº†è¯»ç¨‹åºçš„ä»£ç æ¥è¿›è¡Œç¨‹åºè¯­è¨€çš„å­¦ä¹ çš„è§‚ç‚¹ã€‚è¿™ä¸€ç« ç»§ç»­è¿™æ ·çš„ä¸»é¢˜ï¼Œå¹¶é€šè¿‡å‘ˆç°å„ç§å„æ ·çš„ @command{awk} ç¨‹åºä»¥äº«è¯»è€…ã€‚
@c FULLXREF OFF
@ifnotinfo
è¿™ä¸€@value{CHAPTER}æœ‰ä¸‰ä¸ª@value{SECTION}ã€‚
ç¬¬ä¸€@value{SECTION}æè¿°å¦‚å¯æ¥è¿›è¡Œè¿™ä¸€ç« ä¸­æä¾›çš„ç¨‹åºã€‚

ç¬¬äºŒ@value{SECTION}å‘ˆç° @command{awk} ç‰ˆæœ¬çš„å‡ ä¸ªé€šç”¨çš„ POSIX å·¥å…·ã€‚è¿™äº›ç¨‹åºå¸Œæœ›ä½ ä¹Ÿå·²ç»ç†Ÿæ‚‰äº†ï¼Œå¹¶ä¸”ä¹Ÿäº†è§£äº†è¿™äº›å·¥å…·çš„é—®é¢˜ã€‚é€šè¿‡ç”¨ @command{awk} é‡æ–°å®ç°è¿™äº›å·¥å…·ï¼Œä½ å¯ä»¥å°†ç„¦ç‚¹é›†ä¸­äº @command{awk} ç›¸å…³çš„è§£å†³ç¨‹åºé—®é¢˜çš„æ–¹é¢ã€‚

ç¬¬ä¸‰@value{SECTION}åˆ™æ˜¯ä¸€äº›æœ‰è¶£çš„ç¨‹åºé›†åˆã€‚è¿™äº›ç¨‹åºè§£å†³äº†å¾ˆå¤šæ•°ç»„å¤„ç†ä¸ç®¡ç†ç›¸å…³çš„é—®é¢˜ã€‚å¾ˆå¤šçš„ç¨‹åºéƒ½å¾ˆçŸ­ï¼Œä»¥ç”¨äºå¼ºè°ƒ @command{awk} ç”¨å‡ è¡Œä»£ç å³å¯å¤„ç†å¾ˆå¤šäº‹æƒ…çš„èƒ½åŠ›ã€‚
@end ifnotinfo

è¿™å½“ä¸­çš„å¾ˆå¤šç¨‹åºä¼šä½¿ç”¨åœ¨ @ref{Library Functions}ï¼Œä¸­å‡ºç°è¿‡çš„åº“å‡½æ•°ã€‚

@menu
* Running Examples::            How to run these examples.
* Clones::                      Clones of common utilities.
* Miscellaneous Programs::      Some interesting @command{awk} programs.
* Programs Summary::            Summary of programs.
* Programs Exercises::          Exercises.
@end menu

@node Running Examples
@section è¿è¡Œä¾‹å­ç¨‹åº

è¦è¿è¡Œä¸€ä¸ªç¨‹åºï¼Œå…¸å‹çš„æƒ…å†µä¸‹ä½ è¾“å…¥ä¸‹é¢çš„ä»£ç ï¼š

@example
awk -f @var{program} -- @var{options} @var{files}
@end example

@noindent
åœ¨è¿™é‡Œï¼Œ@var{program} æ˜¯ @command{awk} ç¨‹åºçš„åå­—ï¼ˆå¦‚ @file{cut.awk}ï¼‰ï¼Œé€‰é¡¹ @var{options} åˆ™æ˜¯ä»»æ„ç¨‹åºçš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œä»¥ @samp{-} å¼€å¤´ï¼Œè€Œ @var{files} åˆ™æ˜¯å®é™…çš„@value{DF}ã€‚

å¦‚æœä½ çš„ç³»ç»Ÿæ”¯æŒ @samp{#!} å¯æ‰§è¡Œè§£é‡Šå™¨æœºåˆ¶ï¼ˆæŸ¥çœ‹ @pxref{Executable Scripts}ï¼‰ï¼Œä½ å¯ä»¥ç›´æ¥è¿™ä¹ˆè¾“å…¥ï¼š

@example
cut.awk -c1-8 myfiles > results
@end example

å¦‚æœ @command{awk} ä¸æ˜¯ @command{gawk}ï¼Œä½ å¯èƒ½è¦è¿™ä¹ˆæ¥ä½¿ç”¨ï¼š

@example
cut.awk -- -c1-8 myfiles > results
@end example

@node Clones
@section ä¸ºå¿«ä¹ä¸è¯„æµ‹é‡æ–°å‘æ˜è½®å­
@cindex POSIX, programs@comma{} implementing in @command{awk}

æœ¬@value{SECTION}ä¸­å‘ˆç°äº†å‡ ä¸ªç”¨ @command{awk} è¯­è¨€å®ç°çš„ POSIX å·¥å…·ã€‚é‡æ–°ç”¨ @command{awk} æ¥å‘æ˜è¿™äº›ç¨‹åºï¼Œåªæ˜¯å¥½ç©ï¼Œå› æ­¤ç®—æ³•å¯ä»¥è¢«æ¸…æ™°åœ°è¡¨è¾¾ï¼Œè€Œä¸”ä»£ç ä¸€èˆ¬æ¥è¯´éƒ½éå¸¸ç²¾ç®€ä¸ç®€å•ã€‚å› ä¸º @command{awk} ç¡®å®ä¸ºä½ åšäº†å¾ˆå¤šçš„äº‹æƒ…äº†ã€‚

ä¹Ÿè¦æ³¨æ„åˆ°ï¼Œè¿™äº›ç¨‹åºæ²¡æœ‰å¿…è¦è¦å»æ›¿æ¢ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„ç‰ˆæœ¬ã€‚å…¶ä¸­ä¹Ÿæ²¡æœ‰ç¨‹åºè¢«å®Œå…¨åœ°å®ç°äº†æœ€è¿‘çš„ POSIX æ ‡å‡†ã€‚ä½†è¿™ä¸æ˜¯ä¸ªé—®é¢˜ï¼Œå®ƒä»¬çš„ç›®çš„æ˜¯ç”¨äºè§£é‡Š @command{awk} ç¨‹åºè¯­è¨€ä¸ºâ€œç°å®ä¸–ç•Œâ€çš„ä»»åŠ¡çš„ç¼–ç¨‹æ–¹å¼ã€‚

ç¨‹åºä»¥å­—æ¯é¡ºåºå‘ˆç°ã€‚

@menu
* Cut Program::                 The @command{cut} utility.
* Egrep Program::               The @command{egrep} utility.
* Id Program::                  The @command{id} utility.
* Split Program::               The @command{split} utility.
* Tee Program::                 The @command{tee} utility.
* Uniq Program::                The @command{uniq} utility.
* Wc Program::                  The @command{wc} utility.
@end menu

@node Cut Program
@subsection å‰ªåˆ‡åŸŸä¸åˆ—

@cindex @command{cut} utility
@cindex @command{cut} utility
@cindex fields, cutting
@cindex columns, cutting
@command{cut} è¿™ä¸ªå·¥å…·ä»å®ƒçš„æ ‡å‡†è¾“å…¥ä¸­é€‰æ‹©ï¼Œæˆ–è€…è¯´â€œåˆ‡åˆ†â€ï¼Œå­—ç¬¦æˆ–è€…åŸŸå¹¶è¾“å‡ºè¿™äº›å­—ç¬¦åˆ°å®ƒçš„æ ‡å‡†è¾“å‡ºä¸­ã€‚åŸŸé»˜è®¤æ˜¯é€šè¿‡ TABs æ¥è¿›è¡Œåˆ†éš”çš„ï¼Œä½†æ˜¯ä½ å¯ä»¥æä¾›ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°æ¥æ”¹å˜@dfn{åŸŸç•Œå®šç¬¦}ï¼ˆå³åŸŸåˆ†éš”ç¬¦ï¼‰ã€‚@command{cut} çš„åŸŸå®šä¹‰æ²¡æœ‰ @command{awk} çš„åŸŸé‚£ä¹ˆä¸€èˆ¬åŒ–ã€‚

@command{cut} é€šå¸¸çš„ä½¿ç”¨æ–¹å¼å¯èƒ½æ˜¯ä»å‘½ä»¤ @command{who} çš„è¾“å‡ºç»“æœä¸­ä»…ä»…æŠ½å‡ºå·²ç™»å½•ç”¨æˆ·çš„ç™»å½•åã€‚
ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç®¡çº¿ä¼šäº§ç”Ÿæœ‰åºçš„ï¼Œå”¯ä¸€çš„ç™»å½•åˆ°ç³»ç»Ÿä¸­çš„ç”¨æˆ·åˆ—è¡¨ï¼š

@example
who | cut -c1-8 | sort | uniq
@end example

@command{cut} çš„é€‰é¡¹æœ‰ï¼š

@table @code
@item -c @var{list}
ä½¿ç”¨ @var{list} ä½œä¸ºè¦åˆ‡åˆ†çš„å­—ç¬¦åˆ—è¡¨ã€‚åœ¨åˆ—è¡¨ä¸­çš„é¡¹å¯ä»¥ç”¨é€—å·åˆ†éš”ï¼ŒæŸä¸ªèŒƒå›´çš„å­—ç¬¦å¯ä»¥ç”¨æ¨ªæ æ¥åˆ†éš”ã€‚åˆ—è¡¨ @samp{1-8,15,22-35} æŒ‡å®šäº† 1 åˆ° 8 çš„å­—ç¬¦ï¼Œ15 ä»¥åŠ 22 åˆ° 35 ä¹‹é—´çš„å­—ç¬¦ã€‚

@item -f @var{list}
ä½¿ç”¨ @var{list} ä½œä¸ºè¦åˆ‡åˆ†çš„åŸŸåˆ—è¡¨ã€‚

@item -d @var{delim}
ä½¿ç”¨ @var{delim} ä½œç”¨åŸŸåˆ†éš”ç¬¦ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ TAB å­—ç¬¦ã€‚

@item -s
ä¼šæŠ‘åˆ¶æ‰“å°é‚£äº›ä¸å«æœ‰åŸŸç•Œå®šç¬¦çš„è¡Œã€‚
@end table

@command{awk} çš„ @command{cut} å®ç°ä½¿ç”¨ @code{getopt()} åº“å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Getopt Function}ï¼‰ä»¥åŠ @code{join()} åº“å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Join Function}ï¼‰ã€‚

ç¨‹åºä»¥æè¿°é€‰é¡¹çš„æ³¨é‡Šå¼€å§‹ï¼Œéœ€è¦çš„åº“å‡½æ•°ä»¥åŠä¸€ä¸ª @code{usage()} å‡½æ•°æ¥æ‰“å°ä½¿ç”¨ä¿¡æ¯åé€€å‡ºã€‚@code{usage()} åœ¨é‡åˆ°ä¸€ä¸ªæ— æ•ˆçš„å‚æ•°æ—¶ä¼šè¢«è°ƒç”¨ï¼š

@cindex @code{cut.awk} program
@example
@c file eg/prog/cut.awk
# cut.awk --- implement cut in awk
@c endfile
@ignore
@c file eg/prog/cut.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
@c endfile
@end ignore
@c file eg/prog/cut.awk

# Options:
#    -f list     Cut fields
#    -d c        Field delimiter character
#    -c list     Cut characters
#
#    -s          Suppress lines without the delimiter
#
# Requires getopt() and join() library functions

@group
function usage()
@{
    print("usage: cut [-f list] [-d c] [-s] [files...]") > "/dev/stderr"
    print("usage: cut [-c list] [files...]") > "/dev/stderr"
    exit 1
@}
@end group
@c endfile
@end example

@cindex @code{BEGIN} pattern, running @command{awk} programs and
@cindex @code{FS} variable, running @command{awk} programs and
æ¥ä¸‹æ¥å°±è½®åˆ° @code{BEGIN} è§„åˆ™ï¼Œåœ¨é‡Œé¢å¯¹å‘½ä»¤è¡Œè¿›è¡Œé€‰é¡¹åˆ†æã€‚å®ƒå°† @code{FS} è®¾ç½®ä¸ºå•ä¸ªçš„ TAB å­—ç¬¦ï¼Œå› æ­¤é‚£æ˜¯ @command{cut} çš„é»˜è®¤åŸŸåˆ†éš”ç¬¦ã€‚ä½¿ç”¨ @code{getopt()} æ¥è¿›è¡Œå¾ªç¯å‘½ä»¤è¡Œä¸­çš„é€‰é¡¹ã€‚@code{by_fields} ä¸ @code{by_chars} ä¸­åªæœ‰ä¸€ä¸ªå˜é‡è¢«è®¾ç½®ä¸º trueï¼Œä»¥æŒ‡ç¤ºå¤„ç†æ˜¯é€šè¿‡åŸŸæ¥å®Œæˆè¿˜æ˜¯é€šè¿‡å­—ç¬¦æ¥å®Œæˆã€‚å½“ä»¥å­—ç¬¦æ¥åˆ‡åˆ†æ—¶ï¼Œè¾“å‡ºåŸŸåˆ†éš”ç¬¦è¢«è®¾ç½®ä¸ºç©ºä¸²ï¼š

@example
@c file eg/prog/cut.awk
BEGIN @{
    FS = "\t"    # default
    OFS = FS
    while ((c = getopt(ARGC, ARGV, "sf:c:d:")) != -1) @{
        if (c == "f") @{
            by_fields = 1
            fieldlist = Optarg
        @} else if (c == "c") @{
            by_chars = 1
            fieldlist = Optarg
            OFS = ""
        @} else if (c == "d") @{
            if (length(Optarg) > 1) @{
                printf("cut: using first character of %s" \
                       " for delimiter\n", Optarg) > "/dev/stderr"
                Optarg = substr(Optarg, 1, 1)
            @}
            fs = FS = Optarg
            OFS = FS
            if (FS == " ")    # defeat awk semantics
                FS = "[ ]"
        @} else if (c == "s")
            suppress = 1
        else
            usage()
    @}

    # Clear out options
    for (i = 1; i < Optind; i++)
        ARGV[i] = ""
@c endfile
@end example

@cindex field separators, spaces as
ä»£ç å¿…é¡»å°å¿ƒå¤„ç†åŸŸåˆ†ç•Œç¬¦ä¸ºç©ºæ ¼çš„æƒ…å†µã€‚ä½¿ç”¨å•ç‹¬çš„ç©ºæ ¼ï¼ˆ@code{@w{" "}}ï¼‰æ¥ä½œä¸º @code{FS} çš„å€¼æ˜¯ä¸æ­£ç¡®çš„â€”â€”@command{awk} ä¼šç”¨è¿ç»­çš„ç©ºæ ¼ã€TABs ä¸/æˆ–æ¢è¡Œç¬¦æ¥è¿›è¡ŒåŸŸåˆ†å‰²ï¼Œä½†æˆ‘ä»¬æ˜¯æƒ³ç”¨å•ç‹¬çš„ç©ºæ ¼æ¥è¿›è¡Œåˆ‡åˆ†ã€‚
ä¸ºäº†è¾¾åˆ°è¿™ä¸€æ•ˆæœï¼Œæˆ‘ä»¬æŠŠåŸå§‹çš„ç©ºæ ¼å­—ç¬¦ä¸²å­˜åœ¨å˜é‡ @code{fs} é‡Œä»¥å¤‡ä¹‹åä½¿ç”¨ï¼›åœ¨æŠŠ @code{FS} è®¾ç½®ä¸º @code{"[ ]"} ä¹‹åï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ç”¨å®ƒæŸ¥çœ‹æ˜¯å¦åŸŸåˆ†ç•Œç¬¦åœ¨è¿™ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚

åŒæ—¶ä¹Ÿè¦è®°ä½å½“ @code{getopt()} å®Œæˆï¼ˆåœ¨ @ref{Getopt Function}ï¼Œä¸­è¿›è¡Œäº†æè¿°ï¼‰ï¼Œæˆ‘ä»¬è¦æ¸…é™¤åœ¨ @code{ARGV} ä¸­ 1 åˆ° @code{Optind} ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œè¿™æ · @command{awk} ä¸ä¼šå°†è¿™äº›å‘½ä»¤è¡Œå‚æ•°å½“æˆ@value{FN}è¿›è¡Œå¤„ç†ã€‚

åœ¨å¤„ç†äº†å‘½ä»¤è¡Œé€‰é¡¹åï¼Œç¨‹åºè¦éªŒè¯é€‰é¡¹æ˜¯å¦æ˜¯æœ‰ç”¨çš„ã€‚åªæœ‰ @option{-c} ä¸ @option{-f} ä¹‹ä¸€è¢«ä½¿ç”¨ï¼Œè€Œä¸¤è€…éƒ½éœ€è¦ä¸€ä¸ªåŸŸåˆ—è¡¨ã€‚ç„¶åç¨‹åºè°ƒç”¨ @code{set_fieldlist()} æˆ–è€… @code{set_charlist()} æ¥å°†åŸŸæˆ–è€…å­—ç¬¦è¡¨è¿›è¡Œæ‹†åˆ†ï¼š

@example
@c file eg/prog/cut.awk
    if (by_fields && by_chars)
        usage()

    if (by_fields == 0 && by_chars == 0)
        by_fields = 1    # default

    if (fieldlist == "") @{
        print "cut: needs list for -c or -f" > "/dev/stderr"
        exit 1
    @}

    if (by_fields)
        set_fieldlist()
    else
        set_charlist()
@}
@c endfile
@end example

@code{set_fieldlist()} å°†åˆ—è¡¨ä»¥é€—å·è¿›è¡Œåˆ†å‰²ï¼Œå¹¶å­˜å‚¨åˆ°æ•°ç»„ä¸­ã€‚ç„¶åå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼ŒæŸ¥çœ‹å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†å…¶åˆ†å¼€ã€‚å‡½æ•°æ£€æŸ¥èŒƒå›´ä»¥ç¡®ä¿ç¬¬ä¸€ä¸ªæ•°å€¼æ˜¯å°äºç¬¬äºŒä¸ªæ•°å€¼çš„ã€‚åœ¨åˆ—è¡¨ä¸­æ¯ä¸€ä¸ªæ•°å€¼éƒ½ä¼šåŠ åˆ° @code{flist} æ•°ç»„ä¸­ï¼Œè¿™ä¸ªæ•°ç»„åªæ˜¯ç®€å•åœ°è®°å½•è¦æ‰“å°çš„åŸŸã€‚ä½¿ç”¨çš„æ˜¯å¸¸è§„çš„åŸŸåˆ†å‰²ç­–ç•¥ã€‚ç¨‹åºä½¿ @command{awk} å¤„ç†åŸŸåˆ†å‰²çš„å·¥ä½œï¼š

@example
@c file eg/prog/cut.awk
function set_fieldlist(        n, m, i, j, k, f, g)
@{
    n = split(fieldlist, f, ",")
    j = 1    # index in flist
    for (i = 1; i <= n; i++) @{
        if (index(f[i], "-") != 0) @{ # a range
            m = split(f[i], g, "-")
@group
            if (m != 2 || g[1] >= g[2]) @{
                printf("cut: bad field list: %s\n",
                                  f[i]) > "/dev/stderr"
                exit 1
            @}
@end group
            for (k = g[1]; k <= g[2]; k++)
                flist[j++] = k
        @} else
            flist[j++] = f[i]
    @}
    nfields = j - 1
@}
@c endfile
@end example

@code{set_charlist()} å‡½æ•°è¦æ¯” @code{set_fieldlist()} è¦å¤æ‚å¾—å¤šã€‚è¿™é‡Œçš„æƒ³æ³•æ˜¯åˆ©ç”¨ @command{gawk} çš„ @code{FIELDWIDTHS} å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{Constant Size}ï¼‰ï¼Œè¿™ä¸ªå˜é‡æè¿°äº†è¾“å…¥çš„å¸¸é‡å®½åº¦ã€‚å½“ä½¿ç”¨å­—ç¬¦åˆ—è¡¨æ—¶ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚

è®¾ç½® @code{FIELDWIDTHS} çš„å€¼è¦æ¯”ç®€å•åœ°åˆ—è¡¨é‚£äº›è¦æ‰“å°çš„åŸŸè¦ç®€å•å¾—å¤šã€‚æˆ‘ä»¬è¦è·Ÿè¸ªè¦æ‰“å°çš„åŸŸä»¥åŠè¦è·³è¿‡çš„ä¸­é—´å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³è¦çš„å­—ç¬¦ä¸º 1 åˆ° 8ï¼Œ15ï¼Œä»¥åŠ 22 åˆ° 35ã€‚å¯éœ€è¦ä½¿ç”¨ @samp{-c 1-8,15,22-35}ã€‚
@code{FIELDWIDTHS} çš„å€¼åº”è¯¥æ˜¯ @code{@w{"8 6 1 6 14"}}ã€‚è¿™ä¼šäº§ç”Ÿ 5 ä¸ªåŸŸï¼Œè¦æ‰“å°çš„åŸŸä¸º @code{$1}ï¼Œ@code{$3} ä¸ @code{$5}ã€‚ä¸­é—´çš„åŸŸåˆ™æ˜¯å¡«å……ç¬¦ï¼Œæ˜¯æ‰€éœ€è¦çš„åŸŸä¹‹é—´çš„å­—ç¬¦ã€‚@code{flist} åˆ—å‡ºäº†è¦æ‰“å°çš„åŸŸï¼Œ@code{t} åˆ™æ˜¯ç”¨æ¥è·Ÿè¸ªå®Œæ•´çš„åŸŸåˆ—è¡¨ï¼ŒåŒ…æ‹¬å¡«å……åŸŸï¼š

@example
@c file eg/prog/cut.awk
function set_charlist(    field, i, j, f, g, n, m, t,
                          filler, last, len)
@{
    field = 1   # count total fields
    n = split(fieldlist, f, ",")
    j = 1       # index in flist
    for (i = 1; i <= n; i++) @{
        if (index(f[i], "-") != 0) @{ # range
            m = split(f[i], g, "-")
            if (m != 2 || g[1] >= g[2]) @{
                printf("cut: bad character list: %s\n",
                               f[i]) > "/dev/stderr"
                exit 1
            @}
            len = g[2] - g[1] + 1
            if (g[1] > 1)  # compute length of filler
                filler = g[1] - last - 1
            else
                filler = 0
@group
            if (filler)
                t[field++] = filler
@end group
            t[field++] = len  # length of field
            last = g[2]
            flist[j++] = field - 1
        @} else @{
            if (f[i] > 1)
                filler = f[i] - last - 1
            else
                filler = 0
            if (filler)
                t[field++] = filler
            t[field++] = 1
            last = f[i]
            flist[j++] = field - 1
        @}
    @}
    FIELDWIDTHS = join(t, 1, field - 1)
    nfields = j - 1
@}
@c endfile
@end example

ä¸‹ä¸€ä¸ªåˆ™æ˜¯å¤„ç†æ•°æ®çš„è§„åˆ™ã€‚å¦‚æœæŒ‡å®šäº† @option{-s} é€‰é¡¹ï¼Œåˆ™ @code{suppress} ä¸º trueã€‚ç¬¬ä¸€ä¸ª @code{if} è¯­å¥ç¡®ä¿è¾“å…¥çš„è®°å½•ä¸­ç¡®å®åŒ…å«åŸŸåˆ†éš”ç¬¦ã€‚å¦‚æœ @command{cut} æ­£åœ¨å¤„ç†åŸŸï¼Œè€Œ @code{suppress} ä¸º trueï¼Œå¹¶ä¸”åŸŸåˆ†éš”å­—ç¬¦ä¸åœ¨è®°å½•ä¸­ï¼Œåˆ™è¿™æ¡è®°å½•ä¼šè¢«è·³è¿‡ã€‚

å¦‚æœè®°å½•æ˜¯æœ‰æ•ˆçš„ï¼Œåˆ™ @command{gawk} ä¼šå°†è®°å½•åˆ†å‰²æˆåŸŸï¼Œè¦ä¹ˆä½¿ç”¨çš„æ˜¯ @code{FS} ä¸­çš„å­—ç¬¦ï¼Œè¦ä¹ˆæ˜¯ä½¿ç”¨å›ºå®šå®½åº¦çš„æ–¹å¼ï¼Œä»¥åŠ @code{FIELDWIDTHS} æ–¹å¼ã€‚å¾ªç¯è¿­ä»£é‚£äº›è¦è¢«æ‰“å°çš„åŸŸåˆ—è¡¨ã€‚å¦‚æœå…¶åŒ…å«ç›¸åº”æ•°æ®ï¼Œåˆ™æ‰“å°ç›¸åº”çš„åŸŸã€‚å¦‚æœä¸‹ä¸€ä¸ªåŸŸä¹ŸåŒ…å«æ•°æ®ï¼Œåˆ™åœ¨ä¸¤ä¸ªåŸŸä¹‹é—´è¾“å‡ºåˆ†éš”ç¬¦ï¼š

@example
@c file eg/prog/cut.awk
@{
    if (by_fields && suppress && index($0, fs) == 0)
        next

    for (i = 1; i <= nfields; i++) @{
        if ($flist[i] != "") @{
            printf "%s", $flist[i]
            if (i < nfields && $flist[i+1] != "")
                printf "%s", OFS
        @}
    @}
    print ""
@}
@c endfile
@end example

è¿™ä¸ªç‰ˆæœ¬çš„ @command{cut} ä¾èµ–äº @command{gawk} çš„ @code{FIELDWIDTHS} å˜é‡æ¥åšåŸºäºå­—ç¬¦çš„åˆ‡åˆ†ã€‚ä¹Ÿå¯ä»¥åœ¨å…¶ä»–çš„ @command{awk} å®ç°ä¸­ä½¿ç”¨ @code{substr()}ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ï¼Œä½†æ˜¯é‚£å®ç°èµ·æ¥ä¹Ÿå¾ˆç—›è‹¦ã€‚@code{FIELDWIDTHS} å˜é‡æä¾›äº†ä¸€ç§å¾ˆä¼˜é›…çš„è§£å†³æ–¹æ³•æ¥å¤„ç†è¢«å­—ç¬¦åˆ†å‰²çš„è¾“å…¥è¡Œã€‚


@node Egrep Program
@subsection ç”¨æ­£åˆ™è¡¨è¾¾å¼åœ¨æ–‡ä»¶ä¸­æœç´¢

@cindex regular expressions, searching for
@cindex searching, files for regular expressions
@cindex files, searching for regular expressions
@cindex @command{egrep} utility
@command{egrep} å·¥å…·è¦æ¥æŒ‰æ¨¡å¼æœç´¢æ–‡ä»¶å†…å®¹ã€‚å®ƒä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼å‡ ä¹ä¸ @command{awk} æ‰€ä½¿ç”¨çš„ä¸€æ ·ï¼ˆæŸ¥çœ‹ @pxref{Regexp}ï¼‰ã€‚ä½ è¿™ä¹ˆæ¥è°ƒç”¨ï¼š

@display
@command{egrep} [@var{options}] @code{'@var{pattern}'} @var{files} @dots{}
@end display

@var{pattern} æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚åœ¨å…¸å‹çš„ä½¿ç”¨æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¼šè¢«å¼•èµ·æ¥ï¼Œä»¥é¿å… Shell å°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦æ‰©å±•ä¸º@value{FN}çš„é€šé…ç¬¦ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ@command{egrep} æ‰“å°åŒ¹é…çš„è¡Œã€‚å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æä¾›äº†å¤šä¸ª@value{FN}ï¼Œåˆ™æ¯ä¸ªè¾“å‡ºè¡Œå‰éƒ½å¸¦ä¸Šæ–‡ä»¶åï¼Œåé¢è·Ÿç€å†’å·ï¼š

@command{egrep} çš„é€‰é¡¹å¦‚ä¸‹ï¼š

@table @code
@item -c
æ‰“å°åŒ¹é… pattern çš„è¡Œçš„æ€»æ•°ï¼Œè€Œä¸æ˜¯åŒ¹é…è¡Œæœ¬èº«ã€‚

@item -s
é™é»˜å¤„ç†ï¼Œä¸äº§ç”Ÿè¾“å‡ºï¼Œå¹¶ä¸”ç”¨é€€å‡ºå€¼æ¥è¡¨ç¤ºæ˜¯å¦æœ‰åŒ¹é…çš„è¡Œã€‚

@item -v
å¯¹åŒ¹é…æµ‹è¯•å–åã€‚@command{egrep} æ‰“å°é‚£äº›ä¸åŒ¹é…æ¨¡å¼çš„è¡Œï¼Œå¹¶ä¸”å¦‚æœåŒ¹é…@emph{æ²¡æœ‰}æˆåŠŸï¼Œåˆ™ä»¥æˆåŠŸé€€å‡ºã€‚

@item -i
å¿½ç•¥ pattern ä¸è¾“å…¥æ•°æ®çš„å¤§å°å†™ã€‚

@item -l
åªæ‰“å°ï¼ˆåˆ—å‡ºï¼‰åŒ¹é…çš„æ–‡ä»¶åï¼Œè€Œä¸æ˜¯åŒ¹é…çš„è¡Œã€‚

@item -e @var{pattern}
ä½¿ç”¨ @var{pattern} ä¸ºè¦åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚@option{-e} é€‰é¡¹çš„ç›®çš„æ˜¯å…è®¸æ¨¡å¼å¯ä»¥ä»¥ @samp{-} å¼€å§‹ã€‚
@end table

è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨ @code{getopt()} åº“å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Getopt Function}ï¼‰ä»¥åŠæ–‡ä»¶è½¬æ¢åº“ç¨‹åºï¼ˆæŸ¥çœ‹ @pxref{Filetrans Function}ï¼‰ã€‚

ç¨‹åºä»¥æè¿°æ€§çš„æ³¨é‡Šå¼€å§‹ï¼Œç„¶åæ˜¯ @code{BEGIN} è§„åˆ™è°ƒç”¨ @code{getopt()} å‡½æ•°æ¥å¤„ç†å‘½ä»¤è¡Œå‚æ•°ã€‚ @option{-i}ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰é€‰é¡¹å¯¹äº @command{gawk} æ¥è¯´å°¤å…¶ç®€å•ï¼Œæˆ‘ä»¬åªä½¿ç”¨é¢„å®šä¹‰çš„ @code{IGNORECASE} å˜é‡å°±å¯ä»¥å®ç°ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ï¼š

@cindex @code{egrep.awk} program
@example
@c file eg/prog/egrep.awk
# egrep.awk --- simulate egrep in awk
#
@c endfile
@ignore
@c file eg/prog/egrep.awk
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993

@c endfile
@end ignore
@c file eg/prog/egrep.awk
# Options:
#    -c    count of lines
#    -s    silent - use exit value
#    -v    invert test, success if no match
#    -i    ignore case
#    -l    print filenames only
#    -e    argument is pattern
#
# Requires getopt and file transition library functions

BEGIN @{
    while ((c = getopt(ARGC, ARGV, "ce:svil")) != -1) @{
        if (c == "c")
            count_only++
        else if (c == "s")
            no_print++
        else if (c == "v")
            invert++
        else if (c == "i")
            IGNORECASE = 1
        else if (c == "l")
            filenames_only++
        else if (c == "e")
            pattern = Optarg
        else
            usage()
    @}
@c endfile
@end example

æ¥ä¸‹æ¥åˆ™æ˜¯å¤„ç† @command{egrep} ç›¸å…³çš„è¡Œä¸ºã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨ @option{-e} é€‰é¡¹æä¾› pattern å‚æ•°ï¼Œåˆ™ä¼šä½¿ç”¨å‘½ä»¤è¡Œä¸­çš„ç¬¬ä¸€ä¸ªéé€‰é¡¹å‚æ•°ã€‚@command{awk} ä¸­åˆ° @code{ARGV[Optind]} ä¸­çš„å‚æ•°ä¼šè¢«æ¸…ç©ºï¼Œæ‰€ä»¥ @command{awk} ä¸ä¼šå°è¯•å°†å®ƒä»¬å½“æˆæ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šæ–‡ä»¶ï¼Œåˆ™ä½¿ç”¨æ ‡å‡†çš„è¾“å…¥ï¼Œè€Œå¦‚æœæŒ‡å®šçš„å¤šä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬è¦ç¡®ä¿è¦çœ‹åˆ°è¿™ç§æƒ…å†µï¼Œå› æ­¤@value{FN}è¦å‡ºç°åœ¨è¾“å‡ºçš„è¡Œä¹‹å‰ï¼š

@example
@c file eg/prog/egrep.awk
    if (pattern == "")
        pattern = ARGV[Optind++]

    for (i = 1; i < Optind; i++)
        ARGV[i] = ""
    if (Optind >= ARGC) @{
        ARGV[1] = "-"
        ARGC = 2
    @} else if (ARGC - Optind > 1)
        do_filenames++

#    if (IGNORECASE)
#        pattern = tolower(pattern)
@}
@c endfile
@end example

æœ€åä¸¤è¡Œè¢«æ³¨é‡Šæ‰äº†ï¼Œå› ä¸ºåœ¨ @command{gawk} ä¸­ä¸éœ€è¦ã€‚å¦‚æœä½ ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬çš„ @command{awk}ï¼Œåˆ™ä½ å¯èƒ½éœ€è¦å°†ä»–ä»¬åæ³¨é‡Šå›æ¥ã€‚

å¦‚æœä½ ä¸æ˜¯ä½¿ç”¨çš„ @command{gawk}ï¼Œä¸‹é¢æ˜¯è¦è¢«åæ³¨é‡Šæ‰çš„è¡Œã€‚è¿™ä¸ªè§„åˆ™åœ¨æŒ‡å®šäº† @option{-i} å‚æ•°æ—¶ï¼Œå°†æ‰€æœ‰çš„è¾“å…¥è¡Œä¸­çš„å­—ç¬¦è½¬æ¢ä¸ºå°å†™ã€‚
@footnote{è¿™é‡ŒåŒæ—¶ä¹Ÿå¼•å…¥äº†ä¸€ä¸ªéšè”½çš„ Bugï¼Œå¦‚æœå‘ç”Ÿäº†åŒ¹é…ï¼Œæˆ‘ä»¬è¾“å‡ºè¢«è½¬æ¢äº†çš„è¡Œï¼Œè€Œä¸æ˜¯åŸæ¥çš„è¡Œã€‚}
å®ƒä»¬è¢«æ³¨é‡Šæ‰ï¼Œæ˜¯å› ä¸ºè¿™äº›ä»£ç åœ¨ @command{gawk} ä¸­ä½¿ç”¨ã€‚

@example
@c file eg/prog/egrep.awk
#@{
#    if (IGNORECASE)
#        $0 = tolower($0)
#@}
@c endfile
@end example

å½“æ¯å¤„ç†ä¸€ä¸ªæ–°æ–‡ä»¶çš„æ—¶å€™ï¼Œ@code{beginfile()} å‡½æ•°åœ¨ @file{ftrans.awk} ä¸­è¢«è°ƒç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯éå¸¸ç®€å•çš„ï¼Œæ‰€è¦è¦åšçš„äº‹æƒ…å°±æ˜¯åˆå§‹åŒ–å˜é‡ @code{fcount} ä¸º 0ã€‚@code{fcount} ç”¨æ¥è·Ÿè¸ªå½“å‰çš„æ–‡ä»¶ä¸­æœ‰å¤šå°‘è¡ŒåŒ¹é… patternã€‚åå­—ä¸º @code{junk} çš„å‚æ•°æ˜¾ç¤º @code{beginfile()} ä¼šä½¿ç”¨ä¸€ä¸ªå‚æ•°æ¥è°ƒç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯¹å…¶å€¼ä¸æ„Ÿå…´è¶£ï¼š

@example
@c file eg/prog/egrep.awk
function beginfile(junk)
@{
    fcount = 0
@}
@c endfile
@end example

å½“æ¯ä¸€ä¸ªæ–‡ä»¶è¢«å¤„ç†å®Œåï¼Œä¼šè°ƒç”¨ @code{endfile()}ã€‚å®ƒåªä¼šåœ¨ç”¨æˆ·æƒ³çŸ¥é“æœ‰å¤šå°‘è¡ŒåŒ¹é…æ—¶æ‰ä¼šå½±å“è¾“å‡ºã€‚@code{no_print} éœ€è¦é€€å‡ºçŠ¶æ€æ—¶æ‰ä¸ºä¼š trueã€‚@code{count_only} å¦‚æœè¦ç»Ÿè®¡æ—¶æ‰ä¼šä¸º trueã€‚å¦‚æœæ‰“å°ä¸ç»Ÿè®¡è¢«å¯ç”¨ï¼Œ@code{egrep} å› æ­¤åªæ‰“å°è¡Œç»Ÿè®¡æ•°ã€‚è¾“å‡ºçš„æ ¼å¼å¿…é¡»æ ¹æ®è¦å¤„ç†çš„æ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚æœ€åï¼Œ@code{fcount} è¢«åŠ è¿› @code{total}ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“æ€»å…±æœ‰å¤šå°‘è¡ŒåŒ¹é…äº† patternï¼š

@example
@c file eg/prog/egrep.awk
function endfile(file)
@{
    if (! no_print && count_only) @{
        if (do_filenames)
            print file ":" fcount
        else
            print fcount
    @}

    total += fcount
@}
@c endfile
@end example

@code{BEGINFILE} ä¸ @code{ENDFILE} è¿™ä¸¤ä¸ªç‰¹æ®Šæ¨¡å¼ï¼ˆæŸ¥çœ‹ @pxref{BEGINFILE/ENDFILE}ï¼‰ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç¨‹åºå¿…é¡»æ˜¯ç”¨ @command{gawk} æ¥è¿è¡Œçš„ã€‚å¦å¤–ï¼Œè¿™ä¸ªä¾‹å­å†™äº @command{gawk} åŠ å…¥ @code{BEGINFILE} ä¸ @code{ENDFILE} ç‰¹æ€§ä¹‹å‰ã€‚

ä¸‹é¢çš„è§„åˆ™å¤„ç†äº†å¤§éƒ¨åˆ†çš„åŒ¹é…è¡Œçš„å·¥ä½œã€‚å˜é‡ @code{matches} åœ¨è¡ŒåŒ¹é… pattern æ—¶ä¸ºçœŸã€‚å¦‚æœç”¨æˆ·æƒ³è¦ä¸åŒ¹é…çš„è¡Œï¼Œåˆ™ @code{matches} çš„æ„ä¹‰å°±ç”¨ @samp{!} è¢«åè¿‡æ¥ä½¿ç”¨ã€‚@code{fcount} ä¼šç”¨ @code{matches} çš„å€¼ä¸€èµ·é€’å¢ï¼Œæ ¹æ®åŒ¹é…æˆåŠŸä¸å¦ï¼Œå…¶è¦ä¹ˆæ˜¯ 0ï¼Œè¦ä¹ˆæ˜¯ 1ã€‚å¦‚æœè¡Œä¸åŒ¹é…ï¼Œåˆ™ @code{next} è¯­å¥ä¼šè°ƒç”¨ï¼Œç”¨äºå¤„ç†ä¸‹ä¸€æ¡è®°å½•ã€‚

ä¸‹é¢æ‰§è¡Œäº†å¾ˆå¤šçš„æµ‹è¯•ï¼Œä½†æ˜¯å®ƒä»¬åªä¼šåœ¨æˆ‘ä»¬ä¸è¿›è¡Œè¡Œç»Ÿè®¡æ—¶æ‰§è¡Œã€‚é¦–å…ˆï¼Œå¦‚æœç”¨æˆ·æƒ³è¦çš„æ˜¯é€€å‡ºçŠ¶æ€ï¼ˆ@code{no_print} ä¸º trueï¼‰ï¼Œåˆ™åªéœ€è¦çŸ¥é“æ–‡ä»¶ä¸­çš„æŸ@emph{ä¸€}è¡Œæ˜¯å¦åŒ¹é…å°±å¯ä»¥äº†ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ç”¨ @code{nextfile} æ¥è·³åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚ç›¸ä¼¼åœ°ï¼Œå¦‚æœæˆ‘ä»¬ä»…éœ€è¦æ‰“å°@value{FN}ï¼Œæˆ‘ä»¬åˆ™æ‰“å°@value{FN}åç”¨ @code{nextfile} è¯­å¥æ¥è·³åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚æœ€åï¼Œæˆ‘ä»¬ä¼šæ‰“å°æ¯ä¸€è¡Œï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œåœ¨å…¶å‰é¢åŠ å…¥@value{FN}ä¸å†’å·ï¼š

@cindex @code{!} (exclamation point), @code{!} operator
@cindex exclamation point (@code{!}), @code{!} operator
@example
@c file eg/prog/egrep.awk
@{
    matches = ($0 ~ pattern)
    if (invert)
        matches = ! matches

    fcount += matches    # 1 or 0

    if (! matches)
        next

    if (! count_only) @{
        if (no_print)
            nextfile

        if (filenames_only) @{
            print FILENAME
            nextfile
        @}

        if (do_filenames)
            print FILENAME ":" $0
        else
            print
    @}
@}
@c endfile
@end example

@code{END} è§„åˆ™è¦å¤„ç†å¥½æ­£ç¡®çš„è¿”å›çŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œåˆ™é€€å‡ºçŠ¶æ€ä¸º 1ï¼Œå¦åˆ™ä¸º 0 ï¼š

@example
@c file eg/prog/egrep.awk
END @{
    exit (total == 0)
@}
@c endfile
@end example

@code{usage()} å‡½æ•°ç”¨æ¥åœ¨è¾“å…¥æ— æ•ˆé€‰é¡¹çš„æ—¶å€™æ‰“å°ä½¿ç”¨ä¿¡æ¯ï¼Œç„¶åé€€å‡ºï¼š

@example
@c file eg/prog/egrep.awk
function usage()
@{
    print("Usage: egrep [-csvil] [-e pat] [files ...]") > "/dev/stderr"
    print("\n\tegrep [-csvil] pat [files ...]") > "/dev/stderr"
    exit 1
@}
@c endfile
@end example


@node Id Program
@subsection æ‰“å°ç”¨æˆ·ä¿¡æ¯

@cindex printing, user information
@cindex users, information about, printing
@cindex @command{id} utility
@command{id} å·¥å…·åˆ—å‡ºç”¨æˆ·çš„çœŸå®ä¸æœ‰æ•ˆçš„ç”¨æˆ· ID å€¼ï¼ŒçœŸå®ä¸æœ‰æ•ˆçš„ç»„ ID å€¼ï¼Œå¦‚æœæœ‰çš„è¯ï¼ŒåŒ…å«ç”¨æˆ·çš„ç»„é›†ã€‚@command{id} åªæœ‰åœ¨å®ƒåŒäºçœŸå®çš„ID çš„æƒ…å†µä¸‹ï¼Œæ‰æ‰“å°æœ‰æ•ˆçš„ç”¨æˆ· ID ä¸ç»„ IDã€‚å¦‚æœå¯èƒ½ï¼Œ@command{id} ä¹Ÿæä¾›äº†ç›¸åº”çš„å‰æˆ·ä¸ç»„åã€‚è¾“å‡ºå¯èƒ½å¦‚ä¸‹ï¼š

@example
$ @kbd{id}
@print{} uid=1000(arnold) gid=1000(arnold) groups=1000(arnold),4(adm),7(lp),27(sudo)
@end example

@cindex @code{PROCINFO} array, and user and group ID numbers
è¿™é‡Œçš„ä¿¡æ¯ä¸€éƒ¨ä»½æ˜¯ç”± @command{gawk} çš„ @code{PROCINFO} æ•°ç»„æ¥æä¾›çš„ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ã€‚ä½†æ˜¯ï¼Œ@command{id} å·¥å…·ä¼šæä¾›æ¯”å•çº¯çš„æ•°ç»„æ›´å¥½çš„è¾“å‡ºã€‚

è¿™é‡Œæ˜¯ @command{id} çš„ä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬ï¼Œç”¨ @command{awk} å†™æˆã€‚å®ƒä½¿ç”¨æ¥è‡ªäº @ref{Library Functions}ï¼Œçš„ç”¨æˆ·æ•°æ®åº“å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Passwd Functions}ï¼‰ ä»¥åŠç»„æ•°æ®åº“å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Group Functions}ï¼‰ã€‚

ç¨‹åºç›¸å½“ç›´æ¥ã€‚æ‰€æœ‰çš„å·¥ä½œéƒ½åœ¨ @code{BEGIN} è§„åˆ™ä¸­å®Œæˆã€‚ç”¨æˆ·ä»¥åŠç»„ ID å€¼ä» @code{PROCINFO} ä¸­å–å¾—ã€‚ä»£ç æ˜¯å¯é‡å¤çš„ã€‚åœ¨ç”¨æˆ·æ•°æ®åº“ä¸­çš„ç”¨äºçœŸå®ç”¨æˆ·ID çš„é¡¹è¢«ç”¨ @samp{:} åˆ†å‰²æˆä¸åŒçš„éƒ¨åˆ†ã€‚ç¬¬ä¸€é¡¹æ˜¯åå­—ã€‚ç›¸åº”çš„ä»£ç ä¹Ÿå¯ä»¥ç”¨äºæœ‰æ•ˆçš„ç”¨æˆ· ID ä¸ç»„ç›¸å…³çš„å€¼ï¼š

@cindex @code{id.awk} program
@example
@c file eg/prog/id.awk
# id.awk --- implement id in awk
#
# Requires user and group library functions
@c endfile
@ignore
@c file eg/prog/id.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
# Revised February 1996
# Revised May 2014
# Revised September 2014

@c endfile
@end ignore
@c file eg/prog/id.awk
# output is:
# uid=12(foo) euid=34(bar) gid=3(baz) \
#             egid=5(blat) groups=9(nine),2(two),1(one)

@group
BEGIN @{
    uid = PROCINFO["uid"]
    euid = PROCINFO["euid"]
    gid = PROCINFO["gid"]
    egid = PROCINFO["egid"]
@end group

    printf("uid=%d", uid)
    pw = getpwuid(uid)
    pr_first_field(pw)

    if (euid != uid) @{
        printf(" euid=%d", euid)
        pw = getpwuid(euid)
        pr_first_field(pw)
    @}

    printf(" gid=%d", gid)
    pw = getgrgid(gid)
    pr_first_field(pw)

    if (egid != gid) @{
        printf(" egid=%d", egid)
        pw = getgrgid(egid)
        pr_first_field(pw)
    @}

    for (i = 1; ("group" i) in PROCINFO; i++) @{
        if (i == 1)
            printf(" groups=")
        group = PROCINFO["group" i]
        printf("%d", group)
        pw = getgrgid(group)
        pr_first_field(pw)
        if (("group" (i+1)) in PROCINFO)
            printf(",")
    @}

    print ""
@}

function pr_first_field(str,  a)
@{
    if (str != "") @{
        split(str, a, ":")
        printf("(%s)", a[1])
    @}
@}
@c endfile
@end example

åœ¨ @code{for} å¾ªç¯ä¸­çš„æµ‹è¯•å€¼å¾—æ³¨æ„ä¸€ä¸‹ã€‚ä»»æ„åœ¨ @code{PROCINFO} æ•°ç»„ä¸­çš„è¡¥å……çš„å€¼éƒ½æœ‰ç´¢å¼•ä» @code{"group1"} åˆ°æŸä¸ªå€¼ @var{N} çš„ @code{"group@var{N}"}ï¼ˆå³è¡¥å……ç»„çš„æ€»æ•°ï¼‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬äº‹å…ˆä¸çŸ¥é“æœ‰å¤šå°‘ä¸ªè¿™æ ·çš„ç»„ã€‚

å¾ªç¯ä» 1 å¼€å§‹ï¼Œå°†å€¼æ˜¯ @code{"group"} è¿›è¡Œè¿æ¥ï¼Œç„¶åä½¿ç”¨ @code{in} æ“ä½œç¬¦æ¥æŸ¥çœ‹ç›¸åº”çš„å€¼æ˜¯å¦åœ¨æ•°ç»„ä¸­ï¼ˆæŸ¥çœ‹ @ref{Reference to Elements}ï¼‰ã€‚æœ€åï¼Œ@code{i} ä¼šé€’å¢è¶Šè¿‡æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªç»„ï¼Œç„¶åå¾ªç¯é€€å‡ºã€‚

å¾ªç¯åœ¨@emph{æ²¡æœ‰}è¡¥å……ç»„çš„æƒ…å†µä¸‹ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼Œè¿™æ ·ç¬¬ä¸€æ¬¡æµ‹è¯•æ—¶æ¡ä»¶å°±ä¸º falseï¼Œè¿™æ ·å¾ªç¯å°±æ ¹æœ¬æ²¡æœ‰æ‰§è¡Œè¿‡ã€‚

@code{pr_first_field()} å‡½æ•°ç®€å•åœ°éš”ç¦»ä¸€äº›è¦é‡å¤ä½¿ç”¨çš„ä»£ç ï¼Œä½¿å¾—æ•´ä¸ªç¨‹åºæ›´çŸ­æ›´æ¸…æ™°ã€‚ç‰¹åˆ«æ˜¯å°†æ£€æµ‹ç©ºä¸²çš„ä»£ç ç§»è¿›ä¸ªå‡½æ•°ä¸­ã€‚


@node Split Program
@subsection å°†å¤§æ–‡ä»¶åˆ†ç‰‡

@c FIXME: One day, update to current POSIX version of split

@cindex files, splitting
@cindex @code{split} utility
@command{split} å·¥å…·å°†å¤§çš„æ–‡æœ¬æ–‡ä»¶åˆ†å‰²æˆæ›´å°äº†å‡ ä¸ªã€‚ç”¨æ³•å¦‚ä¸‹ï¼š 
@footnote{è¿™æ˜¯ä¼ ç»Ÿçš„ç”¨æ³•ã€‚POSIX çš„ç”¨æ³•æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯å¯¹äºè¦ç¨‹åºè¦è¯´æ˜çš„ä¸œè¥¿æ˜¯æ— å…³çš„ã€‚}

@display
@command{split} [@code{-@var{count}}] [@var{file}] [@var{prefix}]
@end display

é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å‡ºæ–‡ä»¶å‘½åä¸º @file{xaa}ï¼Œ@file{xab} ç­‰ç­‰ã€‚æ¯ä¸ªæ–‡ä»¶æœ‰ä¸€åƒè¡Œï¼Œæœ€åä¸€ä¸ªæ–‡ä»¶ä¾‹å¤– ã€‚ä¸ºäº†æ¯ä¸ªæ–‡ä»¶ä¸­çš„è¡Œæ•°ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä¸€ä¸ªæ•°å€¼ï¼Œå‰é¢å¸¦ä¸€ä¸ªå‡å·ï¼ˆå¦‚ @samp{-500} ä½¿æ¯ä¸ªæ–‡ä»¶ä¸­æœ‰ 500 è¡Œï¼Œè€Œä¸æ˜¯ 1000 è¡Œï¼‰ã€‚ä¸ºäº†æ”¹å˜è¾“å‡ºæ–‡ä»¶çš„åå­—ä¸ºè¯¸å¦‚ @file{myfileaa}ï¼Œ@file{myfileab} ç­‰ç­‰ï¼Œåˆ™æä¾›ä¸€ä¸ªé¢å¤–çš„å‚æ•°æ¥æŒ‡å®š@value{FN}çš„å‰ç¼€ã€‚

ä¸‹é¢æ˜¯ @command{awk} ç‰ˆæœ¬çš„ splitã€‚å®ƒä½¿ç”¨åœ¨ @ref{Ordinal Functions}ï¼Œä¸­çš„ @code{ord()} ä¸ @code{chr()} å‡½æ•°ã€‚

ç¨‹åºé¦–å…ˆè®¾ç½®å®ƒçš„é»˜è®¤è¡Œä¸ºï¼Œç„¶åæµ‹è¯•ä»¥ç¡®ä¿ä¸ä¼šæœ‰å¤ªå¤šçš„å‚æ•°ã€‚ç„¶åä¾æ¬¡æŸ¥çœ‹æ¯ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä¸€ä¸ªè´Ÿå·ï¼Œåé¢è·Ÿä¸€ä¸ªæ•°å€¼ã€‚å¦‚æœæœï¼Œè¿™çœ‹èµ·æ¥å°±åƒæ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œæ‰€ä»¥ä½¿å…¶ä¸ºæ­£æ•°ï¼Œå³æ˜¯è¡Œçš„æ•°å€¼ã€‚@value{DF}åè¢«å¿½ç•¥è¿‡å»ï¼Œæœ€åä¸€ä¸ªå‚æ•°ç”¨äºè¾“å‡º@value{FN}çš„å‰ç¼€ï¼š

@cindex @code{split.awk} program
@example
@c file eg/prog/split.awk
# split.awk --- do split in awk
#
# Requires ord() and chr() library functions
@c endfile
@ignore
@c file eg/prog/split.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
# Revised slightly, May 2014

@c endfile
@end ignore
@c file eg/prog/split.awk
# usage: split [-count] [file] [outname]

BEGIN @{
    outfile = "x"    # default
    count = 1000
    if (ARGC > 4)
        usage()

    i = 1
    if (i in ARGV && ARGV[i] ~ /^-[[:digit:]]+$/) @{
        count = -ARGV[i]
        ARGV[i] = ""
        i++
    @}
    # test argv in case reading from stdin instead of file
    if (i in ARGV)
        i++    # skip datafile name
    if (i in ARGV) @{
        outfile = ARGV[i]
        ARGV[i] = ""
    @}

    s1 = s2 = "a"
    out = (outfile s1 s2)
@}
@c endfile
@end example

ä¸‹ä¸€ä¸ªè§„åˆ™åšå‰©ä¸‹çš„å¤§éƒ¨åˆ†çš„äº‹æƒ…ï¼Œ@code{tcount}ï¼ˆtemporary countï¼‰è·Ÿè¸ªå½“å‰å·²ç»æœ‰å¤šå°‘è¡Œè¾“å‡ºåˆ°äº†è¾“å‡ºæ–‡ä»¶ä¸­ã€‚å¦‚æœå…¶å¤§äº @code{count}ï¼Œåˆ™è¦å…³é—­å½“å‰çš„æ–‡ä»¶ç„¶åå¼€å¯ä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚@code{s1} ä¸ @code{s2} è·Ÿè¸ªå½“å‰çš„æ–‡ä»¶åå‰ç¼€ã€‚å¦‚æœä»–ä»¬ä¸¤ä¸ªéƒ½æ˜¯ @samp{z}ï¼Œåˆ™è¡¨ç¤ºæ–‡ä»¶å¤ªå¤§äº†ã€‚å¦åˆ™ï¼Œ@code{s1} ç§»åŠ¨åˆ°å­—æ¯è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå­—æ¯ï¼Œ@code{s2} åˆ™ä» @samp{a} å¼€å§‹ï¼š

@c else on separate line here for page breaking
@example
@c file eg/prog/split.awk
@{
    if (++tcount > count) @{
        close(out)
        if (s2 == "z") @{
            if (s1 == "z") @{
                printf("split: %s is too large to split\n",
                       FILENAME) > "/dev/stderr"
                exit 1
            @}
            s1 = chr(ord(s1) + 1)
            s2 = "a"
        @}
@group
        else
            s2 = chr(ord(s2) + 1)
@end group
        out = (outfile s1 s2)
        tcount = 1
    @}
    print > out
@}
@c endfile
@end example

@noindent
@code{usage()} å‡½æ•°ç®€å•åœ°æ‰“å°é”™è¯¯å¹¶è¾“å‡ºï¼š

@example
@c file eg/prog/split.awk
function usage()
@{
    print("usage: split [-num] [file] [outname]") > "/dev/stderr"
    exit 1
@}
@c endfile
@end example

è¿™ä¸ªç¨‹åºç¨‹åºæœ‰ä¸€ç‚¹æ»‘å¤´ï¼Œä»–ä¾èµ–äº @command{awk} æ¥è‡ªåŠ¨å…³é—­æœ€åä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨ @code{END} è§„åˆ™ä¸­æ¥å¤„ç†ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿå‡è®¾å­—æ¯åœ¨å­—ç¬¦é›†ä¸­æ˜¯è¿ç»­çš„ï¼Œè¿™åœ¨ EBCDIC çš„ç³»ç»Ÿä¸­æ˜¯ä¸æˆç«‹çš„ã€‚

@ifset FOR_PRINT
ä½ å¯èƒ½ä¼šè€ƒè™‘æ€ä¹ˆé¿å…ä½¿ç”¨ @code{ord()} å’Œ @code{chr()}ï¼›è¿™ä¹Ÿèƒ½é€šè¿‡å’Œè§£å†³ EBCDIC é—®é¢˜åŒæ ·çš„æ–¹å¼è§£å†³ã€‚
@end ifset


@node Tee Program
@subsection å°†è¾“å‡ºå¤åˆ¶åˆ°å¤šä¸ªæ–‡ä»¶ä¸­

@cindex files, multiple@comma{} duplicating output into
@cindex output, duplicating into files
@cindex @code{tee} utility
@code{tee} ç¨‹åºæ˜¯ä¸€ä¸ªâ€œç®¡é“é€‚é…å™¨â€ã€‚@code{tee} å°†ä»–çš„æ ‡å‡†è¾“å‡ºåˆ°å®ƒçš„æ ‡å‡†è¾“å‡ºä¸­ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°å‘½ä»¤è¡Œä¸­æ‹‰ä¸æŒ‡å®šçš„æ–‡ä»¶åä¸­ã€‚å®ƒçš„ç”¨æ³•å¦‚ä¸‹ï¼š

@display
@command{tee} [@option{-a}] @var{file} @dots{}
@end display

@option{-a} é€‰é¡¹å‘Šè¯‰ @code{tee} å°†å†…å®¹é™„åŠ åˆ°å‘½ä»¤çš„æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯å°†è¿™äº›æ–‡ä»¶è¡Œæ¸…é™¤å†é‡æ–°å¼€å§‹ã€‚

@code{BEGIN} è§„åˆ™é¦–å…ˆç”Ÿæˆæ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°çš„å¤æœ¬åˆ°åä¸º @code{copy} çš„æ•°ç»„ä¸­ã€‚@code{ARGV[0]} æ˜¯ä¸éœ€è¦çš„ï¼Œæ‰€ä»¥å®ƒä¸ä¼šè¢«å¤åˆ¶ã€‚@code{tee} ä¸å¯ä»¥ç›´æ¥ä½¿ç”¨ @code{ARGV} å› ä¸º @command{awk} ä¼šå°è¯•å°† @code{ARGV} ä¸­çš„@value{FN}å½“æˆè¾“å…¥çš„æ•°æ®ã€‚

@cindex flag variables
å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ @option{-a}ï¼Œç„¶åæ ‡å¿—å˜é‡ @code{append} è¢«è®¾ç½®ä¸º trueï¼Œ@code{ARGV[1]} ä¸ @code{copy[1]} ä¸¤ä¸ªå…ƒç´ éƒ½è¢«åˆ é™¤ã€‚å¦‚æœ @code{ARGC} å°äº 2ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰æä¾›@value{FN}ï¼Œåˆ™ @code{tee} ä¼šæ‰“å°ä¸€ä¸ªä½¿ç”¨ä¿¡æ¯ç„¶åé€€å‡ºã€‚æœ€åï¼Œ@command{awk} è¢«å¼ºåˆ¶ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®ï¼Œåªè¦å°† @code{ARGV[1]} çš„å€¼è®¾ç½®ä¸º @code{"-"}ï¼ŒåŒæ—¶ @code{ARGC} è®¾ç½®ä¸º 2 ï¼š

@cindex @code{tee.awk} program
@example
@c file eg/prog/tee.awk
# tee.awk --- tee in awk
#
# Copy standard input to all named output files.
# Append content if -a option is supplied.
#
@c endfile
@ignore
@c file eg/prog/tee.awk
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
# Revised December 1995

@c endfile
@end ignore
@c file eg/prog/tee.awk
BEGIN @{
    for (i = 1; i < ARGC; i++)
        copy[i] = ARGV[i]

    if (ARGV[1] == "-a") @{
        append = 1
        delete ARGV[1]
        delete copy[1]
        ARGC--
    @}
    if (ARGC < 2) @{
        print "usage: tee [-a] file ..." > "/dev/stderr"
        exit 1
    @}
    ARGV[1] = "-"
    ARGC = 2
@}
@c endfile
@end example

ä¸‹é¢ç®€å•çš„è§„åˆ™æ‰§è¡Œæ‰€æœ‰çš„å·¥ä½œã€‚ç”±äºæ²¡æœ‰æ¨¡å¼ï¼Œæ‰€ä»¥å®ƒä¼šå¯¹æ¯ä¸€ä¸ªè¾“å…¥è¡Œéƒ½æ‰§è¡Œã€‚è§„åˆ™çš„æ‰§è¡Œä½“åªæ˜¯ç®€å•åœ°æ‰“å°è¡Œåˆ°æ¯ä¸ªå‘½ä»¤è¡Œä¸Šçš„æ–‡ä»¶ï¼Œç„¶åå†æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼š

@example
@c file eg/prog/tee.awk
@{
    # moving the if outside the loop makes it run faster
    if (append)
        for (i in copy)
            print >> copy[i]
    else
        for (i in copy)
            print > copy[i]
    print
@}
@c endfile
@end example

@noindent
ä¹Ÿå¯ä»¥è¿™ä¹ˆæ¥å†™å¾ªç¯ï¼š

@example
for (i in copy)
    if (append)
        print >> copy[i]
    else
        print > copy[i]
@end example

@noindent
è¿™æ ·æ›´ç²¾ç®€ï¼Œä½†æ˜¯å´æ²¡æœ‰è¿™ä¹ˆé«˜æ•ˆã€‚@samp{if} ä¼šå¯¹æ¯ä¸ªè®°å½•ä»¥åŠæ¯ä¸ªè¾“å‡ºæ–‡ä»¶éƒ½è¿›è¡Œæµ‹è¯•ã€‚é€šè¿‡å¤åˆ¶å¾ªç¯ä½“ï¼Œ@samp{if} å¯¹æ¯ä¸ªè¾“å…¥è®°å½•åªæ‰§è¡Œä¸€æ¬¡æµ‹è¯•ã€‚å¦‚æœæœ‰ @var{N} ä¸ªè¾“å…¥è®°å½•ï¼Œå¹¶ä¸”æœ‰ @var{M} ä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œç¬¬ä¸€ç§æ–¹æ³•åªæ‰§è¡Œ @var{N} ä¸ª @samp{if} è¯­å¥ï¼Œè€Œç¬¬äºŒç§æ–¹æ³•ä¼šæ‰§è¡Œ @var{N}@code{*}@var{M} ä¸ª @samp{if} è¯­å¥ã€‚

æœ€åï¼Œ@code{END} è§„åˆ™é€šè¿‡å…³é—­æ‰€æœ‰çš„è¾“å‡ºæ–‡ä»¶æ¥è¿›è¡Œæ¸…ç†ï¼š

@example
@c file eg/prog/tee.awk
END @{
    for (i in copy)
        close(copy[i])
@}
@c endfile
@end example

@node Uniq Program
@subsection æ‰“å°å»é‡æ–‡æœ¬è¡Œ

@c FIXME: One day, update to current POSIX version of uniq

@cindex printing, unduplicated lines of text
@cindex text@comma{} printing, unduplicated lines of
@cindex @command{uniq} utility
@command{uniq} å·¥å…·ä»å®ƒçš„æ ‡å‡†è¾“å…¥ä¸­è¯»å–ç»è¿‡æ’åºçš„è¡Œï¼Œå¹¶ä¸”é»˜è®¤åœ°ç§»é™¤é‡å¤çš„è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåªæ‰“å°å”¯ä¸€çš„è¡Œâ€”â€”å¦‚æ­¤åå­—æ‰€è¡¨ç¤ºçš„æ„æ€ã€‚@command{uniq} æœ‰å¾ˆå¤šçš„é€‰é¡¹ã€‚å…¶ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

@display
@command{uniq} [@option{-udc} [@code{-@var{n}}]] [@code{+@var{n}}] [@var{inputfile} [@var{outputfile}]]
@end display

@command{uniq} çš„é€‰é¡¹å¦‚ä¸‹ï¼š

@table @code
@item -d
åªæ‰“å°é‡å¤çš„ï¼ˆæœ‰å¤æœ¬ï¼‰çš„è¡Œã€‚

@item -u
åªæ‰“å°ä¸é‡å¤çš„ï¼ˆå”¯ä¸€çš„ï¼‰è¡Œã€‚

@item -c
ç»Ÿè®¡è¡Œã€‚è¿™ä¸ªé€‰é¡¹ä¼šè¦†ç›– @option{-d} ä¸ @option{-u}ã€‚é‡å¤çš„ä¸éé‡å¤çš„è¡Œéƒ½ä¼šè¢«ç»Ÿè®¡ã€‚

@item -@var{n}
åœ¨æ¯”è¾ƒè¡Œå‰è·³è¿‡ @var{n} ä¸ªåŸŸã€‚åŸŸçš„å®šä¹‰ä¸ @command{awk} çš„é»˜è®¤çš„ç±»ä¼¼ï¼šè¢«ä¸€è¿ç»­çš„ç©ºæ ¼ä¸/æˆ–è€… TABs åˆ†éš”çš„éç©ºç™½å­—ç¬¦ã€‚

@item +@var{n}
åœ¨æ¯”è¾ƒè¡Œå‰è·³è¿‡ @var{n} ä¸ªå­—ç¬¦ã€‚é€šè¿‡ @samp{-@var{n}} æŒ‡å®šçš„ä»»ä½•åŸŸä¼šé¦–å…ˆè¢«è·³è¿‡ã€‚

@item @var{inputfile}
æ•°æ®ä»åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–ï¼Œè€Œä¸æ˜¯ä»æ ‡å‡†è¾“å…¥è¯»å–ã€‚

@item @var{outputfile}
å°†äº§ç”Ÿçš„è¾“å‡ºå‘é€åˆ° @var{outputfile} å‘½åçš„æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯åˆ°æ ‡å‡†è¾“å‡ºä¸­ã€‚
@end table

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ@command{uniq} çš„è¡Œä¸ºå°±åƒ @option{-d} ä¸ @option{-u} ä¸¤ä¸ªé€‰é¡¹éƒ½æŒ‡å®šçš„ä¸€æ ·ã€‚

@command{uniq} ä½¿ç”¨ @code{getopt()} åº“å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Getopt Function}ï¼‰ä»¥åŠ @code{join()} åº“å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Join Function}ï¼‰ã€‚

ç¨‹åºä»¥ @code{usage()} å‡½æ•°å¼€å§‹ä»¥åŠä¸€äº›å†™åœ¨æ³¨é‡Šä¸­çš„ç®€å•çš„é€‰é¡¹åŠå…¶å«ä¹‰çš„è¯´æ˜ã€‚@code{BEGIN} è§„åˆ™å¤„å‘½ä»¤è¡Œå‚æ•°ä¸é€‰é¡¹ã€‚å®ƒä½¿ç”¨äº†ä¸€ä¸ªæŠ€å·§æ¥è®© @code{getopt()} å¤„ç†å¦‚ @samp{-25} è¿™ä¸ªçš„é€‰é¡¹ï¼Œå°†è¿™æ ·çš„é€‰é¡¹å½“åšæ˜¯å­—æ¯ @samp{2} çš„é€‰é¡¹ä¸å…¶å‚æ•° @samp{5}ã€‚å¦‚æœå®é™…ä¸Šæä¾›äº†ä¸¤ä¸ªæˆ–è€…å¤šä¸ªæ•°å­—ï¼ˆ@code{Optarg} çœ‹èµ·æ¥åƒä¸€ä¸ªæ•°å€¼ï¼‰ï¼Œ@code{Optarg} ä¼šä¸é€‰é¡¹æ•°å­—ä¸€è¿æ¥ï¼Œç„¶åç»“æœä¸ 0 ç›¸åŠ æ¥ä½¿å…¶è½¬æ¢ä¸ºæ•°å€¼ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªæ•°å€¼åœ¨é€‰é¡¹ä¸­ï¼Œ@code{Optarg} å°±ä¸éœ€è¦äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ@code{Optind} å¿…é¡»è¢«é€’å‡ï¼Œè¿™æ · @code{getopt()} ä¼šåœ¨ä¸‹ä¸€è½®ä¸­å¤„ç†å®ƒã€‚è¿™ä¸ªä»£ç ç¡®å®ç©äº†ä¸€ç‚¹èŠ±æ‹›ã€‚

å¦‚æœæ²¡æœ‰æä¾›é€‰é¡¹ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤çš„è¡Œä¸ºï¼Œå³æ‰“å°é‡å¤ä¸éé‡å¤çš„è¡Œã€‚å¦‚æœæä¾›äº†è¾“å‡ºæ–‡ä»¶ï¼Œå°†å…¶è¢«èµ‹å€¼ç»™ @code{outputfile}ã€‚åœ¨æ—©æœŸï¼Œ@code{outputfile} è¢«åˆå§‹åŒ–ä¸ºæ ‡å‡†è¾“å‡ºï¼Œå³ @file{/dev/stdout}ï¼š

@cindex @code{uniq.awk} program
@example
@c file eg/prog/uniq.awk
@group
# uniq.awk --- do uniq in awk
#
# Requires getopt() and join() library functions
@end group
@c endfile
@ignore
@c file eg/prog/uniq.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
@c endfile
@end ignore
@c file eg/prog/uniq.awk

function usage()
@{
    print("Usage: uniq [-udc [-n]] [+n] [ in [ out ]]") > "/dev/stderr"
    exit 1
@}

# -c    count lines. overrides -d and -u
# -d    only repeated lines
# -u    only nonrepeated lines
# -n    skip n fields
# +n    skip n characters, skip fields first

BEGIN @{
    count = 1
    outputfile = "/dev/stdout"
    opts = "udc0:1:2:3:4:5:6:7:8:9:"
    while ((c = getopt(ARGC, ARGV, opts)) != -1) @{
        if (c == "u")
            non_repeated_only++
        else if (c == "d")
            repeated_only++
        else if (c == "c")
            do_count++
        else if (index("0123456789", c) != 0) @{
            # getopt() requires args to options
            # this messes us up for things like -5
            if (Optarg ~ /^[[:digit:]]+$/)
                fcount = (c Optarg) + 0
            else @{
                fcount = c + 0
                Optind--
            @}
        @} else
            usage()
    @}

    if (ARGV[Optind] ~ /^\+[[:digit:]]+$/) @{
        charcount = substr(ARGV[Optind], 2) + 0
        Optind++
    @}

    for (i = 1; i < Optind; i++)
        ARGV[i] = ""

    if (repeated_only == 0 && non_repeated_only == 0)
        repeated_only = non_repeated_only = 1

    if (ARGC - Optind == 2) @{
        outputfile = ARGV[ARGC - 1]
        ARGV[ARGC - 1] = ""
    @}
@}
@c endfile
@end example

ä¸‹é¢çš„å‡½æ•° @code{are_equal()} ç”¨æ¥å°†å½“å‰è¡Œï¼Œ@code{$0}ï¼Œä¸å‰ä¸€è¡Œ @code{last} è¿›è¡Œæ¯”è¾ƒã€‚å®ƒå¤„ç†è¦è·³è¿‡çš„åŸŸä¸å­—ç¬¦ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šåŸŸç»Ÿè®¡ä»¥åŠå­—ç¬¦ç»Ÿè®¡ï¼Œ@code{are_equal()} è¿”å› 1ï¼Œæˆ–è€… 0ï¼Œè¿™ä¾èµ–äº @code{last} ä¸ @code{$0} å­—ä¸²çš„ç®€å•çš„æ¯”è¾ƒç»“æœã€‚

ä¸ç„¶çš„è¯ï¼Œäº‹æƒ…ä¼šå˜é‡æ›´åŠ å¤æ‚ã€‚å¦‚æœè¦è·³è¿‡åŸŸï¼Œæ¯ä¸€è¡Œéƒ½ä¼šç”¨ @code{split()}ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰æ‹†åˆ†æˆæ•°ç»„ï¼Œç•™ä¸‹æ¥çš„åŸŸç„¶åå†ç”¨ @code{join()} ç»„åˆæˆä¸€è¡Œã€‚è¢«ç»„åˆçš„è¡Œå­˜å› @code{clast} ä¸ @code{cline} ä¸­ã€‚å¦‚æœæ²¡æœ‰åŸŸè¦è·³è¿‡ï¼Œ@code{clast} ä¸ @code{cline} åˆ™è¢«è®¾ç½®æˆ @code{last} ä¸ @code{$0}ã€‚æœ€åï¼Œå¦‚æœæœ‰å­—ç¬¦è¦è·³è¿‡ï¼Œ@code{substr()} ç”¨äºæ¸…é™¤ @code{clast} ä¸ @code{cline} ä¸­å‰é¢ @code{count} ä¸ªçš„å­—ç¬¦ã€‚ä¸¤ä¸ªå­—ä¸²ç„¶åè¿›è¡Œæ¯”è¾ƒï¼Œ@code{are_equal()} è¿”å›æ¯”è¾ƒçš„ç»“æœï¼š

@example
@c file eg/prog/uniq.awk
function are_equal(    n, m, clast, cline, alast, aline)
@{
    if (fcount == 0 && charcount == 0)
        return (last == $0)

    if (fcount > 0) @{
        n = split(last, alast)
        m = split($0, aline)
        clast = join(alast, fcount+1, n)
        cline = join(aline, fcount+1, m)
    @} else @{
        clast = last
        cline = $0
    @}
    if (charcount) @{
        clast = substr(clast, charcount + 1)
        cline = substr(cline, charcount + 1)
    @}

    return (clast == cline)
@}
@c endfile
@end example

ä¸‹é¢çš„ä¸¤ä¸ªè§„åˆ™æ˜¯ç¨‹åºä½“ã€‚ç¬¬ä¸€ä¸ªåªç”¨åœ¨æ•°æ®çš„ç¬¬ä¸€è¡Œã€‚å®ƒå°† @code{last} è®¾ç½®ä¸º @code{$0}ï¼Œæ‰€ä»¥ï¼Œåç»­çš„è¡Œæ‰æœ‰å¯ä»¥æ¯”è¾ƒçš„ä¸œè¥¿ã€‚

ç¬¬äºŒä¸ªè§„åˆ™æ‰§è¡Œç›¸åº”çš„å·¥ä½œã€‚å˜é‡ @code{equal} ä¸º 1 æˆ–è€… 0ï¼Œåˆ™ä¾èµ–äº @code{are_equal()} çš„æ¯”è¾ƒç»“æœã€‚å¦‚æœ @command{uniq} æ­£åœ¨ç»Ÿè®¡é‡å¤çš„è¡Œï¼Œè€Œè¡Œæ˜¯ç›¸åŒçš„ï¼Œåˆ™å…¶ä¼šé€’å¢ @code{count} å˜é‡ã€‚å¦åˆ™ï¼Œå®ƒæ‰“å°è¡Œç„¶åé‡æ–°è®¾ç½® @code{count}ï¼Œå› ä¸ºä¸¤è¡Œå·²ç»ä¸ç›¸åŒäº†ã€‚

å¦‚æœ @command{uniq} ä¸åœ¨ç»Ÿè®¡ä¸­ï¼Œè€Œæ¯”è¾ƒç»“æœæ˜¯ç›¸åŒçš„ï¼Œ@code{count} åˆ™ä¼šè¢«é€’å¢ã€‚ä¸ä¼šæ‰“å°è¾“å‡ºè¡Œï¼Œå› ä¸ºè¦ç§»é™¤é‡å¤çš„è¡Œã€‚å¦åˆ™ï¼Œå¦‚æœ @command{uniq} æ­£åœ¨ç»Ÿè®¡é‡å¤çš„è¡Œï¼Œå¹¶ä¸”æœ‰çœ‹åˆ°äº†å¤šäºä¸€è¡Œç›¸åŒè¡Œï¼Œæˆ–è€…å¦‚æœ @command{uniq} åœ¨ç»Ÿè®¡éé‡å¤çš„è¡Œï¼Œåˆ™åªä¼šè§åˆ°ä¸€è¡Œï¼Œç„¶åè¯¥è¡Œä¼šè¢«æ‰“å°è¾“å‡ºï¼Œè€Œ @code{count} ä¼šè¢«é‡ç½®ã€‚

æœ€åï¼Œ@code{END} æ‰“å°è¾“å…¥æ•°æ®çš„æœ€åä¸€è¡Œçš„è§„åˆ™ä¹Ÿé‡‡ç”¨ç›¸ä¼¼çš„é€»è¾‘ï¼š

@example
@c file eg/prog/uniq.awk
NR == 1 @{
    last = $0
    next
@}

@{
    equal = are_equal()

    if (do_count) @{    # overrides -d and -u
        if (equal)
            count++
        else @{
            printf("%4d %s\n", count, last) > outputfile
            last = $0
            count = 1    # reset
        @}
        next
    @}

    if (equal)
        count++
    else @{
        if ((repeated_only && count > 1) ||
            (non_repeated_only && count == 1))
                print last > outputfile
        last = $0
        count = 1
    @}
@}

END @{
    if (do_count)
        printf("%4d %s\n", count, last) > outputfile
    else if ((repeated_only && count > 1) ||
            (non_repeated_only && count == 1))
        print last > outputfile
    close(outputfile)
@}
@c endfile
@end example

@c FIXME: Include this?
@ignore
This program does not follow our recommended convention of naming
global variables with a leading capital letter.  Doing that would
make the program a little easier to follow.
@end ignore

@ifset FOR_PRINT
The logic for choosing which lines to print represents a @dfn{state
machine}, which is ``a device that can be in one of a set number of stable
conditions depending on its previous condition and on the present values
of its inputs.''@footnote{This is the definition returned from entering
@code{define: state machine} into Google.}
Brian Kernighan suggests that
``an alternative approach to state machines is to just read
the input into an array, then use indexing.  It's almost always
easier code, and for most inputs where you would use this, just
as fast.''  Consider how to rewrite the logic to follow this
suggestion.
@end ifset



@node Wc Program
@subsection ç»Ÿè®¡

@c FIXME: One day, update to current POSIX version of wc

@cindex counting
@cindex input files, counting elements in
@cindex words, counting
@cindex characters, counting
@cindex lines, counting
@cindex @command{wc} utility
@command{wc}ï¼ˆword countï¼‰å·¥å…·ç”¨æ¥ç»Ÿè®¡ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶ä¸­çš„è¡Œï¼Œå­—ä¸å­—ç¬¦ã€‚å®ƒçš„ç”¨æ³•å¦‚ä¸‹ï¼š

@display
@command{wc} [@option{-lwc}] [@var{files} @dots{}]
@end display

å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æ²¡æœ‰æŒ‡å®šæ–‡ä»¶ï¼Œ@command{wc} åˆ™ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ã€‚å¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶ï¼Œåˆ™å®ƒä¼šæ‰“å°æ‰€æœ‰æ–‡ä»¶çš„æ€»çš„ç»Ÿè®¡ä¿¡æ¯ã€‚@command{wc} çš„é€‰é¡¹åŠå…¶æ„ä¹‰å¦‚ä¸‹ï¼š

@table @code
@item -l
åªç»Ÿè®¡è¡Œã€‚

@item -w
åªç»Ÿè®¡å•è¯ã€‚ä¸€ä¸ªâ€œå•è¯â€æ˜¯ä¸€ä¸ªè¿ç»­çš„éç©ºç™½å­—ç¬¦å­—ç¬¦åºåˆ—ï¼Œç›¸äº’ä¹‹é—´ä»¥ç©ºæ ¼ä¸/æˆ–è€… TABs æ¥åˆ†å‰²ã€‚å¹¸è¿çš„æ˜¯è¿™ä¹Ÿæ˜¯ @command{awk} å¯¹è¾“å…¥æ•°æ®è¿›è¡ŒåŸŸåˆ†å‰²çš„å¸¸è§„æ–¹å¼ã€‚

@item -c
åªç»Ÿè®¡å­—ç¬¦ã€‚
@end table

@command{awk} ä¸­çš„ @command{wc} å®ç°ç‰¹å®šä¼˜é›…ï¼Œå› ä¸º @command{awk} å·²ç»ä¸ºæˆ‘ä»¬åšäº†å¾ˆå¤šçš„äº‹æƒ…äº†ï¼Œ@command{awk} å°†è¡Œåˆ†å‰²æˆå•è¯ï¼ˆå³åŸŸï¼‰ç„¶åç»Ÿè®¡å®ƒä»¬ï¼Œä¹Ÿç»Ÿè®¡è¡Œï¼ˆå³è®°å½•ï¼‰ï¼Œå®ƒä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°å‘Šè¯‰æˆ‘ä»¬è¡Œçš„é•¿åº¦æ˜¯å¤šå°‘ã€‚

ç¨‹åºä½¿ç”¨åˆ° @code{getopt()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Getopt Function}ï¼‰ä»¥åŠæ–‡ä»¶è½¬æ¢å‡½æ•°
ï¼ˆæŸ¥çœ‹ @pxref{Filetrans Function}ï¼‰ã€‚

è¿™ä¸ªç‰ˆæœ¬ä¸ä¼ ç»Ÿçš„ @command{wc} ç‰ˆæœ¬æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ä¸åŒï¼šå®ƒæ€»æ˜¯æŒ‰è¡Œï¼Œå•è¯ï¼Œå­—ç¬¦è¿™æ ·çš„é¡ºåºæ¥æ‰“å°ç»Ÿè®¡ã€‚ä¼ ç»Ÿçš„ç‰ˆæœ¬ä¼šæ³¨æ„åˆ° @option{-l}ï¼Œ@option{-w}ï¼Œ@option{-c} é€‰é¡¹åœ¨å‘½ä»¤è¡Œä¸­çš„é¡ºåºï¼Œå¹¶ä»¥é€‰é¡¹çš„é¡ºåºæ¥æ‰“å°ç»Ÿè®¡ã€‚

@code{BEGIN} è§„åˆ™ä½œå‚æ•°å¤„ç†ã€‚å˜é‡ @code{print_total} åœ¨å‘½ä»¤è¡Œä¸­æœ‰å¤šäºä¸€ä¸ªæ–‡ä»¶çš„æƒ…å†µä¸‹ä¸º trueï¼š

@cindex @code{wc.awk} program
@example
@c file eg/prog/wc.awk
# wc.awk --- count lines, words, characters
@c endfile
@ignore
@c file eg/prog/wc.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
@c endfile
@end ignore
@c file eg/prog/wc.awk

# Options:
#    -l    only count lines
#    -w    only count words
#    -c    only count characters
#
# Default is to count lines, words, characters
#
# Requires getopt() and file transition library functions

BEGIN @{
    # let getopt() print a message about
    # invalid options. we ignore them
    while ((c = getopt(ARGC, ARGV, "lwc")) != -1) @{
        if (c == "l")
            do_lines = 1
        else if (c == "w")
            do_words = 1
        else if (c == "c")
            do_chars = 1
    @}
    for (i = 1; i < Optind; i++)
        ARGV[i] = ""

    # if no options, do all
    if (! do_lines && ! do_words && ! do_chars)
        do_lines = do_words = do_chars = 1

    print_total = (ARGC - i > 1)
@}
@c endfile
@end example

@code{beginfile()} å‡½æ•°å¾ˆç®€å•ï¼Œå®ƒä»…æ˜¯æŠŠè¡Œæ•°ï¼Œå•è¯æ•°ä¸å­—ç¬¦æ•°è®¾ç½®ä¸º 0ï¼Œå¹¶å°†å½“å‰çš„@value{FN}å­˜åœ¨ @code{fname} ä¸­ï¼š

@example
@c file eg/prog/wc.awk
function beginfile(file)
@{
    lines = words = chars = 0
    fname = FILENAME
@}
@c endfile
@end example

@code{endfile()} å‡½æ•°å°†å½“å‰æ–‡ä»¶çš„æ•°å€¼åŠ åˆ°æ€»çš„è¡Œï¼Œå•è¯ä¸å­—ç¬¦æ•°ä¸Šã€‚ç„¶åä¸ºåˆšæ‰æ‰€è¯»å–çš„æ–‡ä»¶æ‰“å°ç›¸åº”çš„æ•°å€¼ã€‚å®ƒä¾èµ–äº @code{beginfile()} æ¥é‡ç½®åé¢çš„@value{DF}çš„æ•°å€¼ï¼š

@example
@c file eg/prog/wc.awk
function endfile(file)
@{
    tlines += lines
    twords += words
    tchars += chars
    if (do_lines)
        printf "\t%d", lines
@group
    if (do_words)
        printf "\t%d", words
@end group
    if (do_chars)
        printf "\t%d", chars
    printf "\t%s\n", fname
@}
@c endfile
@end example

æœ‰ä¸€ä¸ªå¯¹æ¯ä¸ªè¡Œéƒ½æ‰§è¡Œçš„è§„åˆ™ã€‚åœ¨é‡Œé¢ä¼šå¯¹è®°å½•çš„é•¿åº¦åŠ åˆ° @code{chars} ä¸Šï¼Œå†åŠ ä¸Š 1ã€‚
@footnote{ç”±äº @command{gawk} å¯ä»¥å¤„ç†å¤šå­—èŠ‚çš„æœ¬åœ°è¯­è¨€è®¾ç½®ï¼Œæ‰€ä»¥è¿™ä¸ªä»£ç ç»Ÿè®¡çš„æ˜¯å­—ç¬¦ï¼Œè€Œä¸æ˜¯å­—èŠ‚ã€‚}
å°†è®°å½•çš„é•¿åº¦åŠ  1 æ˜¯å› ä¸ºæ¢è¡Œç¬¦ç”¨æ¥åˆ†å‰²è®°å½•ï¼ˆå³ @code{RS} çš„å€¼ï¼‰ä½†å®ƒåˆä¸æ˜¯è®°å½•çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ä¸åŒ…å«åœ¨é•¿åº¦é‡Œã€‚åé¢ï¼Œå¯¹æ¯ä¸€è¡Œè¯»å–æ—¶ @code{lines} ä¼šé€’å¢ï¼Œè€Œ @code{words} ä¼šé€’å¢ @code{NF} çš„å€¼ï¼Œè€Œå®ƒçš„å€¼å°±æ˜¯æœ¬æ¡è¡Œä¸­â€œå•è¯â€çš„ä¸ªæ•°ï¼š

@example
@c file eg/prog/wc.awk
# do per line
@{
    chars += length($0) + 1    # get newline
    lines++
    words += NF
@}
@c endfile
@end example

æœ€åï¼Œ@code{END} è§„åˆ™ç®€å•åœ°é“ºæ‰€æœ‰æ–‡ä»¶çš„æ€»åˆï¼š

@example
@c file eg/prog/wc.awk
END @{
    if (print_total) @{
        if (do_lines)
            printf "\t%d", tlines
        if (do_words)
            printf "\t%d", twords
        if (do_chars)
            printf "\t%d", tchars
        print "\ttotal"
    @}
@}
@c endfile
@end example

@node Miscellaneous Programs
@section @command{awk} ç¨‹åºçš„å¤§é›†åˆ

è¿™ä¸€@value{SECTION}ä¸­æ˜¯ä¸€ä¸ªä¸åŒç¨‹åºçš„â€œå¤§é›†åˆâ€ã€‚æˆ‘ä»¬å¸Œæœ›ä½ ä¼šè§‰å¾—ä»–ä»¬å³æœ‰è¶£ä¹Ÿå¾ˆå¥½ç©ã€‚

@menu
* Dupword Program::             Finding duplicated words in a document.
* Alarm Program::               An alarm clock.
* Translate Program::           A program similar to the @command{tr} utility.
* Labels Program::              Printing mailing labels.
* Word Sorting::                A program to produce a word usage count.
* History Sorting::             Eliminating duplicate entries from a history
                                file.
* Extract Program::             Pulling out programs from Texinfo source
                                files.
* Simple Sed::                  A Simple Stream Editor.
* Igawk Program::               A wrapper for @command{awk} that includes
                                files.
* Anagram Program::             Finding anagrams from a dictionary.
* Signature Program::           People do amazing things with too much time on
                                their hands.
@end menu

@node Dupword Program
@subsection æŸ¥æ‰¾æ–‡æ¡£ä¸­çš„é‡å¤å­—

@cindex words, duplicate@comma{} searching for
@cindex searching, for words
@cindex documents@comma{} searching
åœ¨å†™å¤§é‡çš„å•è°ƒæ–‡ç« çš„å¸¸è§é”™è¯¯å°±æ˜¯ä¼šå¶ç„¶è¾“å…¥é‡å¤çš„è¯ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä½ ä¼šçœ‹åˆ°ä¼¼ä¸‹é¢çš„ä¸œè¥¿â€œthe the program does the following@dots{}â€ã€‚å½“æ–‡ä»¶æ˜¯åœ¨çº¿çš„æ—¶å€™ï¼Œé‡å¤çš„è¯å¸¸å¸¸å‡ºç°åœ¨ä¸€è¡Œçš„å°¾éƒ¨ä»¥åŠå¦ä¸€è¡Œçš„è¡Œé¦–ï¼Œå› æ­¤å¾ˆéš¾è¿›è¡Œå®šä½ã€‚
A common error when writing large amounts of prose is to accidentally
duplicate words.  Typically you will see this in text as something like ``the
the program does the following@dots{}''  When the text is online, often
the duplicated words occur at the end of one line and the
@c as here!

@file{dupword.awk} è¿™ä¸ªç¨‹åºä¼šæ‰«ææ•´ä¸ªæ–‡ä»¶ï¼Œä¸€æ¬¡ä¸€è¡Œï¼Œå¹¶æŸ¥æ‰¾åŒä¸€ä¸ªå­—ç¬¦çš„çš„è¿ç»­å‡ºç°ã€‚å®ƒåŒæ—¶ä¹Ÿä¿å­˜ä¸€è¡Œä¸­çš„æœ€åä¸€ä¸ªå•è¯ï¼ˆæ”¾åœ¨å˜é‡ @code{prev} ä¸­ï¼‰ï¼Œç”¨äºä¸ä¸‹ä¸€ä¸ªå•è¯çš„ç¬¬ä¸€ä¸ªå•è¯è¿›è¡Œæ¯”è¾ƒã€‚

@cindex Texinfo
å¤´ä¸¤ä¸ªè¯­å¥è¦ç¡®ä¿è¡Œå…¨æ˜¯å°å†™çš„ï¼Œæ‰€ä»¥ï¼Œåƒâ€œTheâ€ä¸â€œtheâ€å¯ä»¥ç›¸äº’è¿›è¡Œæ¯”è¾ƒã€‚ä¸‹ä¸€æ¡è¯­å¥ä¼šæ›¿æ¢éå­—æ¯æ•°å­—ä¸éç©ºæ ¼å­—ç¬¦ä¸ºç©ºæ ¼ï¼Œæ‰€ä»¥æ ‡ç‚¹ç¬¦å·ä¹Ÿä¸ä¼šå½±å“æ¯”è¾ƒã€‚ç”¨ç©ºæ ¼æ›¿æ¢å­—ç¬¦è¿™æ ·æ ¼å¼æ§åˆ¶å­—ç¬¦ä¸ä¼šåˆ›å»ºä¸€äº›æ²¡æœ‰æ„ä¹‰çš„å•è¯ï¼ˆå¦‚ Texinfo ä¸­çš„ @samp{@@code@{NF@}} åœ¨ç®€å•åœ°åˆ é™¤æ ‡ç‚¹çš„æƒ…å†µä¸‹ä¼šå˜æˆ @samp{codeNF}ï¼‰ã€‚è®°å½•ç„¶åä¼šè¢«åˆ†å‰²ä¸ºåŸŸï¼Œäº§ç”Ÿäº†ä¸€è¡Œä¸­çš„å®é™…å•è¯ï¼Œå¹¶ä¸”ä¿è¯ä¸ä¼šæœ‰ç©ºçš„åŸŸã€‚

å¦‚æœåœ¨ç§»é™¤äº†æ‰€æœ‰çš„æ ‡ç‚¹åæ²¡æœ‰åŸŸï¼Œåˆ™å½“å‰çš„è®°å½•ä¼šè¢«è·³è¿‡ã€‚å¦åˆ™ç¨‹åºä¼šè¿­ä»£æ¯ä¸€ä¸ªå•è¯ï¼Œå¹¶ä¸”å…¶å‰ä¸€ä¸ªå•è¯è¿›è¡Œæ¯”è¾ƒï¼š

@cindex @code{dupword.awk} program
@example
@c file eg/prog/dupword.awk
# dupword.awk --- find duplicate words in text
@c endfile
@ignore
@c file eg/prog/dupword.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# December 1991
# Revised October 2000

@c endfile
@end ignore
@c file eg/prog/dupword.awk
@{
    $0 = tolower($0)
    gsub(/[^[:alnum:][:blank:]]/, " ");
    $0 = $0         # re-split
    if (NF == 0)
        next
    if ($1 == prev)
        printf("%s:%d: duplicate %s\n",
            FILENAME, FNR, $1)
    for (i = 2; i <= NF; i++)
        if ($i == $(i-1))
            printf("%s:%d: duplicate %s\n",
                FILENAME, FNR, $i)
    prev = $NF
@}
@c endfile
@end example

@node Alarm Program
@subsection æŠ¥è­¦æ—¶é’Ÿç¨‹åº
@cindex insomnia, cure for
@cindex Robbins, Arnold
@quotation
@i{
æ²¡æœ‰ä»€ä¹ˆåƒé—¹é’Ÿä¸€æ ·å¯ä»¥æ²»æ„ˆå¤±çœ ã€‚
}
@author Arnold Robbins
@end quotation
@cindex Quanstrom, Erik
@ignore
Date: Sat, 15 Feb 2014 16:47:09 -0500
Subject: Re: 9atom install question
Message-ID: <l2jcvx6j6mey60xnrkb0hhob.1392500829294@email.android.com>
From: Erik Quanstrom <quanstro@quanstro.net>
To: Aharon Robbins <arnold@skeeve.com>

yes.

- erik

Aharon Robbins <arnold@skeeve.com> wrote:

>> sleep is for web developers.
>
>Can I quote you, in the gawk manual?
>
>Thanks,
>
>Arnold
@end ignore
@quotation
@i{
ç¡çœ æ˜¯ç»™ Web å¼€å‘è€…çš„ã€‚
}
@author Erik Quanstrom
@end quotation

@cindex time, alarm clock example program
@cindex alarm clock example program
ä¸‹é¢çš„ç¨‹åºæ˜¯ä¸€ä¸ªç®€å•çš„â€œé—¹é’Ÿâ€ç¨‹åºã€‚ä½ ç»™å®ƒä¸€ä¸ªæ—¶é—´ä»¥åŠä¸€ä¸ªå¯é€‰çš„æ¶ˆæ¯ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´ä¸Šï¼Œå®ƒä¼šæ‰“å°æ¶ˆæ¯åˆ°æ ‡å‡†è¾“å‡ºä¸Šã€‚å¦å¤–ï¼Œä½ å¯ä»¥ç»™å®ƒä¸€ä¸ªæ¶ˆæ¯é‡å¤çš„èµ„æ–™ï¼Œä»¥åŠé‡å¤ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ã€‚

è¿™ä¸ªç¨‹åºä½¿ç”¨ @code{getlocaltime()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{Getlocaltime Function}ï¼‰ã€‚

åœ¨ @code{BEGIN} è§„åˆ™ä¸­å®Œæˆæ‰€æœ‰çš„å·¥ä½œã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯å‚æ•°æ£€æŸ¥ï¼Œå¹¶è®¾ç½®é»˜è®¤å€¼ï¼šdelayï¼Œcountï¼Œä»¥åŠè¦æ‰“å°çš„ messageã€‚å¦‚æœç”¨æˆ·æä¾›äº†ä¸€ä¸ªä¸å¸¦ ASCII BEL å­—ç¬¦çš„æ¶ˆæ¯ï¼ˆä¸ºâ€œalertâ€å­—ç¬¦ï¼Œ@code{\a}ï¼‰ï¼Œç„¶åå®ƒä¼šè¢«åŠ åˆ° message ä¸­ã€‚ï¼ˆåœ¨å¾ˆå¤šçš„ç³»ç»Ÿä¸­ï¼Œæ‰“å° ASCII BEL ä¼šäº§ç”Ÿä¸€ä¸ªå¯ä»¥å¬å¾—åˆ°çš„æŠ¥è­¦å—ã€‚æ‰€ä»¥ï¼Œ å½“æŠ¥è­¦æ¶ˆé™¤æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨ç”¨æˆ·æ²¡æœ‰çœ‹ç”µè„‘æ—¶æ¥å”¤èµ·å…¶æ³¨æ„ã€‚ï¼‰åªæ˜¯ä¸ºäº†åšä¸€äº›æ”¹å˜ï¼Œè¿™ä¸ªç¨‹åºä½¿ç”¨ @code{switch} è¯­å¥ï¼ˆæŸ¥çœ‹ @pxref{Switch Statement}ï¼‰ï¼Œä½†æ˜¯å¤„ç†ä¹Ÿå¯ä»¥ç”¨ä¸€ç³»åˆ—çš„ @code{if}-@code{else} è¯­å¥æ¥å®Œæˆã€‚ä¸‹é¢æ˜¯ç¨‹åºï¼š

@cindex @code{alarm.awk} program
@example
@c file eg/prog/alarm.awk
# alarm.awk --- set an alarm
#
# Requires getlocaltime() library function
@c endfile
@ignore
@c file eg/prog/alarm.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
# Revised December 2010

@c endfile
@end ignore
@c file eg/prog/alarm.awk
# usage: alarm time [ "message" [ count [ delay ] ] ]

BEGIN @{
    # Initial argument sanity checking
    usage1 = "usage: alarm time ['message' [count [delay]]]"
    usage2 = sprintf("\t(%s) time ::= hh:mm", ARGV[1])

    if (ARGC < 2) @{
        print usage1 > "/dev/stderr"
        print usage2 > "/dev/stderr"
        exit 1
    @}
    switch (ARGC) @{
    case 5:
        delay = ARGV[4] + 0
        # fall through
    case 4:
        count = ARGV[3] + 0
        # fall through
    case 3:
        message = ARGV[2]
        break
    default:
        if (ARGV[1] !~ /[[:digit:]]?[[:digit:]]:[[:digit:]]@{2@}/) @{
            print usage1 > "/dev/stderr"
            print usage2 > "/dev/stderr"
            exit 1
        @}
        break
    @}

    # set defaults for once we reach the desired time
    if (delay == 0)
        delay = 180    # 3 minutes
@group
    if (count == 0)
        count = 5
@end group
    if (message == "")
        message = sprintf("\aIt is now %s!\a", ARGV[1])
    else if (index(message, "\a") == 0)
        message = "\a" message "\a"
@c endfile
@end example

ä»£ç çš„ä¸‹ä¸€@value{SECTION}ä¼šå°†æŠ¥è­¦æ—¶é—´è½¬æ¢ä¸ºå°æ—¶åˆ†é’Ÿï¼Œå¹¶è½¬æ¢ï¼ˆå¦‚æœæœ‰å¿…è¦çš„è¯ï¼‰ä¸ºä¸€ä¸ª 24 å°æ—¶åˆ¶çš„æ—¶é—´ï¼Œç„¶åå°†æ—¶é—´è½¬æ¢ä¸ºä»åˆå¤œä»¥æ¥çš„ç§’æ•°ã€‚åé¢å®ƒä¼šå°†å½“å‰çš„æ—¶å€™è½¬æ¢ä¸ºä»åˆå¤œä»¥æ¥çš„ç§’æ•°ã€‚ä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„å·®å°±æ˜¯è¦è®¾ç½®æŠ¥è­¦è¦ç­‰å¾…çš„æ—¶é—´ï¼š

@example
@c file eg/prog/alarm.awk
    # split up alarm time
    split(ARGV[1], atime, ":")
    hour = atime[1] + 0    # force numeric
    minute = atime[2] + 0  # force numeric

    # get current broken down time
    getlocaltime(now)

    # if time given is 12-hour hours and it's after that
    # hour, e.g., `alarm 5:30' at 9 a.m. means 5:30 p.m.,
    # then add 12 to real hour
    if (hour < 12 && now["hour"] > hour)
        hour += 12

    # set target time in seconds since midnight
    target = (hour * 60 * 60) + (minute * 60)

    # get current time in seconds since midnight
    current = (now["hour"] * 60 * 60) + \
               (now["minute"] * 60) + now["second"]

    # how long to sleep for
    naptime = target - current
    if (naptime <= 0) @{
        print "alarm: time is in the past!" > "/dev/stderr"
        exit 1
    @}
@c endfile
@end example

@cindex @command{sleep} utility
æœ€åï¼Œç¨‹åºä½¿ç”¨ @code{system()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{I/O Functions}ï¼‰æ¥è°ƒç”¨ @command{sleep} å·¥å…·ã€‚@command{sleep} å·¥å…·ä¼šæš‚åœç»™å®šçš„ç§’æ•°ã€‚å¦‚æœå…¶é€€å‡ºæ—¶é—´ä¸æ˜¯ 0ï¼Œè€Œç¨‹åºä¼šå‡è®¾ä¼‘çœ ä¸­æ–­å¹¶é€€å‡ºã€‚å¦‚æœ @command{sleep} é€€å‡ºï¼Œé€€å‡ºä»£ç ä¸º 0ï¼Œåˆ™ç¨‹åºä¼šåœ¨å¾ªç¯ä¸­æ‰“å°æ¶ˆæ¯ï¼Œç„¶åå†é€šè¿‡ @command{sleep} æ¥è¿Ÿå»¶ä¸ç®¡å¤šå°‘å¿…è¦çš„ç§’æ—¶é—´ï¼š

@example
@c file eg/prog/alarm.awk
    # zzzzzz..... go away if interrupted
    if (system(sprintf("sleep %d", naptime)) != 0)
        exit 1

    # time to notify!
    command = sprintf("sleep %d", delay)
    for (i = 1; i <= count; i++) @{
        print message
        # if sleep command interrupted, go away
        if (system(command) != 0)
            break
    @}

    exit 0
@}
@c endfile
@end example

@node Translate Program
@subsection è½¬æ¢å­—ç¬¦

@cindex characters, transliterating
@cindex @command{tr} utility
ç³»ç»Ÿçš„ @command{tr} å·¥å…·ç”¨æ¥è¿›è¡Œå­—ç¬¦çš„ä¸€å¯¹ä¸€è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œç”¨æ¥å°†å¤§å†™å­—æ¯è½¬æ¢ä¸ºå°å†™å­—æ¯ä»¥ä¾¿è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼š

@example
@var{generate data} | tr 'A-Z' 'a-z' | @var{process data} @dots{}
@end example

@command{tr} éœ€è¦ä¸¤ä¸ªå­—ç¬¦åˆ—è¡¨ã€‚ 
@footnote{åœ¨ä¸€äº›æ—§çš„ç³»ç»Ÿä¸Šï¼ŒåŒ…æ‹¬ Solarisï¼Œ@command{tr} çš„ç³»ç»Ÿç‰ˆæœ¬å¯èƒ½éœ€è¦åˆ—è¡¨è¦å†™åœ¨èŒƒå›´è¡¨è¾¾å¼ï¼Œå¹¶åŒ…å«åœ¨æ–¹æ‹¬å·ä¸­ï¼ˆ@samp{[a-z]}ï¼‰ï¼Œå¼•èµ·æ¥ï¼Œä¸ºçš„æ˜¯é¿å… Shell ä¼šå°è¯•å¯¹@value{FN}æ‰©å±•ã€‚ä½†è¿™ä¸æ˜¯ä¸ªç‰¹æ€§ã€‚}
å½“å¤„ç†è¾“å…¥æ—¶ï¼Œåœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¼šè¢«ç¬¬äºŒä¸ªåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ›¿æ¢ï¼Œè€Œç¬¬ä¸€ä¸ªå­—ç¬¦åˆ—è¡¨ä¸­çš„ç¬¬äºŒä¸ªå­—ç¬¦ä¼šè¢«ç¬¬äºŒä¸ªå­—ç¬¦åˆ—è¡¨ä¸­çš„ç¬¬äºŒä¸ªå­—ç¬¦æ›¿æ¢ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœåœ¨â€œfromâ€åˆ—è¡¨ä¸­æœ‰æ¯”â€œtoâ€åˆ—è¡¨ä¸­æ›´å¤šçš„å­—ç¬¦ï¼Œåˆ™åœ¨â€œtoâ€ä¸­çš„æœ€åçš„å­—ç¬¦ç”¨æ¥æ›¿æ¢åœ¨â€œfromâ€åˆ—è¡¨ä¸­çš„å…¶ä»–å­—ç¬¦ã€‚

ä»¥å‰ï¼Œ
@c early or mid-1989!
æœ‰ç”¨æˆ·å»ºè®®åœ¨ @command{gawk} ä¸­åŠ å…¥å­—ç¬¦è½¬æ¢å‡½æ•°ã€‚
@c Wishing to avoid gratuitous new features,
@c at least theoretically
ä¸‹é¢çš„ç¨‹åºå¯ä»¥è¯æ˜ç”¨æˆ·å±‚çš„å‡½æ•°ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°å­—ç¬¦çš„è½¬æ¢åŠŸèƒ½ã€‚è¿™ä¸ªç¨‹åºæ²¡æœ‰ @command{tr} å·¥å…·é‚£ä¹ˆå®Œæ•´ï¼Œä½†æ˜¯å¯ä»¥åšå¤§éƒ¨ä»½çš„äº‹æƒ…ã€‚

è½¬æ¢ç¨‹åº @command{translate} æ˜¯åœ¨ @command{gawk} å–å¾—å¯¹æ¯ä¸ªå­—ä¸²ä¸­çš„å­—ç¬¦è¿›è¡Œåˆ†å‰²åˆ°æ•°ç»„ä¸­çš„èƒ½åŠ›å¾ˆä¹…ä¹‹å‰å†™çš„ã€‚æ‰€ä»¥ï¼Œå®ƒé‡å¤åœ°ä½¿ç”¨ @code{substr()}ï¼Œ@code{index()} ä¸ @code{gsub()} ç­‰å†…ç½®å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚ä¸‹é¢æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‡½æ•° @code{stranslate()}ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼š

@table @code
@item from
è¦è½¬æ¢çš„å­—ç¬¦åˆ—è¡¨ã€‚

@item to
è¦è½¬æ¢æˆçš„å­—ç¬¦åˆ—è¡¨ã€‚

@item target
è¦æ‰§è¡Œè½¬æ¢çš„å­—ä¸²ã€‚
@end table

å…³è”æ•°ç»„ä½¿å¾—è½¬æ¢éƒ¨åˆ†éå¸¸å®¹æ˜“ã€‚@code{t_ar} ä¿å­˜â€œtoâ€çš„å­—ç¬¦ï¼Œå¹¶ç”¨â€œfromâ€çš„å­—ç¬¦ä½œä¸ºç´¢å¼•ã€‚ç„¶åä¸€ä¸ªç®€å•çš„å¾ªç¯æ¥å¾ªç¯ @code{from} å­—ç¬¦ï¼Œä¸€æ¬¡ä¸€ä¸ªå­—ç¬¦ã€‚å¯¹åœ¨ @code{from} ä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼Œå¦‚æœå­—ç¬¦å‡ºç°åœ¨ @code{target} ä¸­ï¼Œåˆ™å®ƒè¢«æ›¿æ¢ä¸º @code{to} ä¸­çš„ç›¸åº”å­—ç¬¦ã€‚

@code{translate()} å‡½æ•°è°ƒç”¨ @code{stranslate()}ï¼Œå¹¶å°† @code{$0} ä½œä¸º @code{target} å‚æ•°ã€‚ä¸»ç¨‹åºç”¨æ¥è‡ªç”±å‘½ä»¤è¡Œçš„å€¼è®¾ç½®ä¸¤ä¸ªå…¨å±€å˜é‡ï¼Œ@code{FROM} ä¸ @code{TO}ï¼Œç„¶åå°† @code{ARGV} æ›´æ”¹ä¸º @command{awk} ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ã€‚

æœ€åï¼Œå¤„ç†è§„åˆ™åªæ˜¯ç®€å•åœ°è°ƒç”¨ @code{translate()} æ¥å¤„ç†æ¯ä¸€æ¡è®°å½•ï¼š

@cindex @code{translate.awk} program
@example
@c file eg/prog/translate.awk
# translate.awk --- do tr-like stuff
@c endfile
@ignore
@c file eg/prog/translate.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# August 1989
# February 2009 - bug fix

@c endfile
@end ignore
@c file eg/prog/translate.awk
# Bugs: does not handle things like tr A-Z a-z; it has
# to be spelled out. However, if `to' is shorter than `from',
# the last character in `to' is used for the rest of `from'.

function stranslate(from, to, target,     lf, lt, ltarget, t_ar, i, c,
                                                               result)
@{
    lf = length(from)
    lt = length(to)
    ltarget = length(target)
    for (i = 1; i <= lt; i++)
        t_ar[substr(from, i, 1)] = substr(to, i, 1)
    if (lt < lf)
        for (; i <= lf; i++)
            t_ar[substr(from, i, 1)] = substr(to, lt, 1)
    for (i = 1; i <= ltarget; i++) @{
        c = substr(target, i, 1)
        if (c in t_ar)
            c = t_ar[c]
        result = result c
    @}
    return result
@}

function translate(from, to)
@{
    return $0 = stranslate(from, to, $0)
@}

# main program
BEGIN @{
@group
    if (ARGC < 3) @{
        print "usage: translate from to" > "/dev/stderr"
        exit
    @}
@end group
    FROM = ARGV[1]
    TO = ARGV[2]
    ARGC = 2
    ARGV[1] = "-"
@}

@{
    translate(FROM, TO)
    print
@}
@c endfile
@end example

æœ‰å¯èƒ½åœ¨ç”¨æˆ·å±‚çš„å‡½æ•°ä¸­æ¥æ‰§è¡Œå­—ç¬¦è½¬æ¢ï¼Œä½†æ˜¯æ²¡æœ‰è¿™ä¹ˆé«˜æ•ˆï¼Œæˆ‘ä»¬ï¼ˆå³ @command{gawk} çš„å¼€å‘è€…ï¼‰å¼€å§‹è€ƒè™‘æ·»åŠ ä¸€ä¸ªå†…ç½®çš„å‡½æ•°ã€‚ä½†æ˜¯ï¼Œåœ¨å®Œæˆè¿™ä¸ªç¨‹åºä¹‹åä¸ä¹…ï¼Œæˆ‘ä»¬äº†è§£åˆ° Brian Kernighan å·²ç»åŠ å…¥äº† @code{toupper()} ä¸ @code{tolower()} å‡½æ•°åˆ°å®ƒçš„ @command{gawk} ä¸­ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚è¿™äº›å‡½æ•°å¤„ç†å¤„ç†äº†å¤§é‡çš„æ‰€éœ€è¦çš„å­—ç¬¦è½¬æ¢çš„ä¸»è¦éƒ¨åˆ†ï¼Œå› æ­¤æˆ‘ä»¬åªå¥½é€‰æ‹©æ¥ç®€å•åœ°å°†è¿™äº›å‡½æ•°åŠ åˆ° @command{gawk}ï¼Œå¹¶ä¿è¯å®ƒä»¬è¶³å¤Ÿç‹¬ç«‹ã€‚

å¯¹è¿™ä¸ªç¨‹åºçš„æ˜æ˜¾æå‡å°±æ˜¯åœ¨ @code{BEGIN} è§„åˆ™ä¸­ä»…è®¾ç½® @code{t_ar} æ•°ç»„ä¸€æ¬¡ã€‚ä½†æ˜¯ï¼Œè¿™å‡è®¾â€œfromâ€ä¸â€œtoâ€çš„åˆ—è¡¨åœ¨ç¨‹åºçš„ç”Ÿå‘½æœŸå†…ä¸ä¼šæ”¹å˜ã€‚

å¦ä¸€ä¸ªæ˜æ˜¾çš„æ”¹è¿›ï¼Œå°±æ˜¯å…è®¸ä½¿ç”¨ @command{tr} å·¥å…·æ‰€ä½¿ç”¨çš„èŒƒå›´ï¼Œå¦‚ @samp{a-z}ã€‚æŸ¥çœ‹ @file{cut.awk}ï¼ˆæŸ¥çœ‹ @pxref{Cut Program}ï¼‰ä»£ç æ¥æŸ¥çœ‹å…¶ä¸­çš„çµæ„Ÿã€‚


@node Labels Program
@subsection æ‰“å°é‚®ä»¶æ ‡é¢˜

@cindex printing, mailing labels
@cindex mailing labels@comma{} printing
è¿™é‡Œæ˜¯ä¸€ä¸ªâ€œçœŸå®ä¸–ç•Œâ€ ä¸­çš„ç¨‹åºã€‚
@footnote{â€œçœŸå®ä¸–ç•Œâ€å®šä¹‰ä¸ºâ€œå°±æ˜¯å®é™…ä¸Šç”¨æ¥å¤„ç†æŸäº›äº‹æƒ…çš„ç¨‹åºâ€ã€‚}
è¿™ä¸ªè„šæœ¬è¯»å–åå­—ä¸åœ°å€åˆ—è¡¨ï¼Œç„¶åäº§ç”Ÿé‚®ä»¶æ ‡ç­¾ã€‚æ ‡ç­¾çš„æ¯ä¸€é¡µæœ‰ 20 ä¸ªæ ‡ç­¾åœ¨é‡Œå¤´ï¼Œ2 è¡Œ 10 åˆ—ã€‚åœ°å€ä¿è¯å¤šäº 5 è¡Œã€‚æ¯ä¸€ä¸ªåœ°æ–¹éƒ½é€šè¿‡ä¸€ä¸ªç©ºè¡Œä¸ä¸‹ä¸€ä¸ªåœ°æ–¹è¿›è¡Œåˆ†éš”ã€‚

åŸºæœ¬çš„æƒ³æ³•æ˜¯è¯»å– 20 ä¸ªæ ‡ç­¾çš„æ•°æ®ã€‚æ¯ä¸ªæ ‡ç­¾çš„æ¯ä¸€è¡Œéƒ½å­˜åœ¨ @code{line} æ•°ç»„ä¸­ã€‚ä¸€ä¸ªå•ç‹¬çš„è§„åˆ™æ¥å¤„ç†å¡«å…… @code{line} æ•°ç»„ï¼Œå¹¶åœ¨è¯»åˆ° 20 ä¸ªæ ‡ç­¾çš„æ—¶å€™æ‰“å°é¡µã€‚

@code{BEGIN} è§„åˆ™ç®€å•åœ°å°† @code{RS} è®¾ç½®æˆç©ºä¸²ï¼Œå› æ­¤ @command{awk} ä¼šå°†è®°å½•ä»¥ç©ºè¡Œåˆ†å‰²ï¼ˆæŸ¥çœ‹ @pxref{Records}ï¼‰ã€‚ç„¶åå°† @code{MAXLINES} è®¾ç½®ä¸º 100ï¼Œå› æ­¤ 100 æ˜¯åœ¨é¡µä¸­çš„æœ€å¤§è¡Œæ•°
@iftex
ï¼ˆ@math{20 @cdot 5 = 100}ï¼‰ã€‚
@end iftex
@ifnottex
@ifnotdocbook
ï¼ˆ20 * 5 = 100ï¼‰ã€‚
@end ifnotdocbook
@end ifnottex
@docbook
ï¼ˆ20 &sdot; 5 = 100ï¼‰ã€‚
@end docbook

å¤§å¤šæ•°çš„å·¥ä½œæ˜¯åœ¨ @code{printpage()} å‡½æ•°ä¸­å®Œæˆçš„ã€‚æ ‡ç­¾è¡Œè¢«é¡ºåºåœ°å­˜åœ¨ @code{line} æ•°ç»„ä¸­ã€‚
ä½†æ˜¯ä»–ä»¬è¦æ°´å¹³åœ°æ‰“å°å‡ºæ¥ï¼š@code{line[1]} åé¢æ˜¯ @code{line[6]}ï¼Œ@code{line[2]} ä¸ @code{line[7]} ç›¸é‚»ï¼Œç­‰ç­‰ã€‚ç”¨ä¸¤ä¸ªå¾ªç¯æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚å¤–å±‚çš„å¾ªç¯é€šè¿‡ @code{i} æ¥æ§åˆ¶ï¼Œç”¨æ¥è¿­ä»£æ•°æ®çš„æ¯ 10 è¡Œï¼Œè¿™æ˜¯æ¯ä¸€è¡Œçš„æ ‡ç­¾ã€‚å†…å¾ªç¯ï¼Œé€šè¿‡ @code{j} æ§åˆ¶ï¼Œä¸ç”¨è¿­ä»£ä¸€è¡Œä¸­çš„å†…å®¹ã€‚å½“ @code{j} ä» 0 è¿­ä»£åˆ° 4ï¼Œåˆ™ @samp{i+j} å°±æ˜¯è¡Œä¸­çš„ç¬¬ @code{j} è¡Œã€‚ @samp{i+j+5} åˆ™ä¸ºä¸‹ä¸€è¡Œã€‚è¾“å‡ºæœ€ç»ˆè¾“å‡ºå¯èƒ½å¦‚ä¸‹ï¼š

@example
line 1          line 6
line 2          line 7
line 3          line 8
line 4          line 9
line 5          line 10
@dots{}
@end example

@noindent
@code{printf} çš„ @samp{%-41s} å­—ä¸²è¡¨ç¤ºæ˜¯å·¦å¯¹é½æ•°æ®ï¼Œå¹¶åœ¨å›ºå®šçš„å®½åº¦åŸŸä¸Šè¿›è¡Œæ‰“å°ã€‚

ä½œä¸ºæœ€åæç¤ºï¼Œåœ¨è¡Œ 21 ä¸è¡Œ 61 ä¸­ä¼šæœ‰ä¸€ä¸ªç©ºè¡Œè¾“å‡ºï¼Œæ¥ä¿æŒè¾“å‡ºè¡Œæ˜¯æ ‡ç­¾æ˜¯å¯¹é½çš„ã€‚è¿™ä¾èµ–äºå†™ç¨‹åºæ—¶æ‰€ä½¿ç”¨çš„ç‰¹åˆ«çš„æ ‡ç­¾ç±»å‹ã€‚ä½ ä¹Ÿéœ€è¦æ³¨æ„ï¼Œåœ¨å¼€å¤´ä¸ç»“å°¾éƒ½æœ‰ä¸¤ä¸ªç©ºè¡Œã€‚

@code{END} è§„åˆ™ç”¨æ¥å°†æœ€åé¡µçš„æ ‡ç­¾è¾“å‡ºï¼Œå› ä¸ºæœ‰å¯èƒ½æ²¡æœ‰å¤šä¸ªæ•´ 20 ä¸ªæ ‡ç­¾å­˜åœ¨ï¼š

@cindex @code{labels.awk} program
@example
@c file eg/prog/labels.awk
# labels.awk --- print mailing labels
@c endfile
@ignore
@c file eg/prog/labels.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# June 1992
# December 2010, minor edits
@c endfile
@end ignore
@c file eg/prog/labels.awk

# Each label is 5 lines of data that may have blank lines.
# The label sheets have 2 blank lines at the top and 2 at
# the bottom.

BEGIN    @{ RS = "" ; MAXLINES = 100 @}

function printpage(    i, j)
@{
    if (Nlines <= 0)
        return

    printf "\n\n"        # header

    for (i = 1; i <= Nlines; i += 10) @{
        if (i == 21 || i == 61)
            print ""
        for (j = 0; j < 5; j++) @{
            if (i + j > MAXLINES)
                break
            printf "   %-41s %s\n", line[i+j], line[i+j+5]
        @}
        print ""
    @}

    printf "\n\n"        # footer

    delete line
@}

# main rule
@{
    if (Count >= 20) @{
        printpage()
        Count = 0
        Nlines = 0
    @}
    n = split($0, a, "\n")
    for (i = 1; i <= n; i++)
        line[++Nlines] = a[i]
    for (; i <= 5; i++)
        line[++Nlines] = ""
    Count++
@}

END @{
    printpage()
@}
@c endfile
@end example

@node Word Sorting
@subsection ç”Ÿæˆå­—ä½¿ç”¨ç»Ÿè®¡

@cindex words, usage counts@comma{} generating

å½“è¦å¤„ç†å¤§é‡çš„æ–‡æœ¬çš„æ—¶å€™ï¼Œå¦‚æœäº†è§£å•è¯çš„ä½¿ç”¨é¢‘ç‡æ˜¯ä¸€ä»¶å¾ˆæœ‰è¶£çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œä½œè€…å¯èƒ½ä¼šå®¹æ˜“ä½¿ç”¨ç‰¹å®šçš„è¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»–æˆ–è€…å¥¹å¯èƒ½æƒ³æ‰¾ä¸€äº›åŒä¹‰è¯æ¥ä»£æ›¿é‚£äº›å‡ºç°å¾—å¤ªé¢‘ç¹çš„è¯ã€‚è¿™ä¸€@value{SUBSECTION}ä¸­å¼€å‘äº†ä¸€ä¸ªè¿™æ ·çš„ç¨‹åºæ¥ç»Ÿè®¡å•è¯ä»¥åŠå®ƒå‡ºç°çš„é¢‘ç‡ï¼Œå¹¶ä»¥ä¸€ç§æœ‰ç”¨çš„æ–¹å¼è¾“å‡ºè¿™äº›ä¿¡æ¯ã€‚

ä¹çœ‹ä¹‹ä¸‹ï¼Œåƒä¸‹é¢è¿™æ ·çš„ç¨‹åºå¯ä»¥å®Œæˆè¿™æ ·çš„åŠŸèƒ½ï¼š

@example
# wordfreq-first-try.awk --- print list of word frequencies

@{
    for (i = 1; i <= NF; i++)
        freq[$i]++
@}

END @{
    for (word in freq)
        printf "%s\t%d\n", word, freq[word]
@}
@end example

ç¨‹åºä¾èµ–äº @command{awk} çš„é»˜è®¤åŸŸåˆ†å‰²æœºåˆ¶æ¥å°†æ¯ä¸€è¡Œåˆ†å‰²æˆè¯å¹¶ä½¿ç”¨å…³è”æ•°ç»„ @code{freq} æ¥å­˜å‚¨å®ƒä»¬ï¼Œç”¨å•è¯æ¥ä½œä¸ºç´¢å¼•ï¼Œæ¥ç»Ÿè®¡å•è¯å‡ºç°çš„æ¬¡æ•°ï¼Œåœ¨ @code{END} è§„åˆ™ä¸­æ¥æ‰“å°ç»Ÿè®¡ã€‚

è¿™ä¸ªç¨‹åºæœ‰å‡ ä¸ªé—®é¢˜ä¼šå¯¼è‡´å…¶å¤„ç†çœŸå®æ–‡æœ¬æ—¶æœ‰å¯ç”¨ç¨‹åº¦ï¼š

@itemize @value{BULLET}
@item
@command{awk} è¯­è¨€ä¼šæŠŠå¤§å†™ä¸å°å®šæ˜¯æœ‰åŒºåˆ«çš„ã€‚æ‰€ä»¥ï¼Œâ€œbartenderâ€ä¸â€œBartenderâ€ä¼šå½“æˆä¸ä¸€æ ·çš„è¯ã€‚è¿™ä¸æ˜¯æƒ³è¦çš„ç»“æœï¼Œå› ä¸ºå•è¯åœ¨æ­£å¸¸çš„æ–‡æœ¬ä¸­çš„å¥é¦–ï¼Œä¼šè¿›è¡Œé¦–å­—å¤§å†™ï¼Œè€Œé¢‘ç‡åˆ†æå™¨å´å¯¹é¦–å­—å¤§å†™ä¸æ•æ„Ÿã€‚

@item
å•è¯çš„æ£€æµ‹ä½¿ç”¨çš„æ˜¯ @command{awk} é»˜è®¤ä½¿ç”¨ç©ºæ ¼è¿›è¡ŒåŸŸåˆ†å‰²çš„æƒ¯ä¾‹ã€‚åœ¨è¾“å…¥ä¸­çš„å…¶ä»–å­—ç¬¦ï¼ˆä¸åŒ…å«æ¢è¡Œç¬¦ï¼‰å¯¹äº @command{awk} æ¥è¯´æ²¡æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚è¿™è¡¨ç¤ºæ ‡ç‚¹ç¬¦å·ä¹Ÿä¼šæˆä¸ºå•è¯çš„ä¸€éƒ¨åˆ†ã€‚

@item
è¾“å‡ºä¸ä¼šæœ‰ä»€ä¹ˆæœ‰ç”¨çš„é¡ºåºã€‚ä½ æ›´æœ‰å¯èƒ½å¯¹æœ€å¸¸å‡ºç°çš„å•è¯æ„Ÿå…´è¶£ï¼Œæˆ–è€…å½¢æˆä¸€ä¸ªå­—æ¯è¡¨æ¥è¡¨ç¤ºæ¯ä¸ªå•è¯çš„å‡ºç°é¢‘ç‡ã€‚
@end itemize

@cindex @command{sort} utility
ç¬¬ä¸€ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ @code{tolower()} æ¥ç§»é™¤å¤§å°å®šæ¥è§£å†³ã€‚ç¬¬ä¸‰ä¸ªé—®é¢˜å¯ä»¥ç”¨ @code{gsub()} ç§»é™¤æ ‡ç‚¹ç¬¦å·æ¥è§£å†³ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨ç³»ç»Ÿçš„ @command{sort} å·¥å…·å¤„ç† @command{awk} è„šæœ¬çš„è¾“å‡ºæ¥è§£å†³ç¬¬ä¸‰ä¸ªé—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ç¨‹åºï¼š

@cindex @code{wordfreq.awk} program
@example
@c file eg/prog/wordfreq.awk
# wordfreq.awk --- print list of word frequencies

@{
    $0 = tolower($0)    # remove case distinctions
    # remove punctuation
    gsub(/[^[:alnum:]_[:blank:]]/, "", $0)
    for (i = 1; i <= NF; i++)
        freq[$i]++
@}

@c endfile
END @{
    for (word in freq)
        printf "%s\t%d\n", word, freq[word]
@}
@end example

æ­£åˆ™è¡¨è¾¾å¼ @code{/[^[:alnum:]_[:blank:]]/} æœ¬å¯ä»¥å†™åœ¨ @code{/[[:punct:]]/}ï¼Œä½†æ˜¯ä¸‹åˆ’çº¿ä¹Ÿè¦ç§»é™¤ï¼Œä½†æˆ‘ä»¬æƒ³ä¿ç•™å®ƒã€‚

å‡è®¾æˆ‘ä»¬æŠŠè¿™ä¸ªç¨‹åºä¿ç•™ä¸ºåå­—ä¸º @file{wordfreq.awk} çš„æ–‡ä»¶ï¼Œæ•°æ®åœ¨ @file{file1} ä¸­ï¼Œåˆ™ä¸‹é¢çš„ç®¡ç¨‹ï¼š

@example
awk -f wordfreq.awk file1 | sort -k 2nr
@end example

@noindent
ä¼šäº§ç”Ÿå‡ºç°åœ¨ @file{file1} ä¸­çš„å•è¯é¢‘ç‡çš„é™åºè¡¨ã€‚

@command{awk} ç¨‹åºé€‚åˆäºå¤„ç†ä¿¡æ¯ä»¥åŠæ•°æ®æ¥äº§ç”Ÿå•è¯é¢‘ç‡è¡¨ï¼Œä½†æ˜¯ä¸æ˜¯æœ‰åºçš„ã€‚@command{awk} çš„è„šæœ¬è¾“å‡ºç„¶åé€šè¿‡ @command{sort} å·¥å…·æ¥æ’åºï¼Œç„¶åå†æ‰“å°åˆ°å±å¹•ä¸Šã€‚

æäº¤ç»™ @command{sort} å·¥å…·çš„é€‰æ‹©æŒ‡å®šæ’åºä½¿ç”¨æ¯ä¸ªè¾“å…¥è¡Œçš„ç¬¬äºŒä¸ªåŸŸï¼ˆè·³è¿‡ç¬¬ä¸€ä¸ªåŸŸï¼‰ï¼Œæ’åºé”®è¢«å½“æˆæ•°å€¼é‡æ¥å¯¹å¾…ï¼ˆä¸ç„¶ @samp{15} ä¼šæ’åœ¨ @samp{5} ä¹‹å‰ï¼‰ï¼Œç„¶åæ’åºä¼šä»¥é™åºï¼ˆé€†åºï¼‰çš„æ–¹å¼æ¥æ‰§è¡Œã€‚

@command{sort} ç”šè‡³å¯ä»¥åœ¨ç¨‹åºä¸­å®Œæˆï¼Œåªè¦æŠŠ @code{END} çš„åŠ¨ä½œæ”¹æˆå¦‚ä¸‹ï¼š

@example
@c file eg/prog/wordfreq.awk
END @{
    sort = "sort -k 2nr"
    for (word in freq)
        printf "%s\t%d\n", word, freq[word] | sort
    close(sort)
@}
@c endfile
@end example

è¿™ç§æ–¹å¼çš„æ’åºå¿…é¡»ä½¿ç”¨åœ¨é‚£äº›åœ¨å‘½ä»¤è¡Œä¸€å±‚æ²¡æœ‰çœŸæ­£çš„ç®¡é“çš„çš„ç³»ç»Ÿä¸Šï¼ˆæˆ–è€…æ‰¹å¤„ç†æ–‡ä»¶ï¼‰ã€‚æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¸Šå¦‚ä½•ä½¿ç”¨ @command{sort} ç¨‹åºçš„æ–‡æ¡£æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚

@node History Sorting
@subsection ä»æœªæ’åºçš„æ–‡æœ¬ä¸­å»é‡

@cindex lines, duplicate@comma{} removing
@command{uniq} ç¨‹åºï¼ˆæŸ¥çœ‹ @pxref{Uniq Program}ï¼‰åœ¨@emph{ç»è¿‡æ’åº}çš„æ•°æ®ä¸­ç§»é™¤é‡å¤çš„è¡Œã€‚

ä½†æ˜¯ï¼Œä½ å¯èƒ½éœ€è¦ç§»é™¤@value{DF}ä¸­çš„é‡å¤çš„è¡Œï¼Œè€Œåˆæƒ³ä¿ç•™è¡Œä¸­çš„é¡ºåºã€‚è¿™æ ·å¤„ç†çš„ä¸€ä¸ªåˆé€‚çš„ä¾‹å­å°±æ˜¯ Shell çš„ histroy æ–‡ä»¶ã€‚history æ–‡ä»¶ä¿ç•™äº†ä½ å·²ç»è¾“å…¥è¿‡çš„å‘½ä»¤çš„å¤æœ¬ï¼Œåœ¨ä¸€è¡Œä¸­é‡å¤å‡ æ¬¡ç›¸åŒçš„å‘½ä»¤çš„æƒ…å†µå¹¶ä¸å¤šè§ã€‚æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½æƒ³ç§»é™¤é‡å¤çš„è¡Œæ¥å‹ç¼©æ–‡ä»¶ã€‚ä½†æ˜¯è¿˜è¦ä¿ç•™æœ€åˆå‘½ä»¤è¡Œçš„é¡ºåºã€‚

ä¸‹é¢è¿™ä¸ªç®€å•çš„ç¨‹åºå¯ä»¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚å®ƒä¼šä½¿ç”¨ä¸¤ä¸ªæ•°ç»„ã€‚ @code{data} æ•°ç»„ç”±æ¯è¡Œçš„æ–‡æœ¬æ¥ä½œç´¢å¼•ã€‚å¯¹æ¯ä¸€è¡Œï¼Œ@code{data[$0]} ä¼šè¿›è¡Œé€’å¢ã€‚å¦‚æœæŸä¸ªç‰¹å®šçš„è¡Œä¹‹å‰æ²¡æœ‰å‡ºç°è¿‡ï¼Œåˆ™ @code{data[$0]} ä¼šæ˜¯ 0ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‚£ä¸€è¡Œçš„æ–‡æœ¬ä¼šå­˜åœ¨ @code{lines[count]} ä¸­ã€‚@code{lines} ä¸­çš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œè€Œ @code{lines} çš„ç´¢å¼•è¡¨ç¤ºäº†è¡Œå‡ºç°çš„é¡ºåºã€‚@code{END} è§„åˆ™ä¸­ä»‹ç®€å•åœ°æŒ‰é¡ºåºæ‰“å°è¿™äº›è¡Œï¼š

@cindex Rakitzis, Byron
@cindex @code{histsort.awk} program
@example
@c file eg/prog/histsort.awk
# histsort.awk --- compact a shell history file
# Thanks to Byron Rakitzis for the general idea
@c endfile
@ignore
@c file eg/prog/histsort.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
@c endfile
@end ignore
@c file eg/prog/histsort.awk

@group
@{
    if (data[$0]++ == 0)
        lines[++count] = $0
@}
@end group

@group
END @{
    for (i = 1; i <= count; i++)
        print lines[i]
@}
@end group
@c endfile
@end example

è¿™ä¸ªç¨‹åºä¹Ÿæä¾›äº†ç”¨äºäº§ç”Ÿæœ‰ç”¨ä¿¡æ¯çš„ä¸€ä¸ªåŸºç¡€ã€‚å¦‚ï¼Œåœ¨ @code{END} è§„åˆ™ä¸­ä½¿ç”¨ä¸‹é¢çš„ @code{print} è¯­å¥è¡¨ç¤ºç‰¹å®šå‘½ä»¤ä½¿ç”¨çš„é¢‘åº¦ï¼š

@example
print data[lines[i]], lines[i]
@end example

@noindent
è¿™ä¹ˆåšæœ‰æ•ˆæ˜¯å› ä¸º @code{data[$0]} åœ¨è¡Œæ¯å‡ºç°ä¸€æ¬¡éƒ½ä¼šè¿›è¡Œé€’å¢ã€‚

@node Extract Program
@subsection ä» Texinfo æºæ–‡ä»¶ä¸­æå–ç¨‹åº

@cindex Texinfo, extracting programs from source files
@cindex files, Texinfo@comma{} extracting programs from
@ifnotinfo
åœ¨æœ¬ç« ä¸å‰ä¸€ç« ï¼ˆæŸ¥çœ‹ @ref{Library Functions}ï¼‰ä¸­ï¼Œéƒ½å±•ç¤ºäº†å¤§é‡çš„ @command{awk} ç¨‹åºã€‚
@end ifnotinfo
@ifinfo
ç« èŠ‚ @ref{Library Functions} å’Œ @ref{Sample Programs} æ˜¯é«˜ç­‰çº§çš„å†…å®¹ï¼Œå…³äºæ›´å¤šçš„ @command{awk} ç¨‹åºã€‚
@end ifinfo
å¦‚æœä½ æƒ³å®è·µè¿™äº›ç¨‹åºï¼Œå¦‚æœå†æ¬¡æ‰‹å·¥è¾“å‡ºè¿™äº›ç¨‹åºåˆ™å°±å¤ªç¹çäº†ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä¸€ä¸ªç¨‹åºå¯ä»¥ä» Texinfo çš„è¾“å…¥æ–‡ä»¶ä¸­æå‡ºéƒ¨åˆ†åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ã€‚

@cindex Texinfo
æœ¬@value{DOCUMENT} æ˜¯ç”¨ @uref{http://www.gnu.org/software/texinfo/, Texinfo} å†™æˆçš„ï¼Œè¿™æ˜¯ GNU é¡¹ç›®çš„æ–‡æ¡£æ ¼å¼è¯­è¨€ã€‚ä¸€ä¸ªå•ç‹¬çš„ Texinfo æºæ–‡ä»¶å¯ä»¥ç”¨æ¥äº§ç”Ÿæ‰“å°çš„ @TeX{} æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥äº§ç”Ÿåœ¨çº¿æ–‡æ¡£ã€‚
@ifnotinfo
ï¼ˆTexinfo åœ¨ä¹¦ @cite{Texinfo---The GNU Documentation Format} æœ‰å®Œæ•´çš„æ–‡æ¡£ï¼Œä¹Ÿå¯ä»è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå–å¾—ï¼Œä¹Ÿå¯ä»¥åœ¨
@uref{http://www.gnu.org/software/texinfo/manual/texinfo/, ç½‘ä¸Š} å–å¾—ã€‚ï¼‰
@end ifnotinfo
@ifinfo
ï¼ˆTexinfo è¯­è¨€æœ‰è¯¦ç»†çš„æ–‡æ¡£ï¼Œä» @inforef{Top, , Texinfo, texinfo,Texinfo---The GNU Documentation Format} å¼€å§‹äº†è§£ã€‚ï¼‰
@end ifinfo

å¯¹äºæˆ‘ä»¬è‡ªå·±çš„ç›®çš„ï¼ŒçŸ¥é“ Texinfo è¾“å…¥æ–‡ä»¶çš„ä¸‰ä»¶äº‹æƒ…å°±å¤Ÿäº†ï¼š

@itemize @value{BULLET}
@item
â€œatâ€ ç¬¦å·ï¼ˆ@samp{@@}ï¼‰åœ¨ Texinfo ä¸­æ˜¯ç‰¹æ®Šç¬¦å·ï¼Œå°±åƒæ˜¯åœ¨ C æˆ–è€… @command{awk} ä¸­çš„åæ–œæ ä¸€æ ·ï¼ˆ@samp{\}ï¼‰ã€‚å­—é¢çš„ @samp{@@} åœ¨ Texinfo æºæ–‡ä»¶ä¸­ç”± @samp{@@@@} æ¥è¡¨ç¤ºã€‚

@item
æ³¨é‡ŠåŒ @samp{@@c} å¼€å§‹ï¼Œæˆ–è€…ç”± @samp{@@comment} å¼€å§‹ã€‚æ–‡ä»¶æå‡ºç¨‹åºé€šè¿‡ä½¿ç”¨åœ¨è¡Œé¦–å¼€å§‹çš„ç‰¹æ®Šçš„æ³¨é‡Šã€‚

@item
åŒ…å« @samp{@@group} ä¸ @samp{@@end group} å‘½ä»¤åŒ…å«ä¾‹å­æ–‡æœ¬ä¸å¯ä»¥åˆ†é¡µã€‚ï¼ˆä¸å¹¸çš„æ˜¯ï¼Œ@TeX{} ä¸æ€»æ˜¯è¶³å¤Ÿæ¥åšæ­£ç¡®çš„äº‹æƒ…ï¼Œå› æ­¤æˆ‘ä»¬è¿˜å¾—ç»™å®ƒä¸€äº›å¸®åŠ©ã€‚ï¼‰
@end itemize

ä¸‹é¢çš„ç¨‹åº @file{extract.awk} ä» Texinfo æºæ–‡ä»¶ä¸­è¯»å–ï¼Œå¹¶æ ¹æ®ç‰¹æ®Šæ³¨é‡Šåšä¸¤ä»¶äº‹æƒ…ã€‚å½“çœ‹åˆ° @samp{@w{@@c system @dots{}}} æ—¶ï¼Œå®ƒæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œå¹¶ä»å‘½ä»¤æ–‡æœ¬ä¸­æå–æ§åˆ¶è¡Œå¹¶å°†å…¶ä¼ é€’ç»™ @code{system()} å‡½æ•°
ï¼ˆæŸ¥çœ‹ @pxref{I/O Functions}ï¼‰ã€‚å½“çœ‹åˆ° @samp{@@c file @var{filename}} æ—¶ï¼Œå…¶åç»­çš„è¡Œå°†è¢«å‘é€åˆ°æ–‡ä»¶ @var{filename} ä¸­ï¼Œç›´åˆ°çœ‹åˆ° @samp{@@c endfile} ä¸ºæ­¢ã€‚
åœ¨ @file{extract.awk} è§„åˆ™ä¸­ï¼Œè¦ä¹ˆåŒ¹é… @samp{@@c} è¦ä¹ˆåŒ¹é… @samp{@@comment}ï¼Œåªè¦å°† @samp{omment} æˆä¸ºå¯é€‰çš„éƒ¨åˆ†å³å¯ã€‚åŒ…å« @samp{@@group} ä¸ @samp{@@end group} çš„è¡Œï¼Œåªæ˜¯ç®€å•åœ°ç§»é™¤ã€‚@file{extract.awk} ä½¿ç”¨åˆ° @code{join()} åº“å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Join Function}ï¼‰ã€‚

åœ¨ @cite{@value{TITLE}} ï¼ˆ@file{gawktexi.in}ï¼‰çš„ Texinfo çš„æºä»£ç ä¸­çš„ä¾‹å­ç¨‹åºéƒ½å·²ç»åŒ…å«åœ¨ @samp{file} ä¸ @samp{endfile} ä¸­çš„è¡Œé‡Œã€‚
@command{gawk} å‘è¡Œç‰ˆæœ¬ä½¿ç”¨ @file{extract.awk} çš„ä¸€ä¸ªå¤æœ¬æ¥æå–ä¾‹å­ç¨‹åºï¼Œå¹¶å°†ä»–ä»¬ä¸­çš„å¤šæ•°å®‰è£…åˆ°äº†æ ‡å‡†çš„ @command{gawk} å¯æŸ¥æ‰¾åˆ°ç›®å½•ä¸­ã€‚Texinfo æ–‡ä»¶çœ‹èµ·æ¥è¿™æ ·ï¼š

@example
@dots{}
This program has a @@code@{BEGIN@} rule
that prints a nice message:

@@example
@@c file examples/messages.awk
BEGIN @@@{ print "Don't panic!" @@@}
@@c endfile
@@end example

It also prints some final advice:

@@example
@@c file examples/messages.awk
END @@@{ print "Always avoid bored archaeologists!" @@@}
@@c endfile
@@end example
@dots{}
@end example

@file{extract.awk} å°† @code{IGNORECASE} è®¾ç½®ä¸º 1ï¼Œæ‰€ä»¥å¤§å°å†™æ··åˆåœ¨æŒ‡ç¤ºç¬¦ä¸­ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ã€‚

ç¬¬ä¸€ä¸ªè§„åˆ™å¤„ç† @code{system()} è°ƒç”¨ï¼Œæ£€æŸ¥è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆ@code{NF} è‡³å°‘ä¸º 3 ï¼‰å¹¶ä¸”ä¹Ÿæ£€æŸ¥å‘½ä»¤å‡ºä»£ç ä¸ºæ˜¯å¦ä¸º 0ï¼Œå³è¡¨ç¤ºæ‰§è¡Œ OKï¼š

@cindex @code{extract.awk} program
@example
@c file eg/prog/extract.awk
# extract.awk --- extract files and run programs from Texinfo files
@c endfile
@ignore
@c file eg/prog/extract.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# May 1993
# Revised September 2000
@c endfile
@end ignore
@c file eg/prog/extract.awk

BEGIN    @{ IGNORECASE = 1 @}

/^@@c(omment)?[ \t]+system/ @{
    if (NF < 3) @{
        e = ("extract: " FILENAME ":" FNR)
        e = (e  ": badly formed `system' line")
        print e > "/dev/stderr"
        next
    @}
    $1 = ""
    $2 = ""
    stat = system($0)
    if (stat != 0) @{
        e = ("extract: " FILENAME ":" FNR)
        e = (e ": warning: system returned " stat)
        print e > "/dev/stderr"
    @}
@}
@c endfile
@end example

@noindent
å˜é‡ @code{e} ç”¨æ¥ä½¿è§„åˆ™å¾ˆå¥½åœ°åŒ¹é…é¡µ @value{PAGE}ã€‚

ç¬¬äºŒä¸ªè§„åˆ™å°†æ•°æ®ç§»åŠ¨åˆ°æ–‡ä»¶ä¸­ã€‚å®ƒä¼šæ£€æŸ¥åœ¨æŒ‡ç¤ºç¬¦ä¸­ç»™å‡ºçš„@value{FN}ã€‚å¦‚æœæ–‡ä»¶åä¸æ˜¯å½“å‰çš„æ–‡ä»¶ï¼Œç„¶åå½“å‰æ–‡ä»¶å°±ä¼šè¢«å…³é—­ã€‚è®©å½“å‰çš„æ–‡ä»¶ä¸€ç›´æ‰“å¼€åˆ°å¤„ç†ä¸‹ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œè¿™æ ·ä½ å¯ä»¥ä½¿ç”¨ @samp{>} æ¥é‡å®šå‘æ‰“å°å†…å®¹ï¼Œæ‰“å¼€æ–‡ä»¶çš„ç®¡ç†ä¹Ÿå¾ˆç®€å•ã€‚

@code{for} å¾ªç¯å¤„ç†çœŸæ­£çš„å·¥ä½œã€‚å®ƒä½¿ç”¨ @code{getline} ï¼ˆæŸ¥çœ‹ @pxref{Getline}ï¼‰æ¥è¯»å–è¡Œã€‚å¯¹äºä¸€ä¸ªæœªæœŸæœ›çš„æ–‡ä»¶å°¾ï¼Œå®ƒä¼šè°ƒç”¨ @code{@w{unexpected_eof()}} å‡½æ•°ã€‚å¦‚æœè¡Œæ˜¯ä¸€ä¸ª @samp{endfile} è¡Œï¼Œåˆ™å®ƒå°±è·³å‡ºå¾ªç¯ã€‚å¦‚æœè¡Œæ˜¯ @samp{@@group} æˆ–è€… @samp{@@end group} è¡Œï¼Œåˆ™å®ƒä¼šå¿½ç•¥æ‰ï¼Œç„¶åç»§ç»­å¤„ç†ä¸‹ä¸€è¡Œã€‚ç±»ä¼¼åœ°ï¼Œä¾‹å­ä¸­çš„æ³¨é‡Šä¹Ÿè¢«å¿½ç•¥æ‰ã€‚

å¤§å¤šæ•°çš„å·¥ä½œéƒ½åœ¨ä¸‹é¢å‡ è¡Œã€‚å¦‚æœè¡Œä¸­æ²¡æœ‰ @samp{@@} ç¬¦å·ï¼Œåˆ™ç¨‹åºå¯ä»¥ç›´æ¥æ‰“å°å®ƒï¼Œå¦åˆ™æ¯ä¸€ä¸ªå‰å¯¼çš„ @samp{@@} å¿…é¡»è¢«å»æ‰ã€‚ä¸ºäº†ç§»é™¤ @samp{@@} ç¬¦å·ï¼Œä½¿ç”¨ @code{split()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰è¡Œè¢«åˆ†å‰²æˆ @code{a} æ•°ç»„çš„ä¸åŒå…ƒç´ ã€‚
@samp{@@} ç¬¦å·è¢«ç”¨äºåˆ†éš”ç¬¦ã€‚@code{a} çš„æ¯ä¸€ä¸ªç©ºå…ƒç´ è¡¨ç¤ºåœ¨åŸè¡Œä¸­çš„ä¸¤ä¸ªè¿ç»­çš„ @samp{@@} ç¬¦å·ã€‚å¯¹æ¯ä¸¤ä¸ªç©ºå…ƒç´ ï¼ˆåœ¨åŸæ–‡ä»¶ä¸­çš„ @samp{@@@@}ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ª @samp{@@} ç¬¦å·è¿›æ¥ã€‚

å½“æ•°ç»„çš„å¤„ç†å·²ç»å®Œæˆï¼Œ@code{join()} åˆ™è¢«ä»¥ @code{SUBSEP} çš„å€¼è°ƒç”¨ï¼ˆæŸ¥çœ‹ @pxref{Multidimensional}ï¼‰ï¼Œç”¨ä»¥å°†åˆ†æ•£çš„å—è¿æ¥æˆä¸€ä¸ªå•ç‹¬çš„è¡Œã€‚è¯¥è¡Œç„¶åè¢«æ‰“å°åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ï¼š

@example
@c file eg/prog/extract.awk
/^@@c(omment)?[ \t]+file/ @{
    if (NF != 3) @{
        e = ("extract: " FILENAME ":" FNR ": badly formed `file' line")
        print e > "/dev/stderr"
        next
    @}
    if ($3 != curfile) @{
        if (curfile != "")
            close(curfile)
        curfile = $3
    @}

    for (;;) @{
        if ((getline line) <= 0)
            unexpected_eof()
        if (line ~ /^@@c(omment)?[ \t]+endfile/)
            break
        else if (line ~ /^@@(end[ \t]+)?group/)
            continue
        else if (line ~ /^@@c(omment+)?[ \t]+/)
            continue
        if (index(line, "@@") == 0) @{
            print line > curfile
            continue
        @}
        n = split(line, a, "@@")
        # if a[1] == "", means leading @@,
        # don't add one back in.
        for (i = 2; i <= n; i++) @{
            if (a[i] == "") @{ # was an @@@@
                a[i] = "@@"
                if (a[i+1] == "")
                    i++
            @}
        @}
        print join(a, 1, n, SUBSEP) > curfile
    @}
@}
@c endfile
@end example

è¿™é‡Œè¦æ³¨æ„ä¸€ä¸ªé‡è¦çš„äº‹æƒ…å°±æ˜¯ @samp{>} é‡å®šå‘ç¬¦çš„ä½¿ç”¨ã€‚ç”¨ @samp{>} è¾“å‡ºåªä¼šæ‰“å¼€ä¸€æ¬¡æ–‡ä»¶ï¼Œç„¶åä¼šä¸€ä¿æŒæ‰“å¼€ï¼Œåç»­çš„è¾“å‡ºæ“ä½œä¼šé™„åŠ åˆ°æ–‡ä»¶ä¸­ï¼ˆæŸ¥çœ‹ @pxref{Redirection}ï¼‰ã€‚è¿™ä½¿å¾—å¾ˆå®¹æ˜“æ··åˆç¨‹åºæ–‡æœ¬ä¸é’ˆå¯¹ç›¸åŒæºæ–‡ä»¶çš„è§£é‡Šæ€§çš„æ–‡å­—ï¼ˆæ­£å¦‚è¿™é‡Œæ‰€åšçš„ä¸€æ ·ï¼‰è€Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚æ–‡ä»¶åªåœ¨å¤„ç†ä¸€ä¸ªæ–°çš„@value{DF}çš„æ—¶å€™æ‰ä¼šè¢«å…³é—­ï¼Œæˆ–è€…åœ¨è¾“å…¥æ–‡ä»¶è¾“å…¥ç»“æŸæ—¶å…³é—­ã€‚

æœ€åï¼Œ@code{@w{unexpected_eof()}} å‡½æ•°æ‰“å°åˆé€‚çš„é”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºã€‚@code{END} è§„åˆ™å¤„ç†æœ€åçš„æ¸…ç†å·¥ä½œï¼Œå…³é—­æ‰“å¼€çš„æ–‡ä»¶ï¼š

@example
@c file eg/prog/extract.awk
@group
function unexpected_eof()
@{
    printf("extract: %s:%d: unexpected EOF or error\n",
                     FILENAME, FNR) > "/dev/stderr"
    exit 1
@}
@end group

END @{
    if (curfile)
        close(curfile)
@}
@c endfile
@end example

@node Simple Sed
@subsection ä¸€ä¸ªç®€å•çš„æµç¼–è¾‘å™¨

@cindex @command{sed} utility
@cindex stream editors
@command{sed} æ˜¯ä¸€ä¸ªæµç¼–è¾‘å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ª@dfn{è¯»å–æ•°æ®æµ}ï¼Œæ”¹å˜å®ƒç„¶åä¼ é€’å®ƒçš„ç¨‹åºã€‚é€šè¿‡å®ƒè¢«ç”¨æ¥å¯¹ä¸€ä¸ªå¤§çš„æ–‡ä»¶æˆ–è€…ç”±å‘½ä»¤çš„ç®¡ç¨‹äº§ç”Ÿçš„æ•°æ®æµåšä¸€äº›å…¨å±€æ€§çš„æ›´æ”¹ã€‚å°½ç®¡ @command{sed} åœ¨å®ƒé‚£è¾¹æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„ç¨‹åºï¼Œä½†æ˜¯å®ƒçš„é€šå¸¸ç”¨æ³•æ˜¯åœ¨ç®¡çº¿çš„ä¸­é€”åšä¸€äº›å…¨å±€æ€§çš„æ›¿æ¢ï¼š

@example
@var{command1} < orig.data | sed 's/old/new/g' | @var{command2} > result
@end example

å¦‚ @samp{s/old/new/g} å‘Šè¯‰ @command{sed} åœ¨æ¯ä¸€ä¸ªè¾“å…¥è¡ŒæŸ¥æ‰¾æ­£åˆ™è¡¨è¾¾å¼ @samp{old}ï¼Œå¹¶å…¨å±€æ€§åœ°æ›¿æ¢å®ƒä¸º @samp{new} ï¼ˆå³åœ¨ä¸€è¡Œä¸­æ‰€æœ‰å‡ºç°ï¼‰ã€‚è¿™ä¸ªä¸ @command{awk} çš„ @code{gsub()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰éå¸¸ç±»ä¼¼ã€‚

ä¸‹é¢çš„ç¨‹åºï¼Œ@file{awksed.awk} æ¥æ”¶è‡³å°‘ä¸¤ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼šä¸€ä¸ªæ˜¯è¦æŸ¥æ‰¾çš„æ¨¡å¼ï¼Œä»¥åŠæ›¿æ¢å®ƒçš„æ–‡æœ¬ã€‚ä»»ä½•å…¶ä»–çš„å‚æ•°éƒ½å½“æˆæ˜¯è¦å¤„ç†çš„@value{DF}åã€‚å¦‚æœæ²¡æœ‰æä¾›æ–‡ä»¶åï¼Œåˆ™ä½¿ç”¨æ ‡å‡†è¾“å…¥ï¼š

@cindex Brennan, Michael
@cindex @command{awksed.awk} program
@c @cindex simple stream editor
@c @cindex stream editor, simple
@example
@c file eg/prog/awksed.awk
# awksed.awk --- do s/foo/bar/g using just print
#    Thanks to Michael Brennan for the idea
@c endfile
@ignore
@c file eg/prog/awksed.awk
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# August 1995
@c endfile
@end ignore
@c file eg/prog/awksed.awk

function usage()
@{
    print "usage: awksed pat repl [files...]" > "/dev/stderr"
    exit 1
@}

BEGIN @{
    # validate arguments
    if (ARGC < 3)
        usage()

    RS = ARGV[1]
    ORS = ARGV[2]

    # don't use arguments as files
    ARGV[1] = ARGV[2] = ""
@}

@group
# look ma, no hands!
@{
    if (RT == "")
        printf "%s", $0
    else
        print
@}
@end group
@c endfile
@end example

ç¨‹åºä¾èµ–äº @command{gawk} å¯ä»¥å°† @code{RS} èµ‹å€¼ä¸ºæ­£åˆ™è¡¨è¾¾å¼çš„èƒ½åŠ›ï¼Œä»¥åŠè®¾ç½® @code{RT} ä¸ºå®é™…çš„ç»“æŸè®°å½•çš„æ–‡æœ¬ï¼ˆæŸ¥çœ‹ @pxref{Records}ï¼‰ã€‚

æ€è·¯å°±æ˜¯è®© @code{RS} æˆä¸ºè¦æŸ¥æ‰¾çš„æ¨¡å¼ã€‚@command{gawk} ä¼šå¤„ç½®è®¾ç½® @code{$0} ä¸ºåœ¨åŒ¹é…æ¨¡å¼ä¹‹é—´çš„æ–‡æœ¬ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦ä¿ç•™çš„ï¼Œä¸ç»ä¿®æ”¹çš„æ–‡æœ¬ã€‚ç„¶åï¼Œè®¾ç½® @code{ORS} ä¸ºæ›¿æ¢çš„æ–‡ä»¶ã€‚ä¸€ä¸ªç®€å•çš„ @code{print} è¯­å¥è¾“å‡ºæˆ‘ä»¬æƒ³è¦ä¿ç•™çš„æ–‡æœ¬ï¼Œåé¢è·Ÿç€è¦æ›¿æ¢çš„æ–‡æœ¬ã€‚

è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªä¸å®Œç¾çš„åœ°æ–¹ï¼Œå³å¦‚æœæœ€åä¸€æ¡è®°å½•ä¸æ˜¯ä»¥åŒ¹é… @code{RS} çš„æ–‡æœ¬ç»“æŸè¯¥æ€ä¹ˆåŠã€‚ä½¿ç”¨ @code{print} è¯­å¥æ— æ¡ä»¶åœ°æ‰“å°æ›¿æ¢æ–‡æœ¬æ˜¯ä¸æ­£ç¡®çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ–‡ä»¶ä¸æ˜¯ä»¥åŒ¹é… @code{RS} çš„æ–‡æœ¬ç»“æŸï¼Œ@code{RT} ä¼šè¢«è®¾ç½®æˆç©ºä¸²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @code{printf} æ¥æ‰“å° @code{$0}ã€‚ï¼ˆæŸ¥çœ‹ @pxref{Printf}ï¼‰

@code{BEGIN} è§„åˆ™å¤„ç†ç¯å¢ƒçš„è®¾ç½®ï¼Œæ£€æŸ¥å‚æ•°çš„æ­£ç¡®æ•°å€¼ï¼Œå¹¶åœ¨å‡ºé—®é¢˜æ—¶è°ƒç”¨ @code{usage()} å‡½æ•°ã€‚ç„¶åå†è®¾ç½® @code{RS} ä¸ @code{ORS} ä¸ºä»å‘½ä»¤è¡Œä¸­å–å¾—çš„å‚æ•°ï¼Œå¹¶è°ƒå @code{ARGV[1]} ä¸ @code{ARGV[2]} ä¸ºç©ºä¸²ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šè¢«å½“æˆæ–‡ä»¶åæ¥å¤„ç†ï¼ˆæŸ¥çœ‹ @pxref{ARGC and ARGV}ï¼‰ã€‚

@code{usage()} å‡½æ•°ä¼šæ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºã€‚æœ€åï¼Œä¸€ä¸ªç®€å•çš„è§„åˆ™æ ¹æ® @code{RT} çš„å€¼æ¥ç›¸åº”åœ°ä½¿ç”¨ @code{print} ä¸ @code{printf} æ¥æ‰“å°ä¹‹å‰ç¡®å®šå¥½çš„æ–¹æ¡ˆã€‚

@node Igawk Program
@subsection ä½¿ç”¨åº“å‡½æ•°çš„ç®€å•æ–¹å¼

@cindex libraries of @command{awk} functions, example program for using
@cindex functions, library, example program for using
åœ¨ @ref{Include Files} ä¸­æˆ‘ä»¬çœ‹åˆ°äº† @command{gawk} å¦‚ä½•æ¥æä¾›å†…ç½®çš„æ–‡ä»¶åŒ…å«èƒ½åŠ›ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ @command{gawk} çš„æ‰©å±•ã€‚
è¿™ä¸€@value{SECTION}æä¾›äº†è®©æ ‡å‡†çš„ @command{awk} æœ‰æ–‡ä»¶åŒ…å«èƒ½åŠ›çš„åŠ¨æœºï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ Shell ä¸ @command{awk} çš„ç¼–ç¨‹ç»„åˆæ¥å®ç°ã€‚

ä½¿ç”¨åœ¨ @command{awk} ä¸­çš„åº“å‡½æ•°ç”¨å¤„éå¸¸å¤§ã€‚å®ƒé¼“åŠ±ä»£ç é‡ç”¨æ¥å†™ä¸€äº›é€šç”¨å‡½æ•°ã€‚ç¨‹åºçœ‹èµ·æ¥ä¼šæ›´å°æ›´æ¸…æ™°ã€‚ä½†æ˜¯ï¼Œå†™ @command{awk} ç¨‹åºæ—¶ä½¿ç”¨åº“å‡½æ•°éå¸¸å®¹æ˜“ï¼Œä½†æ˜¯è¿è¡Œä»–ä»¬æ—¶å´å¾ˆç—›è‹¦ï¼Œå› ä¸ºéœ€è¦å¤šä¸ª @option{-f} é€‰é¡¹ã€‚å¦‚æœ @command{gawk} ä¸å¯ç”¨ï¼Œåˆ™é€šè¿‡ @env{AWKPATH} ç¯å¢ƒæ¥å˜é‡æ¥å°† @command{awk} å‡½æ•°æ”¾åˆ°åº“ç›®å½•çš„èƒ½åŠ›ä¹Ÿä¸€æ ·ç—›è‹¦ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚å¦‚æœèƒ½ä»¥ä¸‹é¢çš„æ–¹å¼æ¥å†™ç¨‹åºåˆ™å°±éå¸¸å¥½äº†ï¼š

@example
# library functions
@@include getopt.awk
@@include join.awk
@dots{}

# main program
BEGIN @{
    while ((c = getopt(ARGC, ARGV, "a:b:cde")) != -1)
        @dots{}
    @dots{}
@}
@end example

ä¸‹é¢çš„ç¨‹åº @file{igawk.sh} æä¾›äº†è¿™æ ·çš„æœåŠ¡ã€‚å®ƒæ¨¡æ‹Ÿ @command{gawk} çš„æœç´¢ @env{AWKPATH} å˜é‡çš„è¡Œä¸ºï¼Œå¹¶å…è®¸@dfn{åµŒå¥—}çš„åŒ…å«ï¼ˆå³è¢« @code{@@include} åŒ…å«çš„æ–‡ä»¶å¯ä»¥å†åŒ…å« @code{@@include} è¯­å¥ï¼‰ã€‚@command{igawk} åŠªåŠ›ä½¿æ–‡ä»¶åªè¢«åŒ…å«ä¸€æ¬¡ï¼Œå› æ­¤åµŒå¥—çš„åŒ…å«ä¸ä¼šå¶ç„¶åŒ…å«ä¸€ä¸ªåº“å‡½æ•°ä¸¤æ¬¡ã€‚

@command{igawk} åº”è¯¥å¤–åœ¨è¡¨ç°å¾—åƒ @command{gawk}ã€‚è¿™å°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥æ¥æ”¶æ‰€æœ‰çš„ @command{gawk} çš„å‘½ä»¤è¡Œå‚æ•°ï¼ŒåŒ…å«é€šè¿‡ @option{-f} æŒ‡å®šå¤šä¸ªæºæ–‡ä»¶çš„èƒ½åŠ›ä»¥åŠèƒ½å¤Ÿæ··ç”¨å‘½ä»¤è¡Œä¸åº“æºæ–‡ä»¶çš„èƒ½åŠ›ã€‚

ç¨‹åºä½¿ç”¨ POSIX Shellï¼ˆ@command{sh}ï¼‰å‘½ä»¤è¯­è¨€å†™æˆã€‚
@footnote{å®Œæ•´çš„ @command{sh} è¯­è¨€çš„è§£é‡Šè¶…å‡ºäº†è¿™æœ¬ä¹¦çš„èŒƒå›´ã€‚æˆ‘ä»¬æä¾›äº†ä¸€äº›æœ€å°çš„è¯´æ˜ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°ç†è§£ï¼Œè¯·é˜…è¯»ä¸€ä¸ªå¥½çš„ Shell ç¼–ç¨‹ä¹¦ã€‚}
å®ƒå·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š

@enumerate
@item
å½“ç¨‹åºå±•å¼€æ‰§è¡Œæ—¶ï¼Œå¾ªç¯è¿­ä»£å‚æ•°ï¼Œä¿å­˜æ‰€æœ‰ä¸ä»£è¡¨ @command{awk} æºä»£ç çš„å‚æ•°ä»¥å¤‡ç”¨ã€‚

@item
å¯¹äºä»»ä½•ä¸ä»£è¡¨ @command{awk} æ–‡ä»¶çš„å‚æ•°ï¼Œå°†å‚æ•°æ”¾åˆ°ä¸€ä¸ªå¯å±•å¼€çš„ Shell å˜é‡ä¸­ã€‚æœ‰ä¸¤ç§æƒ…å½¢ï¼š

@enumerate a
@item
å¯¹äºç”± @option{-e} æˆ–è€… @option{--source} æä¾›çš„å­—é¢æ–‡æœ¬ã€‚è¿™ä¸ªæ–‡æœ¬åªæ˜¯ç›´æ¥è¿›è¡Œé™„åŠ ã€‚

@item
ç”± @option{-f} å‚æ•°æä¾›çš„æº@value{FN}ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå°æŠ€å·§ï¼Œå¹¶é™„åŠ  @samp{@@include @var{filename}} åˆ° Shell å˜é‡çš„å†…å®¹ä¸­ã€‚ç”±äºæ–‡ä»¶åŒ…å«ç¨‹åºå¦‚ @command{gawk} ä¸€æ ·çš„å·¥ä½œæ–¹å¼ï¼Œè¿™å¯ä»¥åœ¨æ­£ç¡®çš„ç‚¹å–å¾—ç¨‹åºä¸­åŒ…å«çš„æ–‡ä»¶çš„æ–‡æœ¬ã€‚
@end enumerate

@item
åœ¨ Shell å˜é‡ä¹‹ä¸Šï¼Œæ‰§è¡Œ @command{awk} ç¨‹åºï¼ˆè‡ªç„¶åœ°ï¼‰æ¥å±•å¼€ @code{@@include} è¯­å¥ã€‚è¢«å±•å¼€çš„ç¨‹åºæ”¾æ”¾åœ¨ç¬¬äºŒä¸ª Shell å˜é‡ä¸­ã€‚

@item
ç”¨ @command{gawk} è¿è¡Œå±•å¼€çš„ç¨‹åºä»¥åŠå…¶ä»–çš„ç”¨æˆ·æä¾›çš„å‘½ä»¤å‚æ•°ï¼ˆä¾‹å¦‚@value{DF}åï¼‰ã€‚
@end enumerate

è¿™ä¸ªç¨‹åºæ‰©å±•åœ°ä½¿ç”¨ Shell å˜é‡ï¼šç”¨äºå­˜å‚¨å‘½ä»¤è¡Œå‚æ•°ä»¥åŠå°†ä¼šå±•å¼€ç”¨æˆ·ç¨‹åºçš„ @command{awk} ç¨‹åºçš„æ–‡æœ¬ï¼Œç”¨äºç”¨æˆ·çš„åˆå§‹ç¨‹åºä»¥åŠå±•å¼€çš„ç¨‹åºã€‚è¿™ä¹ˆåšå¯ä»¥ç§»é™¤ä¸€äº›å½“æˆ‘ä»¬ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶è€Œå¯¼è‡´çš„æ½œåœ¨çš„é—®é¢˜ï¼Œä½†æ˜¯ä»£ä»·å°±æ˜¯ä½¿è„šæœ¬å¸¦æ¥ä¸€å®šçš„å¤æ‚æ€§ã€‚

ç¨‹åºçš„å¼€å§‹éƒ¨åˆ†ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ @samp{debug}ï¼Œåˆ™æ‰“å¼€ Shell çš„è·Ÿè¸ªã€‚

ä¸‹ä¸€ä¸ªéƒ¨åˆ†ä¼šå¾ªç¯æ‰€æœ‰çš„å‘½ä»¤è¡Œå‚æ•°ã€‚æœ‰å‡ ä¸ªæƒ…å†µéå¸¸æœ‰æ„æ€ï¼š

@c @asis for docbook
@table @asis
@item @option{--}
è¿™ç”±äºç»“æŸ @command{igawk} çš„å‚æ•°ã€‚å…¶ä»–çš„ä»»æ„å‚æ•°åº”è¯¥è¢«åŸæ ·åœ°ä¼ é€’åˆ°ç”¨æˆ·çš„ @command{awk} ç¨‹åºã€‚

@item @option{-W}
è¿™è¡¨ç¤ºä¸‹ä¸€ä¸ªé€‰é¡¹æ˜¯ç‰¹å®šäº @command{gawk} çš„ã€‚ä¸ºäº†ä½¿å‚æ•°å¤„ç†æ›´åŠ å®¹æ˜“ï¼Œ@option{-W} è¢«é™„åŠ åˆ°å‰©ä¸‹çš„å‚æ•°çš„å‰é¢ï¼Œç„¶åç»§ç»­å¾ªç¯ã€‚ï¼ˆè¿™æ˜¯ä¸€ä¸ª @command{sh} çš„ç¼–ç¨‹æŠ€å·§ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰ @command{sh} ä¹Ÿä¸ç”¨æ‹…å¿ƒã€‚ï¼‰

@item @option{-v}, @option{-F}
è¿™ä¼šè¢«å­˜å‚¨å¹¶è¢«ä¼ é€’ç»™ @command{gawk}ã€‚

@item @option{-f}, @option{--file}, @option{--file=}, @option{-Wfile=}
ä½¿ç”¨ @code{@@include} è¯­å¥æŠŠ@value{FN}é™„åŠ åˆ° Shell å˜é‡ç¨‹åº @code{program}ã€‚@command{expr} å·¥å…·ç”¨äºç§»é™¤å‚æ•°å‰é¢çš„çš„é€‰é¡¹éƒ¨åˆ†ï¼ˆæ¯”å¦‚ @samp{--file=}ï¼‰ã€‚ï¼ˆå…¸å‹çš„ @command{sh} ç”¨æ³•åº”è¯¥æ˜¯ä½¿ç”¨ @command{echo} ä»¥åŠ @command{sed} å·¥å…·æ¥åšè¿™æ ·çš„äº‹æƒ…ã€‚å¾ˆä¸å¹¸çš„æ˜¯ï¼Œæœ‰ä¸€äº›ç‰ˆæœ¬çš„ @command{echo} ä¼šå¯¹å®ƒçš„å‚æ•°åˆ—è¡¨ä¸­çš„è½¬ä¹‰åºåˆ—è¿›è¡Œæ±‚å€¼ï¼Œæœ‰å¯èƒ½ä¼šå¼„ä¹±ç¨‹åºæ–‡æœ¬ã€‚ä½¿ç”¨ @command{expr} å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚ï¼‰

@item @option{--source}, @option{--source=}, @option{-Wsource=}
æºä»£ç è¢«é™„åŠ åˆ°ç¨‹åº @code{program} ä¸­ã€‚

@item @option{--version}, @option{-Wversion}
@command{igawk} æ‰“å°å®ƒçš„ç‰ˆæœ¬å·ï¼Œè¿è¡Œ @samp{gawk --version} æ¥å–å¾— @command{gawk} çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œç„¶åé€€å‡ºã€‚
@end table

å¦‚æœ @option{-f}ï¼Œ@option{--file}ï¼Œ@option{-Wfile}ï¼Œ@option{--source} æˆ–è€… @option{-Wsource} å‚æ•°ä¸€ä¸ªéƒ½æ²¡æœ‰æä¾›ï¼Œåˆ™ç¬¬ä¸€ä¸ªéé€‰é¡¹å‚æ•°ä¼šç”¨ä½œ @command{awk} çš„ç¨‹åºã€‚å¦‚æœæ²¡æœ‰å…¶ä»–çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œ@command{igawk} æ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯åé€€å‡ºã€‚å¦åˆ™ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«é™„åŠ åˆ°ç¨‹åº @code{program}ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåœ¨å‚æ•°è¢«å¤„ç†åï¼ŒShell å˜é‡ç¨‹åºåŒ…å«æœ€åˆ @command{awk} ç¨‹åºçš„å®Œå…¨çš„æ–‡æœ¬ã€‚

ç¨‹åºå¦‚ä¸‹ï¼š

@cindex @code{igawk.sh} program
@example
@c file eg/prog/igawk.sh
#! /bin/sh
# igawk --- like gawk but do @@include processing
@c endfile
@ignore
@c file eg/prog/igawk.sh
#
# Arnold Robbins, arnold@@skeeve.com, Public Domain
# July 1993
# December 2010, minor edits
@c endfile
@end ignore
@c file eg/prog/igawk.sh

if [ "$1" = debug ]
then
    set -x
    shift
fi

# A literal newline, so that program text is formatted correctly
n='
'

# Initialize variables to empty
program=
opts=

while [ $# -ne 0 ] # loop over arguments
do
    case $1 in
    --)     shift
            break ;;

    -W)     shift
            # The $@{x?'message here'@} construct prints a
            # diagnostic if $x is the null string
            set -- -W"$@{@@?'missing operand'@}"
            continue ;;

    -[vF])  opts="$opts $1 '$@{2?'missing operand'@}'"
            shift ;;

    -[vF]*) opts="$opts '$1'" ;;

    -f)     program="$program$n@@include $@{2?'missing operand'@}"
            shift ;;

    -f*)    f=$(expr "$1" : '-f\(.*\)')
            program="$program$n@@include $f" ;;

    -[W-]file=*)
            f=$(expr "$1" : '-.file=\(.*\)')
            program="$program$n@@include $f" ;;

    -[W-]file)
            program="$program$n@@include $@{2?'missing operand'@}"
            shift ;;

    -[W-]source=*)
            t=$(expr "$1" : '-.source=\(.*\)')
            program="$program$n$t" ;;

    -[W-]source)
            program="$program$n$@{2?'missing operand'@}"
            shift ;;

    -[W-]version)
            echo igawk: version 3.0 1>&2
            gawk --version
            exit 0 ;;

    -[W-]*) opts="$opts '$1'" ;;

    *)      break ;;
    esac
    shift
done

if [ -z "$program" ]
then
     program=$@{1?'missing program'@}
     shift
fi

# At this point, `program' has the program.
@c endfile
@end example

å¤„ç† @code{@@include} æŒ‡ä»¤çš„ @command{awk} ç¨‹åºè¢«å­˜å‚¨åœ¨ Shell çš„å˜é‡ @code{expand_prog} ä¸­ã€‚è¿™ä¹ˆåšå¯ä»¥ä½¿å¾— Shell è„šæœ¬æ›´å¯è¯»ã€‚@command{awk} ç¨‹åºä½¿ç”¨ @code{getline} ï¼ˆæŸ¥çœ‹ @pxref{Getline}ï¼‰è¯»å–ç”¨æˆ·çš„ç¨‹åºï¼Œä¸€æ¬¡ä¸€è¡Œã€‚è¾“å…¥æ–‡ä»¶åä»¥åŠ @code{@@include} è¯­å¥ä½¿ç”¨æ ˆæ¥ç®¡ç†ã€‚
æ¯é‡åˆ°ä¸€ä¸ª @code{@@include}ï¼Œå½“å‰çš„æ–‡ä»¶åä¼šè¢«æ¨åˆ°æ ˆä¸­ï¼Œåœ¨ @code{@@include} ä¸­çš„@value{FN}åˆ™æˆä¸ºå½“å‰@value{FN}ã€‚æ¯å®Œæˆä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ™ä¼šå¯¹æ ˆè¿›è¡Œå¼¹å‡ºï¼Œè¿™æ ·å‰ä¸€ä¸ªæ–‡ä»¶ä¼šæˆä¸ºå½“å‰æ–‡ä»¶ã€‚å¤„ç†æ˜¯ä»¥æœ€å¼€å§‹çš„æ–‡ä»¶ä½œä¸ºæ ˆä¸­çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å¼€å§‹çš„ã€‚

@code{pathto()} å‡½æ•°å¤„ç†æŸ¥æ‰¾æ–‡ä»¶å…¨è·¯å¾„çš„äº‹æƒ…ã€‚å®ƒæ¨¡æ‹Ÿ @command{gawk} çš„æŸ¥æ‰¾ @env{AWKPATH}ï¼ˆæŸ¥çœ‹ @pxref{AWKPATH Variable}ï¼‰ ç¯å¢ƒå˜é‡çš„è¡Œä¸ºã€‚å¦‚æœæ–‡ä»¶åä¸­æœ‰ @samp{/}ï¼Œåˆ™ä¸ä¼šè¿›è¡Œè·¯å¾„æœç´¢ã€‚
ç±»ä¼¼åœ°ï¼Œå¦‚æœ@value{FN}æ˜¯@code{"-"}ï¼Œåˆ™ç›¸åº”çš„å­—ä¸²åˆ™åŸæ ·ä¸å˜ã€‚å¦åˆ™ï¼Œ@value{FN}è¢«ä¸è·¯å¾„ä¸­çš„æ¯ä¸€ä¸ªä¸Šè¿›è¿›è¡Œè¿æ¥ï¼Œå¹¶å°è¯•æ‰“å¼€ç”Ÿæˆçš„@value{FN}ã€‚å”¯ä¸€çš„æµ‹è¯•æ–‡ä»¶æ˜¯å¦å¯åœ¨ @command{awk} ä¸­è¿›è¡Œè¯»å–çš„æ–¹å¼æ˜¯ç»§ç»­é€šè¿‡ @code{getline} æ¥å°è¯•è¯»å–ï¼Œè¿™æ­£æ˜¯ @code{pathto()} æ‰€åšçš„ã€‚
@footnote{åœ¨ä¸€äº›éå¸¸è€çš„ @command{awk} ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ä½†ä¸ºç©ºï¼Œ@samp{getline junk < t} è¿™æ ·çš„æµ‹è¯•èƒ½å¤Ÿæ°¸è¿œå¾ªç¯ã€‚}
å¦‚æœæ–‡ä»¶å¯è¯»ï¼Œåˆ™å…³é—­å®ƒï¼ŒæŠŠè¿”å›@value{FN}ï¼š

@ignore
An alternative way to test for the file's existence would be to call
@samp{system("test -r " t)}, which uses the @command{test} utility to
see if the file exists and is readable.  The disadvantage to this method
is that it requires creating an extra process and can thus be slightly
slower.
@end ignore

@example
@c file eg/prog/igawk.sh
expand_prog='

function pathto(file,    i, t, junk)
@{
    if (index(file, "/") != 0)
        return file

    if (file == "-")
        return file

    for (i = 1; i <= ndirs; i++) @{
        t = (pathlist[i] "/" file)
@group
        if ((getline junk < t) > 0) @{
            # found it
            close(t)
            return t
        @}
@end group
    @}
    return ""
@}
@c endfile
@end example

ä¸»ç¨‹åºåŒ…å«åœ¨ @code{BEGIN} è§„åˆ™ä¸­ã€‚å®ƒæ‰€åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è®¾ç½®ä¸€ä¸ª @code{pathlist} æ•°ç»„ç»™ @code{pathto()} ä½¿ç”¨ã€‚åœ¨ä½¿ç”¨ @samp{:} åˆ†å‰²è·¯å¾„ä¹‹åï¼Œç©ºçš„å…ƒç´ ç”¨ @code{"."} è¿›è¡Œæ›¿æ¢ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯å½“å‰è·¯å¾„ï¼š

@example
@c file eg/prog/igawk.sh
BEGIN @{
    path = ENVIRON["AWKPATH"]
    ndirs = split(path, pathlist, ":")
    for (i = 1; i <= ndirs; i++) @{
        if (pathlist[i] == "")
            pathlist[i] = "."
    @}
@c endfile
@end example

æ ˆä½¿ç”¨ @code{ARGV[1]} æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œå®ƒçš„å€¼ä¸º @code{"/dev/stdin"}ã€‚åé¢åˆ™æ˜¯ä¸»å¾ªç¯ã€‚è¾“å…¥è¡Œä¼šä¸€è¡Œè¡Œè¿ç»­ã€‚ä¸èƒ½ @code{@@include} å¼€å§‹çš„è¡Œåˆ™ä¼šåŸæ ·æ‰“å°ã€‚å¦‚æœè¡Œç¡®å®æ˜¯ä»¥ @code{@@include} å¼€å§‹çš„ï¼Œåˆ™@value{FN}ä¼šå­˜å‚¨åœ¨ @code{$2} ä¸­ã€‚
@code{pathto()} ç”¨æ¥äº§ç”Ÿå®Œæ•´çš„è·¯å¾„ã€‚å¦‚æœæ²¡æ³•äº§ç”Ÿï¼Œç¨‹åºåˆ™æ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯åç»§ç»­ã€‚

ä¸‹ä¸€ä¸ªè¦åšçš„äº‹æƒ…å°±æ˜¯æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ç»è¢«åŒ…å«ã€‚å·²ç»å¤„ç†çš„æ•°ç»„ @code{processed} ç”¨å·²ç»åŒ…å«çš„@value{FN}çš„å…¨åæ¥è¿›è¡Œç´¢å¼•ï¼Œå®ƒä¼šä¸ºæˆ‘ä»¬è·Ÿè¸ªç›¸åº”çš„ä¿¡æ¯ã€‚å¦‚æœæ–‡ä»¶å†æ¬¡çœ‹åˆ°ï¼Œä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ã€‚å¦åˆ™æ–°çš„@value{FN}ä¼šè¢«æ¨åˆ°æ ˆä¸­å¹¶ç»§ç»­å¤„ç†ã€‚

æœ€åï¼Œå½“ @code{getline} é‡åˆ°äº†è¾“å…¥çš„æ–‡ä»¶å°¾ï¼Œæ–‡ä»¶åˆ™è¢«å…³é—­ï¼Œæ ˆå¼¹å‡ºã€‚å½“ @code{stackptr} å°äº 0 æ—¶ï¼Œç¨‹åºå®Œæˆï¼š

@example
@c file eg/prog/igawk.sh
    stackptr = 0
    input[stackptr] = ARGV[1] # ARGV[1] is first file

    for (; stackptr >= 0; stackptr--) @{
        while ((getline < input[stackptr]) > 0) @{
            if (tolower($1) != "@@include") @{
                print
                continue
            @}
            fpath = pathto($2)
@group
            if (fpath == "") @{
                printf("igawk: %s:%d: cannot find %s\n",
                    input[stackptr], FNR, $2) > "/dev/stderr"
                continue
            @}
@end group
            if (! (fpath in processed)) @{
                processed[fpath] = input[stackptr]
                input[++stackptr] = fpath  # push onto stack
            @} else
                print $2, "included in", input[stackptr],
                    "already included in",
                    processed[fpath] > "/dev/stderr"
        @}
        close(input[stackptr])
    @}
@}'  # close quote ends `expand_prog' variable

processed_program=$(gawk -- "$expand_prog" /dev/stdin << EOF
$program
EOF
)
@c endfile
@end example

Shell çš„ @samp{@var{command} << @var{marker}} ç»“æ„ç§°ä¸º@dfn{å°±åœ°æ–‡æ¡£}ã€‚åœ¨ Shell è„šæœ¬ä¸­çš„åˆ°è¿™ä¸ªæ ‡å¿— @var{marker} çš„æ‰€æœ‰å†…å®¹éƒ½è¢«å½“æˆæ˜¯ @var{command} çš„è¾“å…¥ã€‚ Shell å¤„ç†å°±åœ°æ–‡æ¡£çš„å†…å®¹ç”¨äºå˜é‡ä¸å‘½ä»¤çš„æ›¿æ¢ï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„äº‹æƒ…ï¼Œè¿™è¦çœ‹ Shellï¼‰ã€‚

Shell çš„ @samp{$(@dots{})} è¿™æ ·çš„ç»“æ„ç§°ä¸º@dfn{å‘½ä»¤æ›¿æ¢}ã€‚åœ¨æ‹¬å·ä¸­çš„å‘½ä»¤çš„è¾“å‡ºä¼šæ›¿æ¢å‘½ä»¤è¡Œã€‚å› ä¸ºç»“æœä¼šåœ¨å˜é‡èµ‹å€¼ä¸­ä½¿ç”¨ï¼Œå®ƒä¼šè¢«å­˜æˆä¸€ä¸ªå•ç‹¬çš„å­—ä¸²ï¼Œå°±ç®—ç»“æœåŒ…å«ç©ºæ ¼ã€‚

å±•å¼€çš„ç¨‹åºè¢«ä¿å­˜åœ¨å˜é‡ @code{processed_program} ä¸­ã€‚å®ƒé€šè¿‡ä¸‹é¢å‡ æ­¥æ¥å®Œæˆï¼š

@enumerate
@item
ä¸ä»æ ‡å‡†è¾“å…¥è¯»å–çš„ @code{@@include} ç¨‹åºä¸€èµ·æ‰§è¡Œ @command{gawk}ï¼ˆå³ @code{expand_prog} Shell å˜é‡çš„å€¼ï¼‰ã€‚

@item
æ ‡å‡†è¾“å…¥æ˜¯ç”¨æˆ·ç¨‹åºçš„å†…å®¹ï¼Œæ¥è‡ªäº Shell å˜é‡ç¨‹åº @code{program}ã€‚å°†å®ƒçš„å†…å®¹é€šè¿‡å°±åœ°æ–‡æ¡£çš„æ–¹å¼çŒå…¥ @command{gawk} ä¸­ã€‚

@item
å°†è¿™ä¸ªå¤„ç†çš„ç»“æœä½¿ç”¨å‘½ä»¤æ›¿æ¢å­˜åˆ° Shell å˜é‡ @code{processed_program} ä¸­ã€‚
@end enumerate

æœ€åä¸€æ­¥ä½¿ç”¨å±•å¼€çš„ç¨‹åºä»¥åŠç”¨æˆ·æä¾›çš„æœ€åˆçš„é€‰é¡¹ä»¥åŠå‘½ä»¤è¡Œå‚æ•°è°ƒç”¨ @command{gawk} ï¼š

@example
@c file eg/prog/igawk.sh
eval gawk $opts -- '"$processed_program"' '"$@@"'
@c endfile
@end example

@command{eval} å‘½ä»¤æ˜¯ä¸€ä¸ª Shell ç»“æœç”¨æ¥é‡æ–°æ‰§è¡Œ Shell çš„åˆ†æè¿‡ç¨‹ã€‚è¿™ä½¿å¾—å†…å®¹ä¼šè¢«æ°å½“åœ°å¼•èµ·æ¥ã€‚

@command{igawk} çš„è¿™ä¸ªç‰ˆæœ¬å‘ˆç°äº†è¿™ä¸ªç¨‹åºçš„ç¬¬äº”ä¸ªç‰ˆæœ¬ã€‚æœ‰ 4 ä¸ªå…³é”®çš„ç®€åŒ–ä½¿å¾—ç¨‹åºè¿è¡Œå¾—æ›´å¥½ï¼š

@itemize @value{BULLET}
@item
ä½¿ç”¨ @code{@@include} ä½¿å¾—æœ€å¼€å§‹çš„é›†åˆ @command{awk} ç¨‹åºæ›´ç®€å•ï¼Œå³ä½¿æ˜¯ä½¿ç”¨ @option{-f} æŒ‡å®šçš„æ–‡ä»¶åï¼Œæ‰€æœ‰çš„ @code{@@include} å¤„ç†éƒ½å¯ä»¥ä¸€æ¬¡å®Œæˆã€‚

@item
å½“æµ‹è¯•æ–‡ä»¶çš„å¯è®¿é—®æ€§ï¼Œä»¥åœ¨ä¸»ç¨‹åºä¸­ä½¿ç”¨æ—¶ï¼Œä¸ä¼šå°è¯•å­˜å‚¨åœ¨ @code{pathto()} å‡½æ•°ä¸­ä½¿ç”¨ @code{getline} è¯»å–çš„è¡Œã€‚è¿™ä½¿å¾—äº‹æƒ…å¾—åˆ°ç›¸å½“çš„ç®€åŒ–ã€‚

@item
åœ¨ @code{BEGIN} è§„åˆ™ä¸­ä½¿ç”¨ @code{getline} åœ¨ä¸€ä¸ªåœ°æ–¹å°±å®Œæˆæ‰€æœ‰çš„å·¥ä½œã€‚æ²¡æœ‰å¿…è¦å†è°ƒç”¨å¦å¤–ä¸€ä¸ªå¾ªç¯æ¥å¤„ç†åµŒå¥—çš„ @code{@@include} è¯­å¥ã€‚

@item
ä¸å°†å±•å¼€çš„ç¨‹åºå­˜åœ¨ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯å°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ª Shell å˜é‡ä¸­å¯ä»¥é¿å…ä¸€äº›æ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚ä½†è¿™ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå› ä¸ºè„šæœ¬è¦ä¾èµ–äº @command{sh} è¯­è¨€çš„æ›´å¤šç‰¹æ€§ï¼Œä½¿å¾—é‚£äº›ä¸ç†Ÿæ‚‰ @command{sh} çš„äººå¾ˆéªŒè¯äºè·Ÿè¸ªã€‚
@end itemize

åŒæ—¶ ï¼Œè¿™ä¸ªç¨‹åºä¹Ÿè¯´æ˜äº†å°† @command{sh} ä¸ @command{awk} ç¨‹åºæ··åˆä½¿ç”¨æ˜¯å€¼å¾—ä¸€è¯•çš„ã€‚ä½ å¯ä»¥é€šè¿‡è¿™æ ·æ¥å®Œæˆå¾ˆå¤šçš„äº‹æƒ…ï¼Œä¸ç”¨å¯»æ±‚æ›´åŠ åº•å±‚çš„ C æˆ–è€… C++ è¯­è¨€ï¼Œé€šå¸¸åœ¨ Shell ä¸­è¦æ¯” @command{awk} ä¹Ÿæ›´å®¹æ˜“æ¥å¤„ç†ç‰¹å®šç±»å‹çš„å­—ä¸²ä¸å‚æ•°æ“ä½œã€‚

æœ€å @command{igawk} å±•ç¤ºäº†ç»™ç¨‹åºæ·»åŠ æ–°çš„ç‰¹æ€§å¹¶ä¸æ€»æ˜¯å¿…è¦çš„ï¼Œå®ƒä»¬å¯ä»¥ä¸€å±‚å±‚å åŠ æ¥å®ç°ã€‚ 
@footnote{@command{gawk} è‡ªå·±æ¥å¤„ç† @code{@@include}ï¼Œä¸ºçš„æ˜¯æ”¯æŒå°† @command{awk} ç¨‹åºç”¨ä½œ WEB CGI è„šæœ¬ã€‚}


@node Anagram Program
@subsection ä»å­—å…¸ä¸­æŸ¥æ‰¾å•è¯

@cindex anagrams, finding
ä¸€ä¸ªæœ‰è¶£çš„ç¼–ç¨‹æŒ‘æˆ˜å°±æ˜¯åœ¨ä¸€ä¸ªå•è¯åˆ—è¡¨ä¸­æŸ¥æ‰¾@dfn{åŒå­—æ¯å¼‚åºè¯}ï¼ˆè¯çš„å­—æ¯é¡ºåºå˜æ¢åç»„æˆçš„æ–°è¯ï¼Œå¦‚åœ¨å¾ˆå¤šçš„ GNU/Linux ç³»ç»Ÿä¸­çš„ @file{/usr/share/dict/words}ï¼‰ã€‚å¦‚æœä¸¤ä¸ªå•è¯åŒ…å«ç›¸åŒçš„å­—æ¯ï¼Œåˆ™ä¸€ä¸ªå•è¯æ˜¯å¦ä¸€ä¸ªå•è¯çš„å­—è°œï¼ˆå¦‚ â€œbabblingâ€ ä¸ â€œblabbingâ€ï¼‰ã€‚

Jon Bentley æ‰€è‘—çš„ä¹¦ @cite{Programming Pearls}ï¼Œç¬¬äºŒç‰ˆï¼Œç¬¬äºŒå·çš„é—®é¢˜ Cï¼Œæå‡ºäº†ä¸€ä¸ªä¼˜é›…çš„ç®—æ³•ã€‚å…¶æ€æƒ³æ˜¯ç»™å•è¯çš„å­—è°œä¸€ä¸ªå…±åŒçš„ç®€å•ï¼Œå¹¶é€šè¿‡è¿™äº›ç­¾åæ¥å¯¹å•è¯è¿›è¡Œæ’åºï¼Œç„¶åæ‰“å°å®ƒä»¬ã€‚Bentley åšå£«å‘ç°å‘ç°ç”¨æ¯ä¸ªå•è¯ä¸­å‡ºç°çš„å­—æ¯ï¼Œå¹¶å¯¹å®ƒä»¬æ’åºæ¥ä½œä¸ºå•è¯çš„ç­¾å.

ä¸‹é¢çš„ç¨‹åºä½¿ç”¨å¤šç»´æ•°ç»„æ¥å°†æœ‰ç›¸åŒç­¾åçš„å•è¯ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä»¥åŠå¯¹æ•°ç»„æ’åºæ¥ä»¥æœ‰åºçš„æ–¹å¼æ‰“å°å•è¯ï¼š

@cindex @code{anagram.awk} program
@example
@c file eg/prog/anagram.awk
# anagram.awk --- An implementation of the anagram-finding algorithm
#                 from Jon Bentley's "Programming Pearls," 2nd edition.
#                 Addison Wesley, 2000, ISBN 0-201-65788-0.
#                 Column 2, Problem C, section 2.8, pp 18-20.
@c endfile
@ignore
@c file eg/prog/anagram.awk
#
# This program requires gawk 4.0 or newer.
# Required gawk-specific features:
#   - True multidimensional arrays
#   - split() with "" as separator splits out individual characters
#   - asort() and asorti() functions
#
# See http://savannah.gnu.org/projects/gawk.
#
# Arnold Robbins
# arnold@@skeeve.com
# Public Domain
# January, 2011
@c endfile
@end ignore
@c file eg/prog/anagram.awk

/'s$/   @{ next @}        # Skip possessives
@c endfile
@end example

ç¨‹åºä»¥ä¸€ä¸ªå¤´éƒ¨å¼€å§‹ï¼Œç„¶åè·³è¿‡åœ¨å­—å…¸æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ ¼ã€‚ä¸‹ä¸€ä¸ªè§„åˆ™åˆ™æ˜¯ç”¨æ¥å»ºç«‹æ•°ç»„ç»“æ„ã€‚æ•°ç»„çš„ç¬¬ä¸€ç»´ç”±ç­¾åæ¥è¿›è¡Œç´¢å¼•ï¼Œç¬¬äºŒç»´åˆ™æ˜¯å•è¯æœ¬èº«ï¼š

@example
@c file eg/prog/anagram.awk
@{
    key = word2key($1)  # Build signature
    data[key][$1] = $1  # Store word with signature
@}
@c endfile
@end example

@code{word2key()} ç”¨æ¥åˆ›å»ºç­¾åï¼Œå®ƒå°†å•è¯åˆ†æˆä¸€ä¸ªä¸ªçš„å­—ç¬¦ï¼Œå¹¶å¯¹å­—ç¬¦è¿›è¡Œæ’åºï¼Œç„¶åå†å°†å®ƒå…¨åˆå¹¶ï¼š

@example
@c file eg/prog/anagram.awk
# word2key --- split word apart into letters, sort, and join back together

function word2key(word,     a, i, n, result)
@{
    n = split(word, a, "")
    asort(a)

    for (i = 1; i <= n; i++)
        result = result a[i]

    return result
@}
@c endfile
@end example

æœ€åï¼Œ@code{END} è§„åˆ™ç”¨æ¥éå†æ•°ç»„ï¼Œç„¶åæ‰“å‡ºå‡ºå­—è°œåˆ—è¡¨ã€‚å®ƒä¼šå°†è¾“å‡ºç³»ç»Ÿçš„ @command{sort} å·¥å…·ï¼Œå› ä¸ºä¸è¿™ä¹ˆå¤„ç†ï¼Œå­—è°œå°±ä¼šä»¥éšæœºçš„é¡ºåºå‡ºç°ï¼š

@example
@c file eg/prog/anagram.awk
END @{
    sort = "sort"
    for (key in data) @{
        # Sort words with same key
        nwords = asorti(data[key], words)
        if (nwords == 1)
            continue

        # And print. Minor glitch: trailing space at end of each line
        for (j = 1; j <= nwords; j++)
            printf("%s ", words[j]) | sort
        print "" | sort
    @}
    close(sort)
@}
@c endfile
@end example

ç¨‹åºè¿è¡Œæ—¶ï¼Œä¸‹é¢æ˜¯éƒ¨åˆ†è¾“å‡ºï¼š

@example
$ @kbd{gawk -f anagram.awk /usr/share/dict/words | grep '^b'}
@dots{}
babbled blabbed
babbler blabber brabble
babblers blabbers brabbles
babbling blabbing
babbly blabby
babel bable
babels beslab
babery yabber
@dots{}
@end example


@node Signature Program
@subsection æ¥äº›æ–°é²œçš„

@cindex signature program
@cindex Brini, Davide
ä¸‹é¢çš„ç¨‹åºç”± Davide Brini ç¼–å†™å¹¶å‘å¸ƒåœ¨äº†@uref{http://backreference.org/2011/02/03/obfuscated-awk/, ä»–çš„ç½‘ç«™}ä¸Šã€‚
@c (@email{dave_br@@gmx.com})
å®ƒç”¨æ¥ä½œä¸ºä»–åœ¨ Usenet å°ç»„ @code{comp.lang.awk} çš„ç­¾åã€‚å®ƒæä¾›äº†ä¸‹é¢çš„ç‰ˆæœ¬å£°æ˜ï¼š

@quotation
Copyright @copyright{} 2008 Davide Brini

æ— è®ºæ˜¯å¦ä¿®æ”¹éƒ½å…è®¸åœ¨ä»»ä½•ä»‹è´¨ä¸Šï¼Œå¤åˆ¶å‘å¸ƒæœ¬é¡µä¸­å…¬å¼€çš„ä»£ç ï¼Œè€Œä¸éœ€è¦æä¾›æ­£å¼çš„ç‰ˆæœ¬å£°æ˜ï¼Œåªè¦ä¿ç•™æœ¬æç¤ºå³å¯ã€‚
@end quotation

è¿™é‡Œå®ƒçš„ç¨‹åºï¼š

@example
awk 'BEGIN@{O="~"~"~";o="=="=="==";o+=+o;x=O""O;while(X++<=x+o+o)c=c"%c";
printf c,(x-O)*(x-O),x*(x-o)-o,x*(x-O)+x-O-o,+x*(x-O)-x+o,X*(o*o+O)+x-O,
X*(X-x)-o*o,(x+X)*o*o+o,x*(X-x)-O-O,x-O+(O+o+X+x)*(o+O),X*X-X*(x-O)-x+O,
O+X*(o*(o+O)+O),+x+O+X*o,x*(x-o),(o+X+x)*o*o-(x-O-O),O+(X-x)*(X+O),x-O@}'
@end example

@cindex Johansen, Chris
ç¨‹åºåšçš„äº‹æƒ…ç”±ä½ æ¥ç¡®å®šã€‚ï¼ˆå¦‚æœä½ çœŸçš„åœ¨ç†è§£å®ƒæ—¶ç»æœ›äº†ï¼ŒæŸ¥çœ‹ Chris Johansen çš„è§£é‡Šï¼Œè¯¥è§£é‡Šå†…åµŒåœ¨æœ¬@value{DOCUMENT}çš„ Texinfo æºæ–‡ä»¶ä¸­ã€‚

@ignore
To: "Arnold Robbins" <arnold@skeeve.com>
Date: Sat, 20 Aug 2011 13:50:46 -0400
Subject: The GNU Awk User's Guide, Section 13.3.11
From: "Chris Johansen" <johansen@main.nc.us>
Message-ID: <op.v0iw6wlv7finx3@asusodin.thrudvang.lan>

Arnold, you don't know me, but we have a tenuous connection.  My wife is
Barbara A. Field, FAIA, GIT '65 (B. Arch.).

I have had a couple of paper copies of "Effective Awk Programming" for
years, and now I'm going through a Kindle version of "The GNU Awk User's
Guide" again.  When I got to section 13.3.11, I reformatted and lightly
commented Davide Brin's signature script to understand its workings.

It occurs to me that this might have pedagogical value as an example
(although imperfect) of the value of whitespace and comments, and a
starting point for that discussion.  It certainly helped _me_ understand
what's going on.  You are welcome to it, as-is or modified (subject to
Davide's constraints, of course, which I think I have met).

If I were to include it in a future edition, I would put it at some
distance from section 13.3.11, say, as a note or an appendix, so as not to
be a "spoiler" to the puzzle.

Best regards,
--
Chris Johansen {johansen at main dot nc dot us}
  . . . collapsing the probability wave function, sending ripples of
certainty through the space-time continuum.


#! /usr/bin/gawk -f

# From "13.3.11 And Now For Something Completely Different"
#   http://www.gnu.org/software/gawk/manual/html_node/Signature-Program.html#Signature-Program

# Copyright Â© 2008 Davide Brini

# Copying and distribution of the code published in this page, with
# or without modification, are permitted in any medium without
# royalty provided the copyright notice and this notice are preserved.

BEGIN {
  O = "~" ~ "~";    #  1
  o = "==" == "=="; #  1
  o += +o;          #  2
  x = O "" O;       # 11


  while ( X++ <= x + o + o ) c = c "%c";

  # O is  1
  # o is  2
  # x is 11
  # X is 17
  # c is "%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c"

  printf c,
    ( x - O )*( x - O),                  # 100 d
    x*( x - o ) - o,                     #  97 a
    x*( x - O ) + x - O - o,             # 118 v
    +x*( x - O ) - x + o,                # 101 e
    X*( o*o + O ) + x - O,               #  95 _
    X*( X - x ) - o*o,                   #  98 b
    ( x + X )*o*o + o,                   # 114 r
    x*( X - x ) - O - O,                 #  64 @
    x - O + ( O + o + X + x )*( o + O ), # 103 g
    X*X - X*( x - O ) - x + O,           # 109 m
    O + X*( o*( o + O ) + O ),           # 120 x
    +x + O + X*o,                        #  46 .
    x*( x - o),                          #  99 c
    ( o + X + x )*o*o - ( x - O - O ),   # 111 0
    O + ( X - x )*( X + O ),             # 109 m
    x - O                                #  10 \n
}
@end ignore

@node Programs Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
æœ¬@value{CHAPTER}ä¸­æä¾›çš„ç¨‹åºï¼Œå»¶ç»­äº†è¿™æ ·çš„ä¸»æ—¨ï¼Œå°±æ˜¯è¦å­¦å¥½ç¼–ç¨‹çš„ç»ˆææ–¹æ³•å°±æ˜¯å»é˜…è¯»ç¨‹åºã€‚

@item
ä½¿ç”¨ @samp{#!} æ¥ä½¿ç”¨ @command{awk} ç¨‹åºå¯ä»¥ç›´æ¥è¿è¡Œè€Œæ›´å¥½ä½¿ç”¨ã€‚å¦åˆ™å°±å¾—è¿™ä¹ˆæ¥è°ƒç”¨ç¨‹åºï¼š@samp{awk -f @dots{}}ã€‚

@item
ç”¨ @command{awk} é‡æ–°å®ç°æ ‡å‡†çš„ POSIX ç¨‹åºæ˜¯ä¸€ä¸ªä»¤äººæ„‰å¿«çš„ç»ƒä¹ ï¼Œ@command{awk} çš„è¡¨è¾¾çš„å¨åŠ›ä½ ä»¥è®©ä½ ç”¨å¾ˆå°‘çš„ä»£ç å°±æ¥å†™å‡ºè¿™æ ·çš„ç¨‹åºï¼ŒåŒæ—¶åŠŸèƒ½å®Œå¤‡å¹¶ä¸”å¯ç”¨ã€‚

@item
@command{awk} çš„ä¸€ä¸ªå¼±ç‚¹ä¹‹ä¸€å°±æ˜¯åœ¨å¤„ç†å•ä¸ªå­—ç¬¦çš„æ—¶å€™ã€‚ä½¿ç”¨ @code{split()} ä»¥åŠç©ºä¸²æ¥ä½œä¸ºåˆ†éš”ç¬¦å­—ä¸²çš„èƒ½åŠ›å¯ä»¥æå¤§åœ°ç®€åŒ–è¿™ä¸ªå·¥ä½œã€‚

@item
è¿™é‡Œçš„ä¾‹å­è¡¨æ˜äº†æ¥è‡ª @ref{Library Functions} çš„åº“å‡½æ•°å¯¹äºå¾ˆå¤šçš„ï¼ˆå°ï¼‰ç¨‹åºçš„ç”¨å¤„ã€‚

@item
é™¤äº†é‡æ–°å‘æ˜ POSIX è½®å­ï¼Œå…¶ä»–çš„ç¨‹åºå¯ä»¥è§£é‡Šå¾ˆå¤šçš„æœ‰è¶£çš„é—®é¢˜ï¼Œå¦‚æŸ¥æ‰¾æ–‡æœ¬ä¸­çš„é‡å¤å•è¯ï¼Œæ‰“å°é‚®ä»¶æ ‡ç­¾ï¼Œæˆ–è€…æŸ¥æ‰¾å­—è°œç­‰ã€‚

@end itemize

@c EXCLUDE START
@node Programs Exercises
@section ç»ƒä¹ 

@enumerate
@item
ä½¿ç”¨ @code{""} ä½œä¸ºåˆ†éš”ç¬¦æ¥è°ƒç”¨ @code{split()} æ¥é‡å†™ @file{cut.awk}ï¼ˆæŸ¥çœ‹ @pxref{Cut Program}ï¼‰ã€‚

@item
åœ¨ @ref{Egrep Program}ï¼Œä¸­æˆ‘ä»¬æåˆ°è¿‡ @samp{egrep -i} å¯ä»¥ä½¿ç”¨ @code{tolower()} ç”¨äºè¡Œä¸æ¨¡å¼æ¥æ¨¡æ‹Ÿ @command{awk} ä¸­æ²¡æœ‰ @code{IGNORECASE} ç‰ˆæœ¬çš„æƒ…å†µã€‚åœ¨é‚£ä¸ªé‡Œçš„ä¸€ä¸ªè„šæ³¨ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæåˆ°è¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰ä¸€ä¸ª Bugï¼šè¢«è½¬æ¢çš„è¡Œè¾“å‡ºåï¼Œä¸æ˜¯åŸæ¥çš„é‚£è¡Œã€‚è¯·ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚
@c Exercise: Fix this, w/array and new line as key to original line

@item
POSIX ç‰ˆæœ¬çš„ @command{id} é€šè¿‡é€‰é¡¹æ¥æ§åˆ¶è¦æ‰“å°ä»€ä¹ˆæ ·çš„ä¿¡æ¯ã€‚ä¿®æ”¹ @command{awk} ç‰ˆæœ¬ï¼ˆæŸ¥çœ‹ @pxref{Id Program}ï¼‰æ¥æ¥æ”¶ç›¸åŒçš„å‚æ•°å¹¶æ‰§è¡Œç›¸åŒçš„ç»“æœã€‚

@item
@code{split.awk} ç¨‹åºï¼ˆæŸ¥çœ‹ @pxref{Split Program}ï¼‰å‡è®¾å­—æ¯åœ¨å­—ç¬¦é›†æ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯å¯¹äº EBCDIC çš„ç³»ç»Ÿä¸Šå´ä¸æ˜¯è¿™æ ·çš„ã€‚è¯·ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚ï¼ˆæç¤ºï¼šè€ƒè™‘ä¸€ç§ä¸åŒçš„æ–¹æ³•æ¥éå†å­—æ¯è¡¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ @code{ord()} ä¸ @code{chr()} å‡½æ•°ã€‚ï¼‰

@item
åœ¨ @file{uniq.awk} ä¸­ï¼ˆæŸ¥çœ‹ @pxref{Uniq Program}ï¼‰ï¼Œé€‰æ‹©å“ªä¸€äº›æ¥æ‰“å°çš„é€»è¾‘è¡¨å¼ä¸€ç§@dfn{çŠ¶æ€æœº}ï¼Œå³â€œæŸä¸ªè®¾å¤‡å¯ä»¥å¤„äºæŸäº›ç¨³å®šçš„çŠ¶æ€ä¾èµ–äºå…¶å‰é¢çš„çŠ¶æ€ä»¥åŠå®ƒè¾“å…¥çš„å½“å‰å€¼â€ã€‚
@footnote{è¿™ä¸ªæ˜¯ç”±è¾“å…¥ @code{define: state machine} åˆ° Google è¿”å›çš„å®šä¹‰ã€‚}
Brian Kernighan åˆ™å»ºè®®â€œçŠ¶æ€æœºçš„å¦ä¸€ç§æ–¹å¼æ˜¯åªå°†è¾“å…¥è¯»åˆ°æ•°ç»„ä¸­ï¼Œç„¶åç›´æ¥ä½¿ç”¨ç´¢å¼•ã€‚è¿™å‡ ä¹æ€»æ˜¯èƒ½å¤Ÿä½¿ç”¨æ›´ç®€å•çš„ä»£ç æ¥å®ç°ï¼Œåœ¨ä½ ä½¿ç”¨è¿™ä¸ªæ–¹å¼çš„å¤§å¤šæ•°è¾“å…¥ä¸­ï¼Œæ˜¯éå¸¸å¿«çš„ã€‚â€è¯·æ ¹æ®è¿™æ ·çš„å»ºè®®æ¥é‡å†™ä¸Šé¢çš„é€»è¾‘ã€‚


@item
ä¸ºä»€ä¹ˆ @file{wc.awk}ï¼ˆæŸ¥çœ‹ @pxref{Wc Program}ï¼‰ç¨‹åºä¸å¯ä»¥åœ¨ @code{endfile()} ä¸­ä½¿ç”¨ @code{FNR} çš„å€¼ï¼Ÿæç¤ºï¼šæ£€æŸ¥ @ref{Filetrans Function}ï¼Œä¸­çš„ä»£ç ã€‚

@ignore
@command{wc} can't just use the value of @code{FNR} in
@code{endfile()}. If you examine the code in @ref{Filetrans Function},
you will see that @code{FNR} has already been reset by the time
@code{endfile()} is called.
@end ignore

@item
åœ¨è½¬æ¢ç¨‹åº @command{translate}ï¼ˆæŸ¥çœ‹ @pxref{Translate Program}ï¼‰ä¸­ä½¿ç”¨æ ‡å‡† @command{awk} å‡½æ•°æ“ä½œå•ä¸ªçš„å­—ç¬¦æ˜¯å¾ˆç—›è‹¦çš„ã€‚å‡è®¾ @command{gawk} å¯ä»¥ç”¨ @code{""} ä½œåˆ†éš”ç¬¦æ¥å°†å­—ä¸²åˆ†å‰²ä¸ºå•ç‹¬çš„å­—ç¬¦ï¼Œä½ ä¼šå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç‰¹å®šæ¥ç®€åŒ–ç¨‹åºï¼Ÿ

@item
@file{extract.awk} ç¨‹åºï¼ˆæŸ¥çœ‹ @pxref{Extract Program}ï¼‰æ˜¯åœ¨ @command{gawk} æœ‰ @code{gensub()} å‡½æ•°ä¹‹å‰å†™çš„ã€‚ä½¿ç”¨å®ƒæ¥ç®€åŒ–ä»£ç ã€‚

@item
ç”¨æ›´ç›´æ¥çš„æ–¹å¼æ¥æ¯”è¾ƒ @file{awksed.awk} ç¨‹åºï¼ˆæŸ¥çœ‹ @pxref{Simple Sed}ï¼‰çš„æ€§èƒ½ï¼š

@example
BEGIN @{
    pat = ARGV[1]
    repl = ARGV[2]
    ARGV[1] = ARGV[2] = ""
@}

@{ gsub(pat, repl); print @}
@end example

@item
ä¸çœŸæ­£çš„ @command{sed} å·¥å…·æ¯”èµ·æ¥ï¼Œ@file{awksed.awk} æœ‰ä»€ä¹ˆæ ·çš„ä¼˜ç¼ºç‚¹ï¼Ÿ

@ignore
  Advantage: egrep regexps
             speed (?)
  Disadvantage: no & in replacement text

Others?
@end ignore

@item
åœ¨ @ref{Igawk Program} ä¸­æˆ‘ä»¬æåˆ°ï¼Œå½“åœ¨æµ‹è¯•æ–‡ä»¶çš„å¯è®¿é—®æ€§æ—¶ï¼Œä¸è¦å°è¯•åœ¨ @code{pathto()} å‡½æ•°ä¸­å°† @code{getline} è¯»å–çš„è¡Œè¿›è¡Œä¿å­˜ï¼Œå¯ä»¥ä¸ä¸»ç¨‹åºçš„ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæå¤§åœ°ç®€åŒ–å®ç°ã€‚é‚£ä¹ˆè¿™é‡Œé¢åˆ°åº•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ
@c answer, reading from "-" or /dev/stdin

@cindex search paths
@cindex search paths, for source files
@cindex source files@comma{} search path for
@cindex files, source@comma{} search path for
@cindex directories, searching
@item
ä½œä¸ºå¹¶ä¸æ€»æ˜¯éœ€è¦ç»™ç¨‹åºåŠ æ–°åŠŸèƒ½çš„æƒ³æ³•çš„ä¸€ä¸ªé¢å¤–çš„ä¾‹å­å°±æ˜¯ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªæ–‡ä»¶åœ¨æœç´¢è·¯å¾„ä¸‹çš„æƒ³æ³•ï¼š

@table @file
@item default.awk
è¿™ä¸ªæ–‡ä»¶åŒ…å«é»˜è®¤å‡½æ•°é›†ï¼Œå¦‚ @code{getopt()} ä¸ @code{assert()}ã€‚

@item site.awk
è¿™ä¸ªæ–‡ä»¶åŒ…å«çš„åº“å‡½æ•°ç‰¹å®šäºæŸä¸ªç‚¹æˆ–è€…å®‰è£…ç‰ˆæœ¬ï¼Œå¦‚æœ¬åœ°çš„å¼€å‘å‡½æ•°ã€‚ç”¨è¿™æ ·çš„ä¸€ä¸ªç‹¬ç«‹æ–‡ä»¶å¯ä»¥ä½¿ @file{default.awk} è·Ÿéš @command{gawk} ç‰ˆæœ¬ä¸€åŒæ›´æ–°ï¼Œè€Œä¸éœ€è¦ç³»ç»Ÿçš„ç®¡ç†å‘˜æ·»åŠ ä¸€ä¸ªæœ¬åœ°å‡½æ•°çš„æ—¶å€™æ€»æ˜¯è¦æ›´æ–°å®ƒã€‚
@end table

æŸä¸ªç”¨æˆ·
@c Karl Berry, karl@ileaf.com, 10/95
æ›¾ç»å»ºè®® @command{gawk} è¦ä¿®æ”¹æˆè‡ªåŠ¨åœ°åœ¨å¯åŠ¨æ—¶è¯»å–è¿™äº›æ–‡ä»¶ã€‚ä½†æ˜¯ä¿®æ”¹ @command{igawk} æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ä¼šæ›´åŠ ç®€å•ã€‚å› ä¸º @command{igawk} å¯ä»¥å¤„ç†åµŒå¥—çš„ @code{@@include} æŒ‡ç¤ºç¬¦ï¼Œ@file{default.awk} å¯ä»¥åªæ˜¯ç®€å•åœ°åŒ…å« @code{@@include} è¯­å¥æ¥å¼•å…¥æ‰€éœ€è¦çš„åº“å‡½æ•°ã€‚è¯·ä½ åšè¿™äº›ä¿®æ”¹ã€‚

@item
ä¿®æ”¹ @file{anagram.awk}ï¼ˆæŸ¥çœ‹ @pxref{Anagram Program}ï¼‰æ¥é¿å…ä½¿ç”¨å¤–éƒ¨çš„ @command{sort} å·¥å…·ã€‚

@end enumerate
@c EXCLUDE END

@ifnotinfo
@part @value{PART3} ç”¨ @command{gawk} è¶…è¶Šæ ‡å‡† @command{awk}
@end ifnotinfo

@ifdocbook
Part III focuses on features specific to @command{gawk}.
It contains the following chapters:

@itemize @value{BULLET}
@item
@ref{Advanced Features}

@item
@ref{Internationalization}

@item
@ref{Debugger}

@item
@ref{Arbitrary Precision Arithmetic}

@item
@ref{Dynamic Extensions}
@end itemize
@end ifdocbook

@node Advanced Features
@chapter @command{gawk} çš„é«˜çº§ç‰¹æ€§
@cindex @command{gawk}, features, advanced
@cindex advanced features, @command{gawk}
@ignore
Contributed by: Peter Langston <pud!psl@bellcore.bellcore.com>

    Found in Steve English's "signature" line:

"Write documentation as if whoever reads it is a violent psychopath
who knows where you live."
@end ignore
@cindex Langston, Peter
@cindex English, Steve
@quotation
@i{
å†™æ–‡æ¡£å°±è¦åƒæŠŠè¯»å®ƒçš„äººå½“æˆçŸ¥é“ä½ ä½åœ¨å“ªçš„ç‹‚æš´çš„ç²¾ç¥å˜æ€è€…ã€‚
}
@author Steve English, as quoted by Peter Langston
@end quotation

è¿™ä¸€@value{CHAPTER}è®¨è®º @command{gawk} ä¸­çš„é«˜çº§ç‰¹æ€§ã€‚ä»–ä»¬åªæ˜¯äº’ä¸ç›¸å…³çš„ç¨‹åºå¤§éº»è¢‹ä¸­çš„ä¸€å°ç‚¹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šçœ‹ä¸€ä¸‹ä½¿ @command{gawk} ä¸è¯†åˆ«è¾“å…¥æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨ @command{awk} ç¨‹åºä¸­çš„åè¿›åˆ¶ç‚¹çš„é€‰é¡¹ã€‚ç„¶åï¼Œå†è®¨è®º @command{gawk} æ‰€ç‰¹æœ‰çš„å¯¹æ•°ç»„è¿›è¡Œæ’åºçš„ç‰¹æ€§ã€‚æ¥ä¸‹æ¥æ˜¯åŒè·¯ I/O é—®é¢˜ï¼Œåœ¨è¿™ä¹‹å‰æœ‰è¿‡ç®€å•çš„è®¨è®ºï¼Œè¿™é‡Œå°†ä¸ TCP/IP ç½‘ç»œä¸€èµ·è¿›è¡Œè¯¦ç»†çš„è®¨è®ºã€‚æœ€åï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ @command{gawk} å¦‚ä½•æ¥è¿›è¡Œ@dfn{è¯„æµ‹} @command{awk} ç¨‹åºï¼Œè¿™æ ·å¯ä»¥æ¥å¯¹å®ƒè¿›è¡Œæ€§èƒ½ä¸Šçš„è°ƒä¼˜ã€‚

@c FULLXREF ON
å…¶ä»–çš„é«˜çº§ç‰¹æ€§åˆ™åœ¨å…¶ä»–çš„@value{CHAPTER}ä¸­è¿›è¡Œè®¨è®ºï¼š

@itemize @value{BULLET}
@item
@ref{Internationalization}ï¼Œè®¨è®ºå¦‚ä½•æ¥å¯¹ä½ çš„ @command{awk} ç¨‹åºè¿›è¡Œå›½é™…åŒ–ï¼Œè¿™æ ·å®ƒä»¬å¯ä»¥è¯´å¤šå›½è¯­è¨€ã€‚

@item
@ref{Debugger}ï¼Œæè¿°äº† @command{gawk} çš„å†…ç½®çš„å‘½ä»¤è¡Œè°ƒè¯•å™¨æ¥è¿›è¡Œ @command{gawk} ç¨‹åºçš„è°ƒè¯•ã€‚

@item
@ref{Arbitrary Precision Arithmetic}ï¼Œå±•ç¤ºäº†ä½ å¦‚ä½•æ¥ä½¿ç”¨ @command{gawk} æ¥è¿›è¡Œä»»æ„ç²¾åº¦çš„ç®—æœ¯è¿ç®—ã€‚

@item
@ref{Dynamic Extensions}ï¼Œè®¨è®ºåŠ¨æ€åœ°ç»™ @command{gawk} æ·»åŠ æ–°çš„å†…ç½®å‡½æ•°çš„èƒ½åŠ›ã€‚
@end itemize
@c FULLXREF OFF

@menu
* Nondecimal Data::             Allowing nondecimal input data.
* Array Sorting::               Facilities for controlling array traversal and
                                sorting arrays.
* Two-way I/O::                 Two-way communications with another process.
* TCP/IP Networking::           Using @command{gawk} for network programming.
* Profiling::                   Profiling your @command{awk} programs.
* Advanced Features Summary::   Summary of advanced features.
@end menu

@node Nondecimal Data
@section å…è®¸éåè¿›åˆ¶æ•°æ•°æ®è¾“å…¥
@cindex @option{--non-decimal-data} option
@cindex advanced features, nondecimal input data
@cindex input, data@comma{} nondecimal
@cindex constants, nondecimal

å¦‚æœä½ ç”¨ @option{--non-decimal-data} è¿™ä¸ªé€‰é¡¹æ¥è¿è¡Œ @command{gawk}ï¼Œä½ å¯ä»¥åœ¨ä½ çš„è¾“å…¥æ•°æ®ä¸­ä½¿ç”¨éåè¿›åˆ¶æ•°æ•°å€¼ï¼š

@example
$ @kbd{echo 0123 123 0x123 |}
> @kbd{gawk --non-decimal-data '@{ printf "%d, %d, %d\n", $1, $2, $3 @}'}
@print{} 83, 123, 291
@end example

ä¸ºäº†ä½ è¿™ä¸ªç‰¹æ€§å¯ä»¥å·¥ä½œï¼Œä½ éœ€è¦åœ¨å†™ç¨‹åºæ—¶è®© @command{gawk} å°†è¿™äº›æ•°æ®å½“æˆæ˜¯æ•°å€¼ï¼š

@example
$ @kbd{echo 0123 123 0x123 | gawk '@{ print $1, $2, $3 @}'}
@print{} 0123 123 0x123
@end example

@noindent
@code{print} è¯­å¥å°†å®ƒçš„è¡¨è¾¾å¼å½“æˆæ˜¯å­—ä¸²ã€‚å°½ç®¡åŸŸåœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥è¡¨ç°æˆä¸€ä¸ªæ•°å€¼ï¼Œä½†å®ƒä»¬ä¾ç„¶æ˜¯å­—ä¸²ï¼Œæ‰€ä»¥ @code{print} ä¸ä¼šå°è¯•å°†å®ƒä»¬ä»¥æ•°å€¼æ¥çœ‹å¾…ã€‚ä½ éœ€è¦å‘åŸŸåŠ ä¸Šä¸€ä¸ª 0 æ¥å¼ºåˆ¶å®ƒè¢«å½“æˆæ•°å€¼ã€‚æ¯”å¦‚ï¼š

@example
$ @kbd{echo 0123 123 0x123 | gawk --non-decimal-data '}
> @kbd{@{ print $1, $2, $3}
>   @kbd{print $1 + 0, $2 + 0, $3 + 0 @}'}
@print{} 0123 123 0x123
@print{} 83 123 291
@end example

ç”±äºæœ‰åè¿›åˆ¶æ•°ä¹‹å‰æœ‰å‰å¯¼çš„ 0 æ˜¯å¾ˆå¸¸è§çš„ï¼Œä¹Ÿç”±äºä½¿ç”¨è¿™æ ·çš„æ–¹å¼å¯èƒ½å¯¼è‡´ä»¤äººæƒŠè®¶çš„ç»“æœï¼Œé»˜è®¤çš„æƒ…å†µæ˜¯ç¦ç”¨çš„ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ï¼Œä½ å¿…é¡»æ˜¾å¼åœ°æ¥æŒ‡å®šå®ƒã€‚

@cindex programming conventions, @code{--non-decimal-data} option
@cindex @option{--non-decimal-data} option, @code{strtonum()} function and
@cindex @code{strtonum()} function (@command{gawk}), @code{--non-decimal-data} option and
@quotation æ³¨æ„
@emph{ä¸æ¨èä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚}å®ƒä¼šå¯¼è‡´æ—§ç¨‹åºéå¸¸ç³Ÿç³•åœ°ç ´åã€‚ç›¸åï¼Œè¦ä½¿ç”¨ @code{strtonum()} å‡½æ•°æ¥è½¬æ¢ä½ çš„æ•°æ®ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ã€‚è¿™ä¹Ÿä½¿å¾—ä½ çš„ç¨‹åºæ›´å®¹æ˜“å†™ï¼Œä¹Ÿæ›´å®¹æ˜“è¯»ï¼Œç»“æœä¹Ÿä¸é‚£ä¹ˆä»¤äººæƒŠè®¶ã€‚

è¿™ä¸ªé€‰é¡¹å¯èƒ½åœ¨ @command{gawk} çš„åç»­ç‰ˆæœ¬ä¸­æ¶ˆå¤±ã€‚
@end quotation

@node Array Sorting
@section æ§åˆ¶æ•°ç»„æ’åºä¸éå†

@command{gawk} å¯ä»¥è®©ä½ åœ¨ @samp{for (@var{indx} in @var{array})} çš„å¾ªç¯è¿­ä»£æ•°ç»„æ—¶æ§åˆ¶å…¶é¡ºåºã€‚

å¦å¤–ï¼Œæœ‰ä¸¤ä¸ªå†…ç½®çš„å‡½æ•°ï¼Œ@code{asort()} ä¸ @code{asorti()} è®©ä½ ç”¨åŸºäºæ•°ç»„çš„å€¼ä¸ç´¢å¼•æ¥å¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚è¿˜æœ‰ä¸¤ä¸ªå‡½æ•°ç”¨æ¥åœ¨æ’åºè¿‡ç¨‹ä¸­æ§åˆ¶å…ƒç´ çš„é¡ºåºçš„æ’åºæ–¹æ¡ˆã€‚

@menu
* Controlling Array Traversal:: How to use PROCINFO["sorted_in"].
* Array Sorting Functions::     How to use @code{asort()} and @code{asorti()}.
@end menu

@node Controlling Array Traversal
@subsection æ§åˆ¶æ•°æ®éå†

åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ @samp{for (@var{indx} in @var{array})} å¾ªç¯ä¸­æ¥æ‰«ææ•°ç»„çš„é¡ºåºæ˜¯æœªå®šä¹‰çš„ï¼Œå®ƒä¸€èˆ¬åŸºäº @command{awk} ä¸­å¯¹äºæ•°ç»„çš„å®ç°ã€‚

é€šå¸¸æƒ…å†µä¸‹ï¼Œåšä¸ºç¨‹åºå‘˜çš„ä½ æ˜¯æƒ³æ¥ä»¥æŸç§ç‰¹å®šçš„é¡ºåºæ¥å¾ªç¯æ•°ç»„ä¸­çš„å…ƒç´ çš„ã€‚@command{gawk} å¯ä»¥è®©ä½ åšåˆ°è¿™ä¸ªã€‚

@ref{Controlling Scanning} ä¸­æè¿°äº†ä½ å¯ä»¥èµ‹å€¼ç»™æŸä¸ªç‰¹å®šé¢„å®šä¹‰çš„å˜é‡ @code{PROCINFO["sorted_in"]} ä»¥æ¥æ§åˆ¶ @command{gawk} åœ¨ @code{for} å¾ªç¯æ•°ç»„æ—¶çš„é¡ºåºã€‚

å¦å¤–ï¼Œ@code{PROCINFO["sorted_in"]} çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°åã€‚ 
@footnote{è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé¢„å®šä¹‰çš„æ’åºé¡ºåºéƒ½ä»¥ @samp{@@} å­—ç¬¦å¼€å¤´ï¼Œå®ƒä¸å¯ä»¥æ˜¯æ ‡è¯†ç¬¦çš„ä¸€éƒ¨ä»½ã€‚}
è¿™è®©ä½ ç”¨è‡ªå·±å®šä¹‰çš„æ–¹æ¡ˆæ¥éå†æ•°ç»„ã€‚æ•°ç»„çš„å…ƒç´ çš„æ’åºç”±è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ¥å†³å®šã€‚æ¯”è¾ƒå‡½æ•°åº”è¯¥å®šä¹‰æˆè‡³å°‘æœ‰å››ä¸ªå‚æ•°ï¼š

@example
function comp_func(i1, v1, i2, v2)
@{
    @var{compare elements 1 and 2 in some fashion}
    @var{return < 0; 0; or > 0}
@}
@end example

è¿™é‡Œé¢ @code{i1} ä¸ @code{i2} æ˜¯ç´¢å¼•ï¼Œè€Œ @code{v1} ä¸ @code{v2} æ˜¯ä¸¤ä¸ªæ­£åœ¨æ¯”è¾ƒçš„å…ƒç´ çš„å€¼ã€‚å¦‚æœæ­£åœ¨è¢«éå†çš„æ•°ç»„åŒ…å«äº†å­æ•°ç»„å…ƒç´ ï¼Œ@code{v1} ä¸ @code{v2} ä¹‹ä¸€æˆ–è€…ä¸¤è€…éƒ½å¯èƒ½æ˜¯æ•°ç»„ã€‚ï¼ˆæŸ¥çœ‹ @ref{Arrays of Arrays}ï¼Œæ¥å–å¾—å­æ•°ç»„çš„æ›´å¤šä¿¡æ¯ï¼‰ä¸‰ä¸­å¯èƒ½çš„è¿”å›å€¼å¦‚ä¸‹æ‰€è¿°ï¼š

@table @code
@item comp_func(i1, v1, i2, v2) < 0
åœ¨å¾ªç¯éå†æ—¶ï¼Œç´¢å¼• @code{i1} ä¼šå…ˆäº @code{i2}ã€‚

@item comp_func(i1, v1, i2, v2) == 0
ç´¢å¼• @code{i1} ä¸ @code{i2} æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯å…¶ç›¸å¯¹é¡ºåºæ˜¯æœªå®šä¹‰çš„ã€‚

@item comp_func(i1, v1, i2, v2) > 0
ç´¢å¼• @code{i1} ååœ¨ @code{i2} ä¹‹åã€‚
@end table

æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°å¯ä»¥ä»¥ç´¢å¼•çš„æ•°å€¼é¡ºåºæ¥æ‰«ææ•°ç»„ï¼š

@example
function cmp_num_idx(i1, v1, i2, v2)
@{
     # numerical index comparison, ascending order
     return (i1 - i2)
@}
@end example

æˆ‘ä»¬çš„ç¬¬äºŒä¸ªå‡½æ•°åŸºäºå…ƒç´ çš„å­—ä¸²å€¼æ¥éå†æ•°ç»„ï¼Œè€Œä¸æ˜¯åŸºäºç´¢å¼•ï¼š

@example
function cmp_str_val(i1, v1, i2, v2)
@{
    # string value comparison, ascending order
    v1 = v1 ""
    v2 = v2 ""
    if (v1 < v2)
        return -1
    return (v1 != v2)
@}
@end example

ç¬¬ä¸‰ä¸ªæ¯”è¾ƒå‡½æ•°ä½¿æ‰€æœ‰çš„æ•°å€¼ï¼Œå‰åæ²¡ç©ºæ ¼çš„æ•°å­—å­—ä¸²ï¼Œä¼šåœ¨å¾ªç¯æ—¶åœ¨å‰é¢ï¼š

@example
function cmp_num_str_val(i1, v1, i2, v2,   n1, n2)
@{
     # numbers before string value comparison, ascending order
     n1 = v1 + 0
     n2 = v2 + 0
     if (n1 == v1)
         return (n2 == v2) ? (n1 - n2) : -1
     else if (n2 == v2)
         return 1
     return (v1 < v2) ? -1 : (v1 != v2)
@}
@end example

è¿™æ˜¯ä¸€ä¸ªè¯´æ˜ @command{gawk} ä½¿ç”¨å‰é¢ä¸åŒå‡½æ•°æ—¶çš„ä¸åŒè¡¨ç°æ—¶çš„ä¸»ç¨‹åºï¼š

@example
BEGIN @{
    data["one"] = 10
    data["two"] = 20
    data[10] = "one"
    data[100] = 100
    data[20] = "two"

    f[1] = "cmp_num_idx"
    f[2] = "cmp_str_val"
    f[3] = "cmp_num_str_val"
    for (i = 1; i <= 3; i++) @{
        printf("Sort function: %s\n", f[i])
        PROCINFO["sorted_in"] = f[i]
        for (j in data)
            printf("\tdata[%s] = %s\n", j, data[j])
        print ""
    @}
@}
@end example

è¿™æ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„ç»“æœï¼š

@example
$ @kbd{gawk -f compdemo.awk}
@print{} Sort function: cmp_num_idx      @ii{Sort by numeric index}
@print{}     data[two] = 20
@print{}     data[one] = 10              @ii{Both strings are numerically zero}
@print{}     data[10] = one
@print{}     data[20] = two
@print{}     data[100] = 100
@print{}
@print{} Sort function: cmp_str_val      @ii{Sort by element values as strings}
@print{}     data[one] = 10
@print{}     data[100] = 100             @ii{String 100 is less than string 20}
@print{}     data[two] = 20
@print{}     data[10] = one
@print{}     data[20] = two
@print{}
@print{} Sort function: cmp_num_str_val  @ii{Sort all numeric values before all strings}
@print{}     data[one] = 10
@print{}     data[two] = 20
@print{}     data[100] = 100
@print{}     data[10] = one
@print{}     data[20] = two
@end example

è€ƒè™‘å¯¹ GNU/Linux ç³»ç»Ÿçš„å¯†ç æ–‡ä»¶ä¸­çš„é¡¹æŒ‰ç™»å½•åæ¥æ’åºã€‚ä¸‹é¢çš„ç¨‹åºå¯¹ç‰¹å®šåŸŸä½ç½®çš„æ¯”è¾ƒæ¥è¿›è¡Œè®°å½•çš„æ’åºå¯ç”¨äºè¿™ä¸ªç›®çš„ï¼š

@example
# passwd-sort.awk --- simple program to sort by field position
# field position is specified by the global variable POS

function cmp_field(i1, v1, i2, v2)
@{
    # comparison by value, as string, and ascending order
    return v1[POS] < v2[POS] ? -1 : (v1[POS] != v2[POS])
@}

@{
    for (i = 1; i <= NF; i++)
        a[NR][i] = $i
@}

END @{
    PROCINFO["sorted_in"] = "cmp_field"
    if (POS < 1 || POS > NF)
        POS = 1
    for (i in a) @{
        for (j = 1; j <= NF; j++)
            printf("%s%c", a[i][j], j < NF ? ":" : "")
        print ""
    @}
@}
@end example

å¯†ç æ–‡ä»¶ä¸­çš„æ¯ä¸€é¡¹çš„ç¬¬ä¸€ä¸ªåŸŸæ˜¯ç”¨æˆ·çš„ç™»å½•åï¼ŒåŸŸä¹‹é—´é€šè¿‡å†’å·åˆ†éš”ã€‚æ¯ä¸ªè®°å½•éƒ½å®šä¹‰äº†ä¸€ä¸ªå­æ•°ç»„ï¼Œæ¯ä¸ªåŸŸéƒ½æ˜¯å­æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚æ‰§è¡Œç¨‹åºä¼šäº§ç”Ÿå¦‚ä¸‹è¾“å‡ºï¼š

@example
$ @kbd{gawk -v POS=1 -F: -f sort.awk /etc/passwd}
@print{} adm:x:3:4:adm:/var/adm:/sbin/nologin
@print{} apache:x:48:48:Apache:/var/www:/sbin/nologin
@print{} avahi:x:70:70:Avahi daemon:/:/sbin/nologin
@dots{}
@end example

å½“ç»™å®šä¸€ä¸ªç‰¹å®šçš„æ•°ç»„å…ƒç´ å¯¹æ—¶ï¼Œæ¯”è¾ƒåº”è¯¥æ€»æ˜¯è¿”å›ç›¸åŒçš„å€¼ã€‚å¦‚æœè¿”å›äº†ä¸ä¸€è‡´çš„å€¼ï¼Œåˆ™é¡ºåºæ˜¯æœªå®šä¹‰çš„ã€‚è¿™ä¸ªè¡Œä¸ºå¯ä»¥ç”¨æ¥ç»™çœ‹èµ·æ¥æœ‰åºçš„æ•°æ®å¼•å…¥éšæœºé¡ºåºï¼š

@example
function cmp_randomize(i1, v1, i2, v2)
@{
    # random order (caution: this may never terminate!)
    return (2 - 4 * rand())
@}
@end example

å¦‚æ—©å‰æ‰€æåˆ°çš„ï¼Œå¦‚æœä¸¤ä¸ªå…ƒç´ æ¯”è¾ƒç›¸åŒï¼Œåˆ™ä¸¤ä¸ªå…ƒç´ çš„ç´¢å¼•çš„é¡ºåºæ˜¯ä»»æ„çš„ã€‚è¿™ä¸€èˆ¬éƒ½ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è®©ä¸¤ä¸ªåœ¨ä¸€èµ·çš„å…ƒç´ ä»¥ä»»æ„çš„é¡ºåºå‡ºç°å´æ˜¯ä¸ªé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¤§æ¯”è¾ƒä¸¤è€…çš„å€¼çš„æ—¶å€™ã€‚å¦‚æœå…¶ä»–çš„å…ƒç´ åŠ å…¥æˆ–è€…ä»æ•°ç»„ä¸­ç§»é™¤ï¼Œå¯¹ç›¸åŒå…ƒç´ é—´çš„éƒ¨åˆ†æ’åºåœ¨ä¸‹æ¬¡æ•°ç»„éå†æ—¶ä¼šæ”¹å˜ã€‚è§£å†³è¿™ä¸ªç»‘å®šå…ƒç´ çš„é—®é¢˜çš„æ–¹æ³•ä¹‹ä¸€æ˜¯ï¼Œå½“æ¯”è¾ƒä¸¤å…ƒç´ å€¼ç›¸åŒæ—¶ï¼Œè¦å†æ¯”è¾ƒå®ƒä»¬çš„ç´¢å¼•ã€‚è¿™ä¹ˆåšçš„è¯ï¼Œä¼šä½¿å¾—å¾ªç¯éå†æ²¡æœ‰é‚£é«˜æ•ˆï¼Œæ‰€ä»¥ï¼Œåªåœ¨å¿…è¦çš„æ—¶å€™è€ƒè™‘ä½¿ç”¨å®ƒã€‚ä¸‹é¢çš„æ¯”è¾ƒå‡½æ•°ä¼šä¸€å®šä¼šæœ‰ç¡®å®šçš„é¡ºåºï¼Œæ˜¯åŸºäºä¸¤ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼ˆå­—ä¸²ï¼‰è‚¯å®šä¸ç›¸åŒè¿™æ ·çš„äº‹å®ï¼š

@example
function cmp_numeric(i1, v1, i2, v2)
@{
    # numerical value (and index) comparison, descending order
    return (v1 != v2) ? (v2 - v1) : (i2 - i1)
@}

function cmp_string(i1, v1, i2, v2)
@{
    # string value (and index) comparison, descending order
    v1 = v1 i1
    v2 = v2 i2
    return (v1 > v2) ? -1 : (v1 != v2)
@}
@end example

@c Avoid using the term ``stable'' when describing the unpredictable behavior
@c if two items compare equal.  Usually, the goal of a "stable algorithm"
@c is to maintain the original order of the items, which is a meaningless
@c concept for a list constructed from a hash.

ä¸€ä¸ªå®šåˆ¶çš„æ¯”è¾ƒå‡½æ•°å¸¸å¸¸å¯ä»¥ç®€å•å¾ªç¯éå†ï¼Œè€Œè®¾è®¡è¿™æ ·çš„å‡½æ•°çš„é™åˆ¶åªå—é™äºå¤©ç©ºçš„å¤§å°ã€‚

å½“åœ¨è¿›è¡Œæ’åºæ—¶ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯å­—ä¸²æ¯”è¾ƒï¼Œå…ƒç´ å€¼ä¹‹ä¸€æˆ–è€…ä¸¤è€…éƒ½ä¸ä¼šæ˜¯æ•°å€¼ï¼Œæˆ–è€…å…ƒç´ çš„ç´¢å¼•ä¼šè¢«å½“æˆå­—ä¸²æ¥å¤„ç†ï¼Œ@code{IGNORECASE} çš„å€¼ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰æ§åˆ¶æ¯”è¾ƒæ˜¯å¦å°†å¯¹åº”çš„å¤§å°å†™å­—æ¯å½“æˆä¸€æ ·çš„å­—ç¬¦æ¥çœ‹å¾…ã€‚

è¿˜è¦è®°ä½çš„ä¸€ç‚¹æ˜¯åœ¨å­æ•°ç»„çš„æƒ…å†µä¸‹ï¼Œå…ƒç´ å€¼æœ¬èº«å¯ä»¥æ˜¯æ•°ç»„ï¼Œæ¯”è¾ƒå‡½æ•°çš„ç»“æœåº”è¯¥ä½¿ç”¨ @code{isarray()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Type Functions}ï¼‰æ¥æ£€æµ‹ï¼Œå¹¶ä½¿ç”¨ä¸ºå­æ•°ç»„å®šä¹‰å¥½çš„é¡ºåºã€‚

æ‰€æœ‰åŸºäº @code{PROCINFO["sorted_in"]} çš„æ’åºåœ¨ POSIX æ¨¡å¼ä¸‹éƒ½è¢«ç¦ç”¨ï¼Œå› ä¸º @code{PROCINFO} æ•°ç»„åœ¨æ­¤ç§æƒ…å†µä¸‹å¹¶æ²¡æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚

å¦ä¸€ä¸ªæç¤ºå°±æ˜¯ï¼Œåœ¨éå†æ•°ç»„æ—¶å¯¹æ•°ç»„ç´¢å¼•çš„æ’åºå·²ç»æœ‰æŠ¥å‘Šè¯´ä¼šå¢åŠ  @command{awk} ç¨‹åºæ‰§è¡Œæ—¶ 15 % åˆ° 20 % çš„è´Ÿè·ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œæ’åºæ•°ç»„çš„éå†ä¸ä½œä¸ºé»˜è®¤è¡Œä¸ºã€‚

@c The @command{gawk}
@c maintainers believe that only the people who wish to use a
@c feature should have to pay for it.

@node Array Sorting Functions
@subsection ç”¨ @command{gawk} å¯¹æ•°ç»„è¿›è¡Œå€¼ä¸é”®çš„æ’åº

@cindex arrays, sorting
@cindexgawkfunc{asort}
@cindex @code{asort()} function (@command{gawk}), arrays@comma{} sorting
@cindexgawkfunc{asorti}
@cindex @code{asorti()} function (@command{gawk}), arrays@comma{} sorting
@cindex sort function, arrays, sorting
åœ¨å¤§å¤šæ•°çš„ @command{awk} å®ç°ä¸­ï¼Œå¯¹æ•°ç»„æ’åºéœ€è¦å†™ä¸€ä¸ª @code{sort()} å‡½æ•°ã€‚è¿™å¯¹äºå­¦ä¹ ä¸åŒçš„æ’åºç®—æ³•ä¹Ÿæ˜¯å¾ˆæœ‰æ•™è‚²ä½œç”¨çš„ï¼Œä½†æ˜¯é€šè¿‡é‚£ä¸æ˜¯ç¨‹åºçš„é‡ç‚¹ã€‚@command{gawk} æä¾›äº†å†…ç½®çš„ @code{asort()} ä¸ @code{asorti()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰æ¥å¯¹æ•°ç»„æ’åºã€‚å¦‚ï¼š

@example
@var{populate the array} data
n = asort(data)
for (i = 1; i <= n; i++)
    @var{do something with} data[i]
@end example

åœ¨è°ƒç”¨ @code{asort()} ä¹‹åï¼Œæ•°ç»„æ•°æ® @code{data} å·²ç»ä» 1 åˆ°æŸä¸ªæ•° @var{n}ï¼Œå³ @code{data} æ•°ç»„å…ƒç´ ä¸­çš„æ€»æ•°ï¼Œè¿›è¡Œäº†ç´¢å¼•ã€‚ï¼ˆè¿™ä¸ªç»Ÿè®¡ä½œä¸º @code{asort()} çš„è¿”å›å€¼ã€‚ï¼‰@code{data[1]} @value{LEQ} @code{data[2]} @value{LEQ} @code{data[3]} ä¾æ­¤ç±»æ¨ã€‚
é»˜è®¤çš„æ¯”è¾ƒæ˜¯åŸºäºå…ƒç´ çš„ç±»å‹ï¼ˆæŸ¥çœ‹ @pxref{Typing and Comparison}ï¼‰ã€‚æ‰€æœ‰çš„æ•°å€¼ç±»å‹åœ¨å­—ä¸²ç±»å‹ä¹‹å‰ï¼Œç„¶åæ˜¯æ‰€æœ‰çš„å­æ•°ç»„ã€‚

@cindex side effects, @code{asort()} function
è°ƒç”¨ @code{asort()} å‡½æ•°çš„ä¸€ä¸ªé‡è¦çš„å‰¯ä½œç”¨æ˜¯@emph{æ•°ç»„çš„åŸå§‹çš„ç´¢å¼•ä¸å¯æ¢å¤åœ°ä¸¢å¤±äº†}ã€‚è¿™å¹¶ä¸æ€»æ˜¯æ‰€è¦çš„ç»“æœã€‚@code{asort()} å¯ä»¥æˆå—ç¬¬äºŒä¸ªå‚æ•°ï¼š

@example
@var{populate the array} source
n = asort(source, dest)
for (i = 1; i <= n; i++)
    @var{do something with} dest[i]
@end example

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ@command{gawk} ä¼šå¤åˆ¶ @code{source} æ•°ç»„åˆ° @code{dest} æ•°ç»„ä¸­ï¼Œç„¶åå¯¹ @code{dest} è¿›è¡Œæ’åºï¼Œå¹¶å¯¼è‡´å…¶ç´¢å¼•çš„ç ´åã€‚ä½†æ˜¯ï¼Œ@code{source} æ•°ç»„åˆ™ä¸å½±å“ã€‚

ç»å¸¸æƒ…å†µä¸‹ï¼Œæ˜¯éœ€è¦å¯¹@emph{ç´¢å¼•}çš„å€¼è¿›è¡Œæ’åºï¼Œè€Œä¸æ˜¯å¯¹å…ƒç´ çš„å€¼è¿›è¡Œæ’åºã€‚ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œåˆ™ä½¿ç”¨ @code{asorti()} å‡½æ•°ã€‚è¿™ä¸ªæ¥å£ä¸å…¶è¡Œä¸ºä¸ @code{asort()} æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ä½¿ç”¨ç´¢å¼•çš„å€¼æ¥è¿›è¡Œæ’åºï¼Œå¹¶ä¸”æˆä¸ºç»“æœæ•°ç»„çš„å€¼ï¼š

@example
@{ source[$0] = some_func($0) @}

END @{
    n = asorti(source, dest)
    for (i = 1; i <= n; i++) @{
        @ii{Work with sorted indices directly:}
        @var{do something with} dest[i]
        @dots{}
        @ii{Access original array via sorted indices:}
        @var{do something with} source[dest[i]]
    @}
@}
@end example

åˆ°ç›®å‰ä¸ºæ­¢éƒ½è¿˜å¥½ã€‚ç°åœ¨å¼€å§‹è¿›å…¥æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚@code{asort()} ä¸ @code{asorti()} éƒ½æ¥æ”¶ç¬¬ä¸‰ä¸ªå­—ä¸²å‚æ•°æ¥æ§åˆ¶æ•°ç»„å…ƒç´ çš„æ¯”è¾ƒã€‚å½“æˆ‘ä»¬åœ¨ @ref{String Functions}ï¼Œå¼•å…¥ @code{asort()} ä¸ @code{asorti()} æ—¶ï¼Œæˆ‘ä»¬å¿½ç•¥äº†ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä½†æ˜¯ç°åœ¨æ˜¯æ—¶å€™æ¥æè¿°è¿™ä¸ªå‚æ•°å¦‚ä½•æ¥å½±å“è¿™ä¸¤ä¸ªå‡½æ•°ã€‚

åŸºæœ¬ä¸Šï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šæ•°ç»„å¦‚ä½•æ¥è¿›è¡Œæ’åºã€‚æœ‰ä¸¤ä¸ªå¯èƒ½ã€‚å¦‚ @code{PROCINFO["sorted_in"]} ä¸€æ ·ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ @command{gawk} æ‰€æä¾›çš„é¢„å®šä¹‰åå­—ä¸­çš„ä¸€ä¸ªï¼ˆæŸ¥çœ‹ @pxref{Controlling Scanning}ï¼‰ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°çš„åå­—ï¼ˆæŸ¥çœ‹ @pxref{Controlling Array Traversal}ï¼‰ã€‚

åœ¨åé¢çš„æƒ…å†µä¸‹ï¼Œ@emph{æŒ‡å®šçš„å‡½æ•°å¯ä»¥ä»¥ä»»ä½•é€‰æ‹©çš„æ–¹å¼æ¥æ¯”è¾ƒå…ƒç´ }ï¼Œå¯ä»¥åªè€ƒè™‘ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥åªè€ƒè™‘å€¼ï¼Œæˆ–è€…ä¸¤è€…éƒ½è€ƒè™‘ã€‚è¿™å°±ç›¸å½“å¼ºå¤§äº†ã€‚

ä¸€æ—¦æ•°ç»„ç»è¿‡æ’åºï¼Œ@code{asort()} ä¼šå–å¾—æœ€ç»ˆé¡ºåºçš„å€¼ï¼Œå¹¶ä½¿ç”¨ä»–ä»¬å¡«å…¥åˆ°ç»“æœæ•°ç»„ä¸­ï¼Œè€Œ @code{asorti()} å–æœ€ç»ˆé¡ºåºçš„@emph{ç´¢å¼•}å¹¶ä½¿ç”¨å®ƒä»¬å¡«å……åˆ°ç»“æœæ•°ç»„ä¸­ã€‚

@cindex reference counting, sorting arrays
@quotation æç¤º
å¤åˆ¶æ•°ç»„çš„ç´¢å¼•ä¸å…ƒç´ åœ¨å†…å­˜ä¸­ä»£ä»·å¹¶ä¸é«˜ã€‚åœ¨å†…éƒ¨ï¼Œ@command{gawk} ä¼šä¿æŒæ•°æ®çš„@dfn{å‚è€ƒè®¡æ•°}ã€‚å¦‚å½“ @code{asort()} å¤åˆ¶ç¬¬ä¸€ä¸ªå…ƒç´ åˆ°ç¬¬äºŒä¸ªæ—¶ï¼Œåªä¼šæœ‰ä¸€ä¸ªå…ƒç´ æ•°æ®çš„å¤æœ¬ï¼Œå°±ç®—ä¸¤ä¸ªæ•°ç»„ä½¿ç”¨è¿™ä¸ªå€¼ã€‚
@end quotation

@c Document It And Call It A Feature. Sigh.
@cindex @command{gawk}, @code{IGNORECASE} variable in
@cindex arrays, sorting, and @code{IGNORECASE} variable
@cindex @code{IGNORECASE} variable, and array sorting functions
å› ä¸º @code{IGNORECASE} å¯ä»¥å½±å“å­—ä¸²æ¯”è¾ƒï¼Œ@code{IGNORECASE} çš„å€¼ä¹Ÿä¼šå½±å“ @code{asort()} ä¸ @code{asorti()} çš„æ’åºã€‚ä¹Ÿè¦æ³¨æ„æœ¬åœ°è¯­è¨€è®¾ç½®ä¸­çš„æ’åºåˆ™@emph{ä¸ä¼š}æœ‰å½±å“ï¼Œæ¯”è¾ƒåªåŸºäºå­—ç¬¦çš„å€¼ã€‚ 
@footnote{å› ä¸ºåŸºäºæœ¬åœ°è¯­è¨€è®¾ç½®çš„æ¯”è¾ƒåªä¼šå‡ºç°åœ¨ POSIX çš„å…¼å®¹æ¨¡å¼ä¸­ï¼Œå› æ­¤è¿™ç¡®å®æ˜¯çœŸçš„ï¼Œå¹¶ä¸”ç”±äº @code{asort()} ä¸ @code{asorti()} æ˜¯ @command{gawk} çš„æ‰©å±•ï¼Œåœ¨ä¸Šé¢çš„è®¾ç½®ä¸­ï¼Œå®ƒä»¬æ˜¯ä¸å¯ç”¨çš„ã€‚}

ä¸‹é¢çš„æ˜¯æŠŠ @code{asort()} ç”¨äºæ¯”è¾ƒå‡½æ•°çš„ä¾‹å­ã€‚æ¯”è¾ƒå‡½æ•° @code{case_fold_compare()} ä¸ºäº†èƒ½å¿½ç•¥å¤§å°å†™æ¯”è¾ƒï¼ŒæŠŠä¸¤è€…çš„å€¼éƒ½è½¬æ¢æˆå°å†™å­—æ¯ã€‚

@example
# case_fold_compare --- compare as strings, ignoring case

function case_fold_compare(i1, v1, i2, v2,    l, r)
@{
    l = tolower(v1)
    r = tolower(v2)

    if (l < r)
        return -1
    else if (l == r)
        return 0
    else
        return 1
@}
@end example

ä¸‹é¢æ˜¯å®ƒçš„æµ‹è¯•ç¨‹åºï¼š

@example
# Test program

BEGIN @{
    Letters = "abcdefghijklmnopqrstuvwxyz" \
              "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    split(Letters, data, "")

    asort(data, result, "case_fold_compare")

    j = length(result)
    for (i = 1; i <= j; i++) @{
        printf("%s", result[i])
        if (i % (j/2) == 0)
            printf("\n")
        else
            printf(" ")
    @}
@}
@end example

å½“ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š

@example
$ @kbd{gawk -f case_fold_compare.awk}
@print{} A a B b c C D d e E F f g G H h i I J j k K l L M m
@print{} n N O o p P Q q r R S s t T u U V v w W X x y Y z Z
@end example

@node Two-way I/O
@section ä¸å…¶ä»–è¿›ç¨‹è¿›è¡ŒåŒå‘é€šä¿¡

@c 8/2014. Neither Mike nor BWK saw this as relevant. Commenting it out.
@ignore
@cindex Brennan, Michael
@cindex programmers, attractiveness of
@smallexample
@c Path: cssun.mathcs.emory.edu!gatech!newsxfer3.itd.umich.edu!news-peer.sprintlink.net!news-sea-19.sprintlink.net!news-in-west.sprintlink.net!news.sprintlink.net!Sprint!204.94.52.5!news.whidbey.com!brennan
From: brennan@@whidbey.com (Mike Brennan)
Newsgroups: comp.lang.awk
Subject: Re: Learn the SECRET to Attract Women Easily
Date: 4 Aug 1997 17:34:46 GMT
@c Organization: WhidbeyNet
@c Lines: 12
Message-ID: <5s53rm$eca@@news.whidbey.com>
@c References: <5s20dn$2e1@chronicle.concentric.net>
@c Reply-To: brennan@whidbey.com
@c NNTP-Posting-Host: asn202.whidbey.com
@c X-Newsreader: slrn (0.9.4.1 UNIX)
@c Xref: cssun.mathcs.emory.edu comp.lang.awk:5403

On 3 Aug 1997 13:17:43 GMT, Want More Dates???
<tracy78@@kilgrona.com> wrote:
>Learn the SECRET to Attract Women Easily
>
>The SCENT(tm)  Pheromone Sex Attractant For Men to Attract Women

The scent of awk programmers is a lot more attractive to women than
the scent of perl programmers.
--
Mike Brennan
@c brennan@@whidbey.com
@end smallexample
@end ignore

@cindex advanced features, processes@comma{} communicating with
@cindex processes, two-way communications with
æŠŠæ•°æ®å‘å‘å¦ä¸€ä¸ªå•ç‹¬çš„ç¨‹åºï¼Œå¤„ç†åå†è¯»å–ç»“æœé€šå¸¸éƒ½éå¸¸æœ‰ç”¨ã€‚è¿™å¯ä»¥é€šè¿‡ä¸´æ—¶æ–‡ä»¶æ¥åšåˆ°ï¼š

@example
# Write the data for processing
tempfile = ("mydata." PROCINFO["pid"])
while (@var{not done with data})
    print @var{data} | ("subprogram > " tempfile)
close("subprogram > " tempfile)

# Read the results, remove tempfile when done
while ((getline newdata < tempfile) > 0)
    @var{process} newdata @var{appropriately}
close(tempfile)
system("rm " tempfile)
@end example

@noindent
è¿™å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯æ²¡é‚£ä¹ˆä¼˜é›…ã€‚åœ¨å…¶ä»–äº‹æƒ…é—´ï¼Œå®ƒéœ€è¦ç¨‹åºè¿è¡Œä¸€ä¸ªä¸èƒ½è¢«å…¶å…¨ç”¨æˆ·å…±äº«çš„ç›®å½•ä¸­ï¼Œæ¯”å¦‚ @file{/tmp} å°±ä¸å¯ä»¥ï¼Œå› ä¸ºå…¶ä»–çš„ç”¨æˆ·æœ‰å¯èƒ½ç¢°å·§ä½¿ç”¨ç›¸åŒæ–‡ä»¶åçš„ä¸´æ—¶æ–‡ä»¶ã€‚
@footnote{Michael Brenna å»ºè®®ä½¿ç”¨ @command{rand()} æ¥äº§ç”Ÿå”¯ä¸€çš„@value{FN}ã€‚è¿™æ˜¯ä¸ªæœ‰æ•ˆçš„è§‚ç‚¹ï¼Œä½†æ˜¯ï¼Œä¸´æ—¶æ–‡ä»¶æ¯”èµ·åŒè·¯ç®¡é“æ¥è®²è¿˜æ˜¯å›°éš¾äº›ã€‚} @c 8/2014

@cindex coprocesses
@cindex input/output, two-way
@cindex @code{|} (vertical bar), @code{|&} operator (I/O)
@cindex vertical bar (@code{|}), @code{|&} operator (I/O)
@cindex @command{csh} utility, @code{|&} operator, comparison with
ä½†æ˜¯ï¼Œä½¿ç”¨ @command{gawk} å¯ä»¥æ‰“å¼€ä¸€ä¸ª@emph{åŒè·¯}çš„ç®¡é“åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚ç¬¬äºŒä¸ªè¿›ç¨‹è¢«ç§°ä¸º@dfn{å¹¶ç¨‹}ï¼Œå› ä¸ºå®ƒä¸ @command{gawk} ä¸€é“è¿è¡Œã€‚åŒè·¯è¿æ¥ä½¿ç”¨ @samp{|&} æ“ä½œç¬¦æ¥å»ºç«‹ï¼ˆä» Korn shellï¼Œ@command{ksh} å€Ÿæ¥çš„ï¼‰ï¼š 
@footnote{è¿™ä¸ Bash ä¸ C Shell ä¸­çš„æ“ä½œç¬¦éå¸¸ä¸åŒã€‚}

@example
do @{
    print @var{data} |& "subprogram"
    "subprogram" |& getline results
@} while (@var{data left to process})
close("subprogram")
@end example

ç¬¬ä¸€æ¬¡ä½¿ç”¨ @samp{|&} æ“ä½œç¬¦æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œ@command{gawk} ä¼šåˆ›å»ºä¸€ä¸ªåŒè·¯ç®¡çº¿åˆ°è¿›è¡Œå¦ä¸€ä¸ªç¨‹åºçš„å­è¿›ç¨‹ä¸­ã€‚ç”¨ @code{print} æˆ–è€… @code{printf} åˆ›å»ºçš„è¾“å‡ºä¼šè¢«å†™åˆ°ç¨‹åºçš„æ ‡å‡†è¾“å…¥ä¸­ï¼Œè€Œç¨‹åºçš„æ ‡å‡†è¾“å‡ºå¯ä»¥è¢« @command{gawk} çš„ç¨‹åºä½¿ç”¨ @code{getline} æ¥è¯»å–ã€‚ä¸é€šè¿‡ @samp{|} åˆ›å»ºçš„ç¨‹åºä¸€æ ·ï¼Œå­ç¨‹åºå¯ä»¥æ˜¯ä»»ä½•ç¨‹åºï¼Œæˆ–è€…ç¨‹åºçš„ç®¡çº¿ï¼Œå¯è¢« Shell å¯åŠ¨ã€‚

è¦äº†è§£çš„å‡ ä¸ªæ³¨æ„ç‚¹æ˜¯ï¼š

@itemize @value{BULLET}
@item
å°±ç›®å‰ @command{gawk} ä¸­çš„ä»£ç ï¼Œå¹¶ç¨‹çš„æ ‡å‡†é”™è¯¯ä¼šè¾“å‡ºåˆ°çˆ¶è¿›ç¨‹ @command{gawk} çš„æ ‡å‡†é”™è¯¯è¾“å‡ºçš„åœ°æ–¹ã€‚ä¸å¯ä»¥å•ç‹¬è¯»å–å­è¿›ç¨‹çš„æ ‡å‡†é”™è¯¯ã€‚

@cindex deadlocks
@cindex buffering, input/output
@cindex @code{getline} command, deadlock and
@item
I/O ç¼“å­˜å¯èƒ½æ˜¯ä¸ªé—®é¢˜ã€‚@command{gawk} ä¼šè‡ªåŠ¨åœ°åˆ·å‡ºæ‰€æœ‰çš„è¾“å‡ºåˆ°å¹¶ç¨‹ç®¡é“ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¹¶ç¨‹æ²¡æœ‰åˆ·å‡ºå®ƒçš„è¾“å‡ºï¼Œ@command{gawk} å¯èƒ½åœ¨æ‰§è¡Œ @code{getline} ä»¥è¯»å–å¹¶ç¨‹çš„è¾“å‡ºæ—¶è€ŒæŒ‚èµ·ã€‚è¿™ä¼šå¯¼è‡´æ‰€è°“çš„@dfn{æ­»é”}é—®é¢˜ï¼Œåœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹åšäº›ä»€ä¹ˆäº‹æƒ…ã€‚
@end itemize

@cindex @code{close()} function, two-way pipes and
å¯ä»¥åªå…³é—­åˆ°å¹¶ç¨‹çš„åŒè·¯ç®¡é“çš„ä¸€è¾¹ï¼Œåªéœ€è¦ä¸º @code{close()} å‡½æ•°çš„æä¾›ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ @code{"to"} æˆ–è€… @code{"from"}ï¼ˆæŸ¥çœ‹ @pxref{Close Files And Pipes}ï¼‰ã€‚è¿™äº›å­—ä¸²é€šçŸ¥ @command{gawk} å…³é—­ç®¡é“çš„ä¸€ç«¯ï¼Œå³å‘é€æ•°åˆ°å¹¶ç¨‹çš„ä¸€ç«¯ï¼Œæˆ–è€…ä»å…¶è¯»å–çš„ä¸€ç«¯ã€‚

@cindex @command{sort} utility, coprocesses and
å½“ä½¿ç”¨ @command{sort} ç³»ç»Ÿå·¥å…·ä½œä¸ºå¹¶ç¨‹çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œä¸Šé¢çš„è¡Œä¸ºå°¤å…¶é‡è¦ï¼Œ@command{sort} å¿…é¡»åœ¨äº§ç”Ÿæ‰€æœ‰çš„è¾“å‡ºä¹‹å‰å…ˆè¯»å–@emph{æ‰€æœ‰çš„}è¾“å…¥æ•°æ®ã€‚@command{sort} ç¨‹åºç›´åˆ° @command{gawk} å…³é”®ç®¡é“çš„å†™ä¸€ç«¯åï¼Œ@command{sort} æ‰ä¼šæ¥æ”¶åˆ° end-of-file çš„æŒ‡ç¤ºã€‚

å½“ä½ å®Œæˆäº†æ•°æ®è¾“å‡ºåˆ° @command{sort} å·¥å…·ï¼Œä½ å¯ä»¥å…³é—­ç®¡é“çš„ @code{"to"} ç«¯ï¼Œç„¶åç”¨ @code{getline} ä»å·²ç»æ’åºçš„æ•°æ®ä¸­è¯»å–ç»“æœã€‚ä¾‹å¦‚ï¼š

@example
BEGIN @{
    command = "LC_ALL=C sort"
    n = split("abcdefghijklmnopqrstuvwxyz", a, "")

    for (i = n; i > 0; i--)
        print a[i] |& command
    close(command, "to")

    while ((command |& getline line) > 0)
        print "got", line
    close(command)
@}
@end example

è¿™ä¸ªç¨‹åºå°†å­—æ¯è¡¨çš„å­—æ¯ä»¥é€†åºæ–¹å¼å†™å…¥ï¼Œä¸€æ¬¡ä¸€è¡Œï¼Œå†™åˆ° @command{sort} çš„åŒè·¯ç®¡é“ä¸­ã€‚ä¹‹åå…³é—­ç®¡é“çš„å†™ç«¯ï¼Œå› æ­¤ @command{sort} ä¼šæ¥æ”¶åˆ° end-of-file æŒ‡ç¤ºã€‚è¿™ä¼šå¯¼è‡´ @command{sort} æ¥æ’åºæ•°æ®ï¼Œç„¶åå°†æ’åºåçš„æ•°æ®å†™å›åˆ° @command{gawk} ç¨‹åºã€‚åªè¦æ‰€æœ‰çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ï¼Œ@command{gawk} ä¼šç»“æŸå¹¶ç¨‹ï¼Œç„¶åé€€å‡ºã€‚

å¦å¤–ä¸€ä¸ªæç¤ºæ˜¯ï¼Œåœ¨ @command{sort} å‘½ä»¤çš„ @samp{LC_ALL=C} èµ‹å€¼ç”¨æ¥ä¿è¯ä¼ ç»Ÿçš„ Unixï¼ˆASCIIï¼‰æ’åºã€‚åœ¨è¿™é‡Œå¹¶ä¸æ˜¯ä¸¥æ ¼éœ€è¦ï¼Œä½†æ˜¯çŸ¥é“å¦‚ä½•æ¥åšä¹Ÿæ˜¯å¾ˆå¥½çš„ã€‚

å½“å…³é—­ä¸€ä¸ªåŒè·¯ç®¡é“çš„ @code{"from"} ç«¯çš„æ—¶å€™è¦å°å¿ƒï¼›åœ¨è¿™ä¸ªä¾‹å­ä¸­ @command{gawk} ç­‰å¾…å­è¿›ç¨‹é€€å‡ºï¼Œè¿™å¯èƒ½ä¼šå¼•èµ·ä½ çš„ç¨‹åºæŒ‚èµ·ã€‚
ï¼ˆå› æ­¤ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨å®é™…ä¸­ä¸å¦‚èƒ½å…³é—­ @code{"to"} ç«¯é‚£ä¹ˆæœ‰ç”¨ã€‚ï¼‰

@quotation æ³¨æ„
å†™ä¸€ä¸ªåŒè·¯ç®¡é“çš„å·²å…³é—­çš„ @code{"to"} ç«¯æ˜¯ä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚è¯»ä¸€ä¸ªåŒè·¯ç®¡é“å·²å…³é—­çš„ @code{"from"} ç«¯ä¹Ÿæ˜¯ä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚
@end quotation

@cindex @command{gawk}, @code{PROCINFO} array in
@cindex @code{PROCINFO} array, and communications via ptys
å¦‚æœç³»ç»Ÿæ”¯æŒï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ pseudo-ttys(ptys) ç”¨æ¥ä»£æ›¿ç®¡é“æ¥åšåŒè·¯é€šä¿¡ã€‚è¿™æ˜¯é€šè¿‡åŸºäºå•å‘½ä»¤æ¥å®Œæˆçš„ï¼Œåªè¦è®¾ç½® @code{PROCINFO} æ•°ç»„çš„ç‰¹æ®Šå…ƒç´ çš„å€¼æ¥å®ç°ï¼ˆæŸ¥çœ‹ @pxref{Auto-set}ï¼‰ï¼Œå¦‚ï¼š

@example
command = "sort -nr"           # command, save in convenience variable
PROCINFO[command, "pty"] = 1   # update PROCINFO
print @dots{} |& command           # start two-way pipe
@dots{}
@end example

@noindent
å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰ ptysï¼Œæˆ–è€…ç³»ç»Ÿä¸­æ‰€æœ‰çš„ ptys éƒ½åœ¨ä½¿ç”¨ï¼Œ@command{gawk} ä¼šè‡ªåŠ¨åœ°è¿”å›ä½¿ç”¨å¸¸è§„çš„ç®¡é“ã€‚

ä½¿ç”¨ ptys å¯ä»¥é¿å…ç¼“å­˜æ­»é”çš„é—®é¢˜ï¼Œåªæ˜¯æŸå¤±ä¸€äº›æ€§èƒ½ã€‚
è¿™æ˜¯å› ä¸º tty driver æ˜¯ä¸€è¡Œä¸€è¡Œç¼“å­˜æ•°æ®å’Œå‘é€æ•°æ®çš„ã€‚åœ¨ç”¨ @command{stdbuf}ï¼ˆ@uref{http://www.gnu.org/software/coreutils/coreutils.html,
GNU Coreutils package}çš„ä¸€éƒ¨åˆ†ï¼‰çš„ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨é‚£ä¸ªç¨‹åºæ¥ä»£æ›¿ ptysã€‚

ä¹Ÿè¦æ³¨æ„ ptys ä¸æ˜¯å®Œå…¨é€æ˜çš„ã€‚æŸäº›äºŒè¿›åˆ¶æ§åˆ¶ä»£ç ï¼Œä¾‹å¦‚ç”¨ @kbd{Ctrl-d} è¡¨ç¤º end-of-fileï¼Œæ˜¯ç”± tty driver è§£é‡Šçš„ï¼Œä¸èƒ½ä¼ è¾“ã€‚

@quotation æ³¨æ„
æœ€åï¼Œå¹¶ç¨‹å¯¼è‡´äº† @command{gawk} å’Œå¹¶ç¨‹ä¸­è¿è¡Œçš„ç¨‹åºä¸­é—´äº§ç”Ÿæ­»é”çš„å¯èƒ½æ€§ã€‚
å¦‚æœä½ åœ¨å¾—åˆ°ä»»ä½•è¿”å›æ•°æ®ä¹‹å‰å‘é€â€œå¤ªå¤šâ€æ•°æ®ç»™å¹¶ç¨‹ï¼Œè¿™ä¼šå‘é€æ­»é”ï¼›æ¯ä¸ªå†™æ•°æ®çš„è¿›ç¨‹ä¼šé˜»å¡ï¼Œ
æ²¡æœ‰ä¸€ä¸ªèƒ½è¯»ä»–ä»¬å·²ç»å†™å…¥çš„æ•°æ®ã€‚æ­»é”æ²¡æœ‰ä»€ä¹ˆå˜é€šåŠæ³•ï¼›ä½ éœ€è¦å°å¿ƒåœ°ç¼–ç¨‹ï¼Œå¹¶ä¸”äº†è§£å¹¶ç¨‹çš„è¡¨ç°ã€‚
@end quotation

@node TCP/IP Networking
@section åˆ©ç”¨ @command{gawk} è¿›è¡Œç½‘ç»œé€šä¿¡
@cindex advanced features, network programming
@cindex networks, programming
@cindex TCP/IP
@cindex @code{/inet/@dots{}} special files (@command{gawk})
@cindex files, @code{/inet/@dots{}} (@command{gawk})
@cindex @code{/inet4/@dots{}} special files (@command{gawk})
@cindex files, @code{/inet4/@dots{}} (@command{gawk})
@cindex @code{/inet6/@dots{}} special files (@command{gawk})
@cindex files, @code{/inet6/@dots{}} (@command{gawk})
@cindex @code{EMRED}
@ifnotdocbook
@quotation
@code{EMRED}:@*
@ @ @ @ @i{A host is a host from coast to coast,@*
@ @ @ @ and nobody talks to a host that's close,@*
@ @ @ @ unless the host that isn't close@*
@ @ @ @ is busy, hung, or dead.}
@author Mike O'Brien (aka Mr.@: Protocol)
@end quotation
@end ifnotdocbook

@docbook
<blockquote>
<attribution>Mike O'Brien (aka Mr.&nbsp;Protocol)</attribution>
<literallayout class="normal"><literal>EMRED</literal>:
&nbsp;&nbsp;&nbsp;&nbsp;<emphasis>ä¸»æœºä»æµ·å²¸åˆ°æµ·å²¸ï¼Œ</emphasis>
&nbsp;&nbsp;&nbsp;&nbsp;<emphasis>æ²¡äººå¯ä¸å·²ç»å…³é—­çš„ä¸»æœºå–ƒå–ƒç§è¯­ï¼Œ</emphasis>
&nbsp;&nbsp;&nbsp;&nbsp;<emphasis>è€Œæ²¡å…³çš„ä¸»æœºè¦ä¹ˆå¿™å¾—æ­»ï¼Œ</emphasis>
&nbsp;&nbsp;&nbsp;&nbsp;<emphasis>è¦ä¹ˆæŒ‚èµ·æˆ–æ­»äº¡ã€‚</emphasis></literallayout>
</blockquote>
@end docbook

é™¤äº†å¯ä»¥åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­æ‰“å¼€ä¸€ä¸ªåŒè·¯åˆ°å¹¶ç¨‹çš„ç®¡çº¿ï¼ˆæŸ¥çœ‹ @pxref{Two-way I/O}ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ IP ç½‘ç»œè¿æ¥æ¥ä¸åœ¨å¦ä¸€ä¸ªç³»ç»Ÿä¸Šçš„å¦ä¸€ä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡ŒåŒè·¯è¿æ¥ã€‚

ä½ å¯ä»¥æŠŠè¿™ä¸ªå½“æˆæ˜¯ä¸€ä¸ª@emph{éå¸¸é•¿}çš„åˆ°å¹¶ç¨‹çš„åŒè·¯ç®¡çº¿ã€‚@command{gawk} ç¡®å®šä½ ä½¿ç”¨ TCP/IP ç½‘ç»œçš„æ–¹å¼æ˜¯é€šè¿‡è¯†åˆ«ä»¥ @samp{/inet/}ï¼Œ@samp{/inet4/}ï¼Œ æˆ–è€… @samp{/inet6/} å¼€å¤´çš„ç‰¹åˆ«@value{FN}ã€‚

ç‰¹æ®Š@value{FN}çš„å®Œæ•´è¯­æ³•ä¸º @file{/@var{net-type}/@var{protocol}/@var{local-port}/@var{remote-host}/@var{remote-port}}ã€‚è¿™äº›ç»„ä»¶ä¸ºï¼š

@table @var
@item net-type
æŒ‡å®šè¦å»ºç«‹çš„äº’è”ç½‘è¿æ¥çš„ç±»å‹ã€‚ä½¿ç”¨ @samp{/inet4/} æ¥å¼ºåˆ¶ä½¿ç”¨ IPv4ï¼Œ@samp{/inet6/} æ¥å¼ºåˆ¶ä¸º IPv6ã€‚æ™®é€šæ–‡æœ¬ @samp{/inet/} ï¼ˆè¿‡å»æ˜¯å”¯ä¸€çš„é€‰é¡¹ï¼‰ç”¨äºç³»ç»Ÿé»˜è®¤æ–¹å¼ï¼Œå¤§å¤šæ•°å¯èƒ½æ˜¯ IPv4ã€‚

@item protocol
åœ¨ IP ä¹‹ä¸Šä½¿ç”¨çš„åè®®ã€‚å¿…é¡»æ˜¯ @samp{tcp}ï¼Œ@samp{udp} ä¹‹ä¸€ï¼Œç›¸åº”å¯¹åº”ä¸º TCP æˆ–è€… UDP IP è¿æ¥ã€‚TCP ç”¨äºå¤§å¤šæ•°ç¨‹åºã€‚

@item local-port
@cindex @code{getaddrinfo()} function (C library)
æœ¬åœ° TCP æˆ–è€… UDP ç«¯å£ã€‚å¦‚æœä½ æƒ³è®©ç³»ç»Ÿé€‰æ‹©ç«¯å£ï¼Œåˆ™æŒ‡å®š @samp{0} ä¸ºå…¶ç«¯å£å·ã€‚å¦‚æœä½ åœ¨å†™ TCP æˆ–è€… UDP å®¢æˆ·ç«¯åˆ™ä½ åº”è¯¥è¿™ä¹ˆæ¥å¤„ç†ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨çŸ¥åçš„æœåŠ¡åï¼Œå¦‚ @samp{smtp} æˆ–è€… @samp{http}ï¼Œè¿™æ · @command{gawk} åœ¨ä½¿ç”¨ C çš„ @code{getaddinfo()} å‡½æ•°æ—¶ä¼šå°è¯•ç¡®å®šé¢„å®šä¹‰çš„ç«¯å£ã€‚

@item remote-host
ä½ è¦è¿æ¥çš„ä¸»æœºçš„ IP åœ°å€ï¼Œæˆ–è€…æ˜¯å®Œæ•´çš„ Internet åŸŸåã€‚

@item remote-port
è¿æ¥è¿œç¨‹ä¸»æœº @var{remote-host} çš„ TCP æˆ–è€… UDP ç«¯å£ã€‚å†æ¬¡åœ°ï¼Œä½ å¦‚æœä¸å…³å¿ƒç«¯å£å¯ä»¥ä½¿ç”¨ @samp{0}ï¼Œæˆ–è€…çŸ¥åçš„æœåŠ¡åã€‚
@end table

@cindex @command{gawk}, @code{ERRNO} variable in
@cindex @code{ERRNO} variable
@quotation æç¤º
æ— æ³•æ‰“å¼€åŒè·¯çš„ socket ä¼šå¯¼è‡´ä¸€ä¸ªè‡´å‘½é”™è¯¯è¿”å›åˆ°è°ƒç”¨çš„ä»£ç ã€‚@code{ERRNO} çš„å€¼æŒ‡ç¤ºäº†é”™è¯¯ä¿¡æ¯ï¼ˆæŸ¥çœ‹ @pxref{Auto-set}ï¼‰ã€‚
@end quotation

è€ƒè™‘ä¸‹é¢éå¸¸ç®€å•çš„ä¾‹å­ï¼š

@example
BEGIN @{
    Service = "/inet/tcp/0/localhost/daytime"
    Service |& getline
    print $0
    close(Service)
@}
@end example

è¿™ä¸ªç¨‹åºä»æœ¬åœ°ç³»ç»Ÿçš„ TCP @code{daytime} æœåŠ¡å™¨ä¸­è¯»å–å½“å‰çš„æ—¥æœŸåŠæ—¶é—´ã€‚ç„¶åæ‰“å°ç»“æœåå…³é—­è¿æ¥ã€‚

ç”±äºè¿™ä¸ªä¸»é¢˜æ˜¯æ‰©å±•å†…å®¹ï¼Œç”¨ @command{gawk} è¿›è¡Œ TCP/IP ç¼–ç¨‹ä¸ºç‹¬ç«‹çš„æ–‡æ¡£ã€‚
Because this topic is extensive, the use of @command{gawk} for
TCP/IP programming is documented separately.
@ifinfo
See
@inforef{Top, , General Introduction, gawkinet, @value{GAWKINETTITLE}},
@end ifinfo
@ifnotinfo
æŸ¥çœ‹ @uref{http://www.gnu.org/software/gawk/manual/gawkinet/,
@cite{@value{GAWKINETTITLE}}}ã€‚å®ƒæ˜¯ @command{gawk} å‘å¸ƒç‰ˆæœ¬çš„ä¸€éƒ¨åˆ†ï¼Œ
@end ifnotinfo
å…¶ä¸­æœ‰å®Œæ•´çš„ä»‹ç»ä¸è®¨è®ºï¼ŒåŒæ—¶æœ‰æ›´å¤šçš„ä¾‹å­ã€‚

@quotation æç¤º
@command{gawk} åªèƒ½æ‰“å¼€ç›´æ¥çš„ socketsã€‚ç°åœ¨æ²¡æœ‰åŠæ³•å»è·å– SSL çš„æœåŠ¡ï¼›è¿™åŒ…æ‹¬ä»»ä½• URL ä»¥ @samp{https://} å¼€å¤´çš„ç½‘ç«™æœåŠ¡ã€‚
@end quotation


@node Profiling
@section æµ‹è¯„ä½ çš„ @command{awk} ç¨‹åº
@cindex @command{awk} programs, profiling
@cindex profiling @command{awk} programs
@cindex @code{awkprof.out} file
@cindex files, @code{awkprof.out}

ä½ å¯ä»¥ç”Ÿæˆä½ çš„ @command{awk} ç¨‹åºæ‰§è¡Œçš„è·Ÿè¸ªä¿¡æ¯ã€‚è¿™åªè¦ä¼ é€’ @option{--profile} å‚æ•°åˆ° @command{gawk} å°±å¯ä»¥ã€‚å½“ @command{gawk} å®Œæˆåï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªåä¸º @file{awkprof.out} çš„æµ‹è¯„æ–‡ä»¶ã€‚ç”±äºç¨‹åºè¢«æµ‹è¯„ï¼Œè¿™æ ·å®ƒè¦æ¯”æ­£å¸¸çš„æ‰§è¡Œæ…¢ 45%ã€‚

@cindex @option{--profile} option
å¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼Œ@option{--profile} é€‰é¡¹å¯ä»¥æŒ‡å®š @command{gawk} å°†æµ‹è¯„ä¿¡æ¯å†™å…¥çš„æ–‡ä»¶çš„åå­—ï¼š

@example
gawk --profile=myprog.prof -f myprog.awk data1 data2
@end example

@noindent
åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œ@command{gawk} å°†æµ‹è¯„æ•°æ®æ”¾åœ¨ @file{myprog.prof} æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ @file{awkprof.out} æ–‡ä»¶ã€‚

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ @command{awk} ç¨‹åºçš„æ‰§è¡Œä¿¡æ¯ï¼ŒåŒ…å«è¾“å…¥æ•°æ®ï¼Œä»¥åŠç”¨ @option{--profile} æ‰§è¡Œ @command{gawk} æ—¶çš„ç»“æœã€‚é¦–å…ˆï¼Œä¸‹é¢æ˜¯ @command{awk} ç¨‹åºï¼š

@example
BEGIN @{ print "First BEGIN rule" @}

END @{ print "First END rule" @}

/foo/ @{
    print "matched /foo/, gosh"
    for (i = 1; i <= 3; i++)
        sing()
@}

@{
    if (/foo/)
        print "if is true"
    else
        print "else is true"
@}

BEGIN @{ print "Second BEGIN rule" @}

END @{ print "Second END rule" @}

function sing(    dummy)
@{
    print "I gotta be me!"
@}
@end example

Following is the input data:

@example
foo
bar
baz
foo
junk
@end example

ä¸‹é¢æ˜¯ä½¿ç”¨ @command{gawk} æµ‹è¯„å™¨æ‰§è¡Œç¨‹åºä¸æ•°æ®æ—¶çš„äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶ @file{awkprof.out}ï¼ˆè¿™ä¸ªä¾‹å­ä¹Ÿè¯´æ˜äº† @command{awk} ç¨‹åºå‘˜æœ‰æ—¶å¾ˆæ—©å°±èµ·æ¥å·¥ä½œäº†ï¼‰ï¼š

@cindex @code{BEGIN} pattern, and profiling
@cindex @code{END} pattern, and profiling
@example
    # gawk profile, created Mon Sep 29 05:16:21 2014

    # BEGIN rule(s)

    BEGIN @{
 1          print "First BEGIN rule"
    @}

    BEGIN @{
 1          print "Second BEGIN rule"
    @}

    # Rule(s)

 5  /foo/ @{ # 2
 2          print "matched /foo/, gosh"
 6          for (i = 1; i <= 3; i++) @{
 6                  sing()
            @}
    @}

 5  @{
 5          if (/foo/) @{ # 2
 2                  print "if is true"
 3          @} else @{
 3                  print "else is true"
            @}
    @}

    # END rule(s)

    END @{
 1          print "First END rule"
    @}

    END @{
 1          print "Second END rule"
    @}


    # Functions, listed alphabetically

 6  function sing(dummy)
    @{
 6          print "I gotta be me!"
    @}
@end example

è¿™ä¸ªä¾‹å­è¯´æ˜äº†æµ‹è¯„è¾“å‡ºçš„ä¸€äº›åŸºæœ¬ç‰¹æ€§ã€‚å®ƒä»¬æ˜¯ï¼š

@itemize @value{BULLET}
@item
ç¨‹åºä»¥ @code{BEGIN} è§„åˆ™ï¼Œæ¨¡å¼-åŠ¨ä½œè§„åˆ™ï¼Œ@code{BEGINFILE} è§„åˆ™ï¼Œ@code{ENDFILE} è§„åˆ™ï¼Œ@code{END} è§„åˆ™è¿™æ ·çš„é¡ºåºæ¥æ‰“å°è¾“å‡ºã€‚å¹¶ä»¥å­—æ¯é¡ºåºåˆ—è¡¨ã€‚å¤šä¸ª @code{BEGIN} ä¸ @code{END} è§„åˆ™ä¼šæœ‰å•ç‹¬çš„æ ‡è¯†ï¼Œ@code{BEGINFILE} ä¸ @code{ENDFILE} ä¹Ÿä¸€æ ·ã€‚

@cindex patterns, counts, in a profile
@item
æ¨¡å¼-åŠ¨ä½œè§„åˆ™æœ‰ä¸¤ä¸ªç»Ÿè®¡ï¼Œç¬¬ä¸€ä¸ªæ˜¯è§„åˆ™çš„å·¦è¾¹ï¼Œæ˜¾ç¤ºçš„æ˜¯è§„åˆ™çš„æ¨¡å¼è¢«@emph{æµ‹è¯•}çš„æ¬¡æ•°ã€‚ç¬¬äºŒä¸ªåˆ†æ˜¯è§„åˆ™çš„å³è¾¹åœ¨å¼€èŠ±å·ä¸­åœ¨æ³¨é‡Šé‡Œé¢ï¼Œæ˜¾ç¤ºçš„æ˜¯è§„åˆ™è¢«@emph{æ‰§è¡Œ}çš„æ¬¡æ•°ã€‚ä¸¤ä¸ªæ•°å€¼çš„å·®å¼‚æ˜¾ç¤ºçš„æ˜¯è§„åˆ™æ¨¡å¼è¢«æµ‹è¯•ä¸º false çš„æ¬¡æ•°ã€‚

@item
ç›¸ä¼¼çš„ï¼Œå¯¹äº @code{if}-@code{else} è¯­å¥çš„ç»Ÿè®¡æ˜¾ç¤ºäº†æ¡ä»¶è¢«æµ‹è¯•çš„æ¬¡æ•°ã€‚åœ¨å¼€èŠ±æ‹¬å·çš„å³è¾¹çš„ @code{if} çš„è¯­å¥ä½“å¤„çš„ç»Ÿè®¡æ˜¾ç¤ºçš„æ˜¯æ¡ä»¶æµ‹è¯•ä¸ºçœŸçš„æ¬¡æ•°ã€‚@code{else} çš„ç»Ÿè®¡æ˜¾ç¤ºçš„æ˜¯æµ‹è¯•å¤±è´¥çš„æ¬¡æ•°ã€‚

@cindex loops, count for header, in a profile
@item
å¯¹äºå¾ªç¯å¤´çš„ç»Ÿè®¡ï¼ˆå¦‚ @code{for} æˆ–è€… @code{while}ï¼‰æ˜¾ç¤ºçš„æ˜¯å¾ªç¯æµ‹è¯•æ‰§è¡Œçš„æ¬¡æ•°ã€‚ï¼ˆç”±äºè¿™ä¸ªåŸå› ï¼Œä½ ä¸å¯åªçœ‹åœ¨è§„åˆ™ä¸­çš„ç¬¬ä¸€æ¡è¯­å¥çš„ç»Ÿè®¡æ¥ç¡®å®šè§„åˆ™è¢«æ‰§è¡Œçš„æ¬¡æ•°ã€‚å¦‚æœç¬¬ä¸€æ¡è¯­å¥æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œåˆ™ç»Ÿè®¡ä¼šè¯¯å¯¼ä½ ã€‚ï¼‰

@cindex functions, user-defined, counts, in a profile
@cindex user-defined, functions, counts, in a profile
@item
å¯¹äºç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œåœ¨ @code{function} å…³é”®è¯åé¢çš„ç»Ÿè®¡æ˜¾ç¤ºçš„æ˜¯å‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°ã€‚åœ¨å‡½æ•°ä½“è¯­å¥è¯­å¥åé¢çš„ç»Ÿè®¡ï¼Œåˆ™æ˜¯è¯­å¥è¢«æ‰§è¡Œçš„æ¬¡æ•°ã€‚

@cindex @code{@{@}} (braces)
@cindex braces (@code{@{@}})
@item
è¾“å‡ºå¸ƒå±€ä½¿ç”¨çš„æ˜¯ â€œK&Râ€ å¸¦ TABs çš„é£æ ¼ã€‚èŠ±æ‹¬å·ä¼šåˆ°å¤„ä½¿ç”¨ï¼Œå°±ç®—æ˜¯ @code{if}ï¼Œ@code{else}ï¼Œæˆ–è€…å¾ªç¯ä½“åªæœ‰ä¸€ä¸ªè¯­å¥ã€‚

@cindex @code{()} (parentheses), in a profile
@cindex parentheses @code{()}, in a profile
@item
æ‹¬å·åˆ™åªåœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ï¼Œå®ƒç”±ç¨‹åºçš„ç»“æ„ ä»¥åŠå‰é¢è§„åˆ™æ¥æç¤ºã€‚ä¾‹å¦‚ï¼Œ@samp{(3 + 5) * 4} è¡¨ç¤º 3 åŠ  5ï¼Œç„¶åä¹˜ä¸Š 4 çš„ç»“æœã€‚ä½†æ˜¯ @samp{3 + 5 * 4} æ²¡æœ‰æ‹¬å·ï¼Œåˆ™è¡¨ç¤º @samp{3 + (5 * 4)}ã€‚

@ignore
@item
All string concatenations are parenthesized too.
(This could be made a bit smarter.)
@end ignore

@item
æ‹¬å·åªç”¨åœ¨ @code{print} ä¸ @code{printf} å‚æ•°å‘¨å›´ï¼Œå¹¶ä¸”åªå½“ @code{print} ä¸ @code{printf} çš„è¯­å¥åé¢è·Ÿç€é‡å®šå‘ç¬¦ã€‚ç›¸ä¼¼çš„ï¼Œå¦‚æœé‡å®šå‘çš„ç›®æ ‡ä¸æ˜¯æ ‡é‡ï¼Œåˆ™å®ƒä¼šè¢«æ‹¬èµ·æ¥ã€‚

@item
@command{gawk} æä¾› @code{BEGIN} ä¸ @code{END} è§„åˆ™ï¼Œ@code{BEGINFILE} ä¸ @code{ENDFILE} è§„åˆ™ï¼Œæ¨¡å¼-åŠ¨ä½œè§„åˆ™ä¸å‡½æ•°çš„å‰å¯¼æ³¨é‡Šã€‚

@end itemize

ä½ çš„ç¨‹åºçš„æµ‹è¯„ç‰ˆæœ¬å¯èƒ½ä¸ä¼šå®Œå…¨åƒä½ æ‰€å†™çš„é‚£æ ·ã€‚è¿™æ˜¯å› ä¸º @command{gawk} ç”¨â€œç®€æ´æ‰“å°â€å…¶ç¨‹åºçš„å†…éƒ¨è¡¨ç¤ºæ¥ç”Ÿæˆçš„æµ‹è¯„ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ @command{gawk} å¯ä»¥äº§ç”Ÿæ ‡å‡†çš„è¡¨ç¤ºã€‚ä¸å¥½çš„åœ°æ–¹æ˜¯ä¼šä¸¢å¤±ç¨‹åºçš„ä»£ç ã€‚åŒæ—¶ï¼Œåƒè¿™æ ·çš„ä»£ç ï¼š

@example
/foo/
@end example

@noindent
ä¼šç”Ÿæˆï¼š

@example
/foo/   @{
    print $0
@}
@end example

@noindent
è™½ç„¶æ­£ç¡®ï¼Œä½†å¯èƒ½å¹¶ä¸æ˜¯æ‰€æœŸæœ›çš„ã€‚

@cindex profiling @command{awk} programs, dynamically
@cindex @command{gawk} program, dynamic profiling
@cindex dynamic profiling
å½“ç¨‹åºæ‰§è¡Œå®Œæˆåä¼šç”Ÿæˆæµ‹è¯„å¤–ï¼Œ@command{gawk} ä¹Ÿå¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™ç”Ÿæˆã€‚å¦‚æœä½ çš„ @command{awk} ç¨‹åºä¼šè¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œè€Œä½ åˆæƒ³çœ‹æ‰§è¡Œäº†ä»€ä¹ˆçš„æ—¶å€™ï¼Œè¿™ä¼šéå¸¸æœ‰ç”¨ã€‚ä¸ºäº†ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œè¯·åœ¨åå°æ¨¡å¼æ¥æ‰§è¡Œå¸¦ @option{--profile} é€‰é¡¹çš„ @command{gawk} ï¼š

@example
$ @kbd{gawk --profile -f myprog &}
[1] 13992
@end example

@cindex @command{kill} command@comma{} dynamic profiling
@cindex @code{USR1} signal, for dynamic profiling
@cindex @code{SIGUSR1} signal, for dynamic profiling
@cindex signals, @code{USR1}/@code{SIGUSR1}, for profiling
@noindent
shell ä¼šæ‰“å°ä¸€ä¸ªä»»åŠ¡å·ä»¥åŠè¿›ç¨‹ ID å·ï¼Œåœ¨è¿™é‡Œæ˜¯ 13992ã€‚ä½¿ç”¨ @command{kill} å‘½ä»¤æ¥å‘é€ @code{USR1} ä¿¡å·åˆ° @command{gawk} ï¼š

@example
$ @kbd{kill -USR1 13992}
@end example

@noindent
å¦‚é€šå¸¸æƒ…å†µï¼Œæµ‹è¯„çš„ç¨‹åºç‰ˆæœ¬è¢«å†™å…¥åˆ° @file{awkprof.out} æ–‡ä»¶ä¸­ï¼Œæˆ–è€…å†™å…¥åˆ°åœ¨ @option{--profile} é€‰é¡¹ä¸­æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚

ä½œä¸ºå¸¸è§„çš„æµ‹è¯„ï¼Œå¦‚ç¨æ—©æ˜¾ç¤ºçš„ï¼Œæµ‹è¯„ä¸­åŒ…å«ä»»ä½•æ´»åŠ¨çš„å‡½æ•°çš„è·Ÿè¸ªä¿¡æ¯ï¼š

@example
# Function Call Stack:

#   3. baz
#   2. bar
#   1. foo
# -- main --
@end example

ä½ å¯ä»¥å‘é€å¤šæ¬¡ @code{USR1} ä¿¡å·ã€‚æ¯å‘ä¸€æ¬¡ï¼Œæµ‹è¯„ä¸å‡½æ•°è°ƒç”¨è·¯å¾„ä¼šè¢«é™„åŠ åˆ°æµ‹è¯„æ–‡ä»¶ä¸­ã€‚

@cindex @code{HUP} signal, for dynamic profiling
@cindex @code{SIGHUP} signal, for dynamic profiling
@cindex signals, @code{HUP}/@code{SIGHUP}, for profiling
å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ @code{HUP} ä¿¡å·ï¼Œè€Œä¸æ˜¯ @code{USR1} ä¿¡å·ï¼Œ@command{gawk} ä¼šäº§ç”Ÿæµ‹è¯„ä¸å‡½æ•°è°ƒç”¨è·¯å¾„ä¿¡æ¯åé€€å‡ºã€‚

@cindex @code{INT} signal (MS-Windows)
@cindex @code{SIGINT} signal (MS-Windows)
@cindex signals, @code{INT}/@code{SIGINT} (MS-Windows)
@cindex @code{QUIT} signal (MS-Windows)
@cindex @code{SIGQUIT} signal (MS-Windows)
@cindex signals, @code{QUIT}/@code{SIGQUIT} (MS-Windows)
å½“ @command{gawk} åœ¨ MS-Windows ç³»ç»Ÿä¸Šè¿è¡Œæ—¶ï¼Œå®ƒä½¿ç”¨ @code{INT} ä¸ @code{QUIT} ä¿¡æ¯æ¥äº§ç”Ÿæµ‹è¯„ï¼Œåœ¨ä½¿ç”¨ @code{INT} ä¿¡å·æ—¶ï¼Œ@command{gawk} ä¼šé€€å‡ºã€‚è¿™é‡Œå› ä¸ºè¿™äº›ç³»ç»Ÿä¸æ”¯æŒ @command{kill} å‘½ä»¤ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡é”®ç›˜äº§ç”Ÿçš„ä¿¡å·æ¥å‘é€ç»™ç¨‹åºã€‚@code{INT} ä¿¡å·é€šè¿‡ @kbd{Ctrl-c} æˆ–è€… @kbd{Ctrl-BREAK} é”®æ¥äº§ç”Ÿï¼Œè€Œ @code{QUIT} ä¿¡æ¯åˆ™ç”± @kbd{Ctrl-\} é”®æ¥äº§ç”Ÿã€‚

æœ€åï¼Œ@command{gawk} ä¹Ÿæ¥æ”¶å…¶ä»–çš„é€‰é¡¹ï¼Œ@option{--pretty-print}ã€‚å½“è¿™ä¹ˆè°ƒç”¨æ—¶ï¼Œ@command{gawk} ä¼šâ€œç®€æ´æ‰“å°â€ç¨‹åºåˆ° @file{awkprof.out} ä¸­ï¼Œä¸å¸¦æ‰§è¡Œç»Ÿè®¡çš„æ–¹å¼ã€‚

@quotation æç¤º
@option{--pretty-print} ä¼šæ‰§è¡Œä½ çš„ç¨‹åºã€‚è¿™ä¼šåœ¨ä¸‹ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­æ”¹å˜ã€‚
@end quotation

@node Advanced Features Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
@option{--non-decimal-data} é€‰é¡¹å¯ä»¥ä½¿ @command{gawk} å°†å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶å¼çš„è¾“å…¥æ•°æ®å½“æˆæ˜¯å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶æ•°æ®å¯¹å¾…ã€‚è¿™ä¸ªé€‰é¡¹è¦å°å¿ƒä½¿ç”¨ï¼Œæˆ–è€…ä¸è¦ä½¿ç”¨ï¼Œè€Œæ˜¯è¦ä½¿ç”¨ @code{strtonum()}ã€‚ä¹Ÿè¦æ³¨æ„è¿™ä¸ªé€‰é¡¹åœ¨æœªæ¥çš„ @command{gawk} ç‰ˆæœ¬å¯èƒ½ä¼šæ¶ˆå¤±ã€‚

@item
ä½ å¯ä»¥å®Œå…¨æ§åˆ¶åœ¨ @samp{for (@var{indx} in @var{array})} ä¸­è¿›è¡Œæ•°ç»„éå†çš„æ’åºæ–¹å¼ï¼Œè¿™é€šè¿‡å°†é¢„å®šä¹‰çš„ @code{PROCINFO["sorted_in"]} å˜é‡è®¾ç½®ä¸ºç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°åï¼Œè€Œè¿™ä¸ªå‡½æ•°åˆ™é€šè¿‡å¯¹ç´¢å¼•ä¸å€¼çš„æ¯”è¾ƒæ¥è¿›è¡Œå…ƒç´ çš„æ¯”è¾ƒã€‚

@item
ç±»ä¼¼åœ°ï¼Œä½ ä¹Ÿå¯æä¾›ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°çš„åå­—æ¥ä½œä¸º @code{asort()} æˆ–è€… @code{asorti()} å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ¥æ§åˆ¶å‡½æ•°å¦‚ä½•æ¥å¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚æˆ–è€…ä½ ä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªé¢„å®šä¹‰æ§åˆ¶å­—ä¸²æ¥è®¾ç½® @code{PROCINFO["sorted_in"]} çš„å€¼ã€‚

@item
ä½ å¯ä»¥ä½¿ç”¨ @samp{|&} æ“ä½œç¬¦æ¥åˆ›å»ºä¸€ä¸ªåŒè·¯çš„åˆ°å¹¶ç¨‹çš„ç®¡é“ã€‚ä½ é€šè¿‡ @code{getline} æ¥ä»å¹¶ç¨‹ä¸­è¯»å–ï¼Œå¹¶é€šè¿‡ @code{print} æˆ–è€… @code{printf} æ¥å†™å…¥ã€‚ä½¿ç”¨ @code{close()} æ¥å®Œå…¨åœ°å…³é—­å¹¶ç¨‹ï¼Œæˆ–è€…å¯é€‰åœ°å…³é—­åŒè·¯é€šè¿‡ä¸­çš„ä¸€ç«¯ã€‚

@item
é€šè¿‡ä½¿ç”¨ç‰¹æ®Š@value{FN}ä»¥åŠ @samp{|&} æ“ä½œç¬¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ TCP/IPï¼ˆæˆ–è€… UDP/IPï¼‰æ¥ä¸äº’è”ç½‘ä¸Šçš„ä¸»æœºè¿›è¡Œè¿æ¥ã€‚@command{gawk} æ”¯æŒ IPv4ï¼Œä¹Ÿæ”¯æŒIPv6ã€‚

@item
ä½ å¯ä»¥ç”Ÿæˆç¨‹åºçš„è¯­å¥æµ‹è¯„ç»Ÿè®¡ã€‚è¿™ä¸ªå¯ä»¥è®©ä½ æ¥ç¡®å®šä½ ç¨‹åºçš„å“ªéƒ¨åˆ†å ç”¨äº†è¾ƒå¤šçš„æ—¶é—´ï¼Œä»¥è®©ä½ æ¥æ–¹ä¾¿åœ°å¯¹ä½ çš„ç¨‹åºè¿›è¡Œè°ƒä¼˜ã€‚å½“è¿›è¡Œæµ‹è¯„è¿›è¡Œæ—¶ï¼Œä½ å¯ä»¥å‘ç¨‹åºå‘é€ @code{USR1} ä¿¡å·ï¼Œè¿™å¯ä»¥ä½¿ @command{gawk} è¾“å‡ºæµ‹è¯„ä¿¡æ¯ä»¥åŠå‡½æ•°è°ƒç”¨æ ˆã€‚

@item
ä½ ä¹Ÿå¯ä»¥åªâ€œç®€æ´æ‰“å°â€ï¼ˆpretty-@code{print}ï¼‰ä½ çš„ç¨‹åºã€‚å½“å‰ï¼Œå®ƒä¼šè¿è¡Œä½ çš„ç¨‹åºï¼Œä½†æ˜¯åœ¨åé¢çš„ä¸»è¦å‘è¡Œç‰ˆæœ¬ä¸­ä¼šæ”¹å˜ã€‚

@end itemize


@node Internationalization
@chapter @command{gawk} çš„å›½é™…åŒ–

å¾ˆä¹…å‰ï¼Œè®¡ç®—æœºçš„åˆ¶é€ è€…ä»¬æ‰€å†™çš„ç¨‹åºåªèƒ½ä½¿ç”¨è‹±è¯­ã€‚åæ¥ï¼Œç¡¬ä»¶ä¸è½¯ä»¶çš„ç”Ÿäº§å•†ä½æ³¨æ„åˆ°ï¼Œå¦‚æœä»–ä»¬çš„ç³»ç»Ÿä¹Ÿå¯ä»¥åœ¨éè‹±è¯­å›½å®¶çš„è¯­è¨€ä¸­å·¥ä½œï¼Œåˆ™å®ƒä»–å°±å¯ä»¥å–æ›´å¤šçš„ç³»ç»Ÿã€‚ç»“æœå°±æ˜¯ï¼Œå›½é™…åŒ–ä¸æœ¬åœ°åŒ–ç¨‹åºä»¥åŠè½¯ä»¶ä¼šæˆä¸ºä¸€ä¸ªé€šç”¨çš„å®è·µã€‚

@cindex internationalization, localization
@cindex @command{gawk}, internationalization and, See internationalization
@cindex internationalization, localization, @command{gawk} and
å¾ˆå¤šå¹´ä»¥æ¥ï¼Œæä¾›å›½é™…åŒ–ä¸æœ¬åœ°åŒ–èƒ½åŠ›çš„ç¨‹åºå¤±ä¸šåœ°é™åˆ¶åœ¨ç”¨ C æˆ–è€… C++ å†™çš„ç¨‹åºä¸­ã€‚è¿™ä¸€@value{CHAPTER}ä¼šæè¿° @command{gawk} åº•å±‚ä½¿ç”¨çš„ç”¨æ¥è¿›è¡Œå›½é™…åŒ–çš„åº“ï¼ŒåŒ…å« @command{gawk} å¦‚ä½•æ¥åœ¨ @command{awk} ç¨‹åºä»£ç çº§ä¸Šå®ç°å›½é™…åŒ–ç‰¹æ€§ã€‚åœ¨ @command{awk} ä»£ç çº§å®ç°å›½é™…åŒ–å¯ä»¥ç»™è½¯ä»¶å¼€å‘è€…é¢å¤–çš„çµæ´»æ€§â€”â€”å®ƒä»¬ä¸å†è¢«è¿«ä½¿ç”¨ C æˆ–è€… C++ æ¥ç¼–å†™è¦å®ç°å›½é™…åŒ–çš„è½¯ä»¶ã€‚

@menu
* I18N and L10N::               Internationalization and Localization.
* Explaining gettext::          How GNU @command{gettext} works.
* Programmer i18n::             Features for the programmer.
* Translator i18n::             Features for the translator.
* I18N Example::                A simple i18n example.
* Gawk I18N::                   @command{gawk} is also internationalized.
* I18N Summary::                Summary of I18N stuff.
@end menu

@node I18N and L10N
@section å›½é™…åŒ–ä¸æœ¬åœ°åŒ–

@cindex internationalization
@cindex localization, See internationalization@comma{} localization
@cindex localization
@dfn{å›½é™…åŒ–}è¡¨ç¤ºåªå†™ï¼ˆç¼–è¾‘ï¼‰ä¸€æ¬¡ç¨‹åºï¼Œå°±å¯ä»¥ä¸å†éœ€è¦å¯¹ä»£ç è¿›è¡Œå˜æ›´å°±å¯ä»¥åœ¨å¤šç§è¯­è¨€ä¸‹ä½¿ç”¨ã€‚@dfn{æœ¬åœ°åŒ–}åˆ™è¡¨ç¤ºç»™å›½é™…åŒ–çš„ç¨‹åºæä¾›ç›¸åº”çš„æ•°æ®æ¥åœ¨æŸä¸ªç‰¹å®šçš„è¯­è¨€ä¸­å·¥ä½œã€‚æœ€å…¸å‹çš„æ˜¯ï¼Œè¿™äº›æœ¯è¯­æŒ‡çš„æ˜¯åœ¨æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œåœ¨è¯»å–åé¦ˆæ—¶ä½¿ç”¨çš„è¯­è¨€çš„ç‰¹æ€§ï¼Œä»¥åŠæ•°å€¼ä¸å€¾å‘å€¼å¦‚ä½•æ¥è¿›è¡Œè¯»å–ä¸æ‰“å°çš„æ–¹å¼ã€‚

@node Explaining gettext
@section GNU çš„ @command{gettext}

@cindex internationalizing a program
@cindex @command{gettext} library
@command{gawk} ä½¿ç”¨ GNU çš„ @command{gettext} æ¥æä¾›å›½é™…åŒ–ç‰¹æ€§ã€‚GNU @command{gettext} å·¥å…·å…³æ³¨ä¿¡æ¯ï¼šç¨‹åºä¸­æ‰“å°çš„å­—ä¸²ï¼Œæ— è®ºæ˜¯é€šè¿‡ @code{printf} è¿˜æ˜¯é€šè¿‡ @code{sprintf()}ã€‚ 
@footnote{å¯¹äºæŸäº›æ“ä½œç³»ç»Ÿï¼Œ@command{gawk} çš„ç§»æ¤ä¸æ”¯æŒ GNU @command{gettext}ã€‚å› æ­¤ï¼Œå¦‚æœä½ åœ¨è¿™ä¸ªç³»ç»Ÿä¸Šä½¿ç”¨ï¼Œè¿™ä¸ªç‰¹æ€§å°±ä¸å¯ç”¨ã€‚éå¸¸æŠ±æ­‰ï¼}

@cindex portability, @command{gettext} library and
å½“ä½¿ç”¨ GNU @command{gettext} æ—¶ï¼Œæ¯ä¸ªç¨‹åºéƒ½æœ‰å®ƒçš„@dfn{æ–‡æœ¬åŸŸ}ã€‚è¿™æ˜¯ä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼Œå¦‚ @samp{kpilot} æˆ–è€… @samp{gawk}ï¼Œç”¨æ¥æ ‡è¯†ç¨‹åºã€‚ä¸€ä¸ªå®Œæ•´çš„ç¨‹åºæœ‰å¤šä¸ªç»„ä»¶â€”â€”ç”¨ C æˆ–è€… C++ å†™çš„ç¨‹åºï¼Œä»¥åŠä½¿ç”¨ @command{sh} æˆ–è€… @command{awk} å†™çš„è„šæœ¬ã€‚æ‰€æœ‰çš„è¿™äº›ç»„ä»¶éƒ½ä½¿ç”¨ç›¸åŒçš„æ–‡æœ¬åŸŸã€‚

ä¸ºäº†ä½¿è®¨è®ºæ›´åŠ å…·ä½“ï¼Œå‡è®¾æˆ‘ä»¬å†™ä¸€ä¸ªç¨‹åºåä¸º @command{guide}ã€‚æŒ‰é¡ºåºï¼Œå›½é™…åŒ–åŒ…å«ä¸‹é¢çš„æ­¥éª¤ï¼š

@enumerate
@item
ç¨‹åºå‘˜æ£€æŸ¥æ‰€æœ‰çš„ @command{guide} ç»„ä»¶çš„ä»£ç ï¼Œå¹¶ä¸”æ ‡æ³¨å‡ºè¦è¿›è¡Œç¿»è¯‘çš„å­—ä¸²ã€‚ä¾‹å¦‚ @code{"`-F': option required"} æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¦è¿›è¡Œç¿»è¯‘çš„å€™é€‰è€…ã€‚è€Œé€‰é¡¹åçš„å­—ä¸²è¡¨åˆ™ä¸æ˜¯ï¼ˆå¦‚ï¼Œ@command{gawk} çš„ @option{--profile} é€‰é¡¹è¦ä¿ç•™åŸæ ·ï¼Œè€Œä¸ç®¡æ˜¯ä»€ä¹ˆæ ·çš„è¯­è¨€ï¼‰ã€‚

@cindex @code{textdomain()} function (C library)
@item
é€šè¿‡è°ƒç”¨ @code{textdomain()} å‡½æ•°ï¼Œç¨‹åºå‘˜å‘ @command{gettext} åº“æŒ‡å®šï¼ˆ@command{"guide"}ï¼‰çš„åº”ç”¨æ–‡æœ¬åŸŸã€‚

@cindex @code{.pot} files
@cindex files, @code{.pot}
@cindex portable object template files
@cindex files, portable object template
@item
ä»æºä»£ç ä¸­æå–çš„æ¶ˆæ¯æ”¾åˆ°ä¸€ä¸ªç§»æ¤çš„å¯¹è±¡æ¨¡æ¿æ–‡ä»¶ï¼ˆ@file{guide.pot}ï¼‰ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œåˆ—å‡ºäº†æ‰€æœ‰çš„å­—ä¸²ä»¥åŠå¯¹åº”çš„ç¿»è¯‘ä¸²ã€‚ç¿»è¯‘å¼€å§‹æ˜¯ç©ºçš„ã€‚åŸå§‹ä¿¡æ¯ï¼ˆä¸€èˆ¬æ˜¯è‹±è¯­ï¼‰ä¼šä½œä¸ºç¿»è¯‘æŸ¥æ‰¾çš„é”®ã€‚

@cindex @code{.po} files
@cindex files, @code{.po}
@cindex portable object files
@cindex files, portable object
@item
å¯¹äºç¿»è¯‘çš„æ¯ä¸­è¯­è¨€ï¼Œ@file{guide.pot} éƒ½è¢«å¤åˆ¶åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å¯¹è±¡æ–‡ä»¶ï¼ˆ@code{.po}ï¼‰å¹¶å»ºç«‹èµ·ç¿»è¯‘ç„¶åä¸ç¨‹åºä¸€èµ·æ‰“åŒ…ã€‚ä¾‹å¦‚ï¼Œæœ‰å¯èƒ½æœ‰ @file{fr.po} ç”¨æ¥åšä¸ºæ³•è¯­ç¿»è¯‘ã€‚

@cindex @code{.gmo} files
@cindex files, @code{.gmo}
@cindex message object files
@cindex files, message object
@item
æ¯ç§è¯­è¨€çš„ @file{.po} æ–‡ä»¶éƒ½è¢«è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ¶ˆæ¯å¯¹è±¡ï¼ˆ@file{.gmo}ï¼‰æ–‡ä»¶ã€‚æ¶ˆæ¯å¯¹è±¡æ–‡ä»¶åŒ…å«åŸå§‹æ¶ˆæ¯ä¸å®ƒä»¬çš„ç¿»è¯‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œè¿™æ ·å¯ä»¥åœ¨è¿è¡Œæ—¶å¿«é€ŸæŸ¥æ‰¾ã€‚

@item
å½“ @command{guide} è¢«æ„å»ºå¹¶è¢«å®‰è£…ï¼ŒäºŒè¿›åˆ¶çš„ç¿»è¯‘æ–‡ä»¶ä¹Ÿè¢«å®‰è£…åˆ°æ ‡å‡†ä½ç½®ã€‚

@cindex @code{bindtextdomain()} function (C library)
@item
å¯¹äºæµ‹è¯•ä¸å¼€å‘ï¼Œå¯ä»¥å‘ŠçŸ¥ @command{gettext} ä½¿ç”¨ä¸æ˜¯æ ‡å‡†ç›®å½•ä¸‹çš„ @file{.gmo} æ–‡ä»¶ï¼Œè¿™é€šè¿‡è°ƒç”¨ @code{bindtextdomain()} å‡½æ•°æ¥å®ç°ã€‚

@cindex @code{.gmo} files, specifying directory of
@cindex files, @code{.gmo}, specifying directory of
@cindex message object files, specifying directory of
@cindex files, message object, specifying directory of
@item
åœ¨è¿è¡Œæ—¶ï¼Œ@command{guide} ä¼šé€šè¿‡è°ƒç”¨ @code{gettext()} æ¥æŸ¥æ‰¾æ¯ä¸€ä¸ªå­—ä¸²ã€‚è¿”å›çš„ä¸²ä¸ºå­—ä¸²çš„ç¿»è¯‘ä¸²ï¼Œå¦‚æœæ²¡å¯å¾—çš„è¯ï¼Œå°±æ˜¯åŸä¸²ã€‚

@item
å¦‚æœå¿…è¦ï¼Œä¹Ÿå¯ä»¥ä»å¦ä¸€ä¸ªä¸å±äºè¿™ä¸ªç¨‹åºçš„ä¸åŒçš„æ–‡æœ¬åŸŸä¸­æ¥è®¿é—®æ¶ˆæ¯ï¼Œè€Œä¸éœ€è¦åœ¨ç¨‹åºçš„é»˜è®¤æ–‡æœ¬åŸŸä¹‹é—´æ¥å›åˆ‡æ¢ã€‚
@end enumerate

@cindex @code{gettext()} function (C library)
åœ¨ Cï¼ˆæˆ–è€…C++ï¼‰ä¸­ï¼Œæ ‡å¿—åŠ¨æ€ç¿»è¯‘æŸ¥æ‰¾çš„å­—ä¸²æ˜¯é€šè¿‡å°†å­—ä¸²é€šè¿‡ @code{gettext()} æ¥å®Œæˆçš„ï¼š

@example
printf("%s", gettext("Don't Panic!\n"));
@end example

å·¥å…·å¯ä»¥ä»æºä»£ç ä¸­å°†æ‰€æœ‰ç”¨ @code{gettext()} åŒ…å«çš„å­—ä¸²æå–å‡ºæ¥ã€‚

@cindex @code{_} (underscore), C macro
@cindex underscore (@code{_}), C macro
GNU @command{gettext} çš„å¼€å‘è€…ï¼Œæ„è¯†åˆ°ä¸€æ¬¡æ¬¡åœ°è¾“å…¥ @samp{gettext(@dots{})} æ—¢ç—›è‹¦ï¼Œçœ‹èµ·æ¥ä¹Ÿä¸‘ï¼Œå› æ­¤ä½¿ç”¨å® @samp{_}ï¼ˆä¸‹åˆ’çº¿ï¼‰æ¥ä½¿å¾—äº‹æƒ…ç®€åŒ–ï¼š

@example
/* In the standard header file: */
#define _(str) gettext(str)

/* In the program text: */
printf("%s", _("Don't Panic!\n"));
@end example

@cindex internationalization, localization, locale categories
@cindex @command{gettext} library, locale categories
@cindex locale categories
@noindent
è¿™äº§ç”Ÿçš„è¾“å…¥è´Ÿæ‹…åªæ˜¯æ¯ä¸ªå­—ä¸²ä¸‰ä¸ªé¢å¤–çš„å­—ç¬¦ ï¼Œè€Œä¸”ä¹Ÿæ›´å®¹æ˜“é˜…è¯»ã€‚

å¯¹äºä¸åŒæœ¬åœ°è¯­è¨€çš„ä¿¡æ¯æœ‰ä¸åŒçš„æœ¬åœ°è¯­è¨€@dfn{åˆ†ç±»}ã€‚@command{gettext} å¯è¯†åˆ«çš„å®šä¹‰å¥½çš„æœ¬åœ°è¯­è¨€åˆ†ç±»æœ‰ï¼š

@table @code
@cindex @code{LC_MESSAGES} locale category
@item LC_MESSAGES
æ–‡æœ¬æ¶ˆæ¯ã€‚è¿™æ˜¯ @command{gettext} æ“ä½œçš„é»˜è®¤åˆ†ç±»ï¼Œä½†æ˜¯å¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥æ˜¾å¼åœ°æŒ‡å®šä¸åŒçš„ç±»å‹ã€‚ï¼ˆå‡ ä¹æ²¡æœ‰å¿…è¦æŒ‡å®šä¸åŒçš„åˆ†ç±»ã€‚ï¼‰

@cindex sorting characters in different languages
@cindex @code{LC_COLLATE} locale category
@item LC_COLLATE
æ–‡æœ¬ååŒä¿¡æ¯ï¼ˆå¦‚ï¼Œä¸åŒçš„å­—ç¬¦ä¸/æˆ–è€…å­—ç¬¦ç»„åœ¨ä¸€ä¸ªç»™å®šçš„è¯­è¨€ä¸­å¦‚ä½•æ’åºï¼‰ã€‚

@cindex @code{LC_CTYPE} locale category
@item LC_CTYPE
å­—ç¬¦ç±»å‹ä¿¡æ¯ï¼ˆå­—æ¯è¡¨ï¼Œæ•°å­—ï¼Œå¤§å°å†™ç­‰ç­‰ï¼‰ä»¥åŠå­—ç¬¦ç¼–ç ã€‚
@ignore
In June 2001 Bruno Haible wrote:
- Description of LC_CTYPE: It determines both
  1. character encoding,
  2. character type information.
  (For example, in both KOI8-R and ISO-8859-5 the character type information
  is the same - cyrillic letters could as 'alpha' - but the encoding is
  different.)
@end ignore
è¿™ä¸ªä¿¡æ¯é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼çš„ POSIX å­—ç¬¦ç±»æ¥è®¿é—®ï¼Œæ¯”å¦‚ @code{/[[:alnum:]]/}ï¼ˆæŸ¥çœ‹ @pxref{Bracket Expressions}ï¼‰ã€‚

@cindex monetary information, localization
@cindex currency symbols, localization
@cindex @code{LC_MONETARY} locale category
@item LC_MONETARY
è´§å¸ä¿¡æ¯ï¼Œå¦‚è´§å¸ç¬¦å·ä»¥åŠç¬¦å·æ˜¯åœ¨æ•°å€¼å‰è¿˜æ˜¯åœ¨æ•°å€¼åã€‚

@cindex @code{LC_NUMERIC} locale category
@item LC_NUMERIC
æ•°å€¼ä¿¡æ¯ã€‚ä¾‹å¦‚ç”¨äºåè¿›åˆ¶å°æ•°ç‚¹ä»¥åŠç™¾åˆ†ä½åˆ†éš”ç¬¦ã€‚ 
@footnote{ç¾å›½ä½¿ç”¨æ¯ä¸ªä¸‰ä¸ªè¿›åˆ¶æ•°ä¹‹é—´æ”¾ä¸€ä¸ªé€—å·ï¼Œä»¥åŠç”¨åœ†ç‚¹æ¥ä½œä¸ºåè¿›åˆ¶å°æ•°ç‚¹ï¼Œè€Œå¾ˆå¤šçš„æ¬§æ´²å›½å®¶åˆ™ç›¸åï¼š1,234.56 ä¸ 1.234ï¼Œ56ã€‚}

@cindex time, localization and
@cindex dates, information related to@comma{} localization
@cindex @code{LC_TIME} locale category
@item LC_TIME
æ—¶é—´ä¸æ—¥æœŸç›¸å…³ï¼Œå¦‚ 12 æˆ–è€… 24 å°æ—¶åˆ¶ï¼Œæœˆåˆ†åœ¨æ—¥æœŸä¸­æ˜¯æ‰“å°åœ¨å¤©çš„å‰é¢è¿˜æ˜¯åé¢ã€‚æœ¬åœ°æœˆåˆ†çš„ç¼©å†™ç­‰ç­‰ã€‚

@cindex @code{LC_ALL} locale category
@item LC_ALL
ä¸Šè¿°æ‰€æœ‰çš„ã€‚ï¼ˆåœ¨ @command{gettext} çš„å†…å®¹ä¸­ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚ï¼‰
@end table

@quotation æç¤º
@cindex @env{LANGUAGE} environment variable
å¦‚ @ref{Locales} æ‰€è¿°ï¼Œå’Œæœ¬åœ°è¯­è¨€åˆ†ç±»åŒåçš„ç¯å¢ƒå˜é‡ä¼šå½±å“ @command{gawk} çš„è¡Œä¸ºï¼ˆå’Œå…¶ä»–å·¥å…·çš„è¡Œä¸ºï¼‰ã€‚

é€šå¸¸ï¼Œè¿™äº›å˜é‡ä¹Ÿä¼šå½±å“ @code{gettext} åº“å¦‚ä½•æ‰¾åˆ°ç¿»è¯‘ã€‚ç„¶è€Œï¼Œ@env{LANGUAGE} ç¯å¢ƒå˜é‡ä¼šä½¿ @env{LC_@var{xxx}} ç¯å¢ƒå˜é‡æ— æ•ˆã€‚è®¸å¤š GNU/Linux ç³»ç»Ÿå¯èƒ½åœ¨ä½ ä¸çŸ¥é“çš„æƒ…å†µä¸‹å®šä¹‰è¿™ä¸ªå˜é‡ï¼Œå¯¼è‡´ @command{gawk} ä¸èƒ½æ‰¾åˆ°æ­£ç¡®çš„ç¿»è¯‘ã€‚å¦‚æœè¿™å‘ç”Ÿåœ¨ä½ èº«ä¸Šï¼Œæ£€æŸ¥æ˜¯å¦ @env{LANGUAGE} è¢«å®šä¹‰äº†ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œç”¨ shell çš„ @command{unset} å‘½ä»¤å»åˆ é™¤å®ƒã€‚
@end quotation

ä¸ºäº†æµ‹è¯• @command{gawk} æœ¬èº«çš„ç¿»è¯‘ï¼Œä½ å¯ä»¥è®¾ç½® @env{GAWK_LOCALE_DIR} ç¯å¢ƒå˜é‡ã€‚æŸ¥çœ‹ @code{bindtextdomain()} æ–‡æ¡£çš„å‡½æ•°ï¼Œä¹Ÿå¯ä»¥çœ‹ @ref{Other Environment Variables}ã€‚

@node Programmer i18n
@section @command{awk} ç¨‹åºçš„å›½é™…åŒ–
@cindex @command{awk} programs, internationalizing

@command{gawk} ä½¿ç”¨ä¸‹é¢çš„å˜é‡æ¥ç”¨äºå›½é™…åŒ–ï¼š

@table @code
@cindex @code{TEXTDOMAIN} variable
@item TEXTDOMAIN
è¿™ä¸ªå˜é‡è¡¨ç¤ºåº”ç”¨çš„æ–‡æœ¬åŸŸã€‚ä¸ºäº†ä¸ GNU @command{gettext} çš„å…¼å®¹æ€§ã€‚å…¶é»˜è®¤å€¼æ˜¯ @code{"messages"}ã€‚

@cindex internationalization, localization, marked strings
@cindex strings, for localization
@item _"your message here"
ç”¨å‰å¯¼çš„ä¸‹åˆ’çº¿æ ‡å¿—çš„å­—ä¸²å¸¸é‡æ˜¯åœ¨è¿è¡Œæ—¶ç”¨äºç¿»è¯‘çš„å€™é€‰ä¸²ã€‚å­—ä¸²å¸¸é‡å‰æ²¡æœ‰ä¸‹åˆ’çº¿çš„ä¸ä¼šè¢«ç¿»è¯‘ã€‚
@end table

@command{gawk} æä¾›äº†ä¸‹é¢çš„å‡½æ•°ç”¨æ¥ä½œå›½é™…åŒ–ï¼š

@table @code
@cindexgawkfunc{dcgettext}
@item @code{dcgettext(@var{string}} [@code{,} @var{domain} [@code{,} @var{category}]]@code{)}
åœ¨æœ¬åœ°è¯­è¨€åˆ†ç±» @var{category} ä¸­çš„ @var{domain} æ–‡æœ¬åŸŸä¸­è¿”å› @var{string} ä¸²çš„ç¿»è¯‘ã€‚é»˜è®¤çš„@var{domain} çš„å€¼æ˜¯ @code{TEXTDOMAIN} å˜é‡çš„å½“å‰å€¼ã€‚é»˜è®¤çš„ @var{category} çš„å€¼å¿…é¡»æ˜¯å·²ç» @code{"LC_MESSAGES"}ã€‚

å¦‚æœä½ ä¸º @var{category} æä¾›äº†ä¸€ä¸ªå€¼ï¼Œåˆ™å®ƒå¿…é¡»æ˜¯å·²çŸ¥çš„æœ¬åœ°è¯­è¨€åˆ†ç±»å­—ä¸²åï¼Œè¿™ä¸ªåœ¨
If you supply a value for @var{category}, it must be a string equal to
one of the known locale categories described in
@ifnotinfo
å‰é¢çš„@value{SECTION}æè¿‡ã€‚
@end ifnotinfo
@ifinfo
@ref{Explaining gettext} æœ‰æè¿°ã€‚
@end ifinfo
ä½ å¿…éœ€è¦æä¾›æ–‡æœ¬åŸŸã€‚å¦‚æœä½ ä½¿ç”¨å½“å‰åŸŸåˆ™ä½¿ç”¨ @code{TEXTDOMAIN}ã€‚

@quotation æ³¨æ„
@command{awk} ç‰ˆæœ¬çš„ @code{dcgettext()} å‡½æ•°çš„å‚æ•°çš„é¡ºåºæœ‰æ„åœ°ä¸ C ç‰ˆæœ¬çš„ä¸­çš„é¡ºåºä¸ä¸€è‡´ã€‚@command{awk} ç‰ˆæœ¬çš„é¡ºåºçš„é€‰æ‹©æ˜¯ä¸ºäº†ç®€åŒ–ä»¥åŠå…è®¸åˆç†çš„ @command{awk} é£æ ¼é»˜è®¤å‚æ•°ã€‚
@end quotation

@cindexgawkfunc{dcngettext}
@item @code{dcngettext(@var{string1}, @var{string2}, @var{number}} [@code{,} @var{domain} [@code{,} @var{category}]]@code{)}
è¿”å› @var{string1} ä¸ @var{string2} åœ¨æœ¬åœ°è¯­è¨€åˆ†ç±» @var{category} ä¸­ï¼Œæ–‡æœ¬åŸŸ @var{domain} ä¸­çš„ç¿»è¯‘çš„æ•°é‡ @var{number} å¤æ•°å½¢å¼ã€‚@var{string1} æ˜¯æ¶ˆæ¯çš„è‹±è¯­çš„å•æ•°å½¢å¼å˜ä½“ï¼Œ@var{string2} æ˜¯ç›¸åŒæ¶ˆæ¯çš„è‹±è¯­å¤æ•°å½¢å¼ã€‚@var{domain} çš„é»˜è®¤å€¼æ˜¯ @code{TEXTDOMAIN} çš„å½“å‰å€¼ã€‚@var{category} çš„é»˜è®¤å€¼æ˜¯ @code{"LC_MESSAGES"}ã€‚

å¯¹äº @code{dcgettext()} å‡½æ•°çš„å‚æ•°çš„é¡ºåºè¯´æ˜ï¼Œä¹Ÿé€‚åº”äºè¿™ä¸ªå‡½æ•°ã€‚

@cindex @code{.gmo} files, specifying directory of
@cindex files, @code{.gmo}, specifying directory of
@cindex message object files, specifying directory of
@cindex files, message object, specifying directory of
@cindexgawkfunc{bindtextdomain}
@item @code{bindtextdomain(@var{directory}} [@code{,} @var{domain} ]@code{)}
æ”¹å˜ @command{gettext} æŸ¥æ‰¾ @file{.gmo} æ–‡ä»¶çš„ç›®å½•ï¼Œä»¥é˜²ä¸‡ä¸€å®ƒä»¬ä¸åœ¨ï¼Œæˆ–è€…ä¸èƒ½æ”¾åœ¨æ ‡å‡†ä½ç½®çš„æƒ…å†µä¸‹ï¼ˆå¦‚ï¼Œåœ¨æµ‹è¯•æœŸé—´ï¼‰ã€‚è¿”å›æ–‡æœ¬åŸŸ @var{domain} ç»‘å®šçš„ç›®å½•ã€‚

é»˜è®¤çš„åŸŸ @var{domain} æ˜¯ @code{TEXTDOMAIN} çš„å€¼ã€‚å¦‚æœç›®å½•æ˜¯ç©ºä¸²ï¼ˆ@code{""}ï¼‰ï¼Œ@code{bindtextdomain()} åˆ™è¿”å›ç»™å®šæ–‡ä»¶åŸŸ @var{domain} çš„å½“å‰ç»‘å®šç›®å½•ã€‚
@end table

ä¸ºäº†åœ¨ä½ çš„ @command{awk} ç¨‹åºä¸­ä½¿ç”¨è¿™æ ·çš„å·¥å…·ï¼Œè¯·æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥æ‰§è¡Œï¼š

@enumerate
@cindex @code{BEGIN} pattern, @code{TEXTDOMAIN} variable and
@cindex @code{TEXTDOMAIN} variable, @code{BEGIN} pattern and
@item
å°† @code{TEXTDOMAIN} å˜é‡è®¾ç½®ä¸ºç¨‹åºçš„æ–‡æœ¬åŸŸã€‚æœ€å¥½æ˜¯åœ¨ @code{BEGIN} è§„åˆ™ä¸­å®Œæˆï¼ˆæŸ¥çœ‹ @pxref{BEGIN/END}ï¼‰ï¼Œæˆ–è€…å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹ @option{-v} æ¥å®Œæˆï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ï¼š

@example
BEGIN @{
    TEXTDOMAIN = "guide"
    @dots{}
@}
@end example

@cindex @code{_} (underscore), translatable string
@cindex underscore (@code{_}), translatable string
@item
å°†æ‰€æœ‰æœ‰å¯ç¿»è¯‘çš„å­—ä¸²ç”¨å‰ç½®ä¸‹åˆ’çº¿æ¥è¿›è¡Œæ ‡è¯†ï¼ˆ@samp{_}ï¼‰ã€‚å®ƒ@emph{å¿…é¡»}ä¸å­—ä¸²çš„å¼€å¼•å·ç›¸è¿ã€‚å¦‚ï¼š

@example
print _"hello, world"
x = _"you goofed"
printf(_"Number of users is %d\n", nusers)
@end example

@item
å¦‚æœä½ åŠ¨æ€åœ°åˆ›å»ºå­—ä¸²ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ @code{dcgettext()} å†…ç½®å‡½æ•°æ¥ç¿»è¯‘å®ƒä»¬ï¼š 
@footnote{æ„Ÿè°¢ Bruno Haible æä¾›è¿™ä¸ªä¾‹å­ã€‚}

@example
if (groggy)
    message = dcgettext("%d customers disturbing me\n", "adminprog")
else
    message = dcgettext("enjoying %d customers\n", "adminprog")
printf(message, ncustomers)
@end example

åœ¨è¿™é‡Œï¼Œè°ƒç”¨ @code{dcgettext()} æä¾›äº†ä¸€ä¸ªä¸åŒçš„æ–‡æœ¬åŸŸï¼ˆ@code{"adminprog"}ï¼‰ï¼Œåœ¨è¿™é‡Œæ¥æŸ¥æ‰¾æ¶ˆæ¯ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„ @code{"LC_MESSAGES"} åˆ†ç±»ã€‚

å‰é¢çš„ä¾‹å­åªåœ¨ @code{ncustomers} å¤§äº 1 çš„æƒ…å†µä¸‹ä¼šå·¥ä½œã€‚è¿™ä¸ªä¾‹å­ç”¨ @code{dcngettext()} å¯ä»¥æ›´å¥½åœ°å®Œæˆï¼š

@example
if (groggy)
    message = dcngettext("%d customer disturbing me\n",
                         "%d customers disturbing me\n", "adminprog")
else
    message = dcngettext("enjoying %d customer\n",
                         "enjoying %d customers\n", "adminprog")
printf(message, ncustomers)
@end example


@cindex @code{LC_MESSAGES} locale category, @code{bindtextdomain()} function (@command{gawk})
@item
åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½æƒ³å°† @file{.gmo} æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç§æœ‰çš„ç”¨äºæµ‹è¯•çš„ç›®å½•ã€‚è¿™å¯ä»¥é€šè¿‡ @code{bindtextdomain()} å†…ç½®å‡½æ•°æ¥è®¾ç½®ï¼š

@example
BEGIN @{
   TEXTDOMAIN = "guide"   # our text domain
   if (Testing) @{
       # where to find our files
       bindtextdomain("testdir")
       # joe is in charge of adminprog
       bindtextdomain("../joe/testdir", "adminprog")
   @}
   @dots{}
@}
@end example

@end enumerate

æŸ¥çœ‹ @ref{I18N Example}ï¼Œæ¥è·å–å¦‚ä½•æ¥ä¸€æ­¥æ­¥åœ°åˆ›å»ºå¹¶ä½¿ç”¨æ¥è‡ª @command{awk} çš„ç¿»è¯‘å­—ä¸²çš„ä¾‹å­ã€‚

@node Translator i18n
@section ç¿»è¯‘ @command{awk} ç¨‹åº

@cindex @code{.po} files
@cindex files, @code{.po}
@cindex portable object files
@cindex files, portable object
åªè¦ç¨‹åºä¸­çš„å¯ç¿»è¯‘å­—ä¸²å·²ç»è¢«æ ‡å¿—ï¼Œå®ƒä»¬å°±å¯ä»¥è¢«æå–ç”¨æ¥åˆ›å»ºåˆå§‹çš„ @file{.pot} æ–‡ä»¶ã€‚ä½œä¸ºç¿»è¯‘çš„ä¸€éƒ¨åˆ†ï¼Œé‡æ’ @code{printf} è¦è¾“å‡ºçš„å‚æ•°é€šå¸¸éƒ½å¾ˆæœ‰å¸®åŠ©ã€‚

@command{gawk} çš„ @option{--gen-pot} å‘½ä»¤è¡Œå‚æ•°æå‡ºæ¶ˆæ¯å¹¶åœ¨åé¢è¿›è¡Œè®¨è®ºã€‚ä¹‹åï¼Œä¹Ÿä¼šæ¶‰åŠ @code{printf} åœ¨è¿è¡Œæ—¶é‡æ’ @code{printf} å‚æ•°çš„èƒ½åŠ›ã€‚

@menu
* String Extraction::           Extracting marked strings.
* Printf Ordering::             Rearranging @code{printf} arguments.
* I18N Portability::            @command{awk}-level portability issues.
@end menu

@node String Extraction
@subsection æå–å·²æ ‡å¿—å­—ä¸²
@cindex strings, extracting
@cindex marked strings@comma{} extracting
@cindex @option{--gen-pot} option
@cindex command-line options, string extraction
@cindex string extraction (internationalization)
@cindex marked string extraction (internationalization)
@cindex extraction, of marked strings (internationalization)

@cindex @option{--gen-pot} option
ä¸€æ—¦ä½ çš„ @command{awk} ç¨‹åºå¯ä»¥å·¥ä½œï¼Œè€Œæ‰€æœ‰çš„å­—ä¸²éƒ½å·²ç»è¢«æ ‡å¿—ï¼Œä¹Ÿè®¾ç½®äº†ï¼ˆå¯èƒ½ä¹Ÿç»‘å®šäº†ï¼‰æ–‡æœ¬åŸŸï¼Œå°±æ˜¯è¯¥ç”Ÿæˆç¿»è¯‘çš„æ—¶å€™ã€‚é¦–å…ˆï¼Œä½¿ç”¨ @option{--gen-pot} å‘½ä»¤è¡Œé€‰é¡¹æ¥é€ æˆåˆå§‹çš„ @file{.pot} æ–‡ä»¶ï¼š

@example
gawk --gen-pot -f guide.awk > guide.pot
@end example

@cindex @code{xgettext} utility
å½“ä»¥ @option{--gen-pot} è¿è¡Œæ—¶ï¼Œ@command{gawk} ä¸ä¼šæ‰§è¡Œä½ çš„ç¨‹åºã€‚ç›¸åï¼Œå®ƒä¼šæŒ‰é€šå¸¸çš„æ–¹å¼åˆ†æå®ƒï¼Œç„¶åæ‰“å°æ‰€æœ‰çš„å·²ç»æ ‡å¿—çš„å­—ä¸²åˆ°æ ‡å‡†è¾“å‡ºä¸Šï¼Œå¹¶ä¸”æ˜¯ä»¥ GNU çš„ @command{gettext} çš„å¯ç§»æ¤å¯¹è±¡æ–‡ä»¶çš„æ ¼å¼è¾“å‡ºã€‚åŒæ—¶åœ¨è¾“å‡ºä¸­ä¹ŸåŒ…å«å‡ºç°åœ¨ @code{dcgettext()} å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„å­—ä¸²å¸¸é‡ï¼Œæˆ–è€…æ˜¯ @code{dcn@command{gettext}()} å‡½æ•°ä¸­çš„ç¬¬ä¸€ã€äºŒä¸ªå‚æ•°ã€‚
@footnote{ä¸ GNU @command{gettext} ä¸€èµ·å‘å¸ƒçš„ @command{xgettext} å·¥å…·å¯ä»¥å¤„ç† @file{.awk} æ–‡ä»¶ã€‚}
ä½ åº”è¯¥ä½ ä½ çš„ @command{awk} ç¨‹åºä¸€èµ·å‘å¸ƒä½ çš„ @file{.pot} æ–‡ä»¶ï¼Œç¿»è¯‘è€…æœ€ç»ˆä¹Ÿä¼šä½¿ç”¨å®ƒæ¥ä¸ºä½ æä¾›ç¿»è¯‘ï¼Œä½ ä¹Ÿå¯ä»¥å°†å…¶å‘å¸ƒã€‚æŸ¥çœ‹ @ref{I18N Example}ï¼Œæ¥è·å–å®Œæ•´çš„ä¸º @command{guide} åˆ›å»ºåŠæµ‹è¯•ç¿»è¯‘çš„æ­¥éª¤ã€‚

@node Printf Ordering
@subsection é‡æ’ @code{printf} å‚æ•° 

@cindex @code{printf} statement, positional specifiers
@cindex positional specifiers, @code{printf} statement
ç”¨äº @code{printf} ä¸ @code{sprintf()} å‡½æ•°çš„æ ¼å¼å­—ä¸²ï¼ˆæŸ¥çœ‹ @pxref{Printf}ï¼‰å¯¼è‡´äº†ä¸€ç§ç‰¹æ®Šçš„ç¿»è¯‘é—®é¢˜ã€‚è€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼š 
@footnote{è¿™ä¸ªä¾‹å­æ˜¯ä» GNU @command{gettext} æ‰‹å†Œä¸Šå€Ÿæ¥çš„ã€‚}

@example
printf(_"String `%s' has %d characters\n",
          string, length(string)))
@end example

å¯èƒ½å¾·è¯­ç¿»è¯‘æˆè¿™æ ·ï¼š

@example
"%d Zeichen lang ist die Zeichenkette `%s'\n"
@end example

é—®é¢˜åº”è¯¥æ˜¯å¾ˆæ˜æ˜¾çš„ï¼šæ ¼å¼çš„æŒ‡å®šä¸æœ€åˆçš„æ˜¯ä¸åŒçš„ï¼å°±ç®— @code{gettext()} å¯ä»¥åœ¨è¿è¡Œæ—¶è¿”å›ç¿»è¯‘åçš„å­—ä¸²ï¼Œä½†æ˜¯å´æ²¡æœ‰åŠæ³•æ”¹å˜è°ƒç”¨ @code{printf} å‚æ•°çš„é¡ºåºã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ@code{printf} æ ¼å¼æŒ‡å®šç¬¦å¯ä»¥æœ‰å¦å¤–ä¸€ä¸ªå¯é€‰çš„å…ƒç´ ï¼Œå³@dfn{ä½ç½®æŒ‡å®šç¬¦}ã€‚ä¾‹å¦‚ï¼š

@example
"%2$d Zeichen lang ist die Zeichenkette `%1$s'\n"
@end example

åœ¨è¿™é‡Œï¼Œä½ç½®æŒ‡å®šç¬¦ç”±ä¸€ä¸ªæ•´æ•°æ„æˆï¼Œç”¨æ¥è¡¨ç¤ºè¦ä½¿ç”¨å“ªä¸ªå‚æ•°ï¼Œä»¥åŠä¸€å¹´ @samp{$} ç¬¦å·ã€‚ä½ç½®æ˜¯ç”± 1 å¼€å§‹çš„ï¼Œ@emph{ä¸}åŒ…å«æ ¼å¼ä¸²è‡ªå·±ã€‚æ‰€ä»¥ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ@samp{string} æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ@samp{length(string)} åˆ™æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼š

@example
$ @kbd{gawk 'BEGIN @{}
>     @kbd{string = "Don\47t Panic"}
>     @kbd{printf "%2$d characters live in \"%1$s\"\n",}
>                         @kbd{string, length(string)}
> @kbd{@}'}
@print{} 11 characters live in "Don't Panic"
@end example

å¦‚æœæä¾›äº†ä½ç½®æŒ‡å®šç¬¦ï¼Œè¿™åœ¨æ ¼å¼è§„åˆ™ä¸­è¦ç¬¬ä¸€ä¸ªå‡ºç°ï¼Œå³åœ¨æ ‡å¿—ï¼ŒåŸŸå®½ä»¥åŠ/æˆ–è€…ç²¾åº¦ä¹‹å‰ã€‚

ä½ç½®æŒ‡å®šç¬¦å¯ä»¥ä¸åŠ¨æ€åŸŸå®½ä»¥åŠç²¾åº¦ä¸€èµ·ä½¿ç”¨ï¼š

@example
$ @kbd{gawk 'BEGIN @{}
>    @kbd{printf("%*.*s\n", 10, 20, "hello")}
>    @kbd{printf("%3$*2$.*1$s\n", 20, 10, "hello")}
> @kbd{@}'}
@print{}      hello
@print{}      hello
@end example

@quotation æç¤º
å½“ä¸ä½ç½®æŒ‡å®šç¬¦ä¸€èµ·ä½¿ç”¨ @samp{*} æ—¶ï¼Œ@samp{*} è¦å…ˆå‡ºç°ï¼Œç„¶åæ˜¯æ•´æ•°ä½ç½®ï¼Œç„¶åæ‰æ˜¯ @samp{$} ç¬¦ã€‚è¿™æœ‰ä¸€ç‚¹åç›´è§‰ã€‚
@end quotation

@cindex @code{printf} statement, positional specifiers, mixing with regular formats
@cindex positional specifiers, @code{printf} statement, mixing with regular formats
@cindex format specifiers, mixing regular with positional specifiers
@command{gawk} ä¸å…è®¸ä½ åœ¨åŒæ ·çš„å­—ä¸²ä¸­æ··ç”¨å¸¸è§„çš„æ ¼å¼æŒ‡å®šç¬¦ä¸ä½ç½®æŒ‡å®šç¬¦ï¼š

@example
$ @kbd{gawk 'BEGIN @{ printf "%d %3$s\n", 1, 2, "hi" @}'}
@error{} gawk: cmd. line:1: fatal: must use `count$' on all formats or none
@end example

@quotation æç¤º
æœ‰ä¸€ä¸ªç—…æ€çš„åˆ—å­ä¸­ï¼Œ@command{gawk} æ— æ³•è¯†åˆ«ã€‚åœ¨è¿™æ ·çš„ä¾‹å­ä¸­ï¼Œè¾“å‡ºå¯èƒ½ä¸æ˜¯ä½ æ‰€æƒ³è¦çš„ã€‚æ—¢ä½¿ @command{gawk} æ²¡æœ‰æ£€æµ‹åˆ°å®ƒä»¬ï¼Œ æ··ç”¨å®ƒä»¬ä¾ç„¶æ˜¯ä¸ªåä¸»æ„ã€‚
@end quotation

å°½ç®¡ä½ç½®æŒ‡å®šç¬¦å¯ä»¥ç›´æ¥ç”¨åœ¨ @command{awk} ç¨‹åºä¸­ï¼Œä½†å®ƒä»¬çš„ä¸»è¦ç›®çš„æ˜¯ç”¨æ¥å¸®åŠ©äº§ç”Ÿæ­£ç¡®çš„æ ¼å¼ä¸²çš„ç¿»è¯‘ï¼Œä»å¼€å§‹ç¼–å†™çš„è¯­è¨€åˆ°å…¶ä»–ä¸åŒçš„è¯­è¨€ã€‚

@node I18N Portability
@subsection @command{awk} çš„ç§»æ¤æ€§é—®é¢˜

@cindex portability, internationalization and
@cindex internationalization, localization, portability and
@command{gawk} çš„å›½é™…åŒ–ç‰¹æ€§æœ‰æ„é€‰æ‹©å¯¹ @command{awk} çš„å¯ç§»æ¤æ€§å½±å“æœ€å¯èƒ½å°ï¼Œä½¿å®ƒä»¬å¯ä»¥ç”¨äºå…¶ä»–çš„ @command{awk} ç‰ˆæœ¬ã€‚è€ƒè™‘ä¸‹é¢çš„ç¨‹åºï¼š

@example
BEGIN @{
    TEXTDOMAIN = "guide"
    if (Test_Guide)   # set with -v
        bindtextdomain("/test/guide/messages")
    print _"don't panic!"
@}
@end example

@noindent
å¦‚ä¸Šçš„ä»£ç ï¼Œåœ¨å…¶ä»–çš„ç‰ˆæœ¬çš„ @command{awk} ä¸­æ²¡åŠæ³•å·¥ä½œã€‚ä½†æ˜¯ï¼Œå®é™…å®ƒå·²ç»å·®ä¸å¤šå¯ç§»æ¤äº†ï¼Œåªéœ€è¦ä¸€ç‚¹ç‚¹æ”¹åŠ¨ï¼š

@itemize @value{BULLET}
@cindex @code{TEXTDOMAIN} variable, portability and
@item
å¯¹ @code{TEXTDOMAIN} çš„èµ‹å€¼æ²¡æœ‰æ•ˆæœï¼Œå› ä¸º @code{TEXTDOMAIN} åœ¨å…¶ä»–çš„ @command{awk} å®ç°ä¸­æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ã€‚

@item
é GNU ç‰ˆæœ¬çš„ @command{awk} å°†å·²ç»æ ‡å¿—çš„å˜é‡å½“æˆæ˜¯å˜é‡åä¸º @code{_} ä¸å…¶ä»–çš„å­—ä¸²çš„è¿æ¥ã€‚ 
@footnote{è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç”¨æ¥å­˜æ”¾â€œä»¤äººå›°æƒ‘çš„ @command{awk}â€å†…å®¹çš„ç›®å½•ã€‚}
å…¸å‹çš„æƒ…å†µï¼Œå˜é‡ @code{_} å°†ç©ºä¸²ï¼ˆ@code{""}ï¼‰å½“æˆå®ƒçš„å€¼ï¼Œè¿™æ ·æœ€åˆçš„å¸¸é‡å­—ä¸²ä¸å˜ã€‚

@item
é€šè¿‡å®šä¹‰â€œå“‘â€å‡½æ•°æ¥ä»£æ›¿ @code{dcgettext()}ã€@code{dcngettext()} ä¸ @code{bindtextdomain()}ï¼Œè¿™æ · @command{awk} ç¨‹åºå¯ä»¥è¿è¡Œèµ·æ¥ï¼Œä½†æ˜¯åªè¾“å‡ºæ‰€æœ‰çš„åˆå§‹è¯­è¨€çš„æ¶ˆæ¯ã€‚

@cindex @code{bindtextdomain()} function (@command{gawk}), portability and
@cindex @code{dcgettext()} function (@command{gawk}), portability and
@cindex @code{dcngettext()} function (@command{gawk}), portability and
@example
@c file eg/lib/libintl.awk
function bindtextdomain(dir, domain)
@{
    return dir
@}

function dcgettext(string, domain, category)
@{
    return string
@}

function dcngettext(string1, string2, number, domain, category)
@{
    return (number == 1 ? string1 : string2)
@}
@c endfile
@end example

@item
åœ¨ @code{printf} ä¸ @code{sprintf()} ä¸­çš„ä½ç½®æŒ‡å®šç¬¦æ˜¯@emph{ä¸å¯}ç§»æ¤çš„ã€‚ä¸ºäº†åœ¨ C å±‚æ¬¡ä¸Šæ”¯æŒ @code{gettext()}ï¼Œå¾ˆå¤šçš„ç³»ç»Ÿçš„ C ç‰ˆæœ¬çš„ @code{sprintf} ä¹Ÿæ”¯æŒä½ç½®æŒ‡å®šç¬¦ã€‚ä½†æ˜¯åªè¦æä¾›äº†è¶³å¤Ÿçš„å‚æ•°çš„è°ƒç”¨æ—¶æ‰ä¼šæœ‰ç”¨ã€‚å¾ˆå¤šçš„ @command{awk} ç‰ˆæœ¬å°† @code{printf} çš„æ ¼å¼ä¸å‚æ•°ä¸å˜åœ°ä¼ é€’ç»™ä¸‹å±‚çš„ C ç‰ˆæœ¬çš„ @code{sprintf()}ï¼Œä½†æ˜¯ä¸€æ¬¡åªä¼ é€’ä¸€ä¸ªæ ¼å¼ä¸å‚æ•°ã€‚å¤§å®¶å¯ä»¥çŒœæµ‹è¯•å¦‚æœä½¿ç”¨äº†ä½ç½®æŒ‡å®šç¬¦çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆã€‚
ä½†æ˜¯ï¼Œç”±äºä½ç½®æŒ‡å®šç¬¦ä¸»è¦æ˜¯ç”¨æ¥åš@emph{ç¿»è¯‘}æ ¼å¼çš„å­—ä¸²ï¼Œè€Œä¸”å› ä¸ºé GNU çš„ @command{awk} ä¸ä¼šè¿”å›ç¿»è¯‘åçš„å­—ä¸­ï¼Œæ‰€ä»¥è¿™åœ¨å®è·µä¸­ä¸ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚
@end itemize

@node I18N Example
@section ç®€å•çš„å›½é™…åŒ–ä¾‹å­

ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä¸€æ­¥æ­¥åœ°è¿›è¡Œå›½é™…åŒ–ä¸æœ¬åœ°åŒ–ä¸€ä¸ªä¾‹å­ @command{awk} ç¨‹åºï¼Œä½¿ç”¨ @file{guide.awk} ä½œä¸ºæˆ‘ä»¬çš„æºä»£ç ï¼š

@example
@c file eg/prog/guide.awk
BEGIN @{
    TEXTDOMAIN = "guide"
    bindtextdomain(".")  # for testing
    print _"Don't Panic"
    print _"The Answer Is", 42
    print "Pardon me, Zaphod who?"
@}
@c endfile
@end example

@noindent
æ‰§è¡Œ @samp{gawk --gen-pot} æ¥åˆ›å»º @file{.pot} æ–‡ä»¶ï¼š

@example
$ @kbd{gawk --gen-pot -f guide.awk > guide.pot}
@end example

@noindent
è¿™é‡Œä¼šäº§ç”Ÿï¼š

@example
@c file eg/data/guide.po
#: guide.awk:4
msgid "Don't Panic"
msgstr ""

#: guide.awk:5
msgid "The Answer Is"
msgstr ""

@c endfile
@end example

è¿™æ˜¯æœ€åˆçš„å¯ç§»æ¤å¯¹è±¡æ¨¡å—æ–‡ä»¶ï¼Œä¼šè¢«ä¿å­˜å¹¶åœ¨æ¯ä¸ªå®ƒè¦è¿›è¡Œç¿»è¯‘çš„è¯­è¨€ä¸­è¿›è¡Œé‡ç”¨ã€‚@code{msgid} æ˜¯æœ€åˆçš„å­—ä¸²ï¼Œè€Œ @code{msgstr} æ˜¯ç¿»è¯‘ã€‚

@quotation æç¤º
å­—ä¸²æ²¡æœ‰ç”¨ä¸‹åˆ’çº¿è¿›è¡Œæ ‡å¿—çš„ï¼Œä¸ä¼šå‡ºç°åœ¨ @file{guide.pot} æ–‡ä»¶ä¸­ã€‚
@end quotation

ä¸‹ä¸€æ­¥ï¼Œåˆ™è¦è¿›è¡Œæ¶ˆæ¯çš„ç¿»è¯‘ã€‚è¿™é‡Œçš„ç¿»è¯‘æ˜¯ä¸€ä¸ªå‡æƒ³çš„è‹±è¯­æ–¹è¨€ï¼Œç§°ä¸º â€œMellowâ€ï¼š 
@footnote{ä¹Ÿè®¸ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º â€œHippyâ€å¯èƒ½ä¼šæ›´å¥½ã€‚}

@example
@group
$ @kbd{cp guide.pot guide-mellow.po}
@var{Add translations to} guide-mellow.po @dots{}
@end group
@end example

@noindent
ä¸‹é¢æ˜¯ç¿»è¯‘ï¼š

@example
@c file eg/data/guide-mellow.po
#: guide.awk:4
msgid "Don't Panic"
msgstr "Hey man, relax!"

#: guide.awk:5
msgid "The Answer Is"
msgstr "Like, the scoop is"

@c endfile
@end example

@cindex Linux
@cindex GNU/Linux
ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªç›®å½•æ¥å­˜å‚¨äºŒè¿›åˆ¶æ¶ˆæ¯å¯¹è±¡æ–‡ä»¶ï¼Œç„¶ååˆ›å»º @file{guide.mo} æ–‡ä»¶ã€‚æˆ‘ä»¬å‡è£…æˆ‘ä»¬çš„æ–‡ä»¶å‡†å¤‡åœ¨ @code{en_US.UTF-8} è¯­è¨€è®¾ç½®ä¸­ä½¿ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€ä¸ª C çš„@command{gettext} ä¾‹ç¨‹çŸ¥é“çš„è¯­è¨€è®¾ç½®ã€‚è¿™é‡Œæ˜¾ç¤ºçš„ç›®å½•å¸ƒå±€è¡¨ç¤ºçš„æ˜¯ GNU/Linux ç³»ç»Ÿä¸Šçš„ GNU @command{gettext}ã€‚å…¶ä»–ç‰ˆæœ¬çš„ @command{gettext} å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¸ƒå±€ï¼š

@example
$ @kbd{mkdir en_US.UTF-8 en_US.UTF-8/LC_MESSAGES}
@end example

@cindex @code{.po} files, converting to @code{.mo}
@cindex files, @code{.po}, converting to @code{.mo}
@cindex @code{.mo} files, converting from @code{.po}
@cindex files, @code{.mo}, converting from @code{.po}
@cindex portable object files, converting to message object files
@cindex files, portable object, converting to message object files
@cindex message object files, converting from portable object files
@cindex files, message object, converting from portable object files
@cindex @command{msgfmt} utility
@command{msgfmt} å·¥å…·å°†äººå¯è¯»çš„ @file{.mo} æ–‡ä»¶è½¬æ¢æˆæœºå™¨å¯è¯»çš„ @file{.mo} æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ@command{msgfmt} åˆ›å»ºä¸€ä¸ªå«åš @file{messages} æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å¿…é¡»è¢«é‡æ–°å‘½åï¼Œå¹¶è¢«æ”¾åœ¨åˆé€‚çš„ä½ç½®ï¼ˆä½¿ç”¨ @option{-o} é€‰é¡¹ï¼‰ï¼Œå› æ­¤ @command{gawk} å¯ä»¥æ‰¾åˆ°å®ƒï¼š

@example
$ @kbd{msgfmt guide-mellow.po -o en_US.UTF-8/LC_MESSAGES/guide.mo}
@end example

æœ€åï¼Œæˆ‘ä»¬è¿è¡Œç¨‹åºæ¥æµ‹è¯•ï¼š

@example
$ @kbd{gawk -f guide.awk}
@print{} Hey man, relax!
@print{} Like, the scoop is 42
@print{} Pardon me, Zaphod who?
@end example

å¦‚æœ @code{dcgettext()}ï¼Œ@code{dcngettext()} ä¸ @code{bindtextdomain()} ï¼ˆæŸ¥çœ‹ @pxref{I18N Portability}ï¼‰è¿™ä¸‰ä¸ªå‡½æ•°åœ¨æ–‡ä»¶ @file{libintl.awk} æ–‡ä»¶ä¸­ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥è¿™æ ·çš„è¿è¡Œ @file{guide.awk}ï¼š

@example
$ @kbd{gawk --posix -f guide.awk -f libintl.awk}
@print{} Don't Panic
@print{} The Answer Is 42
@print{} Pardon me, Zaphod who?
@end example

@node Gawk I18N
@section @command{gawk} å¯ä»¥è¯´ä½ çš„è¯­è¨€

@command{gawk} æœ¬èº«å·²ç»ä½¿ç”¨ GNU @command{gettext} åŒ…æ¥åšäº†å›½é™…åŒ–ã€‚ï¼ˆGNU @command{gettext} åœ¨ 
@ifinfo
@inforef{Top, , GNU @command{gettext} utilities, gettext, GNU @command{gettext} utilities}
@end ifinfo
@ifnotinfo
@uref{http://www.gnu.org/software/gettext/manual/,
@cite{GNU @command{gettext} å·¥å…·}}
@end ifnotinfo
é‡Œæœ‰å®Œæ•´çš„æè¿°ï¼‰
åœ¨å†™è¿™ä¸ªçš„æ—¶å€™ï¼ŒGNU @command{gettext} çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ @uref{ftp://ftp.gnu.org/gnu/gettext/gettext-0.19.4.tar.gz,
@value{PVERSION} 0.19.4}ã€‚

å¦‚æœ @command{gawk} çš„æ¶ˆæ¯ç¿»è¯‘å­˜åœ¨ï¼Œ@command{gawk} äº§ç”Ÿçš„ä¿¡æ¯ï¼Œè­¦å‘Šï¼Œå‘½ä»¤é”™è¯¯ä¼šä½¿ç”¨æœ¬åœ°è¯­è¨€ã€‚

@node I18N Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
å›½é™…åŒ–è¡¨ç¤ºå†™çš„ç¨‹åºå¯ä»¥ä½¿ç”¨å¤šç§è¯­è¨€è€Œä¸éœ€è¦å¯¹æºä»£ç è¿›è¡Œæ”¹å˜ã€‚æœ¬åœ°åŒ–åˆ™è¡¨ç¤ºç»™å·²ç»å›½é™…åŒ–çš„è¯­è¨€æä¾›å¿…è¦çš„æ•°æ®æ¥ä½¿å…¶ä»–ç‰¹å®šçš„è¯­è¨€ä¸­å·¥ä½œã€‚

@item
@command{gawk} ä½¿ç”¨ GNU @command{gettext} æ¥è®©ä½ å¯¹ @command{awk} ç¨‹åºè¿›è¡Œå›½é™…åŒ–ä¸æœ¬åœ°åŒ–ã€‚ä¸€ä¸ªç¨‹åºçš„æ–‡æœ¬åŸŸæ ‡è¯†äº†ç”¨äºç»„åˆæ¶ˆæ¯ä¸å…¶ä»–æ•°æ®çš„ç¨‹åºã€‚

@item
ä½ å°†ç¨‹åºä¸­çš„å­—ä¸²ç”¨ä¸‹åˆ’çº¿æ¥è¿›è¡Œæ ‡è¯†ä»¥ç”¨äºç¿»è¯‘ã€‚ä¸€æ—¦å®Œæˆäº†è¿™ä¸ªï¼Œå­—ä¸²ä¼šè¢«æå–åˆ°ä¸€ä¸ª @file{.pot} æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ–‡ä»¶ä¸ºæ¯ç§è¯­è¨€çš„å¤åˆ¶ä¸€ä¸ª @file{.po} æ–‡ä»¶ï¼Œç„¶å @file{.po} æ–‡ä»¶ä¼šç¼–è¯‘æˆ @file{.gmo} æ–‡ä»¶æ¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ã€‚

@item
ä½ å¯ä»¥åœ¨ @code{sprintf} ä¸ @code{printf} ä¸­ä½¿ç”¨ä½ç½®æŒ‡å®šç¬¦ï¼Œä½¿å¯ä»¥åœ¨æ ¼å¼åŒ–ä¸²ä¸è¾“å‡ºä¸­è¾“å‡ºä¸­é‡æ–°å¯¹å‚æ•°å€¼è¿›è¡Œæ’åºã€‚è¿™å¯¹äºæ§åˆ¶å­—ä¸²çš„ç¿»è¯‘å¾ˆæœ‰ç”¨ã€‚

@item
å›½é™…åŒ–ç‰¹åˆ«è¢«è®¾è®¡æˆåœ¨æ ‡å‡†çš„ @command{awk} ä¸­ä¹Ÿå¯ä»¥å¾ˆå¥½å¤„ç†ã€‚

@item
@command{gawk} æœ¬èº«å·²ç»å›½é™…åŒ–ï¼Œå¹¶å‘å¸ƒäº†å¤šç§è¯­è¨€æ¶ˆæ¯ã€‚

@end itemize


@node Debugger
@chapter è°ƒè¯• @command{awk} ç¨‹åº
@cindex debugging @command{awk} programs

@c The original text for this chapter was contributed by Efraim Yawitz.
@c FIXME: Add more indexing.

å¦‚æœç¨‹åºåœ¨ç¬¬ä¸€æ¬¡è¿åŠ¨å°±è¡¨ç°å®Œç¾é‚£å°±å¥½äº†ï¼Œä½†æ˜¯åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œè¿™å¯¹äºä»»æ„å¤æ‚åº¦çš„ç¨‹åºæ¥è¯´éƒ½å¾ˆå°‘è§ã€‚æ‰€ä»¥ï¼Œå¤§å¤šæ•°çš„ç¨‹åºè¯­è¨€éƒ½æœ‰ç›¸åº”çš„å·¥å…·ç”¨æ¥è¿›è¡Œâ€œè°ƒè¯•â€ç¨‹åºï¼Œè€Œ @command{awk} ä¹Ÿä¸ä¾‹å¤–ã€‚

@command{gawk} çš„è°ƒè¯•å™¨æœ‰æ„åœ°å‚ç…§ @uref{http://www.gnu.org/software/gdb/, GNU è°ƒè¯•å™¨ï¼ˆGDBï¼‰} çš„å‘½ä»¤è¡Œè°ƒè¯•å™¨ã€‚å¦‚æœä½ ç†Ÿæ‚‰ GDBï¼Œå­¦ä¹ å¦‚ä½•æ¥ä½¿ç”¨ @command{gawk} è°ƒè¯•ä½ çš„ç¨‹åºå°±å¾ˆç®€å•ã€‚

@menu
* Debugging::                   Introduction to @command{gawk} debugger.
* Sample Debugging Session::    Sample debugging session.
* List of Debugger Commands::   Main debugger commands.
* Readline Support::            Readline support.
* Limitations::                 Limitations and future plans.
* Debugging Summary::           Debugging summary.
@end menu

@node Debugging
@section @command{gawk} è°ƒè¯•å™¨ä»‹ç»

æœ¬@value{SECTION}ä¸€èˆ¬æ€§åœ°ä»‹ç»ä¸€ä¸‹è°ƒè¯•å™¨ä»¥åŠå¼€å§‹è®¨è®º @command{gawk} çš„è°ƒè¯•ã€‚

@menu
* Debugging Concepts::          Debugging in General.
* Debugging Terms::             Additional Debugging Concepts.
* Awk Debugging::               Awk Debugging.
@end menu

@node Debugging Concepts
@subsection é€šç”¨çš„è°ƒè¯•æŠ€æœ¯

ï¼ˆå¦‚æœä½ ä½¿ç”¨è¿‡å…¶ä»–è¯­è¨€çš„è°ƒè¯•å™¨ï¼Œä½ å¯ä»¥è·³è¿‡åˆ° @ref{Awk Debugging}ã€‚ï¼‰

å½“ç„¶ï¼Œè°ƒè¯•ç¨‹åºæ²¡åŠæ³•å¸®ä½ ç§»é™¤ Bugï¼Œå› æ­¤å®ƒå¹¶ä¸çŸ¥é“ä½ æˆ–è€…ä½ çš„ç”¨æˆ·å¦‚ä½•å°†å…¶å½“æˆæ˜¯ä¸ª Bugï¼Œè¿˜æ˜¯ä¸€ä¸ªç‰¹æ€§ã€‚ï¼ˆæœ‰æ—¶å€™ï¼Œäººç±»è‡ªå·±å¯¹äºè¿™ä¸ªé—®é¢˜ä¹ŸæŒ£æ‰äº†å¾ˆä¹…ã€‚ï¼‰åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œä½ ä»è¿™æ ·çš„å·¥å…·æƒ³å¾—åˆ°ä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆä¾èµ–äºæ­£åœ¨è¢«è°ƒè¯•çš„è¯­è¨€ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œä½ è‡³å°‘å¯ä»¥å¾—å¦‚ä¸‹çš„ç»“æœï¼š

@itemize @value{BULLET}
@item
æœ‰èƒ½åŠ›æŸ¥çœ‹ç¨‹åºæŒ‡ä»¤ä¸€æ¡æ¡åœ°æ‰§è¡Œï¼Œè¿™æ ·ä½ è¿™æ ·çš„ç¨‹åºå‘˜å°±æœ‰æœºä¼šè€ƒè™‘åœ¨ç§’çº§ï¼Œåˆ†é’Ÿçº§ï¼Œæˆ–è€…å°æ—¶çº§çš„æ—¶é—´ä¸Šå‘ç”Ÿäº†ä»€ä¹ˆï¼Œè€Œä¸æ˜¯çº³ç§’çº§çš„æ—¶é—´ä¸Šã€‚åœ¨è¿™ä¸ªæ—¶é—´ä¸Šä»£ç æ€»ä¼šæ˜¯æ‰§è¡Œçš„ã€‚

@item
æœ‰æœºä¼šä¸ä»…æ˜¯è¢«åŠ¨åœ°å‘ç°ä½ çš„ç¨‹åºçš„æ“ä½œï¼Œè€Œä¸”èƒ½å¤Ÿæ§åˆ¶å®ƒï¼Œå¹¶ä¸”å°è¯•ä¸åŒçš„æ‰§è¡Œè·¯å¾„ï¼Œè€Œä¸éœ€è¦æ”¹åŠ¨ä½ çš„æºä»£ç ã€‚

@item
æœ‰æœºä¼šåœ¨ä»»ä½•çš„æ‰§è¡Œæ—¶é—´ç‚¹çœ‹åˆ°æ•°æ®çš„å€¼ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œæ—¶å€™æ”¹å˜å®ƒçš„å€¼ï¼Œä»¥æµ‹è¯•åç»­å…¶å¦‚ä½•æ¥å½±å“ç¨‹åºã€‚ï¼ˆè¿™ä¸€èˆ¬éƒ½åŒ…æ‹¬æŸ¥çœ‹å†…éƒ¨æ•°æ®ç»“æ„çš„èƒ½åŠ›ï¼ŒåŒ…å«ä½ åœ¨ä»£ç ä¸­å®šä¹‰çš„å˜é‡ã€‚ï¼‰

@item
æœ‰èƒ½åŠ›å–å¾—ç¨‹åºçŠ¶æ€çš„é¢å¤– ä¿¡æ¯ï¼Œç”šè‡³æ˜¯å†…éƒ¨ç»“æ„ã€‚
@end itemize

æ‰€æœ‰è¿™æ ·çš„å·¥ä½œéƒ½æä¾›å¤§é‡çš„å¸®åŠ©æ¥ä½¿ç”¨ä½ è‡ªå·±çš„æŠ€èƒ½æ¥ç†è§£ä½ çš„ç¨‹åºçš„ç›®æ ‡ï¼Œä»¥æ­¤æ¥å‘ç°å“ªé‡Œå‡ºäº†é”™ï¼ˆæˆ–è€…ï¼Œé€šè¿‡è¿™æ ·å¯ä»¥æ›´å¥½åœ°ç†è§£ä½ æˆ–è€…åˆ«äººå†™çš„åŠŸèƒ½ç¨‹åºï¼‰ã€‚

@node Debugging Terms
@subsection è°ƒè¯•æ¦‚å¿µ

åœ¨æ·±å…¥ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»‹ç»å…³äºè°ƒè¯•å™¨çš„å‡ ä¸ªé‡è¦æ¦‚å¿µã€‚ä¸‹é¢çš„åˆ—è¡¨å®šä¹‰äº†æœ¬@value{CHAPTER}ä¸­åé¢ä½¿ç”¨åˆ°æœ¯è¯­ï¼š

@table @dfn
@cindex stack frame
@item Stack frame
ç¨‹åºä¸€èˆ¬åœ¨å®ƒä»¬çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨å‡½æ•°ã€‚ä¸€ä¸ªå‡½æ•°è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ–è€…å‡½æ•°è°ƒè¯•è‡ªå·±ï¼ˆé€’å½’ï¼‰ã€‚ä½ å¯ä»¥æŸ¥çœ‹å‡½æ•°è°ƒç”¨çš„é“¾ï¼ˆä¸»ç¨‹åºè°ƒç”¨ Aï¼Œè€Œ A è°ƒç”¨ Bï¼ŒB å†è¯•ç”¨ Cï¼‰ï¼Œä½œä¸ºæ‰§è¡Œå‡½æ•°æ ˆï¼šå½“å‰è¿è¡Œçš„å‡½æ•°åœ¨æ ˆçš„æœ€é¡¶ç«¯ï¼Œå½“å®ƒå®Œæˆæ—¶ï¼ˆè¿”å›ï¼‰ï¼Œä¸‹ä¸€ä¸ªåˆ™æˆä¼šæ´»åŠ¨å‡½æ•°ã€‚è¿™æ ·çš„ä¸€ä¸ªæ ˆæœ¯è¯­ä¸Šå«åš@dfn{è°ƒç”¨æ ˆ}ã€‚

åœ¨è°ƒç”¨æ ˆä¸Šçš„æ¯ä¸€ä¸ªå‡½æ•°ï¼Œç³»ç»Ÿéƒ½ä¼šä¿ç•™ä¸€ä¸ªæ•°æ®åŒºæ¥åŒ…å«å‡½æ•°çš„å‚æ•°ï¼Œæœ¬åœ°å˜é‡ä»¥åŠè¿”å›å€¼ï¼Œä»¥åŠå…¶ä»–çš„â€œç™»è®°â€ä¿¡æ¯ï¼Œä»¥ç”¨æ¥ç®¡ç†è°ƒç”¨æ ˆã€‚è¿™ä¸ªæ•°æ®åŒºè¢«ç§°ä¸º@dfn{æ ˆå¸§}ã€‚

@command{gawk} ä¹Ÿä½¿ç”¨è¿™æ ·çš„æ¨¡å‹ï¼Œå¯ä»¥è®©ä½ è®¿é—®åˆ°è°ƒç”¨æ ˆä»¥åŠæ¯ä¸ªæ ˆå¸§ã€‚ä½ å¯ä»¥çœ‹åˆ°è°ƒç”¨æ ˆï¼Œä»¥åŠä»æ ˆä¸­çš„å“ªä¸ªå‡½æ•°è°ƒç”¨ã€‚ç”¨æ¥æ‰“å°è°ƒç”¨æ ˆçš„å‘½ä»¤æ‰“å°æ¯ä¸ªæ ˆå¸–çš„ä¿¡æ¯ï¼ˆåé¢æœ‰è¯¦ç»†å†…å®¹ï¼‰ã€‚

@item Breakpoint
@cindex breakpoint
åœ¨è°ƒè¯•æœŸé—´ï¼Œä½ å¸¸å¸¸å¸Œæœ›ç¨‹åºæ‰§è¡Œåˆ°ä¸€ä¸ªç‰¹å®šçš„ç‚¹ï¼Œç„¶åç»§ç»­ä»é‚£é‡Œä¸€æ¬¡æ‰§è¡Œä¸€æ¡è¯­å¥ã€‚è¦è¿™ä¹ˆåšçš„æ–¹å¼æ˜¯åœ¨ç¨‹åºä¸­è®¾ç½®ä¸€ä¸ª@dfn{æ–­ç‚¹}ã€‚ä¸€ä¸ªæ–­ç‚¹æ˜¯ç¨‹åºæ‰§è¡Œæ—¶ä¼šæš‚åœï¼ˆåœæ­¢ï¼‰çš„ä½ç½®ï¼Œå› æ­¤ä½ å¯ä»¥å–å¾—ç¨‹åºæ‰§è¡Œæ§åˆ¶æƒã€‚ä½ å¯ä»¥æ·»åŠ æˆ–è€…ç§»é™¤å¤šä¸ªæ–­ç‚¹ã€‚

@item Watchpoint
@cindex watchpoint
ä¸€ä¸ªæŸ¥çœ‹ç‚¹ä¸æ–­ç‚¹ç±»å‹ã€‚ä¸åŒçš„æ˜¯æ–­ç‚¹æ˜¯é¢å‘ä»£ç çš„ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°è¾¾åï¼Œä¼šåœæ­¢æ‰§è¡Œã€‚ä¸€ä¸ªæŸ¥çœ‹ç‚¹ï¼Œåˆ™æŒ‡å®šçš„ç¨‹åºå½“æŸä¸ª@emph{å€¼}æ”¹å˜æ—¶ä¼šåœæ­¢ã€‚è¿™ä¼šç›¸å½“æœ‰ç”¨ï¼Œå› ä¸ºæœ‰æ—¶å˜é‡æ¥æ”¶äº†ä¸€ä¸ªé”™è¯¯çš„å€¼ï¼Œè€ŒåªæŸ¥çœ‹ä»£ç å¾ˆéš¾è·Ÿè¸ªã€‚é€šè¿‡ä½¿ç”¨æŸ¥çœ‹ç‚¹ï¼Œä½ å¯ä»¥åœ¨å˜é‡è¢«èµ‹å€¼æ—¶è€Œåœä¸‹æ¥ï¼Œè¿™æ ·é€šå¸¸å¯ä»¥å¾ˆå¿«åœ°æŸ¥æ‰¾åˆ°é”™è¯¯çš„ä»£ç ã€‚
@end table

@node Awk Debugging
@subsection @command{awk} è°ƒè¯•

è°ƒè¯• @command{awk} ç¨‹åºæœ‰ä¸€äº›æ–¹é¢ä¸è°ƒè¯•å…¶ä»–è¯­è¨€å†™æˆçš„ç¨‹åºæœ‰ä¸€äº›ä¸åŒã€‚

é¦–å…ˆï¼Œ@command{awk} ç¨‹åºé€šå¸¸æ˜¯ä»ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶ä¸­ä¸€è¡Œè¡Œåœ°è¯»å–æ•°æ®ï¼Œç„¶åä½¿ç”¨ç‰¹å®šçš„è§„åˆ™æ“ä½œè¿™äº›è¡Œï¼Œè¿™æ ·ï¼Œæ ¹æ®è¿™äº›è§„åˆ™æ¥æŸ¥çœ‹ç¨‹åºçš„ç¨‹åºçš„æ‰§è¡Œæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ­£å¦‚æˆ‘ä»¬è§åˆ°çš„ï¼Œæ¯ä¸€ä¸ª @command{awk} è§„åˆ™éƒ½åƒä¸€ä¸ªå‡½æ•°ä¸€æ ·ï¼Œå®ƒä»¬æœ‰è‡ªå·±ç‰¹å®šçš„æŒ‡ä»¤å—ã€‚

å¦å¤–ï¼Œç”±äº @command{awk} è®¾è®¡ä¸Šæ˜¯ä¸€ä¸ªå¾ˆç®€ç»ƒçš„è¯­è¨€ï¼Œè¿™æ ·å¾ˆå®¹æ˜“çœ‹èµ°çœ¼ï¼Œè€Œä¸çŸ¥é“æ¯ä¸€ä¸ªè¡Œçš„ @command{awk} ç¨‹åºä»£ç é‡Œé¢åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚ä½¿ç”¨æ›´é«˜å±‚çš„ @command{awk} å‘½ä»¤ï¼Œè°ƒè¯•å™¨ä½¿å¾—æˆ‘ä»¬æœ‰æœºä¼šæ¥æŸ¥çœ‹å•ä¸ªçš„åŸå§‹å‘½ä»¤ã€‚

@node Sample Debugging Session
@section @command{gawk} è°ƒè¯•ä¾‹å­
@cindex sample debugging session

ä¸ºäº†è§£é‡Š @command{gawk} è°ƒç”¨çš„ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­çš„è°ƒè¯•è¿‡ç¨‹ã€‚æˆ‘ä»¬åˆ©ç”¨æ—©å‰æåˆ°çš„ POSIX uniq å‘½ä»¤çš„ @command{awk} å®ç°ï¼ˆæŸ¥çœ‹ @pxref{Uniq Program}ï¼‰æ¥ä½œä¸ºæˆ‘ä»¬çš„ä¾‹å­ã€‚

@menu
* Debugger Invocation::         How to Start the Debugger.
* Finding The Bug::             Finding the Bug.
@end menu

@node Debugger Invocation
@subsection å¦‚ä½•å¼€å¯è°ƒè¯•å™¨
@cindex starting the debugger
@cindex debugger, how to start

å¼€å§‹è°ƒè¯•å™¨å‡ ä¹å°±è·Ÿæ­£å¸¸è¿è¡Œ @command{gawk} ä¸€æ ·ï¼Œåªæ˜¯ä½ éœ€è¦ä¼ é€’ä¸€ä¸ªé¢å¤–çš„é€‰é¡¹ @option{--debug}ï¼Œæˆ–è€…å…¶å¯¹åº”çš„çŸ­é€‰é¡¹ @option{-D}ã€‚åŒ…å«ç¨‹åºçš„æ–‡ä»¶ï¼Œæˆ–è€…ä»»ä½•å—æ”¯æŒçš„åœ¨å‘½ä»¤è¡Œä¸Šçš„ä»£ç ï¼Œéƒ½ä½œä¸ºä¸€ä¸ªæˆ–è€…å¤šä¸ª @option{-f} é€‰é¡¹çš„å‚æ•°ã€‚ï¼ˆ@command{gawk} æ²¡æœ‰ä¸ºå‘½ä»¤è¡Œç¨‹åºè®¾è®¡è°ƒè¯•ï¼Œåªæ”¯æŒåŒ…å«åœ¨æ–‡ä»¶çš„ç¨‹åºï¼‰åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¿™æ ·æ¥è°ƒç”¨è°ƒè¯•å™¨ï¼š

@example
$ @kbd{gawk -D -f getopt.awk -f join.awk -f uniq.awk -1 inputfile}
@end example

@noindent
@file{getopt.awk} ä¸ @file{uniq.awk} ä¸¤ä¸ªç¨‹åºéƒ½åœ¨ @env{$AWKPATH} ç›®å½•ä¸­ã€‚
ï¼ˆGDB æˆ–è€…ç±»ä¼¼è°ƒè¯•å™¨æœ‰ç»éªŒçš„ç”¨æˆ·éƒ½åº”è¯¥æ³¨æ„åˆ°äº†è¿™ä¸ªè¯­æ³•ä¸ä½ ä¹‹å‰æ‰€ä½¿ç”¨çš„è¯­æ³•æœ‰ä¸€äº›è½»å¾®çš„å·®å¼‚ã€‚åœ¨ @command{gawk} è°ƒè¯•å™¨é‡Œï¼Œä½ å°†åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’ç»™è¿è¡Œç¨‹åºçš„å‚æ•°ç»™äº†è°ƒè¯•å™¨ï¼Œè€Œä¸æ˜¯ä½œä¸ºåœ¨è°ƒè¯•æŒ‡ç¤ºç¬¦ä¸‹ @code{run} å‘½ä»¤çš„ä¸€éƒ¨åˆ†ã€‚@option{-1} æ˜¯ @file{uniq.awk} çš„é€‰é¡¹ã€‚

ä¸åƒ @command{gawk} é€šå¸¸æ‰€åšçš„é‚£æ ·ï¼Œç«‹å³å¯¹è¾“å…¥æ–‡ä»¶ @file{inputfile} æ‰§è¡Œç¨‹åºï¼Œè°ƒè¯•å™¨ä»…ä»…è½½å…¥æ‰€æœ‰çš„ç¨‹åºæºä»£ç ï¼Œåœ¨å†…éƒ¨ç¼–è¯‘å®ƒä»¬ï¼Œç„¶åç»™å‡ºæç¤ºç¬¦ï¼š

@example
gawk>
@end example

@noindent
ä»è¿™é‡Œï¼Œä½ ä»¬å¯ä»¥å‘é€å‘½ä»¤åˆ°è°ƒè¯•å™¨ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿˜æ²¡æœ‰ä»£ç è¢«æ‰§è¡Œã€‚

@node Finding The Bug
@subsection æŸ¥æ‰¾ Bug

å‡å……æˆ‘ä»¬åœ¨ä½¿ç”¨ï¼ˆä¸€ä¸ªæœ‰é”™è¯¯çš„ç‰ˆæœ¬ï¼‰@file{uniq.awk} ä¸­çš„ â€œåŸŸè·¨è¶Šâ€æ¨¡å¼æ—¶æœ‰é—®é¢˜ï¼Œçœ‹èµ·æ¥ï¼Œå½“è¦è·³è¿‡ç¬¬ä¸€ä¸ªåŸŸæ—¶ï¼Œå®ƒæ²¡æœ‰æ•è·åˆ°æœ¬æ¥ç›¸åŒçš„è¡Œï¼Œå¦‚ï¼š

@example
awk is a wonderful program!
gawk is a wonderful program!
@end example

è¿™æœ‰å¯èƒ½ä¼šå‘ç”Ÿï¼Œå¦‚æœæˆ‘ä»¬å°†åœ¨è®°å½•ä¸­çš„åŸŸæƒ³æˆæ˜¯ä¸€ä¸ªä»¥ 0 å¼€å§‹ï¼ˆC é£æ ¼ï¼‰ç¼–å·çš„ï¼Œæ‰€ä»¥æœ¬æ¥åº”è¯¥å†™æˆä¸‹é¢çš„è¡Œï¼š

@example
clast = join(alast, fcount+1, n)
cline = join(aline, fcount+1, m)
@end example

@noindent
æˆ‘ä»¬å†™æˆäº†ï¼š

@example
clast = join(alast, fcount, n)
cline = join(aline, fcount, m)
@end example

æˆ‘ä»¬ç¬¬ä¸€ä»¶è¦åšçš„äº‹å¸¸å¸¸æ˜¯è¦æ£€æŸ¥å‡ºè¿™æ ·çš„é—®é¢˜æ˜¯åœ¨ç¨‹åºä¸­è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å®ƒä»¬å¦‚ä½•å·¥ä½œï¼Œå¹¶æ•è·åˆ°å‘ç”Ÿçš„é”™è¯¯ã€‚åœ¨ @file{uniq.awk} ä¸­åˆç†çš„æ–­ç‚¹æ˜¯åœ¨å‡½æ•° @code{are_equal()} çš„å¼€å§‹å¤„ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œä¼šå°†å½“å‰è¡Œä¸å‰ä¸€ä¸ªè¡Œè¿›è¡Œæ¯”è¾ƒã€‚è¦è®¾ç½®æ–­ç‚¹ï¼Œä½¿ç”¨ @code{b}ï¼ˆbreakpointï¼‰å‘½ä»¤ï¼š

@example
gawk> @kbd{b are_equal}
@print{} Breakpoint 1 set at file `awklib/eg/prog/uniq.awk', line 63
@end example

è°ƒè¯•å™¨å‘Šè¯‰æˆ‘ä»¬æ–­ç‚¹æ‰€åœ¨çš„æ–‡ä»¶ä»¥åŠè¡Œå·ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¾“å…¥ @samp{r} æˆ–è€… @samp{run}ï¼Œç„¶åç¨‹åºä¼šæ‰§è¡Œï¼Œç›´åˆ°å…¶ç¬¬ä¸€æ¬¡å‘½ä»¤æ–­ç‚¹ï¼š

@example
gawk> @kbd{r}
@print{} Starting program:
@print{} Stopping in Rule ...
@print{} Breakpoint 1, are_equal(n, m, clast, cline, alast, aline)
         at `awklib/eg/prog/uniq.awk':63
@print{} 63          if (fcount == 0 && charcount == 0)
gawk>
@end example

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ç¨‹åºä¸­å“ªé‡Œå‡ºäº†é—®é¢˜ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬æ˜¯æ€ä¹ˆæ¥åˆ°ç°åœ¨çš„ä½ç½®ã€‚åœ¨æç¤ºç¬¦ä¸‹ï¼Œæˆ‘ä»¬è¾“å…¥ @samp{bt}ï¼ˆâ€œbacktraceâ€çš„ç¼©å†™ï¼‰ï¼Œåˆ™è°ƒè¯•å™¨ä¼šè¿”å›å½“å‰æ ˆå¸§çš„åˆ—è¡¨ï¼š

@example
gawk> @kbd{bt}
@print{} #0  are_equal(n, m, clast, cline, alast, aline)
         at `awklib/eg/prog/uniq.awk':68
@print{} #1  in main() at `awklib/eg/prog/uniq.awk':88
@end example

è¿™å‘Šè¯‰æˆ‘ä»¬ @code{are_equal()} æ˜¯åœ¨ä¸»ç¨‹åº @file{uniq.awk} ç¬¬ 88 è¡Œè°ƒç”¨çš„ã€‚ï¼ˆè¿™æ²¡ä»€ä¹ˆå¤§æƒŠå°æ€ªçš„ï¼Œå› æ­¤è¿™æ˜¯åœ¨ç¨‹åºä¸­å”¯ä¸€è°ƒç”¨ @code{are_equal()} çš„åœ°æ–¹ï¼Œä½†æ˜¯åœ¨æ›´å¤æ‚çš„ç¨‹åºä¸­ï¼Œäº†è§£è°è°ƒç”¨äº†å‡½æ•°ï¼Œä»¥åŠç›¸åº”çš„å‚æ•°æ˜¯æŸ¥æ‰¾åˆ°ç¨‹åºé—®é¢˜çš„å…³é”®ã€‚ï¼‰

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åœ¨ @code{are_equal()} ä¸­äº†ï¼Œæˆ‘ä»¬å¼€å§‹æ¥æŸ¥çœ‹æŸäº›å˜é‡çš„å€¼ã€‚å‡è®¾æˆ‘ä»¬è¾“å…¥ @samp{p n}ï¼ˆp æ˜¯ â€œprintâ€çš„ç¼©å†™ï¼‰ã€‚æˆ‘ä»¬æœŸæœ›çœ‹åˆ° @code{are_equal()} å‚æ•° @code{n} çš„å€¼ã€‚å®é™…æ˜¯ï¼Œè°ƒè¯•å™¨è¿”å›ï¼š

@example
gawk> @kbd{p n}
@print{} n = untyped variable
@end example

@noindent
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ@code{n} æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–çš„æœ¬åœ°å˜é‡ï¼Œå› ä¸ºå‡½æ•°è°ƒç”¨æ—¶æ²¡æœ‰æä¾›ç»˜ç”»å®ƒå‚æ•°ï¼ˆæŸ¥çœ‹ @pxref{Function Calls}ï¼‰ã€‚

è¦æ˜¾ç¤ºçš„æ›´æœ‰ç”¨çš„å˜é‡åº”è¯¥æ˜¯å½“å‰è®°å½•ï¼š

@example
gawk> @kbd{p $0}
@print{} $0 = "gawk is a wonderful program!"
@end example

@noindent
åœ¨ä¸€å¼€å§‹ï¼Œè¿™ä¸ªå¯èƒ½ä¼šæœ‰ä¸€ç‚¹ç–‘æƒ‘ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬çš„æµ‹è¯•è¾“å…¥çš„ç¬¬äºŒè¡Œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ @code{NR}ï¼š

@example
gawk> @kbd{p NR}
@print{} NR = 2
@end example

@noindent
å› æ­¤ï¼Œæˆ‘ä»¬çœ‹åˆ° @code{are_equal()} åªä¼šä»æ–‡ä»¶çš„ç¬¬äºŒä¸ªè®°å½•å¼€å§‹è°ƒç”¨ã€‚å½“ç„¶ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åŒ…å«äº†è¿™æ ·çš„ä¸€ä¸ªè§„åˆ™ @samp{@code{NR} == 1} ï¼š

@example
NR == 1 @{
    last = $0
    next
@}
@end example

å¥½äº†ï¼Œè®©æˆ‘ä»¬æŸ¥çœ‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„è§„åˆ™ï¼š

@example
gawk> @kbd{p last}
@print{} last = "awk is a wonderful program!"
@end example

ç›®å‰æˆ‘ä»¬æ‰€åšçš„ä¸€åˆ‡éƒ½åªæ˜¯è¯´æ˜ç¨‹åºæ­£å¦‚è®¡åˆ’çš„é‚£æ ·æ‰§è¡Œï¼Œç›´è‡³ @code{are_equal()} ä¸ºæ­¢ï¼ŒåŒ…å«å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤é—®é¢˜ä¸€å®šå‡ºåœ¨å‡½æ•°å†…éƒ¨ã€‚ä¸ºäº†è¿›ä¸€æ­¥è°ƒæŸ¥ï¼Œæˆ‘ä»¬å¿…é¡»â€œä¸€æ­¥æ­¥â€åœ°æ‰§è¡Œ @code{are_equal()} çš„ä»£ç è¡Œã€‚æˆ‘ä»¬æ•²å…¥ @samp{n}ï¼ˆè¡¨ç¤ºâ€œnextâ€ï¼‰ï¼š

@example
gawk> @kbd{n}
@print{} 66          if (fcount > 0) @{
@end example

è¿™å‘Šè¯‰æˆ‘ä»¬ï¼Œ@command{gawk} ç°åœ¨å·²ç»å‡†å¤‡æ‰§è¡Œç¬¬ 66 è¡Œï¼Œç¡®å®šè¿™æ˜¯å¦éœ€è¦ç»™è¡Œç‰¹æ®Šçš„â€œåŸŸè·¨è¶Šâ€å¤„ç†ï¼Œæ­£å¦‚å‘½ä»¤è¡Œé€‰é¡¹ @option{-1} æ‰€ç¤ºçš„é‚£æ ·ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ˜¯ä»æˆ‘ä»¬ä¹‹å‰æ‰€åœ¨çš„ä½ç½®ï¼Œç¬¬ 63 è¡Œï¼Œè·³åˆ°ç›®å‰æ‰€åœ¨çš„ä½ç½®ï¼Œå› ä¸ºåœ¨ 63 è¡Œçš„æ¡ä»¶æ˜¯ @samp{if (fcount == 0 && charcount == 0)}ï¼Œè€Œå…¶å€¼ä¸º falseã€‚ï¼‰

ç»§ç»­æ‰§è¡Œä¸€æ­¥ï¼Œæˆ‘ä»¬ç°åœ¨åˆ°äº†å°†å½“å‰ä¸æœ€åè®°å½•è¿›è¡Œåˆ†å‰²çš„åœ°æ–¹ï¼š

@example
gawk> @kbd{n}
@print{} 67              n = split(last, alast)
gawk> @kbd{n}
@print{} 68              m = split($0, aline)
@end example

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¾ˆå¥½å¥‡åœ°å»æŸ¥çœ‹è®°å½•è¢«åˆ†å‰²æˆäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬è¯•ç€å»æŸ¥çœ‹ï¼š

@example
gawk> @kbd{p n m alast aline}
@print{} n = 5
@print{} m = untyped variable
@print{} alast = array, 5 elements
@print{} aline = untyped variable
@end example

@noindent
ï¼ˆ@code{p} å‘½ä»¤å¯ä»¥æœ‰å¤šäºä¸€ä¸ªå‚æ•°ï¼Œä¸ @command{awk} çš„ @code{printf} è¯­å¥ç±»ä¼¼ã€‚ï¼‰

ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹å¤±æœ›ã€‚æˆ‘ä»¬æ‰¾åˆ°çš„æ˜¯åœ¨é‡Œé¢æœ‰ 5 ä¸ªå…ƒç´ çš„ @code{alast}ï¼Œ@code{m} ä¸ @code{aline} æ²¡æœ‰å€¼ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨è¡Œ 68ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ‰§è¡Œã€‚è¿™ä¸ªä¿¡æ¯å·²ç»å¤Ÿç”¨äº†ï¼ˆæˆ‘ä»¬ç°åœ¨çŸ¥é“æ²¡æœ‰å•è¯è¢«æ— æ„é—´ä¸¢æ‰äº†ï¼‰ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“æ•°ç»„é‡Œæœ‰ä»€ä¹ˆæ€ä¹ˆåŠï¼Ÿ

ç¬¬ä¸€ä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨ä¸‹æ ‡ï¼š

@example
gawk> @kbd{p alast[0]}
@print{} "0" not in array `alast'
@end example

@noindent
Oops!

@example
gawk> @kbd{p alast[1]}
@print{} alast["1"] = "awk"
@end example

å¦‚æœæœ‰ 100 ä¸ªæˆå‘˜çš„æ•°ç»„ï¼Œè¿™å°±å¤ªæ…¢äº†ï¼Œæ‰€ä»¥ï¼Œ@command{gawk} æä¾›äº†ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼ˆå¯¹äºå…¶ä»–è¯­è¨€çš„æ—§æƒ…æ€€å°±ä¸æäº†ï¼‰ï¼š

@example
gawk> @kbd{p @@alast}
@print{} alast["1"] = "awk"
@print{} alast["2"] = "is"
@print{} alast["3"] = "a"
@print{} alast["4"] = "wonderful"
@print{} alast["5"] = "program!"
@end example

ç›®å‰çœ‹èµ·æ¥ï¼Œä¸€åˆ‡ OKï¼Œè®©æˆ‘ä»¬å†æ‰§è¡Œä¸€ä¸¤æ­¥ï¼š

@example
gawk> @kbd{n}
@print{} 69              clast = join(alast, fcount, n)
gawk> @kbd{n}
@print{} 70              cline = join(aline, fcount, m)
@end example

å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»åˆ°è¾¾äº†é”™è¯¯çš„åœ°æ–¹ï¼ˆæŠ±æ­‰ç ´åäº†æ‚¬å¿µï¼‰ã€‚åœ¨æˆ‘ä»¬çš„å¤§è„‘ä¸­æ˜¯ä»ç¬¬äºŒä¸ªåŸŸå¼€å§‹æ¥ç”Ÿæˆä¸€ä¸ªå‡è®°å½•æ¥è¿›è¡Œæ¯”è¾ƒã€‚è€Œå¦‚æœç¬¬ä¸€ä¸ªè®°å½•ç¼–å·ä¸º 0ï¼Œè¿™å°±ä¼šå·¥ä½œã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å¾—åˆ°ä»€ä¹ˆï¼š

@example
gawk> @kbd{p cline clast}
@print{} cline = "gawk is a wonderful program!"
@print{} clast = "awk is a wonderful program!"
@end example

å˜¿ï¼Œçœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼ä»–ä»¬å°±æ˜¯åŸæ¥çš„å€¼ï¼Œæ²¡æœ‰æ”¹å˜ã€‚æ€è€ƒç‰‡åˆ»ï¼ˆäººçš„å¤§è„‘ä¾ç„¶æ˜¯æœ€å¥½çš„è°ƒè¯•å·¥å…·ï¼‰ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬å°‘åŠ äº† 1ï¼

æˆ‘ä»¬é€€å‡ºè°ƒè¯•å™¨ï¼š

@example
gawk> @kbd{q}
@print{} The program is running. Exit anyway (y/n)? @kbd{y}
@end example

@noindent
ç„¶åè¿›å…¥ç¼–è¾‘å™¨ç¼–è¾‘ï¼š

@example
clast = join(alast, fcount+1, n)
cline = join(aline, fcount+1, m)
@end example

@noindent
ç„¶åé—®é¢˜è§£å†³ï¼

@node List of Debugger Commands
@section ä¸»è¦çš„è°ƒè¯•å™¨å‘½ä»¤

@command{gawk} è°ƒè¯•å™¨å‘½ä»¤å¯ä»¥è¢«åˆ†ä¸ºä¸‹é¢çš„å‡ ç±»ï¼š

@itemize @value{BULLET}

@item
æ–­ç‚¹æ§åˆ¶

@item
æ‰§è¡Œæ§åˆ¶

@item
æŸ¥çœ‹ä¸æ›´æ”¹æ•°æ®

@item
ä½¿ç”¨æ ˆ

@item
è·å–ä¿¡æ¯

@item
å…¶ä»–
@end itemize

æ¯ä¸ªä¸ªç±»å‹éƒ½åœ¨ä¸‹é¢çš„èŠ‚ä¸­è¿›è¡Œè®¨è®ºã€‚åœ¨ä¸‹é¢çš„æè¿°ä¸­ï¼Œå‘½ä»¤ï¼Œå¯èƒ½è¢«ç¼©å†™æ˜¾ç¤ºåœ¨ç¬¬äºŒä¸ªæè¿°è¡Œã€‚è°ƒè¯•å™¨å‘½ä»¤åå¦‚æœæ²¡æœ‰äºŒä¹‰ï¼Œåˆ™ä¹Ÿå¯ä»¥è¢«ä¸¢å¼ƒåé¢ä¸€éƒ¨åˆ†ã€‚è°ƒè¯•å™¨æœ‰å†…ç½®çš„è‡ªåŠ¨é‡å¤å‰ä¸€ä¸ªå‘½ä»¤çš„èƒ½åŠ›ï¼Œåªéœ€è¦è¾“å…¥å›è½¦é”® @kbd{Enter}ã€‚è¿™å¯ç”¨äºå‘½ä»¤åˆ—è¡¨ï¼Œ@code{next}ï¼Œ@code{nexti}ï¼Œ@code{step}ï¼Œ@code{stepi}ï¼Œä»¥åŠ @code{continue} ç­‰ä¸å¸¦å‚æ•°çš„å‘½ä»¤ã€‚

@menu
* Breakpoint Control::          Control of Breakpoints.
* Debugger Execution Control::  Control of Execution.
* Viewing And Changing Data::   Viewing and Changing Data.
* Execution Stack::             Dealing with the Stack.
* Debugger Info::               Obtaining Information about the Program and
                                the Debugger State.
* Miscellaneous Debugger Commands:: Miscellaneous Commands.
@end menu

@node Breakpoint Control
@subsection æ§åˆ¶æ–­ç‚¹

å¦‚æ—©å‰çœ‹è§ï¼Œä½ è¦å¼€å¯ä¸€ä¸ªè°ƒè¯•è¿‡ç¨‹æ—¶ï¼Œè¦è€ƒè™‘çš„ç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯è®¾ç½®å¥½æ–­ç‚¹ï¼Œå› ä¸ºç¨‹åºä¼šåƒæ²¡æœ‰è°ƒè¯•å™¨ä¸€æ ·è¿è¡Œä¸‹å»ã€‚ç”¨äºæ§åˆ¶æ–­ç‚¹çš„å‘½ä»¤æœ‰ï¼š

@table @asis
@cindex debugger commands, @code{b} (@code{break})
@cindex debugger commands, @code{break}
@cindex @code{break} debugger command
@cindex @code{b} debugger command (alias for @code{break})
@cindex set breakpoint
@cindex breakpoint, setting
@item @code{break} [[@var{filename}@code{:}]@var{n} | @var{function}] [@code{"@var{expression}"}]
@itemx @code{b} [[@var{filename}@code{:}]@var{n} | @var{function}] [@code{"@var{expression}"}]
å¦‚æœä¸å¸¦ä»»ä½•å‚æ•°ï¼Œåˆ™åœ¨æ‰€é€‰æ‹©çš„æ ˆä¸­çš„ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„æŒ‡ä»¤å¤„è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚å‚æ•°å¯ä»¥æ˜¯å¦‚ä¸‹æ ¼å¼ï¼š

@c @asis for docbook
@c nested table
@table @asis
@item @var{n}
åœ¨å½“å‰çš„æºæ–‡ä»¶ä¸­çš„ @var{n} è¡Œè®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚

@item @var{filename}@code{:}@var{n}
åœ¨æºæ–‡ä»¶ @var{filename} çš„ @var{n} è¡Œè®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚

@item @var{function}
åœ¨å‡½æ•° @var{function}ï¼ˆç¬¬ä¸€æ¡æŒ‡ä»¤ï¼‰å…¥å£å¤„è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚
@end table

æ¯ä¸€ä¸ªæ–­ç‚¹è¢«èµ‹ç»™äº†ä¸€ä¸ªæ•°å€¼ï¼Œå¯ä»¥ç”¨ @code{delete} å‘½ä»¤æ¥ä»æ–­ç‚¹åˆ—è¡¨ä¸­åˆ é™¤ã€‚

å¯¹äºæ–­ç‚¹ï¼Œä½ è¿˜å¯ä»¥æä¾›ä¸€ä¸ªæ¡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ª @command{awk} çš„è¡¨è¾¾å¼ï¼ˆåŒ…åœ¨åŒå¼•å·ä¸­ï¼‰ï¼Œè¿™æ ·è°ƒè¯•å™¨å½“åˆ°åˆ°æ–­ç‚¹æ—¶å¯ä»¥å¯¹å…¶æ±‚å€¼ã€‚å¦‚æœæ¡ä»¶ä¸º trueï¼Œåˆ™è°ƒè¯•å™¨åœæ­¢æ‰§è¡Œï¼Œç„¶åæç¤ºç­‰å¾…å‘½ä»¤è¾“å…¥ã€‚å¦åˆ™ï¼Œå®ƒä¼šç»§ç»­æ‰§è¡Œç¨‹åºã€‚

@cindex debugger commands, @code{clear}
@cindex @code{clear} debugger command
@cindex delete breakpoint at location
@cindex breakpoint at location, how to delete
@item @code{clear} [[@var{filename}@code{:}]@var{n} | @var{function}]
å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œåˆ™åœ¨å½“å‰çš„æ ˆä¸­åˆ é™¤ä¸‹ä¸€æ¡è¦æ‰§è¡Œå‘½ä»¤çš„æ‰€æœ‰æ–­ç‚¹ã€‚å¦‚æœç¨‹åºåœ¨æ–­ç‚¹ä¸Šåœæ­¢äº†ï¼Œè¿™ä¼šåˆ é™¤é‚£ä¸ªæ–­ç‚¹ï¼Œè¿™æ ·ç¨‹åºåœ¨é‚£ä¸ªä½ç½®ä¸ä¼šå†åœä¸‹æ¥ã€‚å‚æ•°å¯ä»¥æœ‰ä¸‹é¢çš„å½¢å¼ï¼š

@c nested table
@table @asis
@item @var{n}
åœ¨å½“å‰æºæ–‡ä»¶ä¸­åˆ é™¤åœ¨ @var{n} è¡Œä¸Šè®¾ç½®çš„æ–­ç‚¹ã€‚

@item @var{filename}@code{:}@var{n}
åˆ é™¤æºæ–‡ä»¶ @var{filename} è¡Œ @var{n} ä¸­çš„æ–­ç‚¹ã€‚

@item @var{function}
åˆ é™¤æºå‡½æ•° @var{function} çš„æ–­ç‚¹ã€‚
@end table

@cindex debugger commands, @code{condition}
@cindex @code{condition} debugger command
@cindex breakpoint condition
@item @code{condition} @var{n} @code{"@var{expression}"}
ç»™å·²ç»å­˜åœ¨çš„æ–­ç‚¹æˆ–è€…æŸ¥çœ‹ç‚¹ @var{n} åŠ ä¸€ä¸ªé¢å¤–çš„æ¡ä»¶ã€‚æ¡ä»¶æ˜¯ä¸€ä¸ª @command{awk} è¡¨è¾¾å¼ï¼Œ@emph{ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œ}å½“æ–­ç‚¹æˆ–è€…æŸ¥çœ‹ç‚¹åˆ°è¾¾æ—¶ï¼Œä¼šå¯¹å…¶è¿›è¡Œæ±‚å€¼ã€‚å¦‚æœæ¡ä»¶ä¸º trueï¼Œåˆ™è°ƒè¯•å™¨ä¼šåœæ­¢æ‰§è¡Œç„¶åæç¤ºå‘½ä»¤è¾“å…¥ã€‚å¦åˆ™ï¼Œè°ƒè¯•å™¨ä¼šç»§ç»­æ‰§è¡Œç¨‹åºã€‚å¦‚æœæ¡ä»¶è¡¨è¾¾å¼æ²¡æœ‰è¢«æŒ‡å®šï¼Œåˆ™å·²ç»å­˜åœ¨çš„æ¡ä»¶ä¼šè¢«åˆ é™¤ï¼ˆå³ï¼Œæ–­ç‚¹æˆ–è€…æŸ¥çœ‹ç‚¹ä¼šè¢«è®¾ç½®æˆæ— æ¡ä»¶çš„ï¼‰ã€‚

@cindex debugger commands, @code{d} (@code{delete})
@cindex debugger commands, @code{delete}
@cindex @code{delete} debugger command
@cindex @code{d} debugger command (alias for @code{delete})
@cindex delete breakpoint by number
@cindex breakpoint, delete by number
@item @code{delete} [@var{n1 n2} @dots{}] [@var{n}--@var{m}]
@itemx @code{d} [@var{n1 n2} @dots{}] [@var{n}--@var{m}]
åˆ é™¤æŒ‡å®šçš„æ–­ç‚¹ï¼Œæˆ–è€…æ–­ç‚¹èŒƒå›´ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‚æ•°ï¼Œåˆ™åˆ é™¤æ‰€æœ‰çš„æ–­ç‚¹ã€‚

@cindex debugger commands, @code{disable}
@cindex @code{disable} debugger command
@cindex disable breakpoint
@cindex breakpoint, how to disable or enable
@item @code{disable} [@var{n1 n2} @dots{} | @var{n}--@var{m}]
ç¦ç”¨æŒ‡å®šçš„æ–­ç‚¹æˆ–è€…æ–­ç‚¹èŒƒå›´ã€‚å¦‚æœæ²¡æœ‰å¸¦å‚æ•°ï¼Œåˆ™ç¦ç”¨æ‰€æœ‰çš„æ–­ç‚¹ã€‚

@cindex debugger commands, @code{e} (@code{enable})
@cindex debugger commands, @code{enable}
@cindex @code{enable} debugger command
@cindex @code{e} debugger command (alias for @code{enable})
@cindex enable breakpoint
@item @code{enable} [@code{del} | @code{once}] [@var{n1 n2} @dots{}] [@var{n}--@var{m}]
@itemx @code{e} [@code{del} | @code{once}] [@var{n1 n2} @dots{}] [@var{n}--@var{m}]
å¯ç”¨æŒ‡å®šçš„æ–­ç‚¹æˆ–è€…èŒƒå›´å†…çš„æ–­ç‚¹ã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œåˆ™å¯ç”¨æ‰€æœ‰çš„æ–­ç‚¹ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹©æ€§åœ°å®šä¹‰å¦‚ä½•æ¥æ¢å¤æ–­ç‚¹ï¼š

@c nested table
@table @code
@item del
ä¸´æ—¶å¯ç”¨æ–­ç‚¹ï¼Œç„¶åç¨‹åºåœ¨æ­¤åœæ­¢æ—¶åˆ é™¤æ¯ä¸ªæ–­ç‚¹ã€‚

@item once
ä¸´æ—¶å¯ç”¨æ–­ç‚¹ï¼Œç„¶åç¨‹åºåœ¨æ­¤åœæ­¢æ—¶ç¦ç”¨æ¯ä¸ªæ–­ç‚¹ã€‚
@end table

@cindex debugger commands, @code{ignore}
@cindex @code{ignore} debugger command
@cindex ignore breakpoint
@item @code{ignore} @var{n} @var{count}
å¿½ç•¥æ–­ç‚¹ @var{n} åé¢å‘½ä¸­çš„ @var{count} æ¬¡ã€‚

@cindex debugger commands, @code{t} (@code{tbreak})
@cindex debugger commands, @code{tbreak}
@cindex @code{tbreak} debugger command
@cindex @code{t} debugger command (alias for @code{tbreak})
@cindex temporary breakpoint
@item @code{tbreak} [[@var{filename}@code{:}]@var{n} | @var{function}]
@itemx @code{t} [[@var{filename}@code{:}]@var{n} | @var{function}]
è®¾ç½®ä¸´æ—¶æ–­ç‚¹ï¼ˆåªå¯ç”¨ä¸€æ¬¡ï¼‰ã€‚å‚æ•°ä¸ @code{break} ä¸€æ ·ã€‚
@end table

@node Debugger Execution Control
@subsection æ§åˆ¶æ‰§è¡Œ

ç°åœ¨ï¼Œä½ çš„æ–­ç‚¹å·²ç»å‡†å¤‡å¥½äº†ï¼Œä½ å¯ä»¥å¼€å§‹è¿è¡Œç¨‹åºï¼Œç„¶åè§‚å¯Ÿå®ƒçš„è¡Œä¸ºã€‚æœ‰å¤šä¸ªå‘½ä»¤ç”¨æ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œï¼Œä¹‹å‰æˆ‘ä»¬å·²ç»çœ‹è¿‡ï¼š

@table @asis
@cindex debugger commands, @code{commands}
@cindex @code{commands} debugger command
@cindex debugger commands, @code{silent}
@cindex @code{silent} debugger command
@cindex debugger commands, @code{end}
@cindex @code{end} debugger command
@cindex breakpoint commands
@cindex commands to execute at breakpoint
@item @code{commands} [@var{n}]
@itemx @code{silent}
@itemx @dots{}
@itemx @code{end}
è®¾ç½®ä¸€ä¸ªå‘½ä»¤åˆ—è¡¨ï¼Œå½“åœ¨æ–­ç‚¹æˆ–è€…æŸ¥çœ‹ç‚¹å¤„åœæ­¢æ—¶ä¼šè¢«æ‰§è¡Œã€‚@var{n} æ˜¯æ–­ç‚¹æˆ–è€…æŸ¥çœ‹ç‚¹ç¼–å·ã€‚å¦‚æœæ²¡æœ‰ç¼–å·ï¼Œåˆ™ä¼šä½¿ç”¨æœ€åä¸€ä¸ªã€‚åé¢çš„å‘½ä»¤ï¼Œä»ä¸‹ä¸€è¡Œå¼€å§‹ï¼Œç„¶ååœ¨ @code{end} å‘½ä»¤å¤„ç»“æŸã€‚å¦‚æœå‘½ä»¤ @code{silent} åœ¨åˆ—è¡¨ä¸­ï¼Œåˆ™é€šå¸¸çš„åœ¨æ–­ç‚¹åœæ­¢å¤„çš„æ¶ˆæ¯ä»¥åŠæºä»£ç å°±ä¼šè¢«æ‰“å°ã€‚åœ¨åˆ—è¡¨ä¸­çš„æ‰€æœ‰å‘½ä»¤å¦‚æœç»§ç»­æ‰§è¡Œä»£ç ï¼ˆå¦‚ @code{continue}ï¼‰ä¼šç»“æŸåˆ—è¡¨ï¼ˆä¸€ä¸ªéšå¼çš„ @code{end}ï¼‰ï¼Œåé¢çš„å‘½ä»¤ä¼šè¢«å¿½ç•¥æ‰ã€‚å¦‚ï¼š

@example
gawk> @kbd{commands}
> @kbd{silent}
> @kbd{printf "A silent breakpoint; i = %d\n", i}
> @kbd{info locals}
> @kbd{set i = 10}
> @kbd{continue}
> @kbd{end}
gawk>
@end example

@cindex debugger commands, @code{c} (@code{continue})
@cindex debugger commands, @code{continue}
@cindex continue program, in debugger
@item @code{continue} [@var{count}]
@itemx @code{c} [@var{count}]
ç»§ç»­æ‰§è¡Œç¨‹åºã€‚å¦‚æœä»æ–­ç‚¹å¤„ç»§ç»­ï¼Œè€ŒæŒ‡å®šäº† @var{count}ï¼Œåˆ™å¿½ç•¥æ‰€åœ¨å¤„çš„æ–­ç‚¹åé¢çš„ @var{count} æ¬¡å‘½ä¸­ã€‚ç›´åˆ°æ‰€é€‰æ‹©çš„å¸§ç»“æŸã€‚å¹¶æ‰“å°è¿”å›å€¼ã€‚

@cindex debugger commands, @code{finish}
@cindex @code{finish} debugger command
@item @code{finish}
æ‰§è¡Œä»£ç ç›´åˆ°æ‰€é€‰æ‹©çš„å¸§è¿”å›ï¼Œå¹¶æ‰“å°è¿”å›å€¼ã€‚

@cindex debugger commands, @code{n} (@code{next})
@cindex debugger commands, @code{next}
@cindex @code{next} debugger command
@cindex @code{n} debugger command (alias for @code{next})
@cindex single-step execution, in the debugger
@item @code{next} [@var{count}]
@itemx @code{n} [@var{count}]
ç»§ç»­æ‰§è¡Œä¸‹ä¸€è¡Œæºä»£ç ï¼Œå‡½æ•°è°ƒç”¨ä¸€æ¬¡åˆ’è¿‡ã€‚å‚æ•° @var{count} æ§åˆ¶é‡å¤å¤šå°‘æ¬¡ï¼Œä¸ @code{step} ä¸€æ ·ã€‚

@cindex debugger commands, @code{ni} (@code{nexti})
@cindex debugger commands, @code{nexti}
@cindex @code{nexti} debugger command
@cindex @code{ni} debugger command (alias for @code{nexti})
@item @code{nexti} [@var{count}]
@itemx @code{ni} [@var{count}]
æ‰§è¡Œ 1 ä¸ªæˆ–è€… @var{count} ä¸ªæŒ‡ä»¤ï¼Œå¹¶è¶Šè¿‡å‡½æ•°è°ƒç”¨ã€‚

@cindex debugger commands, @code{return}
@cindex @code{return} debugger command
@item @code{return} [@var{value}]
å–æ¶ˆå‡½æ•°è°ƒç”¨ã€‚å¦‚æœ @var{value}ï¼ˆä¸€ä¸ªå­—ä¸²æˆ–è€…æ•°å€¼ï¼‰è¢«æŒ‡å®šäº†ï¼Œåˆ™å®ƒä¼šä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ã€‚å¦‚æœæ˜¯åœ¨ä¸æ˜¯æœ€å†…å±‚ï¼ˆå½“å‰çš„æ‰§è¡Œå‡½æ•°ï¼Œå³å¸§ 0 ï¼‰çš„å¸§ä¸­ä½¿ç”¨ï¼Œä¼šå–æ¶ˆæ‰€æœ‰æœ€å†…å±‚çš„å¸§ï¼ŒåŒ…æ‹¬æ‰€åœ¨çš„å¸§ï¼Œè¯¥å¸§çš„è°ƒç”¨è€…ä¼šæˆä¸ºæœ€å†…å±‚å¸§ã€‚

@cindex debugger commands, @code{r} (@code{run})
@cindex debugger commands, @code{run}
@cindex @code{run} debugger command
@cindex @code{r} debugger command (alias for @code{run})
@item @code{run}
@itemx @code{r}
å¼€å§‹/é‡æ–°å¼€å§‹ç¨‹åºçš„æ‰§è¡Œã€‚å½“é‡æ–°å¼€å§‹æ—¶ï¼Œè°ƒè¯•å™¨ä¼šä¿ç•™å½“å‰çš„æ–­ç‚¹ï¼ŒæŸ¥çœ‹ç‚¹ä»¥åŠå‘½ä»¤å†å²ï¼Œè‡ªåŠ¨æ˜¾ç¤ºå˜é‡ï¼Œä»¥åŠè°ƒè¯•å™¨é€‰é¡¹ã€‚

@cindex debugger commands, @code{s} (@code{step})
@cindex debugger commands, @code{step}
@cindex @code{step} debugger command
@cindex @code{s} debugger command (alias for @code{step})
@item @code{step} [@var{count}]
@itemx @code{s} [@var{count}]
ç»§ç»­æ‰§è¡Œç›´åˆ°æ§åˆ¶æµåˆ°åˆ°å½“å‰å¸§çš„æºä»£ç è¡Œçš„ä¸åŒä½ç½®ï¼Œå¹¶è¿›å…¥è¯¥è¡Œè°ƒç”¨çš„å‡½æ•°ä¸­ã€‚å¦‚æœå‚æ•° @var{count} è¢«æŒ‡å®šäº†ï¼Œåˆ™è¡¨ç¤ºåœ¨åœæ­¢å‰å•ç‹¬æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œé™¤éå®ƒé‡åˆ°äº†æ–­ç‚¹æˆ–è€…æŸ¥çœ‹ç‚¹ã€‚

@cindex debugger commands, @code{si} (@code{stepi})
@cindex debugger commands, @code{stepi}
@cindex @code{stepi} debugger command
@cindex @code{si} debugger command (alias for @code{stepi})
@item @code{stepi} [@var{count}]
@itemx @code{si} [@var{count}]
æ‰§è¡Œ 1 ä¸ªï¼ˆæˆ–è€… @var{count}ï¼‰ä¸ªæŒ‡ä»¤ï¼Œå¹¶è¿›å…¥å‡½æ•°è°ƒç”¨ä¸­ã€‚ï¼ˆä¸ºäº†è¯´æ˜â€œæŒ‡ä»¤â€çš„å«ä¹‰ï¼ŒæŸ¥çœ‹åœ¨ @ref{Miscellaneous Debugger Commands} ä¸­ @code{dump} ä¸‹çš„è¾“å‡ºã€‚ï¼‰

@cindex debugger commands, @code{u} (@code{until})
@cindex debugger commands, @code{until}
@cindex @code{until} debugger command
@cindex @code{u} debugger command (alias for @code{until})
@item @code{until} [[@var{filename}@code{:}]@var{n} | @var{function}]
@itemx @code{u} [[@var{filename}@code{:}]@var{n} | @var{function}]
å¦‚æœæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œæ‰§è¡Œåˆ°å½“å‰å¸§å½“å‰è¡Œçš„ä¸‹ä¸€è¡Œã€‚å¦‚æœæœ‰å‚æ•°ï¼Œåˆ™æŒç»­æ‰§è¡Œåˆ°æŒ‡å®šçš„ä½ç½®ï¼Œæˆ–è€…ç›´åˆ°å½“å‰å¸§è¿”å›ã€‚
@end table

@node Viewing And Changing Data
@subsection æŸ¥çœ‹ä¸æ›´æ”¹æ•°æ®

@command{gawk} ä¸­ç”¨äºæŸ¥çœ‹åŠæ›´æ”¹å˜é‡çš„å‘½ä»¤æœ‰ï¼š

@table @asis
@cindex debugger commands, @code{display}
@cindex @code{display} debugger command
@item @code{display} [@var{var} | @code{$}@var{n}]
å°†å˜é‡ @var{var} æˆ–è€…åŸŸ @code{$@var{n}} æ·»åŠ åˆ°æ˜¾ç¤ºåˆ—è¡¨ä¸­ã€‚å˜é‡çš„å€¼æˆ–è€…åŸŸçš„å€¼åœ¨ç¨‹åºæ¯æ¬¡åœæ­¢éƒ½ä¼šè¢«æ˜¾ç¤ºã€‚æ¯ä¸ªåŠ å…¥åˆ°åˆ—è¡¨ä¸­çš„åˆ—è¡¨éƒ½é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„æ•°å­—æ¥åŒºåˆ«ï¼š

@example
gawk> @kbd{display x}
@print{} 10: x = 1
@end example

@noindent
è¿™æ˜¾ç¤ºäº†è¢«èµ‹å€¼çš„é¡¹ï¼Œå˜é‡åä»¥åŠå…¶åŠå½“å‰çš„å€¼ã€‚å¦‚æœæ˜¾ç¤ºå˜é‡æŒ‡å‘äº†å‡½æ•°çš„å‚æ•°ï¼Œå®ƒä¼šåœ¨æ‰§è¡Œåˆ°æ²¡æœ‰è¿™ä¸ªå˜é‡åçš„ä¸Šä¸‹æ–‡æ—¶é»˜é»˜åœ°å°†å®ƒä»æ˜¾ç¤ºåˆ—è¡¨ä¸­åˆ é™¤ã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œ@code{display} ä¼šæ˜¾ç¤ºåˆ—è¡¨ä¸­çš„é¡¹çš„å½“å‰å€¼ã€‚

@cindex debugger commands, @code{eval}
@cindex @code{eval} debugger command
@cindex evaluate expressions, in debugger
@item @code{eval "@var{awk statements}"}
å¯¹ @var{awk statements} åœ¨æ‰§è¡Œç¨‹åºä¸­çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œæ±‚å€¼ã€‚ä½ å¯ä»¥åšä»»ä½•çš„ @command{awk} ç¨‹åºå¯ä»¥åšçš„äº‹æƒ…ï¼šèµ‹å€¼ç»˜ç”»å˜é‡ï¼Œè°ƒç”¨å‡½æ•°ç­‰ç­‰ã€‚

@item @code{eval} @var{param}, @dots{}
@itemx @var{awk statements}
@itemx @code{end}
@code{eval} è¿™ä¸ªå½¢å¼çš„æ±‚å€¼ç±»ä¼¼ï¼Œä½†æ˜¯å¯ä»¥è®©ä½ å®šä¹‰å­˜åœ¨ @var{awk statements} ä¸Šä¸‹æ–‡ä¸­â€œæœ¬åœ°å˜é‡â€ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç”±ç¨‹åºå®šä¹‰çš„å˜é‡æˆ–è€…å‡½æ•°å‚æ•°ã€‚

@cindex debugger commands, @code{p} (@code{print})
@cindex debugger commands, @code{print}
@cindex @code{print} debugger command
@cindex @code{p} debugger command (alias for @code{print})
@cindex print variables, in debugger
@item @code{print} @var{var1}[@code{,} @var{var2} @dots{}]
@itemx @code{p} @var{var1}[@code{,} @var{var2} @dots{}]
æ‰“å° @command{gawk} å˜é‡æˆ–è€…åŸŸçš„å€¼ã€‚åŸŸå¿…é¡»æ˜¯é€šè¿‡å¸¸é‡æ¥å‚è€ƒï¼š

@example
gawk> @kbd{print $3}
@end example

@noindent
è¿™æ‰“å°è¾“å…¥è®°å½•ä¸­çš„ç¬¬ä¸‰ä¸ªåŸŸï¼ˆå¦‚æœæŒ‡å®šçš„åŸŸä¸å­˜åœ¨ï¼Œå®ƒä¼šæ‰“å° @samp{Null field}ï¼‰ã€‚å˜é‡å¯ä»¥æ˜¯æ•°ç»„å…ƒç´ ï¼Œä¸‹æ ‡æ˜¯å¸¸é‡å­—ä¸²ã€‚ä¸ºäº†æ‰“å°æ•°ç»„å†…å®¹ï¼Œåœ¨åå­—çš„å‰é¢åŠ ä¸€ä¸ª @samp{@@} ç¬¦å·ï¼š

@example
gawk> @kbd{print @@a}
@end example

@noindent
è¿™ä¼šæ‰“å°ç´¢å¼•ä»¥åŠæ‰€æœ‰åœ¨æ•°ç»„ @code{a} ä¸­ç›¸åº”å…ƒç´ çš„å€¼ã€‚

@cindex debugger commands, @code{printf}
@cindex @code{printf} debugger command
@item @code{printf} @var{format} [@code{,} @var{arg} @dots{}]
æ‰“å°æ ¼å¼å¼çš„æ–‡æœ¬ã€‚æ ¼å¼ @var{format} åŒ…å«è½¬ä¹‰åºåˆ—ï¼Œå¦‚ @samp{\n}ï¼ˆæŸ¥çœ‹ @pxref{Escape Sequences}ï¼‰ã€‚å¦‚æœä¸æŒ‡å®šï¼Œä¸ä¼šæ‰“å°æ¢è¡Œç¬¦ã€‚

@cindex debugger commands, @code{set}
@cindex @code{set} debugger command
@cindex assign values to variables, in debugger
@item @code{set} @var{var}@code{=}@var{value}
å°†ä¸€ä¸ªå¸¸é‡ï¼ˆæ•°å€¼æˆ–è€…å­—ä¸²ï¼‰å€¼èµ‹å€¼ç»˜ç”»ä¸€ä¸ª @command{awk} å˜é‡æˆ–è€…åŸŸã€‚å­—ä¸²å€¼å¿…é¡»ç”¨åŒå¼•å·åŒ…èµ·æ¥ï¼ˆ@code{"}@dots{}@code{"}ï¼‰ã€‚

ä½ ä¹Ÿå¯ä»¥è®¾ç½® @command{awk} çš„ç‰¹æ®Šå˜é‡ï¼Œåƒ @code{FS}ï¼Œ@code{NF}ï¼Œ@code{NR} ç­‰ç­‰ã€‚

@cindex debugger commands, @code{w} (@code{watch})
@cindex debugger commands, @code{watch}
@cindex @code{watch} debugger command
@cindex @code{w} debugger command (alias for @code{watch})
@cindex set watchpoint
@item @code{watch} @var{var} | @code{$}@var{n} [@code{"@var{expression}"}]
@itemx @code{w} @var{var} | @code{$}@var{n} [@code{"@var{expression}"}]
å°†å˜é‡ @var{var} æˆ–è€…åŸŸ @code{$@var{n}} åŠ åˆ°æŸ¥çœ‹åˆ—è¡¨ä¸­ã€‚è°ƒè¯•å™¨ä¼šåœ¨å˜é‡æˆ–è€…åŸŸçš„å€¼è¢«æ”¹å˜æ—¶åœä¸‹æ¥ã€‚æ¯ä¸ªä¸€ä¸ªæŸ¥çœ‹åˆ—è¡¨é¡¹éƒ½èµ‹äºˆäº†ä¸€ä¸ªæ•°å€¼ï¼Œè¿™æ ·å¯ä»¥ç”¨ä¸­ @code{unwatch} å‘½ä»¤ä¸­æ¥å®ƒä»æŸ¥çœ‹åˆ—è¡¨ä¸­åˆ é™¤ã€‚

ä½ å¯ä»¥ç»˜ç”»æŸ¥çœ‹ç‚¹é™„åŠ ä¸€ä¸ªæ¡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ª @command{awk} è¡¨è¾¾å¼ï¼ˆåŒ…åœ¨åŒå¼•å·ä¸­ï¼‰ï¼Œè¿™æ ·å½“æŸ¥çœ‹ç‚¹è¢«å‘½ä¸­æ—¶ï¼Œè°ƒè¯•å™¨ä¼šå¯¹å…¶è¿›è¡Œæ±‚å€¼ã€‚å¦‚æœæ¡ä»¶ä¸º trueï¼Œåˆ™è°ƒè¯•å™¨ä¼šåœæ­¢æ‰§è¡Œï¼Œç„¶åæç¤ºå‘½ä»¤è¾“å…¥ã€‚å¦åˆ™ï¼Œ@command{gawk} ä¼šç»§ç»­æ‰§è¡Œå‘½ä»¤ã€‚

@cindex debugger commands, @code{undisplay}
@cindex @code{undisplay} debugger command
@cindex stop automatic display, in debugger
@item @code{undisplay} [@var{n}]
åˆ é™¤ç¼–å·ä¸º @var{n} çš„è‡ªåŠ¨æ˜¾ç¤ºåˆ—è¡¨é¡¹ï¼ˆå¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™åˆ é™¤æ‰€æœ‰çš„é¡¹ï¼‰ã€‚

@cindex debugger commands, @code{unwatch}
@cindex @code{unwatch} debugger command
@cindex delete watchpoint
@item @code{unwatch} [@var{n}]
åˆ é™¤ç¼–å·ä¸º @var{n} çš„æŸ¥çœ‹åˆ—è¡¨ä¸­çš„é¡¹ï¼ˆå¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™åˆ é™¤æ‰€æœ‰çš„é¡¹ï¼‰ã€‚

@end table

@node Execution Stack
@subsection ç¨‹åºæ ˆ

æ— è®ºä½•æ—¶ä½ è¿è¡Œä¸€ä¸ªåŒ…å«ä»»æ„å‡½æ•°è°ƒç”¨çš„ç¨‹åºï¼Œ@command{gawk} éƒ½ä¼šä¿æŒä¸€ä¸ªæ‰€æœ‰å‡½æ•°è°ƒç”¨çš„æ ˆï¼Œä¸€ç›´å‘ä¸Šåˆ°æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºå¤„ã€‚ä½ å¯ä»¥æŸ¥çœ‹ä½ ä½ å¦‚ä½•åˆ°è¾¾ç›®å‰æ‰€åœ¨åˆ°ä½ç½®ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§æ ˆçš„è·¯å¾„æ¥ç§»åŠ¨ä»¥æ¥æŸ¥çœ‹åœ¨ä½ æ‰€åœ¨çš„è¢«è°ƒç”¨çš„å‡½æ•°ä¸­äº‹ä»¶çš„çŠ¶æ€ã€‚ä¸‹é¢çš„å‘½ä»¤æ¥å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼š

@table @asis
@cindex debugger commands, @code{bt} (@code{backtrace})
@cindex debugger commands, @code{backtrace}
@cindex debugger commands, @code{where} (@code{backtrace})
@cindex @code{backtrace} debugger command
@cindex @code{bt} debugger command (alias for @code{backtrace})
@cindex @code{where} debugger command
@cindex @code{where} debugger command (alias for @code{backtrace})
@cindex call stack, display in debugger
@cindex traceback, display in debugger
@item @code{backtrace} [@var{count}]
@itemx @code{bt} [@var{count}]
@itemx @code{where} [@var{count}]
æ‰“å°æ‰€æœ‰å‡½æ•°è°ƒç”¨ï¼ˆæ ˆå¸§ï¼‰çš„è·¯å¾„ï¼Œæˆ–è€…åœ¨ @var{count} > 0 æ—¶æœ€å†…å±‚ @var{count} ä¸ªæ ˆå¸§ã€‚å¦‚æœ @var{count} < 0ï¼Œåˆ™æ‰“å°æœ€å¤–å±‚çš„ @var{count} ä¸ªæ ˆå¸§ã€‚è·¯å¾„æ˜¾ç¤ºæ¯ä¸€ä¸ªå‡½æ•°çš„åå­—ä»¥åŠå‚æ•°ï¼Œè¿˜æœ‰@value{FN}ä¸è¡Œå·ã€‚@code{backtrace} åˆ«å @code{where} ç”¨äºå‘é•¿æœŸä½¿ç”¨ GDB çš„ç”¨æˆ·æä¾›æ ˆè·¯å¾„ï¼Œä»–ä»¬å¯èƒ½ä¼šä½¿ç”¨è¿™ä¸ªå‘½ä»¤ã€‚

@cindex debugger commands, @code{down}
@cindex @code{down} debugger command
@item @code{down} [@var{count}]
å‘ä¸‹æœ€å†…å±‚çš„å¸§ç§»åŠ¨ @var{count}ï¼ˆé»˜è®¤ä¸º 1ï¼‰ä¸ªå¸§ã€‚ç„¶åé€‰æ‹©å¹¶æ‰“å°è¿™ä¸ªå¸§ã€‚

@cindex debugger commands, @code{f} (@code{frame})
@cindex debugger commands, @code{frame}
@cindex @code{frame} debugger command
@cindex @code{f} debugger command (alias for @code{frame})
@item @code{frame} [@var{n}]
@itemx @code{f} [@var{n}]
é€‰æ‹©å¹¶æ‰“å°æ ˆå¸§ @var{n}ã€‚å¸§ 0 æ˜¯å½“å‰æ­£åœ¨è¢«æ‰§è¡Œçš„ï¼Œæˆ–è€…@dfn{æœ€å†…å±‚}å¸§ï¼ˆå‡½æ•°è°ƒç”¨ï¼‰ï¼Œå¸§ 1 æ˜¯è°ƒç”¨æœ€å†…å±‚çš„å¸§ã€‚æœ€é«˜å±‚çš„å¸§æ˜¯ä¸»ç¨‹åºã€‚è¢«æ‰“å°çš„ä¿¡æ¯åŒ…æ‹¬å¸§å·ï¼Œå‡½æ•°ä»¥åŠå‚æ•°åï¼Œæºæ–‡ä»¶ä¸è¡Œå·ã€‚

@cindex debugger commands, @code{up}
@cindex @code{up} debugger command
@item @code{up} [@var{count}]
å‘ä¸Šæœ€å¤–å±‚ç§»åŠ¨ @var{count}ï¼ˆé»˜è®¤ä¸º 1ï¼‰å¸§ã€‚ç„¶åé€‰æ‹©å¹¶æ‰“å°ç›¸åº”çš„å¸§ã€‚
@end table

@node Debugger Info
@subsection è·å–ç¨‹åºä¸è°ƒè¯•å™¨çŠ¶æ€ä¿¡æ¯

é™¤äº†æŸ¥çœ‹å˜é‡çš„å€¼å¤–ï¼Œä¹Ÿå¸¸å¸¸éœ€è¦æ¥è·å–å…¶ä»–å…³äºç¨‹åºçŠ¶æ€çš„ä¿¡æ¯ï¼Œä»¥åŠè°ƒè¯•ç¯å¢ƒæœ¬èº«çš„ä¿¡æ¯ã€‚@command{gawk} è°ƒè¯•å™¨æœ‰ä¸€ä¸ªå‘½ä»¤æ¥æä¾›è¿™æ ·çš„ä¿¡æ¯ï¼Œéå¸¸æ°å½“åœ°å«åš @code{info}ã€‚@code{info} ä¸å¤šä¸ªå‚æ•°ä¸­çš„ä¸€ä¸ªä½¿ç”¨ï¼Œå¯ä»¥å‘Šè¯‰ä½ æƒ³è¦çš„å‡†å¤‡çš„ä¿¡æ¯ï¼š

@table @asis
@cindex debugger commands, @code{i} (@code{info})
@cindex debugger commands, @code{info}
@cindex @code{info} debugger command
@cindex @code{i} debugger command (alias for @code{info})
@item @code{info} @var{what}
@itemx @code{i} @var{what}
@var{what} åº”è¯¥æ˜¯ä¸‹åœ¨å…¶ä¸­ä¹‹ä¸€çš„å€¼ï¼š

@c nested table
@table @code
@item args
@cindex show function arguments, in debugger
åˆ—å‡ºæ‰€é€‰æ‹©çš„å¸§çš„å‚æ•°ã€‚

@item break
@cindex show breakpoints
åˆ—å‡ºå½“å‰çš„æ‰€æœ‰æ–­ç‚¹ã€‚

@item display
@cindex automatic displays, in debugger
åˆ—å‡ºè‡ªåŠ¨æ˜¾ç¤ºçš„æ‰€æœ‰é¡¹ã€‚

@item frame
@cindex describe call stack frame, in debugger
è¢«é€‰æ‹©çš„å¸§çš„æè¿°ã€‚

@item functions
@cindex list function definitions, in debugger
åˆ—å‡ºæ‰€æœ‰çš„å‡½æ•°å®šä¹‰ï¼ŒåŒ…æ‹¬æº@value{FN}ä»¥åŠè¡Œå·ã€‚

@item locals
@cindex show local variables, in debugger
åˆ—å‡ºè¢«é€‰æ‹©å¸§çš„æœ¬åœ°å˜é‡åˆ—è¡¨ã€‚

@item source
@cindex show name of current source file, in debugger
æ‰“å°å½“å‰æºæ–‡ä»¶çš„åå­—ã€‚æ¯æ¬¡ç¨‹åºåœæ­¢æ—¶ï¼Œå½“å‰çš„æºæ–‡ä»¶æ˜¯åŒ…å«å½“å‰æŒ‡ä»¤çš„æ–‡ä»¶ã€‚å½“è°ƒç”¨ç¬¬ä¸€æ¬¡å¼€å§‹æ—¶ï¼Œå½“å‰çš„æºæ–‡ä»¶æ˜¯é€šè¿‡ @option{-f} æŒ‡å®šçš„æ–‡ä»¶ã€‚@samp{list @var{filename}:@var{lineno}} å‘½ä»¤å¯ä»¥åœ¨ä»»ä½•æ—¶å€™ç”¨æ¥æ”¹å˜å½“å‰æºæ–‡ä»¶ã€‚

@item sources
@cindex show all source files, in debugger
åˆ—å‡ºæ‰€æœ‰çš„ç¨‹åºæºã€‚

@item variables
@cindex list all global variables, in debugger
åˆ—å‡ºæ‰€æœ‰çš„å…¨å±€å˜é‡ã€‚

@item watch
@cindex show watchpoints
åˆ—å‡ºæ‰€æœ‰çš„åœ¨æŸ¥çœ‹åˆ—è¡¨ä¸­çš„é¡¹ã€‚
@end table
@end table

å…¶ä»–çš„å‘½ä»¤å¯ä»¥è®©ä½ æ§åˆ¶è°ƒè¯•å™¨ï¼Œä½¿å…¶æœ‰ä¿å­˜è°ƒè¯•å™¨çš„çŠ¶æ€ä»¥åŠä»æ–‡ä»¶ä¸­è¿è¡Œè°ƒè¯•å™¨çš„èƒ½åŠ›ï¼Œ

@table @asis
@cindex debugger commands, @code{o} (@code{option})
@cindex debugger commands, @code{option}
@cindex @code{option} debugger command
@cindex @code{o} debugger command (alias for @code{option})
@cindex display debugger options
@cindex debugger options
@item @code{option} [@var{name}[@code{=}@var{value}]]
@itemx @code{o} [@var{name}[@code{=}@var{value}]]
å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„è°ƒè¯•å™¨é€‰é¡¹ä»¥åŠå®ƒä»¬çš„å½“å‰å€¼ã€‚@samp{option @var{name}} æ˜¾ç¤ºæŒ‡å®šåå­—é€‰é¡¹çš„å½“å‰å€¼ã€‚@samp{option @var{name}=@var{value}} å°†ä¸€ä¸ªæ–°å€¼èµ‹ç»™æŒ‡å®šçš„é€‰é¡¹ã€‚å¯ç”¨çš„é€‰é¡¹æœ‰ï¼š

@c nested table
@c asis for docbook
@table @asis
@item @code{history_size}
@cindex debugger history size
è®¾ç½®ä¿å­˜åœ¨å†å²æ–‡ä»¶ @file{./.gawk_history} æ–‡ä»¶ä¸­çš„æœ€å¤§è¡Œæ•°ã€‚é»˜è®¤å€¼æ˜¯ 100ã€‚

@item @code{listsize}
@cindex debugger default list amount
æŒ‡å®šåˆ—è¡¨ @code{list} æ‰“å°çš„è¡Œæ•°ã€‚é»˜è®¤æ˜¯ 15ã€‚

@item @code{outfile}
@cindex redirect @command{gawk} output, in debugger
å°† @command{gawk} çš„è¾“å‡ºå‘é€åˆ°æ–‡ä»¶ï¼Œè°ƒè¯•å™¨è¾“å‡ºä¾ç„¶å‘é€åˆ°æ ‡å‡†è¾“å‡ºä¸Šã€‚ç©ºä¸²ï¼ˆ@code{""}ï¼‰ä¼šé‡æ–°å°†è®¾ç½®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºä¸Šã€‚

@item @code{prompt}
@cindex debugger prompt
æ”¹å˜è°ƒè¯•å™¨çš„æç¤ºã€‚é»˜è®¤æ˜¯ @samp{@w{gawk> }}ã€‚

@item @code{save_history} [@code{on} | @code{off}]
@cindex debugger history file
ä¿å­˜å‘½ä»¤å†å²åˆ°æ–‡ä»¶ @file{./.gawk_history}ã€‚é»˜è®¤æ˜¯ @code{on}ã€‚

@item @code{save_options} [@code{on} | @code{off}]
@cindex save debugger options
åœ¨é€€å‡ºæ—¶ï¼Œä¿å­˜å½“å‰çš„é€‰é¡¹åˆ°æ–‡ä»¶ @file{./.gawkrc}ã€‚é»˜è®¤æ˜¯ @code{on}ã€‚é€‰é¡¹ä¼šåœ¨å¯åŠ¨ä¸‹ä¸€ä¸ªä¼šè¯è¿‡ç¨‹æ—¶è¯»å–å›æ¥ã€‚

@item @code{trace} [@code{on} | @code{off}]
@cindex instruction tracing, in debugger
æ‰“å¼€æˆ–è€…å…³é—­å‘½ä»¤è·Ÿè¸ªã€‚é»˜è®¤æ˜¯ @code{off}ã€‚
@end table

@item @code{save} @var{filename}
å°†æ¥è‡ªäºå½“å‰ä¼šè¯çš„å‘½ä»¤ä¿å­˜åˆ°æ‰€ç»™çš„@value{FN}ä¸­ï¼Œæ‰€ä»¥ä»–ä»¬å¯ä»¥ä½¿ç”¨ @command{source} å‘½ä»¤è¿›è¡Œé‡æ”¾ã€‚

@item @code{source} @var{filename}
@cindex debugger, read commands from a file
ä»æ–‡ä»¶ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œä»»ä½•å‘½ä»¤çš„é”™è¯¯ä¸ä¼šå¯¼è‡´åç»­å‘½ä»¤çš„ç»“æŸã€‚æ³¨é‡Šï¼ˆä»¥ @samp{#} å¼€å¤´çš„è¡Œï¼‰å¯ä»¥å­˜åœ¨å‘½ä»¤æ–‡ä»¶ä¸­ã€‚ç©ºè¡Œä¼šè¢«å¿½ç•¥ï¼Œå®ƒä»¬@emph{ä¸ä¼š}é‡å¤æœ€åçš„å‘½ä»¤ã€‚åœ¨æ–‡ä»¶ä¸­ï¼Œä½ ä¸å¯ä»¥æœ‰å¤šäºä¸€ä¸ªçš„ @code{run} å‘½ä»¤æ¥é‡æ–°å¯åŠ¨ç¨‹åºã€‚åŒæ—¶ï¼Œå‘½ä»¤åˆ—è¡¨å¯ä»¥åŒ…å«å…¶ä»–çš„æº @code{source} çš„å‘½ä»¤ï¼Œä½†æ˜¯ï¼Œ@command{gawk} è°ƒè¯•å™¨ä¸ä¼šå¯¹åŒä¸€ä¸ªæ–‡ä»¶æ‰§è¡Œå¤šæ¬¡ sourceï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚

ä¸ºäº†ä½¿ç”¨æˆ–è€…ä»£æ›¿ @code{source} å‘½ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ @option{-D @var{file}} æˆ–è€… @option{--debug=@var{file}} å‘½ä»¤è¡Œå‚æ•°ä»ä¸€ä¸ªæ–‡ä»¶ä¸­æ¥éäº¤äº’å¼åœ°æ‰§è¡Œå‘½ä»¤ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚
@end table

@node Miscellaneous Debugger Commands
@subsection å…¶ä»–å‘½ä»¤

æœ‰ä¸€äº›å‘½ä»¤ä¸å¤ªå¥½å½’å…¥åˆ°ä¹‹å‰çš„é‚£å‡ ç§åˆ†ç±»ï¼Œä»–ä»¬æ˜¯ï¼š

@table @asis
@cindex debugger commands, @code{dump}
@cindex @code{dump} debugger command
@item @code{dump} [@var{filename}]
Dump ç¨‹åºçš„å­—èŠ‚ç åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼Œæˆ–è€…åå­—ä¸º @var{filename} çš„æ–‡ä»¶ä¸­ã€‚è¿™ä¼šæ‰“å°æŒ‡ä»¤çš„å†…éƒ¨è¡¨ç¤ºï¼Œ@command{gawk} é€šè¿‡æ‰§è¡Œè¿™äº›æŒ‡ä»¤æ¥å®ç°ç¨‹åºä¸­çš„å‘½ä»¤ã€‚è¿™ä¼šéå¸¸æœ‰å¯å‘æ€§ï¼Œå¦‚ä¸‹é¢çš„ Davide Brini çš„å«äººæ— æ³•æ‰æ‘¸çš„ä»£ç çš„éƒ¨åˆ† dump å†…å®¹ï¼ˆæŸ¥çœ‹ @pxref{Signature Program}ï¼‰ï¼š

@c FIXME: This will need updating if num-handler branch is ever merged in.
@smallexample
gawk> @kbd{dump}
@print{}        # BEGIN
@print{}
@print{} [  1:0xfcd340] Op_rule           : [in_rule = BEGIN] [source_file = brini.awk]
@print{} [  1:0xfcc240] Op_push_i         : "~" [MALLOC|STRING|STRCUR]
@print{} [  1:0xfcc2a0] Op_push_i         : "~" [MALLOC|STRING|STRCUR]
@print{} [  1:0xfcc280] Op_match          :
@print{} [  1:0xfcc1e0] Op_store_var      : O
@print{} [  1:0xfcc2e0] Op_push_i         : "==" [MALLOC|STRING|STRCUR]
@print{} [  1:0xfcc340] Op_push_i         : "==" [MALLOC|STRING|STRCUR]
@print{} [  1:0xfcc320] Op_equal          :
@print{} [  1:0xfcc200] Op_store_var      : o
@print{} [  1:0xfcc380] Op_push           : o
@print{} [  1:0xfcc360] Op_plus_i         : 0 [MALLOC|NUMCUR|NUMBER]
@print{} [  1:0xfcc220] Op_push_lhs       : o [do_reference = true]
@print{} [  1:0xfcc300] Op_assign_plus    :
@print{} [   :0xfcc2c0] Op_pop            :
@print{} [  1:0xfcc400] Op_push           : O
@print{} [  1:0xfcc420] Op_push_i         : "" [MALLOC|STRING|STRCUR]
@print{} [   :0xfcc4a0] Op_no_op          :
@print{} [  1:0xfcc480] Op_push           : O
@print{} [   :0xfcc4c0] Op_concat         : [expr_count = 3] [concat_flag = 0]
@print{} [  1:0xfcc3c0] Op_store_var      : x
@print{} [  1:0xfcc440] Op_push_lhs       : X [do_reference = true]
@print{} [  1:0xfcc3a0] Op_postincrement  :
@print{} [  1:0xfcc4e0] Op_push           : x
@print{} [  1:0xfcc540] Op_push           : o
@print{} [  1:0xfcc500] Op_plus           :
@print{} [  1:0xfcc580] Op_push           : o
@print{} [  1:0xfcc560] Op_plus           :
@print{} [  1:0xfcc460] Op_leq            :
@print{} [   :0xfcc5c0] Op_jmp_false      : [target_jmp = 0xfcc5e0]
@print{} [  1:0xfcc600] Op_push_i         : "%c" [MALLOC|STRING|STRCUR]
@print{} [   :0xfcc660] Op_no_op          :
@print{} [  1:0xfcc520] Op_assign_concat  : c
@print{} [   :0xfcc620] Op_jmp            : [target_jmp = 0xfcc440]
@print{}
@dots{}
@print{}
@print{} [     2:0xfcc5a0] Op_K_printf         : [expr_count = 17] [redir_type = ""]
@print{} [      :0xfcc140] Op_no_op            :
@print{} [      :0xfcc1c0] Op_atexit           :
@print{} [      :0xfcc640] Op_stop             :
@print{} [      :0xfcc180] Op_no_op            :
@print{} [      :0xfcd150] Op_after_beginfile  :
@print{} [      :0xfcc160] Op_no_op            :
@print{} [      :0xfcc1a0] Op_after_endfile    :
gawk>
@end smallexample

@cindex @code{exit} debugger command
@cindex exit the debugger
@item @code{exit}
é€€å‡ºè°ƒè¯•å™¨ã€‚æŸ¥çœ‹ä¹‹ååˆ—å‡ºçš„ @samp{quit}ã€‚

@cindex debugger commands, @code{h} (@code{help})
@cindex debugger commands, @code{help}
@cindex @code{help} debugger command
@cindex @code{h} debugger command (alias for @code{help})
@item @code{help}
@itemx @code{h}
æ‰“å°æ‰€æœ‰çš„ @command{gawk} è°ƒè¯•å™¨å‘½ä»¤åˆ—è¡¨ï¼Œä»¥åŠå®ƒå…¨çš„ç®€çŸ­ä½¿ç”¨è¯´æ˜ã€‚@samp{help @var{command}} æ‰“å°å‘½ä»¤ @var{command} çš„ä¿¡æ¯ã€‚

@cindex debugger commands, @code{l} (@code{list})
@cindex debugger commands, @code{list}
@cindex @code{list} debugger command
@cindex @code{l} debugger command (alias for @code{list})
@item @code{list} [@code{-} | @code{+} | @var{n} | @var{filename}@code{:}@var{n} | @var{n}--@var{m} | @var{function}]
@itemx @code{l} [@code{-} | @code{+} | @var{n} | @var{filename}@code{:}@var{n} | @var{n}--@var{m} | @var{function}]
æ‰“å°ä»å½“æºä»£ç æˆ–è€…åä¸º @var{filename} æ–‡ä»¶çš„æŒ‡å®šè¡Œæ•°ï¼ˆé»˜è®¤ä¸º 15ï¼‰ã€‚ä¸‹é¢æ˜¯ @code{list} çš„å¯èƒ½çš„å‚æ•°ï¼š

@c nested table
@table @asis
@item @code{-} (Minus)
æ‰“å°æœ€åæ‰“å°å‰çš„è¡Œã€‚

@item @code{+}
æ‰“å°æœ€åæ‰“å°è¡Œçš„åé¢çš„è¡Œã€‚@code{list} å¦‚æœä¸å¸¦å‚æ•°åˆ™ä¸è¿™ä¸ªæ‰§è¡Œç»“æœç›¸åŒã€‚

@item @var{n}
æ‰“å°è¡Œå· @var{n} ä¸ºä¸­å¿ƒå‘¨å›´çš„è¡Œã€‚

@item  @var{n}--@var{m}
æ‰“å°ä» @var{n} åˆ° @var{m} çš„è¡Œã€‚

@item @var{filename}@code{:}@var{n}
æ‰“å°åœ¨æºæ–‡ä»¶ @var{filename} è¡Œ @var{n} ä¸ºä¸­å¿ƒçš„è¡Œã€‚è¿™ä¸ªå‘½ä»¤ä¼šæ”¹å˜å½“å‰çš„æºæ–‡ä»¶ã€‚

@item @var{function}
æ‰“å°å‡½æ•° @var{function} å¼€å§‹è¡Œä¸ºä¸­å¿ƒçš„è¡Œã€‚è¿™ä¸ªå‘½ä»¤æœ‰å¯èƒ½æ”¹å˜å½“å‰çš„æºæ–‡ä»¶ã€‚
@end table

@cindex debugger commands, @code{q} (@code{quit})
@cindex debugger commands, @code{quit}
@cindex @code{quit} debugger command
@cindex @code{q} debugger command (alias for @code{quit})
@cindex exit the debugger
@item @code{quit}
@itemx @code{q}
é€€å‡ºè°ƒè¯•å™¨ã€‚è°ƒè¯•ç¨‹åºéå¸¸æœ‰æ„æ€ï¼Œä½†æ˜¯åœ¨ç”Ÿæ´»ä¸­æœ‰æ—¶ä½ è¿˜æœ‰å…¶ä»–çš„è´£ä»»è¦å°½ï¼Œè€Œæœ‰æ—¶æˆ‘ä»¬æ‰¾åˆ°äº† Bugï¼Œåˆ™ä¼šå†æ‰¾ä¸‹ä¸€ä¸ªã€‚å¦‚æˆ‘ä»¬æ—©å‰çœ‹åˆ°çš„ï¼Œå¦‚æœä½ æ­£åœ¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œè°ƒè¯•å™¨ä¼šåœ¨ä½ è¾“å…¥ @samp{q} æˆ–è€… @samp{quit} æ—¶ç»™ä½ è­¦å‘Šï¼Œä»¥ç¡®ä¿¡ä½ çœŸçš„æƒ³é€€å‡ºã€‚

@cindex debugger commands, @code{trace}
@cindex @code{trace} debugger command
@item @code{trace} [@code{on} | @code{off}]
æ‰“å¼€æˆ–è€…å…³é—­è¿ç»­æ‰“å°å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œä»¥åŠè¿™äº›æŒ‡ä»¤æ‰€å®ç°çš„ @command{awk} ä»£ç ã€‚é»˜è®¤æ˜¯ @code{off}ã€‚

åœ¨è¿™æ­¤æŒ‡ä»¤ä¸­çš„å¤§å¤šæ•°â€œopcodesâ€éƒ½ç›¸å½“åœ°èƒ½å¤Ÿè‡ªæˆ‘è¯´æ˜ï¼Œä½¿ç”¨ @code{stepi} ä¸ @code{nexti} çš„æ—¶å€™ï¼Œ@code{trace} æ‰“å¼€çš„æ—¶å€™ä¼šä½¿å¾—å®ƒä»¬å˜æˆç†Ÿæ‚‰çš„æœ‹å‹ã€‚ï¼ˆè¯‘æ³¨ï¼šå°±æ˜¯ä¼šåœ¨æ¥ä¸‹æ¥çš„æ˜¾ç¤ºä¸­ä¼šæ˜¾ç¤ºå¾ˆå¤šå­—èŠ‚ç ï¼Œçœ‹ä¹…äº†ï¼Œå°±æˆä¸ºç†Ÿæ‚‰çš„æœ‹å‹äº†ã€‚è¿™æ˜¯ä½œè€…çš„å¹½é»˜ã€‚ï¼‰

@end table

@node Readline Support
@section æ”¯æŒ
@cindex command completion, in debugger
@cindex history expansion, in debugger

å¦‚æœ @command{gawk} ä½¿ç”¨ @uref{http://cnswww.cns.cwru.edu/php/chet/readline/readline.html,
GNU Readline åº“} æ¥ç¼–è¯‘çš„ï¼Œåˆ™ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªåº“çš„å‘½ä»¤å®Œæˆä¸å†å²æ‰©å±•ç‰¹æ€§è¿™ä¸ªä¼˜ç‚¹ã€‚ä¸‹é¢çš„å®Œæˆç±»å‹å¯ä»¥ä½¿ç”¨ï¼š

@table @asis
@item Command completion
å‘½ä»¤åå­—ã€‚

@item Source @value{FN} completion
æº@value{FN}ã€‚ç›¸å…³çš„å‘½ä»¤æ˜¯ @code{break}ï¼Œ@code{clear}ï¼Œ@code{list}ï¼Œ@code{tbreak} ä¸ @code{until}ã€‚

@item Argument completion
å‘½ä»¤çš„éæ•°å€¼å‚æ•°ã€‚ç›¸å…³çš„å‘½ä»¤æ˜¯ @code{enable} ä¸ @code{info}ã€‚

@item Variable name completion
å…¨å±€å˜é‡å¥ä»¥åŠæ­£åœ¨æ‰§è¡Œç¨‹åºçš„å½“å‰ä¸Šä¸‹æ–‡çš„å‡½æ•°å‚æ•°ã€‚ç›¸å…³çš„å‘½ä»¤æ˜¯ @code{display}ï¼Œ@code{print}ï¼Œ@code{set} ä¸ @code{watch}ã€‚

@end table

@node Limitations
@section é™åˆ¶

æˆ‘ä»¬å¸Œæœ›ä½ å‘ç° @command{gawk} çš„è°ƒè¯•å™¨å¾ˆæœ‰ç”¨å¹¶ä¸”äº«å—ä½¿ç”¨å®ƒï¼Œä½†æ˜¯å¯¹äºä»»ä½•çš„ç¨‹åºï¼Œç‰¹åˆ«æ˜¯åœ¨å‘å¸ƒçš„æ—©æœŸï¼Œä¾ç„¶è¿˜æœ‰æœ‰ä¸€äº›é™åˆ¶çš„ã€‚è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

@itemize @value{BULLET}
@item
åœ¨è¿™ä¸ªæ—¶å€™ï¼Œè°ƒè¯•å™¨ä¸ä¼šåœ¨ä½ è¾“å…¥ä¸€äº›å®ƒä¸å–œæ¬¢çš„ä¸œè¥¿ä¹‹åï¼Œä¸ä¼šç»™ä½ é”™è¯¯ç»™å‡ºè¯¦ç»†çš„è§£é‡Šã€‚ç›¸åï¼Œå®ƒåªæ˜¯åé¦ˆè¯´ @samp{syntax error}ã€‚å½“ä½ ç¡®å®æ‰¾åˆ°äº†ä½ çš„é”™è¯¯æ‰€åœ¨ï¼Œæ‰€ä»¥ä½ ç¡®å®æ„Ÿè§‰è‡ªå·±ä¼šæ˜¯ä¸€ä¸ªçœŸæ­£çš„å¤§ç‰›ã€‚

@item
@c NOTE: no comma after the ref{} on purpose, due to following
@c parenthetical remark.
å¦‚æœä½ ä¸€ç›´ dump å‡º @ref{Miscellaneous Debugger Commands} ä¸­çš„ opcodesï¼ˆæˆ–è€…æ˜¯ä½ å·²ç»ç†Ÿæ‚‰äº† @command{gawk} çš„å†…éƒ¨ç»†èŠ‚ï¼‰ï¼Œä½ ä¼šæ„è¯†åˆ° @command{gawk} çš„å¾ˆå¤šçš„å†…éƒ¨æ•°æ®æ“ä½œï¼Œä¸å…¶ä»–çš„ç¿»è¯‘å™¨ä¸€æ ·æ˜¯åœ¨æ ˆä¸­å®Œæˆçš„ã€‚@code{Op_push}ï¼Œ@code{Op_pop} ä»¥åŠåƒâ€œbread and butterâ€å  @command{gawk} ä»£ç ä¸­çš„å¤§å¤šæ•°ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œ@command{gawk} è°ƒè¯•å™¨ä¸å…è®¸ä½ æ£€æŸ¥æ ˆçš„å†…å®¹ã€‚ä¹Ÿå°±æ˜¯ï¼Œè¡¨è¾¾å¼çš„ä¸­é—´ç»“æœæ˜¯åœ¨æ ˆä¸­è¿›è¡Œæ±‚å€¼çš„ï¼Œä½†æ˜¯å´ä¸å¯ä»¥æ‰“å°ã€‚è€Œä¸”ï¼Œåªæœ‰åœ¨ç¨‹åºçš„ç¨‹åºä¸­å®šä¹‰çš„å˜é‡æ‰å¯ä»¥æ‰“å°ã€‚å½“ç„¶ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜å°±æ˜¯åœ¨è°ƒè¯•é˜¶æ®µä½¿ç”¨æ›´åŠ æ˜¾å¼çš„å˜é‡ï¼Œç„¶åå†è½¬å›åˆ°æ›´åŠ éšè®³ï¼Œä¹Ÿè®¸æ˜¯æ›´åŠ ä¼˜åŒ–çš„ä»£ç ã€‚

@item
æ²¡æœ‰åŠæ³•æŸ¥çœ‹ç¼–è¯‘çš„æ­£åˆ™è¡¨è¾¾å¼çš„å†…éƒ¨è¿‡ç¨‹ä»¥æŸ¥çœ‹å®ƒæ˜¯å¦æ­£ç¡®ã€‚ä½œä¸º @command{awk} ç¨‹åºå‘˜ï¼Œä½ åªå¸Œæœ›ç†è§£ @code{/[^[:alnum:][:blank:]]/} çš„æ„ä¹‰å°±å¯ä»¥äº†ã€‚

@item
@command{gawk} è°ƒè¯•å™¨è®¾è®¡æ˜¯ç”¨åœ¨é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œçš„ç¨‹åºä¸Šçš„ï¼ˆä»¥åŠå…¶æ‰€æœ‰çš„å‚æ•°ï¼‰ï¼Œå¦‚ @ref{Debugger Invocation} ä¸­æ‰€æè¿°çš„ã€‚æ²¡æœ‰åŠæ³•ï¼ˆç›®å‰ï¼‰æ¥é™„åŠ æˆ–è€…â€œæ’å…¥â€åˆ°ä¸€ä¸ªè¿è¡Œä¸­çš„ç¨‹åºã€‚è¿™å¯¹ä¸»è¦æ˜¯ç”¨äºçŸ­ç¨‹åºä¸”å¿«é€Ÿæ‰§è¡Œçš„è¯­è¨€ä¸Šçœ‹èµ·æ¥æ˜¯åˆç†çš„ã€‚

@item
@command{gawk} è°ƒè¯•å™¨åªæ¥æ”¶é€šè¿‡ @option{-f} é€‰é¡¹æä¾›çš„æºä»£ç ã€‚
@end itemize

@ignore
Look forward to a future release when these and other missing features may
be added, and of course feel free to try to add them yourself!
@end ignore

@node Debugging Summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
ç¨‹åºå¾ˆå°‘ç¬¬ä¸€æ¬¡å°±å¯ä»¥æ­£ç¡®å·¥ä½œã€‚æŸ¥çœ‹ Bug çš„è¿‡ç¨‹ç§°ä¸ºè°ƒè¯•ï¼Œå¸®ä½ æ‰¾åˆ° Bug çš„ç¨‹åºç§°ä¸ºè°ƒè¯•å™¨ã€‚ @command{gawk} æœ‰å†…ç½®çš„è°ƒè¯•å™¨ï¼Œå¹¶ä¸”ä¸ GNU è°ƒè¯•å™¨ GDB å·¥ä½œèµ·æ¥å¾ˆç±»ä¼¼ã€‚

@item
è°ƒè¯•å™¨å¯ä»¥è®©ä½ ä¸€æ¬¡ä¸€ä¸ªè¯­å¥æ‰§è¡Œç¨‹åºï¼Œä»¥æ£€æŸ¥ä¸æ”¹å˜å˜é‡ä¸æ•°ç»„çš„å€¼ï¼Œä»¥åŠè®¸å¤šå…¶ä»–çš„äº‹æƒ…æ¥è®©ä½ ç†è§£ä½ çš„ç¨‹åºå®é™…æ‰€åšçš„ï¼ˆç›¸å¯¹äºå®ƒåº”è¯¥æ‰€åšçš„ï¼‰ã€‚

@item
ä¸å…¶ä»–çš„è°ƒè¯•å™¨ç±»ä¼¼ï¼Œ@command{gawk} è°ƒè¯•å™¨ä¹Ÿæ˜¯æŒ‰ç…§æ ˆå¸§çš„æ–¹å¼å·¥ä½œçš„ï¼Œå¹¶ä¸”å¯ä»¥ä½ è®©è®¾ç½®æ–­ç‚¹ï¼ˆåœ¨ä»£ç ä¸­åœæ­¢çš„ç‚¹ï¼‰ä¸æŸ¥çœ‹ç‚¹ï¼ˆå½“å€¼è¢«æ”¹å˜æ—¶åœæ­¢ï¼‰ã€‚

@item
è°ƒè¯•å™¨å‘½ä»¤ç›¸å½“å®Œå¤‡ï¼Œæä¾›äº†æ–­ç‚¹ï¼Œæ‰§è¡Œï¼ŒæŸ¥çœ‹ï¼Œæ”¹å˜æ•°æ®ç­‰æ§åˆ¶å‘½ä»¤ï¼Œè¿˜æœ‰å¤„ç†æ ˆï¼Œè·å–ä¿¡æ¯ä»¥åŠå…¶ä»–ä»»åŠ¡çš„å‘½ä»¤ã€‚

@item
å¦‚æœ GNU Readline åº“åœ¨ @command{gawk} ç¼–è¯‘æ—¶æ˜¯å¯ç”¨çš„ï¼Œå®ƒå¯ä»¥è¢«è°ƒè¯•å™¨ç”¨äºå‘½ä»¤è¡Œå†å²ä¸ç¼–è¾‘ã€‚

@end itemize

@node Arbitrary Precision Arithmetic
@chapter ç®—æœ¯è¿ç®—ä¸ @command{gawk} ä¸­çš„ä»»æ„ç²¾åº¦ç®—æœ¯è¿ç®—
@cindex arbitrary precision
@cindex multiple precision
@cindex infinite precision
@cindex floating-point, numbers@comma{} arbitrary precision

æœ¬@value{CHAPTER}ä»‹ç»ä¸€äº›ä¸è®¡ç®—å¦‚ä½•è¿›è¡Œç®—æœ¯è¿è¡Œç›¸å…³çš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶å®šä¹‰ä¸€äº›é‡è¦çš„æœ¯è¯­ã€‚ç„¶åç»§ç»­æè¿°æµ®ç‚¹æ•°ç®—æœ¯è¿ç®—ï¼Œ@command{awk} æ­£æ˜¯ç”¨å…¶æ¥åšå…¶æ‰€æœ‰çš„è®¡ç®—ã€‚åé¢è¿˜ä¼šæœ‰ä»»æ„ç²¾åº¦æµ®ç‚¹æ•°ç®—æœ¯è¿è¡Œçš„è®¨è®ºï¼Œè¿™æ˜¯ä¸ªåªåœ¨ @command{gawk} ä¸­å¯ç”¨çš„ç‰¹æ€§ã€‚åç»­ä¼šå†è®¨è®ºä»»æ„ç²¾åº¦çš„æ•´æ•°ï¼ŒåŠå¯¹è®¨è®ºçš„æŸäº›ç‚¹åšä¸€äº›å°ç»“ï¼Œåœ¨è¿™äº›ç‚¹ä¸Š @command{gawk} ä¸ POSIX æ ‡å‡†ä¸å¤ªä¸€è‡´ã€‚

@quotation æç¤º
@command{gawk} çš„å¾ˆå¤šçš„ç”¨æˆ·éƒ½å¯ä»¥å®Œå…¨åœ°è·³è¿‡æœ¬ç« ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³ç”¨ @command{gawk} åšä¸€äº›ç§‘å­¦è®¡ç®—ï¼Œè¿™ç« å°±éå¸¸åˆé€‚ã€‚
@end quotation

@menu
* Computer Arithmetic::           A quick intro to computer math.
* Math Definitions::              Defining terms used.
* MPFR features::                 The MPFR features in @command{gawk}.
* FP Math Caution::               Things to know.
* Arbitrary Precision Integers::  Arbitrary Precision Integer Arithmetic with
                                  @command{gawk}.
* POSIX Floating Point Problems:: Standards Versus Existing Practice.
* Floating point summary::        Summary of floating point discussion.
@end menu

@node Computer Arithmetic
@section è®¡ç®—æœºç®—æœ¯è®¡ç®—è¯´æ˜

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¤„ç†è¿‡æ•°å­—æˆ–è€…å­—ä¸²ã€‚ä½†æ˜¯ï¼Œæœ€ç»ˆè®¡ç®—æœºéƒ½æ˜¯ä»¥@dfn{äºŒè¿›åˆ¶æ•°å­—}ï¼Œæˆ–è€…è¯´@dfn{äºŒè¿›åˆ¶ä½}è¡¨ç¤ºä¸€åˆ‡ã€‚åè¿›åˆ¶æ•°å¯ä»¥ç”¨ 10 ä¸ªå€¼æ¥è¡¨ç¤ºï¼š 0 åˆ° 9ã€‚äºŒè¿›åˆ¶æ•°å¯ä»¥ç”¨ä¸¤ä¸ªå€¼æ¥è¡¨ç¤ºï¼Œ0 ä¸ 1ã€‚é€šè¿‡ä½¿ç”¨äºŒè¿›åˆ¶æ•°ï¼Œè®¡ç®—ï¼ˆä»¥åŠè®¡ç®—è½¯ä»¶ï¼‰å¯ä»¥è¡¨ç¤ºå¹¶æ“ä½œæ•°å€¼ä¸å­—ç¬¦æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ›´å¤šçš„ä½å¯ä»¥ç”¨æ¥è¡¨ç¤ºç‰¹å®šçš„äº‹ï¼Œä»¥åŠå¯ä»¥è¡¨ç¤ºçš„æ›´å¤§çš„èŒƒå›´çš„å¯èƒ½æ•°å€¼ã€‚

ç°ä»£è®¡ç®—æœºæ”¯æŒè‡³å°‘ä¸¤ç§ï¼Œé€šå¸¸æ˜¯æ›´å¤šçš„æ–¹å¼æ¥è¿›è¡Œç®—æœ¯è®¡ç®—ã€‚æ¯ç§ç®—æœ¯è®¡ç®—éƒ½å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¡¨ç¤ºï¼ˆä½çš„ç»„ç»‡æ–¹å¼ï¼‰æ¥ä»£è¡¨æ•°å€¼ã€‚æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç®—æœ¯ç±»å‹å¦‚ä¸‹ï¼š

@table @asis
@item åè¿›åˆ¶ç®—æœ¯è¿ç®—
æ­¤ç±»å‹çš„ç®—æœ¯è¿è¡Œä½ å·²ç»åœ¨åˆçº§å­¦æ ¡ä¸­å°±å·²ç»å­¦è¿‡äº†ï¼Œå®ƒä»¬ä½¿ç”¨ç¬”ä¸çº¸ï¼ˆæˆ–è€…æ˜¯è®¡ç®—å™¨ï¼‰æ¥è¿ç®—ã€‚ç†è®ºä¸Šï¼Œåœ¨åè¿›åˆ¶å°æ•°ç‚¹çš„ä¸€è¾¹æˆ–è€…ä¸¤è¾¹éƒ½å¯ä»¥ç”¨ä»»æ„æ•°å€¼ä½ï¼Œè€Œç»“æœæ€»æ˜¯ç²¾ç¡®çš„ã€‚

ä¸€äº›ç°ä»£çš„ç³»ç»Ÿå¯ä»¥ç”¨ç¡¬ä»¶æ‰§è¡Œåè¿›åˆ¶ç®—æœ¯è¿ç®—ï¼Œä½†æ˜¯é€šå¸¸éœ€è¦ç‰¹æ®Šçš„è½¯ä»¶åº“æ¥è®¿é—®è¿™äº›æŒ‡ä»¤ã€‚ä¹Ÿæœ‰åº“ç”¨å®Œå…¨ç”¨è½¯ä»¶æ¥æ‰§è¡Œåè¿›åˆ¶ç®—æœ¯è¿ç®—ã€‚

å°½ç®¡æœ‰ä¸€äº›ç”¨æˆ·å¸Œæœ› @command{gawk} å¯ä»¥æ‰§è¡Œåè¿›åˆ¶è¿ç®—ï¼Œ 
@footnote{æˆ‘ä»¬ä¸çŸ¥é“ä»–ä»¬ä¸ºä»€ä¹ˆå¸Œæœ›æœ‰è¿™ä¸ªèƒ½åŠ›ï¼Œä»æ˜¯ç¡®å®æ˜¯æœ‰è¿™ç§æœŸæœ›ã€‚}
ä½†æ˜¯ @command{gawk} ä¸æ”¯æŒè¿™æ ·çš„èƒ½åŠ›ã€‚

@item æ•´æ•°ç®—æ³•è¿ç®—
åœ¨å­¦æ ¡é‡Œï¼Œæ•´æ•°å€¼è¢«æŒ‡ä¸ºâ€œå…¨éƒ¨â€æ˜¯æ•°å€¼â€”â€”ä¹Ÿå°±æ˜¯ï¼Œæ•°å€¼ä¸­æ²¡æœ‰å°æ•°éƒ¨åˆ†ï¼Œå¦‚ 1ï¼Œ42 æˆ–è€… @minus{}17ã€‚æ•´æ•°çš„å¥½å¤„æ˜¯å®ƒä»¬å®Œå…¨ä»£è¡¨å€¼ã€‚ç¼ºç‚¹å°±æ˜¯å®ƒä»¬çš„èŒƒå›´æ˜¯æœ‰é™çš„ã€‚

@cindex unsigned integers
@cindex integers, unsigned
åœ¨è®¡ç®—æœºä¸­ï¼Œæ•´æ•°å€¼ä¼šåˆ†æˆä¸¤ç±»ï¼š@dfn{æœ‰ç¬¦å·}ä¸@dfn{æ— ç¬¦å·}çš„ã€‚æœ‰ç¬¦å·çš„å€¼å¯ä»¥ä¸ºæ­£ä¹Ÿå¯ä»¥ä¸ºè´Ÿï¼Œè€Œæ— ç¬¦å·æ•°å€¼æ€»æ˜¯å¤§äºç­‰äº 0ã€‚

åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œæ•´æ•°ç®—æœ¯è¿ç®—æ˜¯ç²¾ç¡®çš„ï¼Œä½†æ˜¯å€¼çš„å¯èƒ½èŒƒå›´æ˜¯æœ‰é™çš„ã€‚æ•´æ•°ç®—æœ¯è¿ç®—ä¸€èˆ¬è¦æ¯”æµ®ç‚¹æ•°ç®—æœ¯è¿ç®—è¦å¿«ã€‚

@item æµ®ç‚¹æ•°ç®—æœ¯è¿ç®—
æµ®ç‚¹æ•°å€¼çš„è¡¨ç¤ºï¼Œæˆ‘ä»¬åœ¨å­¦æ ¡ä¸­å«åšâ€œå®â€æ•°ï¼ˆå³è¿™äº›å€¼æœ‰å°æ•°éƒ¨åˆ†ï¼Œå¦‚ 3.1415927 ï¼‰ã€‚æµ®ç‚¹æ•°å€¼çš„ä¼˜ç‚¹æ˜¯å®ƒå¯ä»¥è¡¨ç¤ºæ¯”æ•´æ•°æ‰€èƒ½è¡¨ç¤ºçš„æ•°å€¼å¤§å¾—å¤šçš„èŒƒå›´ã€‚ç¼ºé™·å°±æ˜¯è¿™æ­¤æ•°å€¼æ— æ³•ç²¾ç¡®è¡¨ç¤ºã€‚

ç°ä»£ç³»ç»Ÿæ”¯æŒç¡¬ä»¶å®ç°çš„æµ®ç‚¹è¿ç®—ï¼Œä½†æ˜¯å€¼æ˜¯æœ‰é™çš„ã€‚ä¹Ÿæœ‰è½¯ä»¶åº“å¯ä»¥ä½¿ç”¨ä»»æ„ç²¾åº¦çš„æµ®ç‚¹æ•°è®¡ç®—ã€‚

POSIX @command{awk} ä½¿ç”¨@dfn{åŒç²¾åº¦æµ®ç‚¹æ•°å€¼}ï¼Œè¿™æ¯”@dfn{å•ç²¾åº¦æµ®ç‚¹æ•°}å¯ä»¥ä¿å­˜æ›´å¤§èŒƒå›´çš„æ•°å€¼ã€‚@command{gawk} æœ‰å·¥å…·ç”¨æ¥æ‰§è¡Œä»»æ„ç²¾åº¦çš„æµ®ç‚¹æ•°ç®—æœ¯è¿ç®—ï¼Œæˆ‘ä»¬åé¢ä¼šè¿›è¡Œè¯¦ç»†åœ°æè¿°ã€‚
@end table

è®¡ç®—æœºå¤„ç†æ•´æ•°ä¸æµ®ç‚¹æ•°è¡¨ç¤ºçš„ä¸åŒèŒƒå›´çš„æ•°å€¼ã€‚æ•´æ•°å€¼é€šå¸¸è¦ä¹ˆæ˜¯ 32 ä½çš„ï¼Œæˆ–è€…æ˜¯ 64 ä½çš„å€¼ã€‚å•ç²¾åº¦æµ®ç‚¹æ•°å ç”¨ 32 ä½ï¼Œè€ŒåŒç²¾åº¦æµ®ç‚¹æ•°å ç”¨ 64 ä½æ•°ã€‚æµ®ç‚¹å€¼æ€»æ˜¯æœ‰ç¬¦å·çš„ã€‚å¯èƒ½çš„å€¼èŒƒå›´å¦‚ @ref{table-numeric-ranges} æ‰€ç¤ºï¼š

@float Table,table-numeric-ranges
@caption{ä¸åŒçš„æ•°å€¼è¡¨ç¤ºçš„å€¼èŒƒå›´}
@multitable @columnfractions .34 .33 .33
@headitem æ•°å€¼è¡¨ç¤º @tab æœ€å°å€¼ @tab æœ€å¤§å€¼
@item 32-bit æœ‰ç¬¦å·æ•´æ•° @tab @minus{}2,147,483,648 @tab 2,147,483,647
@item 32-bit æ— ç¬¦å·æ•´æ•° @tab 0 @tab 4,294,967,295
@item 64-bit æœ‰ç¬¦å·æ•´æ•° @tab @minus{}9,223,372,036,854,775,808 @tab 9,223,372,036,854,775,807
@item 64-bit æ— ç¬¦å·æ•´æ•° @tab 0 @tab 18,446,744,073,709,551,615
@iftex
@item å•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆå¤§çº¦å€¼ï¼‰ @tab @math{1.175494^{-38}} @tab @math{3.402823^{38}}
@item åŒæ•°åº¦æµ®ç‚¹æ•°ï¼ˆå¤§çº¦å€¼ï¼‰ @tab @math{2.225074^{-308}} @tab @math{1.797693^{308}}
@end iftex
@ifinfo
@item å•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆå¤§çº¦å€¼ï¼‰ @tab 1.175494e-38 @tab 3.402823e38
@item åŒæ•°åº¦æµ®ç‚¹æ•°ï¼ˆå¤§çº¦å€¼ï¼‰ @tab 2.225074e-308 @tab 1.797693e308
@end ifinfo
@ifnottex
@ifnotinfo
@item å•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆå¤§çº¦å€¼ï¼‰ @tab 1.175494@sup{-38} @tab 3.402823@sup{38}
@item åŒæ•°åº¦æµ®ç‚¹æ•°ï¼ˆå¤§çº¦å€¼ï¼‰ @tab 2.225074@sup{-308} @tab 1.797693@sup{308}
@end ifnotinfo
@end ifnottex
@end multitable
@end float

@node Math Definitions
@section è¦äº†è§£çš„å…¶ä»–çŸ¥è¯†

è¿™ä¸€@value{CHAPTER}çš„å‰©ä¸‹éƒ¨åˆ†ä½¿ç”¨å¤§é‡æ•°å€¼æœ¯è¯­ã€‚ä¸‹é¢æ˜¯ä¸€äº›éæ­£å¼å®šä¹‰ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡è¿™äº›ææ–™äº†è§£ï¼Œæœ‰åŠ©äºä½ çš„å·¥ä½œã€‚

@table @dfn
@item ç²¾ç¡®åº¦
æµ®ç‚¹æ•°è®¡ç®—çš„ç²¾ç¡®åº¦æ˜¯æŒ‡å…¶ä¸çœŸå®å€¼ï¼ˆçº¸ç¬”æ¥è¡¨ç¤ºçš„ï¼‰çš„æ¥è¿‘ç¨‹åºã€‚

@item é”™è¯¯
è®¡ç®—æ‰€ä»¥â€œåº”è¯¥æ˜¯â€çš„ç»“æœä¸å®é™…çš„ç»“æœä¹‹é—´çš„å·®å¼‚ã€‚åº”è¯¥æ˜¯å°½ç®¡æœ€å°åŒ–è¿™æ ·çš„é”™è¯¯ã€‚

@item å¹‚
å€¼çš„æ•°é‡çº§ï¼Œåœ¨æµ®ç‚¹æ•°å€¼çš„ä¸€äº›æ•°å€¼ä½æ˜¯ç”¨æ¥å­˜å‚¨å¹‚çš„ã€‚

@item Infï¼ˆæ— ç©·ï¼‰
ä»£è¡¨æ— ç©·çš„ç‰¹æ®Šå€¼ã€‚ä¸å…¶ä»–çš„æ•°æˆ–è€…æ— ç©·æ•°ä¹‹é—´çš„æ“ä½œäº§ç”Ÿæ— ç©·ã€‚

@item éæ•°å€¼
â€œä¸æ˜¯ä¸€ä¸ªæ•°å­—ã€‚â€
@footnote{æ„Ÿè°¢ Michael Brennan æä¾›äº†è¿™ä¸ªæè¿°ï¼ˆæˆ‘ä»¬æ”¹å†™äº†åŸæè¿°ï¼‰å’Œè¿™äº›ä¾‹å­ã€‚}
å°è¯•è®¡ç®—æ—¶ï¼Œæ— æ³•å¾—åˆ°å®æ•°ç»“æœçš„ä¸€ä¸ªç‰¹æ®Šå€¼ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè¦ä¹ˆä¼šæ”¶åˆ°ä¸€ä¸ªæµ®ç‚¹æ•°å¼‚å¸¸ï¼Œæˆ–è€…å–å¾—ä¸€ä¸ª @code{NaN} çš„ç»“æœã€‚IEEE 754 æ ‡å‡†å»ºè®®ç³»ç»Ÿåº”è¯¥è¿”å› @code{NaN}ã€‚æœ‰ä¸€äº›ä¾‹å­å¦‚ä¸‹ï¼š

@table @code
@item sqrt(-1)
è¿™åªæœ‰åœ¨å¤æ•°çš„èŒƒå›´å†…æ‰æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†æ˜¯åœ¨å®æ•°èŒƒå›´å†…ï¼Œç»“æœåˆ™æ˜¯ @code{NaN}ã€‚

@item log(-8)
@minus{}8 ä¸åœ¨ @code{log()} çš„åŸŸå†…ï¼Œæ‰€ä»¥ç»“æœä¸º @code{NaN}ã€‚
@end table

@item æ­£è§„åŒ–
ç³»æ•°åŠå…¶å®é™…å­˜å‚¨æ–¹å¼ï¼ˆåé¢ä¼šæœ‰è¯´æ˜ï¼‰ã€‚å€¼ä¼šè¢«è°ƒæ•´ä½¿å¾—ç¬¬ä¸€ä½ä¸º 1ï¼Œå› æ­¤å¼€å§‹çš„ä¸€ä½æ˜¯å‡æƒ³å­˜åœ¨ï¼Œå®é™…å¹¶æ²¡æœ‰å­˜å‚¨èµ·æ¥ã€‚è¿™å¯ä»¥æä¾›å¤šä¸€ä½çš„ç²¾åº¦ã€‚

@item ç²¾åº¦
ç”¨äºè¡¨ç¤ºæµ®ç‚¹æ•°å€¼çš„ä½æ•°ã€‚ä½æ•°è¶Šå¤šï¼Œåˆ™å¯ä»¥è¡¨ç¤ºæ›´å¤šçš„æ•°å€¼ã€‚äºŒè¿›åˆ¶ä¸åè¿›åˆ¶æ•°åº¦éƒ½æ˜¯å¤§æ¦‚çš„ï¼Œå¯æ ¹æ®å¦‚ä¸‹çš„å…¬å¼ï¼š

@display
@iftex
@math{prec = 3.322 @cdot dps}
@end iftex
@ifnottex
@ifnotdocbook
@var{prec} = 3.322 * @var{dps}
@end ifnotdocbook
@end ifnottex
@docbook
<emphasis>prec</emphasis> = 3.322 &sdot; <emphasis>dps</emphasis>
@end docbook
@end display

@noindent
åœ¨è¿™é‡Œï¼Œ@emph{prec} è¡¨ç¤ºäºŒè¿›åˆ¶æ•°åº¦ï¼ˆä»¥ä½æ¥è¡¡é‡ï¼‰ï¼Œ@emph{dps}ï¼ˆåè¿›åˆ¶ä½çš„ç¼©å†™ï¼‰æ˜¯åè¿›åˆ¶ä½ã€‚

@item èˆå…¥èˆå‡ºæ¨¡å¼
å¦‚æœéœ€è¦ï¼Œæ•°å€¼æ˜¯å¦‚ä½•æ¥è¿›è¡Œèˆå…¥èˆå‡ºçš„ã€‚åé¢ä¼šæä¾›æ›´å¤šçš„ç»†èŠ‚ã€‚

@item ç³»æ•°
æµ®ç‚¹æ•°ç”±ç³»æ•°ä¸ 10 çš„å¹‚æŒ‡æ•°ç›¸ä¹˜ç»„æˆã€‚æ¯”å¦‚ï¼Œåœ¨ @code{1.2345e67}ï¼Œåˆ™ç³»æ•°ä¸º @code{1.2345}ã€‚

@item Stability
@uref{http://en.wikipedia.org/wiki/Numerical_stability,
å…³äºç¨³å®šæ€§çš„ç»´åŸºç™¾ç§‘æ–‡æ¡£} ä¸­è¯´â€œä¸€ä¸ªè®¡ç®—å¯è¯åœ°ä¸ä¼šæ‰©å¤§è¿‘ä¼¼é”™è¯¯ç§°ä¸ºåœ¨æ•°å€¼ä¸Šæ˜¯ç¨³å®šçš„ã€‚â€ 
@end table

æŸ¥çœ‹ @uref{http://en.wikipedia.org/wiki/Accuracy_and_precision,
ç»´åŸºç™¾ç§‘å…³äºç²¾ç¡®æ€§ä¸ç²¾åº¦çš„æ–‡ç« } æ¥è·å–ç±»ä¼¼æœ¯è¯­çš„æ›´å¤šä¿¡æ¯ã€‚

åœ¨ç°ä»£çš„ç³»ç»Ÿä¸Šï¼Œæµ®ç‚¹æ•°ç¡¬ä»¶ä½¿ç”¨ IEEE 754 æ ‡å‡†å®šä¹‰çš„è¡¨ç¤ºä»¥åŠæ“ä½œã€‚IEEE 754 çš„ç±»å‹çš„ä¸‰ä¸ªæ ‡å‡†æ˜¯ 32 ä½å•ç²¾åº¦ï¼Œ64 ä½åŒç²¾åº¦ä»¥åŠ 128 ä½å››ç²¾åº¦ã€‚è¿™ä¸ªæ ‡å‡†ä¹ŸæŒ‡å®šäº†æ‰©å±•ç²¾åº¦çš„æ ¼å¼ä»¥å…è®¸æ›´å¤§ç²¾åº¦ä»¥åŠæ›´å¤§çš„æŒ‡æ•°èŒƒå›´ã€‚ï¼ˆ@command{awk} åªä½¿ç”¨ 64 ä½åŒç²¾åº¦æ ¼å¼ã€‚ï¼‰

@ref{table-ieee-formats} åˆ—å‡ºäº†åŸºæœ¬çš„ IEEE 754 äºŒè¿›åˆ¶æ ¼å¼çš„ç²¾åº¦ä»¥åŠæŒ‡æ•°åŸŸå€¼ã€‚

@float Table,table-ieee-formats
@caption{åŸºæœ¬çš„ IEEE æ ¼å¼çš„å€¼}
@multitable @columnfractions .20 .20 .20 .20 .20
@headitem åå­— @tab éƒ¨ä½æ•° @tab ç²¾åº¦ @tab æœ€å°æŒ‡æ•° @tab æœ€å¤§æŒ‡æ•°
@item å•ç²¾åº¦ @tab 32 @tab 24 @tab @minus{}126 @tab +127
@item åŒç²¾åº¦ @tab 64 @tab 53 @tab @minus{}1022 @tab +1023
@item å››ç²¾åº¦ @tab 128 @tab 113 @tab @minus{}16382 @tab +16383
@end multitable
@end float

@quotation æç¤º
ç²¾åº¦æ•°å€¼åŒ…å«äº†éšå«çš„æœ€å¼€å§‹çš„ä¸€ä½ï¼Œå› æ­¤æ¯”æ‰€ç»™çš„ç³»æ•°è¦å¤šä¸€ä½ã€‚
@end quotation

@node MPFR features
@section @command{gawk} çš„ä»»æ„ç²¾åº¦è®¡ç®—

é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œ@command{gawk} ä½¿ç”¨ç”±å…¶æ‰€è¿è¡Œçš„ç³»ç»Ÿçš„ç¡¬ä»¶æ¥æä¾›åŒç²¾åº¦æµ®ç‚¹æ•°å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒç¼–è¯‘çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šï¼Œå¹¶ä¸” @option{-M} å‘½ä»¤è¡Œé€‰é¡¹è¢«æä¾›äº†ï¼Œ@command{gawk} åˆ™ä½¿ç”¨ @uref{http://www.mpfr.org,
GNU MPFR} ä»¥åŠ @uref{http://gmplib.org, GNU MP}ï¼ˆGMPï¼‰åº“æ¥æ‰§è¡Œä»»æ„ç²¾åº¦çš„æ•°å€¼ç®—æœ¯è¿ç®—ã€‚ä½ å¯ä»¥è¿™æ ·æ¥æŸ¥çœ‹æ˜¯å¦æ”¯æŒ MPFRï¼š

@example
$ @kbd{gawk --version}
@print{} GNU Awk 4.1.2, API: 1.1 (GNU MPFR 3.1.0-p3, GNU MP 5.0.2)
@print{} Copyright (C) 1989, 1991-2015 Free Software Foundation.
@dots{}
@end example

@noindent
ï¼ˆä½ å¯èƒ½çœ‹åˆ°ä¸è¿™é‡Œæ˜¾ç¤ºçš„ä¸åŒçš„ç‰ˆæœ¬æ•°ã€‚ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œé‡è¦çš„æ˜¯çœ‹ GNU MPFR ä¸ GNU MP æ˜¯å¦æ˜¾ç¤ºåœ¨è¾“å‡ºä¸­ã€‚ï¼‰

å¦å¤–ï¼Œåœ¨ @code{PROCINFO} æ•°ç»„ä¸­çš„ä¸€äº›å…ƒç´ å¯ä»¥æ¥æä¾› MPFR ä¸ GMP åº“ä¸€äº›ä¿¡æ¯ï¼ˆæŸ¥çœ‹ @pxref{Auto-set}ï¼‰ã€‚

MPFR åº“æä¾›äº†åœ¨ç²¾åº¦ä¸èˆå…¥èˆå‡ºæ¨¡å¼çš„ç²¾ç¡®æ§åˆ¶ï¼Œå¹¶ç»™å‡ºæ­£ç¡®çš„èˆå…¥èˆå‡ºï¼Œå¯é‡ç°çš„ï¼Œå¹³å°æ— å…³çš„ç»“æœã€‚ä½¿ç”¨ @option{-M} å‘½ä»¤è¡Œå‚æ•°ï¼Œæ‰€æœ‰çš„æµ®ç‚¹ç®—æœ¯æ“ä½œç¬¦ä»¥åŠæ•°å€¼å‡½æ•°éƒ½å¯ä»¥äº§ç”Ÿä»»æ„æƒ³è¦çš„ç”± MPFR æ‰€æä¾›çš„ç²¾åº¦ã€‚

æœ‰ä¸¤ä¸ªé¢„å®šä¹‰çš„å˜é‡ï¼Œ@code{PREC} ä¸ @code{ROUNDMODE} æä¾›äº†å·¥ä½œç²¾åº¦ä¸èˆå…¥èˆå‡ºæ¨¡å¼çš„æ§åˆ¶ã€‚ç²¾åº¦ä¸èˆå…¥èˆå‡ºæ¨¡å¼çš„è®¾ç½®å¯¹äºä¹‹åçš„æ“ä½œæ˜¯å…¨å±€çš„ã€‚æŸ¥çœ‹ @ref{Setting precision}ï¼Œä»¥åŠ @ref{Setting the rounding mode}ï¼Œæ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚

@node FP Math Caution
@section  æµ®ç‚¹ç®—æ³•ï¼šä¹°è€…è‡ªæ…ï¼

@quotation
@i{æ•°å­¦è¯¾å¤ªéš¾äº†ã€‚}
@author Teen Talk Barbie, July 1992
@end quotation

è¿™ä¸€@value{SECTION}æä¾›äº†ä¸€ä¸ªæ›´é«˜å±‚ä¸Šè§†å›¾ï¼Œæ¥å®¡è§†åœ¨æ‰§è¡Œéå¸¸å¤šçš„æµ®ç‚¹æ•°è®¡ç®—æ—¶æ‰€äº§ç”Ÿé—®é¢˜ã€‚ 
@footnote{æœ‰ä¸€ä¸ªéå¸¸å¥½çš„ @uref{http://www.validlab.com/goldberg/paper.pdf,
å…³äºæµ®ç‚¹æ•°ç®—æœ¯è¿ç®—çš„è®ºæ–‡}ï¼Œç”± David Goldberg æ‰€å†™ï¼Œâ€œWhat Every Computer Scientist Should Know About Floating-Point Arithmeticâ€ï¼Œ
@cite{ACM Computing Surveys} @strong{23}, 1 (1991-03): 5-48. å¦‚æœä½ å¯¹äºç»†èŠ‚éå¸¸æ„Ÿå…´è¶£ï¼Œè¿™ä¸ªå€¼å¾—ä¸€è¯»ï¼Œä½†æ˜¯ç¡®å®éœ€è¦ä¸€å®šçš„è®¡ç®—æœºç§‘å­¦èƒŒæ™¯ã€‚}
è¿™äº›è®¨è®ºåŒæ ·ä¹Ÿé€‚ç”¨äºç¡¬ä»¶ä¸ä»»æ„ç²¾åº¦æµ®ç‚¹æ•°ç®—æœ¯è¿ç®—ã€‚

@quotation æ³¨æ„
è¿™é‡Œçš„å†…å®¹æœ‰æ„åœ°å†™å¾—éå¸¸æ¦‚æ‹¬ã€‚å¦‚æœä½ éœ€è¦åšä¸€äº›ä¸¥æ ¼çš„è®¡ç®—ç®—æœ¯è¿è¡Œï¼Œä½ é¦–å…ˆè¦è¿›è¡Œä¸€äº›ç ”ç©¶ï¼Œè€Œä¸ä»…ä»…ä¾èµ–æˆ‘ä»¬æ‰€å‘Šè¯‰ä½ çš„ã€‚
@end quotation

@menu
* Inexactness of computations:: Floating point math is not exact.
* Getting Accuracy::            Getting more accuracy takes some work.
* Try To Round::                Add digits and round.
* Setting precision::           How to set the precision.
* Setting the rounding mode::   How to set the rounding mode.
@end menu

@node Inexactness of computations
@subsection æµ®ç‚¹è®¡ç®—æ˜¯ä¸ç²¾ç¡®çš„

äºŒè¿›åˆ¶æµ®ç‚¹æ•°è¡¨ç¤ºä»¥åŠç®—æœ¯è¿è¡Œæ˜¯ä¸ç²¾ç¡®çš„ã€‚åƒ 0.1 è¿™æ ·ç®€å•çš„å€¼æ²¡ä¸èƒ½ç²¾ç¡®åœ°ç”±äºŒè¿›åˆ¶çš„æµ®ç‚¹æ•°æ¥è¡¨ç¤ºï¼Œæµ®ç‚¹æ•°æœ‰æœ‰é™çš„ç²¾åº¦æ•°è¡¨ç¤ºåœ¨è®¡ç®—ç­‰çº§ä¸Šï¼Œæˆ–è€…ä¸­é—´çš„å­˜å‚¨ç²¾åº¦çš„ä¸€ç‚¹ç‚¹æ”¹å˜éƒ½ä¼šä»¥æ”¹å˜ç»“æœã€‚åœ¨ä»»æ„ç²¾åº¦æµ®ç‚¹æ•°ç®—æœ¯è¿ç®—æ—¶ï¼Œä¸ºäº†ä½¿é—®é¢˜æ›´ç³Ÿç³•ï¼Œ ä½ å¯ä»¥åœ¨å¼€å§‹è®¡ç®—ä¹‹å‰è®¾ç½®ç²¾åº¦ï¼Œä½†æ˜¯ä½ æ²¡æœ‰åŠæ³•ä¿è¯åœ¨æœ€ç»ˆç»“æœä¸Šçš„åè¿›åˆ¶çš„æœ€é«˜æœ‰æ•ˆä½çš„æ•°å€¼ã€‚

@menu
* Inexact representation::      Numbers are not exactly represented.
* Comparing FP Values::         How to compare floating point values.
* Errors accumulate::           Errors get bigger as they go.
@end menu

@node Inexact representation
@subsubsection å¾ˆå¤šçš„æ•°ä¸èƒ½å®Œå…¨è¡¨ç¤º

æ‰€ä»¥ï¼Œåœ¨å¼€å§‹å†™ä»»ä½•ä»£ç ä¹‹é—´ï¼Œä½ è¦è€ƒè™‘ä¸€ä¸‹ä½ åˆ°åº•æƒ³è¦çš„æ˜¯ä»€ä¹ˆï¼Œä»¥åŠåˆ°åº•ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è€ƒè™‘ä¸‹é¢çš„ä¸¤ä¸ªä¾‹å­ä¸­çš„ä¸¤ä¸ªæ•°ï¼š

@example
x = 0.875             # 1/2 + 1/4 + 1/8
y = 0.425
@end example

ä¸åƒæ•°å­— @code{y}ï¼Œåœ¨ @code{x} ä¸­å­˜å‚¨çš„æ•°å­—å¯ä»¥ç²¾ç¡®åœ°ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºï¼Œå› ä¸ºå®ƒå¯ä»¥å†™æˆæœ‰é™ä¸ªåˆ†æ•°çš„å’Œï¼Œè€Œå®ƒä»–çš„åˆ†æ¯éƒ½æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚å½“ @command{gawk} ä»ç¨‹åºæºä»£ç ä¸­è¯»å–æµ®ç‚¹æ•°æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åœ°å¯¹äºå­—è¿›è¡Œèˆå…¥èˆå‡ºï¼Œè€Œä¸ç®¡ä½ çš„æœºå™¨æ”¯æŒçš„æ˜¯ä»€ä¹ˆæ ·çš„ç²¾åº¦ã€‚å¦‚æœä½ å°è¯•ä½ ç”¨è¾“å‡ºæ ¼å¼ä¸² @code{"%.17g"} æ‰“å°æŸä¸ªå˜é‡çš„å†…å®¹æ—¶ï¼Œå®ƒä¸ä¼šäº§ç”Ÿä¸ä½ æ‰€èµ‹ç»™å®ƒçš„ä¸€æ ·çš„å€¼ï¼š

@example
$ @kbd{gawk 'BEGIN @{ x = 0.875; y = 0.425}
> @kbd{              printf("%0.17g, %0.17g\n", x, y) @}'}
@print{} 0.875, 0.42499999999999999
@end example

é€šå¸¸çš„é”™è¯¯æ˜¯å¾ˆå°çš„ï¼Œä½ å¯èƒ½éƒ½æ³¨æ„ä¸åˆ°ã€‚å¦‚æœä½ ç¡®å®éœ€è¦ï¼Œä½ å¯ä»¥æŒ‡å®šè¾“å‡ºä¸­æ‰€éœ€è¦çš„ç²¾åº¦ã€‚
é€šå¸¸åƒ @code{"%.15g"} ä¸€æ ·çš„æ ¼å¼ã€‚åœ¨ä¸Šä¸€ä¸ªä¾‹å­ä¸­ï¼Œè¿™ä¼šäº§ç”Ÿä¸è¾“å…¥ä¸€æ ·çš„å€¼ã€‚

@node Comparing FP Values
@subsubsection å€¼æ¯”è¾ƒæ—¶è¦å°å¿ƒ

ç”±äºåº•å±‚çš„è¡¨ç¤ºä¸å®é™…çš„å€¼æœ‰ä¸€äº›åç¦»ï¼Œæ‰€ä»¥æ¯”è¾ƒæµ®ç‚¹æ•°æ¥æŸ¥çœ‹ä¸¤è€…æ˜¯å¦å®Œå…¨ç›¸ç­‰æ˜¯ä¸€ä¸ªä¸å¥½çš„ä¸»æ„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®ƒä¸ä¼šå¦‚ä½ æ‰€é¢„æœŸçš„é‚£æ ·æ‰§è¡Œï¼š

@example
$ @kbd{gawk 'BEGIN @{ print (0.1 + 12.2 == 12.3) @}'}
@print{} 0
@end example

æ¯”è¾ƒæµ®ç‚¹æ•°çš„å€¼ä»¥æŸ¥çœ‹å®ƒä»¬æ˜¯å¦æ˜¯åœ¨ä¸€ä¸ªå¾ˆå°çš„èŒƒå›´å†…çš„å·®å¼‚æ‰æ˜¯æ­£ç¡®æƒ³æ³•ï¼ˆç§°ä¸º @dfn{deltaï¼ˆå·®å¼‚ï¼‰} æˆ–è€…@dfn{å®¹å¿åº¦}ï¼‰ã€‚ä½ éœ€è¦ç¡®å®šå·®å¼‚æ˜¯å¤šå°å¯¹ä½ æ¥è¯´æ˜¯é‡è¦çš„ã€‚è¿™æ ·çš„å¤„ç†ä»£ç å¦‚ä¸‹ï¼š

@example
delta = 0.00001                 # for example
difference = abs(a) - abs(b)    # subtract the two values
if (difference < delta)
    # all ok
else
    # not ok
@end example

@noindent
ï¼ˆæˆ‘ä»¬å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ç»å¯¹å€¼å‡½æ•°ï¼Œåå­—ä¸º @code{abs()}ï¼Œå®šä¹‰åœ¨ä½ çš„ç¨‹åºçš„ä»£ç çš„æŸå¤„ã€‚ï¼‰

@node Errors accumulate
@subsubsection é”™è¯¯ç´¯ç§¯

åœ¨å•ä¸ªæµ®ç‚¹æ•°è®¡ç®—ä¸­æŸå¤±çš„ç²¾åº¦ï¼Œé€šå¸¸ä¸éœ€è¦æ‹…å¿ƒã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ è®¡ç®—çš„å€¼æ˜¯ä¸€ç³»åˆ—çš„æµ®ç‚¹æ•°æ“ä½œçš„ç»“æœï¼Œåˆ™é”™è¯¯å¯ä»¥ç´¯ç§¯å¹¶ä¸”å¯ä»¥æå¤§åœ°å½±å“è®¡ç®—æœ¬èº«ã€‚ä¸‹é¢å°è¯•ç”¨å®ƒä¸€ç³»åˆ—çš„è¡¨ç¤ºæ¥è®¡ç®— @value{PI} çš„å€¼ï¼š

@example
BEGIN @{
    x = 1.0 / sqrt(3.0)
    n = 6
    for (i = 1; i < 30; i++) @{
        n = n * 2.0
        x = (sqrt(x * x + 1) - 1) / x
        printf("%.15f\n", n * x)
    @}
@}
@end example

å½“æ‰§è¡Œçš„æ—¶å€™ï¼Œé”™è¯¯ä¼šä¼ é€’åˆ°åé¢çš„è®¡ç®—ä¸­ï¼Œå¯¼è‡´åœ¨è¿›è¡Œé™¤ 0 æ“ä½œæ—¶ï¼Œå¾ªç¯è¿‡æ—©åœ°ç»“æŸï¼š

@example
$ @kbd{gawk -f pi.awk}
@print{} 3.215390309173475
@print{} 3.159659942097510
@print{} 3.146086215131467
@print{} 3.142714599645573
@dots{}
@print{} 3.224515243534819
@print{} 2.791117213058638
@print{} 0.000000000000000
@error{} gawk: pi.awk:6: fatal: division by zero attempted
@end example

ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜å†…éƒ¨è¡¨ç¤ºçš„ä¸ç²¾ç¡®å¯¼è‡´ä¸€ä¸ªéæœŸæœ›çš„ç»“æœï¼š

@example
$ @kbd{gawk 'BEGIN @{}
>   @kbd{for (d = 1.1; d <= 1.5; d += 0.1)    # loop five times (?)}
>       @kbd{i++}
>   @kbd{print i}
> @kbd{@}'}
@print{} 4
@end example

@node Getting Accuracy
@subsection è·å–ä½ éœ€è¦çš„ç²¾åº¦

ä»»æ„ç²¾åº¦çš„ç®—æœ¯è¿ç®—å¯ä»¥å¾—åˆ°ç²¾ç¡®çš„ç»“æœä¹ˆï¼Ÿè¿™ä¸ªæ²¡æœ‰å¾ˆå¥½çš„ç­”æ¡ˆã€‚ä»£æ•°çš„æ ‡å‡†è§„åˆ™å¸¸å¸¸æ— æ³•ç”¨åœ¨æµ®ç‚¹æ•°çš„ç®—æœ¯è¿ç®—ä¸­ã€‚åœ¨è¿™äº›äº‹æƒ…ä¸­ï¼Œåˆ†é…ä¸å…³è”è§„åˆ™éƒ½æ— æ³•å®Œæ•´åœ°åº”ç”¨ï¼Œæ“ä½œçš„ç­‰çº§å¯¹äºä½ çš„è®¡ç®—éå¸¸é‡è¦ã€‚èˆå…¥èˆå‡ºé”™è¯¯ï¼Œç´¯ç§¯ç²¾åº¦æŸå¤±ï¼Œä»¥åŠå†…éƒ¨è¿è¡Œç»å¸¸éƒ½æ˜¯éº»çƒ¦äº‹ã€‚

å½“ @command{gawk} ä½¿ç”¨æœºå™¨çš„åŒç²¾åº¦æ¥æµ‹è¯•è¡¨è¾¾å¼ @samp{0.1 + 12.2} ä¸ @samp{12.3} çš„ç›¸ç­‰æ€§æ—¶ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ä¸ç›¸ç­‰ã€‚ï¼ˆæŸ¥çœ‹ @ref{Comparing FP Values}.ã€‚ï¼‰ä½ å¯ä»¥é€šè¿‡æä¾›ç²¾åº¦æ¥å¾—åˆ°ä½ æƒ³è¦çš„ç»“æœï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­åˆ™æ˜¯è¦æåˆ° 56 ä½ï¼š

@example
$ @kbd{gawk -M -v PREC=56 'BEGIN @{ print (0.1 + 12.2 == 12.3) @}'}
@print{} 1
@end example

å¦‚æœæ·»åŠ å¤šä¸€ä¸ªä½ä¸é”™ï¼Œé‚£ä¹ˆæ·»åŠ å¤šä¸€ä½æ˜¯ä¸æ˜¯æ›´å¥½ï¼Ÿä¸‹é¢æ˜¯å½“ä½ ä½¿ç”¨æ›´å¤§çš„ @code{PREC} æ—¶æ‰€äº§ç”Ÿçš„ç»“æœï¼š

@example
$ @kbd{gawk -M -v PREC=201 'BEGIN @{ print (0.1 + 12.2 == 12.3) @}'}
@print{} 0
@end example

è¿™æ—¢ä¸æ˜¯ @command{gawk} çš„ bug ä¹Ÿä¸æ˜¯ MPFR åº“çš„ bugã€‚å¤§å®¶å¾ˆå®¹æ˜“å¿˜è®°æœ‰é™çš„ä½æ•°ç”¨æ¥å­˜å‚¨ä¸€ä¸ªå€¼ï¼Œé€šå¸¸éƒ½åœ¨è¿›è¡Œäº†ç›¸åº”çš„èˆå…¥èˆå‡ºåéƒ½æ˜¯ä¸€ä¸ªç›¸ä¼¼å€¼ã€‚å¯¹äºæµ‹è¯•ç›¸ç­‰æ€§ï¼Œåªæœ‰åœ¨æ‰€ä¸¤ä¸ªæ“ä½œæ•°ä¸­@emph{æ‰€æœ‰}ç­‰éƒ½ç›¸åŒæ—¶æ‰ä¼šæˆåŠŸã€‚å› ä¸ºåœ¨ä»¥ç‰¹å®šçš„ç²¾åº¦ä¸æœ‰æ•ˆçš„èˆå…¥èˆå‡ºæ¨¡å¼è¿›è¡Œæµ®ç‚¹æ•°è¿è¡Œåè¿™å¹¶ä¸ä¸€å®šè¦å¿…é¡»çš„ï¼Œç›´æ¥è¿›è¡Œç›¸ç­‰æ€§çš„æ¯”è¾ƒæ˜¯ä¸ä¼šæˆåŠŸçš„ã€‚ç›¸åï¼Œæ¯”è¾ƒä¸¤ä¸ªæ•°ä»¥æŸ¥çœ‹å®ƒä»¬æ˜¯å¦ç›¸äº’ä¹‹é—´æ˜¯åœ¨æ‰€å¸Œæœ›çš„å·®å¼‚åŒºé—´å†…æ‰æ˜¯æ­£è§£ã€‚

åœ¨åº”ç”¨ä¸­ï¼Œ15 æˆ–è€…æ›´å°‘çš„åè¿›åˆ¶ä½å°±å¤Ÿäº†ã€‚ç¡¬ä»¶çš„åŒç²¾åº¦ç®—æœ¯è¿ç®—æ˜¯åˆé€‚çš„ï¼Œå¹¶ä¸”ä¹Ÿå¾ˆå¿«é€Ÿã€‚ä½†æ˜¯ä½ è¦è®°ä½ï¼Œæ¯ä¸€ä¸ªæµ®ç‚¹æ•°æ“ä½œéƒ½ä¼šå¯¼è‡´ä¸€ä¸ªæ–°çš„èˆå…¥èˆå‡ºé”™è¯¯ï¼Œè¿›è€Œå¯¼è‡´æ‚²å‰§æ€§çš„ç»“æœï¼Œè¿™æ­£å¦‚æ—©å…ˆçš„å°è¯•è®¡ç®— @value{PI} çš„å€¼æ‰€è¯´æ˜çš„ä¸€æ ·ã€‚åœ¨è¿™ä¸ªæƒ…å†µé‡Œï¼Œé¢å¤–çš„ç²¾åº¦å¯ä»¥æå¤§åœ°æä¾›è®¡ç®—çš„ç¨³å®šæ€§ä¸ç²¾ç¡®åº¦ã€‚

å¦å¤–ï¼Œä½ éœ€è¦äº†è§£ï¼Œåœ¨æµ®ç‚¹æ•°ç®—æœ¯è¿ç®—ä¸­ï¼Œé‡å¤åŠ å¹¶ä¸ä¸€å®šç­‰äºä¹˜ã€‚è¿™ä¸ªä¾‹å­åœ¨ @ref{Errors accumulate}ï¼š

@example
$ @kbd{gawk 'BEGIN @{}
>   @kbd{for (d = 1.1; d <= 1.5; d += 0.1)    # loop five times (?)}
>       @kbd{i++}
>   @kbd{print i}
> @kbd{@}'}
@print{} 4
@end example

@noindent
é€šè¿‡é€‰æ‹©ä»»æ„å¤§æ•°å€¼çš„ @code{PREC}ï¼Œä½ å¯èƒ½ä¼šï¼Œä¹Ÿå¯èƒ½ä¸ä¼šæˆåŠŸåœ°å–å¾—æ­£ç¡®çš„ç»“æœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç«‹å³é‡ç»„é—®é¢˜é€šå¸¸æ‰æ˜¯æ­£ç¡®çš„æ–¹æ³•ã€‚

@node Try To Round
@subsection å¢åŠ å‡ ä½ç²¾åº¦ç„¶åå†èˆå…¥è½¬å‡º

é™¤äº†ä»»æ„ç²¾åº¦çš„æµ®ç‚¹æ•°ç®—æœ¯è¿ç®—ï¼Œä½ æ‰€éœ€è¦çš„å¸¸å¸¸æ˜¯è°ƒæ•´ä½ çš„é€»è¾‘ï¼Œæˆ–è€…æ˜¯è®¡ç®—çš„ä¸åŒç­‰çº§ã€‚æ—©å…ˆçš„ä¾‹å­ä¸­ï¼Œ@value{PI} è®¡ç®—çš„ç¨³å®šæ€§ä¸ç²¾åº¦å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£æ•°å˜å½¢å¯ä»¥å¾—åˆ°æé«˜ï¼š

@example
(sqrt(x * x + 1) - 1) / x @equiv{} x / (sqrt(x * x + 1) + 1)
@end example

@noindent
é€šè¿‡è¿™æ ·çš„å˜åŒ–ï¼Œåœ¨ 30 ä¸ªè¿­ä»£åï¼Œç¨‹åºæ±‡é›†åˆ° @value{PI} çš„ç»“æœä¸ºï¼š

@example
$ @kbd{gawk -f pi2.awk}
@print{} 3.215390309173473
@print{} 3.159659942097501
@print{} 3.146086215131436
@print{} 3.142714599645370
@print{} 3.141873049979825
@dots{}
@print{} 3.141592653589797
@print{} 3.141592653589797
@end example

@node Setting precision
@subsection è®¾ç½®ç²¾åº¦

@command{gawk} ä½¿ç”¨å…¨å±€æ€§çš„å·¥ä½œç²¾åº¦ ï¼Œå®ƒä¸ä¼šä¸ºå•ä¸ªçš„æ•°å€¼è·Ÿè¸ªç²¾åº¦ä¸ç²¾ç¡®åº¦ã€‚æ‰§è¡Œç®—æœ¯è¿ç®—æˆ–è€…è°ƒç”¨å†…ç½®å‡½æ•°æ¥å¯¹ç»“æœè¿›è¡Œèˆå…¥èˆå‡ºéƒ½ä»¥å½“çš„ç²¾åº¦ä¸ºå‡†ã€‚é»˜è®¤çš„å·¥ä½œç²¾åº¦æ˜¯ 53 ä½ï¼Œä½ å¯ä»¥é€šè¿‡ä¿®æ”¹å˜é‡ @code{PREC} æ¥æ”¹å˜ã€‚ä½ ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºé¢„å®šä¹‰çš„å¤§å°å†™æœ‰å…³çš„å€¼ä¸²ï¼Œå¦‚ @ref{table-predefined-precision-strings} æ‰€åˆ—ï¼Œè¿™äº›ç”¨æ¥å¯¹ IEEE 754 äºŒè¿›åˆ¶æ ‡å‡†è¿›è¡Œæ¨¡æ‹Ÿã€‚

@float Table,table-predefined-precision-strings
@caption{@code{PREC} çš„é¢„å®šä¹‰ç²¾åº¦ä¸²}
@multitable {@code{"double"}} {12345678901234567890123456789012345}
@headitem @code{PREC} @tab IEEE 754 äºŒè¿›åˆ¶æ ¼å¼
@item @code{"half"} @tab 16 ä½åŠç²¾åº¦
@item @code{"single"} @tab åŸºæœ¬çš„ 32 ä½å•ç²¾åº¦
@item @code{"double"} @tab åŸºæœ¬çš„ 64 ä½åŒç²¾åº¦
@item @code{"quad"} @tab åŸºæœ¬çš„ 128 ä½å››ç²¾åº¦
@item @code{"oct"} @tab 256 ä½å…«ç²¾åº¦
@end multitable
@end float

ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†æ”¹å˜ç®—æœ¯æ“ä½œç¬¦çš„ç²¾åº¦çš„æ•ˆæœï¼š

@example
$ @kbd{gawk -M -v PREC=100 'BEGIN @{ x = 1.0e-400; print x + 0}
>   @kbd{PREC = "double"; print x + 0 @}'}
@print{} 1e-400
@print{} 0
@end example

@quotation æ³¨æ„
è¦å°å¿ƒæµ®ç‚¹æ•°å¸¸é‡ï¼å½“ä»ç¨‹åºæºä»£ç ä¸­è¯»å–æµ®ç‚¹æ•°å¸¸é‡æ—¶ï¼Œ@command{gawk} ä¼šä½¿ç”¨é»˜è®¤çš„ç²¾åº¦ï¼ˆå³ C @code{double}ï¼‰ï¼Œé™¤éé€šè¿‡å‘½ä»¤è¡Œèµ‹å€¼æ¥æ”¹å˜ @code{PREC} çš„å€¼ï¼Œå°†å…¶å†…éƒ¨å­˜ä¸º MPFR æ•°å€¼ã€‚åœ¨ç¨‹åºæºä»£ç é€šè¿‡ä½¿ç”¨ @code{PREC} æ¥æ”¹å˜ç²¾åº¦@emph{ä¸ä¼š}å½±å“å¸¸é‡çš„ç²¾åº¦ã€‚

å¦‚æœéœ€è¦åœ¨æ¯”é»˜è®¤çš„ç²¾åº¦è¿˜è¦é«˜çš„ç²¾åº¦ä¸Šè¡¨ç¤ºä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œä½†åˆä¸èƒ½ä½¿ç”¨å‘½ä»¤è¡Œå¯¹ @code{PREC} è¿›è¡Œèµ‹å€¼ï¼Œä½ è¦ä¹ˆå°†å¸¸æ•°æŒ‡å®šä¼šå­—ä¸²ï¼Œè¦ä¹ˆåªè¦å¯èƒ½ï¼Œä½¿å…¶æˆä¸ºæœ‰ç†æ•°ï¼Œ ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†ä¸åŒçš„æ–¹å¼ä¸‹æ‰“å°æµ®ç‚¹æ•°å¸¸é‡æ—¶çš„ä¸åŒï¼š

@example
$ @kbd{gawk -M 'BEGIN @{ PREC = 113; printf("%0.25f\n", 0.1) @}'}
@print{} 0.1000000000000000055511151
$ @kbd{gawk -M -v PREC=113 'BEGIN @{ printf("%0.25f\n", 0.1) @}'}
@print{} 0.1000000000000000000000000
$ @kbd{gawk -M 'BEGIN @{ PREC = 113; printf("%0.25f\n", "0.1") @}'}
@print{} 0.1000000000000000000000000
$ @kbd{gawk -M 'BEGIN @{ PREC = 113; printf("%0.25f\n", 1/10) @}'}
@print{} 0.1000000000000000000000000
@end example
@end quotation

@node Setting the rounding mode
@subsection è®¾ç½®èˆå…¥è½¬å‡ºæ¨¡å¼

@code{ROUNDMODE} å˜é‡æä¾›äº†åœ¨ç¨‹åºå±‚æ§åˆ¶èˆå…¥èˆå‡ºæ¨¡å¼çš„æ–¹æ³•ã€‚@code{ROUNDMODE} ä¸ IEEE çš„èˆå…¥èˆå‡ºçš„æ¯”è¾ƒæ˜¾ç¤ºåœ¨ @ref{table-gawk-rounding-modes} ä¸­ã€‚

@float Table,table-gawk-rounding-modes
@caption{@command{gawk} çš„èˆå…¥èˆå‡ºæ¨¡å¼}
@multitable @columnfractions .45 .30 .25
@headitem èˆå…¥èˆå‡ºæ¨¡å¼ @tab IEEE å @tab @code{ROUNDMODE}
@item å‘å¶æ•°èˆå…¥èˆå‡ºåˆ°æœ€è¿‘ @tab @code{roundTiesToEven} @tab @code{"N"} or @code{"n"}
@item å‘æ­£æ— ç©·èˆå…¥èˆå‡º @tab @code{roundTowardPositive} @tab @code{"U"} or @code{"u"}
@item å‘è´Ÿæ— ç©·èˆå…¥èˆå‡º @tab @code{roundTowardNegative} @tab @code{"D"} or @code{"d"}
@item å‘é›¶èˆå…¥èˆå‡º @tab @code{roundTowardZero} @tab @code{"Z"} or @code{"z"}
@item èƒŒèº«é›¶èˆå…¥èˆå‡ºåˆ°æœ€è¿‘ @tab @code{roundTiesToAway} @tab @code{"A"} or @code{"a"}
@end multitable
@end float

@code{ROUNDMODE} çš„é»˜è®¤å€¼ä¸º @code{"N"}ï¼Œè¿™é€‰æ‹©çš„æ˜¯ IEEE 754 çš„èˆå…¥èˆå‡ºæ¨¡å¼ä¸º roundTiesToEvenã€‚åœ¨ @ref{table-gawk-rounding-modes} ä¸­ï¼Œå€¼ @code{"A"} é€‰æ‹©çš„æ˜¯ @code{roundTiesToAway}ã€‚è¿™åªæœ‰é¡ºä½ çš„ MPFR åº“æ”¯æŒæ—¶æ‰å¯ç”¨ï¼Œå¦åˆ™è®¾ç½® @code{ROUNDMODE} ä¸º @code{"A"} æ˜¯æ²¡æœ‰æ•ˆæœçš„ã€‚

é»˜è®¤çš„æ¨¡å¼ @code{roundTiesToEven} æ˜¯ä½¿ç”¨å¾—æœ€å¤šçš„ï¼Œä½†æ˜¯æœ€ä¸ç›´è§‚ã€‚è¿™ä¸ªæ–¹æ³•å¯¹å¤§å¤šæ•°çš„å€¼çš„å¤„ç†éƒ½æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œå°±æ˜¯å°†å®ƒä»¬å‘ä¸Šæˆ–è€…å‘ä¸‹åˆ°æœ€è¿‘çš„æ•°ã€‚ä¾‹å¦‚ï¼Œå°† 1.132 èˆå…¥èˆå‡ºä¸ºä¸¤ä½æ•°ï¼Œä¼šäº§ç”Ÿ 1.13ï¼Œè€Œå¯¹ 1.157 èˆå…¥èˆå‡ºäº§ç”Ÿ 1.16ã€‚

ä½†æ˜¯ï¼Œå…¶å€¼åˆšå¥½æ˜¯ä¸€åŠçš„æ—¶å€™ï¼Œå¯¹å…¶è¿›è¡Œèˆå…¥èˆå‡ºæ—¶ï¼Œäº‹æƒ…å¤„ç†æ–¹å¼å°±ä¸ä¼šåƒä½ åœ¨å­¦æ ¡æ—¶æ‰€å­¦çš„ä¸€æ ·å·¥ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°å­—è¢«èˆå…¥èˆå‡ºåˆ°æœ€è¿‘çš„å¶æ•°ä½ã€‚æ‰€ä»¥ï¼Œå¯¹ 0.125 èˆå…¥èˆå‡ºä¸ºä¸¤ä½æ•°ï¼Œåˆ™ä¼šäº§ç”Ÿ 0.12ï¼Œä½†æ˜¯å¯¹æ•°å€¼ 0.6875 èˆå…¥èˆå‡ºåˆ°ä¸‰ä½åˆ™ä¼šå‘ä¸Šèˆå…¥ä¸º 0.688ã€‚ä½ å¯èƒ½åœ¨ä½¿ç”¨ @code{printf} æ¥æ ¼å¼åŒ–æµ®ç‚¹æ•°æ—¶å·²ç»é‡åˆ°è¿‡è¿™æ ·çš„èˆå…¥èˆå‡ºæ¨¡å¼ã€‚ä¾‹å¦‚ï¼š

@example
BEGIN @{
    x = -4.5
    for (i = 1; i < 10; i++) @{
        x += 1.0
        printf("%4.1f => %2.0f\n", x, x)
    @}
@}
@end example

@noindent
åœ¨ä½œè€…çš„ç³»ç»Ÿä¸Šï¼Œä¼šäº§ç”Ÿä¸‹é¢çš„è¾“å‡ºï¼š 
@footnote{å¦‚æœåœ¨ä½ çš„ç³»ç»Ÿä¸Šçš„ C åº“ä¸æ”¯æŒä½¿ç”¨ IEEE 754 çš„å¶æ•°èˆå…¥èˆå‡ºè§„åˆ™æ¥ä¸º @code{printf} èˆå…¥èˆå‡ºåŠæ•°çš„æƒ…å†µï¼Œæœ‰å¯èƒ½è¾“å‡ºå®Œå…¨ä¸åŒã€‚}

@example
-3.5 => -4
-2.5 => -2
-1.5 => -2
-0.5 => 0
 0.5 => 0
 1.5 => 2
 2.5 => 2
 3.5 => 4
 4.5 => 4
@end example

@code{roundTiesToEven} èƒŒåçš„ç†è®ºæ˜¯ï¼Œå¯¹ç¡®å®šçš„åŠå€¼èˆå…¥èˆå‡ºæˆ–å¤šæˆ–å°‘å‘ä¸Šæˆ–è€…å‘ä¸‹æ˜¯å‡ç­‰åœ°åˆ†å¸ƒçš„ã€‚è¿™æ ·å¯ä»¥ä½¿å¾—èˆå…¥è¾“å‡ºå¯¼è‡´çš„æŸå¤±å¯ä»¥è‡ªå·±è¡¥å¿ã€‚è¿™å¯¹äº IEEE 754 çš„è®¡ç®—å‡½æ•°ä¸æ“ä½œç¬¦æ˜¯é»˜è®¤çš„èˆå…¥èˆå‡ºæ¨¡å¼ã€‚

å…¶ä»–çš„èˆå…¥èˆå‡ºæ¨¡å¼å¾ˆå°‘ä½¿ç”¨ã€‚å‘æ­£æ— ç©·èˆå…¥èˆå‡ºï¼ˆ@code{roundTowardPositive}ï¼‰ä»¥åŠå‘è´Ÿæ— ç©·èˆå…¥èˆå‡ºï¼ˆ@code{roundTowardNegative}ï¼‰å¸¸å¸¸ç”¨äºå®ç°é—´éš”ç®—æœ¯ï¼Œåœ¨è¿™æ ·çš„è®¡ç®—ä¸­ï¼Œä½ è°ƒæ•´èˆå…¥èˆå‡ºæ¨¡å¼æ¥è®¡ç®—è¾“å‡ºèŒƒå›´çš„ä¸Šä¸‹è¾¹æ²¿ã€‚@code{roundTowardZero} æ¨¡å¼å¯ç”¨äºå°†æµ®ç‚¹æ•°è½¬æ¢äº†æ•´æ•°ã€‚@code{roundTiesToAway} è¿™ä¸ªèˆå…¥è¾“å‡ºæ¨¡å¼å°†ç»“æœèˆå…¥èˆå‡ºåˆ°æœ€è¿‘çš„æ•°ï¼Œå¦‚æœå‡ºç°çš„ç»‘å®šçš„æƒ…å†µï¼Œåˆ™é€‰æ‹©ä¸€ä¸ªè¾ƒå¤§å¹…åº¦çš„å€¼ã€‚

æœ‰ä¸€äº›æ•°å€¼åˆ†æå¸ˆä¼šå‘Šè¯‰ä½ ï¼Œä½ çš„èˆå…¥èˆå‡ºé£æ ¼çš„é€‰æ‹©ä¼šæå¤§åœ°å½±å“æœ€åçš„è¾“å‡ºï¼Œå¹¶ä¸”å»ºè®®ä½ ç›´åˆ°æœ€åè¾“å‡ºæ—¶æ‰ç¡®å®šèˆå…¥èˆå‡ºæ¨¡å¼ã€‚ç›¸ååœ°ï¼Œä½ å¸¸å¸¸å¯ä»¥é¿å…èˆå…¥èˆå‡ºé”™è¯¯ï¼Œéœ€è¦çš„åªæ˜¯åœ¨ä¸€å¼€å§‹å°†åˆå§‹ç²¾åº¦è®¾ç½®æ¯”æœ€ç»ˆæ‰€éœ€è¦çš„å¤§å¾—å¤šçš„ç²¾åº¦ï¼Œè¿™æ ·ç´¯ç§¯çš„èˆå…¥èˆå‡ºé”™è¯¯ä¸ä¼šå½±å“ç»“æœã€‚å¦‚æœä½ æ€€ç–‘ä½ è®¡ç®—çš„ç»“æœå¯¹äºèˆå…¥èˆå‡ºé”™è¯¯æ˜¯å¾ˆæ•æ„Ÿçš„ï¼Œéœ€è¦ä½ æ”¹å˜èˆå…¥èˆå‡ºæ¨¡å¼æ¥çœ‹ç°è¾“å‡ºä¸­æ˜æ˜¾çš„å·®å¼‚æ¥è¿›è¡Œç¡®è®¤ã€‚

@node Arbitrary Precision Integers
@section @command{gawk} ä¸­çš„ä»»æ„ç²¾åº¦æ•´æ•°è®¡ç®—
@cindex integers, arbitrary precision
@cindex arbitrary precision integers

å½“æŒ‡å®šäº† @option{-M} é€‰é¡¹ï¼Œ@command{gawk} ä¼šä½¿ç”¨ GMP ä»»æ„ç²¾åº¦æ•´æ•°çš„æ‰§è¡Œæ‰€æœ‰çš„æ•´æ•°ç®—æœ¯ã€‚åœ¨æºä»£ç ä¸­æˆ–è€…@value{DF}ä¸­ä»»æ„çš„çœ‹èµ·æ¥åƒæ•´æ•°å€¼éƒ½å­˜æˆä»»æ„ç²¾åº¦çš„æ•´æ•°ã€‚æ•´æ•°çš„å¤§å°åªå—é™äºå¯ç”¨çš„å†…å­˜ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä¼šè®¡ç®—
@iftex
@math{5^{4^{3^{2}}}}
@end iftex
@ifinfo
5^4^3^2
@end ifinfo
@ifnottex
@ifnotinfo
5@sup{4@sup{3@sup{2}}}
@end ifnotinfo
@end ifnottex
ï¼Œè¿™ä¸ªç»“æœå·²ç»è¶…è¿‡äº†ä¸€èˆ¬çš„åŒç²¾åº¦æµ®ç‚¹å€¼çš„é™åˆ¶ï¼š

@example
$ @kbd{gawk -M 'BEGIN @{}
>   @kbd{x = 5^4^3^2}
>   @kbd{print "number of digits =", length(x)}
>   @kbd{print substr(x, 1, 20), "...", substr(x, length(x) - 19, 20)}
> @kbd{@}'}
@print{} number of digits = 183231
@print{} 62060698786608744707 ... 92256259918212890625
@end example

å¦‚æœä½ ä½¿ç”¨ä»»æ„ç²¾åº¦çš„æµ®ç‚¹å€¼æ¥è®¡ç®—ç›¸åŒçš„å€¼ï¼Œä¸ºäº†æ­£ç¡®çš„è¾“å‡ºæ‰€éœ€è¦çš„ç²¾åº¦ï¼ˆä½¿ç”¨å…¬å¼ 
If instead you were to compute the same value using arbitrary-precision
floating-point values, the precision needed for correct output (using
the formula
@iftex
@math{prec = 3.322 @cdot dps}ï¼‰
åˆ™ä¼šæ˜¯ @math{3.322 @cdot 183231}ï¼Œ
@end iftex
@ifnottex
@ifnotdocbook
@samp{prec = 3.322 * dps}ï¼‰
åˆ™ä¼šæ˜¯ 3.322 x 183231ï¼Œ
@end ifnotdocbook
@end ifnottex
@docbook
<emphasis>prec</emphasis> = 3.322 &sdot; <emphasis>dps</emphasis>ï¼‰
åˆ™ä¼šæ˜¯
<emphasis>prec</emphasis> = 3.322 &sdot; 183231ï¼Œ
@end docbook
æˆ–è€…è¯´æ˜¯ 608693ã€‚

æ¥è‡ªäºä¸€ä¸ªæ•´æ•°ä¸ä¸€ä¸ªæµ®ç‚¹æ•°å€¼çš„ç®—æœ¯æ“ä½œçš„ç»“æœï¼Œæ˜¯ä¸€ä¸ªä¸å½“å‰å·¥ä½œæ•°åº¦ç›¸åŒçš„ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚ä¸‹é¢çš„ç¨‹åºç”¨è¿­ä»£æ¥è®¡ç®— Sylvester åºåˆ—
@footnote{Weisstein, Eric W.
@cite{Sylvester's Sequence}ï¼Œæ¥è‡ªäº MathWorldâ€”â€”ä¸€ä¸ªWolfram WEB èµ„æº @w{(@url{http://mathworld.wolfram.com/SylvestersSequence.html})}ã€‚}
çš„ç¬¬å…«ä¸ªé¡¹ï¼š

@example
$ @kbd{gawk -M 'BEGIN @{}
>   @kbd{s = 2.0}
>   @kbd{for (i = 1; i <= 7; i++)}
>       @kbd{s = s * (s - 1) + 1}
>   @kbd{print s}
> @kbd{@}'}
@print{} 113423713055421845118910464
@end example

è¾“å‡ºä¸åŒäºå®é™…çš„æ•°å€¼ï¼Œå³ 113ï¼Œ423ï¼Œ713ï¼Œ055ï¼Œ421ï¼Œ844ï¼Œ361ï¼Œ000ï¼Œ443ï¼Œè¿™é‡Œå› ä¸ºé»˜è®¤çš„ç²¾åº¦ä¸º 53 ä½ï¼Œä¸è¶³ä»¥ç²¾ç¡®åœ°è¡¨ç¤ºæ¸…ç‚¹ç»“æœã€‚ä½ è¦ä¹ˆæä¾›é«˜ç²¾ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ100 ä½æ˜¯å¤Ÿäº†çš„ï¼‰ï¼Œæˆ–è€…å°†æµ®ç‚¹æ•°å¸¸æ•° @samp{2.0} æ›¿æ¢ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œä»¥å…¨éƒ¨ä½¿ç”¨æ•´æ•°ç®—æœ¯è¿è¡Œæ¥è®¡ç®—æ­£ç¡®æœ‰çš„è¾“å‡ºã€‚

æœ‰æ—¶å€™ï¼Œ@command{gawk} å¿…é¡»éšå¼åœ°å°†ä»»æ„ç²¾åº¦çš„æ•´æ•°è½¬æ¢ä¸ºä»»æ„ç²’åº¦çš„æµ®ç‚¹æ•°ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºï¼Œå½“ä¸€ä¸ªæ“ä½œæˆ–è€…å‡½æ•°éœ€è¦æ—¶ï¼ŒMPFR åº“å¹¶ä¸æ€»æ˜¯æä¾›ç›¸å…³çš„æ¥å£æ¥å¤„ç†ä»»æ„ç²¾åº¦çš„æ•´æ•°ï¼Œæˆ–è€…æ··åˆæ¨¡å¼çš„æ•°å­—ã€‚åœ¨è¿™æ ·çš„ä¾‹å­ä¸­ï¼Œç²¾åº¦ä¼šè¢«è®¾ç½®æˆè¦ç²¾åº¦è½¬æ¢æ—¶çš„æœ€å°çš„å€¼ï¼Œè€Œå·¥ä½œç²¾åº¦åˆ™ä¸ç”¨äºè¿™ä¸ªç›®çš„ã€‚å¦‚æœè¿™ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œä½ å¯ä»¥ç”¨ä¸ªå°è¯¡è®¡å¹¶å°†æ•´æ•°å…ˆè½¬æ¢ä¸ºæµ®ç‚¹æ•°ï¼Œå¦‚ï¼š

@example
gawk -M 'BEGIN @{ n = 13; print (n + 0.0) % 2.0 @}'
@end example

ä½ å¯ä»¥é€šè¿‡æŒ‡å®šæ•°å€¼ä¸ºæµ®ç‚¹æ•°æ¥é¿å…è¿™æ ·çš„é—®é¢˜ï¼š

@example
gawk -M 'BEGIN @{ n = 13.0; print n % 2.0 @}'
@end example

æ³¨æ„ï¼Œå¯¹äºè¿™ä¸ªç‰¹æ®Šçš„ä¾‹å­ï¼Œæœ€å¥½æ˜¯ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š

@example
gawk -M 'BEGIN @{ n = 13; print n % 2 @}'
@end example

@node POSIX Floating Point Problems
@section æ ‡å‡†ä¸æ—¢å­˜å®è·µ

å†å²ä¸Šï¼Œ@command{awk} ä¼šåœ¨éœ€è¦çš„æ—¶å€™ï¼Œå°†æ‰€æœ‰çš„çœ‹èµ·ä¸šæ˜¯éæ•°å€¼çš„å­—ä¸²è½¬æ¢ä¸ºæ•°å€¼ 0ã€‚è€Œä¸”ï¼Œè¯­è¨€çš„æœ€å¼€å§‹çš„å®šä¹‰ä¸æœ€åˆçš„ POSIX æ ‡å‡†è§„å®šï¼Œ@command{awk} åªç†è§£åè¿›åˆ¶ï¼ˆåŸºæ•°ä¸º 10ï¼‰ï¼Œè€Œä¸æ˜¯å…«è¿›åˆ¶ï¼ˆä»¥ 8 ä¸ºåŸºæ•°ï¼‰ä»¥åŠåå…­è¿›åˆ¶æ•°ï¼ˆä»¥ 16 ä¸ºåŸºæ•°ï¼‰ã€‚

2001 çš„è¯­è¨€çš„å˜åŒ–ä¸ 2004 å¹´çš„ POSIX æ ‡å‡†éƒ½å¯ä»¥è§£é‡Šä¸ºï¼Œ@command{awk} ä¼šå¯æ”¯æŒé¢å¤–çš„ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§æ˜¯ï¼š

@itemize @value{BULLET}
@item
ä»¥åå…­è¿›åˆ¶å½¢æˆæŒ‡å®šçš„æµ®ç‚¹æ•°çš„è§£æï¼ˆå¦‚ï¼Œ@code{0xDEADBEEF}ï¼‰ã€‚ï¼ˆæç¤ºï¼šæ˜¯æ•°æ®å€¼ï¼Œè€Œ@emph{ä¸æ˜¯}æºä»£ç å¸¸é‡ã€‚ï¼‰

@item
æ”¯æŒ IEEE 754 ç‰¹æ®Šçš„æµ®ç‚¹æ•°å€¼â€œnot a numberâ€ï¼ˆNaNï¼‰ï¼Œæ­£æ— ç©·ï¼ˆâ€œinfâ€ï¼‰ä¸è´Ÿæ— ç©·ï¼ˆâ€œ@minus{}infâ€ï¼‰ã€‚ç‰¹åˆ«æ˜¯ï¼Œè¿™äº›å€¼çš„æ ¼å¼ç”± ISO 1999 çš„ C æ ‡å‡†æŒ‡å®šï¼Œå®ƒä»¬ä¸åŒºåˆ«å¤§å°å†™ï¼Œå¯å…è®¸ä¾èµ–äºå®ç°çš„åœ¨ @samp{nan} åçš„é¢å¤–å­—ç¬¦ï¼Œä¹Ÿå…è®¸ @samp{inf} æˆ–è€… @samp{infinity}ã€‚
@end itemize

ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯è¿™ä¸¤ä¸ªç›¸æ¯”äºå†å²å®è·µéƒ½æœ‰æ˜ç¡®çš„æ”¹å˜ï¼š

@itemize @value{BULLET}
@item
@command{gawk} çš„ç»´æŠ¤è€…æ„Ÿè§‰ï¼Œæ”¯æŒåå…­è¿›åˆ¶çš„æµ®ç‚¹æ•°ï¼Œç›¸å½“çš„ä¸‘ï¼Œä»æ¥æ²¡æœ‰è¢«æœ€åˆçš„å®ç°è€…æ¥å—ä¸ºè¯­è¨€çš„ä¸€éƒ¨åˆ†ã€‚

@item
å®Œå…¨å…è®¸å­—æ¯ä¸²æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„æ•°å€¼ä¹Ÿä¸å†å²å®è·µæœ‰ç€ä¸¥é‡çš„åˆ†ç¦»ã€‚
@end itemize

ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ @command{gawk} çš„ç»´æŠ¤è€…è§‰å¾—ï¼Œå¯¹äºæ ‡å‡†çš„è¿™ç§è§£é‡Šï¼Œéœ€è¦å¤§é‡çš„â€œè¯­è¨€ç«‹æ³•â€æ¥è¾¾åˆ°ç¬¬ä¸€ä¸ªç›®æ ‡ï¼Œè¿™ç”šè‡³ä¹Ÿä¸è¢«æ ‡å‡†çš„å¼€å‘è€…é¢„æ–™åˆ°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œâ€œæˆ‘ä»¬çœ‹åˆ°äº†ä½ æ€ä¹ˆæ¥çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸è®¤ä¸ºé‚£å°±æ˜¯ä½ æƒ³è¦å»çš„åœ°æ–¹ã€‚â€

ç”±äºå‘ç°äº†è¿™æ ·çš„é—®é¢˜ï¼Œä½œä¸ºæä¾›ä¸€ä¸ªä¸æ—©æœŸæ ‡å‡†ç‰ˆæœ¬å…¼å®¹çš„å°è¯•ï¼Œåœ¨ 2008 å¹´çš„ POSIX æ ‡å‡†æ·»åŠ äº†ä¸€ä¸ªæ˜¾å¼çš„è¯æ¥å…è®¸ï¼Œä½†æ˜¯ä¸æ˜¯å¿…é¡»ï¼Œ@command{awk} æ”¯æŒåå…­è¿›åˆ¶çš„æµ®ç‚¹æ•°å€¼ä»¥åŠé’ˆå¯¹ â€œnot a numberâ€ä¸‹æ— ç©·çš„ç‰¹æ®Šå€¼ã€‚

å°½ç®¡ @command{gawk} çš„ç»´æŠ¤è€…ä»ç„¶è§‰å¾—æä¾›è¿™æ ·çš„ç‰¹æ€§æ˜¯ä¸è¢«å»ºè®®çš„ï¼Œä½†æ˜¯ï¼Œåœ¨æ”¯æŒ IEEE æµ®ç‚¹æ•°çš„ç³»ç»Ÿä¸Šï¼Œæä¾›@emph{æŸäº›}é€”å¾„æ¥æ”¯æŒ NaN ä¸æ— ç©·å€¼å´æ˜¯åˆç†çš„ã€‚@command{gawk} çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š

@itemize @value{BULLET}
@item
å¦‚æœæœ‰ @option{--posix} å‘½ä»¤è¡Œé€‰é¡¹ï¼Œåˆ™ @command{gawk} ä¼šæ¾æ‰‹ä¸ç®¡ã€‚å­—ä¸²å€¼ä¼šè¢«ç›´æ¥ä¼ é€’ç»˜ç”»ç³»ç»Ÿçš„åº“å‡½æ•° @code{strtod()} å‡½æ•°ï¼Œå¦‚æœæˆåŠŸåœ°è¿”å›äº†æ•°å€¼å€¼ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«å½“åšæ•°å€¼ä½¿ç”¨ã€‚ 
@footnote{è‡ªä½œè‡ªå—ã€‚}
æ ¹æ®å®šä¹‰ï¼Œç»“æœåœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šæ˜¯ä¸å¯ç§»æ¤çš„ã€‚è€Œä¸”ä¹Ÿæœ‰ä¸€äº›å°çš„ä»¤äººæƒŠå¥‡çš„è¡Œä¸ºï¼š

@example
$ @kbd{echo nanny | gawk --posix '@{ print $1 + 0 @}'}
@print{} nan
$ @kbd{echo 0xDeadBeef | gawk --posix '@{ print $1 + 0 @}'}
@print{} 3735928559
@end example

@item
å¦‚æœæ²¡æœ‰ @option{--posix} é€‰é¡¹ï¼Œ@command{gawk} ä¼šå°†åé¢çš„å­—ä¸²å€¼ @samp{+inf}ï¼Œ@samp{-inf}ï¼Œ@samp{+nan} ä¸ @samp{-nan} ä½œç‰¹åˆ«çš„è§£é‡Šï¼Œå¹¶äº§ç”Ÿç›¸åº”çš„ç‰¹æ®Šçš„æ•°å€¼ã€‚å‰å¯¼çš„ç¬¦å·ä¼šè¢«å½“æˆå‘é€ç»˜ç”» @command{gawk} ï¼ˆä»¥åŠç”¨æˆ·ï¼‰çš„ä¿¡å·è¯´ï¼Œè¿™ç¡®å®æ˜¯ä¸ªæ•°å€¼ã€‚åå…­è¿›åˆ¶æµ®ç‚¹æ•°æ˜¯ä¸å—æ”¯æŒçš„ï¼ˆé™¤éä½ ä¹Ÿä½¿ç”¨äº† @option{--non-decimal-data} é€‰é¡¹ï¼Œä½†æˆ‘ä»¬@emph{ä¸}å»ºè®®ï¼‰ã€‚ä¾‹å¦‚ï¼š

@example
$ @kbd{echo nanny | gawk '@{ print $1 + 0 @}'}
@print{} 0
$ @kbd{echo +nan | gawk '@{ print $1 + 0 @}'}
@print{} nan
$ @kbd{echo 0xDeadBeef | gawk '@{ print $1 + 0 @}'}
@print{} 0
@end example

@command{gawk} å¯¹è¿™å››ä¸ªå€¼ä¸åŒºåˆ†å¤§å°å†™ã€‚å› æ­¤ @samp{+nan} ä¸ @samp{+NaN} æ˜¯ä¸€æ ·çš„ã€‚
@end itemize

@node Floating point summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
å¤§å¤šæ•°çš„è®¡ç®—æœºç®—æœ¯è¿ç®—æ˜¯é€šè¿‡æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°æ¥å®Œæˆçš„ã€‚æ ‡å‡†çš„ @command{awk} ä½¿ç”¨åŒç²¾åº¦æµ®ç‚¹æ•°æ•°å€¼ã€‚

@item
åœ¨ 1990 å¹´ä»£æ—©æœŸï¼ŒBarbie ä¸æ­£ç¡®åœ°è¯´è¿‡ï¼Œâ€œæ•°å­¦çœŸéš¾ï¼â€è™½ç„¶æ•°å­¦ä¸éš¾ï¼Œä½†æ˜¯æµ®ç‚¹æ•°è¿ç®—å¹¶ä¸åƒâ€œçº¸ç¬”â€æ•°å­¦ä¸€æ ·ï¼Œè€Œå¿…é¡»ä»”ç»†å¤„ç†ï¼š

@c nested list
@itemize @value{MINUS}
@item
å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°éƒ½å¯ä»¥è¢«ç²¾ç¡®è¡¨ç¤ºã€‚

@item
å€¼çš„æ¯”è¾ƒåº”è¯¥ä½¿ç”¨å·®åˆ«ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ @samp{==} ä¸ @samp{!=}ã€‚

@item
é”™è¯¯ä¼šç´¯ç§¯ã€‚

@item
æ“ä½œå¹¶ä¸æ€»æ˜¯å…³è”ä¸åˆ†å¸ƒçš„ã€‚
@end itemize

@item
æä¾›ç²¾åº¦æœ‰ç”¨ï¼Œä½†å¹¶ä¸æ€»æ˜¯æˆèƒ½è¯ã€‚

@item
æå‡ç²¾åº¦ç„¶åèˆå…¥èˆå‡ºåˆ°ä¸€ä¸ªéœ€è¦çš„æ•°å€¼ä½ä»¥äº§ç”Ÿåˆç†çš„ç»“æœã€‚

@item
ä½¿ç”¨ @option{-M}ï¼ˆæˆ–è€… @option{--bignum}ï¼‰æ¥ä½¿ç”¨ MPFR ç®—æœ¯ã€‚ä½¿ç”¨ @code{PREC} æ¥è®¾ç½®ç²¾åº¦ä½ï¼Œä»¥åŠè®¾ç½® @code{ROUNDMODE} æ¥è®¾ç½® IEEE 754 çš„èˆå…¥èˆå‡ºæ¨¡å¼ã€‚

@item
é€šè¿‡ @option{-M}ï¼Œ@command{gawk} ä¼šä½¿ç”¨ GMP åº“æ‰§è¡Œä»»æ„ç²¾åº¦çš„æ•´æ•°ç®—æœ¯è¿ç®—ã€‚è¿™æ¯” MPFR æ‰§è¡Œç›¸åŒçš„è®¡ç®—ä¼šæ›´å¿«ï¼Œåœ¨ç©ºé—´ä¸Šæ›´é«˜æ•ˆã€‚

@item
@command{gawk} åœ¨å¤„ç†æµ®ç‚¹æ•°ä¸Šæœ‰å‡ ä¸ªæ–¹é¢ä¸ POSIX æ ‡å‡†ä¸åŒã€‚æœ‰å¿…è¦æ³¨æ„ã€‚

@item
æ€»ä½“ä¸Šçœ‹ï¼Œæ²¡æœ‰å¿…è¦è¿‡åº¦åœ°æ€€ç–‘æµ®ç‚¹æ•°è¿ç®—çš„ç»“æœã€‚è¦è®°ä½çš„æ•™è®­æ˜¯æµ®ç‚¹æ•°è¿ç®—è¦æ¯”çº¸ç¬”ä¸Šè¿›è¡Œè¿ç®—è¦æ›´å¤æ‚ã€‚ä¸ºäº†å……åˆ†åˆ©ç”¨æµ®ç‚¹æ•°è¿ç®—çš„ä¼˜åŠ¿ï¼Œä½ éœ€è¦çŸ¥é“å®ƒçš„é™åˆ¶æ¥ä½¿ç”¨å®ƒä»¬æ¥å·¥ä½œã€‚å¯¹äºå¤§å¤šæ•°çš„æµ®ç‚¹ç®—æœ¯è¿ç®—ï¼Œå¦‚æœä½ ç®€å•åœ°èˆå…¥èˆå‡ºæ¥æ˜¾ç¤ºä½ çš„ç»“æœåˆ°æ­£ç¡®çš„åè¿›åˆ¶æœ‰æ•ˆä½ï¼Œä½ éƒ½å¯ä»¥å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚

@item
ä½œä¸ºä¸€èˆ¬å»ºè®®ï¼Œé¿å…ä»¥éšå¼çš„æ¯”å®é™…æ›´é«˜ç²¾åº¦æ¥è¡¨ç¤ºä¸€ä¸ªæ•°æ®ã€‚

@end itemize

@node Dynamic Extensions
@chapter ç¼–å†™ @command{gawk} æ‰©å±•
@cindex dynamically loaded extensions

ä½¿ç”¨åŠ¨æ€è£…è½½çš„åº“ï¼Œå¯ä»¥ç”¨ C æˆ–è€… C++ ä¸º @command{gawk} ç¼–å†™æ–°çš„åŠŸèƒ½ã€‚è¿™æ ·çš„å·¥å…·åœ¨æ”¯æŒ C çš„ @code{dlopen()} ä¸ @code{dlsym()} å‡½æ•°çš„ç³»ç»Ÿä¸Šæ˜¯å¯ç”¨çš„ã€‚æœ¬@value{CHAPTER}ä¼šæè¿°å¦‚ä½•ç”¨ C ä¸ C++ çš„ä»£ç æ¥åˆ›å»ºæ‰©å±•ã€‚

å¦‚æœä½ ä¸äº†è§£ C ç¼–ç¨‹ï¼Œä½ å¯ä»¥è·³è¿‡è¿™ä¸€@value{CHAPTER}ï¼Œä½ å¯ä»¥æŸ¥çœ‹éš @command{gawk} ä¸€èµ·å‘å¸ƒçš„æ‰©å±•æ–‡ä»¶ï¼ˆæŸ¥çœ‹ @pxref{Extension Samples}ï¼‰ï¼Œä¹Ÿå¯äº†è§£ @code{gawkextlib} é¡¹ç›®çš„ä¿¡æ¯ï¼ˆæŸ¥çœ‹ @pxref{gawkextlib}ï¼‰ã€‚ä¾‹å­æ‰©å±•ä¼šä¸ @command{gawk} ä¸€èµ·è¿›è¡Œæ„å»ºå¹¶å®‰è£…ã€‚

@quotation æç¤º
å½“ä½¿ç”¨ @option{--sandbox} é€‰é¡¹æ—¶ï¼Œæ‰©å±•ä¼šè¢«ç¦ç”¨ï¼ˆæŸ¥çœ‹ @ref{Options}ï¼‰ã€‚
@end quotation

@menu
* Extension Intro::             What is an extension.
* Plugin License::              A note about licensing.
* Extension Mechanism Outline:: An outline of how it works.
* Extension API Description::   A full description of the API.
* Finding Extensions::          How @command{gawk} finds compiled extensions.
* Extension Example::           Example C code for an extension.
* Extension Samples::           The sample extensions that ship with
                                @command{gawk}.
* gawkextlib::                  The @code{gawkextlib} project.
* Extension summary::           Extension summary.
* Extension Exercises::         Exercises.
@end menu

@node Extension Intro
@section ä»‹ç»

@cindex plug-in
@dfn{æ‰©å±•}ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸º@dfn{æ’ä»¶}ï¼‰æ˜¯ä¸€å—å¤–éƒ¨ç¼–è¯‘çš„ä»£ç ï¼Œ@command{gawk} å¯ä»¥åœ¨è¿è¡Œæ—¶è£…è½½æ¥æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œå®ƒä»¬å»ºç«‹åœ¨æœ¬@value{DOCUMENT}ä¸­æ‰€æè¿°çš„å†…å»ºèƒ½åŠ›ä¹‹ä¸Šã€‚

æ‰©å±•éå¸¸æœ‰ç”¨ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥è®©ä½ ï¼ˆè¿™æ¯«æ— ç–‘é—®ï¼‰æ¥æ‰©å±• @command{gawk} çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬å¯ä»¥æä¾›è®¿é—®ç³»ç»Ÿè°ƒç”¨çš„èƒ½åŠ›ï¼ˆæ¯”å¦‚ @code{chdir()} æ¥æ›´æ”¹ç›®å½•ï¼‰ä»¥åŠå…¶ä»–çš„å¯ç”¨çš„ C åº“ä¾‹ç¨‹ã€‚å¦‚å¤§å¤šæ•°çš„è½¯ä»¶â€œå¤©ç©ºæ‰æ˜¯é™åˆ¶â€ï¼Œå¦‚æœä½ æƒ³åˆ°æŸäº›äº‹æƒ…ï¼Œä½ å¯ä»¥é€šè¿‡ C æˆ–è€… C++ ä»£ç æ¥å®ç°ï¼Œä½ å°±å¯ä»¥å†™ä¸€ä¸ªæ‰©å±•æ¥å®ç°ä»–ã€‚

æ‰©å±•é€šè¿‡ C æˆ–è€… C++ å†™æˆï¼Œå¹¶åˆ©ç”¨ä¸ºæ­¤ç›®çš„è€Œå‘ @command{gawk} å¼€å‘è€…æä¾›çš„@dfn{åº”ç”¨ç¨‹åºæ¥å£}ï¼ˆAPIï¼‰æ¥å®ç°ã€‚æœ¬@value{CHAPTER}ä¸­çš„å…¶ä»–éƒ¨åˆ†è§£é‡Š API å·¥å…·ä»¥åŠå¦‚ä½•æ¥ä½¿ç”¨å®ƒä»¬ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå°çš„æ‰©å±•ä¾‹å­ã€‚å¦å¤–ï¼Œä¾‹å­æ‰©å±•ç¨‹åºä¹ŸåŒ…å«åœ¨äº† @command{gawk} çš„å‘å¸ƒç‰ˆæœ¬ä¸­ï¼Œå¹¶å¯¹ @code{gawkextlib} è¿›è¡Œæè¿°ã€‚
@ifclear FOR_PRINT
æŸ¥çœ‹ @ref{Extension Design}ï¼Œæ¥è·å–æ‰©å±•æœºåˆ¶çš„ç›®æ ‡ä¸è®¾è®¡çš„æ›´å¤šè®¨è®ºã€‚
@end ifclear
@ifset FOR_PRINT
æŸ¥çœ‹ @uref{http://www.gnu.org/software/gawk/manual/html_node/Extension-Design.html}ï¼Œæ¥è·å–æ‰©å±•æœºåˆ¶çš„ç›®æ ‡ä¸è®¾è®¡çš„æ›´å¤šè®¨è®ºã€‚
@end ifset

@node Plugin License
@section æ‰©å±•è®¸å¯

æ¯ä¸ªåŠ¨æ€çš„æ‰©å±•å¿…é¡»åœ¨ä¸ GNU GPLï¼ˆæŸ¥çœ‹ @pxref{Copying}ï¼‰å…¼å®¹çš„è®¸å¯ä¸‹å‘å¸ƒã€‚

ä¸ºäº†è®©æ‰©å±•å‘ŠçŸ¥ @command{gawk} å®ƒæ˜¯æœ‰é€‚å½“çš„è®¸å¯çš„ï¼Œæ‰©å±•å¿…é¡»å®šä¹‰ä¸€ä¸ªå…¨å±€ç¬¦å· @code{plugin_is_GPL_compatible}ã€‚å¦‚æœè¿™ä¸ªç¬¦å·ä¸å­˜åœ¨ï¼Œåœ¨æ‰©å±•è¢«è£…è½½æ—¶ï¼Œ@command{gawk} ä¼šå‘é€ä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼Œå¹¶é€€å‡ºã€‚

ç¬¦å·çš„å£°æ˜ç±»å‹ä¸º @code{int}ã€‚å®ƒæ²¡æœ‰å¿…è¦ä¸€å®šè¦åœ¨æŸä¸ªæ®µä¸­ã€‚ä»£ç ä»…ä»…æ˜¯æ–­è¨€ç¬¦å·åœ¨å…¨å±€èŒƒå›´å†…å­˜åœ¨å³å¯ã€‚åƒä¸‹é¢è¿™æ ·å°±è¶³å¤Ÿäº†ï¼š

@example
int plugin_is_GPL_compatible;
@end example

@node Extension Mechanism Outline
@section åœ¨é«˜å±‚çº§ä¸­æ˜¯å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„

@command{gawk} ä¸ æ‰©å±•ä¹‹é—´çš„é€šä¿¡æ˜¯åŒå‘çš„ã€‚é¦–å…ˆï¼Œå½“æ‰©å±•è¢«è£…è½½ï¼Œ@command{gawk} ä¼šå‘å®ƒä¼ é€’ä¸€ä¸ªç»“æ„ä½“ @code{struct} çš„æŒ‡é’ˆï¼Œç»“æ„ä½“ä¸­éƒ½æ˜¯å‡½æ•°æŒ‡é’ˆã€‚
@ifnotdocbook
å¦‚ @ref{figure-load-extension} æ‰€ç¤ºï¼š
@end ifnotdocbook
@ifdocbook
å¦‚ @inlineraw{docbook, <xref linkend="figure-load-extension"/>} æ‰€ç¤ºï¼š
@end ifdocbook

@ifnotdocbook
@float Figure,figure-load-extension
@caption{è£…è½½æ‰©å±•}
@center @image{api-figure1, , , Loading the extension}
@end float
@end ifnotdocbook

@docbook
<figure id="figure-load-extension" float="0">
<title>è£…è½½æ‰©å±•</title>
<mediaobject>
<imageobject role="web"><imagedata fileref="api-figure1.png" format="PNG"/></imageobject>
</mediaobject>
</figure>
@end docbook

æ‰©å±•é€šè¿‡è¿™äº›æŒ‡é’ˆå‡½æ•°æ¥è°ƒç”¨ @command{gawk} ä¸­çš„å‡½æ•°ï¼Œå¹¶ä¸”æ˜¯åœ¨è¿è¡Œæ—¶è°ƒç”¨ï¼Œè€Œæ— é¡»ï¼ˆåœ¨è¿æ¥æ—¶ï¼‰è®¿é—® @command{gawk} çš„ç¬¦å·ã€‚è¿™äº›å‡½æ•°æŒ‡é’ˆä¸­çš„ä¸€ä¸ªæ˜¯ç”¨æ¥â€œæ³¨å†Œâ€æ–°åŠŸèƒ½çš„å‡½æ•°ã€‚
@ifnotdocbook
å¦‚ @ref{figure-register-new-function} æ‰€ç¤ºï¼š
@end ifnotdocbook
@ifdocbook
å¦‚ @inlineraw{docbook, <xref linkend="figure-register-new-function"/>} æ‰€ç¤ºï¼š
@end ifdocbook

@ifnotdocbook
@float Figure,figure-register-new-function
@caption{æ³¨å†Œæ–°å‡½æ•°}
@center @image{api-figure2, , , Registering a new Function}
@end float
@end ifnotdocbook

@docbook
<figure id="figure-register-new-function" float="0">
<title>æ³¨å†Œæ–°å‡½æ•°</title>
<mediaobject>
<imageobject role="web"><imagedata fileref="api-figure2.png" format="PNG"/></imageobject>
</mediaobject>
</figure>
@end docbook

åœ¨å¦ä¸€ä¸ªæ–¹å‘ï¼Œæ‰©å±•æ³¨å†Œå®ƒçš„æ–°å‡½æ•°æ˜¯å‘ @command{gawk} ä¼ é€’å‡½æ•°çš„æŒ‡é’ˆï¼Œè¿™ä¸ªå‡½æ•°æä¾›äº†æ–°çš„ç‰¹æ€§ï¼ˆæ¯”å¦‚ @code{do_chdir()}ï¼‰ã€‚@command{gawk} å°†è¿™ä¸ªå‡½æ•°æŒ‡é’ˆä¸ä¸€ä¸ªåå­—å…³è”ï¼Œç„¶åä½¿ç”¨å®šä¹‰å¥½çš„è°ƒç”¨è§„èŒƒæ¥è°ƒç”¨å®ƒã€‚
@ifnotdocbook
å¦‚åœ¨ @ref{figure-call-new-function} æ‰€ç¤ºï¼š
@end ifnotdocbook
@ifdocbook
å¦‚åœ¨ @inlineraw{docbook, <xref linkend="figure-call-new-function"/>} æ‰€ç¤ºï¼š
@end ifdocbook

@ifnotdocbook
@float Figure,figure-call-new-function
@caption{è°ƒç”¨æ–°å‡½æ•°}
@center @image{api-figure3, , , Calling the new function}
@end float
@end ifnotdocbook

@docbook
<figure id="figure-call-new-function" float="0">
<title>è°ƒç”¨æ–°å‡½æ•°</title>
<mediaobject>
<imageobject role="web"><imagedata fileref="api-figure3.png" format="PNG"/></imageobject>
</mediaobject>
</figure>
@end docbook

æ¥ä¸‹æ¥ @code{do_@var{xxx}()} å‡½æ•°ä½¿ç”¨ API ç»“æ„ä½“ @code{struct} ä¸­çš„å‡½æ•°æŒ‡é’ˆæ¥å®ç°å®ƒçš„åŠŸèƒ½ï¼Œå¦‚æ›´æ–°å˜é‡æˆ–è€…æ•°ç»„ï¼Œæ‰“å°ä¿¡æ¯ï¼Œè®¾ç½® @code{ERRNO} ç­‰ç­‰ã€‚

æ–¹ä¾¿çš„å®å¯ä»¥ä½¿ç”¨é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨çœ‹èµ·æ¥åƒå¸¸è§„çš„å‡½æ•°è°ƒç”¨ä¸€æ ·ï¼Œè¿™æ ·æ‰©å±•ä»£ç éå¸¸å¥½è¯»ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ã€‚

å°½ç®¡è¿™å¬èµ·æ¥æœ‰ä¸€äº›å¤æ‚ï¼Œè€Œç»“æœæ˜¯æ‰©å±•çš„ä»£ç ç¼–å†™ä¸é˜…è¯»éƒ½éå¸¸ç›´æ¥ã€‚ä½ å¯ä»¥æŸ¥çœ‹æ ·ä¾‹æ‰©å±• @file{filefuncs.c}ï¼ˆæŸ¥çœ‹ @pxref{Extension
Example}ï¼‰ä»¥åŠ @file{testext.c} ä»£ç æ¥æµ‹è¯• APIsã€‚

ä¸€äº›å…¶ä»–çš„æ‚é¡¹ï¼š

@itemize @value{BULLET}
@item
API æä¾›äº†è®¿é—® @command{gawk} çš„ @code{do_@var{xxx}} å€¼çš„æ–¹å¼ï¼Œä»¥æ­¤æ¥ååº”å‘½ä»¤è¡Œå‚æ•°ï¼Œå¦‚ @code{do_lint}ï¼Œ@code{do_profiling} ç­‰ç­‰ï¼ˆæŸ¥çœ‹ @pxref{Extension API Variables}ï¼‰ã€‚è€Œä¸‹é¢æä¾›ç›¸å…³ä¿¡æ¯ï¼šæ‰©å±•ä¸å¯ä»¥æ”¹å˜å®ƒä»¬åœ¨ @command{gawk} ä¸­çš„å€¼ã€‚å¦å¤–ï¼Œå°è¯•ç»˜ç»™å®ƒä»¬èµ‹å€¼ä¼šäº§ç”Ÿä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚

@item
API ä¹Ÿæä¾›äº†ä¸»æ¬¡ç‰ˆæœ¬å·ï¼Œè¿™æ ·æ‰©å±•å¯ä»¥æ¥æ£€æŸ¥è£…è½½æ‰©å±•çš„ @command{gawk} çš„ç‰ˆæœ¬æ˜¯å¦æ”¯æŒå…¶è¢«ç¼–è¯‘æ—¶çš„æ‰€éœ€è¦çš„åŠŸèƒ½ã€‚ï¼ˆç‰ˆæœ¬ä¸åŒ¹é…â€œä¸åº”è¯¥â€å‘ç”Ÿï¼Œä½†æ˜¯æˆ‘ä»¬æ‰€æœ‰äººéƒ½çŸ¥é“@emph{äº‹æƒ…}æ€ä¹ˆå‘ç”Ÿçš„ã€‚ï¼‰æŸ¥çœ‹ @ref{Extension Versioning}ï¼Œæ¥è·å–ç›¸å…³ç»†èŠ‚ã€‚
@end itemize

@node Extension API Description
@section API æè¿°
@cindex extension API

C æˆ–è€… C++ æ‰€å†™çš„æ‰©å±•å¿…é¡»åŒ…å«å¤´æ–‡ä»¶ @file{gawkapi.h}ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å£°æ˜å‡½æ•°ï¼Œå¹¶ä¸”å®šä¹‰äº†ä¸ @command{gawk} è¿›è¡Œé€šä¿¡çš„æ•°ç»„ç±»å‹ã€‚è¿™ï¼ˆç›¸å½“å¤§çš„ï¼‰@value{SECTION}ï¼Œè¯¦ç»†åœ°æè¿°äº†è¿™äº› APIã€‚

@menu
* Extension API Functions Introduction:: Introduction to the API functions.
* General Data Types::                   The data types.
* Memory Allocation Functions::          Functions for allocating memory.
* Constructor Functions::                Functions for creating values.
* Registration Functions::               Functions to register things with
                                         @command{gawk}.
* Printing Messages::                    Functions for printing messages.
* Updating @code{ERRNO}::                Functions for updating @code{ERRNO}.
* Requesting Values::                    How to get a value.
* Accessing Parameters::                 Functions for accessing parameters.
* Symbol Table Access::                  Functions for accessing global
                                         variables.
* Array Manipulation::                   Functions for working with arrays.
* Extension API Variables::              Variables provided by the API.
* Extension API Boilerplate::            Boilerplate code for using the API.
@end menu

@node Extension API Functions Introduction
@subsection ä»‹ç»

è®¿é—® @command{gawk} çš„å·¥å…·æ˜¯é€šè¿‡è°ƒç”¨ä¼ é€’åˆ°ä½ çš„æ‰©å±•çš„å‡½æ•°æŒ‡é’ˆæ¥å®Œæˆçš„ã€‚

API å‡½æ•°æŒ‡é’ˆæä¾›äº†ä¸‹é¢ç±»å‹çš„æ“ä½œï¼š

@itemize @value{BULLET}
@item
åˆ†é…ï¼Œé‡æ–°åˆ†é…ä»¥åŠé‡Šæ”¾å†…å­˜ã€‚

@item
æ³¨å†Œå‡½æ•°ï¼Œæœ‰å¦‚ä¸‹ï¼š

@c nested list
@itemize @value{MINUS}
@item
æ‰©å±•å‡½æ•°
@item
é€€å‡ºå›è°ƒå‡½æ•°
@item
ç‰ˆæœ¬å­—ä¸²
@item
è¾“å…¥åˆ†æå™¨
@item
è¾“å‡ºåŒ…è£…å™¨
@item
åŒè·¯å¤„ç†å™¨
@end itemize

æ‰€æœ‰çš„è¿™äº›éƒ½ä¼šåœ¨æœ¬@value{CHAPTER}ä¸­çš„å‰©ä½™éƒ¨è¿›è¡Œè¯¦ç»†çš„è®¨è®ºã€‚

@item
æ‰“å°è‡´å‘½é”™è¯¯ï¼Œå‘Šè­¦ä»¥åŠâ€œlintâ€è­¦å‘Šä¿¡æ¯ã€‚

@item
æ›´æ–° @code{ERRNO}ï¼Œæˆ–è€…é‡ç½®å®ƒã€‚

@item
è®¿é—®å‚æ•°ï¼ŒåŒ…æ‹¬å°†æœªå®šä¹‰çš„å‚æ•°è½¬æ¢ä¸ºæ•°ç»„ã€‚

@item
ç¬¦å·è¡¨è®¿é—®ï¼šè¿”å›å…¨å±€å˜é‡ï¼Œåˆå»ºæˆ–è€…æ›´æ”¹å…¨å±€å˜é‡ã€‚

@item
åˆ›å»ºï¼Œé‡Šæ”¾ç¼“å­˜å€¼ï¼Œè¿™æä¾›äº†ä¸€ç§é«˜æ•ˆè®¿é—®å¤šä¸ªå˜é‡çš„æ–¹å¼ï¼Œå¯èƒ½æå¤§åœ°æä¾›æ€§èƒ½ã€‚

@item
æ•°ç»„æ“ä½œï¼š

@itemize @value{MINUS}
@item
æ£€ç´¢ï¼Œæ·»åŠ ï¼Œåˆ é™¤ä»¥åŠä¿®æ”¹å…ƒç´ ã€‚

@item
è·å–æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚

@item
åˆ›å»ºæ–°æ•°ç»„ã€‚

@item
æ¸…é™¤æ•°ç»„ã€‚

@item
æ‰å¹³åŒ–æ•°ç»„ï¼Œä½¿ç”¨ä»¥ä½¿ç”¨ç®€å•çš„ C é£æ ¼çš„å¾ªç¯æ¥è¿­ä»£æ‰€æœ‰çš„ç´¢å¼•ä»¥åŠå…ƒç´ ã€‚
@end itemize
@end itemize

ä½¿ç”¨ API çš„ä¸€äº›ç‚¹ï¼š

@itemize @value{BULLET}
@item
ä¸‹é¢çš„ç±»å‹ï¼Œå®ï¼Œä»¥åŠ/æˆ–è€…å‡½æ•°å¯ä»¥åœ¨ @file{gawkapi.h} æ–‡ä»¶å‚è€ƒã€‚ä¸ºäº†æ­£ç¡®ä½¿ç”¨ï¼Œä½ å¿…é¡»åœ¨åŒ…å« @file{gawkapi.h} @emph{å‰}åŒ…å«ç›¸åº”çš„æ ‡å‡†å¤´æ–‡ä»¶ã€‚

@c FIXME: Make this is a float at some point.
@multitable {@code{memset()}, @code{memcpy()}} {@code{<sys/types.h>}}
@headitem C entity @tab Header file
@item @code{EOF} @tab @code{<stdio.h>}
@item Values for @code{errno} @tab @code{<errno.h>}
@item @code{FILE} @tab @code{<stdio.h>}
@item @code{NULL} @tab @code{<stddef.h>}
@item @code{memcpy()} @tab @code{<string.h>}
@item @code{memset()} @tab @code{<string.h>}
@item @code{size_t} @tab @code{<sys/types.h>}
@item @code{struct stat} @tab @code{<sys/stat.h>}
@end multitable

ç”±äºè€ƒè™‘åˆ°å¯ç§»æ¤æ€§ï¼Œç‰¹åˆ«æ˜¯é‚£äº›æ²¡æœ‰å®Œå…¨ä¸æ ‡å‡†å…¼å®¹çš„ç³»ç»Ÿï¼Œä½ éœ€è¦ä»¥æ­£ç¡®çš„æ–¹å¼åŒ…å«æ­£ç¡®çš„æ–‡ä»¶ã€‚ä¸ºäº†ä¿è¯ @file{gawkapi.h} çš„ç®€å•æ¸…æ¥šï¼Œè¿™ä¸ªè¦æ±‚æ˜¯å¾ˆå¿…è¦çš„ï¼Œè¿™æ ·ä¸ä¼šæˆä¸ºå¯ç§»æ¤æ€§çš„å¤§æ‚çƒ©ï¼Œè€Œè¿™ä¼šåœ¨éƒ¨åˆ†çš„ @command{gawk} æºä»£ç ä¸­çœ‹åˆ°ã€‚

@item
@file{gawkapi.h} æ–‡ä»¶å¯ä»¥è¢«åŒ…å«å¤šæ¬¡ï¼Œè€Œä¸ä¼šäº§ç”Ÿä¸å¥½çš„ç»“æœã€‚åªæ˜¯è¿™ä¹ˆåšæ˜¯ä¸ªå¾ˆä¸å¥½çš„ç¼–ç¨‹å®è·µã€‚

@item
å°½ç®¡ API åªä½¿ç”¨ ISO C 90 çš„ç‰¹æ€§ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå³â€œæ„é€ â€å‡½æ•°ä½¿ç”¨ @code{inline} å…³é”®è¯ã€‚å¦‚æœä½ çš„ç¼–è¯‘å™¨ä¸æ”¯æŒè¿™ä¸ªå…³é”®è¯ï¼Œä½ è¦ä¹ˆåœ¨å‘½ä»¤è¡Œä¸­åŠ å…¥ @samp{-Dinline=''}ï¼Œæˆ–è€…ä½¿ç”¨ GNU çš„ Autotools å¹¶åœ¨ä½ çš„æ‰©å±•ä¸­åŒ…å«ä¸€ä¸ª @file{config.h} æ–‡ä»¶ã€‚

@item
æ‰€æœ‰çš„åœ¨ @command{gawk} å¡«å……çš„æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ï¼Œéƒ½ç”± @command{gawk} ç®¡ç†ï¼Œåº”è¯¥è¢«ä½ çš„æ‰©å±•çœ‹æˆæ˜¯åªè¯»çš„ã€‚ä»æ‰©å±•ä¸­ä¼ é€’åˆ° @command{gawk} ä¸­çš„@emph{æ‰€æœ‰}å­—ä¸²å†…å­˜ï¼Œ@emph{å¿…é¡»}ä½¿ç”¨ @code{gawk_malloc()}ï¼Œ@code{gawk_calloc()} æˆ–è€… @code{gawk_realloc()} è°ƒç”¨è·å–ï¼Œå¹¶ä»é‚£ä»¥åï¼Œç”± @command{gawk} è¿›è¡Œç®¡ç†ã€‚

@item
API å®šä¹‰äº†å‡ ä¸ªç®€å•çš„ç»“æ„ä½“ @code{struct} ç”¨æ¥å½±å°„ @command{awk} çœ‹åˆ°çš„å€¼ã€‚å€¼å¯ä»¥æ˜¯ @code{double} ç±»å‹ï¼Œæˆ–è€…å­—ä¸²ï¼Œæˆ–è€…æ˜¯æ•°ç»„ï¼ˆå¦‚å¤šç»´æ•°ç»„ï¼Œæˆ–è€…åˆ›å»ºæ–°æ•°ç»„æ—¶ï¼‰ã€‚å­—ä¸²å€¼é€šè¿‡æŒ‡é’ˆä¸é•¿åº¦æ¥ç®¡ç†ï¼Œå› æ­¤å†…åµŒçš„ @sc{nul} å­—ç¬¦ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚

@quotation æç¤º
ä»ç›®çš„ä¸Šè®²ï¼Œå­—ä¸²ä½¿ç”¨å½“å‰çš„å¤šå­—èŠ‚ç¼–ç æ¥ç»´æŠ¤ï¼ˆå¦‚ @env{LC_@var{xxx}} ç¯å¢ƒå˜é‡å®šä¹‰çš„ï¼‰è€Œä¸æ˜¯ä½¿ç”¨å®½å­—ç¬¦ã€‚è¿™ä¸ªä¸ @command{gawk} å†…éƒ¨å­˜å‚¨å­—ä¸²æ˜¯åŒ¹é…çš„ï¼Œå­—ç¬¦ä¹Ÿå¯èƒ½æ˜¯è¿™ä¹ˆä»æ–‡ä»¶è¯»å–æˆ–è€…è¾“å‡ºåˆ°æ–‡ä»¶çš„ã€‚
@end quotation

@item
å½“æ”¶åˆ°ä¸€ä¸ªå€¼ï¼ˆå¦‚å‚æ•°æˆ–è€…å…¨å±€å˜é‡ï¼Œæˆ–è€…æ•°ç»„å…ƒç´ ï¼‰ï¼Œæ‰©å±•éœ€è¦è¯·ç¤ºä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼ˆæ•°å€¼ï¼Œå­—ä¸²ï¼Œæ ‡é‡ï¼Œå€¼çš„Cookieï¼Œæ•°ç»„ï¼Œæˆ–è€…â€œæœªå®šä¹‰â€ï¼‰ã€‚å½“è¯·æ±‚ä¸ºâ€œæœªå®šä¹‰â€æ—¶ï¼Œè¿”å›çš„å€¼æ˜¯ä¼šæœ‰çœŸæ­£çš„åº•å±‚ç±»å‹çš„ã€‚

ä½†æ˜¯ï¼Œå¦‚æœè¯·æ±‚çš„ç±»å‹ä¸å®é™…çš„ç±»å‹ä¸åŒ¹é…ï¼Œè¯»å–å‡½æ•°ä¼šè¿”å›â€œfalseâ€ï¼Œå¹¶åœ¨ type ç±»å‹é‡Œå¡«ä¸Šå€¼å®é™…çš„ç±»å‹ï¼Œè¿™æ ·æ‰©å±•å¯ä»¥æ‰“å°é”™è¯¯çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚ â€œscalar passed where array expectedâ€ï¼ˆéœ€è¦æ•°ç»„æ—¶ä¼ é€’çš„æ˜¯æ ‡é‡ç±»å‹ï¼‰ï¼‰ã€‚

@c This is documented in the header file and needs some expanding upon.
@c The table there should be presented here
@end itemize

ä½ å¯ä»¥ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæ¥è°ƒç”¨ API å‡½æ•°ï¼Œä½†æ˜¯æ¥å£æ²¡æœ‰è¿™ä¹ˆç®€å•ã€‚ä¸ºäº†ä½¿æ‰©å±•ä»£ç çœ‹èµ·æ¥åƒå¸¸è§„çš„ä»£ç ï¼Œ@file{gawkapi.h} å¤´æ–‡ä»¶ä¸­å®šä¹‰äº†å‡ ä¸ªå®ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨ã€‚è¿™ä¸€@value{SECTION}ä¼šåœ¨ä½ ä½¿ç”¨å‡½æ•°æ—¶æ¥å‘ˆç°è¿™äº›å®ã€‚

@node General Data Types
@subsection é€šç”¨ç›®çš„çš„æ•°æ®ç±»å‹

@cindex Robbins, Arnold
@cindex Ramey, Chet
@quotation
@i{
æˆ‘æ˜¯çœŸçš„å–œæ¬¢/è®¨åŒä¸è”åˆä¹‹é—´çš„å…³ç³»ã€‚
}
@author Arnold Robbins
@end quotation

@quotation
@i{
è¿™æ˜¯åœ¨å…³äºè”åˆçš„äº‹æƒ…ï¼šç¼–è¯‘å™¨ä¼šå¯¹äº‹è¿›è¡Œå‘¨å¯†å®‰æ’ï¼Œè¿™æ ·å¯ä»¥åè°ƒå¯¹å®ƒçš„çˆ±ä¸æ¨ã€‚
}
@author Chet Ramey
@end quotation

æ‰©å±•çš„ API å®šä¹‰äº†å¾ˆå¤šç®€å•çš„ç±»å‹ä»¥åŠç»“æ„æ¥ç”¨äºé€šç”¨ç›®çš„ã€‚å¦å¤–ï¼Œå¾ˆå¤šç‰¹æœ‰çš„æ•°æ®ç»“æ„ä¼šåœ¨åé¢çš„@value{SECTION}ä¸­è¿›è¡Œä»‹ç»ï¼ŒåŒ…å«ä½¿ç”¨ä»–ä»¬çš„å‡½æ•°ã€‚

é€šç”¨ç›®çš„ç±»å‹å’Œç»“æ„å¦‚ä¸‹ï¼š

@table @code
@item typedef void *awk_ext_id_t;
è¿™ä¸ªç±»å‹çš„å€¼æ˜¯åœ¨æ‰©å±•è¢«è½½å…¥çš„æ—¶å€™ä» @command{gawk} ä¸­è¿”å›çš„ã€‚è¿™ä¸ªå€¼å¿…é¡»è¢«ä½œä¸ºæ¯ä¸ª API çš„å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å›ä¼ ç»™ @command{gawk}ã€‚

@item #define awk_const @dots{}
è¿™ä¸ªå®ä¼šåœ¨ç¼–è¯‘æ‰©å±•æ—¶å±•å¼€æˆä¸º @samp{const}ï¼Œä½†åœ¨ç¼–è¯‘ @command{gawk} æœ¬èº«æ—¶ï¼Œåˆ™ä¸ºç©ºã€‚è¿™ä½¿å¾— API æ•°ç»„ç»“æ„ä¸­çš„ç‰¹å®šåŸŸä»æ‰©å±•ä¸­æ˜¯ä¸å¯å†™çš„ï¼Œè€Œå…è®¸ @command{gawk} åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨å®ƒä»¬ã€‚

@item typedef enum awk_bool @{
@itemx @ @ @ @ awk_false = 0,
@itemx @ @ @ @ awk_true
@itemx @} awk_bool_t;
ç®€å•çš„å¸ƒå°”ç±»å‹ã€‚

@item typedef struct awk_string @{
@itemx @ @ @ @ char *str;@ @ @ @ @ @ /* data */
@itemx @ @ @ @ size_t len;@ @ @ @ @ /* length thereof, in chars */
@itemx @} awk_string_t;
è¿™è¡¨ç¤ºä¸€ä¸ªå¯å˜çš„å­—ä¸²ã€‚å¦‚æœæœ‰å€¼çš„è¯ï¼Œ@command{gawk} æŒæœ‰æŒ‡å‘å®ƒçš„å†…å­˜ã€‚å¦åˆ™ï¼Œå®ƒä¼šè‡ªå·±æŒæœ‰å…¶æŒ‡å‘çš„å†…å­˜ã€‚@emph{è¿™äº›å†…å­˜å¿…é¡»æ¥è‡ªäº @code{gawk_malloc()}ï¼Œ@code{gawk_calloc()}ï¼Œæˆ–è€… @code{gawk_realloc()} å‡½æ•°ã€‚}

å¦‚æ—©å‰æ‰€æï¼Œå­—ä¸²ä½¿ç”¨å½“å‰çš„å¤šå­—èŠ‚ç¼–ç æ¥ä¿å­˜ã€‚

@item typedef enum @{
@itemx @ @ @ @ AWK_UNDEFINED,
@itemx @ @ @ @ AWK_NUMBER,
@itemx @ @ @ @ AWK_STRING,
@itemx @ @ @ @ AWK_ARRAY,
@itemx @ @ @ @ AWK_SCALAR,@ @ @ @ @ @ @ @ @ /* opaque access to a variable */
@itemx @ @ @ @ AWK_VALUE_COOKIE@ @ @ @ /* for updating a previously created value */
@itemx @} awk_valtype_t;
è¿™ä¸ª @code{enum} æŒ‡ç¤ºäº†æ•°æ®çš„ç±»å‹ã€‚å®ƒä¼šåœ¨åé¢çš„ç»“æ„ä½“ @code{struct} ä¸­ä½¿ç”¨ã€‚

@item typedef struct awk_value @{
@itemx @ @ @ @ awk_valtype_t   val_type;
@itemx @ @ @ @ union @{
@itemx @ @ @ @ @ @ @ @ awk_string_t@ @ @ @ @ @ @ s;
@itemx @ @ @ @ @ @ @ @ double@ @ @ @ @ @ @ @ @ @ @ @ @ d;
@itemx @ @ @ @ @ @ @ @ awk_array_t@ @ @ @ @ @ @ @ a;
@itemx @ @ @ @ @ @ @ @ awk_scalar_t@ @ @ @ @ @ @ scl;
@itemx @ @ @ @ @ @ @ @ awk_value_cookie_t@ vc;
@itemx @ @ @ @ @} u;
@itemx @} awk_value_t;
ä¸€ä¸ªâ€œ@command{awk} å€¼â€ã€‚@code{val_type} æˆå‘˜æŒ‡ç¤ºäº†è”åˆä½“ @code{union} å­˜æœ‰çš„å€¼çš„ç±»å‹ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æ˜¯ç‰¹å®šçš„ç±»å‹ã€‚

@item #define str_value@ @ @ @ @ @ u.s
@itemx #define num_value@ @ @ @ @ @ u.d
@itemx #define array_cookie@ @ @ u.a
@itemx #define scalar_cookie@ @ u.scl
@itemx #define value_cookie@ @ @ u.vc
ä½¿ç”¨è¿™äº›å®æ¥è®¿é—® @code{awk_value_t} çš„åŸŸä¼šä½¿ç”¨ä»£ç æ›´é˜…è¯»ã€‚

@item typedef void *awk_scalar_t;
æ ‡é‡å¯ä»¥è¢«è¡¨ç¤ºæˆä¸€ä¸ªé€æ˜ç±»å‹ã€‚è¿™äº›å€¼ä» @command{gawk} ä¸­è·å–ï¼Œç„¶åå†å›ä¼ ç»™ @command{gawk}ã€‚è¿™åœ¨æœ¬åˆ—è¡¨ä¸‹é¢çš„ä¼šä»¥æœ‰æ›´ä¸€èˆ¬çš„è®¨è®ºã€‚æ›´å¤šçš„ç»†èŠ‚è¯·å‚è€ƒ @ref{Symbol table by cookie}ã€‚

@item typedef void *awk_value_cookie_t;
ä¸€ä¸ªâ€œå€¼ cookieâ€è¡¨ç¤ºä¸€ä¸ªç¼“å­˜å€¼çš„é€æ˜ç±»å‹ã€‚è¿™ä¼šä¸‹åˆ—è¡¨çš„åé¢è¿›è¡Œæ›´ä¸€èˆ¬çš„è®¨è®ºï¼Œè€Œæ›´å¤šçš„ç»†èŠ‚è¯·å‚è€ƒ @ref{Cached values}ã€‚

@end table

åœ¨ @command{awk} ä¸­çš„æ ‡é‡è¦ä¹ˆæ˜¯æ•°å€¼ï¼Œè¦ä¹ˆæ˜¯å­—ä¸²ã€‚@code{awk_value_t} ç»“æ„ä»£è¡¨ä¸€ä¸ªå€¼ã€‚@code{val_type} æˆå‘˜æŒ‡ç¤ºè”åˆä½“ @code{union} ä¸­çš„å…·ä½“å€¼çš„ç±»å‹ã€‚

è¡¨ç¤ºä¸€ä¸ªæ•°å€¼å¾ˆç®€å•â€”â€”API ä½¿ç”¨ C @code{double}ã€‚å­—ä¸²åˆ™éœ€è¦ä¸€ç‚¹å·¥ä½œã€‚å› æ­¤ @command{gawk} å…è®¸å†…åµŒçš„ @sc{nul} å­—èŠ‚åœ¨å­—ä¸²ä¸­ã€‚ä¸€ä¸ªå­—ä¸²å¿…é¡»ä½¿ç”¨åŒ…å«æŒ‡é’ˆä¸é•¿åº¦ä¸€å¯¹å€¼æ¥è¡¨ç¤ºã€‚è¿™ä¸ªç±»å‹æ˜¯ @code{awk_string_t} ç±»å‹ã€‚

æ ‡è¯†ç¬¦ï¼ˆå¦‚å…¨å±€å˜é‡çš„åå­—ï¼‰å¯ä»¥ä¸æ ‡é¢˜å€¼æˆ–è€…ä¸æ•°ç»„è¿›è¡Œå…³è”ã€‚å¦å¤–ï¼Œ@command{gawk} æä¾›äº†çœŸæ­£çš„æ•°ç»„ä¹‹æ•°ç±»å‹ï¼Œè¿™æ ·æŒ‡å®šçš„æ•°ç»„å…ƒç´ ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å¯¹äºæ•°ç»„çš„è®¨è®ºï¼Œè¯¦ç»†å†…å®¹è¦åˆ° @ref{Array Manipulation}ã€‚

æ—©å‰æ‰€åˆ—çš„å®ä½¿å¾—æ›´å®¹æ˜“ä½¿ç”¨è”åˆä½“ @code{union} ä¸­çš„å…ƒç´ ï¼Œå°±å¥½åƒå®ƒå°±æ˜¯ç»“æ„ä½“ @code{struct} ä¸­çš„åŸŸä¸€æ ·ï¼Œè¿™åœ¨ C ä¸­æ˜¯ä¸€ä¸ªé€šç”¨çš„ç¼–ç¨‹æŠ€å·§ã€‚è¿™äº›ä»£ç ä¹Ÿæ›´å®¹æ˜“ç¼–å†™ä¸é˜…è¯»ï¼Œä½†æ˜¯@emph{ä½ }æœ‰è´£ä»»ç¡®ä¿ @code{val_type} æˆå‘˜æ­£ç¡®åœ°åæ˜ äº† @code{awk_value_t} ç»“æ„ä¸­çš„å€¼çš„ç±»å‹ã€‚

ä»æ¦‚å¿µä¸Šæ¥è¯´ï¼Œè”åˆä½“ @code{union} ä¸­çš„å¤´ä¸‰ä¸ªæˆå‘˜ï¼ˆnumberï¼Œstring ä¸ arrayï¼‰æ˜¯ä¸ @command{awk} ä¸€èµ·ä½¿ç”¨æ—¶æ‰€æœ‰éœ€è¦çš„ç±»å‹ã€‚ä½†æ˜¯ï¼Œå› ä¸º API æä¾›çš„ç”¨æ¥è®¿é—®ä¸æ›´æ”¹å…¨å±€æ ‡é‡å€¼çš„ä¾‹ç¨‹åªå¯ä»¥ä½¿ç”¨å˜é‡åï¼Œå› æ­¤ä¼šæœ‰æ€§èƒ½æŸè€—ï¼š@command{gawk} å¿…é¡»åœ¨è®¿é—®æˆ–è€…æ›´æ”¹æ—¶æ‰¾åˆ°è¿™ä¸ªå˜é‡ã€‚è¿™ä¼šæˆä¸ºä¸€ä¸ªçœŸæ­£çš„é—®é¢˜ï¼Œè€Œä¸ä»…æ˜¯ç†è®ºä¸Šçš„ã€‚

æ‰€ä»¥ï¼Œå¦‚æœä½ çŸ¥é“ä½ çš„æ‰©å±•ä¼šèŠ±ç›¸å½“é•¿çš„æ—¶å€™æ¥è¯»å–/æˆ–è€…æ”¹å˜ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ ‡é‡çš„å€¼ã€‚ä½ å°±å¯ä»¥ä¸ºé‚£ä¸ªå˜é‡è·å–ä¸€ä¸ª@dfn{æ ‡é‡ cookie}å¯¹è±¡ï¼Œ
@footnote{æŸ¥çœ‹ @uref{http://catb.org/jargon/html/C/cookie.html, the ``cookie'' entry in the Jargon file} æ¥æŸ¥çœ‹ @dfn{cookie} çš„å®šä¹‰ï¼Œä»¥åŠ @uref{http://catb.org/jargon/html/M/magic-cookie.html,
the ``magic cookie'' entry in the Jargon file} æ¥æŸ¥çœ‹å…¶ä¸­çš„ä¾‹å­ã€‚
@ifclear FOR_PRINT
See also the entry for ``Cookie'' in the @ref{Glossary}.
ä¹Ÿå¯çœ‹ @ref{Glossary} ä¸­çš„â€œCookieâ€è¯æ¡ã€‚
@end ifclear
}
ç„¶åä½¿ç”¨è¿™ä¸ª cookie æ¥è·å–å˜é‡çš„å€¼ï¼Œæˆ–è€…æ”¹å˜å˜é‡çš„å€¼ã€‚@code{awk_scalar_t} ç±»å‹æŒæœ‰ä¸€ä¸ªæ ‡é‡ cookieï¼Œè€Œ @code{scalar_cookie} å®æä¾›äº†è®¿é—®åœ¨ @code{awk_scalar_t} ç»“æ„ä¸­é‚£ä¸ªç±»å‹å€¼çš„æ–¹å¼ã€‚å‡è®¾æœ‰ä¸€ä¸ªæ ‡é‡ cookieï¼Œ@command{gawk} å¯ä»¥ç›´æ¥è¿”å›æˆ–è€…ä¿®æ”¹å…¶å€¼ï¼Œè€Œä¸éœ€è¦é¦–å…ˆæŸ¥æ‰¾å®ƒã€‚

@code{awk_value_cookie_t} ç±»å‹ä¸ @code{value_cookie} å®ç±»ä¼¼ã€‚å¦‚æœä½ çŸ¥é“ä½ å¸Œæœ›ä½¿ç”¨ç›¸åŒçš„æ•°å€¼ç±»å‹ä¸å­—ä¸²ç±»å‹çš„@emph{å€¼}æ¥ç”¨äºä¸€ä¸ªæˆ–è€…å¤šä¸ªå˜é‡ï¼Œä½ å¯ä»¥ä¸€æ¬¡åˆ›å»ºå€¼ï¼Œç„¶åä¸ºå®ƒä¿ç•™@dfn{å€¼ cookie}ï¼Œç„¶ååœ¨å¸Œæœ›åœ¨è®¾ç½®å˜é‡çš„ä»»ä½•æ—¶å€™ï¼Œå°†è¿™ä¸ª cookie ä¼ é€’è¿‡å»äº§ã€‚è¿™ä¸ªå¯ä»¥åœ¨è¿è¡Œçš„ @command{gawk} ä¸­èŠ‚çº¦å­˜å‚¨ï¼Œå¹¶ä¸”å‹ç¼©åˆ›å»ºå€¼çš„æ—¶é—´ã€‚

@node Memory Allocation Functions
@subsection å†…å­˜åˆ†é…å‡½æ•°ä¸ç›¸åº”çš„ç®€åŒ–å®
@cindex allocating memory for extensions
@cindex extensions, allocating memory

API æä¾›äº†å¾ˆå¤šçš„å†…å­˜åˆ†é…å‡½æ•°ç”¨æ¥è¿›è¡Œ@dfn{å†…å­˜åˆ†é…}ï¼Œå¹¶å¯å°†å†…å­˜ä¼ é€’ç»˜ç”» @command{gawk}ï¼Œä»¥åŠä¸€äº›ç”¨äºæ–¹ä¾¿ç›®çš„çš„å®ã€‚è¿™ä¸ª@value{SUBSECTION}
å°èŠ‚å°†å®ƒä»¬çš„å‡½æ•°åŸå‹å‘ˆç°ï¼Œæ‰©å±•å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥ä½¿ç”¨å®ƒä»¬ï¼š

@table @code
@item void *gawk_malloc(size_t size);
è°ƒç”¨æ­£ç¡®çš„ @code{malloc()} ç‰ˆæœ¬æ¥åˆ†é…å­˜å‚¨ï¼Œå¹¶å¯ä»¥ä¼ é€’ç»™ @command{gawk}ã€‚

@item void *gawk_calloc(size_t nmemb, size_t size);
è°ƒç”¨æ­£ç¡®çš„ @code{calloc()} ç‰ˆæœ¬æ¥åˆ†é…å†…å­˜ï¼Œå¹¶å¯ä»¥ä¼ é€’ç»™ @command{gawk}ã€‚

@item void *gawk_realloc(void *ptr, size_t size);
è°ƒç”¨æ­£ç¡®çš„ @code{realloc()} ç‰ˆæœ¬æ¥åˆ†é…å†…å­˜ï¼Œå¹¶å¯ä»¥ä¼ é€’ç»™ @command{gawk}ã€‚

@item void gawk_free(void *ptr);
è°ƒç”¨æ­£ç¡®çš„ @code{free()} ç‰ˆæœ¬æ¥é‡Šæ”¾ç”± @code{gawk_malloc()}ï¼Œ@code{gawk_calloc()}ï¼Œæˆ–è€… @code{gawk_realloc()} åˆ†é…çš„å†…å­˜ã€‚
@end table

API è¦æä¾›è¿™äº›å‡½æ•°ï¼Œæ˜¯å› ä¸ºè¦ç¼–è¯‘çš„æ‰©å±•æœ‰å¯èƒ½è¿æ¥çš„æ˜¯ä¸åŒç‰ˆæœ¬çš„ C åº“ï¼Œè€Œä¸æ˜¯ @command{gawk} æ‰§è¡Œä½“æ‰€ä½¿ç”¨çš„ C åº“ã€‚
@footnote{è¿™åœ¨ MS-Windows ç³»ç»Ÿä¸­æ›´å¸¸è§ï¼Œä¸è¿‡ä¹Ÿå¯èƒ½å‘ç”Ÿåœ¨ Unix ç±»ä¼¼çš„ç³»ç»Ÿä¸­ã€‚}
å¦‚æœ @command{gawk} ä½¿ç”¨çš„æ˜¯å®ƒè‡ªå·±ç‰ˆæœ¬ @code{free()} æ¥é‡Šæ”¾ä¸ç›¸åŒçš„ç‰ˆæœ¬ @code{malloc()} ç‰ˆæœ¬åˆ†é…çš„å†…å­˜æ—¶ï¼Œå°±å¯èƒ½å¯¼è‡´æœªé¢„æœŸçš„è¡Œä¸ºã€‚

æœ‰ä¸¤ä¸ªæ–¹ä¾¿çš„å®å¯ä»¥ç”¨æ¥ä½¿ç”¨ @code{gawk_malloc()} ä¸ @code{gawk_realloc()} æ¥è¿›è¡Œå†…å­˜åˆ†é…ã€‚å¦‚æœåˆ†é…å¤±è´¥ï¼Œä¼šå¯¼è‡´ @command{gawk} ä¼šä»¥è‡´å‘½é”™è¯¯é€€å‡ºã€‚ä½¿ç”¨å®ƒä»¬å°±åƒä½¿ç”¨ä¸€ä¸ªä¸ä¼šè¿”å›å€¼çš„è¿‡ç¨‹ä¸€æ ·ã€‚

@table @code
@item #define emalloc(pointer, type, size, message) @dots{}
è¿™ä¸ªå®çš„å‚æ•°å¦‚ä¸‹ï¼š

@c nested table
@table @code
@item pointer
å˜é‡æŒ‡å‘è¢«åˆ†é…çš„å†…å­˜ã€‚

@item type
å˜é‡çš„ç±»å‹ã€‚è¿™ä¸ªç”¨æ¥åˆ›å»ºä¸€ä¸ªè°ƒç”¨ @code{gawk_malloc()} çš„è½¬æ¢ã€‚

@item size
è¦åˆ†é…çš„å­—èŠ‚æ€»å¤§å°ã€‚

@item message
åœ¨é”™è¯¯ä¿¡æ¯å‰é™„åŠ çš„æ¶ˆæ¯ã€‚å…¸å‹çš„æ˜¯ä½¿ç”¨è¿™ä¸ªå®çš„å‡½æ•°åã€‚
@end table

@noindent
ä¾‹å¦‚ï¼Œä½ å¯ä»¥åƒè¿™æ ·æ¥åˆ†é…ä¸€ä¸ªå­—ä¸²å€¼ï¼š

@example
awk_value_t result;
char *message;
const char greet[] = "Don't Panic!";

emalloc(message, char *, sizeof(greet), "myfunc");
strcpy(message, greet);
make_malloced_string(message, strlen(message), & result);
@end example

@item #define erealloc(pointer, type, size, message) @dots{}
è¿™ä¸ªä¸ @code{emalloc()} ç±»ä¼¼ï¼Œä½†æ˜¯è°ƒç”¨çš„æ˜¯ @code{gawk_realloc()} è€Œä¸æ˜¯ @code{gawk_malloc()}ã€‚å‚æ•°ä¸ @code{emalloc()} å®ä¸€æ ·ã€‚
@end table

@node Constructor Functions
@subsection æ„é€ å‡½æ•°

API æä¾›äº†å¤šä¸ª@dfn{æ„é€ å‡½æ•°}æ¥åˆ›å»ºå­—ä¸²æˆ–è€…æ•°å€¼ï¼Œä»¥åŠå¤šä¸ªç›¸åº”çš„å®ã€‚è¿™ä¸ª@value{SUBSECTION}å‘ˆç°æ‰€æœ‰å‡½æ•°çš„åŸå‹ï¼Œæ‰©å±•ä»£ç å¯ä»¥ä½¿ç”¨è¿™äº›åŸå‹æ¥è°ƒç”¨å®ƒä»¬ï¼š

@table @code
@item static inline awk_value_t *
@itemx make_const_string(const char *string, size_t length, awk_value_t *result);
è¿™ä¸ªå‡½æ•°åœ¨é€šè¿‡ @code{result} æŒ‡å‘çš„ @code{awk_value_t} å˜é‡ä¸­åˆ›å»ºä¸€ä¸ªå­—ä¸²å€¼ã€‚å‡½æ•°éœ€è¦è¦çš„ @code{string} æ˜¯ä¸€ä¸ª C å­—ä¸²å¸¸é‡ï¼ˆæˆ–è€…å…¶ä»–çš„å­—ä¸²æ•°æ®ï¼‰ï¼Œå¹¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåœ¨ @code{result} ä¸­çš„æ•°æ®@emph{å¤æœ¬}ã€‚ç„¶åè¿”å› @code{result}ã€‚

@item static inline awk_value_t *
@itemx make_malloced_string(const char *string, size_t length, awk_value_t *result);
è¿™ä¸ªå‡½æ•°åœ¨ç”± @code{result} æŒ‡å‘çš„ @code{awk_value_t} å˜é‡ä¸­åˆ›å»ºä¸€ä¸ªå­—ä¸²ç±»å‹ã€‚å‡½æ•°éœ€è¦çš„ @code{string} æ˜¯ä¸€ä¸ª @samp{char *}ï¼ŒæŒ‡å‘çš„ä¹‹å‰å·²ç»ä» @code{gawk_malloc()}ï¼Œ@code{gawk_calloc()} æˆ–è€… @code{gawk_realloc()} ä¸­è·å–çš„æ•°æ®ã€‚è¿™é‡Œçš„æƒ³æ³•æ˜¯æ•°å€¼ä¼šç›´æ¥ä¼ é€’ç»™ @command{gawk}ï¼Œå°†å¯¹å…¶è´Ÿè´£ã€‚å‡½æ•°è¿”å› @code{result}ã€‚

@item static inline awk_value_t *
@itemx make_null_string(awk_value_t *result);
è¿™ä¸ªç‰¹åˆ«å‡½æ•°ï¼Œåœ¨ä¸€ä¸ªç”± @code{result} æŒ‡å‘çš„ @code{awk_value_t} å˜é‡ç”±ä¸­åˆ›å»ºä¸€ä¸ªç©ºä¸²ã€‚å‡½æ•°è¿”å› @code{result}ã€‚

@item static inline awk_value_t *
@itemx make_number(double num, awk_value_t *result);
è¿™ä¸ªå‡½æ•°ç®€å•åœ°åœ¨ç”± @code{result} æŒ‡å‘çš„ @code{awk_value_t} å˜é‡ä¸­åˆ›å»ºä¸€ä¸ªæ•°å€¼ã€‚
@end table

@node Registration Functions
@subsection æ³¨å†Œå‡½æ•°
@cindex register extension
@cindex extension registration

æœ¬@value{SECTION}æè¿°ç”¨äºæ³¨å†Œéƒ¨åˆ†æ‰©å±•åˆ° @command{gawk} ä¸­çš„ API å‡½æ•°ã€‚

@menu
* Extension Functions::         Registering extension functions.
* Exit Callback Functions::     Registering an exit callback.
* Extension Version String::    Registering a version string.
* Input Parsers::               Registering an input parser.
* Output Wrappers::             Registering an output wrapper.
* Two-way processors::          Registering a two-way processor.
@end menu

@node Extension Functions
@subsubsection æ³¨å†Œæ‰©å±•å‡½æ•°

æ‰©å±•å‡½æ•°æ˜¯é€šè¿‡ä¸‹é¢çš„è®°å½•ä¸‹è¿›è¡Œæè¿°çš„ï¼š

@example
typedef struct awk_ext_func @{
@ @ @ @ const char *name;
@ @ @ @ awk_value_t *(*function)(int num_actual_args, awk_value_t *result);
@ @ @ @ size_t num_expected_args;
@} awk_ext_func_t;
@end example

åŸŸçš„å«ä¹‰å¦‚ä¸‹ï¼š

@table @code
@item const char *name;
æ–°å‡½æ•°çš„åå­—ã€‚@command{awk} å±‚çš„ä»£ç é€šè¿‡è¿™ä¸ªåå­—æ¥è°ƒç”¨å‡½æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§„çš„ C å­—ä¸²ã€‚

å‡½æ•°åå¿…é¡»ç¬¦åˆ @command{awk} æ ‡è¯†ç¬¦çš„è§„åˆ™ã€‚ä¹Ÿå°±æ˜¯ï¼Œå®ƒä»¬å¿…é¡»æ˜¯ä»¥è‹±æ–‡å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å¼€å§‹ï¼Œåé¢å¯ä»¥è·Ÿä»»ä½•çš„å­—æ¯ï¼Œæ•°å­—ä¸ä¸‹åˆ’çº¿ã€‚å‡½æ•°åçš„å­—æ¯çš„å¤§å°å†™æ˜¯æœ‰å…³çš„ã€‚

@item awk_value_t *(*function)(int num_actual_args, awk_value_t *result);
è¿™æ˜¯ä¸€ä¸ªæŒ‡å‘æä¾›äº†æ‰©å±•åŠŸèƒ½çš„ C å‡½æ•°çš„æŒ‡é’ˆã€‚å‡½æ•°å¿…é¡»åœ¨ @code{*result} ä¸­å¡«å…¥æ•°å­—æˆ–è€…å­—ä¸²ã€‚@command{gawk} ä¼šæ¥ç®¡ä»»æ„å­—ä¸²å†…å­˜çš„æ‰€æœ‰æƒã€‚å¦‚æ—©å…ˆæ‰€æï¼Œå­—ä¸²å†…å­˜@emph{å¿…é¡»}æ¥è‡ªäº @code{gawk_malloc()}ï¼Œ@code{gawk_calloc()} æˆ– @code{gawk_realloc()} ç­‰å‡½æ•°ä¹‹ä¸€ã€‚

@code{num_actual_args} å‚æ•°å‘ŠçŸ¥ C å‡½æ•°ï¼Œä¼šæœ‰å¤šå°‘ä¸ªå®é™…çš„å‡½æ•°ä»è°ƒç”¨çš„ @command{awk} ä»£ç ä¸­ä¼ å…¥ã€‚

å‡½æ•°å¿…é¡»è¿”å› @code{result} çš„å€¼ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº† @command{gawk} ä¸­è°ƒç”¨ä»£ç ä½¿ç”¨ä¸Šçš„æ–¹ä¾¿ã€‚

@item size_t num_expected_args;
è¿™ä¸ªæ˜¯å‡½æ•°å¸Œæœ›æ¥å—å‚æ•°çš„ä¸ªæ•°ã€‚æ¯ä¸€ä¸ªæ‰©å±•å‡½æ•°éƒ½å¯ä»¥å†³å®šå¦‚æœå‚æ•°ä¸æ˜¯å®ƒæ‰€å¸Œæœ›çš„ä¸ªæ•°æ—¶æ‰€è¦åšçš„äº‹æƒ…ã€‚å¯¹äºçœŸæ­£çš„ @command{awk} å‡½æ•°ï¼Œå¿½ç•¥é¢å¤–çš„å‚æ•°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚
@end table

ä¸€æ—¦ä½ æœ‰äº†ä¸€ä¸ªè¡¨ç¤ºä½ çš„æ‰©å±•çš„å‡½æ•°ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ API å‡½æ•°æ¥æ³¨å†Œï¼š

@table @code
@item awk_bool_t add_ext_func(const char *namespace, const awk_ext_func_t *func);
è¿™ä¸ªå‡½æ•°åœ¨æˆåŠŸæ—¶è¿”å›ä¸º trueï¼Œå¦åˆ™è¿”å› falseã€‚@code{namespace} å‚æ•°å½“å‰æ²¡æœ‰ä½¿ç”¨ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºä¸²ï¼ˆ@code{""}ï¼‰è¿‡å»ã€‚@code{func} æŒ‡é’ˆæ˜¯ä»£è¡¨ä½ çš„å‡½æ•°çš„ç»“æ„ä½“ @code{struct} æŒ‡é’ˆï¼Œå…¶ç»“æ„å¦‚ä¸Šæ‰€è¿°ã€‚
@end table

@node Exit Callback Functions
@subsubsection æ³¨å†Œé€€å‡ºå‡½æ•°

ä¸€ä¸ª@dfn{é€€å‡ºå›è°ƒ}å‡½æ•°æ˜¯åœ¨ @command{gawk} é€€å‡ºæ—¶è¦è°ƒç”¨çš„å‡½æ•°ã€‚è¿™æ ·çš„å‡½æ•°ä¼šåœ¨ä½ çš„æ‰©å±•ä¸­æœ‰ä¸€äº›æ¸…ç†å·¥ä½œè¦åšæ—¶éå¸¸æœ‰ç”¨ï¼ˆå¦‚å…³é—­æ•°æ®åº“è¿æ¥ä»¥åŠé‡Šæ”¾å…¶ä»–èµ„æºï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°æ¥æ³¨å†Œè¿™æ ·çš„ä¸€ä¸ªå‡½æ•°åˆ° @command{gawk} ä¸­ï¼š

@table @code
@item void awk_atexit(void (*funcp)(void *data, int exit_status),
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ void *arg0);
å‚æ•°çš„å«ä¹‰ä¸ºï¼š

@c nested table
@table @code
@item funcp
ä¸€ä¸ªåœ¨ @command{gawk} é€€å‡ºä¹‹å‰è¦è°ƒç”¨çš„å‡½æ•°çš„æŒ‡é’ˆã€‚@code{data} å‚æ•°å°±æ˜¯ @code{arg0} çš„åˆå§‹å€¼ã€‚@code{exit_status} å‚æ•°æ˜¯ @command{gawk} æƒ³ä¼ é€’ç»™ @code{exit()} ç³»ç»Ÿè°ƒç”¨çš„çŠ¶æ€å€¼ã€‚

@item arg0
ä¸€ä¸ªç§æœ‰æ•°æ®çš„æŒ‡é’ˆï¼Œ@command{gawk} ä¼šä¿å­˜å®ƒï¼Œå¹¶åœ¨è°ƒç”¨ @code{funcp} æŒ‡å‘çš„å‡½æ•°æ—¶ä¼ é€’ç»™å®ƒã€‚ 
@end table
@end table

é€€å‡ºå›è°ƒå‡½æ•°ä¼šå…ˆè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„é¡ºåºè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ä»¥å®ƒä»¬æ³¨å†Œåˆ° @command{gawk} ä¸­çš„é¡ºåºç›¸åçš„é¡ºåºæ¥è°ƒç”¨ã€‚

@node Extension Version String
@subsubsection æ³¨å†Œæ‰©å±•ç‰ˆæœ¬å­—ä¸²

ä½ å¯ä»¥æ³¨æ„ä¸€ä¸ªç‰ˆæœ¬å­—ä¸²æ¥è¡¨ç¤ºä½ çš„æ‰©å±•åœ¨ @command{gawk} ä¸­çš„ç‰ˆæœ¬ä¸åå­—ï¼Œå¦‚ä¸‹ï¼š

@table @code
@item void register_ext_version(const char *version);
å°†ç”± @code{version} æŒ‡å‘çš„ç‰ˆæœ¬æ³¨å†Œåˆ° @command{gawk} ä¸­ã€‚è¦æ³¨æ„ @command{gawk} @emph{ä¸ä¼š}æ‹·è´ version å­—ä¸²ï¼Œå› æ­¤å®ƒä¸å¯ä»¥è¢«æ”¹å˜ã€‚
@end table

@command{gawk} å½“ä»¥ @option{--version} é€‰é¡¹è°ƒç”¨æ—¶ï¼Œä¼šæ‰“å°æ‰€æœ‰çš„å·²ç»æ³¨å†Œäº†æ‰©å±•çš„ç‰ˆæœ¬å­—ä¸²ã€‚

@node Input Parsers
@subsubsection å®šåˆ¶è¾“å…¥åˆ†æå™¨
@cindex customized input parser

é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œ@command{gawk} ä»è¾“å…¥ä¸­è¯»å–æ–‡æœ¬ã€‚å®ƒä½¿ç”¨ @code{RS} çš„å€¼æ¥æŸ¥çœ‹è®°å½•çš„ç»“æŸï¼Œå¹¶ä¸”ä½¿ç”¨ @code{FS}ï¼ˆæˆ–è€… @code{FIELDWIDTHS} æˆ–è€… @code{FPAT}ï¼‰æ¥å°†å…¶åˆ†å‰²æˆåŸŸï¼ˆæŸ¥çœ‹ @pxref{Reading Files}ï¼‰ã€‚å¦å¤–ï¼Œ@command{gawk} è¿˜ä¼šè®¾ç½® @code{RT} çš„å€¼ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ã€‚

å¦‚æœä½ æƒ³ï¼Œä½ å¯ä»¥æä¾›è‡ªå·±çš„å®šåˆ¶çš„è¾“å…¥åˆ†æå™¨ã€‚ä¸€ä¸ªè¾“å…¥åˆ†æå™¨çš„å·¥ä½œå°±æ˜¯ç»™ @command{gawk} çš„è®°å½•å¤„ç†ä»£ç è¿”å›ä¸€æ¡è®°å½•ï¼Œä»¥åŠç”¨äº @code{RT} çš„æ•°æ®çš„å€¼ä¸é•¿åº¦çš„æŒ‡ç¤ºç¬¦ï¼Œå¦‚æœæœ‰çš„è¯ã€‚

ä¸ºäº†æä¾›è¾“å…¥åˆ†æå™¨ï¼Œä½ å¿…é¡»é¦–å…ˆæä¾›ä¸¤ä¸ªå‡½æ•°ï¼ˆåœ¨è¿™é‡Œ @var{XXX} æ˜¯ä½ çš„æ‰©å±•çš„å‰ç¼€ï¼‰ï¼š

@table @code
@item awk_bool_t @var{XXX}_can_take_file(const awk_input_buf_t *iobuf);
è¿™ä¸ªå‡½æ•°æ£€æŸ¥åœ¨ @code{iobuf} ä¸­çš„ä¿¡æ¯ï¼ˆæˆ‘ä»¬åé¢ä¼šè®¨è®ºï¼‰ã€‚åŸºäºé‡Œé¢çš„ä¿¡æ¯ï¼Œå¯ä»¥ç¡®å®šè¾“å…¥åˆ†æå™¨æ˜¯å¦ç”¨äºè¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœå¯ä»¥ï¼Œåˆ™è¿”å› trueã€‚å¦åˆ™è¿”å› falseã€‚è¿™ä¸ªå‡½æ•°ä¸åº”è¯¥æ”¹å˜ @command{gawk} ä¸­çš„ä»»ä½•çŠ¶æ€ï¼ˆæ¯”å¦‚å˜é‡çš„å€¼ç­‰ï¼‰ã€‚

@item awk_bool_t @var{XXX}_take_control_of(awk_input_buf_t *iobuf);
å½“ @command{gawk} å†³å®šä»è¾“å…¥åˆ†æå™¨ä¸­æ¥æ‰‹æ–‡ä»¶çš„æ§åˆ¶æƒçš„æ—¶å€™ï¼Œå®ƒä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ¥ç€å¿…é¡»å°†ç‰¹å®šçš„åŸŸå¡«å……åˆ° @code{awk_input_buf_t} ç»“æ„ä¸­ï¼Œå¹¶ä¿è¯ç‰¹å®šçš„æ¡ä»¶ä¸º trueã€‚å‡½æ•°åº”å½“è¿”å› trueã€‚å¦‚æœå‡ºç°äº†æŸç§é”™è¯¯ï¼Œå‡½æ•°ä¸å¯ä»¥å†å¡«å……ä»»ä½•åŸŸï¼Œå¹¶ä¸”è¿”å› falseï¼Œä¹‹åï¼Œ@command{gawk} ä¸ä¼šä½¿ç”¨è¿™ä¸ªè¾“å…¥åˆ†æå™¨ã€‚ç»†èŠ‚å°†åœ¨åé¢å‘ˆç°ã€‚
@end table

ä½ çš„æ‰©å±•åº”è¯¥è¦å°†è¿™äº›å‡½æ•°åŒ…åˆ° @code{awk_input_parser_t} ä¸­ï¼Œè¿™ä¸ªç»“æ„å¦‚ä¸‹ï¼š

@example
typedef struct awk_input_parser @{
    const char *name;   /* name of parser */
    awk_bool_t (*can_take_file)(const awk_input_buf_t *iobuf);
    awk_bool_t (*take_control_of)(awk_input_buf_t *iobuf);
    awk_const struct awk_input_parser *awk_const next;   /* for gawk */
@} awk_input_parser_t;
@end example

è¿™äº›åŸŸä¸ºï¼š

@table @code
@item const char *name;
è¾“å…¥åˆ†æå™¨çš„åå­—ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§„çš„ C å­—ä¸²ã€‚

@item awk_bool_t (*can_take_file)(const awk_input_buf_t *iobuf);
æŒ‡å‘ @code{@var{XXX}_can_take_file()} å‡½æ•°çš„æŒ‡é’ˆã€‚

@item awk_bool_t (*take_control_of)(awk_input_buf_t *iobuf);
@code{@var{XXX}_take_control_of()} å‡½æ•°çš„æŒ‡é’ˆã€‚

@item awk_const struct input_parser *awk_const next;
è¿™ä¸ªç”± @command{gawk} æ¥ä½¿ç”¨ï¼Œå› æ­¤å®ƒè¢«æ ‡å¿—ä¸º @code{awk_const}ï¼Œè¿™æ ·æ‰©å±•å°±ä¸èƒ½å¤Ÿä¿®æ”¹å®ƒã€‚
@end table

å®ç°æ­¥éª¤ï¼š

@enumerate
@item
åˆ›å»ºä¸€ä¸ªé™æ€çš„ @code{awk_input_parser_t} å˜é‡ï¼Œå¹¶ä¸”æ­£ç¡®åœ°åˆå§‹åŒ–å®ƒã€‚

@item
å½“ä½ çš„æ‰©å±•è¢«è½½å…¥æ—¶ï¼Œä½¿ç”¨ @code{register_input_parser()} API å‡½æ•°æ³¨å†Œä½ çš„è¾“å…¥åˆ†æå™¨åˆ° @command{gawk} ä¸­ï¼ˆæ¥ä¸‹æ¥æè¿°ï¼‰ã€‚
@end enumerate

@code{awk_input_buf_t} ç»“æ„å¦‚ä¸‹ï¼š

@example
typedef struct awk_input @{
    const char *name;       /* filename */
    int fd;                 /* file descriptor */
#define INVALID_HANDLE (-1)
    void *opaque;           /* private data for input parsers */
    int (*get_record)(char **out, struct awk_input *iobuf,
                      int *errcode, char **rt_start, size_t *rt_len);
    ssize_t (*read_func)();
    void (*close_func)(struct awk_input *iobuf);
    struct stat sbuf;       /* stat buf */
@} awk_input_buf_t;
@end example

è¿™äº›åŸŸå¯ä»¥åˆ†æˆä¸¤ç±»ï¼šä¸€ç±»æ˜¯ @code{@var{XXX}_can_take_file()} å‡½æ•°ä½¿ç”¨ï¼ˆæœ€èµ·ç æ˜¯ï¼‰ï¼Œä»¥åŠè¢« @code{@var{XXX}_take_control_of()} ä½¿ç”¨ï¼Œå®ƒä»¬ä½¿ç”¨çš„ç¬¬ä¸€ç»„åŸŸå¦‚ä¸‹ï¼š

@table @code
@item const char *name;
æ–‡ä»¶çš„åå­—ã€‚

@item int fd;
æ–‡ä»¶çš„æè¿°ç¬¦ã€‚å¦‚æœ @command{gawk} èƒ½æ‰“å¼€æ–‡ä»¶ï¼Œ@code{fd} åˆ™@emph{ä¸ä¼š}ç­‰äº @code{INVALID_HANDLE}ï¼Œå¦åˆ™ç­‰äºã€‚

@item struct stat sbuf;
å¦‚æœæ–‡ä»¶æè¿°ç¬¦æ˜¯æœ‰æ•ˆçš„ï¼Œ@command{gawk} ä¼šå°†è¿™ä¸ªç»“æ„é€šè¿‡ @code{fstat()} ç³»ç»Ÿè°ƒç”¨æ¥è¿›è¡Œå¡«å……ã€‚
@end table

@code{@var{XXX}_can_take_file()} å‡½æ•°åº”è¯¥æ£€æŸ¥è¿™äº›åŸŸï¼Œå¹¶å†³å®šè¾“å…¥åˆ†æå™¨æ˜¯å¦å¯ç”¨äºè¿™ä¸ªæ–‡ä»¶ã€‚å†³å®šä¾èµ–äº @command{gawk} çš„çŠ¶æ€ï¼ˆé€šè¿‡æ‰©å±•ä»¥åŠç”± @command{awk} ä»£ç ä¹‹å‰è®¾ç½®çš„å˜é‡çš„å€¼ï¼‰ï¼Œæ–‡ä»¶çš„åå­—ï¼Œæ–‡ä»¶çš„æè¿°ç¬¦æ˜¯å¦æœ‰æ•ˆï¼Œåœ¨ @code{struct stat} ä¸­çš„ä¿¡æ¯ï¼Œä»¥åŠæ‰€æœ‰è¿™äº›å› ç´ çš„ç»„åˆã€‚

åªè¦ @code{@var{XXX}_can_take_file()} å‡½æ•°è¿”å› trueï¼Œ@command{gawk} å°±å†³å®šä½¿ç”¨ä½ çš„è¾“å…¥åˆ†æå™¨ï¼Œç„¶åè°ƒç”¨ @code{@var{XXX}_take_control_of()}ã€‚
è¿™ä¸ªå‡½æ•°ä¼šå¡«å……åœ¨ @code{awk_input_buf_t} ç»“æ„ä¸­çš„ @code{get_recordfield} æˆ–è€… @code{read_func} åŸŸã€‚åŒæ—¶ä¹Ÿè¦ä¿è¯ @code{fd} @emph{ä¸ä¼š}è¢«è®¾ç½®ä¸º @code{INVALID_HANDLE}ã€‚ä¸‹é¢çš„åˆ—è¡¨æè¿°äº†å¯èƒ½ä¼šè¢« @code{@var{XXX}_take_control_of()} å‡½æ•°ä½¿ç”¨çš„åŸŸï¼š

@table @code
@item void *opaque;
è¿™è¢«ç”¨æ¥å­˜å‚¨ä»»ä½•çš„è¾“å…¥åˆ†æå™¨é’ˆå¯¹è¿™ä¸ªæ–‡ä»¶æ‰€éœ€è¦çš„çŠ¶æ€ä¿¡æ¯ã€‚å®ƒå¯¹ @command{gawk} æ˜¯â€œé€æ˜â€çš„ã€‚è¾“å…¥åˆ†æå™¨å¹¶ä¸ä¸€å®šè¦ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆã€‚

@item int@ (*get_record)(char@ **out,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ struct@ awk_input *iobuf,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ int *errcode,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ char **rt_start,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ size_t *rt_len);
è¿™ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªåˆ›å»ºè¾“å…¥è®°å½•çš„å‡½æ•°ã€‚æ‰€è¿°çš„å‡½æ•°ä¹Ÿæ˜¯è¾“å…¥åˆ†æå™¨çš„æ ¸å¿ƒã€‚å®ƒçš„è¡Œä¸ºç”±æœ¬åˆ—è¡¨ä¸‹é¢çš„æ–‡æœ¬è¯´æ˜ã€‚

@item ssize_t (*read_func)();
è¿™ä¸ªå‡½æ•°æŒ‡é’ˆåº”è¯¥æŒ‡å‘ä¸æ ‡å‡†çš„ POSIX å‡½æ•° @code{read()} ç³»ç»Ÿè°ƒç”¨è¡Œä¸ºç›¸åŒçš„å‡½æ•°ã€‚å®ƒæ˜¯ @code{get_record} å‡½æ•°æŒ‡é’ˆçš„æ›¿ä»£ã€‚å®ƒçš„è¡Œä¸ºä¹Ÿåœ¨æœ¬åˆ—è¡¨åé¢çš„æ–‡æœ¬ä¸­æè¿°ã€‚

@item void (*close_func)(struct awk_input *iobuf);
è¿™ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªâ€œtear downâ€ï¼ˆç»“æŸï¼‰çš„å‡½æ•°ã€‚å®ƒåº”è¯¥é‡Šæ”¾æ‰€æœ‰ç”± @code{@var{XXX}_take_control_of()} åˆ†é…çš„èµ„æºã€‚å®ƒä¹Ÿå¯ä»¥å…³é—­æ–‡ä»¶ã€‚å¦‚æœå®ƒè¿™ä¹ˆåšäº†ï¼Œå®ƒåº”å°† @code{fd} åŸŸè®¾ç½®æˆ @code{INVALID_HANDLE}ã€‚

å¦‚æœ @code{fd} åœ¨è¿™ä¸ªå‡½æ•°è°ƒç”¨åè¿˜ä¸æ˜¯ @code{INVALID_HANDLE}ï¼Œ@command{gawk} ä¼šè°ƒç”¨å¸¸è§„çš„ @code{close()} ç³»ç»Ÿè°ƒç”¨ã€‚

æ˜¯å¦æœ‰â€œteardownâ€å‡½æ•°æ˜¯å¯é€‰çš„ã€‚å¦‚æœä½ çš„è¾“å…¥åˆ†æå™¨ä¸éœ€è¦å®ƒï¼Œå°±ä¸è¦è®¾ç½®è¿™ä¸ªåŸŸã€‚è¿™æ ·ï¼Œ@command{gawk} ä¼šåœ¨æ–‡ä»¶æè¿°ä¸Šè°ƒç”¨å¸¸è§„çš„ @code{close()} ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™ä¸ªåŸŸéœ€è¦æ˜¯æœ‰æ•ˆçš„ã€‚
@end table

@code{@var{XXX}_get_record()} å‡½æ•°æ‰§è¡Œåˆ›å»ºè®°å½•çš„å·¥ä½œã€‚å‚æ•°å¦‚ä¸‹ï¼š

@table @code
@item char **out
è¿™ä¸ªæ˜¯ä¸€ä¸ªæŒ‡å‘ @code{char *} å˜é‡çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘è®°å½•ã€‚@command{gawk} ä¼šå¤åˆ¶è‡ªå·±çš„æ•°æ®ï¼Œæ‰€ä»¥æ‰©å±•éœ€è¦è‡ªå·±ç®¡ç†è¿™ä¸ªå­˜å‚¨ã€‚

@item struct awk_input *iobuf
è¿™ä¸ªæ˜¯ç”¨äºæ–‡ä»¶çš„ @code{awk_input_buf_t}ï¼Œé‡Œé¢çš„åŸŸåº”å½“ç”¨äºè¯»å–æ•°æ®ï¼ˆ@code{fd}ï¼‰ä»¥åŠå¦‚æœæœ‰çš„è¯ï¼Œç®¡ç†ç§æœ‰çŠ¶æ€ï¼ˆ@code{opaque}ï¼‰ã€‚

@item int *errcode
å¦‚æœå‡ºç°äº†é”™è¯¯ã€‚@code{*errcode} åº”è¯¥è¢«è®¾ç½®æˆ @code{<errno.h>} æ–‡ä»¶ä¸­çš„ç›¸åº”ä»£ç ã€‚

@item char **rt_start
@itemx size_t *rt_len
å¦‚æœâ€œrecord terminatorâ€æœ‰æ„ä¹‰çš„è¯ï¼Œåˆ™ @code{*rt_start} åº”è¯¥è¢«è®¾ç½®æˆæŒ‡å‘ç”¨äº @code{RT} çš„æ•°æ®ã€‚è€Œ @code{*rt_len} åº”è¯¥è¢«è®¾ç½®æˆæ•°æ®çš„é•¿åº¦ã€‚å¦åˆ™ï¼Œ@code{*rt_len} åº”è¯¥è¢«è®¾ç½®ä¸º 0ã€‚@command{gawk} ä¼šç”Ÿæˆè‡ªå·±çš„æ•°æ®å¤æœ¬ï¼Œæ‰€ä»¥æ‰©å±•éœ€è¦è‡ªå·±ç®¡ç†å®ƒä»¬çš„å­˜å‚¨ã€‚
@end table

è¿”å›å€¼æ˜¯ç”± @code{*out} æŒ‡å‘çš„ç¼“å­˜çš„é•¿åº¦ï¼Œæˆ–è€…åœ¨æ–‡ä»¶ç»“æŸæ—¶è¿”å› @code{EOF}ï¼Œä»¥åŠé”™è¯¯æ—¶è¿”å›é”™è¯¯ã€‚

å¿…é¡»ä¿è¯ @code{errcode} æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æŒ‡é’ˆï¼Œå› æ­¤å°±æ²¡æœ‰å¿…è¦å»æµ‹è¯•å®ƒæ˜¯å¦ä¸º @code{NULL} å€¼ã€‚@command{gawk} è®¾ç½® @code{*errcode} ä¸º 0ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰é”™è¯¯çš„æ—¶å€™ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦è®¾ç½®å®ƒã€‚

å¦‚æœå‡ºç°çš„é”™è¯¯ï¼Œå‡½æ•°è¿”å› @code{EOF}ï¼Œå¹¶ä¸”è®¾ç½® @code{*errcode} ä¸ºä¸€ä¸ªå¤§äº 0 çš„å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ @code{*errcode} ä¸ç­‰äº 0ï¼Œ@command{gawk} ä¼šæ ¹æ® @code{*errcode} çš„å€¼è‡ªåŠ¨æ›´æ–° @code{ERRNO} å˜é‡ã€‚ï¼ˆä¸€èˆ¬è¯´æ¥ï¼Œè®¾ç½® @samp{*errcode = errno} å°±å¯ä»¥äº†ã€‚ï¼‰

ä½œä¸ºæ›¿ä»£ï¼Œæä¾›ä¸€ä¸ªè¿”å›è¾“å…¥è®°å½•çš„å‡½æ•°ï¼Œä½ æä¾›ä¸€ä¸ªç®€å•åœ°è¯»å–å­—èŠ‚çš„å‡½æ•°ï¼Œ@command{gawk} ä¼šå°†å®ƒä»–åˆ†æå¹¶ç»„åˆæˆè®°å½•ã€‚å¦‚æœä½ è¿™ä¹ˆåšï¼Œæ•°æ®åº”è¯¥ä»¥å½“å‰æœ¬åœ°è¯­è¨€è®¾ç½®çš„å¤šå­—èŠ‚ç¼–ç è¿”å›ã€‚è¿™æ ·çš„å‡½æ•°çš„è¡Œä¸ºåº”è¯¥ä¸ @code{read()} ç³»ç»Ÿè°ƒç”¨çš„ä¸€è‡´ï¼Œä½ å°† @code{awk_input_buf_t} ç»“æ„ä¸­çš„ @code{read_func} æŒ‡é’ˆå¡«ä¸ºè¿™ä¸ªå‡½æ•°æŒ‡é’ˆã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œ@command{gawk} ä¼šè®¾ç½® @code{read_func} æŒ‡å‘ @code{read()} ç³»ç»Ÿè°ƒç”¨çš„æŒ‡é’ˆã€‚æ‰€ä»¥ä½ çš„æ‰©å±•ä¸éœ€è¦æ˜¾å¼åœ°è¿™ä¹ˆå»åšã€‚

@quotation æç¤º
ä½ å¿…é¡»é€‰æ‹©ä¸€ä¸ªæˆ–è€…å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼šè¦ä¹ˆæ˜¯ä¸€ä¸ªè¿”å›è®°å½•çš„å‡½æ•°ï¼Œæˆ–è€…ä¸€ä¸ªè¿”å›åŸå§‹æ•°æ®çš„å‡½æ•°ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä½ æä¾›äº†ä¸€ä¸ªå‡½æ•°æ¥è·å–ä¸€ä¸ªè®°å½•ï¼Œ@command{gawk} ä¼šè°ƒç”¨å®ƒï¼Œè€Œç»ä¸ä¼šè°ƒç”¨åŸç”Ÿçš„ read å‡½æ•°ã€‚
@end quotation

@command{gawk} å‘å¸ƒäº†ä¸€ä¸ªèƒ½è¯»å–ç›®å½•çš„ä¾‹å­æ‰©å±•ï¼Œè¿”å›æŸä¸ªç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªè®°å½•ï¼ˆæŸ¥çœ‹ @pxref{Extension
Sample Readdir}ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªä»£ç æ¥ä½œä¸ºæŒ‡å¯¼æ¥å†™ä½ è‡ªå·±çš„è¾“å…¥åˆ†æå™¨ã€‚

å½“å†™ä¸€ä¸ªè¾“å…¥åˆ†æå™¨æ—¶ï¼Œä½ åº”è¯¥è¦è€ƒè™‘ï¼ˆå¹¶ä¸”ç”¨æ–‡ä»¶è®°å½•ä¸‹æ¥ï¼‰å®ƒå¦‚ä½•æ¥ä¸ @command{awk} ä»£ç è¿›è¡Œäº¤äº’ã€‚ä½ å¯èƒ½æƒ³å®ƒæ€»æ˜¯è¢«è°ƒç”¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ­£ç¡®å¤„ç†ï¼ˆå¦‚ @code{readdir} æ‰©å±•ä»£ç ä¸€æ ·ï¼‰ã€‚åˆæˆ–è€…ä½ æƒ³å®ƒæ ¹æ® @command{awk} å˜é‡çš„å€¼æ¥ç¡®å®šæ˜¯å¦è¢«è°ƒç”¨ï¼Œå¦‚æ¥è‡ª @code{gawkextlib} é¡¹ç›®ï¼ˆæŸ¥çœ‹ @pxref{gawkextlib}ï¼‰ä¸­çš„ XML æ‰©å±•ä¸€æ ·ã€‚åœ¨åé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨ @code{BEGINFILE} æ®µä¸­çš„ä»£ç å¯ä»¥æŸ¥çœ‹ @code{FILENAME} ä¸ @code{ERRNO} çš„å€¼æ¥å†³å®šæ˜¯å¦æ¿€æ´»è¾“å…¥åˆ†æå™¨ï¼ˆæŸ¥çœ‹ @pxref{BEGINFILE/ENDFILE}ï¼‰ã€‚

ä½ é€šè¿‡ä¸‹é¢çš„å‡½æ•°æ¥æ³¨å†Œè¾“å…¥åˆ†æå™¨ï¼š

@table @code
@item void register_input_parser(awk_input_parser_t *input_parser);
æ³¨å†Œé€šè¿‡ @code{input_parser} æŒ‡å‘çš„è¾“å…¥åˆ†æå™¨åˆ° @command{gawk} ä¸­ã€‚
@end table

@node Output Wrappers
@subsubsection å®šåˆ¶è¾“å‡ºåŒ…è£…å™¨
@cindex customized output wrapper

@cindex output wrapper
@dfn{è¾“å‡ºåŒ…è£…å™¨}æ˜¯è¾“å…¥åˆ†æå™¨çš„å¦ä¸€é¢ã€‚å®ƒå¯ä»¥ä½¿å¾—æ‰©å±•èƒ½å¤ŸæŒæ¡é€šè¿‡ @samp{>} æˆ–è€… @samp{>>} é‡å®šå‘I/Oæ“ä½œç¬¦æ‰“å¼€æ–‡ä»¶ï¼ˆæŸ¥çœ‹ @pxref{Redirection}ï¼‰ã€‚

è¾“å‡ºåŒ…è£…å™¨çš„ç»“æ„ä¸è¾“å…¥åˆ†æå™¨çš„ç»“æ„éå¸¸ç›¸ä¼¼ï¼š

@example
typedef struct awk_output_wrapper @{
    const char *name;   /* name of the wrapper */
    awk_bool_t (*can_take_file)(const awk_output_buf_t *outbuf);
    awk_bool_t (*take_control_of)(awk_output_buf_t *outbuf);
    awk_const struct awk_output_wrapper *awk_const next;  /* for gawk */
@} awk_output_wrapper_t;
@end example

æˆå‘˜å¦‚ä¸‹ï¼š

@table @code
@item const char *name;
è¿™é‡Œè¾“å‡ºåŒ…è£…å™¨çš„åå­—ã€‚

@item awk_bool_t (*can_take_file)(const awk_output_buf_t *outbuf);
è¿™ä¸ªæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ£€æµ‹ç”± @code{outbuf} æŒ‡å‘ @code{awk_output_buf_t} ç»“æ„çš„ä¿¡æ¯ã€‚å¦‚æœè¾“å‡ºåŒ…è£…å™¨æƒ³æŒæ§è¾“å‡ºæ–‡ä»¶ï¼Œåˆ™åº”è¯¥è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚å®ƒä¸åº”è¯¥æ”¹å˜ä»»ä½• @command{gawk} çš„çŠ¶æ€ï¼ˆæ¯”å¦‚å˜é‡ç­‰ï¼‰ã€‚

@item awk_bool_t (*take_control_of)(awk_output_buf_t *outbuf);
ç”±è¿™ä¸ªåŸŸæ‰€æŒ‡å‘çš„å‡½æ•°åœ¨ @command{gawk} å†³å®šä½¿è¾“å‡ºåŒ…è£…å™¨æ§åˆ¶æ–‡ä»¶çš„æ—¶å€™è°ƒç”¨ã€‚å®ƒåº”è¯¥å°† @code{awk_output_buf_t} ç»“æ„ä¸­çš„æˆå‘˜é€‚åº”åœ°å¡«å……ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ç›¸å…³çš„è¯´æ˜åœ¨ä¸‹é¢æè¿°ã€‚

@item awk_const struct output_wrapper *awk_const next;
è¿™ä¸ªç”± @command{gawk} ä½¿ç”¨ï¼Œå› æ­¤å®ƒè¢«æ ‡å¿—ä¸º @code{awk_const}ï¼Œè¿™æ ·æ‰©å±•å°±ä¸èƒ½å¤Ÿä¿®æ”¹å®ƒã€‚
@end table

@code{awk_output_buf_t} çš„ç»“æ„å¦‚ä¸‹ï¼š

@example
typedef struct awk_output_buf @{
    const char *name;   /* name of output file */
    const char *mode;   /* mode argument to fopen */
    FILE *fp;           /* stdio file pointer */
    awk_bool_t redirected;  /* true if a wrapper is active */
    void *opaque;       /* for use by output wrapper */
    size_t (*gawk_fwrite)(const void *buf, size_t size, size_t count,
                FILE *fp, void *opaque);
    int (*gawk_fflush)(FILE *fp, void *opaque);
    int (*gawk_ferror)(FILE *fp, void *opaque);
    int (*gawk_fclose)(FILE *fp, void *opaque);
@} awk_output_buf_t;
@end example

è¿™é‡Œä¹Ÿä¸€æ ·ï¼Œä½ çš„æ–½å±•è¦å®šä¹‰ @code{@var{XXX}_can_take_file()} ä¸ @code{@var{XXX}_take_control_of()} è¿™äº›å‡½æ•°ï¼Œç”¨ä»¥æ£€æµ‹å¹¶æ›´æ–° @code{awk_output_buf_t} ä¸­çš„æˆå‘˜ã€‚æ•°æ®æˆå‘˜çš„è¯´æ˜å¦‚ä¸‹ï¼š

@table @code
@item const char *name;
è¾“å‡ºæ–‡ä»¶çš„åå­—ã€‚

@item const char *mode;
æ¨¡å¼å­—ä¸²ï¼ˆæ­£å¦‚ @code{fopen()} ç¬¬äºŒä¸ªå‚æ•°ä¸€æ ·ä½¿ç”¨ï¼‰ï¼Œé€šè¿‡ä½¿ç”¨è¿™äº›æ¨¡å¼æ¥æ‰“å¼€æ–‡ä»¶ã€‚

@item FILE *fp;
æ¥è‡ªç”± @code{<stdio.h>} çš„ @code{FILE} æŒ‡é’ˆã€‚@command{gawk} ä¼šåœ¨æŸ¥æ‰¾è¾“å‡ºåŒ…è£…å™¨å‰è¯•ç€æ‰“å¼€æ–‡ä»¶ã€‚

@item awk_bool_t redirected;
è¿™ä¸ªåŸŸå¿…é¡»è¢« @code{@var{XXX}_take_control_of()} è®¾ç½®ä¸º trueã€‚

@item void *opaque;
è¿™ä¸ªæŒ‡é’ˆå¯¹äº @command{gawk} æ˜¯é€æ˜çš„ã€‚æ‰©å±•å¯ä»¥ä½¿ç”¨å®ƒæ¥å­˜å‚¨ä¸æ–‡ä»¶æœ‰å…³çš„ç§æœ‰æ•°æ®çš„æŒ‡é’ˆã€‚

@item size_t (*gawk_fwrite)(const void *buf, size_t size, size_t count,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ FILE *fp, void *opaque);
@itemx int (*gawk_fflush)(FILE *fp, void *opaque);
@itemx int (*gawk_ferror)(FILE *fp, void *opaque);
@itemx int (*gawk_fclose)(FILE *fp, void *opaque);
è¿™äº›æŒ‡é’ˆåº”è¯¥è¢«è®¾ç½®ä¸ºæŒ‡å‘ä¸ @code{<stdio.h>} ä¸­ç›¸åº”å‡½æ•°æ‰§è¡Œç›¸åŒæ“ä½œçš„å‡½æ•°ã€‚@command{gawk} ä½¿ç”¨è¿™äº›å‡½æ•°æ¥å¤„ç†æ‰€æœ‰è¾“å‡ºã€‚@command{gawk} ä¼šå°†è¿™äº›æŒ‡é’ˆåˆå§‹åŒ–æŒ‡å‘å†…éƒ¨çš„â€œè¿‡è·¯â€å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä¸­æ˜¯è°ƒç”¨å¸¸è§„çš„ @code{<stdio.h>} å‡½æ•°ï¼Œæ‰€ä»¥æ‰©å±•è¦æ ¹æ®æ‰€è¦åšçš„äº‹æƒ…å®šä¹‰åˆé€‚å‡½æ•°ã€‚
@end table

@code{@var{XXX}_can_take_file()} å‡½æ•°å¯ä»¥æ ¹æ® @code{name}ï¼Œ@code{mode} åŸŸä»¥åŠå…¶ä»–çš„çŠ¶æ€ï¼ˆå¦‚ @command{awk} å˜é‡çš„å€¼ï¼‰æ¥åšå‡ºç›¸åº”çš„å†³å®šã€‚

å½“ @command{gawk} è°ƒç”¨ @code{@var{XXX}_take_control_of()} å‡½æ•°æ—¶ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥å¯¹å…¶ä»–çš„åŸŸè¿›è¡Œé€‚å½“çš„å¡«å……ï¼Œä¸åŒ…æ‹¬ @code{fp}ï¼Œ@code{fp} å‚æ•°åªæ˜¯ä¼šè¿›è¡Œå¸¸è§„ä½¿ç”¨ã€‚

ä½ é€šè¿‡ä¸‹é¢çš„å‡½æ•°æ¥æ³¨å†Œä½ çš„è¾“å‡ºåŒ…è£…å™¨ï¼š

@table @code
@item void register_output_wrapper(awk_output_wrapper_t *output_wrapper);
å°†ç”± @code{output_wrapper} æŒ‡å‘çš„è¾“å‡ºåŒ…è£…å™¨æ³¨å†Œåˆ° @command{gawk} ä¸­ã€‚
@end table

@node Two-way processors
@subsubsection å®šåˆ¶åŒè·¯å¤„ç†å™¨
@cindex customized two-way processor

ä¸€ä¸ª@dfn{åŒè·¯å™¨}å°†è¾“å…¥åˆ†æå™¨ä¸è¾“å‡ºåŒ…è£…å™¨æ¥å¤„ç†ç”± @samp{|&} æ‰“å¼€çš„åŒè·¯ I/Oï¼ˆæŸ¥çœ‹ @pxref{Redirection}ï¼‰ã€‚å®ƒçš„ä½¿ç”¨ä¸ä¹‹å‰æè¿°è¿‡çš„ @code{awk_input_parser_t} ä¸ @code{awk_output_buf_t} ç›¸åŒã€‚

ä¸¤è·¯å¤„ç†å™¨ç”±ä¸‹é¢çš„ç»“æ„è¡¨ç¤ºï¼š

@example
typedef struct awk_two_way_processor @{
    const char *name;   /* name of the two-way processor */
    awk_bool_t (*can_take_two_way)(const char *name);
    awk_bool_t (*take_control_of)(const char *name,
                                  awk_input_buf_t *inbuf,
                                  awk_output_buf_t *outbuf);
    awk_const struct awk_two_way_processor *awk_const next;  /* for gawk */
@} awk_two_way_processor_t;
@end example

åŸŸå¦‚ä¸‹ï¼š

@table @code
@item const char *name;
åŒè·¯å¤„ç†å™¨çš„åå­—ã€‚

@item awk_bool_t (*can_take_two_way)(const char *name);
å¦‚æœç”±è¿™ä¸ªåŸŸæŒ‡å‘çš„å‡½æ•°æƒ³æ§åˆ¶@value{FN}çš„åŒè·¯ I/Oï¼Œå®ƒåº”è¯¥è¿”å› trueã€‚å®ƒä¸åº”è¯¥æ”¹å˜ @command{gawk} ä¸­çš„ä»»ä½•çŠ¶æ€ï¼ˆæ¯”å¦‚å˜é‡å€¼ï¼‰ã€‚

@item awk_bool_t (*take_control_of)(const char *name,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_input_buf_t *inbuf,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_output_buf_t *outbuf);
ç”±è¿™ä¸ªåŸŸæŒ‡å‘çš„å‡½æ•°åº”è¯¥é€‚å½“åœ°å¡«å……ç”± @code{inbuf} ä¸ @code{outbuf} æ‰€æŒ‡å‘ä¸­çš„ @code{awk_input_buf_t} ä¸ @code{awk_output_buf_t} çš„ç»“æ„ã€‚è¿™ä¸¤ä¸ªç»“æ„ä¹‹å‰æ‰€æè¿°ã€‚

@item awk_const struct two_way_processor *awk_const next;
è¿™ä¸ªç”± @command{gawk} æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒè¢«æ ‡å¿—æˆ @code{awk_const}ï¼Œè¿™æ ·æ‰©å±•å°±ä¸å¯ä»¥ä¿®æ”¹å®ƒã€‚
@end table

å¯¹äºè¾“å…¥å¤„ç†å™¨ä¸è¾“å‡ºå¤„ç†å™¨å™¨ï¼Œä½ éœ€è¦æä¾›â€œyes I can take thisâ€ï¼ˆæ˜¯çš„ï¼Œæˆ‘å¯ä»¥å¤„ç†è¿™ä¸ªï¼‰ ä¸â€œtake over for thisâ€ï¼ˆæˆ‘å·²ç»æ§åˆ¶è¿™ä¸ªï¼‰ç±»çš„å‡½æ•°ï¼Œå³ @code{@var{XXX}_can_take_two_way()} ä¸ @code{@var{XXX}_take_control_of()}ã€‚

ä½ ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°æ¥æ³¨å†Œä½ çš„åŒè·¯å¤„ç†å™¨ï¼š

@table @code
@item void register_two_way_processor(awk_two_way_processor_t *two_way_processor);
å°†ç”± @code{two_way_processor} æŒ‡å‘çš„åŒè·¯å¤„ç†å™¨æ³¨å†Œåˆ° @command{gawk} ä¸­ã€‚
@end table

@node Printing Messages
@subsection æ‰“å°ä¿¡æ¯
@cindex printing messages from extensions
@cindex messages from extensions

ä½ å¯ä»¥åœ¨ä½ çš„æ‰©å±•ä¸­æ‰“å°å¦‚æœ¬èŠ‚ä¸­æ‰€æè¿°çš„ä¸åŒçš„å„ç±»çš„å‘Šè­¦ä¿¡æ¯ã€‚è¦æ³¨æ„å¯¹äºè¿™äº›å‡½æ•°ï¼Œä½ å¿…é¡»æä¾›ä¸€ä¸ªæ‰©å±• IDï¼Œè¿™ä¸ªæ‰©å±• ID æ˜¯åœ¨æ‰©å±•è¢«è½½å…¥æ—¶ç”± @command{gawk} æä¾›ï¼š
@footnote{ç”±äº API åªä½¿ç”¨ ISO C 90 çš„ç‰¹æ€§ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ ISO C 99 çš„å¯èƒ½å‚æ•°å®ç‰¹æ€§æ¥éšè—å‚æ•°ã€‚å¤šå°‘æœ‰ç‚¹é—æ†¾ã€‚}

@table @code
@item void fatal(awk_ext_id_t id, const char *format, ...);
æ‰“å°ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶ä½¿ @command{gawk} ç«‹å³é€€å‡ºã€‚

@item void warning(awk_ext_id_t id, const char *format, ...);
æ‰“å°å‘Šè­¦ä¿¡æ¯ã€‚

@item void lintwarn(awk_ext_id_t id, const char *format, ...);
æ‰“å°ä¸€ä¸ªâ€œlint å‘Šè­¦â€ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸æ‰“å°ä¸€ä¸ªå‘Šè­¦ä¿¡æ¯ä¸€æ ·ï¼Œä½†æ˜¯å¦‚æœ @command{gawk} ä½¿ç”¨äº† @samp{--lint=fatal} é€‰é¡¹ï¼Œåˆ™ lint å‘Šè­¦ä¼šæˆä¸ºè‡´å‘½é”™è¯¯æ¶ˆæ¯ã€‚
@end table

æ‰€æœ‰çš„è¿™äº›å‡½æ•°åƒ C çš„ @code{printf()} å®¶åº­çš„å‡½æ•°ä¸€æ ·ï¼Œåœ¨è¿™äº›å‡½æ•°ä¸­ï¼Œ@code{format} å‚æ•°æ˜¯ä¸€ä¸ªå­—ä¸²ï¼Œä¸²ä¸­ä¸ºå­—é¢å­—ç¬¦ä»¥åŠæ ¼å¼ä»£ç ã€‚

@node Updating @code{ERRNO}
@subsection æ›´æ–° @code{ERRNO}

ä¸‹é¢çš„å‡½æ•°å¯ä»¥è®©ä½ æ›´æ–° @code{ERRNO} å˜é‡ï¼š

@table @code
@item void update_ERRNO_int(int errno_val);
å°† @code{ERRNO} è®¾ç½®ä¸ºä¸ @code{errno_val} å¯¹åº”çš„é”™è¯¯å­—ä¸²ã€‚å€¼åº”è¯¥å®šä¹‰åœ¨ @code{<errno.h>} ä¸­ã€‚@command{gawk} ä¼šä½¿ç”¨ C çš„ @code{strerror()} å‡½æ•°å°†å®ƒè½¬æ¢ä¸ºï¼ˆå¦‚æœå¯ä»¥è½¬æ¢ï¼‰å­—ä¸²ã€‚

@item void update_ERRNO_string(const char *string);
ç›´æ¥ä½¿ç”¨ @code{ERRNO} çš„å­—ç¬¦ä¸²å€¼æ¥è®¾ç½® @code{ERRNO}ã€‚@command{gawk} ä¼šå¯¹è¿™ä¸ªå€¼å¤åˆ¶ä¸€ä¸ªå¤æœ¬ã€‚

@item void unset_ERRNO(void);
é‡ç½® @code{ERRNO}ã€‚
@end table

@node Requesting Values
@subsection è¯·æ±‚å€¼

æ‰€æœ‰çš„è¿™äº›å‡½æ•°éƒ½ä»¥ç›¸åŒçš„æ–¹å¼ä» @command{gawk} ä¸­è¿”å›å€¼ã€‚ä½ å¯ä»¥ä¼ é€’ä¸€ä¸ª @code{awk_valtype_t} çš„å€¼æ¥æŒ‡ç¤ºä½ å¸Œæœ›ä»€ä¹ˆçš„æ ·å€¼ã€‚å¦‚æœå®é™…çš„å€¼ä¸ä½ çš„è¯·æ±‚çš„åŒ¹é…ï¼Œå‡½æ•°è¿”å›ä¸º trueã€‚å¹¶ä¸”åœ¨ @code{awk_value_t} ä¸­å¡«ä¸Šç»“æœã€‚å¦åˆ™å‡½æ•°è¿”å› falseã€‚è€Œ @code{val_type} æˆå‘˜ä¼šæŒ‡ç¤ºå®é™…çš„å€¼ç±»å‹ã€‚ä½ ç„¶åå¯ä»¥æ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯æˆ–è€…é‡æ–°å‘èµ·é’ˆå¯¹å®é™…å€¼ç±»å‹çš„è¯·æ±‚ã€‚è¿™ç»“è¡Œä¸ºåœ¨ @ref{table-value-types-returned} è¿›è¡Œäº†å½’çº³ï¼š

@float Table,table-value-types-returned
@caption{è¿”å›çš„ API å€¼ç±»å‹}
@docbook
<informaltable>
<tgroup cols="6">
  <colspec colwidth="16.6*"/>
  <colspec colwidth="16.6*"/>
  <colspec colwidth="19.8*" colname="c3"/>
  <colspec colwidth="15*" colname="c4"/>
  <colspec colwidth="15*" colname="c5"/>
  <colspec colwidth="16.6*" colname="c6"/>
  <spanspec spanname="hspan" namest="c3" nameend="c6" align="center"/>
  <thead>
    <row><entry></entry><entry spanname="hspan"><para>Type of Actual Value</para></entry></row>
    <row>
      <entry></entry>
      <entry></entry>
      <entry><para>String</para></entry>
      <entry><para>Number</para></entry>
      <entry><para>Array</para></entry>
      <entry><para>Undefined</para></entry>
    </row>
  </thead>
  <tbody>
    <row>
      <entry></entry>
      <entry><para><emphasis role="bold">String</emphasis></para></entry>
      <entry><para>String</para></entry>
      <entry><para>String</para></entry>
      <entry><para>False</para></entry>
      <entry><para>False</para></entry>
    </row>
    <row>
      <entry></entry>
      <entry><para><emphasis role="bold">Number</emphasis></para></entry>
      <entry><para>Number if can be converted, else false</para></entry>
      <entry><para>Number</para></entry>
      <entry><para>False</para></entry>
      <entry><para>False</para></entry>
    </row>
    <row>
      <entry><para><emphasis role="bold">Type</emphasis></para></entry>
      <entry><para><emphasis role="bold">Array</emphasis></para></entry>
      <entry><para>False</para></entry>
      <entry><para>False</para></entry>
      <entry><para>Array</para></entry>
      <entry><para>False</para></entry>
    </row>
    <row>
      <entry><para><emphasis role="bold">Requested</emphasis></para></entry>
      <entry><para><emphasis role="bold">Scalar</emphasis></para></entry>
      <entry><para>Scalar</para></entry>
      <entry><para>Scalar</para></entry>
      <entry><para>False</para></entry>
      <entry><para>False</para></entry>
    </row>
    <row>
      <entry></entry>
      <entry><para><emphasis role="bold">Undefined</emphasis></para></entry>
      <entry><para>String</para></entry>
      <entry><para>Number</para></entry>
      <entry><para>Array</para></entry>
      <entry><para>Undefined</para></entry>
    </row>
    <row>
      <entry></entry>
      <entry><para><emphasis role="bold">Value cookie</emphasis></para></entry>
      <entry><para>False</para></entry>
      <entry><para>False</para></entry>
      <entry><para>False</para>
      </entry><entry><para>False</para></entry>
    </row>
  </tbody>
</tgroup>
</informaltable>
@end docbook

@ifnotplaintext
@ifnotdocbook
@multitable @columnfractions .50 .50
@headitem @tab Type of Actual Value
@end multitable
@c 10/2014: Thanks to Karl Berry for this bit to reduce the space:
@tex
\vglue-1.1\baselineskip
@end tex
@multitable @columnfractions .166 .166 .198 .15 .15 .166
@headitem @tab @tab String @tab Number @tab Array @tab Undefined
@item @tab @b{String} @tab String @tab String @tab False @tab False
@item @tab @b{Number} @tab Number if can be converted, else false @tab Number @tab False @tab False
@item @b{Type} @tab @b{Array} @tab False @tab False @tab Array @tab False
@item @b{Requested} @tab @b{Scalar} @tab Scalar @tab Scalar @tab False @tab False
@item @tab @b{Undefined} @tab String @tab Number @tab Array @tab Undefined
@item @tab @b{Value cookie} @tab False @tab False @tab False @tab False
@end multitable
@end ifnotdocbook
@end ifnotplaintext
@ifplaintext
@example
                        +-------------------------------------------------+
                        |                Type of Actual Value:            |
                        +------------+------------+-----------+-----------+
                        |   String   |   Number   | Array     | Undefined |
+-----------+-----------+------------+------------+-----------+-----------+
|           | String    |   String   |   String   | False     | False     |
|           |-----------+------------+------------+-----------+-----------+
|           | Number    | Number if  |   Number   | False     | False     |
|           |           | can be     |            |           |           |
|           |           | converted, |            |           |           |
|           |           | else false |            |           |           |
|           |-----------+------------+------------+-----------+-----------+
|   Type    | Array     |   False    |   False    | Array     | False     |
| Requested |-----------+------------+------------+-----------+-----------+
|           | Scalar    |   Scalar   |   Scalar   | False     | False     |
|           |-----------+------------+------------+-----------+-----------+
|           | Undefined |  String    |   Number   | Array     | Undefined |
|           |-----------+------------+------------+-----------+-----------+
|           | Value     |   False    |   False    | False     | False     |
|           | cookie    |            |            |           |           |
+-----------+-----------+------------+------------+-----------+-----------+
@end example
@end ifplaintext
@end float

@node Accessing Parameters
@subsection è®¿é—®ä¸æ›´æ–°å‚æ•°

æœ‰ä¸¤ä¸ªå‡½æ•°å¯ä»¥è®©ä½ è®¿é—®ä¼ é€’ç»™ä½ çš„æ‰©å±•å‡½æ•°çš„å‚æ•°ã€‚å®ƒä»¬æ˜¯ï¼š

@table @code
@item awk_bool_t get_argument(size_t count,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_valtype_t wanted,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_value_t *result);
ç”¨ç¬¬ @code{count} ä¸ªå‚æ•°æ¥å¡«å……ç”± @code{result} æŒ‡å‘çš„ @code{awk_value_t} ç»“æ„ã€‚å¦‚æœå®é™…çš„ç±»å‹ä¸ @code{wanted} æ˜¯åŒ¹é…çš„ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚åœ¨åé¢çš„æƒ…å†µä¸‹ï¼Œ@code{result@w{->}val_type} æŒ‡ç¤ºäº†å®é™…çš„ç±»å‹ï¼ˆæŸ¥çœ‹ @pxref{table-value-types-returned}ï¼‰ã€‚è®¡æ•°æ˜¯ä» 0 å¼€å§‹çš„â€”â€”ç¬¬ä¸€ä¸ªå‚æ•°ç¼–å·ä¸º 0ï¼Œç¬¬äºŒä¸ªä¸º 1ï¼Œç­‰ç­‰ã€‚@code{wanted} æŒ‡ç¤ºäº†æ‰€æœŸæœ›çš„å€¼ç±»å‹ã€‚

@item awk_bool_t set_argument(size_t count, awk_array_t array);
å°†æœªå®šä¹‰çš„å‚æ•°è½¬æ¢ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œè¿™æä¾›äº†é€šè¿‡æ•°ç»„å¼•ç”¨æ¥è°ƒç”¨çš„æ–¹å¼ã€‚å¦‚æœ @code{count} å¤ªå¤§ï¼Œæˆ–è€…å¦‚æœå‚æ•°ç±»å‹æ˜¯æœªå®šä¹‰çš„ï¼Œåˆ™è¿”å› falseã€‚æŸ¥çœ‹ @ref{Array Manipulation}ï¼Œæ¥æŸ¥çœ‹åˆ›å»ºæ•°ç»„çš„æ›´å¤šä¿¡æ¯ã€‚
@end table

@node Symbol Table Access
@subsection ç¬¦å·è¡¨è®¿é—®
@cindex accessing global variables from extensions

æœ‰ä¸¤ä¸ªé›†åˆçš„ä¾‹ç¨‹æä¾›äº†è®¿é—®å…¨å±€å˜é‡çš„èƒ½åŠ›ï¼Œä»¥åŠä¸€ä¸ªé›†åˆçš„ä¾‹ç¨‹å¯ä»¥è®©ä½ åˆ›å»ºå¹¶é‡Šæ”¾ç¼“å­˜å€¼ã€‚

@menu
* Symbol table by name::        Accessing variables by name.
* Symbol table by cookie::      Accessing variables by ``cookie''.
* Cached values::               Creating and using cached values.
@end menu

@node Symbol table by name
@subsubsection é€šè¿‡åå­—è®¿é—®ä¸æ›´æ–°å˜é‡

ä¸‹é¢çš„ä¾‹ç¨‹æä¾›äº†é€šè¿‡åå­—æ¥è®¿é—®ã€æ›´æ–°å…¨å±€çš„ @command{awk} å±‚å˜é‡çš„èƒ½åŠ›ã€‚ä»¥ç¼–è¯‘å™¨çš„æœ¯è¯­æ¥çœ‹ï¼Œä¸åŒå„ç±»çš„æ ‡è¯†ç¬¦éƒ½ç§°ä¸º@dfn{ç¬¦å·}ï¼Œè¿™æ˜¯ä¾‹ç¨‹ä¸­çš„â€œsymâ€åå­—çš„æ¥ç”±ã€‚å­˜å‚¨ç¬¦å·ä¿¡æ¯çš„æ•°ç»„ç»“æ„ç§°ä¸º@dfn{ç¬¦å·è¡¨}ã€‚è¿™äº›å‡½æ•°å¦‚ä¸‹ï¼š

@table @code
@item awk_bool_t sym_lookup(const char *name,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_valtype_t wanted,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_value_t *result);
ç”¨ç”±å­—ä¸² @code{name} å‘½ä»¤çš„å˜é‡çš„å€¼æ¥å¡«å……ç”± @code{result} æŒ‡å‘å¬ @code{awk_value_t} çš„ç»“æ„ï¼Œåå­—ä¸º C å­—ä¸²ã€‚@code{wanted} æŒ‡ç¤ºäº†æœŸæœ›çš„å€¼çš„ç±»å‹ã€‚å¦‚æœå®é™…çš„ç±»å‹ä¸å…¶åŒ¹é…ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚åœ¨åé¢çš„æƒ…å†µä¸‹ï¼Œ@code{result->val_type} æŒ‡ç¤ºäº†å®é™…çš„ç±»å‹ï¼ˆæŸ¥çœ‹ @pxref{table-value-types-returned}ï¼‰ã€‚

@item awk_bool_t sym_update(const char *name, awk_value_t *value);
æ›´æ–°ç”±å­—ä¸² @code{name} å‘½åçš„å˜é‡ï¼Œè¿™ä¸ªåå­—ä¸º C å­—ä¸²ã€‚å¦‚æœå˜é‡ä¸å­˜åœ¨ @command{gawk} çš„ç¬¦å·è¡¨ä¸­ï¼Œåˆ™ä¼šæ–°å¢å®ƒã€‚å¦‚æœä¸€åˆ‡ OKï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚

æ”¹å˜å·²ç»å­˜åœ¨çš„å˜é‡çš„ç±»å‹ï¼ˆä»æ ‡é‡åˆ°æ•°ç»„ï¼Œæˆ–è€…ç›¸åï¼‰æ˜¯@emph{ä¸}å…è®¸çš„ï¼Œè¿™ä¸ªä¾‹ç¨‹ä¹Ÿä¸èƒ½ç”¨äºæ•°ç»„çš„æ›´æ–°ã€‚è¿™ä¸ªä¾‹ç¨‹ä¸å¯ä»¥ç”¨äºæ›´æ–°ä»»ä½•çš„é¢„å®šä¹‰å˜é‡çš„å€¼ï¼ˆå¦‚ @code{ARGC} æˆ–è€… @code{NF}ï¼‰ã€‚
@end table

æ‰©å±•å¯ä»¥æŸ¥æ‰¾ @command{gawk} çš„ç‰¹å®šå˜é‡ã€‚ä½†æ˜¯ï¼Œ@code{PROCINFO} æ•°ç»„æ˜¯ä¸ªä¾‹å¤–ï¼Œæ‰©å±•ä¸å¯ä»¥æ”¹å˜è¿™äº›å˜é‡çš„å€¼ã€‚

@quotation æ³¨æ„
æœ‰å¯èƒ½æŸ¥æ‰¾ @code{PROCINFO} å¤±è´¥ã€‚å¦‚æœ @command{awk} ç¨‹åºåœ¨è¿è¡Œæ—¶æ²¡æœ‰ä½¿ç”¨ @code{PROCINFO} æ—¶ä¼šå¼•èµ·å¤±è´¥ï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œ@command{gawk} ä¸ä¼šåˆ›å»ºè¿™ä¸ªæ•°ç»„å¹¶ä¼ æ’­å®ƒã€‚
@end quotation

@node Symbol table by cookie
@subsubsection é€šè¿‡ Cookie è®¿é—®ä¸æ›´æ–°å˜é‡

@dfn{æ ‡é‡ cookie} æ˜¯ä¸€ä¸ªé€æ˜çš„å¥æŸ„ï¼Œå¯ä»¥ç”¨æ¥è®¿é—®å…¨å±€å˜é‡ä»¥åŠæ•°ç»„ã€‚å®ƒæ˜¯ä¸€ç§ä¼˜åŒ–æ‰‹æ®µï¼Œä»¥å…åœ¨ä½¿ç”¨å˜é‡æ—¶å»åœ¨ @command{gawk} çš„ç¬¦å·è¡¨ä¸­å»æŸ¥æ‰¾å˜é‡ï¼Œè¿™ä¸ªæ—©å‰åœ¨ @ref{General Data Types}ï¼Œå·²ç»è®¨è®ºè¿‡ã€‚

ä¸‹é¢çš„å‡½æ•°ç”¨æ¥è¿‡å¤„ç†æ ‡é‡ cookiesï¼š

@table @code
@item awk_bool_t sym_lookup_scalar(awk_scalar_t cookie,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_valtype_t wanted,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_value_t *result);
è¿”å›æ ‡é‡ cookie çš„å½“å‰å€¼ï¼Œä¸€æ—¦ä½ é€šè¿‡ @code{sym_lookup()} è·å–äº†ä¸€ä¸ªæ ‡é‡çš„ cookie åï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥é«˜æ•ˆåœ°è·å–å®ƒçš„å€¼ã€‚å¦‚æœå€¼æ²¡æœ‰å–åˆ°ï¼Œåˆ™è¿”å› falseã€‚

@item awk_bool_t sym_update_scalar(awk_scalar_t cookie, awk_value_t *value);
æ›´æ–°ä¸æ ‡é‡ cookie å…³è”çš„å€¼ã€‚å¦‚æœæ–°å€¼å³ä¸æ˜¯ @code{AWK_STRING}ï¼Œä¹Ÿä¸æ˜¯ @code{AWK_NUMBER}ï¼Œåˆ™è¿”å› falseã€‚åœ¨è¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œé¢„å®šçš„ä¹‰çš„å˜é‡ä¸èƒ½è¢«æ›´æ–°çš„ã€‚
@end table

ä¸€å¼€å§‹è¿™å¦‚ä½•æ¥ä½¿ç”¨æ ‡é‡ Cookie å¹¶ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œä¹Ÿä¸çŸ¥é“å®ƒä»¬çš„ @i{raison d'@^etre} åˆ°åº•æ˜¯ä»€ä¹ˆã€‚ç†è®ºä¸Šï¼Œ@code{sym_lookup()} ä»¥åŠ @code{sym_update()} ä¾‹ç¨‹å°±æ˜¯ä½ æ¥å¤„ç†å˜é‡æ—¶æ‰€è¦çš„æ‰€æœ‰ä¾‹ç¨‹ã€‚ä¾‹å¦‚ï¼Œä½ æœ‰ä»£ç è¦æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¯¹æ¡ä»¶è¿›è¡Œæ±‚å€¼ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡æ±‚å€¼çš„ç»“æœå˜æ›´å˜é‡çš„å€¼ï¼Œå¦‚ï¼š

@example
/*  do_magic --- do something really great */

static awk_value_t *
do_magic(int nargs, awk_value_t *result)
@{
    awk_value_t value;

    if (   sym_lookup("MAGIC_VAR", AWK_NUMBER, & value)
        && some_condition(value.num_value)) @{
            value.num_value += 42;
            sym_update("MAGIC_VAR", & value);
    @}

    return make_number(0.0, result);
@}
@end example

@noindent
è¿™ä¸ªä»£ç çœ‹èµ·æ¥ï¼ˆå®é™…ï¼‰å¾ˆç®€å•è€Œç›´æ¥ï¼Œä½†æ˜¯é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

è€ƒè™‘ä¸€ä¸‹ï¼Œå¦‚æœ @command{awk} å±‚çš„ä»£ç é€šè¿‡è°ƒç”¨ @code{magic()} å‡½æ•°ï¼ˆé€šè¿‡ C çš„ @code{do_magic()} æ¥å®ç°ï¼‰æ¥ä¸ä½ çš„æ‰©å±•è¿›è¡Œå…³è”ï¼Œä¸€æ¬¡ä¸€æ¡è®°å½•æ¥å¤„ç†æ•°ä»¥ç™¾ä¸‡è®¡çš„è®°å½•ã€‚å˜é‡ @code{MAGIC_VAR} ä¼šåœ¨æ¯ä¸ªå‡½æ•°çš„è°ƒç”¨ä¸­éƒ½åœ¨ç¬¦å·è¡¨ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼

ç¬¦å·è¡¨çš„æŸ¥æ‰¾çœŸçš„æ˜¯ä¸ªçº¯çš„è´Ÿæ‹…ï¼Œå¦‚æœå¾—åˆ°ä¸€ä¸ªè¡¨ç¤ºè¿™ä¸ªå˜é‡çš„ cookie è¦æ›´é«˜æ•ˆï¼Œå¹¶ä½¿ç”¨å®ƒåœ¨å¿…è¦çš„æ—¶å€™è·å–ä¸æ›´æ–°å®ƒçš„å€¼ã€‚ 
@footnote{ç›¸ä¿¡æˆ‘ä»¬ï¼Œå·®å¼‚æ˜¯å¯æµ‹é‡å¹¶ä¸”çœŸå®çš„ã€‚}

æ‰€ä»¥ï¼Œä½¿ç”¨ cookie çš„æ–¹å¼å¦‚ä¸‹ã€‚é¦–å…ˆï¼Œå°†ä½ çš„å˜é‡é€šè¿‡ @code{sym_update()} æ¥å®‰è£…åˆ° @command{gawk} çš„ç¬¦å·è¡¨ä¸­ï¼Œç„¶åé€šè¿‡ @code{sym_lookup()} è·å–ä¸€ä¸ªè¯¥å˜é‡çš„ Cookieï¼š

@example
static awk_scalar_t magic_var_cookie;    /* cookie for MAGIC_VAR */

static void
my_extension_init()
@{
    awk_value_t value;

    /* install initial value */
    sym_update("MAGIC_VAR", make_number(42.0, & value));

    /* get the cookie */
    sym_lookup("MAGIC_VAR", AWK_SCALAR, & value);

    /* save the cookie */
    magic_var_cookie = value.scalar_cookie;
    @dots{}
@}
@end example

ä¸‹ä¸€æ­¥ï¼Œä½¿ç”¨è¿™@value{SECTION}ä¸­çš„å‡½æ•°æ¥å¹¶é€šè¿‡ Cookie æ¥è¿”å›ä¸æ›´æ–°å˜é‡çš„å€¼ã€‚æ‰€ä»¥ï¼Œ@code{do_magic()} ç°åœ¨å˜æˆå¦‚ä¸‹ï¼š

@example
/*  do_magic --- do something really great */

static awk_value_t *
do_magic(int nargs, awk_value_t *result)
@{
    awk_value_t value;

    if (   sym_lookup_scalar(magic_var_cookie, AWK_NUMBER, & value)
        && some_condition(value.num_value)) @{
            value.num_value += 42;
            sym_update_scalar(magic_var_cookie, & value);
    @}
    @dots{}

    return make_number(0.0, result);
@}
@end example

@quotation æç¤º
å‰é¢çš„ä»£ç çœç•¥äº†é”™è¯¯æ£€æŸ¥ï¼Œä¸ºäº†æ˜¯è¡¨ç°ä¸»é¢˜ã€‚ä½ çš„æ‰©å±•ä»£ç åº”è¯¥è¦æ›´åŠ å¥å£®ï¼Œå¹¶ä¸”ä»”ç»†åœ°æ£€æŸ¥ä» API å‡½æ•°ä¸­è¿”å›çš„å€¼ã€‚
@end quotation

@node Cached values
@subsubsection åˆ›å»ºå¹¶ä½¿ç”¨ç¼“å­˜å€¼

æœ¬@value{SECTION}ä¸­çš„å…¨ç¨‹å¯ä»¥è®©ä½ åˆ›å»ºä¸é‡Šæ”¾ç¼“å­˜å€¼ã€‚åƒæ ‡é‡ cookie ä¸€æ ·ï¼Œç†è®ºä¸Šè®²ï¼Œç¼“å­˜å€¼æ˜¯ä¸éœ€è¦çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨ @ref{Constructor Functions} ä¸­çš„å‡½æ•°åˆ›å»ºæ•°å€¼ä¸å­—ä¸²ã€‚ä½ ç„¶åå¯ä»¥å°†è¿™äº›å€¼èµ‹ç»™ä½¿ç”¨ @code{sym_update()} æˆ–è€… @code{sym_update_scalar()} çš„å˜é‡ã€‚

ä½†æ˜¯ï¼Œå¦‚æœä½ è®°å¾—@emph{æ‰€æœ‰}çš„å­—ä¸²å€¼çš„å­˜å‚¨@emph{å¿…é¡»}æ¥è‡ªäº @code{gawk_malloc()}ï¼Œ@code{gawk_calloc()} æˆ–è€… @code{gawk_realloc()} è¿™äº›å‡½æ•°è¿™ä¸€ç‚¹ï¼Œä½ å°±èƒ½å¤Ÿç†è§£ç¼“å­˜å€¼çš„å‡ºå‘ç‚¹ã€‚å¦‚æœä½ æœ‰ 20 ä¸ªå˜é‡ï¼Œå®ƒä»¬éƒ½æœ‰ç›¸åŒçš„å€¼ï¼Œä½ å¿…é¡»åˆ›å»º 20 ä¸ªç›¸åŒçš„å­—ä¸²å¤æœ¬ã€‚ @footnote{æ•°å€¼å€¼é—®é¢˜å°±å°‘å¾—å¤šï¼Œå› ä¸ºåªéœ€è¦å­˜å‚¨ä¸€ä¸ª C çš„ @code{double} ç±»å‹ã€‚}

å½“ç„¶ï¼Œå¦‚æœå¯èƒ½ï¼Œä¸€æ—¦åˆ›å»ºä¸€ä¸ªå€¼ï¼Œå°±å¯ä»¥å‘Šè¯‰ @command{gawk} å¯ä»¥ä¸ºå¤šä¸ªå˜é‡é‡ç”¨è¿™ä¸ªå€¼ã€‚è¿™æ­£æ˜¯æœ¬@value{SECTION}ä¸­çš„ä¾‹ç¨‹æ‰€è¦åšçš„äº‹æƒ…ã€‚å‡½æ•°å¦‚ä¸‹ï¼š

@table @code
@item awk_bool_t create_value(awk_value_t *value, awk_value_cookie_t *result);
åˆ›å»ºä¸€ä¸ªç¼“å­˜çš„å­—ä¸²æˆ–è€…æ•°å€¼ï¼Œç”¨äºåé¢çš„é«˜æ•ˆèµ‹å€¼ã€‚ä»…æ”¯æŒ @code{AWK_NUMBER} ä¸ @code{AWK_STRING} ç±»å‹çš„å€¼ã€‚å…¶ä»–çš„ç±»å‹ä¼šè¢«æ‹’ç»ã€‚@code{AWK_UNDEFINED} ç±»å‹ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯è¿™ä¹ˆåšä¼šå¯¼è‡´è¾ƒå·®çš„æ€§èƒ½ã€‚

@item awk_bool_t release_value(awk_value_cookie_t vc);
é‡Šæ”¾ä¸ä¸€ä¸ªé€šè¿‡ @code{create_value()} è·å–çš„å€¼ cookie å…³è”çš„å†…å­˜ã€‚
@end table

ä½¿ç”¨å€¼ cookie çš„æ–¹å¼ä¸ä½¿ç”¨æ ‡é‡ cookie çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚åœ¨æ‰©å±•åˆå§‹åŒ–ä¾‹ç¨‹ä¸­ï¼Œä½ è¿™æ ·æ¥åˆ›å»ºå€¼ cookieï¼š

@example
static awk_value_cookie_t answer_cookie;  /* static value cookie */

static void
my_extension_init()
@{
    awk_value_t value;
    char *long_string;
    size_t long_string_len;

    /* code from earlier */
    @dots{}
    /* @dots{} fill in long_string and long_string_len @dots{} */
    make_malloced_string(long_string, long_string_len, & value);
    create_value(& value, & answer_cookie);    /* create cookie */
    @dots{}
@}
@end example

å€¼ä¸€æ—¦åˆ›å»ºï¼Œä½ å°±å¯ä»¥ç”¨å®ƒä½œä¸ºä»»æ„å˜é‡çš„å€¼ï¼š

@example
static awk_value_t *
do_magic(int nargs, awk_value_t *result)
@{
    awk_value_t new_value;

    @dots{}    /* as earlier */

    value.val_type = AWK_VALUE_COOKIE;
    value.value_cookie = answer_cookie;
    sym_update("VAR1", & value);
    sym_update("VAR2", & value);
    @dots{}
    sym_update("VAR100", & value);
    @dots{}
@}
@end example

@noindent
é€šè¿‡è¿™æ ·çš„å€¼ cookies å¯ä»¥èŠ‚çº¦å¤§é‡çš„å­˜å‚¨ï¼Œä» @code{VAR1} åˆ° @code{VAR100} éƒ½å…±äº«ä¸€æ ·çš„å€¼ã€‚

ä½ å¯èƒ½ä¼šå¥‡æ€ªï¼Œâ€œè¿™æ ·çš„å…±äº«ä¸ä¼šæœ‰é—®é¢˜ä¹ˆï¼Ÿå¦‚æœ @command{awk} ä»£ç ç»™ @code{VAR1} èµ‹äº†ä¸€ä¸ªæ–°å€¼ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„å…¶ä»–å˜é‡éƒ½ä¼šæ”¹å˜ï¼Ÿâ€

è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚ç­”æ¡ˆæ˜¯ä¸ä¼šï¼Œè¿™ä¸ä¼šæ˜¯ä¸ªé—®é¢˜ã€‚åœ¨å†…éƒ¨ï¼Œ@command{gawk} ä½¿ç”¨@dfn{å‚è€ƒè®¡æ•°çš„å­—ä¸²}ã€‚è¿™å°±æ˜¯è¯´ï¼Œè®¸å¤šçš„å˜é‡éƒ½å¯ä»¥ä½¿ç”¨å…±äº«çš„å­—ä¸²å€¼ï¼Œ@command{gawk} ä¼šè·Ÿè¸ªå®ƒçš„ä½¿ç”¨ã€‚å½“å˜é‡å€¼æ”¹å˜æ—¶ï¼Œ@command{gawk} ä»…æ˜¯ç®€å•åœ°é€’å‡æ—§å€¼çš„å‚è€ƒè®¡æ•°ï¼Œç„¶åæ›´æ–°å˜é‡è®©å…¶ä½¿ç”¨æ–°çš„å€¼ã€‚

æœ€åï¼Œä½œä¸ºæ¸…é™¤æ“ä½œçš„ä¸€éƒ¨åˆ†ï¼ˆæŸ¥çœ‹ @pxref{Exit Callback Functions}ï¼‰ï¼Œä½ åº”è¯¥é€šè¿‡ @code{release_value()} æ¥é‡Šæ”¾ä½ åˆ›å»ºçš„ç¼“å­˜å€¼ã€‚

@node Array Manipulation
@subsection æ•°ç»„æ“ä½œ
@cindex array manipulation in extensions

åœ¨ @command{awk} ä¸­ï¼Œæœ€é‡è¦çš„æ•°æ®ç»“æ„@footnote{å¥½å§ï¼Œä¹Ÿæ˜¯å”¯ä¸€çš„æ•°æ®ç»“æ„ã€‚}
ä¸æ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{Arrays}ï¼‰ç›¸å…³ã€‚æ‰©å±•éœ€è¦æœ‰èƒ½åŠ›æ“ä½œ @command{awk} ä¸­çš„æ•°ç»„ã€‚API ä¸­æä¾›äº†å¾ˆå¤šçš„æ•°æ®ç»“æ„æ¥å¤„ç†æ•°ç»„ï¼Œä¹Ÿæä¾›äº†å¤„ç†å•ä¸ªå…ƒç´ çš„å‡½æ•°ï¼Œä»¥åŠå¤„ç†æ•´ä¸ªæ•°ç»„çš„å‡½æ•°ã€‚è¿™åŒ…å«äº†æ‰å¹³åŒ–æ•°ç»„çš„èƒ½åŠ›ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“ä½¿ç”¨ C ä»£ç æ¥éå†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚æ•°ç»„æ•°æ®ç»“æ„å¾ˆå¥½åœ°ä¸å€¼çš„æ•°æ®ç»“æ„è¿›è¡Œäº†æ•´åˆï¼Œä½¿å¾—å¾ˆå®¹æ˜“æ¥åˆ›å»ºçœŸæ­£çš„å¤šç»´æ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{General Data Types}ï¼‰ã€‚

@menu
* Array Data Types::            Data types for working with arrays.
* Array Functions::             Functions for working with arrays.
* Flattening Arrays::           How to flatten arrays.
* Creating Arrays::             How to create and populate arrays.
@end menu

@node Array Data Types
@subsubsection æ•°ç»„æ•°æ®ç±»å‹

ä¸æ•°ç»„ç›¸å…³çš„æ•°æ®ç±»å‹æœ‰ï¼š

@table @code
@item typedef void *awk_array_t;
å¦‚æœä½ è¯·æ±‚ä¸€ä¸ªæ•°ç»„å˜é‡çš„å€¼ï¼Œä½ å¯ä»¥å–å¾—ä¸€ä¸ª @code{awk_array_t} çš„å€¼ã€‚è¿™ä¸ªå€¼
@footnote{å®ƒä¹Ÿæ˜¯ä¸€ä¸ªâ€œcookieâ€ï¼Œä½†æ˜¯ @command{gawk} å¼€å‘å¾—ä¸æƒ³è¿‡å¤šåœ°ä½¿ç”¨è¿™ä¸ªæœ¯è¯­ã€‚}
å¯¹äºæ‰©å±•æ¥è¯´æ˜¯é€æ˜çš„ã€‚
è¿™å”¯ä¸€åœ°æ ‡è¯†æ•°ç»„ï¼Œä½†æ˜¯åªå¯ä»¥å°†å…¶ä¼ é€’ç»™ API å‡½æ•°æ¥ä½¿ç”¨ï¼Œæˆ–è€…ä» API å‡½æ•°ä¸­è¿”å›ã€‚è¿™ä¸ªæ–¹å¼ä¸ @code{<stdio.h>} ä¸­å‡½æ•°ä½¿ç”¨ @samp{FILE *} å€¼ç±»ä¼¼ã€‚

@item typedef struct awk_element @{
@itemx @ @ @ @ /* convenience linked list pointer, not used by gawk */
@itemx @ @ @ @ struct awk_element *next;
@itemx @ @ @ @ enum @{
@itemx @ @ @ @ @ @ @ @ AWK_ELEMENT_DEFAULT = 0,@ @ /* set by gawk */
@itemx @ @ @ @ @ @ @ @ AWK_ELEMENT_DELETE = 1@ @ @ @ /* set by extension */
@itemx @ @ @ @ @} flags;
@itemx @ @ @ @ awk_value_t    index;
@itemx @ @ @ @ awk_value_t    value;
@itemx @} awk_element_t;
@code{awk_element_t} æ˜¯ä¸€ä¸ªå¹³çš„æ•°ç»„å…ƒç´ ã€‚@command{awk} ä¼šåœ¨ @code{awk_flat_array_t} ç±»å‹ä¸­ç”Ÿæˆä¸€ä¸ªæ­¤ç±»å‹çš„æ•°ç»„ï¼ˆæŸ¥çœ‹ä¸‹ä¸€é¡¹çš„è¯´æ˜ï¼‰ã€‚å•ä¸ªçš„å…ƒç´ å¯ä»¥è¢«æ ‡å¿—æˆåˆ é™¤ã€‚æ–°çš„å…ƒç´ å¿…é¡»ä¸€ä¸ªä¸ªåœ°æ·»åŠ ï¼Œä¸€æ¬¡ä¸€ä¸ªã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªæ·»åŠ ï¼Œè¦ä½¿ç”¨å¦å¤–çš„ APIã€‚æ•°æ®ç»“æ„ä¸­çš„åŸŸä¸ºï¼š

@c nested table
@table @code
@item struct awk_element *next;
è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿æ‰©å±•çš„ç¼–å†™è€…çš„ä¸€ä¸ªæŒ‡é’ˆã€‚å®ƒå…è®¸æ‰©å±•åˆ›å»ºä¸€ä¸ªæ–°å…ƒç´ çš„é“¾è¡¨ï¼Œè¿™æ ·å¯ä»¥åœ¨éå†åˆ—è¡¨æ—¶æ¥åŠ å…¥åˆ°æ•°ç»„ä¸­ã€‚

@item enum @{ @dots{} @} flags;
åœ¨æ‰©å±•ä¸ @command{gawk} ä¹‹é—´ä¼ é€’ä¿¡æ¯çš„æ ‡å¿—å€¼ã€‚å½“å‰åªæœ‰ä¸€ä¸ª @code{AWK_ELEMENT_DELETE}ï¼Œå¦‚æœè®¾ç½®è¿™ä¸ªæ ‡å¿—ï¼Œä¼šä½¿å¾— @command{gawk} é‡Šæ”¾æ‰å¹³çš„æ•°ç»„æ—¶ï¼Œä»åŸå§‹çš„æ•°ç»„ä¸­åˆ é™¤è¿™ä¸ªå…ƒç´ ã€‚

@item index
@itemx value
å…ƒç´ çš„ç´¢å¼•ä¸å€¼ã€‚@emph{æ‰€æœ‰}è¢« @code{index} ä¸ @code{value} æŒ‡å‘çš„å†…å­˜éƒ½å±äº @command{gawk}ã€‚
@end table

@item typedef struct awk_flat_array @{
@itemx @ @ @ @ awk_const void *awk_const opaque1;@ @ @ @ /* for use by gawk */
@itemx @ @ @ @ awk_const void *awk_const opaque2;@ @ @ @ /* for use by gawk */
@itemx @ @ @ @ awk_const size_t count;@ @ @ @ @ /* how many elements */
@itemx @ @ @ @ awk_element_t elements[1];@ @ /* will be extended */
@itemx @} awk_flat_array_t;
è¿™æ˜¯ä¸€ä¸ªå¹³é¢æ•°ç»„ã€‚å½“æ‰©å±•ä» @command{gawk} ä¸­å–å¾—å…¶ä¸­ä¹‹ä¸€æ—¶ï¼Œå…ƒç´ æ•°ç»„ @code{elements} çš„å®é™…å¤§å°å°±æ˜¯ @code{count}ã€‚@code{opaque1} ä¸ @code{opaque2} æŒ‡é’ˆç”± @command{gawk} ä½¿ç”¨ï¼Œæ‰€ä»¥ï¼Œå®ƒä»¬è¢«æ ‡å¿—æˆ @code{awk_const}ï¼Œè¿™æ ·æ‰©å±•å°±ä¸å¯ä»¥ä¿®æ”¹å®ƒä»¬ã€‚
@end table

@node Array Functions
@subsubsection æ•°ç»„å‡½æ•°

ä¸‹é¢çš„å‡½æ•°ä¸å•ä¸ªçš„å…ƒç´ ç›¸å…³ï¼š

@table @code
@item awk_bool_t get_element_count(awk_array_t a_cookie, size_t *count);
ä¸ºç”± @code{a_cookie} è¡¨ç¤ºçš„æ•°ç»„ï¼Œæ”¾å…¥å…¶åŒ…å«çš„ @code{*count} ä¸ªå…ƒç´ ã€‚å­æ•°ç»„ç”±ä¸€ä¸ªå•ç‹¬çš„å…ƒç´ è¡¨ç¤ºã€‚å¦‚æœæœ‰é”™è¯¯æ—¶ï¼Œè¿”å› falseã€‚

@item awk_bool_t get_array_element(awk_array_t a_cookie,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ const awk_value_t *const index,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_valtype_t wanted,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_value_t *result);
ä» @code{a_cookie} è¡¨ç¤ºçš„æ•°ç»„ä¸­ï¼Œè¿”å›å…ƒç´ ä¸‹æ ‡ @code{index} çš„å€¼åˆ° @code{*result} ä¸­ã€‚@code{wanted} æŒ‡å®šäº†ä½ å¸Œæœ›è¿”å›çš„å€¼ç±»å‹ã€‚å¦‚æœ @code{wanted} ä¸ä¸å®é™…çš„ç±»å‹åŒ¹é…ï¼Œæˆ–è€… @code{index} æ²¡æœ‰åœ¨æ•°ç»„ä¸­ï¼Œåˆ™è¿”å› falseã€‚ï¼ˆæŸ¥çœ‹ @pxref{table-value-types-returned}ï¼‰

@code{index} çš„å€¼å¯ä»¥æ˜¯æ•°å€¼ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ@command{gawk} ä¼šå°†å…¶è½¬æ¢ä¸ºå­—ä¸²ã€‚ä¸ä½¿ç”¨æ•´æ•°å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯éœ€è¦ä½ äº†è§£è¿™æ ·çš„å€¼å¦‚ä½•è½¬æ¢ä¸ºå­—ä¸²ï¼ˆæŸ¥çœ‹ @pxref{Conversion}ï¼‰ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨æ•´æ•°å€¼æ˜¯æœ€å®‰å…¨çš„ã€‚

ä¸ä»æ‰©å±•ä¸­ä¼ é€’åˆ° @command{gawk} ä¸­çš„@emph{æ‰€æœ‰}çš„å­—ä¸²ä¸€æ ·ï¼Œ@code{index} çš„å­—ä¸²å€¼å¿…é¡»æ¥è‡ªäº @code{gawk_malloc()}ï¼Œ@code{gawk_calloc()} æˆ–è€… @code{gawk_realloc()}ï¼Œå¹¶ç”± @command{gawk} æ¥é‡Šæ”¾å†…å­˜ã€‚

@item awk_bool_t set_array_element(awk_array_t a_cookie,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ const@ awk_value_t *const index,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ const@ awk_value_t *const value);
åœ¨ç”± @code{a_cookie} è¡¨ç¤ºçš„æ•°ç»„ä¸­ï¼Œåˆ›å»ºæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ çš„ç´¢å¼•ç”± @code{index} ç»™å‡ºã€‚@code{ARGV} ä¸ @code{ENVIRON} æ•°ç»„ä¸å¯ä»¥è¢«æ”¹å˜ï¼Œä½†æ˜¯ @code{PROCINFO} æ•°ç»„åˆ™å¯ä»¥ã€‚

@item awk_bool_t set_array_element_by_elem(awk_array_t a_cookie,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_element_t element);
ä¸ @code{set_array_element()} ç›¸ä¼¼ï¼Œä½†æ˜¯æ˜¯ä»å…ƒç´  @code{element} ä¸­å–å¾—ç´¢å¼• @code{index} ä¸å€¼ @code{value}ã€‚è¿™æ˜¯ä¸€ä¸ªä¾¿åˆ©å®ã€‚

@item awk_bool_t del_array_element(awk_array_t a_cookie,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ const awk_value_t* const index);
åˆ é™¤ç”± @code{a_cookie} è¡¨ç¤ºçš„æ•°ç»„ä¸­æŒ‡å®šç´¢å¼•çš„å…ƒç´ ã€‚å¦‚æœå…ƒç´ è¢«åˆ é™¤ï¼Œåˆ™è¿”å› trueã€‚å¦åˆ™ï¼Œå¦‚æœå…ƒç´ ä¸å­˜åœ¨æ•°ç»„ä¸­ï¼Œåˆ™è¿”å› falseã€‚
@end table

ä¸‹é¢çš„å‡½æ•°ä¸æ•´ä¸ªæ•°ç»„æœ‰å…³ï¼š

@table @code
@item awk_array_t create_array(void);
åˆ›å»ºä¸€ä¸ªå¯ä»¥æ·»åŠ å…ƒç´ çš„æ•°ç»„ã€‚æŸ¥çœ‹ @ref{Creating Arrays}ï¼Œä¸­å¯¹äºåˆ›å»ºæ•°ç»„å¹¶æ·»åŠ å…ƒç´ çš„è®¨è®ºã€‚

@item awk_bool_t clear_array(awk_array_t a_cookie);
æ¸…é™¤ç”± @code{a_cookie} è¡¨ç¤ºçš„æ•°ç»„ã€‚å¦‚æœæœ‰é—®é¢˜è¿”å› falseï¼Œå¦åˆ™è¿”å› trueã€‚æ•°ç»„è¿˜æ˜¯æ•°ç»„ï¼Œä½†æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°åï¼Œå®ƒå°±æ²¡æœ‰å…ƒç´ äº†ã€‚è¿™ä¸ªä¸ @code{delete} è¯­å¥ç­‰åŒï¼ˆæŸ¥çœ‹ @pxref{Delete}ï¼‰ã€‚

@item awk_bool_t flatten_array(awk_array_t a_cookie, awk_flat_array_t **data);
ä¸ºç”± @code{a_cookie} è¡¨ç¤ºçš„æ•°ç»„ï¼Œåˆ›å»ºä¸€ä¸ª @code{awk_flat_array_t} çš„ç»“æ„å¹¶è¿›è¡Œå¡«å……ã€‚å°†é€šè¿‡ @code{data} ä¼ é€’çš„æŒ‡é’ˆçš„å€¼è®¾ç½®ä¸ºè¿™ä¸ªç»“æ„çš„åœ°å€ã€‚å¦‚æœæˆåŠŸåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
@ifset FOR_PRINT
ä¸‹ä¸€ä¸ª@value{SECTION}
@end ifset
@ifclear FOR_PRINT
æŸ¥çœ‹ @ref{Flattening Arrays}ï¼Œ
@end ifclear
è®¨è®ºå¦‚ä½•æ¥æ‰å¹³åŒ–æ•°ç»„å¹¶å¤„ç†å®ƒã€‚

@item awk_bool_t release_flattened_array(awk_array_t a_cookie,
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ awk_flat_array_t *data);
å½“å®Œæˆäº†æ•°ç»„çš„æ‰å¹³åŒ–ï¼Œé‡Šæ”¾ä½¿ç”¨è¿™ä¸ªå‡½æ•°çš„å­˜å‚¨ã€‚ä½ å¿…é¡»å°†æœ€åˆçš„æ•°ç»„ cookie ä¸åˆ›å»ºçš„ @code{awk_flat_array_t} æ•°ç»„ç»“æ„çš„åœ°å€éƒ½ä¼ é€’è¿›å»ã€‚å¦‚æœæˆåŠŸè¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
@end table

@node Flattening Arrays
@subsubsection éå†æ•°ç»„çš„æ‰€æœ‰å…ƒç´ 

@dfn{æ‰å¹³åŒ–}æ•°ç»„å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¡¨ç¤ºæ•´ä¸ªæ•°ç»„ï¼Œå…¶é£æ ¼ä½¿å¾—å¾ˆå®¹æ˜“ä½¿ç”¨ C ä»£ç æ¥éå†æ•´ä¸ªæ•°ç»„ã€‚åœ¨ @file{extension/testext.c} ä¸­çš„ä¸€äº›ä»£ç å°±æ˜¯æ¥åšè¿™äº›äº‹æƒ…ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•æ¥ä½¿ç”¨ APIã€‚

æˆ‘ä»¬ä¸€æ­¥æ­¥åœ°æ¥è¿‡è¿™é‡Œé¢çš„ä»£ç ã€‚é¦–å…ˆ @command{gawk} è„šæœ¬æ¥é©±åŠ¨æµ‹è¯•æ‰©å±•ï¼š

@example
@@load "testext"
BEGIN @{
    n = split("blacky rusty sophie raincloud lucky", pets)
    printf("pets has %d elements\n", length(pets))
    ret = dump_array_and_delete("pets", "3")
    printf("dump_array_and_delete(pets) returned %d\n", ret)
    if ("3" in pets)
        printf("dump_array_and_delete() did NOT remove index \"3\"!\n")
    else
        printf("dump_array_and_delete() did remove index \"3\"!\n")
    print ""
@}
@end example

@noindent
è¿™ä¸ªä»£ç ä½¿ç”¨ @code{split()} å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„ï¼ˆæŸ¥çœ‹ @ref{String Functions}ï¼‰ç„¶åè°ƒç”¨ @code{dump_array_and_delete()}ã€‚è¿™ä¸ªå‡½æ•°ç”¨äºæŸ¥æ‰¾æ•°ç»„ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°ç»„åï¼Œè€Œåˆ é™¤çš„å…ƒç´ çš„ç´¢å¼•é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æ¥ä¼ é€’ã€‚@command{awk} ä»£ç ç„¶åæ‰“å°è¿”å›çš„å€¼å¹¶æ£€æŸ¥å…ƒç´ æ˜¯å¦çœŸçš„è¢«åˆ é™¤äº†ã€‚ä¸‹é¢æ˜¯ @code{dump_array_and_delete()} å‡½æ•°çš„C ä»£ç å®ç°ã€‚ä¸ºäº†è¡¨ç°ä¸Šçš„åŸå› åšäº†ä¸€äº›ä¿®æ”¹ã€‚

ç¬¬ä¸€éƒ¨åˆ†æ˜¯å£°æ˜å˜é‡ï¼Œè®¾ç½®é»˜è®¤çš„è¿”å›å€¼åˆ° @code{result} ä¸­ï¼Œå¹¶æ£€æŸ¥å‡½æ•°çš„è°ƒç”¨æ˜¯é€šè¿‡æ­£ç¡®çš„å‚æ•°ä¸ªæ¥è°ƒç”¨çš„ï¼š

@example
static awk_value_t *
dump_array_and_delete(int nargs, awk_value_t *result)
@{
    awk_value_t value, value2, value3;
    awk_flat_array_t *flat_array;
    size_t count;
    char *name;
    int i;

    assert(result != NULL);
    make_number(0.0, result);

    if (nargs != 2) @{
        printf("dump_array_and_delete: nargs not right "
               "(%d should be 2)\n", nargs);
        goto out;
    @}
@end example

å‡½æ•°ç„¶åä¸€æ­¥æ­¥åœ°æ‰§è¡Œï¼Œå¦‚ä¸‹ã€‚é¦–å…ˆè¿”å›æ•°ç»„çš„åå­—ï¼Œå…¶ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°åˆä¼ é€’ã€‚ç„¶åæ˜¯æ•°ç»„æœ¬èº«ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ“ä½œå¤±è´¥ï¼Œåˆ™æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶è¿”å›ï¼š

@example
    /* get argument named array as flat array and print it */
    if (get_argument(0, AWK_STRING, & value)) @{
        name = value.str_value.str;
        if (sym_lookup(name, AWK_ARRAY, & value2))
            printf("dump_array_and_delete: sym_lookup of %s passed\n",
                   name);
        else @{
            printf("dump_array_and_delete: sym_lookup of %s failed\n",
                   name);
            goto out;
        @}
    @} else @{
        printf("dump_array_and_delete: get_argument(0) failed\n");
        goto out;
    @}
@end example

ä¸ºäº†æµ‹è¯•å¹¶ç¡®ä¿ C ä»£ç çœ‹ä»£çš„å…ƒç´ ä¸ªæ•°ä¸ @command{awk} ä»£ç çœ‹åˆ°çš„å…ƒç´ ä¸ªæ•°æ˜¯ä¸€æ ·çš„ï¼Œç¬¬äºŒæ­¥æ˜¯æ¥è·å–æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ç„¶åæ‰“å°å®ƒï¼š

@example
    if (! get_element_count(value2.array_cookie, & count)) @{
        printf("dump_array_and_delete: get_element_count failed\n");
        goto out;
    @}

    printf("dump_array_and_delete: incoming size is %lu\n",
           (unsigned long) count);
@end example

ç¬¬ä¸‰æ­¥æ˜¯æ‰§è¡Œå®é™…çš„æ•°ç»„æ‰å¹³åŒ–ï¼Œç„¶åå†æ¬¡æ£€æŸ¥ @code{awk_flat_array_t} ä¸­çš„æ•°é‡æ˜¯ä¸åˆšæ‰è¿”å›çš„æ•°é‡æ˜¯ä¸€æ ·çš„ï¼š

@example
    if (! flatten_array(value2.array_cookie, & flat_array)) @{
        printf("dump_array_and_delete: could not flatten array\n");
        goto out;
    @}

    if (flat_array->count != count) @{
        printf("dump_array_and_delete: flat_array->count (%lu)"
               " != count (%lu)\n",
                (unsigned long) flat_array->count,
                (unsigned long) count);
        goto out;
    @}
@end example

ç¬¬å››æ­¥æ˜¯è¿”å›è¦è¢«åˆ é™¤çš„å…ƒç´ çš„ç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•æ˜¯é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æ¥ä¼ é€’çš„ã€‚è¦è®°ä½ä¼ é€’åˆ° @code{get_argument()} å‡½æ•°ä¸­çš„å‚æ•°ç¼–å·æ˜¯ä» 0 å¼€å§‹çš„ï¼Œå› æ­¤ç¬¬äºŒä¸ªå‚æ•°è¢«ç¼–å·ä¸º 1 ï¼š

@example
    if (! get_argument(1, AWK_STRING, & value3)) @{
        printf("dump_array_and_delete: get_argument(1) failed\n");
        goto out;
    @}
@end example

ç¬¬äº”æ­¥æ˜¯æ‰§è¡Œâ€œçœŸæ­£çš„â€æ“ä½œã€‚å‡½æ•°å¾ªç¯æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæ‰“å°å…¶ç´¢å¼•ä¸å…¶å…ƒç´ å€¼ã€‚å¦å¤–ï¼Œå½“æ‰¾åˆ°è¦åˆ é™¤å…ƒç´ çš„ç´¢å¼•æ—¶ï¼Œå‡½æ•°è®¾ç½® @code{AWK_ELEMENT_DELETE} ä½åˆ°å…ƒç´ çš„ @code{flags} åŸŸä¸­ã€‚å½“æ•°ç»„è¢«é‡Šæ”¾æ—¶ï¼Œ@command{gawk} ä¼šéå†æ‰å¹³åŒ–åçš„æ•°ç»„ï¼Œç„¶ååˆ é™¤é‚£äº›è¢«è®¾ç½®äº†è¯¥ä½çš„å…ƒç´ ï¼š

@example
    for (i = 0; i < flat_array->count; i++) @{
        printf("\t%s[\"%.*s\"] = %s\n",
            name,
            (int) flat_array->elements[i].index.str_value.len,
            flat_array->elements[i].index.str_value.str,
            valrep2str(& flat_array->elements[i].value));

        if (strcmp(value3.str_value.str,
                   flat_array->elements[i].index.str_value.str) == 0) @{
            flat_array->elements[i].flags |= AWK_ELEMENT_DELETE;
            printf("dump_array_and_delete: marking element \"%s\" "
                   "for deletion\n",
                flat_array->elements[i].index.str_value.str);
        @}
    @}
@end example

ç¬¬å…­æ­¥æ˜¯é‡Šæ”¾æ‰å¹³åŒ–åçš„æ•°ç»„ã€‚è¿™ä¼šå‘Šè¯‰ @command{gawk} æ‰©å±•å·²ç»ä¸å†ä½¿ç”¨æ•°ç»„ï¼Œå®ƒå¯ä»¥åˆ é™¤æ‰€æœ‰å·²ç»è¢«æ ‡å¿—çš„å…ƒç´ ã€‚@command{gawk} ä¹Ÿä¼šé‡Šæ”¾è¢«åˆ†é…çš„å­˜å‚¨ï¼Œå› æ­¤ï¼Œåœ¨è°ƒç”¨ @code{release_flattened_array()} å‡½æ•°åï¼Œä½ ä¸è¦å†ä½¿ç”¨é‡Œé¢çš„æŒ‡é’ˆï¼ˆåœ¨è¿™ä¸ªä»£ç ä¸­ä¸º @code{flat_array}ï¼‰ï¼š

@example
    if (! release_flattened_array(value2.array_cookie, flat_array)) @{
        printf("dump_array_and_delete: could not release flattened array\n");
        goto out;
    @}
@end example

æœ€åï¼Œç”±äºä¸€åˆ‡äº‹æƒ…éƒ½æ‰§è¡Œè‰¯å¥½ï¼Œå‡½æ•°å°†è¿”å›å€¼è®¾ç½®ä¸ºæˆåŠŸï¼Œç„¶åè¿”å›ï¼š

@example
    make_number(1.0, result);
out:
    return result;
@}
@end example

è¿™é‡Œæ˜¯è¿è¡Œæµ‹è¯•éƒ¨åˆ†çš„è¾“å‡ºï¼š

@example
pets has 5 elements
dump_array_and_delete: sym_lookup of pets passed
dump_array_and_delete: incoming size is 5
        pets["1"] = "blacky"
        pets["2"] = "rusty"
        pets["3"] = "sophie"
dump_array_and_delete: marking element "3" for deletion
        pets["4"] = "raincloud"
        pets["5"] = "lucky"
dump_array_and_delete(pets) returned 1
dump_array_and_delete() did remove index "3"!
@end example

@node Creating Arrays
@subsubsection å¦‚ä½•ç”Ÿæˆä¸å‘å¸ƒæ•°ç»„

é™¤äº†é€šè¿‡ @command{awk} ä»£ç æ¥å¤„ç†æ•°ç»„å¤–ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºæ•°ç»„ç„¶åå‘å¸ƒå®ƒä»¬ï¼Œç„¶å @command{awk} ä»£ç ä¹Ÿå¯ä»¥è®¿é—®å¹¶å¤„ç†å®ƒä»¬ã€‚

ä»æ‰©å±•ä¸­åˆ›å»ºæ•°ç»„æœ‰ä¸¤ä¸ªé‡ç‚¹ï¼š

@itemize @value{BULLET}
@item
ä½ å¿…é¡»å°†æ–°çš„æ•°ç»„åˆ›å»ºåç«‹å³å®‰è£…åˆ° @command{gawk} çš„ç¬¦å·è¡¨ä¸­ã€‚è¿™ä¹ˆåšäº†åï¼Œå°±å¯ä»¥å‘å¸ƒä½ çš„æ•°ç»„ã€‚

@ignore
Strictly speaking, this is required only
for arrays that will have subarrays as elements; however it is
a good idea to always do this.  This restriction may be relaxed
in a subsequent revision of the API.
@end ignore

ç›¸ä¼¼çš„ï¼Œå¦‚æœå°†æŸä¸ªæ•°ç»„å®‰è£…æˆå·²ç»å­˜åœ¨çš„æ•°ç»„çš„å­æ•°ç»„ï¼Œä½ å¿…é¡»åœ¨å‘å®ƒæ·»åŠ ä»»ä½•å…ƒç´ ä¹‹å‰å°†å…¶åŠ åˆ°çˆ¶æ•°ç»„ä¸­ã€‚

å› æ­¤ï¼Œåˆ›å»ºæ•°ç»„çš„æ­£ç¡®æ–¹å¼æ˜¯â€œè‡ªä¸Šè€Œä¸‹â€ã€‚åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œç„¶åç«‹å³ä½¿ç”¨ @code{sym_update()} å°†å›æ·»åŠ åˆ°ç¬¦å·è¡¨ä¸­ï¼Œæˆ–è€…ä½¿ç”¨ @code{set_array_element()} å°†å…¶æ·»åŠ ä¸ºä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ã€‚æˆ‘ä»¬åé¢ä¼šæœ‰ä¾‹å­è¯´æ˜ã€‚

@item
ç”±äº @command{gawk} çš„å†…éƒ¨å®ç°ï¼Œåœ¨ä½¿ç”¨äº† @code{sym_update()} å®‰è£…äº†ä¸€ä¸ªæ•°ç»„åˆ° @command{gawk} ä¸­åï¼Œåœ¨ä½¿ç”¨å®ƒåšä»»ä½•äº‹æƒ…ä¹‹å‰ï¼Œä½ å¿…é¡»ä½¿ç”¨ä¼ ç»™ @code{sym_update()} æ¥å£ä¸­çš„å€¼æ¥è·å–ä¸€ä¸ªæ•°ç»„çš„ cookieï¼š

@example
awk_value_t val;
awk_array_t new_array;

new_array = create_array();
val.val_type = AWK_ARRAY;
val.array_cookie = new_array;

/* install array in the symbol table */
sym_update("array", & val);

new_array = val.array_cookie;    /* YOU MUST DO THIS */
@end example

å¦‚æœå®‰è£…çš„æ˜¯ä¸€ä¸ªå­æ•°ç»„ï¼Œä½ å¿…é¡»åœ¨è°ƒç”¨ @code{set_element()} ä¹‹åä½¿ç”¨æ•°ç»„çš„å€¼è¿”å›ä¸€ä¸ªæ•°ç»„ cookieã€‚
@end itemize

ä¸‹é¢çš„ C ä»£ç æ˜¯ä¸€ä¸ªç®€å•æµ‹è¯•æ‰©å±•ï¼Œç”¨ä¸¤ä¸ªå¸¸è§„çš„å…ƒç´ æ¥åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ªå­æ•°ç»„ã€‚å¼€å§‹çš„ @code{#include} æŒ‡ç¤ºç¬¦ä»¥åŠæ ·æ¿å¼çš„å˜é‡å£°æ˜ï¼ˆæŸ¥çœ‹ @pxref{Extension API Boilerplate}ï¼‰ä¸ºäº†ç®€åŒ–è€Œçœç•¥äº†ã€‚ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œç„¶åå°†å…¶å®‰è£…åˆ°ç¬¦å·è¡¨ä¸­ï¼š

@example
@ignore
#ifdef HAVE_CONFIG_H
#include <config.h>
#endif

#include <stdio.h>
#include <assert.h>
#include <errno.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#include <sys/types.h>
#include <sys/stat.h>

#include "gawkapi.h"

static const gawk_api_t *api;   /* for convenience macros to work */
static awk_ext_id_t *ext_id;
static const char *ext_version = "testarray extension: version 1.0";

int plugin_is_GPL_compatible;

@end ignore
/* create_new_array --- create a named array */

static void
create_new_array()
@{
    awk_array_t a_cookie;
    awk_array_t subarray;
    awk_value_t index, value;

    a_cookie = create_array();
    value.val_type = AWK_ARRAY;
    value.array_cookie = a_cookie;

    if (! sym_update("new_array", & value))
        printf("create_new_array: sym_update(\"new_array\") failed!\n");
    a_cookie = value.array_cookie;
@end example

@noindent
æ³¨æ„ @code{a_cookies} æ˜¯å¦‚ä½•ä½¿ç”¨ @code{value} ç»“æ„ä½“ä¸­çš„ @code{array_cookie} çš„åŸŸæ¥è¿›è¡Œé‡ç½®çš„ã€‚

ç¬¬äºŒæ­¥æ˜¯å®‰è£…ä¸€ä¸ªå¸¸è§„çš„åˆ° @code{new_array} ä¸­ï¼š

@example
    (void) make_const_string("hello", 5, & index);
    (void) make_const_string("world", 5, & value);
    if (! set_array_element(a_cookie, & index, & value)) @{
        printf("fill_in_array: set_array_element failed\n");
        return;
    @}

    (void) make_const_string("answer", 6, & index);
    (void) make_number(42.0, & value);
    if (! set_array_element(a_cookie, & index, & value)) @{
        printf("fill_in_array: set_array_element failed\n");
        return;
    @}
@end example

ç¬¬ä¸‰æ­¥æ˜¯åˆ›å»ºäº†ä¸€å­æ•°ç»„ï¼Œç„¶åå®‰è£…å®ƒï¼š

@example
    (void) make_const_string("subarray", 8, & index);
    subarray = create_array();
    value.val_type = AWK_ARRAY;
    value.array_cookie = subarray;
    if (! set_array_element(a_cookie, & index, & value)) @{
        printf("fill_in_array: set_array_element failed\n");
        return;
    @}
    subarray = value.array_cookie;
@end example

æœ€åä¸€æ­¥æ˜¯å‘å¸ƒå­æ•°ç»„ä»¥åŠå®ƒçš„å…ƒç´ ï¼š

@example
    (void) make_const_string("foo", 3, & index);
    (void) make_const_string("bar", 3, & value);
    if (! set_array_element(subarray, & index, & value)) @{
        printf("fill_in_array: set_array_element failed\n");
        return;
    @}
@}
@ignore
static awk_ext_func_t func_table[] = @{
    @{ NULL, NULL, 0 @}
@};

/* init_testarray --- additional initialization function */

static awk_bool_t init_testarray(void)
@{
    create_new_array();

    return awk_true;
@}

static awk_bool_t (*init_func)(void) = init_testarray;

dl_load_func(func_table, testarray, "")
@end ignore
@end example

è¿™ä¸ªä¸€ä¸ªè£…è½½æ‰©å±•çš„è„šæœ¬ï¼Œç„¶å dump æ•°ç»„ï¼š

@example
@@load "subarray"

function dumparray(name, array,     i)
@{
    for (i in array)
        if (isarray(array[i]))
            dumparray(name "[\"" i "\"]", array[i])
        else
            printf("%s[\"%s\"] = %s\n", name, i, array[i])
@}

BEGIN @{
    dumparray("new_array", new_array);
@}
@end example

ä¸‹é¢æ˜¯è¿è¡Œè„šæœ¬çš„ç»“æœï¼š

@example
$ @kbd{AWKLIBPATH=$PWD ./gawk -f subarray.awk}
@print{} new_array["subarray"]["foo"] = bar
@print{} new_array["hello"] = world
@print{} new_array["answer"] = 42
@end example

@noindent
ï¼ˆæŸ¥çœ‹ @ref{Finding Extensions}ï¼Œæ¥è·å–æ›´å¤šçš„å…³äºå˜é‡ @env{AWKLIBPATH} çš„ä¿¡æ¯ï¼‰ã€‚

@node Extension API Variables
@subsection API å˜é‡

API æä¾›äº†ä¸¤ç§ç±»å‹çš„å˜é‡ã€‚ç¬¬ä¸€ç§æä¾› API ç‰ˆæœ¬ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ‰©å±•æ˜¯å¦‚ä½•è¿›è¡Œç¼–è¯‘ä»¥åŠ @command{gawk} å¦‚ä½•è¿›è¡Œç¼–è¯‘çš„ï¼‰ã€‚ç¬¬äºŒç§æ˜¯æä¾› @command{gawk} å¦‚ä½•è¢«è°ƒç”¨çš„ä¿¡æ¯ã€‚

@menu
* Extension Versioning::        API Version information.
* Extension API Informational Variables:: Variables providing information about
                                @command{gawk}'s invocation.
@end menu

@node Extension Versioning
@subsubsection API Version Constants and Variables
@cindex API version
@cindex extension API version

API æä¾›äº†â€œä¸»â€ä¸â€œæ¬¡â€ç‰ˆæœ¬å€¼ã€‚API ç‰ˆæœ¬å¯ä»¥åœ¨ç¼–è¯‘æ—¶åˆ»è·å¾—ã€‚å®ƒåœ¨ C è¯­è¨€é¢„å¤„ç†ä¸­å®šä¹‰ä»¥æ”¯æŒæ¡ä»¶ç¼–è¯‘ï¼Œä»¥åŠä½œä¸ºæšä¸¾å‹å¸¸é‡ç”¨äº debugï¼š

@float Table,gawk-api-version
@caption{gawk API ç‰ˆæœ¬å·å¸¸é‡}
@multitable @columnfractions .33 .33 .33
@headitem API ç‰ˆæœ¬ @tab C è¯­è¨€é¢„å¤„ç†å™¨ä¸­çš„å®šä¹‰ @tab æšä¸¾å‹å¸¸é‡
@item Major @tab gawk_api_major_version @tab GAWK_API_MAJOR_VERSION
@item Minor @tab gawk_api_minor_version @tab GAWK_API_MINOR_VERSION
@end multitable
@end float

æ¬¡ç‰ˆæœ¬å·ä¼šåœ¨å‘ API æ·»åŠ æ–°å‡½æ•°çš„æ—¶å€™è¿›è¡Œé€’å¢ã€‚è¿™äº›æ–°å‡½æ•°æ€»æ˜¯æ·»åŠ åœ¨ API ç»“æ„ä½“ @code{struct} çš„å°¾éƒ¨ã€‚

å¦‚æœæ•°ç»„ç±»å‹æ”¹å˜äº†å¤§å°ï¼Œæˆ–è€…æˆå‘˜é¡ºåºæœ‰å˜åŒ–ï¼Œæˆ–è€…ç°æœ‰çš„å‡½æ•°æ”¹å˜äº†ç­¾åï¼Œä¼šå¯¹ä¸»ç‰ˆæœ¬å·é€’å¢ï¼ˆæ¬¡ç‰ˆæœ¬å·åˆ™é‡è®¾ä¸º 0ï¼‰ã€‚

æœ‰å¯èƒ½æ‰©å±•æ˜¯ä»¥æŸä¸ªç‰ˆæœ¬çš„ API è¿›è¡Œç¼–è¯‘çš„ï¼Œè€Œè¢«å¦ä¸€ä¸ªç‰ˆæœ¬çš„ @command{gawk} ç‰ˆæœ¬è¿›è¡Œè£…è½½ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œæ‰§è¡Œ @command{gawk} API çš„ä¸»æ¬¡ç‰ˆæœ¬å·ä¼šåŒ…å«åœ¨ API ç»“æ„ä½“ @code{struct} ä¸­ï¼Œå¹¶ä¸”æ˜¯åªè¯»çš„ï¼š

@table @code
@item api->major_version
æ‰§è¡Œ @command{gawk} çš„ä¸»ç‰ˆæœ¬å·ã€‚

@item api->minor_version
æ‰§è¡Œ @command{gawk} çš„æ¬¡ç‰ˆæœ¬å·ã€‚
@end table

æ‰©å±•å¯ä»¥å†³å®š API æ˜¯å¦æ˜¯å…¼å®¹çš„ã€‚å…¸å‹çš„æƒ…å†µä¸‹ï¼Œåƒä¸‹é¢è¿™æ ·çš„æ£€æŸ¥å°±å¯ä»¥äº†ï¼š

@example
if (api->major_version != GAWK_API_MAJOR_VERSION
    || api->minor_version < GAWK_API_MINOR_VERSION) @{
        fprintf(stderr, "foo_extension: version mismatch with gawk!\n");
        fprintf(stderr, "\tmy version (%d, %d), gawk version (%d, %d)\n",
                GAWK_API_MAJOR_VERSION, GAWK_API_MINOR_VERSION,
                api->major_version, api->minor_version);
        exit(1);
@}
@end example

è¿™æ ·çš„ä»£ç è¢«åŒ…å«åœ¨æ¨¡æ¿ @code{dl_load_func()} å®ä¸­ï¼Œå¹¶ç”± @file{gawkapi.h} æ–‡ä»¶ä¸­ï¼ˆåœ¨ @ref{Extension API Boilerplate} ä¸­è¿›è¡Œè®¨è®ºï¼‰ã€‚

@node Extension API Informational Variables
@subsubsection ä¿¡æ¯å˜é‡
@cindex API informational variables
@cindex extension API informational variables

API æä¾›äº†å¤šä¸ªå˜é‡çš„è®¿é—®ï¼Œè¿™äº›å˜é‡æè¿°äº† @command{gawk} è¢«è°ƒç”¨æ—¶ï¼Œç›¸åº”çš„å‘½ä»¤è¡Œé€‰é¡¹æ˜¯å¦å¯ç”¨ã€‚è¿™äº›å˜é‡æ˜¯ï¼š

@table @code
@item do_debug
è¿™ä¸ªå˜é‡å½“ä½¿ç”¨äº† @option{--debug} é€‰é¡¹æ¥è°ƒç”¨ @command{gawk} æ—¶ä¼šä¸º trueã€‚

@item do_lint
è¿™ä¸ªå˜é‡å½“ä½¿ç”¨äº† @option{--lint} é€‰é¡¹æ¥è°ƒç”¨ @command{gawk} æ—¶ä¼šä¸º trueã€‚

@item do_mpfr
è¿™ä¸ªå˜é‡å½“ä½¿ç”¨äº† @option{--bignum} é€‰é¡¹æ¥è°ƒç”¨ @command{gawk} æ—¶ä¼šä¸º trueã€‚

@item do_profile
è¿™ä¸ªå˜é‡å½“ä½¿ç”¨äº† @option{--profile} é€‰é¡¹æ¥è°ƒç”¨ @command{gawk} æ—¶ä¼šä¸º trueã€‚

@item do_sandbox
è¿™ä¸ªå˜é‡å½“ä½¿ç”¨äº† @option{--sandbox} é€‰é¡¹æ¥è°ƒç”¨ @command{gawk} æ—¶ä¼šä¸º trueã€‚

@item do_traditional
è¿™ä¸ªå˜é‡å½“ä½¿ç”¨äº† @option{--traditional} é€‰é¡¹æ¥è°ƒç”¨ @command{gawk} æ—¶ä¼šä¸º trueã€‚
@end table

@code{do_lint} çš„å€¼å¦‚æœ @command{awk} ä»£ç ä¿®æ”¹äº† @code{LINT} é¢„å®šä¹‰å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰å¯èƒ½ä¼šæ”¹å˜ã€‚å…¶ä»–çš„åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½ä¸ä¼šæ”¹å˜ã€‚

@node Extension API Boilerplate
@subsection æ ·æ¿ä»£ç 

å¦‚ä¹‹å‰æ‰€æï¼ˆæŸ¥çœ‹ @pxref{Extension Mechanism Outline}ï¼‰ï¼Œå‡½æ•°å®šä¹‰çš„å‘ˆç°å®é™…ä¸Šæ˜¯ä¸€ä¸ªå®ã€‚ä¸ºäº†ä½¿ç”¨è¿™äº›å®ï¼Œä½ çš„æ‰©å±•å¿…é¡»ä½¿ç”¨ä¸‹é¢çš„é¢„å®šä¹‰çš„åå­—ï¼Œæä¾›å°‘é‡çš„æ ·æ¿ä»£ç ï¼ˆå˜é‡ä»¥åŠå‡½æ•°ï¼‰æ”¾åœ¨ä½ çš„æºä»£ç çš„å¤´éƒ¨ã€‚æ‰€éœ€è¦çš„æ ·æ¿ä»£ç ä¹Ÿæä¾›åœ¨ @file{gawkapi.h} å¤´æ–‡ä»¶çš„æ³¨é‡Šä¸­ï¼š

@example
/* Boilerplate code: */
int plugin_is_GPL_compatible;

static gawk_api_t *const api;
static awk_ext_id_t ext_id;
static const char *ext_version = NULL; /* or @dots{} = "some string" */

static awk_ext_func_t func_table[] = @{
    @{ "name", do_name, 1 @},
    /* @dots{} */
@};

/* EITHER: */

static awk_bool_t (*init_func)(void) = NULL;

/* OR: */

static awk_bool_t
init_my_extension(void)
@{
    @dots{}
@}

static awk_bool_t (*init_func)(void) = init_my_extension;

dl_load_func(func_table, some_name, "name_space_in_quotes")
@end example

è¿™äº›å˜é‡ä¸å‡½æ•°å¦‚ä¸‹ï¼š

@table @code
@item int plugin_is_GPL_compatible;
è¿™ä¸ªç”¨æ¥å£°æ˜æ‰©å±•æ˜¯ä¸ GNU GPL å…¼å®¹çš„
This asserts that the extension is compatible with
@ifclear FOR_PRINT
ï¼ˆæŸ¥çœ‹ @pxref{Copying}ï¼‰ã€‚
@end ifclear
å¦‚æœä½ çš„æ‰©å±•æ²¡æœ‰è¿™ä¸ªå˜é‡ï¼Œ@command{gawk} ä¸ä¼šè£…è½½å®ƒï¼ˆæŸ¥çœ‹ @pxref{Plugin License}ï¼‰ã€‚

@item static gawk_api_t *const api;
è¿™ä¸ªå…¨å±€çš„ @code{static} å˜é‡åº”è¯¥è¢«è®¾å®šæŒ‡å‘ @code{gawk_api_t} æŒ‡é’ˆï¼Œ@command{gawk} ä¼šåœ¨ @code{dl_load()} å‡½æ•°ä¸­ä¼ é€’è¿‡æ¥ã€‚è¿™ä¸ªå˜é‡è¢«æ‰€æœ‰çš„å®ä½¿ç”¨ã€‚

@item static awk_ext_id_t ext_id;
è¿™ä¸ªå…¨å±€é™æ€å˜é‡åº”è¯¥è®¾ç½®ä¸º @code{awk_ext_id_t} çš„å€¼ï¼Œè¿™ä¸ªå€¼ä¼šé€šè¿‡ä½ è‡ªå·±çš„ @code{dl_load()} å‡½æ•°ä¼ é€’ç»˜ç”»ä½ ã€‚è¿™ä¸ªå˜é‡è¢«æ‰€æœ‰çš„å®ä½¿ç”¨ã€‚

@item static const char *ext_version = NULL; /* or @dots{} = "some string" */
è¿™ä¸ªå…¨å±€ @code{static} å˜é‡è¦ä¹ˆè¢«è®¾ç½®ä¸º @code{NULL}ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå­—ä¸²çš„æŒ‡é’ˆï¼Œè¿™ä¸ªå­—ä¸²ç»˜ç”»äº†äº†æ‰©å±•çš„åå­—ä¸ç‰ˆæœ¬ã€‚

@item static awk_ext_func_t func_table[] = @{ @dots{} @};
è¿™ä¸ªä¸€ä¸ªæˆ–è€…å¤šä¸ª @code{awk_ext_func_t} ç»“æ„çš„æ•°ç»„ï¼Œå¦‚ä¹‹æ‰€æè¿°çš„ï¼ˆæŸ¥çœ‹ @pxref{Extension Functions}ï¼‰ã€‚å®ƒä¹‹åå¯ä»¥é€šè¿‡å¾ªç¯æ¥å¤šæ¬¡è°ƒç”¨ @code{add_ext_func()}ã€‚

@c Use @var{OR} for docbook
@item static awk_bool_t (*init_func)(void) = NULL;
@itemx @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @ @var{OR}
@itemx static awk_bool_t init_my_extension(void) @{ @dots{} @}
@itemx static awk_bool_t (*init_func)(void) = init_my_extension;
å¦‚æœä½ éœ€è¦åšä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼Œä½ åº”è¯¥å®šä¹‰è¿™æ ·çš„å‡½æ•°ï¼ˆåˆ›å»ºå˜é‡ï¼Œæ‰“å¼€æ–‡ä»¶ç­‰ï¼‰ç„¶åå®šä¹‰ @code{init_func} æŒ‡é’ˆæŒ‡å‘ä½ çš„å‡½æ•°ã€‚å‡½æ•°åº”è¯¥åœ¨å¤±è´¥æ—¶è¿”å› @code{awk_false} ï¼Œæˆ–è€…æˆåŠŸæ—¶è¿”å› @code{awk_true}ã€‚

å¦‚æœä½ ä¸éœ€è¦åˆå§‹åŒ–ï¼Œå®šä¹‰è¿™ä¸ªæŒ‡é’ˆï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º @code{NULL}ã€‚

@item dl_load_func(func_table, some_name, "name_space_in_quotes")
è¿™ä¸ªå®ä¼šæ‰©å±•ä¸º @code{dl_load()} å‡½æ•°ï¼Œè¯¥å‡½æ•°æ‰§è¡Œæ‰€æœ‰å¿…è¦çš„åˆå§‹åŒ–ã€‚
@end table

æ‰€æœ‰å˜é‡ä¸æ•°ç»„çš„ç›®çš„æ˜¯ä½¿ @code{dl_load()} å‡½æ•°ï¼ˆæ¥è‡ªäº @code{dl_load_func()} å®ä¸­ï¼‰å¤„ç†æ‰€æœ‰çš„æ ‡å‡†å·¥ä½œã€‚å®ƒæ‰§è¡Œä¸‹é¢çš„å·¥ä½œï¼š

@enumerate 1
@item
æ£€æŸ¥ API ç‰ˆæœ¬ã€‚å¦‚æœæ‰©å±•çš„ä¸»ç‰ˆæœ¬ä¸ @command{gawk} çš„ä¸»ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œæˆ–è€…æ‰©å±•çš„æ¬¡ç‰ˆæœ¬å¤§äº @command{gawk} çš„æ¬¡ç‰ˆæœ¬å·ï¼Œå®ƒä¼šæ‰“å°é”™è¯¯ä¿¡æ¯åé€€å‡ºã€‚

@item
è£…å…¥å®šä¹‰åœ¨ @code{func_table} ä¸­çš„å‡½æ•°ã€‚å¦‚æœå®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªå¤±è´¥ï¼Œå®ƒä¼šæ‰“å°è­¦å‘Šä¿¡æ¯ï¼Œä½†æ˜¯ç»§ç»­æ‰§è¡Œã€‚

@item
å¦‚æœ @code{init_func} æŒ‡é’ˆä¸ä¸º @code{NULL}ï¼Œåˆ™è°ƒç”¨å®ƒæŒ‡å‘çš„å‡½æ•°ã€‚å¦‚æœå®ƒè¿”å› @code{awk_false}ï¼Œæ‰“å°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ã€‚

@item
å¦‚æœ @code{ext_version} ä¸ä¸º @code{NULL}ï¼Œæ³¨å†Œç‰ˆæœ¬å­—ä¸²åˆ° @command{gawk} ä¸­ã€‚
@end enumerate

@node Finding Extensions
@section @command{gawk} å¦‚ä½•æ‰¾åˆ°æ‰©å±•
@cindex extension search path
@cindex finding extensions

ç¼–è¯‘å¥½çš„æ‰©å±•å¿…é¡»å®‰è£…åœ¨ @command{gawk} å¯ä»¥æ‰¾åˆ°å®ƒä»¬çš„è·¯å¾„ä¸‹ã€‚å¦‚æœ @command{gawk} è¢«é…ç½®å¹¶ä»¥é»˜è®¤çš„æ–¹å¼è¿›è¡Œæ„å»ºï¼Œæ¥æœç´¢æ‰©å±•çš„ç›®å½•ä¸º @file{/usr/local/lib/gawk}ã€‚
ä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç›®å½•åˆ—è¡¨æ¥æœç´¢ç¼–è¯‘å¥½çš„æ‰©å±•ã€‚æŸ¥çœ‹ @ref{AWKLIBPATH Variable}ï¼Œæ¥è·å–å…¶ä»–ä¿¡æ¯ã€‚

@node Extension Example
@section ä¾‹å­ï¼šä¸€äº›æ–‡ä»¶å‡½æ•°
@cindex extension example

@quotation
@i{
ä½ å¯ä»¥åˆ°è¾¾ä»»ä½•ä½ æƒ³å»çš„åœ°æ–¹ã€‚
}
@author Buckaroo Banzai
@end quotation

@c It's enough to show chdir and stat, no need for fts

æœ‰ä¸¤ä¸ªéå¸¸æœ‰ç”¨çš„å‡½æ•°ä¸åœ¨ @command{awk} ä¸­ï¼Œä»–ä»¬æ˜¯ @code{chdir()}ï¼ˆè¿™æ · @command{awk} ç¨‹åºå¯ä»¥æ”¹å˜å®ƒçš„ç›®å½•ï¼‰ä¸ @code{stat()}ï¼ˆè¿™æ · @command{awk} ç¨‹åºå¯ä»¥æ”¶é›†æ–‡ä»¶çš„ä¿¡æ¯ï¼‰ã€‚ä¸ºäº†ç”¨å®é™…çš„ä¾‹å­è¯´æ˜ APIï¼Œè¿™ä¸€@value{SECTION}ä¼šå°†å…¶å®ç°ä¸º @command{gawk} çš„æ‰©å±•ã€‚

@menu
* Internal File Description::   What the new functions will do.
* Internal File Ops::           The code for internal file operations.
* Using Internal File Ops::     How to use an external extension.
@end menu

@node Internal File Description
@subsection  ä½¿ç”¨ @code{chdir()} ä¸ @code{stat()}

è¿™ä¸€@value{SECTION}å±•ç¤ºå¦‚ä½•æ¥åœ¨ @command{awk} å±‚ä¸Šå¦‚ä½•æ¥ä½¿ç”¨æ–°å‡½æ•°ï¼Œåªè¦ä»–ä»¬å·²ç»æ•´åˆåˆ°äº† @command{gawk} ä¸­çš„è§£é‡Šå™¨ä¸­ã€‚ä½¿ç”¨ @code{chdir()} éå¸¸ç›´æ¥ã€‚å®ƒåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ›´æ”¹çš„æ–°ç›®å½•ï¼š

@example
@@load "filefuncs"
@dots{}
newdir = "/home/arnold/funstuff"
ret = chdir(newdir)
if (ret < 0) @{
    printf("could not change to %s: %s\n", newdir, ERRNO) > "/dev/stderr"
    exit 1
@}
@dots{}
@end example

å¦‚æœ @code{chdir()} å¤±è´¥äº†ä¼šè¿”å›ä¸€ä¸ªè´Ÿå€¼ï¼Œ@code{ERRNO}ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ çš„å€¼ä¼šè¢«è®¾ç½®ä¸ºæŒ‡ç¤ºé”™è¯¯çš„å­—ä¸²ã€‚

ä½¿ç”¨ @code{stat()} å°±æœ‰ä¸€ç‚¹å¤æ‚ã€‚C çš„ @code{stat()} å‡½æ•°ä¼šå¡«å……ä¸€ä¸ªæœ‰å¤§é‡ä¿¡æ¯çš„ç»“æ„ã€‚åœ¨ @command{awk} ä¸­å¯¹å…¶è¿›è¡Œå»ºæ¨¡çš„æ­£ç¡®æ–¹æ³•æ˜¯ä½¿ç”¨å…³è”æ•°ç»„æ¥è¡¨ç¤ºå¯¹åº”çš„ä¿¡æ¯ï¼š

@c broke printf for page breaking
@example
file = "/home/arnold/.profile"
ret = stat(file, fdata)
if (ret < 0) @{
    printf("could not stat %s: %s\n",
             file, ERRNO) > "/dev/stderr"
    exit 1
@}
printf("size of %s is %d bytes\n", file, fdata["size"])
@end example

@code{stat()} å‡½æ•°æ€»ä¼šæ¸…é™¤æ•°æ®æ•°ç»„ï¼Œå°±ç®— @code{stat()} å¤±è´¥æƒ…å†µä¸‹ä¹Ÿå¦‚æ­¤ã€‚å®ƒä¼šä»¥å¡«å……ä¸‹é¢çš„å…ƒç´ ï¼š

@table @code
@item "name"
è¦è¿›è¡Œ @code{stat()} æ“ä½œçš„æ–‡ä»¶çš„åå­—ã€‚

@item "dev"
@itemx "ino"
æ–‡ä»¶çš„è®¾å¤‡ä¸ inode å·ã€‚

@item "mode"
æ–‡ä»¶çš„è®¿é—®æƒé™ï¼Œä¸ºæ•°å€¼ã€‚è¿™åŒ…å«æ–‡ä»¶çš„ç±»å‹ä»¥åŠæƒé™ã€‚

@item "nlink"
ç¡¬è¿æ¥çš„ä¸ªæ•°ã€‚

@item "uid"
@itemx "gid"
æ–‡ä»¶æ‰€æœ‰è€…çš„ç”¨æˆ· ID ä¸ç»„ IDã€‚

@item "size"
æ–‡ä»¶çš„å­—èŠ‚å¤§å°ã€‚

@item "blocks"
æ–‡ä»¶å®é™…å æœ‰å—çš„ä¸ªæ•°ã€‚å¦‚æœæ–‡ä»¶æœ‰æ´ï¼Œåˆ™è¿™ä¸ªæ•°ç»„ä¸ä¼šæ˜¯å…¶å¤§å°çš„å‡½æ•°ã€‚

@item "atime"
@itemx "mtime"
@itemx "ctime"
æ–‡ä»¶çš„æœ€åè®¿é—®ï¼Œä¿®æ”¹åŠ inode æ›´æ–°æ—¶é—´ã€‚å®ƒä»¬éƒ½æ˜¯æ•°å€¼çš„æ—¶é—´æˆ³ï¼Œé€‚åˆç”¨äº @code{strftime()}ï¼ˆæŸ¥çœ‹ @ref{Time Functions}ï¼‰ã€‚

@item "pmode"
æ–‡ä»¶çš„â€œprintable mode"ã€‚è¿™ä¸ªæ˜¯ä¸€ä¸ªæ–‡ä»¶ç±»å‹ä¸æƒé™çš„å­—ä¸²è¡¨ç¤ºï¼Œå¦‚ @samp{ls -l} è¾“å‡ºã€‚å¦‚ï¼Œ@code{"drwxr-xr-x"}ã€‚

@item "type"
æ–‡ä»¶ç±»å‹çš„å¯æ‰“å°å­—ä¸²ï¼Œå€¼å¯èƒ½æ˜¯ä¸‹é¢ä¹‹ä¸€ï¼š

@table @code
@item "blockdev"
@itemx "chardev"
æ–‡ä»¶æ˜¯ä¸€ä¸ªå—æˆ–è€…å­—ç¬¦è®¾å¤‡ï¼ˆâ€œç‰¹æ®Šæ–‡ä»¶â€ï¼‰ã€‚

@ignore
@item "door"
The file is a Solaris ``door'' (special file used for
interprocess communications).
@end ignore

@item "directory"
æ–‡ä»¶æ˜¯ç›®å½•ã€‚

@item "fifo"
æ–‡ä»¶æ˜¯ä¸€ä¸ªå‘½åç®¡é“ï¼ˆä¹Ÿç§°ä¸º FIFOï¼‰ã€‚

@item "file"
æ–‡ä»¶æ˜¯ä¸€ä¸ªå¸¸è§„æ–‡ä»¶ã€‚

@item "socket"
æ–‡ä»¶æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ª @code{AF_UNIX}ï¼ˆâ€œUnix domainâ€ï¼‰socketã€‚

@item "symlink"
æ–‡ä»¶æ˜¯ä¸€ä¸ªç¬¦å·è¿æ¥ã€‚
@end table

@c 5/2013: Thanks to Corinna Vinschen for this information.
@item "devbsize"
æ–‡ä»¶çš„é€šè¿‡ @code{"blocks"} è¿›è¡Œç´¢å¼•çš„åŸºæœ¬å—å¤§å°ã€‚å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯ä» @code{<sys/param.h>} æ–‡ä»¶ä¸­çš„ @code{DEV_BSIZE} æˆ–è€…æ˜¯ BSD ç³»ç»Ÿä¸­ @code{<sys/stat.h>} æ–‡ä»¶ä¸­çš„ @code{S_BLKSIZE} ç»§æ‰¿ä¸‹æ¥çš„ã€‚å¯¹äºå…¶ä»–çš„ç³»ç»Ÿï¼Œ@dfn{é¢„å…ˆ}çš„çŸ¥è¯†ä¸ºå…¶æä¾›å€¼ã€‚å½“æ²¡æ³•ç¡®å®šå€¼çš„æ—¶å€™ï¼Œé»˜è®¤ä¸º 512ã€‚
@end table

è¿˜å¯èƒ½æœ‰å‡ ä¸ªé¢å¤–çš„å…ƒç´ ï¼Œå…¶ä¾èµ–äºæ“ä½œç³»ç»Ÿä»¥åŠæ–‡ä»¶çš„ç±»å‹ã€‚ä½ å¯ä»¥åœ¨ @command{awk} ç¨‹åºä¸­ä½¿ç”¨ @code{in} æ“ä½œç¬¦æ¥å¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•ï¼ˆæŸ¥çœ‹ @ref{Reference to Elements}ï¼‰ï¼š

@table @code
@item "blksize"
ç”¨äºæ–‡ä»¶ I/O ä¼˜å…ˆå—å¤§å°ã€‚è¿™ä¸ªåŸŸåœ¨æ‰€æœ‰ç±» POSIXç³»ç»Ÿä¸­çš„ C @code{stat} ç»“æ„ä¸­ä¸å­˜åœ¨ã€‚

@item "linkval"
å¦‚æœæ–‡ä»¶æ˜¯ä¸€ä¸ªè¿æ¥ï¼Œè¿™ä¸ªå…ƒç´ å°±æ˜¯è¿æ¥æ–‡ä»¶æ‰€æŒ‡å‘çš„æ–‡ä»¶åï¼ˆå³è¿æ¥çš„å€¼ï¼‰ã€‚

@item "rdev"
@itemx "major"
@itemx "minor"
å¦‚æœæ–‡ä»¶æ˜¯ä¸€ä¸ªå—è®¾å¤‡æˆ–è€…æ˜¯ä¸€ä¸ªå­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼Œåˆ™è¿™ä¸ªå€¼ä»£è¡¨äº†è®¾å¤‡å·çš„æ•°å€¼ï¼Œä»¥åŠè®¾å¤‡å·ä¸­çš„ä¸»æ¬¡è®¾å¤‡å·ã€‚
@end table

@node Internal File Ops
@subsection  @code{chdir()} ä¸ @code{stat()} çš„C ä»£ç 

ä¸‹é¢æ˜¯è¿™äº›æ‰©å±•çš„ C ä»£ç ã€‚ 
@footnote{ä¸ºäº†è¡¨ç°ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ‰ä¸€äº›å°æ”¹åŠ¨ã€‚åˆ° @command{gawk} å‘å¸ƒç‰ˆ @file{extension/filefuncs.c} ä¸­æŸ¥çœ‹å®Œæ•´çš„ç‰ˆæœ¬ã€‚}

è¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«å¾ˆå¤šçš„æ ‡å‡†å¤´æ–‡ä»¶ï¼Œç„¶åå†åŒ…å« @file{gawkapi.h} å¤´æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ–‡ä»¶ä¸­åŒ…äº† API çš„å®šä¹‰ã€‚åå†æ˜¯è·Ÿç€ä¸€äº›å¿…è¦å˜é‡å£°æ˜ï¼Œä»¥ä½¿ç”¨ API ä¸­çš„å®ä¸æ¨¡æ¿ä»£ç ï¼ˆæŸ¥çœ‹ @pxref{Extension API Boilerplate}ï¼‰ï¼š

@example
#ifdef HAVE_CONFIG_H
#include <config.h>
#endif

#include <stdio.h>
#include <assert.h>
#include <errno.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#include <sys/types.h>
#include <sys/stat.h>

#include "gawkapi.h"

#include "gettext.h"
#define _(msgid)  gettext(msgid)
#define N_(msgid) msgid

#include "gawkfts.h"
#include "stack.h"

static const gawk_api_t *api;    /* for convenience macros to work */
static awk_ext_id_t *ext_id;
static awk_bool_t init_filefuncs(void);
static awk_bool_t (*init_func)(void) = init_filefuncs;
static const char *ext_version = "filefuncs extension: version 1.0";

int plugin_is_GPL_compatible;
@end example

@cindex programming conventions, @command{gawk} extensions
ä¹ æƒ¯ä¸Šï¼Œå¯¹äº @command{awk} å‡½æ•° @code{foo()}ï¼Œå®ç°å®ƒçš„å‡½æ•°ç§°ä¸º @code{do_foo()}ã€‚è¿™äº›å‡½æ•°åº”è¯¥æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯ @code{int}ï¼Œé€šå¸¸ç§°ä¸º @code{nargs}ï¼Œè¡¨ç¤ºçš„æ˜¯å‡½æ•°ä¸­å®é™…å‚æ•°çš„ä¸ªæ•°ã€‚ç¬¬äºŒä¸ªæ˜¯ @code{awk_value_t} ç»“æ„çš„æŒ‡é’ˆï¼Œä¸€èˆ¬å‘½åä¸º @code{result}ï¼š

@example
/*  do_chdir --- provide dynamically loaded chdir() function for gawk */

static awk_value_t *
do_chdir(int nargs, awk_value_t *result)
@{
    awk_value_t newdir;
    int ret = -1;

    assert(result != NULL);

    if (do_lint && nargs != 1)
        lintwarn(ext_id,
                 _("chdir: called with incorrect number of arguments, "
                   "expecting 1"));
@end example

@code{newdir} å˜é‡è¡¨ç¤ºè¦æ”¹å˜çš„æ–°ç›®å½•ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡ @code{get_argument()} æ¥è·å–çš„ã€‚æ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç¼–å·ä¸º 0ã€‚

å¦‚æœå‚æ•°è¢«æˆåŠŸè¿”å›ï¼Œåˆ™å‡½æ•°è°ƒç”¨ @code{chdir()} ç³»ç»Ÿè°ƒç”¨ã€‚å¦‚æœ @code{chdir()} å¤±è´¥ï¼Œåˆ™ @code{ERRNO} çš„å€¼ä¼šè¢«æ›´æ”¹ï¼š

@example
    if (get_argument(0, AWK_STRING, & newdir)) @{
        ret = chdir(newdir.str_value.str);
        if (ret < 0)
            update_ERRNO_int(errno);
    @}
@end example

æœ€åï¼Œå‡½æ•°è¿”å›è¦è¿”å›çš„å€¼åˆ° @command{awk} å±‚ï¼š

@example
    return make_number(ret, result);
@}
@end example

@code{stat()} æ‰©å±•æ¶‰åŠçš„ä¸œè¥¿æ›´å¤šä¸€äº›ã€‚é¦–å…ˆæ˜¯ä¸€ä¸ªå°†æ•°å€¼æ¨¡å¼è½¬æ¢ä¸ºå¯æ‰“å°è¡¨ç¤ºçš„å‡½æ•°ï¼ˆæ¯”å¦‚ @code{0644} è½¬æ¢ä¸º @samp{-rw-r--r--}ï¼‰ã€‚ç®€å•èµ·è§ï¼Œè¿™é‡Œçœç•¥äº†ï¼š

@example
/* format_mode --- turn a stat mode field into something readable */

static char *
format_mode(unsigned long fmode)
@{
    @dots{}
@}
@end example

ä¸‹ä¸€ä¸ªå‡½æ•°ç”¨æ¥è¯»å–è½¯é“¾æ¥ï¼Œä¹Ÿä¸ºäº†ç®€åŒ–ï¼Œåœ¨è¿™é‡Œçœç•¥äº†ï¼š

@example
/* read_symlink --- read a symbolic link into an allocated buffer.
   @dots{} */

static char *
read_symlink(const char *fname, size_t bufsize, ssize_t *linksize)
@{
    @dots{}
@}
@end example

æœ‰ä¸¤ä¸ªè¾…åŠ©å‡½æ•°ä¼šç®€åŒ–å°†å€¼è¾“å…¥åˆ°æ•°ç»„çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæ•°ç»„å°†åŒ…å« @code{stat()} çš„ç»“æœï¼š

@example
/* array_set --- set an array element */

static void
array_set(awk_array_t array, const char *sub, awk_value_t *value)
@{
    awk_value_t index;

    set_array_element(array,
                      make_const_string(sub, strlen(sub), & index),
                      value);

@}

/* array_set_numeric --- set an array element with a number */

static void
array_set_numeric(awk_array_t array, const char *sub, double num)
@{
    awk_value_t tmp;

    array_set(array, sub, make_number(num, & tmp));
@}
@end example

ä¸‹é¢çš„å‡½æ•°å¤„ç†å¤§éƒ¨ä»½çš„å·¥ä½œï¼Œå³å°†ä»ä¸€ä¸ªæœ‰æ•ˆçš„ @code{struct stat} ä¸­å–å€¼ï¼Œç„¶åå°†è¿™äº›å€¼å¡«å……åˆ° @code{awk_array_t} ç±»å‹çš„ç»“æœæ•°ç»„ä¸­ã€‚è¿™ä¸ªå·¥ä½œç”±ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°æ¥å®Œæˆï¼Œä¸º @command{gawk} æä¾› @code{stat()} å‡½æ•°æ”¯æŒï¼Œä¹Ÿæ”¯æŒ @code{fts()} æ‰©å±•ã€‚ è¿™ä¸ªæ‰©å±•ä¹ŸåŒ…å«åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å®ƒçš„ä»£ç æ²¡æœ‰åœ¨è¿™æ—¶æ˜¾ç¤ºï¼ˆæŸ¥çœ‹ @pxref{Extension Sample File Functions}ï¼‰ã€‚

è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯å˜é‡å£°æ˜ï¼ŒåŒ…å«å°†æ–‡ä»¶ç±»å‹å½±å°„åˆ°å­—ä¸²çš„è¡¨ï¼š

@example
/* fill_stat_array --- do the work to fill an array with stat info */

static int
fill_stat_array(const char *name, awk_array_t array, struct stat *sbuf)
@{
    char *pmode;    /* printable mode */
    const char *type = "unknown";
    awk_value_t tmp;
    static struct ftype_map @{
        unsigned int mask;
        const char *type;
    @} ftype_map[] = @{
        @{ S_IFREG, "file" @},
        @{ S_IFBLK, "blockdev" @},
        @{ S_IFCHR, "chardev" @},
        @{ S_IFDIR, "directory" @},
#ifdef S_IFSOCK
        @{ S_IFSOCK, "socket" @},
#endif
#ifdef S_IFIFO
        @{ S_IFIFO, "fifo" @},
#endif
#ifdef S_IFLNK
        @{ S_IFLNK, "symlink" @},
#endif
#ifdef S_IFDOOR /* Solaris weirdness */
        @{ S_IFDOOR, "door" @},
#endif /* S_IFDOOR */
    @};
    int j, k;
@end example

ç„¶åç›®æ ‡æ•°ç»„ä¹Ÿè¢«å£°æ˜äº†ï¼Œåé¢çš„ä»£ç æ ¹æ® @code{struct stat} ä¸­çš„å€¼æ¥å¡«å……ä¸åŒçš„å…ƒç´ ï¼š

@example
    /* empty out the array */
    clear_array(array);

    /* fill in the array */
    array_set(array, "name", make_const_string(name, strlen(name),
                                               & tmp));
    array_set_numeric(array, "dev", sbuf->st_dev);
    array_set_numeric(array, "ino", sbuf->st_ino);
    array_set_numeric(array, "mode", sbuf->st_mode);
    array_set_numeric(array, "nlink", sbuf->st_nlink);
    array_set_numeric(array, "uid", sbuf->st_uid);
    array_set_numeric(array, "gid", sbuf->st_gid);
    array_set_numeric(array, "size", sbuf->st_size);
    array_set_numeric(array, "blocks", sbuf->st_blocks);
    array_set_numeric(array, "atime", sbuf->st_atime);
    array_set_numeric(array, "mtime", sbuf->st_mtime);
    array_set_numeric(array, "ctime", sbuf->st_ctime);

    /* for block and character devices, add rdev,
       major and minor numbers */
    if (S_ISBLK(sbuf->st_mode) || S_ISCHR(sbuf->st_mode)) @{
        array_set_numeric(array, "rdev", sbuf->st_rdev);
        array_set_numeric(array, "major", major(sbuf->st_rdev));
        array_set_numeric(array, "minor", minor(sbuf->st_rdev));
    @}
@end example

@noindent
å‡½æ•°çš„åé¢çš„éƒ¨åˆ†ç”¨äºå‘ç›®æ ‡æ•°ç»„ä¸­é€‰æ‹©æ€§åœ°æ·»åŠ ä¸€äº›å…ƒç´ ï¼Œè¿™ä¸ªè¦ä¾èµ–äºæ–‡ä»¶çš„ç‰¹å®šæˆå‘˜ä»¥åŠ/æˆ–è€…æ–‡ä»¶ç±»å‹ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å› 0 ï¼š

@example
#ifdef HAVE_STRUCT_STAT_ST_BLKSIZE
    array_set_numeric(array, "blksize", sbuf->st_blksize);
#endif /* HAVE_STRUCT_STAT_ST_BLKSIZE */

    pmode = format_mode(sbuf->st_mode);
    array_set(array, "pmode", make_const_string(pmode, strlen(pmode),
                                                & tmp));

    /* for symbolic links, add a linkval field */
    if (S_ISLNK(sbuf->st_mode)) @{
        char *buf;
        ssize_t linksize;

        if ((buf = read_symlink(name, sbuf->st_size,
                    & linksize)) != NULL)
            array_set(array, "linkval",
                      make_malloced_string(buf, linksize, & tmp));
        else
            warning(ext_id, _("stat: unable to read symbolic link `%s'"),
                    name);
    @}

    /* add a type field */
    type = "unknown";   /* shouldn't happen */
    for (j = 0, k = sizeof(ftype_map)/sizeof(ftype_map[0]); j < k; j++) @{
        if ((sbuf->st_mode & S_IFMT) == ftype_map[j].mask) @{
            type = ftype_map[j].type;
            break;
        @}
    @}

    array_set(array, "type", make_const_string(type, strlen(type), & tmp));

    return 0;
@}
@end example

@code{stat()} å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¹‹å‰æ²¡æœ‰è®¨è®ºåˆ°ã€‚è¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå¯¼è‡´ @code{do_stat()} ä½¿ç”¨ @code{stat()} è°ƒç”¨è€Œä¸æ˜¯ @code{lstat()} ç³»ç»Ÿè°ƒç”¨ã€‚è¿™æ˜¯é€šè¿‡è¿™ä¸ªå‡½æ•°æŒ‡é’ˆæ¥å®Œæˆçš„ï¼š@code{statfunc}ã€‚@code{statfunc} ä¼šè¢«åˆå§‹åŒ–ä¸º @code{lstat()}ï¼ˆè€Œä¸æ˜¯ @code{stat()}ï¼‰ï¼Œä»¥æ­¤æ¥è·å–æ–‡ä»¶ä¿¡æ¯ï¼Œä»¥é˜²æ­¢æ–‡ä»¶æ˜¯ä¸€ä¸ªè½¯é“¾æ¥ã€‚
ä½†æ˜¯ï¼Œå¦‚æœåŒ…å«äº†ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œ@code{statfunc} ä¸ºè®¾ç½®ä¸º @code{stat()} å‡½æ•°çš„æŒ‡é’ˆã€‚

ä¸‹é¢æ˜¯ @code{do_stat()} å‡½æ•°ï¼Œå®ƒçš„å¼€å§‹ä¹Ÿæ˜¯ä¸€äº›å˜é‡å£°æ˜ä»¥åŠå‚æ•°æ£€æŸ¥ï¼š

@ignore
Changed message for page breaking. Used to be:
    "stat: called with incorrect number of arguments (%d), should be 2",
@end ignore
@example
/* do_stat --- provide a stat() function for gawk */

static awk_value_t *
do_stat(int nargs, awk_value_t *result)
@{
    awk_value_t file_param, array_param;
    char *name;
    awk_array_t array;
    int ret;
    struct stat sbuf;
    /* default is lstat() */
    int (*statfunc)(const char *path, struct stat *sbuf) = lstat;

    assert(result != NULL);

    if (nargs != 2 && nargs != 3) @{
        if (do_lint)
            lintwarn(ext_id,
               _("stat: called with wrong number of arguments"));
        return make_number(-1, result);
    @}
@end example

åé¢æ¥ç€çš„æ˜¯å®é™…çš„å·¥ä½œã€‚å‡½æ•°å…ˆå–å¾—å‚æ•°ï¼Œæ¥ä¸‹æ¥ï¼Œå®ƒä¼šå–å¾—æ–‡ä»¶çš„ä¿¡æ¯ã€‚å¦‚æœè°ƒç”¨çš„å‡½æ•°ï¼ˆ@code{lstat()} æˆ–è€… @code{stat()}ï¼‰è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œåˆ™ä»£ç è®¾ç½® @code{ERRNO} çš„å€¼ç„¶åè¿”å›ï¼š

@example
    /* file is first arg, array to hold results is second */
    if (   ! get_argument(0, AWK_STRING, & file_param)
        || ! get_argument(1, AWK_ARRAY, & array_param)) @{
        warning(ext_id, _("stat: bad parameters"));
        return make_number(-1, result);
    @}

    if (nargs == 3) @{
        statfunc = stat;
    @}

    name = file_param.str_value.str;
    array = array_param.array_cookie;

    /* always empty out the array */
    clear_array(array);

    /* stat the file; if error, set ERRNO and return */
    ret = statfunc(name, & sbuf);
    if (ret < 0) @{
        update_ERRNO_int(errno);
        return make_number(ret, result);
    @}
@end example

å…¶ä»–çš„å†—é•¿çš„å·¥ä½œç”± @code{fill_stat_array()} æ¥å®Œæˆï¼Œè¿™ä¸ªå·²ç»åœ¨å‰é¢å‡ºç°è¿‡ã€‚å½“å®Œæˆæ—¶ï¼Œå‡½æ•°è¿”å›ä» @code{fill_stat_array()} å‡½æ•°ä¸­è¿”å›çš„å€¼ï¼š

@example
    ret = fill_stat_array(name, array, & sbuf);

    return make_number(ret, result);
@}
@end example

æœ€åï¼Œæœ‰å¿…é¡»æä¾›ä¸€äº›â€œèƒ¶æ°´â€æ¥å°†æ–°çš„å‡½æ•°è£…å…¥ @command{gawk}ã€‚

@code{filefuncs} æ‰©å±•ä¹Ÿæä¾›äº†ä¸€ä¸ª @code{fts()} å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨è¿™é‡Œè¿›è¡Œäº†çœç•¥ï¼ˆæŸ¥çœ‹ @pxref{Extension Sample File Functions}ï¼‰ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œæœ‰ä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼š

@example
/* init_filefuncs --- initialization routine */

static awk_bool_t
init_filefuncs(void)
@{
    @dots{}
@}
@end example

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå°±å·®ä¸å¤šå®Œæˆäº†ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ª @code{awk_ext_func_t} ç»“æ„çš„æ•°ç»„ç”¨æ¥è£…è½½æ¯ä¸ªä¸€ä¸ªå‡½æ•°åˆ° @command{gawk} ä¸­ï¼š

@example
static awk_ext_func_t func_table[] = @{
    @{ "chdir", do_chdir, 1 @},
    @{ "stat",  do_stat, 2 @},
#ifndef __MINGW32__
    @{ "fts",   do_fts, 3 @},
#endif
@};
@end example

æ¯ä¸ªæŒ‡é’ˆéƒ½å¿…é¡»æœ‰ä¸€ä¸ªä¾‹ç¨‹åä¸º @code{dl_load()} æ¥è½½å…¥æ‰€æœ‰è¦è¢«è½½å…¥çš„ä¸œè¥¿ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ @file{gawkapi.h} ä¸­çš„ @code{dl_load_func()} å®ï¼š

@example
/* define the dl_load() function using the boilerplate macro */

dl_load_func(func_table, filefuncs, "")
@end example

ä»¥ä¸Šå³æ˜¯æ‰€æœ‰ä»£ç ï¼ 

@node Using Internal File Ops
@subsection æ•´åˆæ‰©å±•

@cindex @command{gawk}, interpreter@comma{} adding code to
ç°åœ¨ä»£ç å·²ç»å†™åœ¨ï¼Œä½†æ˜¯éœ€è¦èƒ½å¤Ÿåœ¨ @command{gawk} è§£é‡Šå™¨è¿è¡Œçš„æ—¶å€™ï¼Œå°†å…¶è½½å…¥ã€‚é¦–å…ˆï¼Œä»£ç æ˜¯éœ€è¦ç¼–è¯‘çš„ã€‚å‡å……å‡½æ•°åœ¨ä¸€ä¸ªåä¸º @file{filefuncs.c} çš„æ–‡ä»¶ä¸­ï¼Œè€Œ @var{idir} æ˜¯ @file{gawkapi.h} å¤´æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ã€‚ä¸‹é¢çš„æ­¥éª¤ ç”¨æ¥åˆ›å»ºä¸€ä¸ª GNU/Linux å…±äº«åº“ï¼š
@footnote{åœ¨å®è·µä¸­ï¼Œä½ å¯èƒ½æƒ³ä½¿ç”¨ GNU Autotoolsï¼ˆAutomakeï¼ŒAutoconfï¼ŒLibtoolï¼Œä»¥åŠ @command{gettext}ï¼‰æ¥é…ç½®åŠæ„å»ºä½ çš„åº“ã€‚å¦‚ä½•æ¥åšè¶…å‡ºäº†æœ¬@value{DOCUMENT}çš„èŒƒå›´ã€‚æŸ¥çœ‹ @ref{gawkextlib}ï¼Œæ¥è·å–è¿™äº›å·¥å…·çš„åœ°å€ã€‚}

@example
$ @kbd{gcc -fPIC -shared -DHAVE_CONFIG_H -c -O -g -I@var{idir} filefuncs.c}
$ @kbd{gcc -o filefuncs.so -shared filefuncs.o}
@end example

åº“ä¸€æ—¦ç”Ÿæˆï¼Œå°±å¯ä»¥é€šè¿‡ @code{@@load} å…³é”®å­—æ¥è¿›è¡Œè½½å…¥ï¼š

@example
# file testff.awk
@@load "filefuncs"

BEGIN @{
    "pwd" | getline curdir  # save current directory
    close("pwd")

    chdir("/tmp")
    system("pwd")   # test it
    chdir(curdir)   # go back

    print "Info for testff.awk"
    ret = stat("testff.awk", data)
    print "ret =", ret
    for (i in data)
        printf "data[\"%s\"] = %s\n", i, data[i]
    print "testff.awk modified:",
        strftime("%m %d %Y %H:%M:%S", data["mtime"])

    print "\nInfo for JUNK"
    ret = stat("JUNK", data)
    print "ret =", ret
    for (i in data)
        printf "data[\"%s\"] = %s\n", i, data[i]
    print "JUNK modified:", strftime("%m %d %Y %H:%M:%S", data["mtime"])
@}
@end example

@env{AWKLIBPATH} ç¯å¢ƒå˜é‡ç”¨æ¥å‘ŠçŸ¥ @command{gawk} åˆ°å“ªé‡Œå»æŸ¥çœ‹æ‰©å±•ï¼ˆæŸ¥çœ‹ @pxref{Finding Extensions}ï¼‰ã€‚æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºå½“å‰ç›®å½•å¹¶æ‰§è¡Œç¨‹åºï¼š

@example
$ @kbd{AWKLIBPATH=$PWD gawk -f testff.awk}
@print{} /tmp
@print{} Info for testff.awk
@print{} ret = 0
@print{} data["blksize"] = 4096
@print{} data["devbsize"] = 512
@print{} data["mtime"] = 1412004710
@print{} data["mode"] = 33204
@print{} data["type"] = file
@print{} data["dev"] = 2053
@print{} data["gid"] = 1000
@print{} data["ino"] = 10358899
@print{} data["ctime"] = 1412004710
@print{} data["blocks"] = 8
@print{} data["nlink"] = 1
@print{} data["name"] = testff.awk
@print{} data["atime"] = 1412004716
@print{} data["pmode"] = -rw-rw-r--
@print{} data["size"] = 666
@print{} data["uid"] = 1000
@print{} testff.awk modified: 09 29 2014 18:31:50
@print{}
@print{} Info for JUNK
@print{} ret = -1
@print{} JUNK modified: 01 01 1970 02:00:00
@end example

@node Extension Samples
@section @command{gawk} å‘è¡Œç‰ˆæœ¬ä¸­çš„ä¾‹å­æ‰©å±•
@cindex extensions distributed with @command{gawk}

è¿™ä¸€@value{SECTION}æä¾›äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­æ‰©å±•çš„æ¦‚å†µï¼Œä¾‹å­ä¸ @command{gawk} ç‰ˆæœ¬ä¸€èµ·å‘å¸ƒã€‚å®ƒä»¬ä¸­çš„ä¸€äº›å°±æ˜¯ç”¨äºç”Ÿäº§ç›®çš„çš„ï¼ˆå¦‚ @code{filefuncs}ï¼Œ@code{readdir}ï¼Œä»¥åŠ @code{inplace} æ‰©å±•ï¼‰ã€‚å…¶ä»–çš„ä¸»è¦æ˜¯ä¸€äº›ä¾‹å­ä»£ç ï¼Œä»¥ç¤ºèŒƒå¦‚ä½•æ¥ä½¿ç”¨æ‰©å±• APIã€‚

@menu
* Extension Sample File Functions::   The file functions sample.
* Extension Sample Fnmatch::          An interface to @code{fnmatch()}.
* Extension Sample Fork::             An interface to @code{fork()} and other
                                      process functions.
* Extension Sample Inplace::          Enabling in-place file editing.
* Extension Sample Ord::              Character to value to character
                                      conversions.
* Extension Sample Readdir::          An interface to @code{readdir()}.
* Extension Sample Revout::           Reversing output sample output wrapper.
* Extension Sample Rev2way::          Reversing data sample two-way processor.
* Extension Sample Read write array:: Serializing an array to a file.
* Extension Sample Readfile::         Reading an entire file into a string.
* Extension Sample Time::             An interface to @code{gettimeofday()}
                                      and @code{sleep()}.
* Extension Sample API Tests::        Tests for the API.
@end menu

@node Extension Sample File Functions
@subsection ä¸æ–‡ä»¶ç›¸å…³çš„å‡½æ•°

@code{filefuncs} æ‰©å±•æä¾›äº†ä¸åŒçš„å‡½æ•°ï¼Œå…¶ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

@table @asis
@item @code{@@load "filefuncs"}
å¦‚ä½•æ¥è£…è½½æ‰©å±•ã€‚

@cindex @code{chdir()} extension function
@item @code{result = chdir("/some/directory")}
@code{chdir()} å‡½æ•°ç›´æ¥æ˜¯ @code{chdir()} ç³»ç»Ÿè°ƒç”¨çš„é’©å­å‡½æ•°ï¼Œç”¨æ¥æ›´æ”¹å½“å‰ç›®å½•ã€‚å¦‚æœæˆåŠŸåˆ™è¿”å› 0ï¼Œå¦‚æœé”™è¯¯åˆ™è¿”å›è´Ÿå€¼ã€‚åœ¨åé¢çš„æƒ…å†µè¿˜ä¼šæ›´æ–° @code{ERRNO} çš„å€¼ã€‚

@cindex @code{stat()} extension function
@item @code{result = stat("/some/path", statdata} [@code{, follow}]@code{)}
@code{stat()} å‡½æ•°æä¾›äº† @code{stat()} ç³»ç»Ÿè°ƒç”¨çš„é’©å­ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å› 0ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å›è´Ÿå€¼ã€‚ååè¿˜ä¼šæ›´æ–° @code{ERRNO}ã€‚

é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ @code{lstat()} çš„ç³»ç»Ÿè°ƒç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¼ é€’äº†ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œåˆ™ä¼šä½¿ç”¨ @code{stat()}ã€‚

æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œå®ƒéƒ½ä¼šæ¸…é™¤ @code{statdata} æ•°ç»„ã€‚å½“è°ƒç”¨æˆåŠŸæ—¶ï¼Œ@code{stat()} ä¼šåœ¨ @code{statdata} æ•°ç»„ä¸­å¡«å……ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¿”å›çš„å€¼ã€‚å¦‚ä¸‹ï¼š

@multitable @columnfractions .15 .50 .20
@headitem ä¸‹æ ‡ @tab Stat ä¸­çš„åŸŸ @code{struct stat} @tab æ–‡ä»¶ç±»å‹
@item @code{"name"} @tab The @value{FN} @tab All
@item @code{"dev"} @tab @code{st_dev} @tab All
@item @code{"ino"} @tab @code{st_ino} @tab All
@item @code{"mode"} @tab @code{st_mode} @tab All
@item @code{"nlink"} @tab @code{st_nlink} @tab All
@item @code{"uid"} @tab @code{st_uid} @tab All
@item @code{"gid"} @tab @code{st_gid} @tab All
@item @code{"size"} @tab @code{st_size} @tab All
@item @code{"atime"} @tab @code{st_atime} @tab All
@item @code{"mtime"} @tab @code{st_mtime} @tab All
@item @code{"ctime"} @tab @code{st_ctime} @tab All
@item @code{"rdev"} @tab @code{st_rdev} @tab Device files
@item @code{"major"} @tab @code{st_major} @tab Device files
@item @code{"minor"} @tab @code{st_minor} @tab Device files
@item @code{"blksize"} @tab @code{st_blksize} @tab All
@item @code{"pmode"} @tab äººå¯è¯»çš„æ¨¡å¼å€¼å­—ä¸²ï¼Œå¦‚ ls æ‰“å°çš„æƒ…å†µï¼ˆå¦‚ @code{"-rwxr-xr-x"}ï¼‰ @tab All
@item @code{"linkval"} @tab è½¯é“¾æ¥çš„å€¼ã€‚ @tab Symbolic links
@item @code{"type"} @tab æ–‡ä»¶ç±»å‹å­—ä¸²è¡¨ç¤ºâ€”â€”
@code{"file"},
@code{"blockdev"},
@code{"chardev"},
@code{"directory"},
@code{"socket"},
@code{"fifo"},
@code{"symlink"},
@code{"door"},
æˆ–è€…
@code{"unknown"}
å…¶ä¸­ä¹‹ä¸€
ï¼ˆå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒè¿™äº›ç±»å‹ï¼‰ @tab All
@end multitable

@cindex @code{fts()} extension function
@item @code{flags = or(FTS_PHYSICAL, ...)}
@itemx @code{result = fts(pathlist, flags, filedata)}
éå†ç”± @code{pathlist} æä¾›çš„æ–‡ä»¶æ ‘ï¼Œå¹¶å¡«å…… @code{filedata} æ•°ç»„ï¼Œå¦‚åæ‰€è¿°ã€‚@code{flags} æ˜¯å‡ ä¸ªé¢„å®šä¹‰å€¼çš„æˆ–ï¼Œä¹Ÿå¦‚åæ‰€è¿°ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¿”å› 0ï¼Œé”™è¯¯åˆ™è¿”å› @minus{}1ã€‚
@end table

@code{fts()} å‡½æ•°æä¾›äº† @code{C} åº“ä¸­çš„ @code{fts()} ä¾‹ç¨‹çš„é’©å­ï¼Œç”¨æ¥ç›®å½•ç»“æ„è¿›è¡Œéå†ã€‚å®ƒä¸ä¼šåœ¨æµä¸­ä¸€æ¬¡è¿”å›ä¸€ä¸ªæ–‡ä»¶çš„æ•°æ®ï¼Œè€Œæ˜¯å°†å…¶ä¿¡æ¯å¡«å……åˆ°ä¸€ä¸ªå¤šç»´æ•°ç»„ä¸­ã€‚è¿™ä¸ªæ•°ç»„ä¸­åŒ…æ‹¬åœ¨éå†ç›®å½•ç»“æ„æ—¶é‡åˆ°çš„æ¯ä¸ªæ–‡ä»¶ä¸ç›®å½•çš„çš„æ•°æ®ã€‚

å‚æ•°å¦‚ä¸‹ï¼š

@table @code
@item pathlist
@value{FN}æ•°ç»„ã€‚ä½¿ç”¨çš„æ˜¯å…ƒç´ çš„å€¼ï¼Œè€Œä¸ä½¿ç”¨å€¼ç´¢å¼•ã€‚

@item flags
è¿™äº›æ˜¯ä¸‹é¢é¢„å®šçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå¸¸é‡çš„æŒ‰ä½æˆ–ã€‚@code{FTS_LOGICAL} ä¸­ @code{FTS_PHYSICAL} å¿…é¡»è¦æä¾›ä¸€ä¸ªï¼Œå¦åˆ™ @code{fts()} ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶è®¾ç½® @code{ERRNO}ã€‚è¿™äº›æ ‡å¿—ä¸ºï¼š

@c nested table
@table @code
@item FTS_LOGICAL
æ‰§è¡Œçš„æ˜¯â€œé€»è¾‘â€ä¸Šçš„æ–‡ä»¶éå†ï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹é’ˆå¯¹é“¾æ¥æ–‡ä»¶è¿”å›çš„ä¿¡æ¯æ˜¯è¢«æŒ‡å‘æ–‡ä»¶çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯é“¾æ¥æ–‡ä»¶æœ¬èº«ã€‚è¿™ä¸ªæ ‡å¿—ä¸ @code{FTS_PHYSICAL} æ˜¯äº’æ–¥çš„ã€‚

@item FTS_PHYSICAL
æ‰§è¡Œä¸€ä¸ªâ€œç‰©ç†â€çš„éå†ï¼Œå…¶ä¸­å¯¹äºè½¯è¿æ¥æ–‡ä»¶çš„ä¿¡æ¯æ˜¯è½¯é“¾æ¥æ–‡ä»¶æœ¬èº«çš„ä¿¡æ¯ã€‚è¿™ä¸ªæ ‡å¿—ä¸ @code{FTS_LOGICAL} æ˜¯äº’æ–¥çš„ã€‚

@item FTS_NOCHDIR
ä½œä¸ºæ€§èƒ½ä¸Šçš„ä¼˜åŒ–ï¼Œ@code{C} åº“ä¸­çš„ @code{fts()} ä¾‹ç¨‹ä¼šæ”¹å˜åœ¨ç›®å½•ç»“æ„ä¸­éå†æ–‡ä»¶æ—¶çš„ç›®å½•ï¼Œè¿™ä¸ªæ ‡å¿—ä¼šç¦ç”¨è¿™ä¸ªä¼˜åŒ–ã€‚

@item FTS_COMFOLLOW
ç›´æ¥è·Ÿè·Ÿéš @code{pathlist} ä¸­å‘½åçš„è½¯è¿æ¥ï¼Œä¸ç®¡æ˜¯å¦è®¾ç½®äº† @code{FTS_LOGICAL} æ ‡å¿—ã€‚

@item FTS_SEEDOT
é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œ@code{C} åº“ä¸­çš„ @code{fts()} ä¾‹ç¨‹ä¸ä¼šè¿”å› @file{.}ï¼ˆdotï¼‰ä»¥åŠ @file{..}ï¼ˆdot-dotï¼‰ç›®å½•é¡¹ã€‚è¿™ä¸ªé€‰é¡¹ä¼šä½¿å¾— dot-dot é¡¹ä¼šè¢«åŒ…å«è¿›æ¥ã€‚ï¼ˆæ‰©å±•æ€»æ˜¯ä¼šåŒ…å« dot çš„é¡¹ï¼Œåé¢ä¼šæœ‰æ›´å¤šçš„è¯´æ˜ã€‚ï¼‰

@item FTS_XDEV
åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œä¸è·¨è¶Šä¸åŒçš„çš„æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚
@end table

@item filedata
@code{filedata} æ•°ç»„å­˜å‚¨ç»“æœã€‚@code{fts()} é¦–å…ˆä¼šå°†å…¶æ¸…é™¤ã€‚ç„¶åä¼šåœ¨ @code{filedata} ä¸­ä¸ºä¼šåœ¨ @code{pathlist} ä¸­çš„æ¯ä¸ªå…ƒç´ åˆ›å»ºä¸€ä¸ªå…ƒç´ ã€‚ç´¢å¼•å³æ˜¯ @code{pathlist} ä¸­æ‰€ç»™çš„ç›®å½•æˆ–è€…æ–‡ä»¶çš„åå­—ã€‚è¿™ä¸ªç´¢å¼•ä¸‹çš„å…ƒç´ æœ¬èº«æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å­˜åœ¨ä¸¤ç§æƒ…å†µï¼š

@c nested table
@table @emph
@item è·¯å¾„æ˜¯ä¸€ä¸ªæ–‡ä»¶
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°ç»„åŒ…å«ä¸¤ä¸ªæˆ–è€…ä¸‰ä¸ªå…ƒç´ ï¼š

@c doubly nested table
@table @code
@item "path"
è¿™ä¸ªæ–‡ä»¶çš„å…¨è·¯å¾„ï¼Œåœ¨ @code{pathlist} æ•°ç»„ä¸­æ˜¯ä»â€œæ ¹â€å¼€å§‹ã€‚

@item "stat"
è¿™ä¸ªå…ƒç´ è‡ªå·±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸æ—©å‰è®¨è®ºçš„ @code{stat()} å‡½æ•°åœ¨è‡ªå·±çš„ @code{statdata} å‚æ•°ä¸­å¡«å……çš„ä¸€æ ·çš„ä¿¡æ¯ã€‚å¦‚æœé’ˆå¯¹æ–‡ä»¶çš„ç³»ç»Ÿè°ƒç”¨ @code{stat()} å‡½æ•°å¤±è´¥ï¼Œåˆ™å¯èƒ½ä¸å­˜åœ¨è¿™ä¸ªå…ƒç´ ã€‚

@item "error"
å¦‚æœå‘ä»€ä¹ˆäº†æŸç§é”™è¯¯ï¼Œæ•°ç»„ä¹ŸåŒ…å«ä¸€ä¸ªåä¸º â€œ@code{error}â€çš„å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ æ˜¯æè¿°é”™è¯¯çš„å­—ä¸²ã€‚
@end table

@item è·¯å¾„æ˜¯ä¸€ä¸ªç›®å½•
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°ç»„ä¸ºæ¯ä¸ªç›®å½•ç”Ÿæˆä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœç›¸åº”çš„é¡¹æ˜¯æ–‡ä»¶ï¼Œåˆ™å…ƒç´ ä¸åˆšæ‰æè¿°çš„æ–‡ä»¶ç±»å‹çš„é¡¹ä¸€æ ·ã€‚å¦‚æœé¡¹æ˜¯ç›®å½•ï¼Œåˆ™å…ƒç´ æ˜¯ä¸€ä¸ªï¼ˆé€’å½’åœ°ï¼‰æè¿°å­ç›®å½•çš„å…ƒç´ ã€‚å¦‚æœ @code{FTS_SEEDOT} åœ¨æ ‡å¿—ä¸­è¿›è¡Œäº†è®¾ç½®ï¼Œåˆ™ä¹Ÿä¼šæˆåœ¨åå­—ä¸º @code{".."} çš„å…ƒç´ ã€‚è¿™ä¸ªå…ƒç´ ä¹Ÿä¼šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†ä» @code{stat()} è°ƒç”¨ä¸­æä¾›çš„ä¿¡æ¯ã€‚

å¦å¤–ï¼Œä¹Ÿæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå…¶ç´¢å¼•ä¸º @code{"."}ã€‚è¿™ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªåŒ…å«ä¸ºæ–‡ä»¶æä¾›çš„ä¸¤ä¸ªæˆ–è€…ä¸‰ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚å®ƒä»¬æ˜¯ï¼Œ@code{"path"}ï¼Œ@code{"stat"}ï¼Œ@code{"error"}ã€‚
@end table
@end table

å¦‚æœæ²¡æœ‰å‡ºé”™ï¼Œ@code{fts()} å‡½æ•°è¿”å› 0ï¼Œå¦åˆ™è¿”å› @minus{}1ã€‚

@quotation æç¤º
@code{fts()} æ‰©å±•å¹¶ä¸æ˜¯ @code{C} åº“ä¸­çš„å‡½æ•° @code{fts()} å®Œå…¨çš„æ¨¡æ‹Ÿï¼Œé€‰æ‹©æä¾›åŸºäºå…³è”æ•°ç»„çš„æ¥å£ï¼Œæ˜¯åœ¨äºåœ¨ @command{awk} ä¸­ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚è¿™é‡Œç¼ºå°‘æ¯”è¾ƒå‡½æ•°ï¼Œå› ä¸º @command{gawk} å·²ç»æä¾›äº†éå¸¸å¼ºå¤§çš„æ•°ç»„æ’åºåŠŸèƒ½ã€‚å°½ç®¡åƒ @code{fts_read()} è¿™æ ·çš„æ¥å£æœ¬æ¥åº”è¯¥æä¾›ï¼Œä½†æ˜¯æ¯”èµ·åˆ›å»ºä¸€ä¸ªå¤šç»´æ•°ç»„æ¥è¡¨ç¤ºæ–‡ä»¶çš„ç›®å½•ç»“æ„ä»¥åŠå…¶ä¿¡æ¯æ¥ï¼Œå®ƒæ²¡æœ‰è¿™ä¹ˆè‡ªç„¶ã€‚
@end quotation

æŸ¥çœ‹ @command{gawk} å‘é¢ç‰ˆæœ¬ä¸­çš„ @file{test/fts.awk} æ–‡ä»¶æ¥è·å–ä½¿ç”¨ @code{fts()} æ‰©å±•å‡½æ•°çš„ä¾‹å­ã€‚

@node Extension Sample Fnmatch
@subsection é’ˆå¯¹ @code{fnmatch()}ã€€çš„æ¥å£

è¿™ä¸ªæ‰©å±•æä¾›äº† @code{C} åº“æ¥å£ @code{fnmatch()} å‡½æ•°ï¼Œä½¿ç”¨æ–¹æ³•ä¸ºï¼š

@table @code
@item @@load "fnmatch"
å¦‚ä½•æ¥è£…è½½è¿™ä¸ªæ‰©å±•ã€‚

@cindex @code{fnmatch()} extension function
@item result = fnmatch(pattern, string, flags)
æˆåŠŸæ—¶ï¼Œè¿”å›å€¼ä¸º 0ï¼Œå¦‚æœå­—ä¸²ä¸åŒ¹é…è¿™ä¸ªæ¨¡å¼åˆ™è¿”å› @code{FNM_NOMATCH}ï¼Œå¦‚æœå‡ºé”™ï¼Œåˆ™è¿”å›ä¸åŒçš„éé›¶å€¼ã€‚
@end table

å…³äº @code{fnmatch()} å‡½æ•°çš„ä¸€äº›å…¶ä»–ä¿¡æ¯ï¼Œ@code{fnmatch} æ‰©å±•åˆ™æ·»åŠ äº†ä¸€ä¸ªå¸¸æ•°ï¼ˆ@code{FNM_NOMATCH}ï¼‰ï¼Œä»¥åŠä¸€ä¸ªåä¸º @code{FNM} çš„æ•°ç»„æ ‡å¿—å€¼ã€‚

@code{fnmatch()} çš„å‚æ•°æœ‰ï¼š

@table @code
@item pattern
è¦åŒ¹é…çš„@value{FN}çš„é€šé…ç¬¦ã€‚

@item string
@value{FN}ä¸²ã€‚

@item flag
è¦ä¹ˆ 0ï¼Œè¦ä¹ˆæ˜¯ @code{FNM} æ•°ç»„ä¸­å¤šä¸ªå€¼çš„ç›¸æˆ–ã€‚
@end table

æ ‡å¿—å¦‚ä¸‹ï¼š

@multitable @columnfractions .25 .75
@headitem æ•°ç»„å…ƒç´  @tab @code{fnmatch()} æ‰€å®šä¹‰çš„å¯¹åº”æ ‡å¿—
@item @code{FNM["CASEFOLD"]} @tab @code{FNM_CASEFOLD}
@item @code{FNM["FILE_NAME"]} @tab @code{FNM_FILE_NAME}
@item @code{FNM["LEADING_DIR"]} @tab @code{FNM_LEADING_DIR}
@item @code{FNM["NOESCAPE"]} @tab @code{FNM_NOESCAPE}
@item @code{FNM["PATHNAME"]} @tab @code{FNM_PATHNAME}
@item @code{FNM["PERIOD"]} @tab @code{FNM_PERIOD}
@end multitable

ä¾‹å­å¦‚ä¸‹ï¼š

@example
@@load "fnmatch"
@dots{}
flags = or(FNM["PERIOD"], FNM["NOESCAPE"])
if (fnmatch("*.a", "foo.c", flags) == FNM_NOMATCH)
    print "no match"
@end example

@node Extension Sample Fork
@subsection é’ˆå¯¹ @code{fork()}ï¼Œ@code{wait()}ï¼Œä¸ @code{waitpid()} çš„æ¥å£

@code{fork} æ‰©å±•æ·»åŠ äº†ä¸‰ä¸ªå‡½æ•°ï¼Œå¦‚ä¸‹ï¼š

@table @code
@item @@load "fork"
å¦‚ä½•æ¥è£…å…¥æ‰©å±•ã€‚

@cindex @code{fork()} extension function
@item pid = fork()
è¿™ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚è¿”å›å€¼åœ¨å­è¿›ç¨‹ä¸­è¿”å›ä¸º 0ï¼Œåœ¨çˆ¶è¿›ç¨‹ä¸­è¿”å›çš„æ˜¯å­è¿›ç¨‹çš„è¿›ç¨‹ @code{ID}ï¼Œæˆ–è€…å‡ºé”™çš„æƒ…å†µä¸‹ä¸º @minus{}1ã€‚åœ¨åé¢çš„æƒ…å†µï¼Œ@code{ERRNO} ç”¨æ¥æŒ‡ç¤ºå‡ºé”™çš„åŸå› ã€‚åœ¨å­è¿›ç¨‹ä¸­ï¼Œ@code{PROCINFO["pid"]} ä»¥åŠ @code{PROCINFO["ppid"]} ä¼šè¢«æ›´æ–°ç”¨ä»¥åæ˜ æ­£ç¡®çš„å€¼ã€‚

@cindex @code{waitpid()} extension function
@item ret = waitpid(pid)
è¿™ä¸ªå‡½æ•°å–æ•°å€¼å‚æ•°ï¼Œå³è¦ç­‰å¾…çš„è¿›ç¨‹çš„ @code{ID}ã€‚è¿”å›å€¼æ˜¯ @code{waitpid()} ç³»ç»Ÿè°ƒç”¨çš„å€¼ã€‚

@cindex @code{wait()} extension function
@item ret = wait()
è¿™ä¸ªå‡½æ•°ç­‰å¾…ç¬¬ä¸€ä¸ªå­è¿›ç¨‹æ­»äº¡ã€‚è¿”å›å€¼æ˜¯ @code{wait()} ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ã€‚
@end table

æ²¡æœ‰ç›¸åº”çš„ @code{exec()} å‡½æ•°ã€‚

ä¸‹é¢æ˜¯ä¾‹å­ï¼š

@example
@@load "fork"
@dots{}
if ((pid = fork()) == 0)
    print "hello from the child"
else
    print "hello from the parent"
@end example

@node Extension Sample Inplace
@subsection å¯ç”¨æ–‡ä»¶å°±åœ°ç¼–è¾‘

@cindex @code{inplace} extension
@code{inplace} æ‰©å±•æ¨¡æ‹Ÿ GNU @command{sed} çš„ @option{-i} é€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹è¡¨ç¤ºå¯¹æ¯ä¸ªè¾“å…¥æ–‡ä»¶è¿›è¡Œâ€œå°±åœ°â€ç¼–è¾‘ã€‚å®ƒä½¿ç”¨æ‰“åŒ…æ–‡ä»¶ @file{inplace.awk}ï¼Œå…¶ä¸­åŒ…å«äº†è¦è°ƒç”¨çš„æ‰©å±•çš„é€‚å½“æ–‡ä»¶ï¼š

@example
@c file eg/lib/inplace.awk
@group
# inplace --- load and invoke the inplace extension.

@@load "inplace"

# Please set INPLACE_SUFFIX to make a backup copy.  For example, you may
# want to set INPLACE_SUFFIX to .bak on the command line or in a BEGIN rule.

# By default, each filename on the command line will be edited inplace.
# But you can selectively disable this by adding an inplace=0 argument
# prior to files that you do not want to process this way.  You can then
# reenable it later on the commandline by putting inplace=1 before files
# that you wish to be subject to inplace editing.

# N.B. We call inplace_end() in the BEGINFILE and END rules so that any
# actions in an ENDFILE rule will be redirected as expected.

BEGIN @{
    inplace = 1		# enabled by default
@}

BEGINFILE @{
    if (_inplace_filename != "")
        inplace_end(_inplace_filename, INPLACE_SUFFIX)
    if (inplace)
        inplace_begin(_inplace_filename = FILENAME, INPLACE_SUFFIX)
    else
        _inplace_filename = ""
@}

END @{
    if (_inplace_filename != "")
        inplace_end(_inplace_filename, INPLACE_SUFFIX)
@}
@end group
@c endfile
@end example

å¯¹äºè¦å¤„ç†çš„æ¯ä¸€ä¸ªå¸¸è§„æ–‡ä»¶ï¼Œæ‰©å±•é‡å®šå‘è¾“å‡ºåˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå…¶ä¸åŸå§‹çš„æ–‡ä»¶å…·æœ‰ç›¸åŒæ‰€æœ‰æƒä»¥åŠè®¿é—®æƒé™ã€‚åœ¨å¤„ç†äº†ç›¸åº”çš„æ–‡ä»¶åï¼Œæ‰©å±•ä¼šæ¢å¤æ ‡å‡†è¾“å‡ºåˆ°åŸæ¥çš„ç›®æ ‡ã€‚å¦‚æœ @code{INPLACE_SUFFIX} ä¸ä¸ºç©ºä¸²ï¼Œåˆ™åˆå§‹æ–‡ä»¶å°†åç¼€è”åˆåˆ›å»ºä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ã€‚æœ€åï¼Œä¸´æ—¶æ–‡ä»¶è¢«é‡æ–°å‘½åä¸ºåˆå§‹æ–‡ä»¶ã€‚

æ³¨æ„ï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªç‰¹æ€§çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­æŠŠ @samp{inplace=0} æ”¾åœ¨ä¸éœ€è¦è¿™æ ·å¤„ç†çš„æ–‡ä»¶åˆ—è¡¨ä¹‹å‰ï¼Œæ¥æ§åˆ¶è¿™ä¸ªç‰¹æ€§ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨éœ€è¦è¿™ä¹ˆå¤„ç†çš„æ–‡ä»¶åˆ—è¡¨å‰åŠ ä¸Š @samp{inplace=1} å‚æ•°æ¥é‡æ–°å¯ç”¨è¿™ä¸ªç‰¹æ€§ã€‚

@code{_inplace_filename} å˜é‡ç”¨æ¥è·Ÿè¸ªå½“å‰çš„æ–‡ä»¶åï¼Œè¿™æ ·ä¸ç”¨åœ¨å¤„ç†ç¬¬ä¸€ä¸ªæ–‡ä»¶æ—¶è°ƒç”¨ @code{inplace_end()}ã€‚

å¦‚æœå‡ºç°çš„é”™è¯¯ï¼Œæ‰©å±•ä¼šç”Ÿæˆä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼Œä»¥ç«‹å³ç»“æŸå¤„ç†ï¼Œä¸ä¼šå¯¹åŸå§‹æ–‡ä»¶é€ æˆç ´åã€‚

è¿™æ˜¯ä¸€äº›ç®€å•çš„ä¾‹å­ï¼š

@example
$ @kbd{gawk -i inplace '@{ gsub(/foo/, "bar") @}; @{ print @}' file1 file2 file3}
@end example

ä¸ºäº†ä¿å­˜åŸæ–‡ä»¶çš„ä¸€ä¸ªå¤‡ä»½å¤æœ¬ï¼Œå¯ä»¥è¿™ä¹ˆæ‰§è¡Œï¼š

@example
$ @kbd{gawk -i inplace -v INPLACE_SUFFIX=.bak '@{ gsub(/foo/, "bar") @}}
> @kbd{@{ print @}' file1 file2 file3}
@end example

è¯·æ³¨æ„ï¼Œå°½ç®¡è¿™ä¸ªæ‰©å±•è¯•å›¾ä¿å­˜åŸå§‹æ–‡ä»¶çš„æ‰€æœ‰æƒå’Œè®¸å¯ï¼Œä½†æ˜¯å®ƒä¸ä¼šè¯•å›¾æ‹·è´åŸå§‹æ–‡ä»¶çš„ ACLã€‚

å¦‚æœç¨‹åºè¿‡æ—©åœ°ç»ˆæ­¢äº†ï¼Œæ¯”å¦‚å¯èƒ½æ”¶åˆ°äº†æœªå¤„ç†çš„ä¿¡å·ï¼Œå¯èƒ½ä¼šç•™ä¸‹ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚

@node Extension Sample Ord
@subsection  å­—ç¬¦ä¸æ•°å€¼ï¼š@code{ord()} ä¸ @code{chr()}

@code{ordchr} æ‰©å±•æ·»åŠ äº†ä¸¤ä¸ªå‡½æ•°ï¼Œåå­—ä¸º @code{ord()} ä¸ @code{chr()}ï¼Œå¦‚ä¸‹ï¼š

@table @code
@item @@load "ordchr"
è¿™é‡Œç”¨æ¥è¿›è¡Œæ‰©å±•è£…è½½ã€‚

@cindex @code{ord()} extension function
@item number = ord(string)
è¿”å› @code{string} ä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æ•°å€¼å€¼ã€‚

@cindex @code{chr()} extension function
@item char = chr(number)
è¿”å›ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯ç”±æ•°å€¼ï¼ˆ@code{number}ï¼‰è¡¨ç¤ºçš„å­—ä¸²ã€‚
@end table

è¿™äº›å‡½æ•°ç”± Pascal è¯­è¨€çš„åŒåå‡½æ•°å€Ÿç”¨è€Œæ¥ã€‚ä¸‹é¢æ˜¯ä¾‹å­ï¼š

@example
@@load "ordchr"
@dots{}
printf("The numeric value of 'A' is %d\n", ord("A"))
printf("The string value of 65 is %s\n", chr(65))
@end example

@node Extension Sample Readdir
@subsection  è¯»å–ç›®å½•

@code{readdir} æ‰©å±•æ·»åŠ äº†ä¸€ä¸ªç›®å½•çš„è¾“å…¥åˆ†æå™¨ï¼Œå…¶ä½¿ç”¨å¦‚ä¸‹ï¼š

@cindex @code{readdir} extension
@example
@@load "readdir"
@end example

å½“ä½¿ç”¨è¿™ä¸ªæ‰©å±•æ—¶ï¼Œå®ƒä¸ä¼šè·³è¿‡åœ¨å‘½ä»¤è¡Œä¸­çš„ç›®å½•ï¼ˆæˆ–è€…ä¹Ÿä¸ä¼šåœ¨ @code{getline} ä¸­è·³è¿‡ï¼‰ï¼Œç›¸åå®ƒä»¬ä¼šè¢«è¯»å–ï¼Œæ¯ä¸€ä¸ªé¡¹ä½œä¸ºä¸€ä¸ªè®°å½•ã€‚

è®°å½•åŒ…å«ä¸‰åŸŸã€‚å¤´ä¸¤ä¸ªåŸŸæ˜¯ @code{inode} å·ä¸@value{FN}ï¼Œç”±æ–œæ ï¼ˆ/ï¼‰è¿›è¡Œåˆ†éš”ã€‚åœ¨ç›®å½•é¡¹ä¸­åŒ…å«æ–‡ä»¶ç±»å‹çš„ç³»ç»Ÿä¸­ï¼Œè®°å½•ä¼šæœ‰ç¬¬ä¸‰ä¸ªåŸŸï¼ˆè¿™ä¸ªåŸŸä¹Ÿç”±æ–œæ ï¼ˆ/ï¼‰è¿›è¡Œåˆ†éš”ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±å•ä¸ªå­—æ¯è¡¨ç¤ºçš„æ–‡ä»¶çš„ç±»å‹ã€‚è¿™äº›å­—æ¯ä»¥åŠæ–‡ä»¶çš„ç›¸åº”çš„ç±»å‹ï¼Œåœ¨ @ref{table-readdir-file-types} ä¸­ã€‚

@float Table,table-readdir-file-types
@caption{ç”± @code{readdir} æ‰©å±•è¿”å›çš„æ–‡ä»¶ç±»å‹}
@multitable @columnfractions .1 .9
@headitem å­—æ¯ @tab æ–‡ä»¶ç±»å‹
@item @code{b} @tab å—è®¾å¤‡
@item @code{c} @tab å­—ç¬¦è®¾å¤‡
@item @code{d} @tab ç›®å½•
@item @code{f} @tab å¸¸è§„æ–‡ä»¶
@item @code{l} @tab ç¬¦å·è¿æ¥
@item @code{p} @tab å‘½ä»¤ç®¡é“ï¼ˆFIFOï¼‰
@item @code{s} @tab @code{Socket}
@item @code{u} @tab å…¶ä»–ï¼ˆæœªçŸ¥ï¼‰
@end multitable
@end float

åœ¨æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»Ÿä¸­ï¼Œç¬¬ä¸‰ä¸ªåŸŸæ€»æ˜¯ @samp{u}ã€‚

@quotation æç¤º
åœ¨ GNU/Linux ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸€äº›æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒ @code{d_type} é¡¹ï¼ˆæŸ¥çœ‹ @code{readdir}(3) æ‰‹å†Œé¡µï¼‰ï¼Œå› æ­¤æ–‡ä»¶ç±»å‹ä¹Ÿæ€»æ˜¯ @samp{u}ã€‚ä½ å¯ä»¥ä½¿ç”¨ @code{filefuncs} æ‰©å±•æ¥è°ƒç”¨ @code{stat()} æ¥å–å¾—æ­£ç¡®çš„ç±»å‹ä¿¡æ¯ã€‚
@end quotation

ä¸‹é¢æ˜¯ä¾‹å­ï¼š

@example
@@load "readdir"
@dots{}
BEGIN @{ FS = "/" @}
@{ print "@value{FN} is", $2 @}
@end example

@node Extension Sample Revout
@subsection å€’è½¬è¾“å‡º

@code{revoutput} æ‰©å±•æ·»åŠ äº†ä¸€ä¸ªç®€å•çš„è¾“å‡ºåŒ…è£…å™¨ï¼ŒåŒ…å«å™¨ä¼šå°†æ¯ä¸ªè¾“å‡ºè¡Œçš„å­—ç¬¦è¿›è¡Œå€’è½¬ã€‚è¿™ä¸ªæ‰©å±•çš„ä¸»è¦ç›®çš„æ˜¯æ¥æ¼”ç¤ºå¦‚ä½•å†™ä¸€ä¸ªè¾“å‡ºåŒ…è£…å™¨ï¼Œå°½ç®¡å®ƒå¯èƒ½æœ‰ç‚¹æ— å˜å¤´ã€‚ä¸‹é¢æ˜¯ä¾‹å­ï¼š

@cindex @code{revoutput} extension
@example
@@load "revoutput"

BEGIN @{
    REVOUT = 1
    print "don't panic" > "/dev/stdout"
@}
@end example

è¿™ä¸ªä¾‹å­ä¸­çš„è¾“å‡ºä¸º @samp{cinap t'nod}ã€‚

@node Extension Sample Rev2way
@subsection åŒè·¯ I/O ä¾‹å­ 

@code{revtwoway} æ‰©å±•æ·»åŠ äº†ä¸€ä¸ªç®€å•çš„åŒè·¯å¤„ç†å™¨ï¼Œç”¨æ¥å°†åˆ @command{awk} ç¨‹åºè¯»å–å›æ¥çš„æ¯ä¸€è¡Œçš„å­—æ¯è¿›è¡Œå€’è½¬ã€‚å®ƒçš„ç›®å½•æ˜¯æ¼”ç¤ºå¦‚ä½•æ¥å†™ä¸€ä¸ªåŒè·¯å¤„ç†ä¸²ï¼Œè¿™ä¹Ÿè®¸ä¹Ÿå¾ˆæ— å˜å¤´ã€‚ä¸‹é¢çš„ä¾‹å­ç¤ºèŒƒå¦‚ä½•æ¥ä½¿ç”¨ï¼š

@cindex @code{revtwoway} extension
@example
@@load "revtwoway"

BEGIN @{
    cmd = "/magic/mirror"
    print "don't panic" |& cmd
    cmd |& getline result
    print result
    close(cmd)
@}
@end example

è¿™ä¸ªç¨‹åºçš„è¾“å‡º
@ifnotinfo
ä¹Ÿæ˜¯ï¼š
@end ifnotinfo
@ifinfo
æ˜¯ï¼š
@end ifinfo
@samp{cinap t'nod}ã€‚

@node Extension Sample Read write array
@subsection è¾“å‡ºä¸æ¢å¤æ•°ç»„

@code{rwarray} æ‰©å±•æ·»åŠ äº†ä¸¤ä¸ªå‡½æ•°ï¼Œåå­—ä¸º @code{writea()} ä¸ @code{reada()}ï¼Œå¦‚ä¸‹ï¼š

@table @code
@item @@load "rwarray"
å¦‚ä½•æ¥è£…è½½æ‰©å±•ã€‚

@cindex @code{writea()} extension function
@item ret = writea(file, array)
è¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå­—ä¸²å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯è¦ dump æ•°ç»„åˆ°æ–‡ä»¶çš„åå­—ï¼Œè€Œæ•°ç»„åˆ™ä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚@code{writea()} å¯ä»¥å¤„ç†æ•°ç»„ä¹‹æ•°ç»„ã€‚å¦‚æœæˆåŠŸåˆ™è¿”å› 1ï¼Œå¦åˆ™è¿”å› 0ã€‚

@cindex @code{reada()} extension function
@item ret = reada(file, array)
@code{reada()} æ˜¯ @code{writea()} çš„ç›¸åçš„ç‰ˆæœ¬ï¼Œå®ƒä»ç”±ç¬¬ä¸€ä¸ªå‚æ•°å‘½ä»¤çš„æ–‡ä»¶ä¸­è¯»å–ï¼Œå¹¶å°†å…¶å¡«å……åˆ°ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°çš„æ•°ç»„ã€‚å®ƒé¦–å…ˆä¼šå°†æ•°ç»„æ¸…ç©ºã€‚åœ¨è¿™é‡Œä¹Ÿæ˜¯æˆåŠŸæ—¶è¿”å› 1ï¼Œå¦åˆ™è¿”å› 0ã€‚
@end table

ç”± @code{reada()} åˆ›å»ºçš„æ•°ç»„ä¸ @code{writea()} æ‰€å†™çš„æ•°ç»„åœ¨æ•°æ®ç›¸åŒçš„æƒ…å†µä¸‹æ˜¯ç›¸åŒçš„ã€‚ä½†æ˜¯ï¼Œç”±äºå®ç°çš„é—®é¢˜ï¼Œé‡å»ºçš„æ•°ç»„çš„éå†é¡ºåºæœ‰å¯èƒ½ä¸åŒäºæœ€å¼€å§‹çš„æ•°ç»„ã€‚åœ¨ @command{awk} ä¸­æ•°ç»„çš„éå†é¡ºåºé»˜è®¤æ˜¯æœªå®šä¹‰çš„ï¼Œè¿™åœ¨æŠ€æœ¯ä¸Šæ¥è®²å¹¶ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚å¦‚æœä½ è¦ä¿è¯ä¸€ä¸ªç‰¹å®šçš„éå†é¡ºåºï¼Œä½¿ç”¨ @command{gawk} ä¸­çš„æ•°ç»„æ’åºç‰¹å®šæ¥å¤„ç†ï¼ˆæŸ¥çœ‹ @pxref{Array Sorting}ï¼‰ã€‚

æ–‡ä»¶ä¸­åŒ…å«çš„æ˜¯äºŒè¿›åˆ¶æ•°æ®ã€‚æ‰€æœ‰çš„æ•´æ•°å€¼éƒ½ä»¥ç½‘ç»œå­—èŠ‚åºå†™å…¥çš„ã€‚ä½†æ˜¯ï¼ŒåŒç²¾åº¦çš„æµ®ç‚¹æ•°æ˜¯ä½¿ç”¨çš„æœ¬åœ°è¿›åˆ¶æ•°æ®ã€‚æ‰€ä»¥ï¼ŒåªåŒ…å«å­—ä¸²æ•°æ®çš„æ•°ç»„ç†è®ºä¸Šåœ¨ç³»ç»Ÿä¸Šæ˜¯ä»¥å­—èŠ‚åºçš„æ–¹å¼è¿›è¡Œè¾“å‡ºçš„ï¼Œä½†æ˜¯åœ¨å¦ä¸€ä¸ªç³»ç»Ÿä¸Šå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰è¯•è¿‡ã€‚

ä¸‹é¢æ˜¯ä¾‹å­ï¼š

@example
@@load "rwarray"
@dots{}
ret = writea("arraydump.bin", array)
@dots{}
ret = reada("arraydump.bin", array)
@end example

@node Extension Sample Readfile
@subsection è¯»å–æ•´ä¸ªæ–‡ä»¶

@code{readfile} æ‰©å±•æ·»åŠ äº†ä¸€ä¸ªå‡½æ•°ï¼Œåå­—ä¸º @code{readfile()}ï¼Œä»¥åŠä¸€ä¸ªè¾“å…¥åˆ†æå™¨ï¼š

@table @code
@item @@load "readfile"
å¦‚ä½•æ¥ä½¿ç”¨æ‰©å±•ã€‚

@cindex @code{readfile()} extension function
@item result = readfile("/some/path")
å‚æ•°æ˜¯è¦è¯»å–çš„æ–‡ä»¶çš„åå­—ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªå­—ä¸²ï¼Œå…¶ä¸­åŒ…å«æ‰€è¯·æ±‚æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹ã€‚å¦‚æœé”™è¯¯ï¼Œå‡½æ•°è¿”å›ç©ºä¸²ï¼Œå¹¶è®¾ç½® @code{ERRNO} çš„å€¼ã€‚

@item BEGIN @{ PROCINFO["readfile"] = 1 @}
å¦å¤–ï¼Œæ‰©å±•æ·»åŠ äº†ä¸€ä¸ªè¾“å…¥åˆ†æå™¨ï¼Œå¦‚æœ @code{PROCINFO["readfile"]} å­˜åœ¨æ—¶åˆ™ä¼šè¢«æ¿€æ´»ã€‚å½“è¢«æ¿€æ´»æ—¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä»¥æ•´ä¸ªçš„å†…å®¹è¿”å›ä¸º @code{$0}ï¼Œ@code{RT} è¢«è®¾ç½®ä¸ºç©ºä¸²ã€‚
@end table

ä¸‹é¢çš„ä¾‹å­ï¼š

@example
@@load "readfile"
@dots{}
contents = readfile("/path/to/file");
if (contents == "" && ERRNO != "") @{
    print("problem reading file", ERRNO) > "/dev/stderr"
    ...
@}
@end example

@node Extension Sample Time
@subsection æ‰©å±•çš„æ—¶é—´å‡½æ•°

@code{time} æ‰©å±•æ·»åŠ äº†ä¸¤ä¸ªå‡½æ•°ï¼Œåå­—ä¸º @code{gettimeofday()} ä»¥åŠ @code{sleep}ï¼Œå¦‚ä¸‹ï¼š

@table @code
@item @@load "time"
å¦‚ä½•æ¥ä½¿ç”¨æ‰©å±•ã€‚

@cindex @code{gettimeofday()} extension function
@item the_time = gettimeofday()
è¿”å›ä» 1970-01-01 UTC ä»¥æ¥çš„æ¶ˆé€çš„ç§’æ•°ï¼Œç±»å‹ä¸ºæµ®ç‚¹æ•°ã€‚å¦‚æœæ—¶é—´åœ¨å¹³å°ä¸Šä¸å¯å¾—ï¼Œåˆ™è¿”å› @minus{}1 å¹¶è®¾ç½® @code{ERRNO}ã€‚è¿”å›çš„æ—¶é—´åº”è¯¥æœ‰æ¬¡ç§’çš„ç²¾åº¦ï¼Œä½†æ˜¯å®é™…çš„ç²¾åº¦åœ¨ä¸åŒçš„å¹³å°ä¸Šæ˜¯ä¸åŒçš„ã€‚å¦‚æœæ ‡å‡†çš„  C @code{gettimeofday()} ç³»ç»Ÿè°ƒç”¨åœ¨å¹³å°ä¸Šæ˜¯å¯ç”¨çš„ï¼Œåˆ™å®ƒåªæ˜¯ç®€å•åœ°è¿”å›è¿™ä¸ªå‡½æ•°çš„å€¼ã€‚å¦åˆ™ï¼Œå¦‚æœåœ¨ MS-Windows å¹³å°ä¸Šï¼Œå®ƒè¿”å› @code{GetSystemTimeAsFileTime()} å‡½æ•°è¿”å›çš„å€¼ã€‚

@cindex @code{sleep()} extension function
@item result = sleep(@var{seconds})
å°è¯•ä¼‘çœ  @var{seconds} ç§’ã€‚å¦‚æœ @var{seconds} ä¸ºè´Ÿæ•°ï¼Œæˆ–è€…å°è¯•ä¼‘çœ å¤±è´¥ï¼Œåˆ™è¿”å› @minus{}1 å¹¶ä¸”è®¾ç½® @code{ERRNO}ã€‚å¦åˆ™åœ¨ä¼‘çœ äº†æŒ‡å®šçš„æ—¶é—´åè¿”å› 0ã€‚æ³¨æ„ï¼Œ@var{seconds} å¯ä»¥æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼ˆéæ•´æ•°ï¼‰ã€‚å®ç°ç»†èŠ‚æ˜¯ï¼šä¾èµ–äºå¹³å°çš„å¯è·å¾—æ€§ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå°è¯•ä½¿ç”¨ @code{nanosleep()} æˆ–è€… @code{select} æ¥å®ç°å»¶è¿Ÿã€‚
@end table

@node Extension Sample API Tests
@subsection @code{API} æµ‹è¯•
@cindex @code{testext} extension

@code{testext} æ‰©å±•æ‰§è¡Œæ‰©å±• @code{API} ä¸­æ²¡æœ‰åœ¨è¢«å…¶ä»–ä¾‹å­æµ‹è¯•åˆ°çš„éƒ¨åˆ†ã€‚@file{extension/testext.c} æ–‡ä»¶åŒ…å«æ‰©å±•çš„ @code{C} ä»£ç ä»¥åŠ @command{awk} æµ‹è¯•ä»£ç ï¼Œè¿™äº›ä»£ç æ³¨é‡Šåœ¨æ‰§è¡Œæµ‹è¯•çš„ C æ³¨é‡Šä¸­ã€‚æµ‹è¯•æ¡†æ¶æå– @command{awk} ä»£ç æ¥æ‰§è¡Œæµ‹è¯•ã€‚æŸ¥çœ‹æºä»£ç æ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚

@node gawkextlib
@section @code{gawkextlib} é¡¹ç›®
@cindex @code{gawkextlib}
@cindex extensions, where to find

@cindex @code{gawkextlib} project
@uref{http://sourceforge.net/projects/gawkextlib/, @code{gawkextlib}} é¡¹ç›®æä¾›äº†å¾ˆå¤šçš„ @command{gawk} æ‰©å±•ï¼ŒåŒ…å«ç”¨äºå¤„ç† XML æ–‡ä»¶çš„æ‰©å±•ï¼Œè¿™æ˜¯ç”±æœ€å¼€å§‹çš„ @command{xgawk}ï¼ˆXML @command{gawk}ï¼‰é¡¹ç›®æ¼”åŒ–è¿‡æ¥çš„ã€‚

åœ¨å†™æœ¬ä¹¦çš„æ—¶å€™ï¼Œä¸€å…±æœ‰ä¸ƒä¸ªæ‰©å±•ï¼š

@itemize @value{BULLET}
@item
@code{errno} æ‰©å±•

@item
GD graphics åº“æ‰©å±•

@item
PDF æ‰©å±•

@item
PostgreSQL æ‰©å±•

@item
MPFR åº“æ‰©å±•
ï¼ˆè¿™æä¾›äº†è®¿é—®å¾ˆå¤šçš„ MPFR å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨ @command{gawk} çš„æœ¬åœ° MPFR æ˜¯ä¸è¢«æ”¯æŒçš„ï¼‰

@item
Redis æ‰©å±•

@item
XML åˆ†æå™¨æ‰©å±•ï¼Œè¿™ä¸ªæ‰©å±•ä½¿ç”¨ @uref{http://expat.sourceforge.net, Expat} XML åˆ†æåº“
@end itemize

@cindex @command{git} utility
ä½ å¯ä»¥æŸ¥çœ‹ @code{gawkextlib} é¡¹ç›®çš„ä»£ç ï¼Œè¿™äº›ä»£ç å¯ä»¥é€šè¿‡ @uref{http://git-scm.com, Git} åˆ†å¸ƒå¼æºä»£ç æ‰©å±•ç³»ç»Ÿè·å–ã€‚ç›¸åº”çš„å‘½ä»¤ä¸ºï¼š

@example
git clone git://git.code.sf.net/p/gawkextlib/code gawkextlib-code
@end example

@cindex Expat XML parser library
ä¸ºäº†æ„å»º XML æ‰©å±• ï¼Œä½ éœ€è¦åœ¨ä½ çš„ç³»ç»Ÿå·²ç»å®‰è£…å¥½äº† @uref{http://expat.sourceforge.net, Expat} XML åˆ†æåº“ã€‚

å¦å¤–ï¼Œä½ å¿…é¡»è¿˜è¦æœ‰ GNU Autotools å®‰è£…åœ¨ç³»ç»Ÿä¸Šï¼ˆ@uref{http://www.gnu.org/software/autoconfï¼ŒAutoconf}ï¼Œ@uref{http://www.gnu.org/software/automakeï¼ŒAutomake}ï¼Œ@uref{http://www.gnu.org/software/libtoolï¼ŒLibtool}ï¼Œå’Œ @uref{http://www.gnu.org/software/gettextï¼ŒGNU @command{gettext}}ï¼‰ã€‚

ä¸€ä¸ªç®€å•çš„æ„å»ºä¸æµ‹è¯• @code{gawkextlib} çš„è¿‡ç¨‹å¦‚ä¸‹ã€‚é¦–å…ˆæ˜¯æ„å»ºä¸å®‰è£…  @command{gawk}ï¼š

@example
cd .../path/to/gawk/code
./configure --prefix=/tmp/newgawk     @ii{Install in /tmp/newgawk for now}
make && make check                    @ii{Build and check that all is OK}
make install                          @ii{Install gawk}
@end example

æ¥ä¸‹æ¥ï¼Œåˆ° @url{http://sourceforge.net/projects/gawkextlib/files} ä¸­ä¸‹è½½ @code{gawkextlib} ä»¥åŠä»»æ„çš„ä½ æƒ³è¦æ„å»ºçš„æ‰©å±•ã€‚ç«™ç‚¹ä¸­çš„ @file{README} æ–‡ä»¶è¯´æ˜äº†å¦‚ä½•æ¥æ„å»ºä»£ç ã€‚å¦‚æœä½ å°† @command{gawk} å®‰è£…åœ¨ä¸€ä¸ªéæ ‡å‡†çš„ä½ç½®ï¼Œä½ è¿˜è¦æŒ‡å®š @code{./configure --with-gawk=@var{/path/to/gawk}} æ¥æŒ‡å®šå®ƒã€‚ä½ å¯èƒ½éœ€è¦ä½¿ç”¨ @command{sudo} å·¥å…·æ¥å®‰è£… @command{gawk} ä¸ @code{gawkextlib}ï¼Œè¿™è§†ä½ æ‰€åœ¨çš„ç³»ç»Ÿçš„å·¥ä½œæ–¹å¼ã€‚

å¦‚æœä½ å†™äº†ä¸€ä¸ªæ‰©å±•ï¼Œè€Œå¸Œæœ›ä¸å…¶ä»–çš„ @command{gawk} ç”¨æˆ·ä¸€èµ·åˆ†ç¦»ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡ @code{gawkextlib} é¡¹ç›®æ¥è¿›è¡Œåˆ†å‘ã€‚æŸ¥çœ‹è¿™ä¸ªé¡¹ç›®çš„ç½‘ç«™æ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚

@node Extension summary
@section æ€»ç»“

@itemize @value{BULLET}
@item
ä½ å¯ä»¥ä¸º @command{gawk} ç”¨ C æˆ–è€… C++ ï¼Œå¹¶åˆ©ç”¨ç”± @command{gawk} å¼€å‘è€…æ‰€å®šä¹‰çš„åº”ç”¨ç¨‹åºæ¥å£ï¼ˆAPIï¼‰æ¥å†™æ‰©å±•ï¼ˆæœ‰æ—¶ä¹Ÿå«æ’ä»¶ï¼‰ã€‚

@item
æ‰©å±•å¿…é¡»æœ‰ä¸€ä¸ªä¸ GNU é€šç”¨è®¸å¯è¯åè®®ï¼ˆGPLï¼‰å…¼å®¹çš„è®¸å¯è¯ï¼Œè€Œå®ƒä»¬å¿…é¡»é€šè¿‡å£°æ˜ä¸€ä¸ªåä¸º @code{plugin_is_GPL_compatible} çš„å˜é‡æ¥è¿›è¡Œæ–­è¨€ã€‚

@item
åœ¨ @command{gawk} ä¸æ‰©å±•ä¹‹é—´çš„é€šä¿¡æ˜¯åŒå‘çš„ï¼Œ@command{gawk} å°†ä¸€ä¸ªç»“æ„ @code{struct} ä¼ é€’ç»™æ‰©å±•ï¼Œè¿™ä¸ªç»“æ„ä¸­åŒ…å«äº†å„ç§æ•°ç»„æˆå‘˜ä»¥åŠå‡½æ•°æŒ‡é’ˆã€‚è€Œæ‰©å±•å¯ä»¥é€šè¿‡ @command{gawk} æä¾›çš„å‡½æ•°æ¥è°ƒç”¨ @command{gawk} ä»¥å®ç°ç‰¹å®šçš„ä»»åŠ¡ã€‚

@item
è¿™äº›å·¥ä½œå…¶ä¸­ä¹‹ä¸€æ˜¯â€œæ³¨å†Œâ€åå­—ä¸æ–°çš„ @command{awk} å±‚åŠŸèƒ½å®ç°åˆ° @command{gawk} ä¸­ï¼Œè¿™äº›å®ç°åå­—ä¸º @code{do_@var{XXXX}()}ï¼Œè€Œè¿™ä¸ªå‡½æ•°å®ç°çš„æ˜¯ @command{awk} å±‚çš„å‡½æ•° @code{@var{XXXX}()}ã€‚

@item
API å®šä¹‰åœ¨å¤´æ–‡ä»¶ @file{gawkapi.h} ä¸­ã€‚ä½ çš„æºä»£ç ä¸­ï¼Œå¿…é¡»åœ¨åŒ…å«è¿™ä¸ªå¤´æ–‡ä»¶@emph{ä¹‹å‰}åŒ…å«å¾ˆå¤šçš„æ ‡å‡†å¤´æ–‡ä»¶ã€‚

@item
@code{API} å‡½æ•°æŒ‡é’ˆå¯æä¾›ä¸‹é¢çš„æ“ä½œï¼š

@itemize @value{BULLET}
@item
åˆ†é…ï¼Œé‡æ–°åˆ†æä»¥åŠé‡Šæ”¾å†…å­˜

@item
æ³¨å†Œå‡½æ•°ï¼ˆä½ å¯ä»¥æ³¨å†Œæ‰©å±•å‡½æ•°ï¼Œé€€å‡ºå›è°ƒå‡½æ•°ï¼Œç‰ˆæœ¬å­—ä¸²ï¼Œè¾“å…¥åˆ†æå™¨ï¼Œè¾“å‡ºåŒ…è£…å™¨ä»¥åŠåŒè·¯å¤„ç†å™¨ï¼‰

@item
æ‰“å°è‡´å‘½é”™è¯¯ï¼Œå‘Šè­¦ä»¥åŠâ€œlintâ€è­¦å‘Šä¿¡æ¯

@item
æ›´æ–° @code{ERRNO} æˆ–è€…é‡ç½®å®ƒ

@item
è®¿é—®å‚æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬å°†ä¸€ä¸ªæœªå®šä¹‰çš„å‚æ•°è½¬æ¢ä¸ºæ•°ç»„

@item
ç¬¦å·è¡¨è®¿é—®ï¼ˆè¿”å›å…¨å±€å˜é‡ï¼Œåˆ›å»ºæˆ–è€…æ›´æ”¹å˜é‡ï¼‰

@item
åˆ›å»ºå¹¶ç¿»è¯‘ç¼“å­˜å€¼ï¼Œè¿™ä¼šç»™ä½¿ç”¨å¤šä¸ªå˜é‡å€¼æä¾›ä¸€ç§é«˜æ•ˆçš„æ–¹æ³•ï¼Œä¸”è·å–å·¨å¤§çš„æ€§èƒ½å›æŠ¥

@item
æ“ä½œæ•°ç»„ï¼ˆè¿”å›ï¼Œæ·»åŠ ï¼Œåˆ é™¤æˆ–è€…ä¿®æ”¹å…ƒç´ ï¼Œè·å–æ•°ç»„å…ƒç´ ä¸ªæ•°ï¼Œåˆ›å»ºæ–°æ•°ç»„ï¼Œæ¸…é™¤æ•°ç»„ï¼Œæ‰å¹³åŒ–æ•°ç»„æ¥ä½¿ç”¨ç®€å•çš„ C é£æ ¼çš„å¾ªç¯æ¥è®¿é—®å…¶æ‰€æœ‰çš„ç´¢å¼•ä¸å…ƒç´ ã€‚

@end itemize

@item
API å®šä¹‰äº†å¾ˆå¤šçš„æ ‡å‡†æ•°ç»„ç±»å‹ç”¨æ¥è¡¨ç¤º @command{awk} çš„å€¼ï¼Œæ•°ç»„å…ƒç´ ä»¥åŠæ•°ç»„ã€‚

@item
API æä¾›äº†æ–¹ä¾¿çš„å‡½æ•°ç”¨æ¥æ„å»ºå€¼ã€‚ä¹Ÿæä¾›äº†å†…å­˜ç®¡ç†å‡½æ•°æ¥ä¿è¯ @command{gawk} åˆ†é…çš„å†…å­˜ä¸ç”±æ‰©å±•åˆ†é…çš„å†…å­˜çš„å…¼å®¹æ€§ã€‚

@item
@emph{æ‰€æœ‰çš„}ä» @command{gawk} ä¼ é€’ç»™æ‰©å±•çš„å†…å­˜å¿…é¡»è¢«æ‰©å±•å½“æˆæ˜¯åªè¯»çš„ã€‚

@item
@emph{æ‰€æœ‰çš„}ç”±æ‰©å±•ä¼ é€’ç»™ @command{gawk} çš„å†…å­˜å¿…é¡»é€šè¿‡ @code{API} çš„å†…å­˜åˆ†é…å‡½æ•°æ¥åˆ†é…ã€‚@command{gawk} ä¼šç®¡ç†è¿™äº›å†…å­˜å¹¶åœ¨åˆé€‚çš„æ—¶é—´é‡Šæ”¾å®ƒã€‚

@item
API æä¾›äº† @command{gawk} è¿è¡Œæ—¶çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¿™æ ·æ‰©å±•å¯ä»¥ç¡®å®šå…¶æ˜¯å¦ä¸è½½å…¥æ‰©å±•çš„ @command{gawk} å…¼å®¹ã€‚

@item
æœ€å®¹æ˜“çš„å¼€å¯ä¸€ä¸ªæ–°æ‰©å±•çš„æ–¹å¼æ˜¯å¤æ‚è¿™ä¸€@value{CHAPTER}ä¸­çš„æ ·æ¿ä»£ç ã€‚@file{gawkapi.h} ä¸­çš„å®å¯ä»¥ç®€åŒ–è¿™ä¸ªå·¥ä½œã€‚

@item
@command{gawk} å‘å¸ƒç‰ˆåŒ…å«äº†å¾ˆå¤šå°çš„ï¼Œå¾ˆæœ‰ç”¨çš„ä¾‹å­æ‰©å±•ã€‚@code{gawkextllib} é¡¹ç›®åŒ…å«äº†å‡ ä¸ªæ›´å¤§çš„æ‰©å±•ã€‚å¦‚æœä½ å¸Œæœ›å†™ä¸€ä¸ªæ‰©å±•å¹¶å°†å…¶åˆ†äº«ç»™ @command{gawk} çš„ç”¨æˆ·ç¤¾åŒºï¼Œ@code{gawkextlib} å¯ä»¥ç”¨äºè¿™æ ·çš„ç›®çš„ã€‚

@end itemize

@c EXCLUDE START
@node Extension Exercises
@section ç»ƒä¹ 

@enumerate
@item
æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥å®ç°ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚ @code{chown()}ï¼Œ@code{chmod()}ï¼Œä»¥åŠ @code{umask()} æ¥æ‰§è¡Œæ–‡ä»¶æ“ä½œã€‚è¿™äº›å‡½æ•°æ·»åŠ åˆ° @ref{Internal File Ops} ä¸­çš„æ‰©å±•ä¸­ã€‚

@c Idea from comp.lang.awk, February 2015
@item
å†™ä¸€ä¸ªè¾“å…¥åˆ†æå™¨ï¼Œåœ¨è¾“å…¥æ˜¯æ¥è‡ªäºâ€œç»ˆç«¯â€è®¾å¤‡æ—¶åˆ™æ‰“å°ä¸€ä¸ªæç¤ºã€‚ä½ å¯ä»¥ä½¿ç”¨ @code{isatty()} å‡½æ•°ä»¥è·å–è¾“å…¥æ–‡ä»¶æ˜¯å¦æ˜¯ä¸€ä¸ªç»ˆç«¯ã€‚ï¼ˆæç¤ºï¼šè¿™ä¸ªå‡½æ•°è°ƒç”¨èµ·æ¥é€šå¸¸å¾ˆæ…¢ï¼Œæœ€å¥½åªè°ƒç”¨ä¸€æ¬¡ã€‚ï¼‰æç¤ºçš„å†…å®¹åº”è¯¥ä¸€ä¸ªå¯è¢« @command{awk} å±‚ä»£ç è®¾ç½®çš„å˜é‡ã€‚ä½ å¯ä»¥å°†æç¤ºå†™åˆ°æ ‡å‡†é”™è¯¯ä¸­ã€‚ä½†æ˜¯ä¸ºäº†æœ€å¥½çš„ç»“æœï¼Œæ˜¯æ‰“å¼€ä¸€ä¸ªåœ¨ @file{/dev/tty} ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆæˆ–è€…æ–‡ä»¶æŒ‡é’ˆï¼‰å¹¶åœ¨å…¶ä¸Šæ‰“å°æç¤ºï¼Œå› ä¸ºæœ‰å¯èƒ½æ ‡å‡†é”™è¯¯å¯èƒ½ä¼šè¢«é‡å®šå‘ã€‚

ä¸ºä»€ä¹ˆæ ‡å‡†é”™è¯¯æ¯”æ ‡å‡†è¾“å‡ºæ˜¯ç”¨æ¥è¾“å‡ºæç¤ºçš„æ›´å¥½é€‰æ‹©ï¼Ÿä½ è¦æ›¿æ¢æˆä»€ä¹ˆæ ·çš„è¯»å–æœºåˆ¶ï¼Œæ˜¯ä¸€æ¬¡ä¸€æ¡è®°å½•è¿˜æ˜¯ä¸€æ¬¡è¯»å–å¤šä¸ªåŸå§‹å­—èŠ‚ï¼Ÿ

@item
ï¼ˆéš¾ï¼‰å¦‚ä½ ä½•åœ¨ @command{gawk} ä¸­æ¥æä¾›ä¸€ä¸ªåå­—ç©ºé—´ï¼ˆ@code{namespace}ï¼‰ï¼Œè¿™æ ·ä¸åŒæ‰©å±•ä¸­çš„å‡½æ•°åå­—ä¸ä¼šç›¸äº’å†²çªï¼Ÿå¦‚æœä½ æƒ³å‡ºäº†ä¸€ä¸ªå¥½æ–¹æ¡ˆï¼Œè¯·ä¸ @command{gawk} çš„ç»´æŠ¤è€…è”ç³»å¹¶å‘ŠçŸ¥è¿™ä¸ªæ–¹æ¡ˆã€‚

@item
å†™ä¸€ä¸ªåŒ…è£…è„šæœ¬æ¥æä¾›ä¸€ä¸ªä¸ @samp{sed -i} ç›¸ä¼¼çš„æ¥å£ï¼Œä»¥å®ç°åœ¨ @ref{Extension Sample Inplace} ä¸­çš„â€œinplaceâ€æ‰©å±•ã€‚

@end enumerate
@c EXCLUDE END

@ifnotinfo
@part @value{PART4} é™„å½•
@end ifnotinfo

@ifdocbook

@ifclear FOR_PRINT
Part IV contains the appendices (including the two licenses that cover
the @command{gawk} source code and this @value{DOCUMENT}, respectively)
and the Glossary:
@end ifclear

@ifset FOR_PRINT
Part IV contains three appendices, the last of which is the license that
covers the @command{gawk} source code:
@end ifset

@itemize @value{BULLET}
@item
@ref{Language History}

@item
@ref{Installation}

@ifclear FOR_PRINT
@item
@ref{Notes}

@item
@ref{Basic Concepts}

@item
@ref{Glossary}
@end ifclear

@item
@ref{Copying}

@ifclear FOR_PRINT
@item
@ref{GNU Free Documentation License}
@end ifclear
@end itemize
@end ifdocbook

@node Language History
@appendix @command{awk} è¯­è¨€çš„æ¼”åŒ–

æœ¬@value{DOCUMENT}æè¿°çš„ @command{awk} çš„ GNU ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ @command{awk} æ˜¯ç¬¦å· POSIX æ ‡å‡†çš„ã€‚å¾ˆå¤šçš„è€ @command{awk} ç”¨æˆ·ä½¿ç”¨ Unix Version 7 ç‰ˆæœ¬çš„ @command{awk} å¼€å§‹å­¦ä¹  @command{awk} è¯­è¨€ã€‚ï¼ˆè¿™ä¸ªç‰ˆæœ¬çš„å®ç°æ˜¯ Berkeley Unix 4.3 è‡³ Reno ä¸­çš„ @command{awk} ç‰ˆæœ¬çš„åŸºç¡€ã€‚åç»­çš„ @code{Berkeley} Unix ç‰ˆæœ¬ï¼Œå¹¶ä¸”æœ‰ä¸€æ®µæ—¶é—´ï¼Œä¸€äº›ç”± 4.4 @code{BSD}-@code{Lite} æ´¾ç”Ÿå‡ºæ¥ Unix ç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„ç‰ˆæœ¬ @command{gawk} æ¥ä½œä¸ºè¿™äº›ç³»ç»Ÿä¸Šçš„ @command{awk}ã€‚ï¼‰è¿™ä¸€@value{CHAPTER}ç®€å•åœ°æè¿° @command{awk} è¯­è¨€çš„æ¼”åŒ–è¿‡ç¨‹ï¼Œå¹¶å¯¹@value{DOCUMENT}ä¸­ç›¸åº”çš„ç« èŠ‚åšäº†å¼•ç”¨ ï¼Œè¿™æ ·ä½ å¯ä»¥çœ‹åˆ°æ›´å¤šçš„ä¿¡æ¯ã€‚

@ifset FOR_PRINT
To save space, we have omitted
information on the history of features in @command{gawk} from this
edition. You can find it in the
@uref{http://www.gnu.org/software/gawk/manual/html_node/Feature-History.html,
online documentation}.
@end ifset

@menu
* V7/SVR3.1::                   The major changes between V7 and System V
                                Release 3.1.
* SVR4::                        Minor changes between System V Releases 3.1
                                and 4.
* POSIX::                       New features from the POSIX standard.
* BTL::                         New features from Brian Kernighan's version of
                                @command{awk}.
* POSIX/GNU::                   The extensions in @command{gawk} not in POSIX
                                @command{awk}.
* Feature History::             The history of the features in @command{gawk}.
* Common Extensions::           Common Extensions Summary.
* Ranges and Locales::          How locales used to affect regexp ranges.
* Contributors::                @command{gawk} çš„ä¸»è¦è´¡çŒ®è€….
* History summary::             History summary.
@end menu

@node V7/SVR3.1
@appendixsec åœ¨ V7 ä¸ SVR3.1 ä¹‹é—´çš„å˜åŒ–
@cindex @command{awk}, versions of
@cindex @command{awk}, versions of, changes between V7 and SVR3.1

@command{awk} è¯­è¨€åœ¨ Unix Version 7ï¼ˆ1978ï¼‰ä¸ System V Release 3.1ï¼ˆ1987ï¼‰ä¸­ä½œä¸ºé€šç”¨å¸¸ç”¨å·¥å…·ç¬¬ä¸€ä¸ªæ–°ç‰ˆæœ¬ä¹‹é—´æœ‰éå¸¸å¤§çš„å˜åŒ–ã€‚è¿™@value{SECTION}å¯¹å…¶ä¸­çš„å˜åŒ–è¿›è¡Œå½’çº³ï¼Œå¹¶æœ‰ç›¸åº”çš„å‚è€ƒï¼Œè¿™æ ·å¯ä»¥è·å–è¿›ä¸€æ­¥çš„ä¿¡æ¯ï¼š

@itemize @value{BULLET}
@item
éœ€è¦ç”¨ @samp{;} æ¥åˆ†éš”ä¸€è¡Œä¸­çš„è§„åˆ™ï¼ˆæŸ¥çœ‹ @pxref{Statements/Lines}ï¼‰ã€‚

@item
ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¸ @code{return} è¯­å¥ï¼ˆæŸ¥çœ‹ @pxref{User-defined}ï¼‰ã€‚

@item
@code{delete} è¯­å¥ï¼ˆæŸ¥çœ‹ @pxref{Delete}ï¼‰ã€‚

@item
@code{do}-@code{while} è¯­å¥ï¼ˆæŸ¥çœ‹ @pxref{Do Statement}ï¼‰ã€‚

@item
å†…ç½®å‡½æ•° @code{atan2()}ï¼Œ@code{cos()}ï¼Œ@code{sin()}ï¼Œ@code{rand()} ä¸ @code{srand()}ï¼ˆæŸ¥çœ‹ @pxref{Numeric Functions}ï¼‰ã€‚

@item
å†…ç½®å‡½æ•° @code{gsub()}ï¼Œ@code{sub()} ä¸ @code{match()}ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
å†…ç½®å‡½æ•° @code{close()} ä¸ @code{system()}ï¼ˆæŸ¥çœ‹ @pxref{I/O Functions}ï¼‰ã€‚

@item
@code{ARGC}ï¼Œ@code{ARGV}ï¼Œ@code{FNR}ï¼Œ@code{RLENGTH}ï¼Œ@code{RSTART} ä¸ @code{SUBSEP} é¢„å®šä¹‰å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ã€‚

@item
å¯èµ‹å€¼çš„ @code{$0}ï¼ˆæŸ¥çœ‹ @pxref{Changing Fields}ï¼‰ã€‚

@item
ä½¿ç”¨ä¸‰å…ƒæ“ä½œç¬¦ @samp{?:} çš„æ¡ä»¶è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{Conditional Exp}ï¼‰ã€‚

@item
åœ¨ @code{for} è¯­å¥ä¹‹å¤–çš„ @samp{@var{indx} in @var{array}} è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{Reference to Elements}ï¼‰ã€‚

@item
å¹‚æ“ä½œç¬¦ @samp{^}ï¼ˆæŸ¥çœ‹ @pxref{Arithmetic Ops}ï¼‰ä¸å…¶èµ‹å€¼æ“ä½œç¬¦å½¢å¼ @samp{^=}ï¼ˆæŸ¥çœ‹ @pxref{Assignment Ops}ï¼‰ã€‚

@item
ä¸ C å…¼å®¹çš„æ“ä½œç¬¦ä¼˜å…ˆçº§ï¼Œè¿™ä¸ªä¸ä¸€äº›æ—§çš„ @command{awk} ç¨‹åºä¸åŒï¼ˆæŸ¥çœ‹ @pxref{Precedence}ï¼‰ã€‚

@item
æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ä½œä¸º @code{FS} çš„å€¼ï¼ˆæŸ¥çœ‹ @pxref{Field Separators}ï¼‰ä»¥åŠä½œä¸º @code{split()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ @code{FS} çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚

@item
ä½œä¸º @samp{~} ä¸ @samp{!~} æ“ä½œç¬¦æ“ä½œæ•°çš„åŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{Computed Regexps}ï¼‰ã€‚

@item
@samp{\b}ï¼Œ@samp{\f} ä¸ @samp{\r} è½¬ä¹‰åºåˆ—ï¼ˆæŸ¥çœ‹ @pxref{Escape Sequences}ï¼‰ã€‚

@item
@code{getline} å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Getline}ï¼‰è¾“å…¥é‡å®šå‘ã€‚

@item
å¤š @code{BEGIN} ä¸ @code{END} è§„åˆ™ï¼ˆæŸ¥çœ‹ @pxref{BEGIN/END}ï¼‰ã€‚

@item
å¤šç»´æ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{Multidimensional}ï¼‰ã€‚
@end itemize

@node SVR4
@appendixsec åœ¨ SVR3.1 ä¸ SVR4 ä¹‹é—´çš„å˜åŒ–

@cindex @command{awk}, versions of, changes between SVR3.1 and SVR4
System V Release 4ï¼ˆ1989ï¼‰ç‰ˆæœ¬çš„ Unix @command{awk} æ·»åŠ äº†è¿™äº›ç‰¹æ€§ï¼ˆæœ‰ä¸€äº›æ¥è‡ªäº @command{gawk}ï¼‰ï¼š

@itemize @value{BULLET}
@item
@code{ENVIRON} æ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ã€‚
@c gawk and MKS awk

@item
å¤šä¸ª @option{-f} é€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚
@c MKS awk

@item
@option{-v} é€‰é¡¹ç”¨äºåœ¨ç¨‹åºæ‰§è¡Œå‰è¿›è¡Œå˜é‡èµ‹å€¼ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚
@c GNU, Bell Laboratories & MKS together

@item
@option{--} ç”¨äºè¡¨ç¤ºå‘½ä»¤è¡Œé€‰é¡¹çš„ç»“æŸã€‚

@item
@samp{\a}ï¼Œ@samp{\v} ä¸ @samp{\x} è½¬ä¹‰å­—ç¬¦ï¼ˆæŸ¥çœ‹ @pxref{Escape Sequences}ï¼‰
@c GNU, for ANSI C compat

@item
å†…ç½®å‡½æ•° @code{srand()} æœ‰ç¡®å®šçš„è¿”å›å€¼ï¼ˆæŸ¥çœ‹ @pxref{Numeric Functions}ï¼‰ã€‚

@item
@code{toupper()} ä¸ @code{tolower()} å†…ç½®å­—ä¸²å‡½æ•°ï¼Œç”¨äºå¤§å°å®šè½¬æ¢ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
å¯¹äº @code{printf} ä¸­çš„ @samp{%c} æ ¼å¼æ§åˆ¶å­—ä¸²æœ‰æ›´æ¸…æ™°çš„è§„èŒƒï¼ˆæŸ¥çœ‹ @pxref{Control Letters}ï¼‰ã€‚

@item
åœ¨ @code{printf} ä¸ @code{sprintf()} çš„å‚æ•°åˆ—è¡¨ä¸­ï¼Œå¯ä»¥åŠ¨æ€æ§åˆ¶åŸŸçš„å®½åº¦ä¸ç²¾åº¦ï¼ˆ@code{"%*.*d"}ï¼‰ï¼ˆæŸ¥çœ‹ @pxref{Control Letters}ï¼‰ã€‚

@item
æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡çš„ä½¿ç”¨ï¼Œå¦‚ @code{/foo/} ä½œä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™ä¸ªä¸åŒ¹é…æ“ä½œç¬¦ï¼Œå¦‚ @samp{$0 ~ /foo/} æ˜¯ä¸€æ ·çš„çš„ï¼ˆæŸ¥çœ‹ @pxref{Using Constant Regexps}ï¼‰ã€‚

@item
åœ¨å‘½ä»¤è¡Œå˜é‡èµ‹å€¼ä¸­å¤„ç†è½¬ä¹‰åºåˆ—ï¼ˆæŸ¥çœ‹ @pxref{Assignment Options}ï¼‰ã€‚
@end itemize

@node POSIX
@appendixsec åœ¨ SVR4 ä¸ POSIX ä¹‹é—´çš„å˜åŒ–
@cindex @command{awk}, versions of, changes between SVR4 and POSIX @command{awk}
@cindex POSIX @command{awk}, changes in @command{awk} versions

@command{awk} å‘½ä»¤è¯­è¨€ä¸å·¥å…·çš„ POSIX æ ‡å‡†ï¼ˆ1992ï¼‰å¼•å…¥äº†ä¸‹é¢å˜é‡ï¼š

@itemize @value{BULLET}
@item
ä½¿ç”¨ @option{-W} ç‰¹å®šäºå®ç°çš„é€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚

@item
ä½¿ç”¨ @code{CONVFMT} ç”¨äºæ§åˆ¶æ•°å€¼è½¬æ¢ä¸ºå­—ä¸²ï¼ˆæŸ¥çœ‹ @pxref{Conversion}ï¼‰ã€‚

@item
æ•°å€¼å­—ä¸²çš„æ¦‚å¿µå¹¶å¼•å…¥ä¸æ›´ä¸¥æ ¼çš„æ¯”è¾ƒè§„åˆ™ï¼ˆæŸ¥çœ‹ @pxref{Typing and Comparison}ï¼‰ã€‚

@item
ä½¿ç”¨é¢„å®šä¹‰çš„å˜é‡ä½œä¸ºå‡½æ•°å‚æ•°åè¢«ç¦ç”¨ï¼ˆæŸ¥çœ‹ @pxref{Definition Syntax}ï¼‰ã€‚

@item
å¾ˆå¤šä¹‹å‰æ²¡æœ‰æ–‡æ¡£çš„è¯­è¨€ç‰¹æ€§æœ‰äº†æ›´å®Œå¤‡çš„æ–‡æ¡£ã€‚
@end itemize

åœ¨ 2012 å¹´ï¼Œå¾ˆå¤šä¹‹å‰å¾ˆå¤šå¹´éƒ½ä»¥æ‰©å±•çš„æ–¹å¼å–å¾—çš„ç‰¹æ€§æœ€ç»ˆè¢«åŠ å…¥åˆ° POSIX æ ‡å‡†ä¸­ã€‚å®ƒä»¬æ˜¯ï¼š

@itemize @value{BULLET}
@item
@code{fflush()} å†…ç½®å‡½æ•°ç”¨æ¥åˆ·å‡ºè¾“å‡ºï¼ˆæŸ¥çœ‹ @pxref{I/O Functions}ï¼‰ã€‚

@item
@code{nextfile} è¯­å¥ï¼ˆæŸ¥çœ‹ @pxref{Nextfile Statement}ï¼‰

@item
é€šè¿‡ @samp{delete @var{array}} å°±å¯ä»¥åˆ é™¤æ•´ä¸ªæ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{Delete}ï¼‰ã€‚

@end itemize

æŸ¥çœ‹ @ref{Common Extensions}ï¼Œæ¥è·å–è¿˜æ²¡æœ‰è¢«æ¥å—ä¸º POSIX æ ‡å‡†çš„æ‰©å±•åˆ—è¡¨ã€‚

2008 å¹´çš„ POSIX æ ‡å‡†å¯ä»¥åœ¨çº¿ä¸Šæ‰¾åˆ°ï¼š@url{http://www.opengroup.org/onlinepubs/9699919799/}


@node BTL
@appendixsec Brian Kernighan çš„ @command{awk} çš„æ‰©å±•

@cindex @command{awk}, versions of, See Also Brian Kernighan's @command{awk}
@cindex extensions, Brian Kernighan's @command{awk}
@cindex Brian Kernighan's @command{awk}, extensions
@cindex Kernighan, Brian
Brian Kernighan ç‰ˆæœ¬çš„ @command{awk} å¯ä»¥é€šè¿‡å®ƒçš„ä¸»é¡µæ¥è·å–ï¼ˆæŸ¥çœ‹ @pxref{Other Versions}ï¼‰ã€‚

è¿™ä¸€@value{SECTION}æè¿°çš„æ˜¯æ¥è‡ªäºä»–çš„ @command{awk} ç‰ˆæœ¬çš„é€šç”¨æ‰©å±•ï¼š

@itemize @value{BULLET}
@item
@samp{**} ä¸ @samp{**=} æ“ä½œç¬¦ï¼ˆæŸ¥çœ‹ @pxref{Arithmetic Ops} ä¸ @ref{Assignment Ops}ï¼‰ã€‚

@item
@code{func} ç”¨äº @code{function} çš„ç¼©å†™ï¼ˆæŸ¥çœ‹ @pxref{Definition Syntax}ï¼‰ã€‚

@item
@code{fflush()} å†…ç½®å‡½æ•°ç”¨æ¥åˆ·å‡ºç¼“å­˜çš„è¾“å‡ºï¼ˆæŸ¥çœ‹ @pxref{I/O Functions}ï¼‰

@ignore
@item
The @code{SYMTAB} array, that allows access to @command{awk}'s internal symbol
table. This feature was never documented for his @command{awk}, largely because
it is somewhat shakily implemented. For instance, you cannot access arrays
or array elements through it
@end ignore
@end itemize

æŸ¥çœ‹ @ref{Common Extensions}ï¼Œæ¥è·å–åœ¨å®ƒçš„ @command{awk} ä¸­å¯ä»¥è·å–çš„æ‰©å±•ã€‚

@node POSIX/GNU
@appendixsec ä¸åœ¨ POSIX @command{awk} ä¸­çš„ @command{gawk} æ‰©å±• 

@cindex compatibility mode (@command{gawk}), extensions
@cindex extensions, in @command{gawk}, not in POSIX @command{awk}
@cindex POSIX, @command{gawk} extensions not included in
@command{awk} çš„ GNU å®ç°â€”â€”@command{gawk} æ·»åŠ äº†å¤§é‡çš„ç‰¹æ€§ã€‚å®ƒä»¬åœ¨ä½¿ç”¨ @option{--traditional} æˆ–è€… @option{--posix} é€‰é¡¹çš„æ—¶å€™å¯ä»¥è¢«ç¦ç”¨ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚

å¾ˆå¤šçš„ç‰¹æ€§å·²ç»æœ‰ä¸€äº›å¹´å¤´äº†ï¼Œè¿™ä¸€èŠ‚å¯¹è¿™äº›é™„åŠ çš„ç‰¹æ€§è¿›è¡Œæè¿°ï¼Œè¿™äº›ç‰¹æ€§ä½¿ç”¨åœ¨ç°åœ¨çš„ @command{gawk} ç‰ˆæœ¬ä¸­ï¼Œä½†æ˜¯è¶…å‡º POSIX æ ‡å‡†ã€‚

@itemize @value{BULLET}

@item
é¢å¤–çš„é¢„å®šä¹‰å˜é‡ï¼š

@itemize @value{MINUS}
@item
@code{ARGIND}ï¼Œ@code{BINMODE}ï¼Œ@code{ERRNO}ï¼Œ@code{FIELDWIDTHS}ï¼Œ@code{FPAT}ï¼Œ@code{IGNORECASE}ï¼Œ@code{LINT}ï¼Œ@code{PROCINFO}ï¼Œ@code{RT}ï¼Œå’Œ @code{TEXTDOMAIN} å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ã€‚
@end itemize

@item
I/O é‡å®šå‘ä¸­çš„ç‰¹æ®Šæ–‡ä»¶ï¼š

@itemize @value{MINUS}
@item
/@code{dev}/@code{stdin}ï¼Œ /@code{dev}/@code{stdout}ï¼Œ /@code{dev}/@code{stderr}ï¼Œ ä¸ /@code{dev}/@code{fd}/@code{N} ç‰¹æ®Šæ–‡ä»¶åï¼ˆæŸ¥çœ‹ 5.8 @command{gawk} ä¸­çš„ç‰¹æ®Šæ–‡ä»¶åï¼Œ åœ¨ç¬¬ 106 é¡µï¼‰ã€‚
@file{/dev/stdin}ï¼Œ@file{/dev/stdout}ï¼Œ@file{/dev/stderr}ï¼Œä¸ @file{/dev/fd/@var{N}} ç‰¹æ®Šæ–‡ä»¶åï¼ˆæŸ¥çœ‹ @pxref{Special Files}ï¼‰ã€‚ 

@item
@file{/inet}ï¼Œ@file{/inet4}ï¼Œå’Œ @file{/inet6} ç­‰ç‰¹æ®Šæ–‡ä»¶ç”¨äºä½¿ç”¨ @samp{|&} TCP/IP ç½‘ç»œé€šä¿¡ï¼Œæ¥æŒ‡å®šä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„åè®®ï¼ˆæŸ¥çœ‹ @pxref{TCP/IP Networking}ï¼‰ã€‚
@end itemize

@item
è¯­è¨€ä¸­çš„æ›´æ”¹ä¸/æˆ–è€…æ·»åŠ ï¼š

@itemize @value{MINUS}
@item
@samp{\x} è½¬ä¹‰åºåˆ—ï¼ˆæŸ¥çœ‹ @pxref{Escape Sequences}ï¼‰ã€‚

@item
å®Œå…¨åœ°æ”¯æŒ POSIX ä¸ GNU æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{Regexp}ï¼‰ã€‚

@item
@code{FS} ä¸ @code{split()} çš„ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ä¸ºç©ºä¸²ï¼ˆæŸ¥çœ‹ @pxref{Single Character Fields}ï¼‰ã€‚

@item
å¯ä»¥è®¾ç½® @code{RS} ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{Records}ï¼‰ã€‚

@item
å¯ä»¥åœ¨ @command{awk} ç¨‹åºæºä»£ç ä¸­ä½¿ç”¨å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶ï¼ˆæŸ¥çœ‹ @pxref{Nondecimal-numbers}ï¼‰ã€‚

@item
ä½¿ç”¨ @samp{|&} æ“ä½œç¬¦æ¥ä¸å¹¶ç¨‹è¿›è¡ŒåŒå‘ I/O é€šä¿¡ï¼ˆæŸ¥çœ‹ @pxref{Two-way I/O}ï¼‰ã€‚

@item
é—´æ¥å‡½æ•°è°ƒç”¨ï¼ˆæŸ¥çœ‹ @pxref{Indirect Calls}ï¼‰ã€‚

@item
åœ¨å‘½ä»¤è¡Œä¸Šè¾“å…¥ç›®å½•ä¼šå¯¼è‡´è­¦å‘Šäº§ç”Ÿï¼Œä½†ä¼šè·³è¿‡ï¼ˆæŸ¥çœ‹ @pxref{command-line directories}ï¼‰ã€‚
@end itemize

@item
æ–°çš„å…³é”®å­—ï¼š

@itemize @value{MINUS}
@item
@code{BEGINFILE} ä¸ @code{ENDFILE} ç‰¹æ®Šæ¨¡å¼ï¼ˆæŸ¥çœ‹ @pxref{BEGINFILE/ENDFILE}ï¼‰ã€‚

@item
@code{switch} è¯­å¥ï¼ˆæŸ¥çœ‹ @pxref{Switch Statement}ï¼‰ã€‚
@end itemize

@item
å¯¹æ ‡å‡† @command{awk} å‡½æ•°çš„æ”¹å˜ï¼š

@itemize @value{MINUS}
@item
@code{close()} å‡½æ•°çš„ç¬¬äºŒä¸ªå¯é€‰å‚æ•°å¯ä»¥å…³é—­åˆ°å¹¶ç¨‹çš„åŒå‘ç®¡é“çš„ä¸€ç«¯ï¼ˆæŸ¥çœ‹ @pxref{Two-way I/O}ï¼‰ã€‚

@item
ä½¿ç”¨ @option{--posix} æ—¶ï¼Œ@code{gsub()} ä¸ @code{sub()} ä¸ POSIX å…¼å®¹ã€‚

@item
@code{length()} å‡½æ•°æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°å¹¶è¿”å›æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
@code{match()} å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå¯é€‰å‚æ•°ç”¨äºæ•è·åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ–‡æœ¬åŒ¹é…å­è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
åœ¨ @code{printf} æ ¼å¼ä¸­çš„ä½ç½®æŒ‡å®šç¬¦ç”¨æ¥ç®€åŒ–ç¿»è¯‘ï¼ˆæŸ¥çœ‹ @pxref{Printf Ordering}ï¼‰ã€‚

@item
@code{split()} å‡½æ•°çš„é¢å¤–å¯é€‰çš„ç¬¬å››ä¸ªå‚æ•°ï¼Œæ˜¯ç”¨æ¥å­˜æ”¾åŸŸåˆ†éš”æ–‡æœ¬çš„æ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚
@end itemize

@item
@command{gawk} ä¸­çš„é¢å¤–å‡½æ•°ï¼š

@itemize @value{MINUS}
@item
@code{gensub()}ï¼Œ@code{patsplit()} ä¸ @code{strtonum()} ä½¿å¾—æ–‡æœ¬æ“ä½œæ›´åŠ å¼ºå¤§ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
@code{asort()} ä¸ @code{asorti()} å‡½æ•°ç”¨æ¥å¯¹æ•°ç»„æ’åºï¼ˆæŸ¥çœ‹ @pxref{Array Sorting}ï¼‰ã€‚

@item
@code{mktime()}ï¼Œ@code{systime()} ä¸ @code{strftime()} ç”¨æ¥å¤„ç†æ—¶é—´æˆ³ï¼ˆæŸ¥çœ‹ @pxref{Time Functions}ï¼‰ã€‚

@item
@code{and()}ï¼Œ@code{compl()}ï¼Œ@code{lshift()}ï¼Œ@code{or()}ï¼Œ@code{rshift()}ï¼Œä¸ @code{xor()} å‡½æ•°ç”¨æ¥å¤„ç†ä½æ“ä½œï¼ˆæŸ¥çœ‹ @pxref{Bitwise Functions}ï¼‰ã€‚
@c In 4.1, and(), or() and xor() grew the ability to take > 2 arguments

@item
@code{isarray} å‡½æ•°ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºæ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{Type Functions}ï¼‰ã€‚

@item
@code{bindtextdomain()}ï¼Œ@code{dcgettext()}ï¼Œä¸ @code{dcngettext()} å‡½æ•°ç”¨äºå›½é™…åŒ–ï¼ˆæŸ¥çœ‹ @pxref{Programmer i18n}ï¼‰ã€‚
@end itemize

@item
å‘½ä»¤è¡Œä¸­çš„æ”¹å˜ä¸/æˆ–è€…æ·»åŠ 

@itemize @value{MINUS}
@item
@env{AWKPATH} ç¯å¢ƒå˜é‡ç”¨æ¥æŒ‡å®š @option{-f} å‘½ä»¤é€‰é¡¹çš„æœç´¢è·¯å¾„ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚

@item
@code{AWKLIBPATH} ç¯å¢ƒå˜é‡ç”¨æ¥æŒ‡å®š @option{-l} å‘½ä»¤è¡Œé€‰é¡¹çš„æœç´¢è·¯å¾„ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚

@item
@option{-b},
@option{-c},
@option{-C},
@option{-d},
@option{-D},
@option{-e},
@option{-E},
@option{-g},
@option{-h},
@option{-i},
@option{-l},
@option{-L},
@option{-M},
@option{-n},
@option{-N},
@option{-o},
@option{-O},
@option{-p},
@option{-P},
@option{-r},
@option{-S},
@option{-t},
ä¸
@option{-V}
çŸ­é€‰é¡¹ã€‚åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ GNU é£æ ¼çš„é•¿é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹ä»¥ @option{--} å¼€å§‹ï¼Œ
@option{--assign},
@option{--bignum},
@option{--characters-as-bytes},
@option{--copyright},
@option{--debug},
@option{--dump-variables},
@option{--exec},
@option{--field-separator},
@option{--file},
@option{--gen-pot},
@option{--help},
@option{--include},
@option{--lint},
@option{--lint-old},
@option{--load},
@option{--non-decimal-data},
@option{--optimize},
@option{--posix},
@option{--pretty-print},
@option{--profile},
@option{--re-interval},
@option{--sandbox},
@option{--source},
@option{--traditional},
@option{--use-lc-numeric},
ä¸
@option{--version}
æ˜¯ç›¸åº”çš„é•¿é€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚
@end itemize

@c       new ports

@item
æ”¯æŒä¸‹é¢çš„ä¸‹é¢è¿‡æ—¶ç³»ç»Ÿçš„è¢«ä» @command{gawk} 4.0 ç‰ˆæœ¬çš„ä»£ç ä¸æ–‡æ¡£ä¸­ç§»é™¤ã€‚

@c nested table
@itemize @value{MINUS}
@item
Amiga

@item
Atari

@item
BeOS

@item
Cray

@item
MIPS RiscOS

@item
MS-DOS with the Microsoft Compiler

@item
MS-Windows with the Microsoft Compiler

@item
NeXT

@item
SunOS 3.x, Sun 386 (Road Runner)

@item
Tandem (non-POSIX)

@item
Prestandard VAX C compiler for VAX/VMS

@item
GCC for VAX and Alpha has not been tested for a while.

@end itemize

@item
æ”¯æŒä¸‹é¢è¿‡æ—¶ç³»ç»Ÿä» @command{gawk} 4.1 ç‰ˆæœ¬ä¸­è¢«ç§»é™¤äº†ã€‚

@c nested table
@itemize @value{MINUS}
@item
Ultrix
@end itemize

@end itemize

@c XXX ADD MORE STUFF HERE


@c This does not need to be in the formal book.
@ifclear FOR_PRINT
@node Feature History
@appendixsec @command{gawk} ç‰¹æ€§å†å²

@ignore
See the thread:
https://groups.google.com/forum/#!topic/comp.lang.awk/SAUiRuff30c
This motivated me to add this section.
@end ignore

@ignore
I've tried to follow this general order, esp.@: for the 3.0 and 3.1 sections:
       variables
       special files
       language changes (e.g., hex constants)
       differences in standard awk functions
       new gawk functions
       new keywords
       new command-line options
       behavioral changes
       new ports
Within each category, be alphabetical.
@end ignore

è¿™ä¸€@value{SECTION}æè¿°å­˜åœ¨ @command{gawk} ä½†æ˜¯ä¸åœ¨ POSIX @command{awk} ä¸­çš„ç‰¹æ€§ï¼Œå®‰å®ƒä»¬åŠ å…¥åˆ° @command{gawk} ä¸­çš„é¡ºåºè¿›è¡Œæ’åºã€‚

@command{gawk} 2.10 ç‰ˆæœ¬å¼•å…¥äº†ä¸‹é¢çš„ç‰¹æ€§ï¼š

@itemize @value{BULLET}
@item
@code{AWKPATH} ç¯å¢ƒå˜é‡ç”¨äºæŒ‡é’ˆ @option{-f} å‘½ä»¤è¡Œé€‰é¡¹æŒ‡å®šæœç´¢è·¯å¾„ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚

@item
@code{IGNORECASE} å˜é‡åŠå…¶æ•ˆæœï¼ˆæŸ¥çœ‹ @pxref{Case-sensitivity}ï¼‰ã€‚

@item
@file{/dev/stdin}ï¼Œ@file{/dev/stdout}ï¼Œ@file{/dev/stderr} ä¸
@file{/dev/fd/@var{N}} ç‰¹æ®Šæ–‡ä»¶åï¼ˆæŸ¥çœ‹ @pxref{Special Files}ï¼‰ã€‚
@end itemize

@command{gawk} 2.13 ç‰ˆæœ¬å¼•å…¥äº†ä¸‹é¢çš„ç‰¹æ€§ï¼š

@itemize @value{BULLET}
@item
@code{FIELDWIDTHS} å˜é‡ä¸å…¶æ•ˆæœï¼ˆæŸ¥çœ‹ @pxref{Constant Size}ï¼‰ã€‚

@item
@code{systime()} ä¸ @code{strftime()} å†…ç½®å‡½æ•°ç”¨æ¥è·å–åŠæ‰“å°æ—¶é—´æˆ³ï¼ˆæŸ¥çœ‹ @pxref{Time Functions}ï¼‰ã€‚

@item
é¢å¤–çš„å‘½ä»¤é€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ï¼š

@itemize @value{MINUS}
@item
@option{-W lint} é€‰é¡¹ç”¨äºæä¾›æºä»£ç ä¸è¿è¡Œæ—¶çš„é”™è¯¯ä¸å¯ç§»æ¤æ€§æ£€æµ‹ã€‚

@item
@option{-W compat} å…¼å®¹é€‰é¡¹ç”¨æ¥å…³é—­ GNU æ‰©å±•ã€‚

@item
@option{-W posix} é€‰é¡¹ç”¨æ¥å®ç°å®Œå…¨çš„ POSIX å…¼å®¹ã€‚
@end itemize
@end itemize

2.14 ç‰ˆæœ¬çš„ @command{gawk} å¼•å…¥äº†ä¸‹é¢çš„ç‰¹æ€§ï¼š

@itemize @value{BULLET}
@item
@code{nextfile} è¯­å¥ç”¨æ¥è·³åˆ°ä¸‹ä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼ˆæŸ¥çœ‹ @pxref{Nextfile Statement}ï¼‰ã€‚
@end itemize

2.15 ç‰ˆæœ¬ @command{gawk} å¼•å…¥äº†ä¸‹é¢çš„ç‰¹æ€§ï¼š

@itemize @value{BULLET}
@item
æ–°çš„å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ï¼š

@itemize @value{MINUS}
@item
@code{ARGIND} ç”¨æ¥è·Ÿè¸ª @code{ARGV} ä¸­çš„ @code{FILENAME} çš„ç§»åŠ¨ã€‚

@item
@code{ERRNO} åœ¨ @code{getline} è¿”å› @minus{}1 æˆ–è€… @code{close()} å¤±è´¥æ—¶åŒ…å«äº†ç³»ç»Ÿçš„é”™è¯¯ä¿¡æ¯ã€‚
@end itemize

@item
@file{/dev/pid}ï¼Œ@file{/dev/ppid}ï¼Œ@file{/dev/pgrpid}ï¼Œä¸
@file{/dev/user} ç‰¹æ®Šæ–‡ä»¶åï¼Œè¿™äº›å·²ç»è¢«ç§»é™¤ã€‚

@item
å¯ä»¥ä½¿ç”¨ä¸€æ¬¡ @samp{delete @var{array}} æ¥åˆ é™¤æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆæŸ¥çœ‹ @pxref{Delete}ï¼‰ã€‚

@item
å‘½ä»¤è¡Œé€‰é¡¹å˜åŒ– ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ï¼š

@itemize @value{MINUS}
@item
å¯ä»¥ä½¿ç”¨ GNU é£æ ¼çš„ä»¥ @option{--} å¼€å§‹çš„é•¿é€‰é¡¹ã€‚

@item
é€šè¿‡ @option{--source} é€‰é¡¹æ¥æ··åˆå‘½ä»¤è¡Œä¸åº“æ–‡ä»¶æºä»£ç ã€‚
@end itemize
@end itemize

3.0 ç‰ˆæœ¬çš„ @command{gawk} å¼•å…¥äº†ä¸‹é¢çš„ç‰¹æ€§ï¼š

@itemize @value{BULLET}
@item
æ–°çš„æˆ–è€…å˜åŒ–äº†çš„å˜é‡ï¼š

@itemize @value{MINUS}
@item
@code{IGNORECASE} å·²ç»å˜åŒ–ï¼Œç°åœ¨å¯ä»¥ç”¨äºå­—ä¸²æ¯”è¾ƒä»¥åŠæ­£åˆ™è¡¨è¾¾å¼æ“ä½œï¼ˆæŸ¥çœ‹ @pxref{Case-sensitivity}ï¼‰ã€‚

@item
@code{RT} å…¶ä¸­åŒ…å«äº†è¾“å…¥ä¸­åŒ¹é… @code{RS} çš„æ–‡æœ¬ï¼ˆæŸ¥çœ‹ @pxref{Records}ï¼‰ã€‚
@end itemize

@item
å®Œå…¨æ”¯æŒ POSIX ä¸ GNU æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{Regexp}ï¼‰ã€‚

@item
@code{gensub()} å‡½æ•°å¯ä»¥å®ç°æ›´å¼ºå¤§çš„æ–‡æœ¬æ“ä½œï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
@code{strftime()} å‡½æ•°éœ€è¦ä¸€ä¸ªé»˜è®¤çš„æ—¶é—´æ ¼å¼ï¼Œå¯ä»¥ä¸ç”¨å‚æ•°å°±å¯ä»¥è°ƒç”¨ï¼ˆæŸ¥çœ‹ @pxref{Time Functions}ï¼‰ã€‚

@item
@code{FS} ä¸ @code{split()} å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥æ˜¯ç©ºä¸²ï¼ˆæŸ¥çœ‹ @pxref{Single Character Fields}ï¼‰ã€‚

@item
@code{RS} å¯ä»¥æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{Records}ï¼‰ã€‚

@item
@code{next file} è¯­å¥å˜æˆ @code{nextfile}ï¼ˆæŸ¥çœ‹ @pxref{Nextfile Statement}ï¼‰ã€‚

@item
æ¥è‡ªäº BWK @command{awk} çš„ @code{fflush()} å‡½æ•°ï¼ˆå½“æ—¶åœ¨ Bell Laboratoriesï¼ŒæŸ¥çœ‹ @pxref{I/O Functions}ï¼‰ã€‚

@item
æ–°çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼š

@itemize @value{MINUS}
@item
@option{--lint-old} é€‰é¡¹æ¥è­¦å‘Šåœ¨åˆå§‹çš„ Version 7 Unix ç‰ˆæœ¬ä¸­çš„ @command{awk} ä¸­ä¸æ”¯æŒçš„ç»“æ„ï¼ˆæŸ¥çœ‹ @pxref{V7/SVR3.1}ï¼‰ã€‚

@item
æ¥è‡ªäº BWK @command{awk} çš„ @option{-m} é€‰é¡¹ã€‚ï¼ˆBrian é‚£ä¸ªæ—¶å€™è¿˜æ˜¯åœ¨ Bell Laboratoriesï¼‰ä¹‹åä»ä»–çš„ @command{awk} ä¸ @command{gawk} ä¸­éƒ½ç§»é™¤äº†ã€‚

@item
@option{--re-interval} é€‰é¡¹ç”¨æ¥æä¾›åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æä¾›åŒºé—´è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{Regexp Operators}ï¼‰ã€‚

@item
@option{--traditional} é€‰é¡¹æ·»åŠ æˆä¸º @option{--compat} æ›´å¥½çš„åå­—ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚
@end itemize

@item
ä½¿ç”¨ GNU Autoconf æ¥æ§åˆ¶é…ç½®è¿‡ç¨‹ï¼ˆæŸ¥çœ‹ @pxref{Quick Installation}ï¼‰ã€‚

@item
æ”¯æŒ Amigaã€‚è¿™å·²ç»è¢«ç§»é™¤äº†ã€‚

@end itemize

3.1 ç‰ˆæœ¬çš„ @command{gawk} å¼•å…¥äº†ä¸‹é¢çš„ç‰¹æ€§ï¼š

@itemize @value{BULLET}
@item
æ–°çš„å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{Built-in Variables}ï¼‰ï¼š

@itemize @value{MINUS}
@item
@code{BINMODE} ï¼Œæ¥è‡ªäºé POSIX ç³»ç»Ÿï¼Œå¯ä»¥ç”¨äºäºŒè¿›åˆ¶ I/O è¾“å…¥è¾“å‡ºæ–‡ä»¶ï¼ˆæŸ¥çœ‹ @pxref{PC Using}ï¼‰ã€‚

@item
@code{LINT} ç”¨æ¥åŠ¨æ€åœ°æ§åˆ¶ lint å‘Šè­¦ã€‚

@item
@code{PROCINFO} æ˜¯æä¾›äº†è¿›ç¨‹ç›¸å…³ä¿¡æ¯çš„æ•°ç»„ã€‚

@item
@code{TEXTDOMAIN} ç”¨æ¥è®¾ç½®ç¨‹åºçš„å›½é™…åŒ–æ–‡ä»¶åŸŸï¼ˆæŸ¥çœ‹ @pxref{Internationalization}ï¼‰ã€‚
@end itemize

@item
å¯ä»¥åœ¨ @command{awk} ç¨‹åºæºä»£ç ä¸­ä½¿ç”¨å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶ï¼ˆæŸ¥çœ‹ @pxref{Nondecimal-numbers}ï¼‰ã€‚

@item
ä½¿ç”¨ @samp{|&} æ¥ä¸å¹¶ç¨‹è¿›è¡ŒåŒè·¯ I/Oï¼ˆæŸ¥çœ‹ @pxref{Two-way I/O}ï¼‰ã€‚

@item
ä½¿ç”¨ @file{/inet} ä»¥åŠ @samp{|&} ç‰¹æ®Šæ–‡ä»¶æ¥è¿›è¡Œ TCP/IP ç½‘ç»œé€šä¿¡ï¼ˆæŸ¥çœ‹ @pxref{TCP/IP Networking}ï¼‰ã€‚

@item
@code{close()} ç¬¬äºŒä¸ªå¯é€‰å‚æ•°å¯ä»¥ç”¨äºå…³é—­åˆ°å¹¶ç¨‹çš„åŒå‘ç®¡é“çš„ä¸€ç«¯ï¼ˆæŸ¥çœ‹ @pxref{Two-way I/O}ï¼‰ã€‚

@item
@code{match()} å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå¯é€‰å‚æ•°ç”¨äºæ•è·æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ–‡æœ¬åŒ¹é…å­è¡¨è¾¾å¼ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
@code{printf} æ ¼å¼ä¸­çš„ä½ç½®æŒ‡å®šç¬¦ç”¨äºä½¿å›½é™…åŒ–æ›´ä¸ºç®€å•ï¼ˆæŸ¥çœ‹ @pxref{Printf Ordering}ï¼‰ã€‚

@item
å¤šä¸ªæ–°çš„å†…ç½®å‡½æ•°ï¼š

@itemize @value{MINUS}
@item
@code{asort()} ä¸ @code{asorti()} å‡½æ•°ç”¨äºæ’åºæ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{Array Sorting}ï¼‰ã€‚

@item
@code{bindtextdomain()}ï¼Œ@code{dcgettext()} ä¸ @code{dcngettext()} å‡½æ•°ç”¨äºå›½é™…åŒ–ï¼ˆæŸ¥çœ‹ @pxref{Programmer i18n}ï¼‰ã€‚

@item
@code{extension()} å‡½æ•°ä»¥åŠåŠ¨æ€æ·»åŠ æ–°çš„å†…ç½®å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Dynamic Extensions}ï¼‰ã€‚

@item
@code{mktime()} å‡½æ•°ç”¨äºåˆ›å»ºæ—¶é—´æˆ³ï¼ˆæŸ¥çœ‹ @pxref{Time Functions}ï¼‰ã€‚

@item
@code{and()}ï¼Œ@code{or()}ï¼Œ@code{xor()}ï¼Œ@code{compl()}ï¼Œ@code{lshift()}ï¼Œ@code{rshift()} ä¸ @code{strtonum()} å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Bitwise Functions}ï¼‰ã€‚
@end itemize

@item
@cindex @code{next file} statement
æ”¯æŒ @samp{next file} ä¸ºä¸¤ä¸ªå•è¯çš„è¯­å¥å·²ç»å®Œå…¨ç§»é™¤ï¼ˆæŸ¥çœ‹ @pxref{Nextfile Statement}ï¼‰ã€‚

@item
é¢å¤–çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ï¼š

@itemize @value{MINUS}
@item
@option{--dump-variables} é€‰é¡¹ç”¨äºæ‰“å°æ‰€æœ‰çš„å…¨å±€å˜é‡çš„åˆ—è¡¨ã€‚

@item
@option{--exec} é€‰é¡¹ç”¨äº CGI è„šæœ¬ã€‚

@item
@option{--gen-po} å‘½ä»¤é€‰é¡¹ä»¥åŠå‰ç½®ä¸‹åˆ’çº¿çš„ä½¿ç”¨æ¥æ ‡å¿—è¦è¢«ç¿»è¯‘çš„å­—ä¸²ï¼ˆæŸ¥çœ‹ @pxref{String Extraction}ï¼‰ã€‚

@item
@option{--non-decimal-data} é€‰é¡¹å¯ä»¥è¾“å…¥éåè¿›åˆ¶æ•°ï¼ˆæŸ¥çœ‹ @pxref{Nondecimal Data}ï¼‰ã€‚

@item
@option{--profile} é€‰é¡¹ä»¥åŠ @code{pgawk}ï¼ˆ@command{gawk} çš„ profiling ç‰ˆæœ¬ï¼‰ç”¨äºäº§ç”Ÿ @command{awk} ç¨‹åºçš„æ‰§è¡Œç»Ÿè®¡ï¼ˆæŸ¥çœ‹ @pxref{Profiling}ï¼‰ã€‚

@item
@option{--use-lc-numeric} é€‰é¡¹å¼ºåˆ¶ @command{gawk} ä½¿ç”¨æœ¬åœ°è¯­è¨€çš„åè¿›åˆ¶æ•°å°æ•°ç‚¹æ¥åˆ†æè¾“å…¥æ•°æ®ï¼ˆæŸ¥çœ‹ @pxref{Conversion}ï¼‰ã€‚
@end itemize

@item
ä½¿ç”¨ GNU Automake æ¥è¾…åŠ©é…ç½®è¿‡ç¨‹çš„æ ‡å‡†åŒ–ï¼ˆæŸ¥çœ‹ @pxref{Quick Installation}ï¼‰ã€‚

@item
ä½¿ç”¨ GNU çš„ @command{gettext} æ¥ä½œä¸º @command{gawk} è‡ªå·±çš„æ¶ˆæ¯è¾“å‡ºï¼ˆæŸ¥çœ‹ @pxref{Gawk I18N}ï¼‰ã€‚

@item
BeOS æ”¯æŒã€‚åé¢è¢«ç§»é™¤äº†ã€‚

@item
Tandem æ”¯æŒã€‚åé¢è¢«ç§»é™¤äº†ã€‚

@item
Atari ç§»æ¤ç‰ˆæœ¬ä¸è¢«å®˜æ–¹æ”¯æŒåé¢æ•´ä¸ªåœ°ç§»é™¤äº†ã€‚

@item
æºä»£ç æ”¹æˆä½¿ç”¨ ISO C æ ‡å‡†é£æ ¼çš„å‡½æ•°å®šä¹‰ã€‚

@item
POSIX å…¼å®¹ @code{sub()} ä¸ @code{gsub()}ï¼ˆæŸ¥çœ‹ @pxref{Gory Details}ï¼‰ã€‚

@item
@code{length()} å‡½æ•°è¢«æ‰©å±•ä¸ºæ¥å—æ•°ç»„å‚æ•°ï¼Œå¹¶è¿”å›æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
@code{strftime()} å‡½æ•°éœ€è¦ç¬¬ä¸‰ä¸ªå‚æ•°æ¥å¯ç”¨æ‰“å° UTC æ—¶é—´ï¼ˆæŸ¥çœ‹ @pxref{Time Functions}ï¼‰ã€‚
@end itemize

@command{gawk} 4.0 ç‰ˆæœ¬å¼•å…¥äº†ä¸‹é¢çš„ç‰¹æ€§ï¼š

@itemize @value{BULLET}

@item
æ·»åŠ çš„å˜é‡ï¼š

@itemize @value{MINUS}
@item
@code{FPAT} å¯ä»¥è®©ä½ æŒ‡å®šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…åŸŸï¼Œè€Œä¸æ˜¯åŒ¹é…åŸŸåˆ†éš”ç¬¦ï¼ˆæŸ¥çœ‹ @pxref{Splitting By Content}ï¼‰ã€‚

@item
å¦‚æœå­˜åœ¨ @code{PROCINFO["sorted_in"]}ï¼Œåˆ™ @samp{for(iggy in foo)} å¾ªç¯ä¼šåœ¨å¾ªç¯å¼€å§‹ä¹‹å‰å¯¹ç´¢å¼•æ’åºã€‚è¿™ä¸ªå…ƒç´ çš„å€¼æä¾›åœ¨å¾ªç¯éå†å¼€å§‹ä¹‹å‰æ§åˆ¶å¦‚ä½•æ¥å¯¹ç´¢å¼•æ¥è¿›è¡Œæ’åºï¼ˆæŸ¥çœ‹ @pxref{Controlling Scanning}ï¼‰ã€‚

@item
@code{PROCINFO["strftime"]} ç”¨äºä¿å­˜ @code{strftime()} çš„é»˜è®¤æ ¼å¼ï¼ˆæŸ¥çœ‹ @pxref{Time Functions}ï¼‰ã€‚
@end itemize

@item
ç§»é™¤ç‰¹æ®Šæ–‡ä»¶ @file{/dev/pid}ï¼Œ@file{/dev/ppid}ï¼Œ@file{/dev/pgrpid} ä¸ @file{/dev/user}ã€‚

@item
é€šè¿‡ @file{/inet6} ç‰¹æ®Šæ–‡ä»¶æ¥æ”¯æŒ IPv6ã€‚@file{/inet4} å¼ºåˆ¶ä½¿ç”¨ IPv4ï¼Œè€Œ @file{/inet} åˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„åè®®ï¼Œä¸€èˆ¬æ˜¯ IPv4ï¼ˆæŸ¥çœ‹ @pxref{TCP/IP Networking}ï¼‰ã€‚

@item
åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ @samp{\s} ä¸ @samp{\S} è½¬æ¢åºåˆ—ï¼ˆæŸ¥çœ‹ @pxref{GNU Regexp Operators}ï¼‰ã€‚

@item
åŒºé—´è¡¨è¾¾å¼æˆä¸ºé»˜è®¤æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€éƒ¨ä»½ï¼ˆæŸ¥çœ‹ @pxref{Regexp Operators}ï¼‰ã€‚

@item
å³ä½¿ä½¿ç”¨ @option{--traditional} æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ POSIX å­—ç¬¦ç±»å‹ï¼ˆæŸ¥çœ‹ @pxref{Regexp Operators}ï¼‰ã€‚

@item
@code{break} ä¸ @code{continue} åœ¨å¾ªç¯å¤–ä¸å†æœ‰æ•ˆï¼Œå³ä½¿ä½¿ç”¨ @option{--traditional} é€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Break Statement}ï¼Œä»¥åŠ @ref{Continue Statement}ï¼‰ã€‚

@item
@code{fflush()}ï¼Œ@code{nextfile}ï¼Œä¸ @samp{delete @var{array}} åœ¨ä½¿ç”¨ @option{--posix} æˆ–è€… @option{--traditional} é€‰é¡¹ä¸‹ä¹Ÿæ˜¯å…è®¸çš„ï¼Œå› æ­¤å®ƒä»¬å·²ç»æ˜¯ POSIX æ ‡å‡†çš„ä¸€éƒ¨åˆ†ã€‚

@item
@code{asort()} ä¸ @code{asorti()} å‡½æ•°æœ‰å¯é€‰çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šå¦‚ä½•æ¥æ’åºï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
@code{fflush()} çš„è¡Œä¸ºå·²ç»æ”¹æˆä¸ BWK @command{awk} ä»¥åŠ POSIX åŒ¹é…ï¼Œç°åœ¨ @samp{fflush()} ä¸ @samp{fflush("")} ä¼šåˆ·å‡ºæ‰€æœ‰çš„é‡å®šå‘è¾“å‡ºï¼ˆæŸ¥çœ‹ @pxref{I/O Functions}ï¼‰ã€‚

@item
@code{isarray()} å‡½æ•°å¯ä»¥ç”¨äºè¯†åˆ«æŸä¸ªé¡¹æ˜¯å¦ä¸ºæ•°ç»„ï¼Œè¿™æ ·å¯ä»¥æ¥ç”¨äºè¿›è¡Œæ•°ç»„ä¹‹æ•°ç»„çš„éå†ï¼ˆæŸ¥çœ‹ @pxref{Type Functions}ï¼‰ã€‚

@item
@code{patsplit()} å‡½æ•°å¯ä»¥æœ‰ä¸ @code{FPAT} ä¸€æ ·çš„åˆ†å‰²èƒ½åŠ›ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
@code{split()} å‡½æ•°çš„ç¬¬å››ä¸ªå¯é€‰å‚æ•°æ˜¯ç”¨äºå­˜æ”¾åˆ†å‰²ç¬¦çš„æ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚

@item
æ•°ç»„ä¹‹æ•°ç»„ï¼ˆæŸ¥çœ‹ @pxref{Arrays of Arrays}ï¼‰ã€‚

@item
@code{BEGINFILE} ä¸ @code{ENDFILE} ç‰¹å®šè§„åˆ™ï¼ˆæŸ¥çœ‹ @pxref{BEGINFILE/ENDFILE}ï¼‰ã€‚

@item
é—´æ¥å‡½æ•°è°ƒç”¨ï¼ˆæŸ¥çœ‹ @pxref{Indirect Calls}ï¼‰ã€‚

@item
@code{switch} / @code{case} é»˜è®¤æƒ…å†µä¸‹æ˜¯å¯ç”¨çš„ï¼ˆæŸ¥çœ‹ @pxref{Switch Statement}ï¼‰ã€‚

@item
æ”¹å˜çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ï¼š

@itemize @value{MINUS}
@item
@option{-b} ä¸ @option{--characters-as-bytes} é€‰é¡¹ç”¨æ¥é˜²æ­¢ @command{gawk} å°†è¾“å…¥å½“æˆå¤šå­—èŠ‚å­—ä¸²æ¥å¤„ç†ã€‚

@item
å¤šä½™çš„ @option{--compat}ï¼Œ@option{--copyleft} ä¸ @option{--usage} é•¿é€‰é¡¹å·²ç»è¢«ç§»é™¤ã€‚

@item
@option{--gen-po} é€‰é¡¹æœ€åè¢«æ”¹åä¸º @option{--gen-pot}ã€‚

@item
@option{--sandbox} é€‰é¡¹å¯ä»¥ç¦ç”¨ç‰¹å®šçš„ç‰¹æ€§ã€‚

@item
æ‰€æœ‰çš„é•¿é€‰é¡¹éƒ½éœ€è¦æœ‰ç›¸åº”çš„çŸ­é€‰é¡¹ï¼Œä»¥ç”¨äº @samp{#!} è„šæœ¬ã€‚
@end itemize

@item
åœ¨å‘½ä»¤è¡Œä¸Šè¾“å…¥äº†ç›®å½•åç°åœ¨ä¼šäº§ç”Ÿå‘Šè­¦ï¼Œè€Œä¸æ˜¯è‡´å‘½é”™è¯¯ã€‚é™¤éä½¿ç”¨äº† @option{--posix} æˆ–è€… @option{--traditional} é€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Command-line directories}ï¼‰ã€‚

@item
é‡å†™äº† @command{gawk} åŒºé—´è¡¨è¾¾å¼ï¼Œå¼•å…¥äº† @code{dgawk} çš„è°ƒè¯•å™¨ï¼Œå¹¶å¢å¼ºäº†ä¸€äº›æ€§èƒ½ï¼ˆæŸ¥çœ‹ @pxref{Debugger}ï¼‰ã€‚

@item
æ ¹æ® GNU ç¼–ç æ ‡å‡†ï¼ŒåŠ¨æ€æ‰©å±•å¿…é¡»è¦å®šä¹‰ä¸€ä¸ªå…¨å±€ç¬¦å·æ¥æŒ‡ç¤ºå®ƒä»¬æ˜¯ä½¿ç”¨ GPL å…¼å®¹çš„åè®®ï¼ˆæŸ¥çœ‹ @pxref{Plugin License}ï¼‰ã€‚

@item
åœ¨ POSIX æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ @code{strcoll()} / @code{wcscoll()} æ¥è¿›è¡Œå­—ä¸²æ¯”è¾ƒï¼ˆæŸ¥çœ‹ @pxref{POSIX String Comparison}ï¼‰ã€‚

@item
ç”¨äºè¿›è¡ŒåŸç”Ÿ Socket é€šä¿¡çš„é€‰é¡¹è¢«ç§»é™¤äº†ï¼Œå› ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«å®ç°ï¼ˆæŸ¥çœ‹ @pxref{TCP/IP Networking}ï¼‰ã€‚

@item
@samp{[d-h]} å½¢å¼çš„èŒƒå›´ä¼šè¢«å½“æˆåœ¨ C è¯­è¨€è®¾ç½®ä¸­ä¸€æ ·å¯¹å¾…ï¼Œä¸ç®¡ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆæ ·çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå³ä½¿ä½¿ç”¨äº† @option{--posix}ï¼ˆæŸ¥çœ‹ @pxref{Ranges and Locales}ï¼‰ã€‚

@item
å¯¹ä¸‹é¢ç³»ç»Ÿçš„æ”¯æŒè¢«ç§»é™¤äº†ï¼š

@itemize @value{MINUS}
@item
Atari

@item
Amiga

@item
BeOS

@item
Cray

@item
MIPS RiscOS

@item
MS-DOS with Microsoft Compiler

@item
MS-Windows with Microsoft Compiler

@item
NeXT

@item
SunOS 3.x, Sun 386 (Road Runner)

@item
Tandem (non-POSIX)

@item
Prestandard VAX C compiler for VAX/VMS
@end itemize
@end itemize

4.1 ç‰ˆæœ¬çš„ @command{gawk} å¼•å…¥äº†ä¸‹é¢çš„ç‰¹æ€§ï¼š

@itemize @value{BULLET}

@item
æ–°åŠ äº†ä¸‰ä¸ªå˜é‡ï¼š@code{SYMTAB}ï¼Œ@code{FUNCTAB}ï¼Œä»¥åŠ @code{PROCINFO["identifiers"]}ï¼ˆæŸ¥çœ‹ @pxref{Auto-set}ï¼‰ã€‚

@item
@command{gawk}ï¼Œ@code{pgawk} ä¸ @code{dgawk} è¢«æ•´åˆä¸ºä¸€ï¼Œå¹¶å‘½åä¸º @command{gawk}ã€‚å› ä¸ºä»…æ˜¯å‘½ä»¤è¡Œé€‰é¡¹æœ‰å˜åŒ–ã€‚

@item
æ”¹å˜çš„å‘½ä»¤è¡Œï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ï¼š

@itemize @value{MINUS}
@item
@option{-D} é€‰é¡¹ç”¨æ¥è°ƒç”¨è°ƒè¯•å™¨ã€‚

@item
@option{-i} ä¸ @option{--include} é€‰é¡¹ç”¨äºè½½å…¥ @command{awk} åº“æ–‡ä»¶ã€‚

@item
@option{-l} ä¸ @option{--load} é€‰é¡¹ç”¨äºè½½å…¥ç¼–è¯‘å¥½çš„åŠ¨æ€æ‰©å±•ã€‚

@item
@option{-M} ä¸ @option{--bignum} é€‰é¡¹ç”¨äºå¯ç”¨ @code{MPFR}ã€‚

@item
@option{-o} é€‰é¡¹ç”¨äºç®€æ´æ‰“å°ã€‚

@item
@option{-p} é€‰é¡¹ç”¨äºæ€§èƒ½ç»Ÿè®¡ã€‚

@item
ç§»é™¤äº† @option{-R} é€‰é¡¹ã€‚
@end itemize

@item
æ”¯æŒ @code{MPFR} æ¥æ”¯æŒé«˜ç²¾åº¦ç®—æœ¯è®¡ç®—ã€‚ï¼ˆæŸ¥çœ‹ @pxref{Arbitrary Precision Arithmetic}ï¼‰ã€‚

@item
@code{and()}ï¼Œ@code{or()} ä¸ @code{xor()} å‡½æ•°æ›´æ”¹æˆå¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œæœ€å°ä¸ºä¸¤ä¸ªï¼ˆæŸ¥çœ‹ @pxref{Bitwise Functions}ï¼‰ã€‚

@item
åŠ¨æ€æ‰©å±•æ¥å£å®Œå…¨å…¨è¿›è¡Œäº†é‡æ„ï¼ˆæŸ¥çœ‹ @pxref{Dynamic Extensions}ï¼‰ã€‚

@item
åœ¨ @code{BEGINFILE} ä¸ @code{ENDFILE} è§„åˆ™ä¸­ä¹Ÿå…è®¸é‡å®šå‘çš„ @code{getline}ï¼ˆæŸ¥çœ‹ @pxref{BEGINFILE/ENDFILE}ï¼‰ã€‚

@item
@code{where} å‘½ä»¤è¢«æ·»åŠ åˆ°äº†è°ƒè¯•å™¨ä¸­ï¼ˆæŸ¥çœ‹ @pxref{Execution Stack}ï¼‰ã€‚

@item
ç§»é™¤äº† Ultrixã€‚

@end itemize

@c XXX ADD MORE STUFF HERE
@end ifclear

@node Common Extensions
@appendixsec é€šç”¨æ‰©å±•æ±‡æ€»

@cindex extensions, Brian Kernighan's @command{awk}
@cindex extensions, @command{mawk}
ä¸‹é¢çš„è¡¨ä¸­å½’çº³äº†ç”± @command{gawk}ï¼ŒBrian Kernighan @command{awk} ä¸ @command{mawk} æ‰€æ”¯æŒçš„é€šç”¨æ‰©å±•ã€‚è¿™æ˜¯ä¸‰ä¸ªç”¨å¾—æœ€å¤šï¼Œå¹¶ä¸”å¯ä»¥è‡ªç”±è·å–çš„ @command{awk} ç‰ˆæœ¬ï¼ˆæŸ¥çœ‹ @pxref{Other Versions}ï¼‰ã€‚

@multitable {@file{/dev/stderr} ç‰¹æ®Šæ–‡ä»¶} {BWK @command{awk}} {@command{mawk}} {@command{gawk}} {ç›®å‰æ ‡å‡†}
@headitem Feature @tab BWK @command{awk} @tab @command{mawk} @tab @command{gawk} @tab ç›®å‰æ ‡å‡†
@item @samp{\x} è½¬ä¹‰åºåˆ— @tab X @tab X @tab X @tab
@item @code{FS} ä¸ºç©ºä¸² @tab X @tab X @tab X @tab
@item @file{/dev/stdin} ç‰¹æ®Šæ–‡ä»¶ @tab X @tab X @tab X @tab
@item @file{/dev/stdout} ç‰¹æ®Šæ–‡ä»¶ @tab X @tab X @tab X @tab
@item @file{/dev/stderr} ç‰¹æ®Šæ–‡ä»¶ @tab X @tab X @tab X @tab
@item @code{delete} ä¸éœ€è¦ä¸‹æ ‡çš„æ•°ç»„ @tab X @tab X @tab X @tab X
@item @code{fflush()} å‡½æ•° @tab X @tab X @tab X @tab X
@item @code{length()} çš„æ•°ç»„ç‰ˆæœ¬ @tab X @tab X @tab X @tab
@item @code{nextfile} è¯­å¥ @tab X @tab X @tab X @tab X
@item @code{**} å’Œ @code{**=} æ“ä½œç¬¦ @tab X @tab @tab X @tab
@item @code{func} å…³é”®å­— @tab X @tab @tab X @tab
@item @code{BINMODE} å˜é‡ @tab @tab X @tab X @tab
@item @code{RS} å¯ä¸ºæ­£åˆ™è¡¨è¾¾å¼ @tab @tab X @tab X @tab
@item æ—¶é—´ç›¸å…³å‡½æ•° @tab @tab X @tab X @tab
@end multitable

@node Ranges and Locales
@appendixsec æ­£åˆ™è¡¨è¾¾å¼èŒƒå›´ä¸æœ¬åœ°è¯­è¨€è®¾ç½®ï¼šåˆè‡­åˆé•¿é™ˆå¹´æ—§äº‹

è¿™ä¸€@value{SECTION}æè¿°çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸æœ¬åœ°è¯­è¨€è®¾ç½®ä¹‹é—´çš„æ··ä¹±çš„å†å²æ—¶æœŸï¼Œä»¥åŠå…¶å¦‚ä½•å½±å“ä¸åŒç‰ˆæœ¬çš„ @command{gawk}ã€‚

æœ€åˆçš„ Unix çš„æ­£åˆ™è¡¨è¾¾å¼å·¥å…·æ‰€å®šä¹‰çš„å­—ç¬¦èŒƒå›´ï¼ˆå¦‚ @samp{[a-z]}ï¼‰ç”¨äºåŒ¹é…ç¬¬ä¸€ä¸ªå­—ç¬¦åˆ°æœ€åä¸€ä¸ªå­—ç¬¦ä¹‹é—´çš„å­—ç¬¦ï¼ˆå«ï¼‰ã€‚å…¶é¡ºåºåŸºäºæ¯ä¸ªå­—ç¬¦åœ¨æœºå™¨çš„æœ¬åœ°å­—ç¬¦é›†çš„æ•°å€¼å€¼ã€‚æ‰€ä»¥ï¼Œåœ¨åŸºäº ASCII çš„ç³»ç»Ÿä¸Šï¼Œ@samp{[a-z]} åŒ¹é…æ‰€æœ‰çš„å°å­—å­—æ¯ï¼Œå› ä¸ºè¿™äº›ä» @samp{a} åˆ° @samp{z} ä¹‹é—´æ•°å€¼å€¼æ˜¯è¿ç»­çš„ã€‚ï¼ˆåœ¨ EBCDIC ç³»ç»Ÿä¸Šï¼Œ@samp{[a-z]} è¿™ä¸ªèŒƒå›´ä¹ŸåŒ…å«å…¶ä»–çš„éå­—æ¯å­—ç¬¦ã€‚ï¼‰

å‡ ä¹æ‰€æœ‰çš„ Unix åŸºç¡€è®²ä¹‰éƒ½è¯´æ­¤ç±»å‹çš„èŒƒå›´è¡¨è¾¾å¼éƒ½æ˜¯å¯å·¥ä½œçš„ï¼Œè¿˜ç‰¹åˆ«æ•™äººä»¬è¯´ï¼Œ@samp{[a-z]} æ˜¯ç”¨æ¥åŒ¹é…å°å†™å­—æ¯çš„â€œæ­£ç¡®â€æ–¹å¼ï¼Œè€Œ @samp{[A-Z]} åˆ™æ˜¯åŒ¹é…å¤§å†™å­—æ¯çš„â€œæ­£ç¡®â€æ–¹å¼ã€‚è€Œå®é™…ä¸Šï¼Œè¿™ä¹Ÿæ˜¯çœŸçš„ã€‚ @footnote{é‚£ä¹ˆç”Ÿæ´»å°±ç¾å¦™äº†ã€‚}

1992 å¹´ POSIX æ ‡å‡†å¼•å…¥äº†æœ¬åœ°è¯­è¨€è®¾ç½®è¿™æ ·çš„ç‚¹å­ï¼ˆæŸ¥çœ‹ @pxref{Locales}ï¼‰ã€‚å¾ˆå¤šçš„æœ¬åœ°è¯­è¨€é™¤äº†åŒ…å«è‹±è¯­è¡¨ä¸­çš„ 26 ä¸ªå­—æ¯å¤–ï¼Œè¿˜åŒ…å«å…¶ä»–çš„å­—æ¯ï¼ŒPOSIX æ ‡å‡†åˆ™æ·»åŠ äº†å­—ç¬¦ç±»ï¼ˆæŸ¥çœ‹ @pxref{Bracket Expressions}ï¼‰æ¥åŒ¹é…é™¤äº† ASCII å­—ç¬¦é›†ä¸­çš„ä¼ ç»Ÿå­—æ¯ä¹‹å¤–çš„å­—ç¬¦ã€‚

ä½†æ˜¯ï¼Œæ ‡å‡†å¯¹äºèŒƒå›´çš„è§£é‡Šä¹Ÿå‘ç”Ÿäº†@emph{å˜åŒ–}ã€‚åœ¨ @code{"C"} ä»¥åŠ @code{"POSIX"} è¯­è¨€é…ç½®ä¸­ï¼ŒèŒƒå›´è¡¨è¾¾å¼å¦‚ @samp{[a-dx-z]} ä¸ @samp{[abcdxyz]} æ˜¯ä¸€æ ·çš„ï¼Œå¦‚åœ¨ @code{ASCII} ä¸­çš„ä¸€æ ·ã€‚ä½†æ˜¯åœ¨å…¶ä»–çš„è¯­è¨€è®¾ç½®ä¸­ï¼Œé¡ºåºæ˜¯æŒ‰ç…§@dfn{ååŒé¡ºåº}æ¥è¿›è¡Œå®šä¹‰çš„ã€‚

è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿåœ¨å¾ˆå¤šçš„è¯­è¨€è®¾ç½®ä¸­ï¼Œ@samp{A} ä¸ @samp{a} ä¸¤è€…éƒ½å°äº @samp{B}ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›è¯­è¨€è®¾ç½®ä¼šå°†ç”¨å­—å…¸é¡ºåºæ¥å¯¹å­—ç¬¦è¿›è¡Œæ’åºï¼Œé‚£ä¹ˆ @samp{[a-dx-z]} ä¸å†ä¸ @samp{[abcdxyz]} ç­‰åŒäº†ã€‚ç›¸åï¼Œä»–æœ‰å¯èƒ½ä¸ @samp{[ABCXYabcdxyz]} ç­‰åŒã€‚

è¿˜éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼šå¾ˆå¤šçš„è€å¸ˆéƒ½æ•™æˆç”¨ @samp{[a-z]} æ¥åŒ¹é…å°å†™å­—æ¯ã€‚ä½†æ˜¯åœ¨é ASCII è¯­è¨€è®¾ç½®çš„ç³»ç»Ÿä¸Šï¼Œè¿™ä¹Ÿä¼šåŒ¹é…æ‰€æœ‰çš„å¤§å†™å­—æ¯ï¼Œä¸åŒ…æ‹¬ @samp{A} æˆ–è€… @samp{Z}ï¼è¿™å¯¼è‡´äº†æŒç»­çš„å›°æƒ‘ï¼Œå³ä½¿åˆ°äº† 21 ä¸–çºªçš„ä»Šå¤©ã€‚

ä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢çš„ä¾‹å­ä½¿ç”¨ @code{sub()} å‡½æ•°æ¥æ‰§è¡Œæ–‡ä»¶åŒ¹é…ï¼ˆæŸ¥çœ‹ @pxref{String Functions}ï¼‰ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ç§»é™¤åé¢çš„å¤§å†™å­—æ¯ï¼š

@example
$ @kbd{echo something1234abc | gawk-3.1.8 '@{ sub("[A-Z]*$", ""); print @}'}
@print{} something1234a
@end example

@noindent
è¿™ä¸ªè¾“å‡ºå¹¶ä¸æ˜¯æ‰€æœŸæœ›çš„ï¼Œå› ä¸º @samp{bc} æ˜¯ @samp{something1234abc} çš„ç»“æŸä¸²ï¼Œä¸åº”è¯¥åŒ¹é… @samp{[A-Z]*}ã€‚æ˜¯æœ¬åœ°è¯­è¨€è®¾ç½®å¯¼è‡´äº†è¿™æ ·çš„ç»“æœï¼ˆå› æ­¤ä½ å¯èƒ½åœ¨ä½ çš„ç³»ç»Ÿä¸Šçœ‹ä¸è¿™æ ·çš„è¾“å‡ºï¼‰ã€‚

@cindex Unicode
å…¶ä»–èŒƒå›´ä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚å¦‚ @samp{["-/]} åœ¨ ASCII ä¸­ç»å¯¹æœ‰æ•ˆï¼Œä½†æ˜¯åœ¨å¾ˆå¤šçš„ Unicode è¯­è¨€è®¾ç½®ä¸­ï¼Œå¦‚ @code{en_US.UTF-8} ä¸­å°±ä¸æ˜¯è¿™æ ·ã€‚

@command{gawk} æ—©æœŸçš„ç‰ˆæœ¬ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ä»£ç å¯¹äºè¯­è¨€è®¾ç½®æ˜¯ä¸æ•æ„Ÿçš„ï¼Œæ‰€ä»¥å¯¹äºèŒƒå›´çš„è§£é‡Šæ˜¯ä¹‹å‰çš„åšæ³•ã€‚

å½“ @command{gawk} åˆ‡æ¢åˆ°ä½¿ç”¨è¯­è¨€è®¾ç½®æ•æ„Ÿçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å™¨ï¼Œé—®é¢˜å°±å‡ºç°äº†ã€‚ç‰¹åˆ«æ˜¯åœ¨ GNU/Linux ä¸å•†ä¸š Unix çš„å‚å•†å¼€å§‹å®ç°é @code{ASCII} è¯­è¨€ä¹‹åï¼Œ@emph{å¹¶ä½¿è¿™äº›è¯­è¨€æˆä¸ºé»˜è®¤é€‰é¡¹}ã€‚
ä¹Ÿè®¸ FAQï¼ˆfrequently asked questionï¼‰çš„é—®é¢˜å·²ç»å˜æˆè¿™æ ·ï¼Œâ€œä¸ºä»€ä¹ˆ @samp{[A-Z]} ä¼šåŒ¹é…å°å†™å­—æ¯ï¼Ÿï¼ï¼Ÿâ€

@cindex Berry, Karl
è¿™æ ·çš„é—®é¢˜å·²ç»å­˜åœ¨äº†è¿‘ 10 å¹´ï¼Œå¦‚æœä¸æ˜¯æ›´å¤šçš„è¯ã€‚@command{gawk} å·²ç»å¾ˆå¥½åœ°æ”¯æŒæ ‡å‡†ï¼Œå¹¶å¤„ç†å¥½äº†ç”¨æˆ·æœ¬åœ°è¯­è¨€çš„é—®é¢˜ï¼Œ@command{gawk} çš„ç»´æŠ¤è€…å¯¹äºè§£é‡Šè¿™äº›é—®é¢˜éƒ½å·²ç»éå¸¸åŒå€¦äº†ã€‚åœ¨å¼€å‘ 4.0 ç‰ˆæœ¬çš„è¿‡ç¨‹ä¸­ï¼Œä»–ä»¬ä¿®æ”¹äº† @command{gawk}ï¼Œä½¿å…¶æ€»æ˜¯æŒ‰åŸæ¥çš„æ–¹å¼å¯¹å¾…èŒƒå›´ï¼Œå³åœ¨æ ‡å‡†å‰çš„æ–¹å¼ã€‚é™¤éåç”¨äº† @option{--posix} é€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰ã€‚ 
@footnote{ä¹Ÿå› æ­¤äº§ç”Ÿäº†â€œåˆç†èŒƒå›´è§£é‡ŠæŠ¥æ€¨â€ï¼ˆæˆ–è€… RRIï¼‰ã€‚å¾ˆå¤šçš„ GNU å·¥å…·å·²ç»å®ç°äº†è¿™æ ·çš„å˜åŒ–ï¼Œæˆ–è€…ä¸ä¹…å°†å®ç°ã€‚éå¸¸æ„Ÿè°¢ Karl Berry å‘æ˜äº†â€œåˆç†èŒƒå›´è§£é‡Šâ€è¿™ä¸ªè¯ã€‚}

å¹¸è¿çš„æ˜¯ï¼Œæœ€ @command{gawk} 4.0 å‘å¸ƒä¸ä¹…ï¼Œç»´æŠ¤è€…äº†è§£åˆ° 2008 çš„æ ‡å‡†å·²ç»æ›´æ”¹äº†èŒƒå›´çš„å®šä¹‰ï¼Œè¿™æ · @code{"C"} ä¸ @code{"POSIX"} ä¹‹å¤–çš„è¯­è¨€è®¾ç½®ï¼ŒèŒƒå›´è¡¨è¾¾å¼çš„å«ä¹‰æ˜¯@emph{æœªå®šä¹‰}çš„ã€‚ 
@footnote{æŸ¥çœ‹ @uref{http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html#tag_09_03_05, æ ‡å‡†}å’Œ@uref{http://pubs.opengroup.org/onlinepubs/9699919799/xrat/V4_xbd_chap09.html#tag_21_09_03_05, å®ƒçš„è§£é‡Š}}

ç”±äºä½¿ç”¨äº†è¿™ä¹ˆä¸€ä¸ªå¯çˆ±çš„æŠ€æœ¯æœ¯è¯­ï¼Œæ ‡å‡†ç»™äº†å®ç°è€…ç›¸åº”è®¸å¯æ¥è‡ªå·±é€‰æ‹©å®ç°èŒƒå›´çš„æ–¹å¼ã€‚@command{gawk} ç»´æŠ¤è€…é€‰æ‹©äº†ä½¿ç”¨ POSIX æ ‡å‡†ä¹‹å‰çš„å«ä¹‰ï¼Œè€Œä¸è®ºæ˜¯é»˜è®¤çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¿˜æ˜¯ä½¿ç”¨äº† @option{--traditional} æˆ–è€… @option{--posix} é€‰é¡¹ã€‚åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œ@command{gawk} éƒ½ä¸ POSIX æ ‡å‡†æ˜¯ç¬¦åˆçš„ã€‚

@node Contributors
@appendixsec @command{gawk} çš„ä¸»è¦è´¡çŒ®è€…
@cindex @command{gawk}, list of contributors to
@quotation
@i{
å¦‚æœæ„Ÿè°¢æ˜¯åº”è¯¥çš„å°±å¾—æ„Ÿè°¢ã€‚
}
@author Anonymous
@end quotation

è¿™ä¸€@value{SECTION}åˆ—å‡ºäº† @command{gawk} ä»¥åŠ/æˆ–è€…æœ¬@value{DOCUMENT}çš„ä¸»è¦è´¡çŒ®è€…ï¼Œä»¥å¤§æ¦‚å¹´ä»£å‰åé¡ºåºåˆ—å‡ºï¼š

@itemize @value{BULLET}
@item
@cindex Aho, Alfred
@cindex Weinberger, Peter
@cindex Kernighan, Brian
Dr.@: Alfred V.@: Ahoï¼ŒDr.@: Peter J.@: Weinbergerï¼Œand Dr.@: Brian W.@: Kernighanï¼Œä»¥åŠè´å°”å®éªŒå®¤ä¸­æ‰€æœ‰çš„è®¾è®¡ä¸å®ç°äº† Unix @command{awk} çš„äººï¼Œä»è¿™äº›äººä¸­å½¢æˆäº† @command{awk} çš„ä¸»è¦ç‰¹æ€§é›†åˆã€‚
@item
@cindex Rubin, Paul
Paul Rubin
åœ¨ 1986 å¹´å®Œæˆäº†æœ€åˆçš„è®¾è®¡ä¸å®ç°ï¼Œå¹¶å†™äº†æœ¬@value{DOCUMENT}çš„ç¬¬ä¸€ç¨¿ï¼ˆå¤§æ¦‚ 40 é¡µï¼‰ã€‚

@item
@cindex Fenlason, Jay
Jay Fenlason
å®Œæˆäº†æœ€åˆçš„å®ç°ã€‚

@item
@cindex Close, Diane
Diane Close
ä¿®è®¢äº†æœ¬@value{DOCUMENT}çš„ç¬¬ä¸€ç¨¿ï¼Œè¾¾åˆ°äº† 90 å¤šé¡µã€‚

@item
@cindex Stallman, Richard
Richard Stallman
å¸®åŠ©å®Œæˆäº†æœ€å¼€å§‹çš„å®ç°ï¼Œä»¥åŠæœ¬@value{DOCUMENT}åˆç¨¿ã€‚ä»–åŒæ—¶ä¹Ÿæ˜¯ FSF ä¸ GNU é¡¹ç›®çš„åˆ›å»ºè€…ã€‚

@item
@cindex Woods, John
John Woods
è´¡çŒ®äº† @command{gawk} åˆå§‹ç‰ˆæœ¬çš„éƒ¨åˆ†ä»£ç ï¼ˆå¤§éƒ¨ä»½æ˜¯ä¿®å¤ï¼‰ã€‚

@item
@cindex Trueman, David
1988 å¹´ï¼ŒDavid Trueman
æˆä¸º @command{gawk} çš„ä¸»è¦ç»´æŠ¤è€…ï¼Œå¹¶ä½¿å…¶ä¸â€œæ–°â€çš„ @command{awk} å…¼å®¹ï¼Œå¹¶æå¤§åœ°æé«˜äº†æ€§èƒ½ã€‚

@item
@cindex Kwok, Conrad
@cindex Garfinkle, Scott
@cindex Williams, Kent
Conrad Kwokï¼ŒScott Garfinkleï¼Œä¸ Kent Williams
ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„ MSC å®Œæˆäº†æœ€åˆçš„å‘ MS-DOS çš„ç§»æ¤ã€‚

@item
@cindex Rankin, Pat
Pat Rankin
æä¾›äº† VMS çš„ç§»æ¤åŠå…¶æ–‡æ¡£ã€‚

@item
@cindex Peterson, Hal
Hal Peterson
æä¾›äº†ç§»æ¤ @command{gawk} åˆ° Cray Systems çš„å¸®åŠ©ã€‚ï¼ˆå½“å‰å·²ä¸å†æ”¯æŒã€‚ï¼‰

@item
@cindex Rommel, Kai Uwe
Kai Uwe Rommel
æä¾›äº† OS/2 çš„æœ€åˆçš„ç§»æ¤ç‰ˆæœ¬åŠå…¶æ–‡æ¡£ã€‚

@item
@cindex Jaegermann, Michal
Michal Jaegermann
æä¾›äº† Atari ç³»ç»Ÿçš„ç§»æ¤åŠå…¶æ–‡æ¡£ã€‚ï¼ˆè¿™ä¸ªç§»æ¤ä¸å†æ”¯æŒã€‚ï¼‰ä»–æŒç»­æä¾›äº†å¯ç§»æ¤æ€§æ£€æŸ¥ï¼Œå¹¶å®Œæˆäº†ç›¸å½“å¤šçš„å·¥ä½œï¼Œä»¥ç¡®å®š @command{gawk} å¯ä»¥å·¥ä½œåœ¨é 32 ä½ç³»ç»Ÿä¸Šã€‚

@item
@cindex Fish, Fred
Fred Fish
æä¾›äº† Amiga ç³»ç»Ÿçš„ç§»æ¤åŠå…¶æ–‡æ¡£ã€‚ï¼ˆéšç€ Fred çš„å»ä¸–ï¼Œè¿™ä¹Ÿä¸å†æ”¯æŒäº†ã€‚ï¼‰

@item
@cindex Deifik, Scott
Scott Deifik
å½“å‰ä½¿ç”¨ @code{DJGPP} ç»´æŠ¤ MS-DOS çš„ç§»æ¤ç‰ˆã€‚

@item
@cindex Zaretskii, Eli
Eli Zaretskii
å½“å‰ä½¿ç”¨ MinGW ç»´æŠ¤ MS-Windows çš„ç§»æ¤ç‰ˆã€‚

@item
@cindex Grigera, Juan
Juan Grigera
æä¾›äº† Window32 ç³»ç»Ÿçš„ç§»æ¤ã€‚ï¼ˆè¿™å·²ç»ä¸å†æ”¯æŒã€‚ï¼‰

@item
@cindex Hankerson, Darrel
å¾ˆå¤šå¹´ä»¥åï¼Œ
Dr.@: Darrel Hankerson
ä½œä¸ºä¸åŒ PC å¹³å°çš„ç§»æ¤ç‰ˆæœ¬çš„åè°ƒè€…ï¼Œå¹¶æ„å»ºäº†ä¸åŒ PC æ“ä½œç³»ç»Ÿä¸Šçš„äºŒè¿›åˆ¶å‘å¸ƒç‰ˆæœ¬ã€‚å®ƒä¹Ÿç»´æŠ¤ä¸åŒ PC å¹³å°ä¸Šçš„æ–‡æ¡£ï¼Œä»¥ä¿æŒæ–‡æ¡£çš„åŠæ—¶æ›´æ–°ã€‚

@item
@cindex Zoulas, Christos
Christos Zoulas
æä¾› @code{extension()} å†…ç½®å‡½æ•°ç”¨äºåŠ¨æ€æ·»åŠ æ–°åŠŸèƒ½ï¼ˆè¿™åœ¨ @command{gawk} 4.1 ç‰ˆæœ¬å·²ç»å–æ¶ˆã€‚ï¼‰

@item
@cindex Kahrs, J@"urgen
J@"urgen Kahrs
è´¡çŒ®äº†æœ€åˆçš„ TCP/IP ç½‘ç»œä»£ç ç‰ˆæœ¬åŠå…¶æ–‡æ¡£ï¼Œå¹¶å¯¼è‡´äº† @samp{|&} æ“ä½œç¬¦çš„åŠ å…¥ã€‚

@item
@cindex Davies, Stephen
Stephen Davies
æä¾›äº† Tandem ç³»ç»Ÿçš„æœ€åˆç§»æ¤ç‰ˆæœ¬åŠå…¶æ–‡æ¡£ã€‚ï¼ˆä½†æ˜¯ï¼Œè¿™ä¹Ÿä¸å†æ”¯æŒã€‚ï¼‰å®ƒä¹Ÿæäº¤äº†æœ€åˆçš„æ•´åˆå­—èŠ‚ç å®ç°åˆ° @command{gawk} ä»£ç åº“ä¸­çš„å·¥ä½œã€‚

@item
@cindex Woehlke, Matthew
Matthew Woehlke
æä¾›äº† Tandem POSIX å…¼å®¹ç³»ç»Ÿçš„å¢å¼ºã€‚

@item
@cindex Brown, Martin
Martin Brown
æä¾›äº† @code{BeOS} çš„ç§»æ¤ç‰ˆæœ¬åŠå…¶æ–‡æ¡£ã€‚ï¼ˆå·²ä¸å†æ”¯æŒã€‚ï¼‰

@item
@cindex Peters, Arno
Arno Peters
åšäº†åˆå§‹å·¥ä½œæ¥å°† @command{gawk} åˆ‡æ¢åˆ° GNU Automake ä»¥åŠ GNU @command{gettext}ã€‚

@item
@cindex Broder, Alan J.@:
Alan J.@: Broder
æä¾›äº†æœ€åˆçš„ @code{asort()} å‡½æ•°çš„ç‰ˆæœ¬ï¼Œä»¥åŠ @code{match()} å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå¯é€‰å‚æ•°çš„ä»£ç ã€‚

@item
@cindex Buening, Andreas
Andreas Buening
æ›´æ–°äº† @command{gawk} çš„ OS/2 çš„ç§»æ¤ç‰ˆæœ¬ã€‚

@item
@cindex Hasegawa, Isamu
Isamu Hasegawa,
IBM æ—¥æœ¬çš„ Isamu Hasegawaï¼ˆé•¿è°·å·å‹‡ï¼‰è´¡çŒ®äº†å¯¹å¤šå­—èŠ‚å­—ç¬¦çš„æ”¯æŒã€‚

@item
@cindex Benzinger, Michael
Michael Benzinger è´¡çŒ®äº† @code{switch} è¯­å¥çš„æœ€åˆä»£ç ã€‚

@item
@cindex McPhee, Patrick
Patrick T.J.@: McPhee è´¡çŒ®äº†åœ¨ Windows32 ç¯å¢ƒä¸‹åŠ¨æ€è£…è½½çš„ä»£ç ã€‚ï¼ˆä¸å†æ”¯æŒã€‚ï¼‰

@item
@cindex Wallin, Anders
å¸®åŠ©ç»´æŠ¤äº† VMS ç§»æ¤ç‰ˆæœ¬å¤šå¹´ã€‚

@item
@cindex Gordon, Assaf
Assaf Gordon 
è´¡çŒ®äº†å®ç° @option{--sandbox} é€‰é¡¹çš„å®ç°ä»£ç ã€‚

@item
@cindex Haque, John
John Haque ä½œäº†å¦‚ä¸‹è´¡çŒ®:

@itemize @value{MINUS}
@item
ä¿®æ”¹ @command{gawk}ï¼Œå°†å…¶åˆ‡æ¢ä¸ºä¸€ä¸ªå­—èŠ‚ç è§£é‡Šå™¨ï¼ŒåŠå…¶è°ƒè¯•å™¨

@item
æ·»åŠ äº†çœŸæ­£çš„æ•°ç»„ä¹‹æ•°ç»„

@item
å…¶ä»–ä¿®æ”¹ä»¥æ”¯æŒä»»æ„ç²¾åº¦çš„ç®—æœ¯è¿ç®—

@item
@ref{Arbitrary Precision Arithmetic} çš„åˆå§‹æ–‡æœ¬

@item
å°†ä¸‰ä¸ªç‰ˆæœ¬çš„ @command{gawk} åˆå¹¶ä¸ºä¸€çš„å·¥ä½œï¼Œä»¥é…åˆ 4.1 çš„å‘å¸ƒ

@item
å¢å¼ºäº†ç”±æ•´æ•°è¿›ç´¢å¼•çš„æ•°ç»„çš„å†…éƒ¨å®ç°ã€‚

@item
å¢å¼ºäº†ç”± John ä¸ Pat Rankin é©±åŠ¨çš„æ•°ç»„æ’åºç‰¹æ€§
@end itemize

@cindex Papadopoulos, Panos
@item
Panos Papadopoulos 
è´¡çŒ®äº† @ref{Include Files} çš„åˆå§‹æ–‡æœ¬ã€‚

@item
@cindex Yawitz, Efraim
Efraim Yawitz è´¡çŒ®äº† @ref{Debugger} çš„åˆå§‹æ–‡æœ¬ã€‚

@item
@cindex Schorr, Andrew
åœ¨ @command{gawk} 4.1 ç‰ˆæœ¬çš„æ‰©å±• @code{API} çš„å¼€å‘ä¸»è¦ç”± Arnold Robbins ä¸ Andrew Schorr é©±åŠ¨ï¼Œå¹¶åœ¨åé¢çš„å¼€å‘å›¢é˜Ÿä¸­åšäº†å·¨å¤§çš„è´¡çŒ®ã€‚

@cindex Malmberg, John E.
@item
John Malmberg å¯¹äº OpenVMS ç§»æ¤ç‰ˆåŠå…¶æ–‡æ¡£åšäº†å·¨å¤§çš„è´¡çŒ®ä¸å¢å¼ºã€‚

@item
@cindex Colombo, Antonio
Antonio Giovanni Colombo é‡å†™äº†ä¹‹å‰ç« èŠ‚ä¸­çš„å¾ˆå¤šä¾‹å­ï¼Œå› ä¸ºé‚£äº›ä¾‹å­å¾ˆå¤šå·²ç»ä¸¥é‡è¿‡æ—¶ï¼Œæˆ‘å¯¹å…¶æ„Ÿè°¢ä¸å°½ã€‚

@item
@cindex Robbins, Arnold
Arnold Robbins
ä» 1988 å¹´ä»¥æ¥ä¸€ç›´å·¥ä½œåœ¨ @command{gawk} ä¸Šï¼Œç¬¬ä¸€ä¸ªååŠ© David Truemanï¼Œä¹Ÿæ˜¯ 1994 å¹´ä»¥æ¥çš„æœ€ä¸»è¦çš„ç»´æŠ¤è€…ã€‚
@end itemize

@node History summary
@appendixsec æ€»ç»“

@itemize @value{BULLET}
@item
@command{awk} è¯­è¨€å·²ç»å‘å±•äº†å¾ˆä¹…ã€‚ç¬¬ä¸€ä¸ªå‘å¸ƒç‰ˆæœ¬å¤§çº¦åœ¨ 1978 å¹´çš„ V7 Unix ç³»ç»Ÿä¸Šã€‚åœ¨ System V Release 3.1 çš„ 1987 å¹´çš„æ—¶å€™ï¼Œä¸€äº›ä¸»è¦çš„æ–°å¢åŠŸèƒ½ï¼ŒåŒ…å«ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å·²ç»åŠ å…¥åˆ°è¯­è¨€ä¸­ã€‚å…¶ä»–çš„æ”¹å˜åœ¨ 1989 å¹´çš„ System V Release 4 åŠ å…¥ã€‚ä»æ­¤ä¹‹åï¼Œå…¶ä»–çš„æ¬¡è¦çš„å˜é‡éƒ½åœ¨ POSIX æ ‡å‡†çš„æ¡†æ¶ä¸‹è¿›è¡Œã€‚

@item
Brian Kernighan çš„ @command{awk} æä¾›äº†ä¸€äº›æ‰©å±•ï¼Œå¹¶è¢«å®ç°ä¸ºå…¶ä»– @command{awk} ç‰ˆæœ¬çš„é€šç”¨æ‰©å±•ã€‚

@item
@command{gawk} æä¾›äº†å¤§é‡çš„ POSIX @command{awk} æ‰€æ²¡æœ‰çš„æ‰©å±•ã€‚å®ƒä»¬å¯ä»¥ä½¿ç”¨ @option{--traditional} æˆ–è€… @option{--posix} é€‰é¡¹æ¥ç¦ç”¨ã€‚

@item
@command{gawk} ä¸­çš„ POSIX æœ¬åœ°è¯­è¨€è®¾ç½®ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¹‹é—´çš„çº è‘›ä¸€ç›´è®©äººå›°æƒ‘äº†å¥½å¤šå¹´ã€‚ç°åœ¨ï¼Œ@command{gawk} å®ç°äº†â€œåˆç†èŒƒå›´è§£é‡Šâ€ï¼Œå¦‚æ­¤ï¼Œ@samp{[a-z]} è¿™æ ·çš„èŒƒå›´å½¢å¼@emph{åª}åŒ¹é…æ‰€åœ¨æœºå™¨çš„æœ¬åœ°å­—ç¬¦é›†ä¸­çš„ï¼Œæ•°å€¼åœ¨ @samp{a} åˆ° @samp{z} ä¹‹é—´çš„å­—ç¬¦ã€‚å­—ç¬¦é›†é€šå¸¸æ˜¯ ASCIIï¼Œä½†æ˜¯åœ¨ IBM S/390 ä¸Šå¯èƒ½æ˜¯ EBCDICã€‚

@item
å¾ˆå¤šäººå¤šæ¥æ¥å¯¹ @command{gawk} çš„å¼€å‘åšå‡ºäº†è´¡çŒ®ã€‚ æˆ‘ä»¬å¸Œæœ›æœ¬@value{CHAPTER}ä¸­æ‰€æä¾›çš„åˆ—è¡¨æ˜¯å®Œæ•´çš„ï¼Œå¹¶åœ¨å€¼å¾—æ„Ÿè°¢çš„åœ°æ–¹ç»™äºˆäº†ç›¸åº”çš„æ„Ÿè°¢ã€‚

@end itemize

@node Installation
@appendix å®‰è£… @command{gawk}

@c last two commas are part of see also
@cindex operating systems, See Also GNU/Linux@comma{} PC operating systems@comma{} Unix
@cindex @command{gawk}, installing
@cindex installing @command{gawk}
æœ¬é™„å½•æä¾›äº†ç”¨äºå®‰è£… @command{gawk} åˆ°ç”±å¼€å‘è€…æ‰€æ”¯æŒçš„ä¸åŒå¹³å°ä¸Šçš„æŒ‡å¯¼ã€‚ä¸»è¦çš„å¼€å‘è€…æ”¯æŒ GNU/Linuxï¼ˆä»¥åŠ Unixï¼‰å¹³å°ï¼Œå…¶ä»–åˆ™ç”±è´¡çŒ®å†³å®šã€‚æŸ¥çœ‹ @ref{Bugs}ï¼Œæ¥è·å–ç»´æŠ¤ç›¸åº”ç§»æ¤ç‰ˆæœ¬çš„ç»´æŠ¤è€…çš„é‚®ä»¶ã€‚

@menu
* Gawk Distribution::           What is in the @command{gawk} distribution.
* Unix Installation::           Installing @command{gawk} under various
                                versions of Unix.
* Non-Unix Installation::       Installation on Other Operating Systems.
* Bugs::                        Reporting Problems and Bugs.
* Other Versions::              Other freely available @command{awk}
                                implementations.
* Installation summary::        Summary of installation.
@end menu

@node Gawk Distribution
@appendixsec @command{gawk} å‘å¸ƒç‰ˆ
@cindex source code, @command{gawk}

è¿™ä¸€@value{SECTION} æè¿°å¦‚ä½•æ¥è·å– @command{gawk} å‘å¸ƒç‰ˆæœ¬ï¼Œå¦‚ä½•è§£é‡Šï¼Œå¹¶åˆ—å‡ºä¸åŒçš„æ–‡ä»¶ä»¥åŠå­ç›®å½•ã€‚

@menu
* Getting::                     How to get the distribution.
* Extracting::                  How to extract the distribution.
* Distribution contents::       What is in the distribution.
@end menu

@node Getting
@appendixsubsec å–å¾— @command{gawk} å‘å¸ƒç‰ˆ 
@cindex @command{gawk}, source code@comma{} obtaining
æœ‰ä¸¤ä¸ªæ–¹å¼æ¥è·å– GNU è½¯ä»¶ï¼š

@itemize @value{BULLET}
@item
ä»æŸäººé‚£é‡Œç›´æ¥å¤åˆ¶ã€‚

@cindex FSF (Free Software Foundation)
@cindex Free Software Foundation (FSF)
@item
ä» Internet ä¸»æœº @code{ftp.gnu.org} ä¸­çš„ç›®å½• @file{/gnu/gawk} ä¸­æ¥å–å¾— @command{gawk}ã€‚åŒ¿åçš„ @command{ftp} ä¸ @code{http} è®¿é—®éƒ½æ˜¯å—æ”¯æŒçš„ã€‚å¦‚æœä½ æœ‰ @command{wget} ç¨‹åºï¼Œä½ å¯ä»¥å¦‚ä¸‹æ¥ä½¿ç”¨å‘½ä»¤ï¼š

@example
wget http://ftp.gnu.org/gnu/gawk/gawk-@value{VERSION}.@value{PATCHLEVEL}.tar.gz
@end example
@end itemize

GNU è½¯ä»¶æ–‡æ¡£åœ¨å…¨ä¸–ç•Œéƒ½æœ‰é•œåƒã€‚åŒæ­¥æ›´æ–°çš„é•œåƒç«™ç‚¹å¯ä»¥ä» @uref{http://www.gnu.org/order/ftp.html, ä¸» FSF ç½‘ç«™}ä¸Šè·å– ã€‚å°è¯•å…¶ä¸­ä¸€ä¸ªé•œåƒç«™ç‚¹ï¼Œå¦‚æœä¸å¤ªå¿™ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç¦»ä½ è¿‘ä¸€ç‚¹çš„ç«™ç‚¹ã€‚

ä½ ä¹Ÿå¯ä»¥ä»å®˜æ–¹ Git ä»“åº“è·å– @command{gawk} çš„æºä»£ç ï¼›æ›´å¤šä¿¡æ¯è¯·çœ‹ @ref{Accessing The Source}ã€‚

@node Extracting
@appendixsubsec æå–å‘å¸ƒç‰ˆ
@command{gawk} çš„å‘å¸ƒç‰ˆæœ¬æœ‰å†…ä¸ª @code{tar} æ–‡ä»¶å¹¶ç”¨ä¸åŒçš„å‹ç¼©ç¨‹åºè¿›è¡Œå‹ç¼©ï¼š@command{gzip}ï¼Œ@command{bzip2} ä»¥åŠ @command{xz}ã€‚ä¸ºç®€å•èµ·è§ï¼Œåé¢çš„è¯´æ˜å‡è®¾ä½ ä½¿ç”¨ GNU Gzip ç¨‹åºè¿›è¡Œå‹ç¼©çš„ï¼ˆ@command{gzip}ï¼‰ã€‚

åªè¦æœ‰äº†å‘å¸ƒç‰‡ï¼ˆå¦‚ @file{gawk-@value{VERSION}.@value{PATCHLEVEL}.tar.gz}ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ @code{gzip} æ¥è§£å‹æ–‡ä»¶ç„¶åä½¿ç”¨ @code{tar} æ¥æå–ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç®¡çº¿æ¥ç”Ÿæˆ @command{gawk} çš„å‘å¸ƒæ–‡ä»¶ï¼š

@example
gzip -d -c gawk-@value{VERSION}.@value{PATCHLEVEL}.tar.gz | tar -xvpf -
@end example

åœ¨ä½¿ç”¨ GNU @command{tar} çš„ç³»ç»Ÿä¸Šï¼Œä½ å¯ä»¥è®© @command{tar} æ¥å¸®ä½ è¿›è¡Œè§£å‹ï¼š

@example
tar -xvpzf gawk-@value{VERSION}.@value{PATCHLEVEL}.tar.gz
@end example

@noindent
è§£å‹åçš„æ–‡ä»¶ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåå­—ä¸º @file{gawk-@value{VERSION}.@value{PATCHLEVEL}} çš„ç›®å½•ã€‚

å‘å¸ƒ@value{FN}æ˜¯ @file{gawk-@var{V}.@var{R}.@var{P}.tar.gz} å½¢å¼çš„åå­—ã€‚@var{V} ä»£è¡¨äº† @command{gawk} çš„ä¸»è¦ç‰ˆæœ¬ï¼Œ@var{R} è¡¨ç¤ºäº†å½“å‰ @var{V} ç‰ˆæœ¬çš„å‘å¸ƒç‰ˆæœ¬ï¼Œ@var{P} ä»£è¡¨äº†@dfn{è¡¥ä¸ç­‰çº§}ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸ªå‘å¸ƒä¸­ä¿®å¤äº†ä¸€äº›å°†è¦çš„ Bugã€‚å½“è¡¥ä¸ç­‰çº§æ˜¯ @value{PATCHLEVEL}ï¼Œä½†æ˜¯å½“è¿”å›å‘å¸ƒæ—¶ï¼Œä½ ä¼šå–å¾—æœ€é«˜ç‰ˆæœ¬å·ï¼Œå‘å¸ƒç‰ˆä»¥åŠè¡¥ä¸ç­‰çº§ã€‚
ï¼ˆæç¤ºï¼Œè¡¥ä¸ç­‰çº§å¤§äºç­‰äº 70ï¼Œè¡¨ç¤ºæ˜¯â€œbetaâ€æˆ–è€…æ˜¯éç”Ÿäº§ç”¨è½¯ä»¶ï¼Œé™¤éä½ ä¸ä»‹æ„å®éªŒï¼Œå¦åˆ™ä½ ä¸è¦ä½¿ç”¨è¿™æ ·çš„ç‰ˆæœ¬ã€‚ï¼‰å¦‚æœä½ ä¸åœ¨ Unix æˆ–è€… GNU/Linux ç³»ç»Ÿä¸Šï¼Œä½ éœ€è¦å¯¹è·å–äº†è§£å‹ @command{gawk} å‘å¸ƒç‰ˆå¦åšæ‰“ç®—ã€‚ä½ å¯ä»¥å’¨è¯¢ä¸€ä¸‹èº«è¾¹çš„ä¸“å®¶ã€‚

@node Distribution contents
@appendixsubsec @command{gawk} å‘å¸ƒç‰ˆçš„å†…å®¹
@cindex @command{gawk}, distribution

@command{gawk} å‘å¸ƒç‰ˆæœ‰å¾ˆå¤šçš„ C æºæ–‡ä»¶ï¼Œæ–‡æ¡£æ–‡ä»¶ï¼Œå­ç›®å½•ä»¥åŠä¸é…ç½®è¿‡ç¨‹ç›¸å…³çš„æ–‡ä»¶ï¼ˆæŸ¥çœ‹ @pxref{Unix Installation}ï¼‰ï¼Œè¿˜æœ‰å‡ ä¸ªå­ç›®å½•ä¸ä¸åŒçš„é Unix æ“ä½œç³»ç»Ÿç›¸å…³ï¼š

@table @asis
@item å„ç§ @samp{.c}ï¼Œ@samp{.y} ä¸ @samp{.h} æ–‡ä»¶
è¿™äº›æ–‡ä»¶åŒ…å«å®ç°çš„ @command{gawk} æºä»£ç ã€‚
@end table

@table @file
@item ABOUT-NLS
æ–‡ä»¶ä¸­åŒ…å«å…³äº GNU @command{gettext} ä¸ç¿»è¯‘çš„ç›¸å…³ä¿¡æ¯ã€‚

@item AUTHORS
ä¸€äº›å…³äº @command{gawk} çš„ä½œè€…ä¿¡æ¯ã€‚å®ƒçš„å­˜åœ¨åªæ˜¯ä¸ºäº†ç¬¦åˆè‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šçš„è§„èŒƒã€‚

@item README
@itemx README_d/README.*
æè¿°æ€§æ–‡ä»¶ï¼š@file{README} ç”¨äº Unix ä¸‹çš„ @command{gawk}ï¼Œä»¥åŠå…¶ä»–ä¸åŒçš„è½¯ç¡¬ä»¶ç»„åˆã€‚

@item INSTALL
æä¾›äº†é…ç½®ä¸å®‰è£…è¿‡ç¨‹çš„åŸºæœ¬è¿‡ç¨‹çš„æ–‡ä»¶ã€‚

@item ChangeLog
@code{bugs} ä¿®å¤æˆ–è€…å¢å¼ºçš„æºä»£ç è¯¦ç»†åˆ—è¡¨ã€‚

@item ChangeLog.0
æºä»£ç æ›´æ”¹çš„æ—§åˆ—è¡¨ã€‚

@item NEWS
æœ€åä¸€ä¸ªç‰ˆæœ¬ä»¥æ¥ @command{gawk} çš„æ›´æ”¹åˆ—è¡¨ã€‚

@item NEWS.0
@command{gawk} çš„æ—§çš„æ›´æ”¹åˆ—è¡¨ã€‚

@item COPYING
GNU é€šç”¨è®¸å¯è¯æ–‡æœ¬ã€‚

@item POSIX.STD
@command{awk} çš„ POSIX æ ‡å‡†ä¸­å®šä¹‰ä¸ºæœªå®šä¹‰çš„è¡Œä¸ºæè¿°ï¼Œæˆ–è€… @command{gawk} ä¸­é‚£ç»“ä¸å®Œå…¨ç¬¦åˆï¼Œæˆ–è€… POSIX æœ¬èº«åº”è¯¥æè¿°ï¼Œä½†æ˜¯æ²¡æœ‰æè¿°çš„é‚£äº›äº‹æ€§ã€‚

@cindex artificial intelligence@comma{} @command{gawk} and
@item doc/awkforai.txt
æŒ‡å‘åˆå§‹æ–‡ç¨¿ï¼Œè¯¥æ–‡ç¨¿ç®€å•åœ°æè¿°äº†ä¸ºä»€ä¹ˆ @command{gawk} æ˜¯ä¸€ä¸ªç”¨äºäººå·¥æ™ºèƒ½ï¼ˆAIï¼‰çš„å¥½çš„ç¼–ç¨‹è¯­è¨€çš„åŸå› ã€‚

@item doc/bc_notes
@command{gawk} çš„å†…éƒ¨â€œå­—èŠ‚ç â€çš„ç®€å•æè¿°ã€‚

@item doc/README.card
@itemx doc/ad.block
@itemx doc/awkcard.in
@itemx doc/cardfonts
@itemx doc/colors
@itemx doc/macros
@itemx doc/no.colors
@itemx doc/setter.outline
äº”è‰² @command{awk} å‚è€ƒå¡çš„ @command{troff} æºä»£ç ã€‚åƒ GNU @command{troff}ï¼ˆ@command{groff}ï¼‰è¿™æ ·çš„ç°ä»£ç‰ˆæœ¬çš„ @command{troff} ç”¨äºäº§ç”Ÿå½©è‰²çš„ç‰ˆæœ¬ã€‚æŸ¥çœ‹ @file{README.card} æ–‡ä»¶ã€‚å¦‚æœä½ æœ‰æ—§çš„ @command{troff}ï¼Œå¡æ˜¯è¯´æ˜æ–‡æ¡£ã€‚

@item doc/gawk.1
ç”¨äºæè¿°  @command{gawk} æ‰‹å†Œçš„ @command{troff} çš„æºä»£ç ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸ºäº†æ–¹ä¾¿ Unix ç”¨æˆ·ã€‚

@cindex Texinfo
@item doc/gawktexi.in
@itemx doc/sidebar.awk
æœ¬@value{DOCUMENT}çš„ Texinfo æºä»£ç æ–‡ä»¶ã€‚å®ƒåº”è¯¥ç”± @file{doc/sidebar.awk} æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œå¹¶åœ¨ä½¿ç”¨ @command{texi2dvi} æˆ–è€… @command{texi2pdf} äº§ç”Ÿå¯æ‰“å°çš„æ–‡æ¡£ä¹‹å‰è¿›è¡Œï¼Œä½¿ç”¨ @command{makeinfo} æ¥äº§ç”Ÿ Info æˆ–è€… HTML æ–‡ä»¶ã€‚
@file{Makefile} ä¼šå¤„ç†è¿™äº›å¤„ç†è¿‡ç¨‹ï¼Œå¹¶äº§ç”Ÿä½¿ç”¨ @command{texi2dvi} æˆ–è€… @command{texi2pdf} æ¥äº§ç”Ÿå¯æ‰“å°çš„è¾“å‡ºã€‚

@item doc/gawk.texi
ä½¿ç”¨ @file{gawktexi.in} å¤„ç† @file{sidebar.awk} æ–‡ä»¶ä¹‹åäº§ç”Ÿçš„æ–‡ä»¶ã€‚

@item doc/gawk.info
ä¸ºæœ¬@value{DOCUMENT}äº§ç”Ÿ Info æ–‡ä»¶ã€‚

@item doc/gawkinet.texi
@ifinfo
@inforef{Top, , General Introduction, gawkinet, @value{GAWKINETTITLE}}.
@end ifinfo
@ifnotinfo
@cite{@value{GAWKINETTITLE}}.
@end ifnotinfo
çš„ Texinfo æºæ–‡ä»¶ã€‚
å®ƒåº”è¯¥ç”± @TeX{} å¤„ç†ï¼ˆé€šè¿‡ @command{texi2dvi} æˆ–è€… @command{texi2pdf}ï¼‰æ¥äº§ç”Ÿå¯æ‰“å°çš„æ–‡æ¡£ä»¥åŠç”¨ @command{makeinfo} æ¥äº§ç”Ÿ Info æˆ–è€… HTML æ–‡ä»¶ã€‚

@item doc/gawkinet.info
@cite{@value{GAWKINETTITLE}} ç”Ÿæˆçš„ Info æ–‡ä»¶ã€‚

@item doc/igawk.1
åœ¨ @ref{Igawk Program} ä¸­æè¿°çš„ @command{igawk} ç¨‹åºæ‰‹å†Œçš„ @command{troff} æºä»£ç ã€‚

@item doc/Makefile.in
åœ¨é…ç½®è¿‡ç¨‹ä¸­ä½¿ç”¨çš„è¾“å…¥æ–‡ä»¶ï¼Œç”¨äºäº§ç”Ÿå®é™…çš„ç”Ÿæˆæ–‡æ¡£çš„ @file{Makefile}ã€‚

@item Makefile.am
@itemx */Makefile.am
è¢« GNU Automake è½¯ä»¶ä½¿ç”¨çš„æ–‡ä»¶ï¼Œä»¥ç”Ÿæˆç”± Autoconf ä¸ @command{configure}ä½¿ç”¨çš„ @file{Makefile.in} æ–‡ä»¶ã€‚

@item Makefile.in
@itemx aclocal.m4
@itemx bisonfix.awk
@itemx config.guess
@itemx configh.in
@itemx configure.ac
@itemx configure
@itemx custom.h
@itemx depcomp
@itemx install-sh
@itemx missing_d/*
@itemx mkinstalldirs
@itemx m4/*
è¿™äº›æ–‡ä»¶ä¸å­ç›®å½•åœ¨åœ¨ä¸åŒçš„ Unix ç³»ç»Ÿä¸­é…ç½®åŠç¼–è¯‘ @command{gawk} æ—¶ä½¿ç”¨ã€‚å®ƒä»¬å¤§å¤šæ•°åœ¨ @ref{Unix Installation}ï¼Œä¸­è¿›è¡Œçš„è§£é‡Šï¼Œå…±ä½™çš„åˆ™ä½œä¸ºä¸»æ¡†æ¶çš„æ”¯æŒæ–‡ä»¶ã€‚

@item po/*
åŒ…å«ä¿¡æ¯ç¿»è¯‘çš„ @file{po} åº“ã€‚

@item awklib/extract.awk
@itemx awklib/Makefile.am
@itemx awklib/Makefile.in
@itemx awklib/eg/*
@file{awklib} ç›®å½•åŒ…å«äº† @file{extract.awk} çš„å¤æœ¬ï¼ˆæŸ¥çœ‹ @pxref{Extract Program}ï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨äºä»æœ¬@value{DOCUMENT}çš„ Texinfo æºæ–‡ä»¶ä¸­æä¾›ä¾‹å­ç¨‹åºã€‚åŒæ—¶ä¹ŸåŒ…å«äº† @file{Makefile.in} æ–‡ä»¶ï¼Œ@command{configure} ä½¿ç”¨å…¶æ¥ç”Ÿæˆ @file{Makefile} æ–‡ä»¶ã€‚@file{Makefile.am} æ–‡ä»¶è¢« GNU Automake ç”¨æ¥åˆ›å»º @file{Makefile.in} æ–‡ä»¶ã€‚æ¥è‡ªäº @ref{Library Functions} çš„åº“å‡½æ•°ï¼Œä»¥åŠæ¥è‡ªäº @ref{Igawk Program} çš„ @command{igawk} ç¨‹åºï¼Œå·²ç»å«åœ¨å‘å¸ƒç‰ˆæœ¬ä¸­ï¼Œå¹¶ä¸”å¼€ç®±å³ç”¨ã€‚åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä½œä¸ºä¸€éƒ¨åˆ†è¿›è¡Œå®‰è£…ã€‚æœ¬@value{DOCUMENT}çš„å…¶ä»–ç¨‹åºåœ¨ @file{awklib/eg} ç­‰å­ç›®å½•ä¸­éƒ½å¯ä»¥è·å– ã€‚

@item extension/*
è¢« @command{gawk} åŒ…å«çš„ä¾‹å­æ‰©å±•çš„æºä»£ç ï¼Œæ‰‹å†Œï¼Œä»¥åŠåŸºç¡€æ–‡ä»¶ã€‚æŸ¥çœ‹ @ref{Dynamic Extensions}ï¼Œæ¥è·å–æ›´å¤šä¿¡æ¯ã€‚

@item posix/*
ç”¨äºåœ¨ POSIX å…¼å®¹çš„ç³»ç»Ÿä¸Šæ„å»º @command{gawk} æ‰€éœ€è¦çš„æ–‡ä»¶ã€‚

@item pc/*
ç”¨äºåœ¨ MS-Windows
Files needed for building @command{gawk} under MS-Windows
@ifclear FOR_PRINT
ä¸ OS/2 
@end ifclear
ç³»ç»Ÿä¸Šæ„å»º @command{gawk} æ‰€éœ€è¦çš„æ–‡ä»¶ï¼ˆæŸ¥çœ‹ @pxref{PC Installation}ï¼Œè·å–ç›¸å…³ä¿¡æ¯ï¼‰ã€‚

@item vms/*
ç”¨äºåœ¨ Vax/VMS ä¸ OpenVMS ç³»ç»Ÿä¸Šæ„å»º @command{gawk} æ‰€éœ€è¦çš„æ–‡ä»¶ï¼ˆæŸ¥çœ‹ @pxref{VMS Installation}ï¼Œè·å–ç›¸å…³ä¿¡æ¯ï¼‰ã€‚

@item test/*
@command{gawk} çš„æµ‹è¯•åŒ…ã€‚ä½ å¯ä»¥åœ¨ @command{gawk} çš„é¡¶å±‚ç›®å½•ä¸­ä½¿ç”¨ @samp{make check} æ¥æ‰§è¡Œ @command{gawk} çš„æµ‹è¯•åŒ…ã€‚å¦‚æœ @command{gawk} æµ‹è¯•æˆåŠŸï¼Œåˆ™ä½ å¯ä»¥è®¤ä¸ºç§»æ¤æ˜¯æˆåŠŸçš„ã€‚
@end table

@node Unix Installation
@appendixsec åœ¨ Unix-like çš„ç³»ç»Ÿä¸Šç¼–è¯‘ä¸å®‰è£… @command{gawk}

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦ä¸¤ä¸ªå‘½ä»¤æ¥ç¼–è¯‘ä¸å®‰è£… @command{gawk}ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ä¸å¸¸ç”¨çš„ç³»ç»Ÿï¼Œä½ å¯èƒ½éœ€è¦è‡ªå·±æ¥ä¸ºä½ çš„ç³»ç»Ÿæ¥é…ç½® @command{gawk}ã€‚

@menu
* Quick Installation::               Compiling @command{gawk} under Unix.
* Additional Configuration Options:: Other compile-time options.
* Configuration Philosophy::         How it's all supposed to work.
@end menu

@node Quick Installation
@appendixsubsec ä¸º Unix-like çš„ç³»ç»Ÿç¼–è¯‘ @command{gawk}

åœ¨æ‰€æœ‰çš„ç°ä»£ç”± Unix æ´¾ç”Ÿå‡ºæ¥çš„ç³»ç»Ÿä¸­ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å¸¸è§„æ­¥éª¤ï¼Œå¦‚ GNU/Linuxï¼ŒBSD æ´¾ç”Ÿçš„ç³»ç»Ÿï¼Œä»¥åŠ MS-Windows ä¸­çš„ Cygwin ç¯å¢ƒã€‚

åœ¨è§£å‹äº† @command{gawk} å‘å¸ƒæ–‡ä»¶åï¼Œ@command{cd} åˆ° @file{gawk-@value{VERSION}.@value{PATCHLEVEL}} ç›®å½•ã€‚ä¸å¤§å¤šçš„ GNU è½¯ä»¶ç±»ä¼¼ï¼Œä½ é€šè¿‡æ‰§è¡Œ @command{configure} æ–‡ä»¶æ¥åœ¨ç³»ç»Ÿä¸Šå¯¹ @command{gawk} è¿›è¡Œé…ç½®ã€‚è¿™ä¸ªç¨‹åºæ˜¯ä¸€ä¸ª Bourne Shell è„šæœ¬ï¼Œç”± GNU çš„ Autoconf è‡ªåŠ¨äº§ç”Ÿã€‚
@ifnotinfo
ï¼ˆAutoconf è½¯ä»¶åœ¨ @cite{Autoconfâ€”â€”é…ç½®è„šæœ¬è‡ªåŠ¨åŠ›ç”Ÿæˆ}ï¼Œä¸­æœ‰å…¨é¢çš„æè¿°ï¼Œè¿™ä¸ªå¯ä»¥åœ¨ @uref{http://www.gnu.org/software/autoconf/manual/index.html,è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šçš„ç½‘ç«™} ä¸Šæ‰¾åˆ°ã€‚ï¼‰
@end ifnotinfo
@ifinfo
ï¼ˆAutoconf è½¯ä»¶åœ¨ @inforef{Top, , Autoconf, autoconf,Autoconf---Generating Automatic Configuration Scripts}ï¼Œä¸­æœ‰å…¨é¢çš„æè¿°ã€‚ï¼‰
@end ifinfo

ç®€å•åœ°è¿è¡Œ @command{configure} å‘½ä»¤æ¥é…ç½® @command{gawk}ï¼š

@example
sh ./configure
@end example

è¿™ä¼šäº§ç”Ÿ @file{Makefile} ä¸ä½ çš„ç³»ç»ŸåŒ¹é… @file{config.h} æ–‡ä»¶æè¿°äº†ä½ çš„ç³»ç»Ÿçš„å„ç§ç‰¹æ€§ã€‚ä½ å¯ä»¥ç¼–è¾‘ @file{Makefile} æ¥æ”¹å˜ @code{CFLAGS} å˜é‡ï¼Œç”¨ä»¥æ§åˆ¶ä¼ é€’åˆ° C ç¼–è¯‘çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆå¦‚ä¼˜åŒ–ç­‰çº§æˆ–è€…è°ƒè¯•ç¼–è¯‘é€‰é¡¹ï¼‰ã€‚

è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œåœ¨è¿è¡Œ @command{configure} çš„æ—¶å€™ï¼Œä½ å¯ä»¥æ·»åŠ ä½ è‡ªå·±çš„ @command{make} å˜é‡åˆ°å‘½ä»¤è¡Œä¸­ï¼Œåƒ @code{CC} ä»¥åŠ @code{CFLAGS} ç­‰ï¼Œå¦‚ä¸‹ï¼š

@example
CC=cc CFLAGS=-g sh ./configure
@end example

@noindent
æŸ¥çœ‹ @command{gawk} å‘è¡Œä¸­çš„æ–‡ä»¶ @file{INSTALL} æ¥è·å–è¯¦ç»†å†…å®¹ã€‚

å®Œæˆäº† @command{configure}ï¼Œå¹¶å¯¹ @file{Makefile} åšäº†ç›¸åº”ä¿®æ”¹ï¼Œè¾“å…¥ï¼š

@example
make
@end example

@noindent
ä¸ä¹…åï¼Œä½ å°±å¯ä»¥æœ‰ä¸€ä¸ªå¯ä»¥è¿è¡Œçš„ @command{gawk} ç‰ˆæœ¬ã€‚æ‰€æœ‰çš„å°±æ˜¯è¿™äº›äº†ã€‚ä¸ºäº†ç¡®è®¤@command{gawk} æ˜¯å¯ä»¥å·¥ä½œæ­£å¸¸çš„ï¼Œæ‰§è¡Œ @samp{make check}ã€‚
æ‰€æœ‰çš„æµ‹è¯•éƒ½åº”è¯¥æ˜¯æˆåŠŸçš„ã€‚å¦‚æœè¿™äº›æ­¥éª¤æ²¡æœ‰æˆåŠŸï¼Œæˆ–è€…æµ‹è¯•å¤±è´¥ï¼Œæ£€æŸ¥ @file{README_d} ç›®å½•æ¥æŸ¥çœ‹æ˜¯å¦æ‰¾åˆ°å·²çŸ¥çš„é—®é¢˜ã€‚å¦‚æœåœ¨é‚£é‡Œå¹¶æ²¡æœ‰ç›¸å…³çš„å¤±è´¥çš„æè¿°å†…å®¹ï¼Œåˆ™å‘é€ä¸€ä¸ª Bug æŠ¥å‘Šï¼ˆæŸ¥çœ‹ @pxref{Bugs}ï¼‰ã€‚

å½“ç„¶ï¼Œä¸€æ—¦å®Œæˆäº†æ„å»º @command{gawk}ï¼Œä½ å¯ä»¥å®‰è£…å®ƒã€‚ä¸ºäº†å®‰è£… @command{gawk}ï¼Œä½ è¿˜éœ€è¦æ‰§è¡Œ @samp{make
install}ï¼Œæ‰€æ‰§è¡Œçš„ç”¨æˆ·éœ€è¦æœ‰ä¸€å®šçš„æƒé™ã€‚å¦‚ä½•æ¥å®Œæˆå®‰è£…ï¼Œä¸åŒçš„ç³»ç»Ÿæ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯åœ¨å¤šæ•°çš„ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ @command{sudo} æ¥å®Œæˆã€‚åˆ™å‘½ä»¤ä¼šå˜æˆ @samp{sudo make install}ã€‚æœ‰å¯èƒ½æœ‰å¯†ç è¾“å…¥è¯·æ±‚ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œä½ åº”è¯¥æœ‰é…ç½®å¥½å“ªäº›ç”¨æˆ·å¯ä»¥æ‰§è¡Œ @command{sudo} å‘½ä»¤ã€‚

@node Additional Configuration Options
@appendixsubsec å…¶ä»–é…ç½®é€‰é¡¹
@cindex @command{gawk}, configuring, options
@cindex configuration options@comma{} @command{gawk}

å½“ä»å¤´ç¼–è¯‘ @command{gawk} æ—¶ï¼Œè¿˜æœ‰å‡ ä¸ªé¢å¤–çš„é€‰é¡¹å¯ä»¥ç”¨åœ¨ @command{configure} å‘½ä»¤è¡Œä¸Šï¼Œå®ƒä»¬æ˜¯ï¼š

@table @code

@cindex @option{--disable-extensions} configuration option
@cindex configuration option, @code{--disable-extensions}
@item --disable-extensions
ç¦ç”¨é…ç½®ä¸æ„å»º @file{extension} ç›®å½•ä¸‹çš„ä¾‹å­æ‰©å±•ã€‚åœ¨äº¤å‰ç¼–è¯‘çš„æ—¶å€™ï¼Œè¿™ä¸ªå¾ˆæœ‰ç”¨ã€‚é»˜è®¤çš„è¡Œä¸ºæ˜¯åŠ¨æ€åœ°æ£€æŸ¥æ‰©å±•æ˜¯å¦å¯ä»¥é…ç½®ä¸ç¼–è¯‘ã€‚

@cindex @option{--disable-lint} configuration option
@cindex configuration option, @code{--disable-lint}
@item --disable-lint
ç¦ç”¨æ‰€æœ‰çš„ @command{gawk} çš„ @option{--lint} æ£€æŸ¥ã€‚@option{--lint} ä¸ @option{--lint-old} é€‰é¡¹ï¼ˆæŸ¥çœ‹ @pxref{Options}ï¼‰å¯ä»¥è¢«æ¥å—ï¼Œä½†æ˜¯ä»€ä¹ˆä¹Ÿä¸åšã€‚ç±»ä¼¼åœ°ï¼Œè®¾ç½® @code{LINT} å˜é‡ï¼ˆæŸ¥çœ‹ @pxref{User-modified}ï¼‰åœ¨è¿è¡Œçš„ @command{awk} ç¨‹åºä¸­ä¹Ÿæ²¡æœ‰ä»»åŠ¡æ•ˆæœã€‚

å½“ä½¿ç”¨ GCC çš„è‡ªåŠ¨åŠ›çš„æ­»ä»£ç æ¸…é™¤åŠŸèƒ½æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥ä½¿ @command{gawk} çš„å¯é€‰æ‹©ä½“åœ¨ GNU/Linux x86-64 ç³»ç»Ÿä¸Šå° 23KBã€‚åœ¨å…¶ä»–ç³»ç»Ÿä¸ç¼–è¯‘å™¨ä¸Šçš„ç»“æœæœ‰å·®å¼‚ã€‚ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå¯ä»¥ç»™ä½ å¸¦æ¥ä¸€ç‚¹æ€§èƒ½ä¸Šçš„æå‡ã€‚

@quotation æ³¨æ„
ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å¯èƒ½å¯¼è‡´æµ‹è¯•åŒ…ä¸­çš„ä¸€äº›æµ‹è¯•æ— æ³•é€šè¿‡ã€‚è¿™ä¸ªé€‰é¡¹å¯èƒ½åœ¨åé¢ä¼šè¢«ç§»é™¤ã€‚
@end quotation

@cindex @option{--disable-nls} configuration option
@cindex configuration option, @code{--disable-nls}
@item --disable-nls
ç¦ç”¨æ‰€æœ‰çš„æ¶ˆæ¯ç¿»è¯‘åŠŸèƒ½ã€‚ä¸€èˆ¬æ¥è¯´è¿™å¹¶ä¸æ˜¯æ‰€æœŸæœ›çš„ï¼Œä½†æ˜¯å¯ä»¥ç»™ä½ å¸¦æ¥ä¸€ç‚¹æ€§èƒ½æå‡ã€‚

@cindex @option{--with-whiny-user-strftime} configuration option
@cindex configuration option, @code{--with-whiny-user-strftime}
@item  --with-whiny-user-strftime
å¼ºåˆ¶åœ¨ä½æ•ˆçš„ç³»ç»Ÿä¸Šä½¿ç”¨ C ç‰ˆæœ¬çš„ @code{strftime()} å‡½æ•°ã€‚
@end table

ä½¿ç”¨å‘½ä»¤ @samp{./configure --help} æ¥æŸ¥çœ‹ @command{configure} æä¾›çš„å®Œæ•´çš„é€‰é¡¹åˆ—è¡¨ã€‚

@node Configuration Philosophy
@appendixsubsec é…ç½®è¿‡ç¨‹

@cindex @command{gawk}, configuring
è¿™ä¸€@value{SECTION}åªæœ‰åœ¨ä½ äº†è§£ C è¯­è¨€ä»¥åŠç±» Unix æ“ä½œç³»ç»Ÿæ—¶æ‰ä¼šæœ‰è¶£ã€‚

@command{gawk} çš„ä»£ç ä¸€èˆ¬ä¼šå°è¯•å°½é‡ç¬¦åˆæ­£å¼çš„æ ‡å‡†ã€‚è¿™å°±æ˜¯è¯´ï¼Œ@command{gawk} ä¼šä½¿ç”¨ç”± ISO C æ ‡å‡†ä»¥åŠ POSIX æ“ä½œç³»ç»Ÿæ¥å£æ ‡å‡†çš„åº“ä¾‹ç¨‹ã€‚@command{gawk} æºä»£ç éœ€è¦ä½¿ç”¨ ISO C çš„ç¼–è¯‘å™¨ï¼ˆ1990 æ ‡å‡†ï¼‰ã€‚

å¾ˆå¤šçš„ Unix ç³»ç»Ÿè¦ä¹ˆä¸æ”¯æŒ ISOï¼Œè¦ä¹ˆä¸æ”¯æŒ POSIX æ ‡å‡†ã€‚@command{gawk} ä¸­çš„ @file{missing_d} å­ç›®å½•åŒ…å«äº†é‚£äº›æœ€å¯ä»¥ç¼ºå¤±çš„å‡½æ•°ã€‚

@command{configure} ç”Ÿæˆçš„ @file{config.h} æ–‡ä»¶åŒ…å«äº†é‚£äº›ä½ ç¼–è¯‘ @command{gawk} æ‰€åœ¨ç³»ç»Ÿçš„ç‰¹å®šç‰¹æ€§ã€‚è¿™ä¸ªæ–‡ä»¶æè¿°çš„ä¸‰ä»¶äº‹æƒ…æ˜¯ï¼šå¯ä»¥åŒ…å«å“ªäº›å¤´æ–‡ä»¶ï¼Œè¿™æ ·å®ƒä»¬å¯ä»¥æ­£ç¡®åœ°åŒ…å«ï¼Œåœ¨ä½ çš„ C åº“ä¸­å¯ä»¥ä½¿ç”¨å“ªäº›æ ‡å‡†çš„å‡½æ•°ï¼Œä»¥åŠå…¶ä»–çš„ç³»ç»Ÿç‰¹æ€§ã€‚å¦‚ï¼Œæœ‰å¯èƒ½åœ¨ @code{stat} ç»“æ„ä¸­æ²¡æœ‰ @code{st_blksize} å…ƒç´ ã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œ@samp{HAVE_STRUCT_STAT_ST_BLKSIZE} å°±ä¼šè¢«åå®šä¹‰ã€‚

@cindex @code{custom.h} file
ä¹Ÿæœ‰å¯èƒ½ä½ çš„ C ç¼–è¯‘å™¨ä¼šå¯¹ @command{configure} è¯´è°ã€‚å½“æŸä¸ªåº“å‡½æ•°ä¸å¯ç”¨æ—¶ï¼Œä¸ä¼šä»¥é”™è¯¯é€€å‡ºã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¿®æ”¹ @file{custom.h} æ–‡ä»¶ã€‚ä½¿ç”¨é€‚ç”¨äºä½ çš„ç³»ç»Ÿçš„ @samp{#ifdef} æˆ–è€… @code{#define} æ‰€æœ‰é‚£äº›åº”è¯¥å®šä¹‰è€Œæ²¡æœ‰å®šä¹‰çš„å¸¸é‡ï¼Œæˆ–è€… @code{#undef} é‚£äº›æœ¬ä¸åº”è¯¥å®šä¹‰è€Œå®šä¹‰äº†çš„å¸¸é‡ã€‚@file{config.h} æ–‡ä»¶ä¼šè¢« @file{config.h} æ–‡ä»¶è‡ªåŠ¨åŒ…å«ã€‚

æœ‰å¯èƒ½ç”± Autoconf ç”Ÿæˆçš„ @command{configure} æ–‡ä»¶åœ¨ä½ çš„ç³»ç»Ÿä¸Šæ²¡æ³•å·¥ä½œã€‚å¦‚æœæœ‰é—®é¢˜ï¼Œ@file{configure.ac} æ–‡ä»¶ä½œä¸º Autoconf çš„è¾“å…¥æ–‡ä»¶ï¼Œä½ ä»¥ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æ¥äº§ç”Ÿä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ @command{configure} æ–‡ä»¶ï¼Œä½¿å…¶å¯ä»¥è¿è¡Œåœ¨ä½ çš„ç³»ç»Ÿä¸Šï¼ˆæŸ¥çœ‹ @pxref{Bugs}ï¼Œæ¥è·å–å¦‚ä½•æ¥æŠ¥å‘Š @command{gawk} çš„é…ç½®é—®é¢˜ï¼‰ã€‚ç±»ä¼¼çš„æœºåˆ¶å¯ä»¥åº”ç”¨äº @file{configure.ac} ä¸/æˆ–è€… @file{custom.h}æ–‡ä»¶ã€‚

@node Non-Unix Installation
@appendixsec å®‰è£…åˆ°å…¶ä»–æ“ä½œç³»ç»Ÿä¸Š 

è¿™ä¸€@value{SECTION}æè¿°å¦‚ä½•å°† @command{gawk} å®‰è£…åˆ°å…¶ä»–çš„é Unix ç³»ç»Ÿä¸Šã€‚

@menu
* PC Installation::             Installing and Compiling @command{gawk} on
                                MS-DOS and OS/2.
* VMS Installation::            Installing @command{gawk} on VMS.
@end menu

@c Rewritten by Scott Deifik <scottd.mail@sbcglobal.net>
@c and Darrel Hankerson <hankedr@mail.auburn.edu>

@node PC Installation
@appendixsubsec å®‰è£…åˆ° PC æ“ä½œç³»ç»Ÿ 

@cindex PC operating systems@comma{} @command{gawk} on, installing
@cindex operating systems, PC@comma{} @command{gawk} on, installing
æœ¬@value{SECTION}åŒ…å«çš„å†…å®¹ä¸ºåœ¨è¿è¡Œäº Intel æ¶æ„çš„æœºå™¨ä¸Šçš„ 
This @value{SECTION} covers installation and usage of @command{gawk}
on Intel architecture machines
@ifclear FOR_PRINT
MS-DOSï¼Œä»»æ„çš„ MS-Windows æˆ–è€… OS/2 ç³»ç»Ÿä¸­ @command{gawk} çš„å®‰è£…ä¸ä½¿ç”¨ã€‚
@end ifclear
@ifset FOR_PRINT
MS-DOS å’Œä»»æ„çš„ MS-Windows ç³»ç»Ÿä¸­ @command{gawk} çš„å®‰è£…ä¸ä½¿ç”¨ã€‚
@end ifset
è¿™ä¸€@value{SECTION}ä¸­æ‰€ä½¿ç”¨çš„æœ¯è¯­â€œWindows32â€æŒ‡çš„æ˜¯ Microsoft çš„ Windows95/98/ME/NT/2000/XP/Vista/7/8ã€‚

MS-DOS çš„èŒƒå›´ï¼ˆä»¥åŠåœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸‹çš„ MS-DOS å¤–å£³ç¨‹åºï¼‰æŒ‡çš„æ˜¯ä¸åŒçš„â€œDOS æ‰©å±•å™¨â€ï¼Œå¸¸ä¸ @command{gawk} è¿™æ ·çš„ç¨‹åºä¸€èµ·ä½¿ç”¨ã€‚Microsoft Windows 3.1 ä¸ Windows32 ä¸åŒçš„èƒ½åŠ›å¯¼è‡´äº†å›°æƒ‘çš„äº§ç”Ÿã€‚ä¸ºäº†å¯¹è¿™äº›è€ƒé‡æœ‰ä¸ªå…¨é¢çš„æ¦‚å†µï¼Œè¯·æŸ¥çœ‹å‘å¸ƒç¨‹åºä¸­çš„ @file{README_d/README.pc} æ–‡ä»¶ã€‚

@menu
* PC Binary Installation::      Installing a prepared distribution.
* PC Compiling::                Compiling @command{gawk} for MS-DOS,
                                Windows32, and OS/2.
* PC Testing::                  Testing @command{gawk} on PC systems.
* PC Using::                    Running @command{gawk} on MS-DOS, Windows32
                                and OS/2.
* Cygwin::                      Building and running @command{gawk} for
                                Cygwin.
* MSYS::                        Using @command{gawk} In The MSYS Environment.
@end menu

@ifclear FOR_PRINT
@node PC Binary Installation
@appendixsubsubsec ä¸º PC ç³»ç»Ÿå®‰è£…ä¸€ä¸ªç¼–è¯‘ç‰ˆ 

å¦‚æœä½ æœ‰ä¸€ä¸ªç»´æŠ¤è€…ä¸º MS-DOS æä¾›äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œ@command{gawk} ä»¥åŠç›¸å…³çš„æ”¯æŒæ–‡ä»¶ä¼šå­˜å­˜åœ¨ @file{gnu} ç›®å½•ä¸‹ï¼Œæ‰§è¡Œæ–‡ä»¶å­˜åœ¨ @file{gnu/bin}ï¼Œåº“å­˜å­˜å‚¨åœ¨ @file{gnu/lib/awk} ç›®å½•ä¸­ï¼Œæ‰‹å†Œå­˜æ”¾åœ¨ @file{gnu/man}ã€‚è¿™æ˜¯ä¸ºäº†èƒ½å¤Ÿéå¸¸å®¹æ˜“åœ°å°† @command{gawk} å®‰è£…åˆ°ä½ çš„é©±åŠ¨ç¨‹åºä¸­çš„ @file{/gnu} ç›®å½•â€”â€”ä½†æ˜¯ï¼Œåªè¦æ­£ç¡®è®¾ç½® @env{AWKPATH}ï¼Œä½ å¯ä»¥å®‰è£…åœ¨ä»»ä½•ä½ç½®ã€‚å¦‚æœä¸è€ƒè™‘å®‰è£…ç›®å½•ï¼Œ@file{igawk.cmd} ä¸ @file{igawk.bat}ï¼ˆåœ¨ @file{gnu/bin} ç›®å½•ä¸­ï¼‰æœ‰å¯èƒ½éœ€è¦ä¿®æ”¹ã€‚

äºŒè¿›åˆ¶å‘å¸ƒç‰ˆæœ¬åŒ…å«ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶æ¥æè¿°å†…å®¹ã€‚æœ‰ä¸€äº›ç‰¹åˆ«æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½åŒ…å«å¤šäºä¸€ä¸ªç‰ˆæœ¬çš„ @command{gawk} å¯æ‰§è¡Œæ–‡ä»¶ã€‚

OS/2ï¼ˆ32 ä½ EMSï¼‰äºŒè¿›åˆ¶å‘å¸ƒç‰ˆæœ¬ä¼šå®‰è£…åœ¨ä½ é€‰æ‹©çš„é©±åŠ¨çš„ @file{/usr} ç›®å½•ä¸‹ã€‚å¦‚æœä½ æƒ³å°† @command{gawk} å®‰è£…åˆ°ä¸€ä¸ªä¸æ˜¯ç¡¬ç¼–ç çš„ @samp{c:} åˆ†åŒºä¸Šï¼Œä½ å¯ä»¥å°† @env{UNIXROOT} è®¾ç½®ä¸ºä½ å®‰è£…çš„é©±åŠ¨å™¨ä¸Šï¼ˆå¦‚ï¼Œ@samp{c:}ï¼‰ã€‚å¯æ‰§è¡Œæ–‡ä»¶ä¼šå‡ºç°åœ¨ @file{/usr/bin} ç›®å½•ä¸‹ï¼Œåº“ä¼šå­˜å‚¨åœ¨ @file{/usr/share/awk} ç›®å½•ä¸‹ï¼Œè€Œæ‰‹å†Œåˆ™åœ¨ @file{/usr/man} ç›®å½•ä¸‹ï¼ŒTexinfo æ–‡æ¡£å­˜åœ¨ @file{/usr/info}ï¼ŒNLS æ–‡ä»¶å­˜åœ¨ @file{/usr/share/locale} ä¸­ã€‚æ³¨æ„ï¼Œåªè¦æ­£ç¡®åœ°è®¾ç½® @env{AWKPATH}ï¼Œä½ å¯ä»¥å®‰è£…åˆ°ä»»ä½•ä½ç½®ã€‚

å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªæ–‡ä»¶ @file{/usr/info/dir} æ˜¯å¦ä¸€ä¸ªåŒ…çš„ï¼Œ@emph{ä¸è¦è¦†ç›–å®ƒï¼}ç›¸ååœ¨ä½ æç¤ºç¬¦ä¸‹è¾“å…¥å‘½ä»¤ï¼ˆå°† @samp{x:} æŒ‰æˆä½ çš„å®‰è£…é©±åŠ¨å™¨ï¼‰ï¼š

@example
install-info --info-dir=x:/usr/info x:/usr/info/gawk.info
install-info --info-dir=x:/usr/info x:/usr/info/gawkinet.info
@end example

äºŒè¿›åˆ¶å‘å¸ƒç‰ˆæœ¬ä¸­å¯èƒ½è¿˜åŒ…å«å•ç‹¬çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›é¢å¤–çš„æ›´è¯¦ç»†çš„å®‰è£…æŒ‡å¯¼ã€‚
@end ifclear

@node PC Compiling
@appendixsubsubsec ä¸º PC æ“ä½œç³»ç»Ÿç¼–è¯‘ @command{gawk}


@ifclear FOR_PRINT
å¯ä»¥ä½¿ç”¨æ¥è‡ªäº MinGWï¼ˆWindows32ï¼‰æˆ–è€… Eberhard Mattes(EMX: MS-DOSï¼ŒWindows32 ä¸ OS/2) ä¸º MS-DOSï¼ŒWindows32 ä¸ OS/2 ç¼–è¯‘ @command{gawk}ã€‚
@end ifclear
@ifset FOR_PRINT
å¯ä»¥ä½¿ç”¨æ¥è‡ªäº MinGW ä¸º Windows32 ç¼–è¯‘ @command{gawk}ã€‚
@end ifset
@command{gawk} å‘è¡Œä¸­çš„æ–‡ä»¶ @file{README_d/README.pc} ä¸­åŒ…å«äº†é¢å¤–çš„æç¤ºï¼Œ@file{pc/Makefile} åŒ…å«äº†ç¼–è¯‘ç¼–è¯‘é€‰é¡¹çš„é‡è¦ä¿¡æ¯ã€‚

@cindex compiling @command{gawk} for MS-DOS and MS-Windows
ä¸ºäº†ä¸º MS-DOS ä¸ Windows32 æ„å»º @command{gawk}ï¼Œå°† @file{pc} ç›®å½•ä¸‹ï¼ˆ@emph{é™¤äº†} @file{ChangeLog}ï¼‰çš„æ–‡ä»¶ä¸ @command{gawk} å…¶ä»–çš„æºæ–‡ä»¶å¤åˆ¶åˆ°æŸä¸ªç›®å½•ä¸‹ï¼Œç„¶åè°ƒç”¨ @command{make} æ¥æ‰§è¡Œç‰¹å®šçš„ç›®æ ‡ä»¥æ„å»º @command{gawk}ã€‚ä» @file{pc} ç›®å½•ä¸‹å¤åˆ¶è€Œæ¥çš„ @file{Makefile} ä¸­åŒ…å«äº†ä¸€ä¸ªé…ç½®æ®µï¼Œå…¶ä¸­å¸¦æœ‰ç›¸åº”çš„æ³¨é‡Šï¼Œæœ‰å¯èƒ½éœ€è¦ä¿®æ”¹ä»¥ä½¿å…¶å¯ä»¥ä½¿ç”¨ä½ çš„ @command{make} å·¥å…·ç”¨äºå…¶ä¸Šã€‚

@file{Makefile} æ”¯æŒå¾ˆå¤šçš„æ„å»ºç›®æ ‡ï¼Œç”¨äºæ„å»ºä¸åŒçš„ MS-DOS ä¸ Windows32 ç‰ˆæœ¬ã€‚å¦‚æœ @command{make} æ—¶æ²¡æœ‰å¸¦ä¸Šç›®æ ‡ï¼Œåˆ™å¯ç”¨çš„ç›®æ ‡ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚
å¦‚ï¼Œä½¿ç”¨ MinGW æ„å»ºæœ¬åœ°çš„ MS-Windows çš„äºŒè¿›åˆ¶ç‰ˆæœ¬çš„ @command{gawk}ï¼Œåˆ™è¾“å…¥ @samp{make mingw32}ã€‚

@ifclear FOR_PRINT
@cindex compiling @command{gawk} with EMX for OS/2
@command{gawk} çš„ 32 ä½ EMX ç‰ˆæœ¬åœ¨ OS/2 ä¸‹æ˜¯â€œå¼€ç®±å³ç”¨â€çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ ç”¨ GCC 2.95.3 æ¥è¿›è¡Œç¼–è¯‘ã€‚æ€»çš„æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥å¯¹ @command{gawk} è¿›è¡Œç¼–è¯‘ï¼š

@example
$ @kbd{./configure}
$ @kbd{make}
@end example

ä½†æ˜¯æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆåšã€‚ä¸ºäº†è¦å–å¾—ä¸€ä¸ª OMF çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨ä½ çš„ @command{sh} æç¤ºç¬¦ä¸‹ï¼Œä½ åº”è¯¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¡Œï¼š

@example
$ @kbd{CFLAGS="-O2 -Zomf -Zmt"}
$ @kbd{export CFLAGS}
$ @kbd{LDFLAGS="-s -Zcrtdll -Zlinker /exepack:2 -Zlinker /pm:vio -Zstack 0x6000"}
$ @kbd{export LDFLAGS}
$ @kbd{RANLIB="echo"}
$ @kbd{export RANLIB}
$ @kbd{./configure --prefix=c:/usr}
$ @kbd{make AR=emxomfar}
@end example

è¿™æ˜¯å¯¹ä½¿ç”¨ GCC 2.x çš„å»ºè®®ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–çš„ç¯å¢ƒé›†å˜é‡ï¼ˆè‡ªåŒ…å«çš„ï¼‰ä»¥åŠç¼–è¯‘é€‰é¡¹ã€‚

@ignore
To get an FHS-compliant file hierarchy it is recommended to use the additional
@command{configure} options @option{--infodir=c:/usr/share/info}, @option{--mandir=c:/usr/share/man}
and @option{--libexecdir=c:/usr/lib}.
@end ignore

@ignore
The internal @command{gettext} library tends to be problematic. It is therefore recommended
to use either an external one (@option{--without-included-gettext}) or to disable
NLS entirely (@option{--disable-nls}).
@end ignore

å¦‚æœä½¿ç”¨çš„æ˜¯ GCC 2.95ï¼Œæˆ‘ä»¬è¿˜å»ºè®®å¦‚ä¸‹ï¼š

@example
$ @kbd{LIBS="-lgcc"}
$ @kbd{export LIBS}
@end example

å¦‚æœä½ æƒ³çš„è¯ï¼Œä½ è¿˜å¯ä»¥å¾—åˆ°ä¸€ä¸ª @code{a.out} å¯æ‰§è¡Œæ–‡ä»¶ï¼š

@example
$ @kbd{CFLAGS="-O2 -Zmt"}
$ @kbd{export CFLAGS}
$ @kbd{LDFLAGS="-s -Zstack 0x6000"}
$ @kbd{LIBS="-lgcc"}
$ @kbd{unset RANLIB}
@c $ ./configure --prefix=c:/usr --without-included-gettext
$ @kbd{./configure --prefix=c:/usr}
$ @kbd{make}
@end example

@quotation æç¤º
@code{a.out} å¯æ‰§è¡Œæ–‡ä»¶çš„ç¼–è¯‘åœ¨ GCC 3.2 ä¸‹ä¹Ÿæ˜¯å¯ç”¨çš„ã€‚GCC 3.2 åçš„ç‰ˆæœ¬è¿˜æ²¡æœ‰æµ‹è¯•æˆåŠŸè¿‡ã€‚
@end quotation

@samp{make install} åœ¨ EMX æ„å»ºæ—¶ä¼šå¦‚é¢„æœŸçš„æ–¹å¼æ‰§è¡Œã€‚

@quotation æç¤º
GNU @command{make} çš„å¤è€ OS/2 ç§»æ¤ç‰ˆæœ¬æ— æ³•å¤„ç†è¿™ä¸ªåŒ…ä¸­çš„ Makefile æ–‡ä»¶ã€‚å¦‚æœä½ ä½¿ç”¨ @command{make} é‡åˆ°äº†è¿™æ ·çš„é—®é¢˜ï¼Œå°è¯•ä¸€ä¸‹ GNU Make 3.79.1 æˆ–è€…æ›´æ–°çš„ç‰ˆæœ¬ã€‚ä½ åº”è¯¥åœ¨ @uref{ftp://hobbes.nmsu.edu/pub/os2/} ä¸ŠæŸ¥æ‰¾æœ€æ–°ç‰ˆæœ¬ã€‚
@footnote{2014 å¹´çš„ 11 æœˆï¼Œè¿™ä¸ªç«™ç‚¹éƒ½è¿˜åœ¨ï¼Œä½†æ˜¯ä½œè€…æ²¡æœ‰æ‰¾åˆ° GNU Make åŒ…ã€‚}
@end quotation
@end ifclear

@node PC Testing
@appendixsubsubsec åœ¨ PC æ“ä½œç³»ç»Ÿä¸Šæµ‹è¯• @command{gawk}

ä½¿ç”¨ @command{make} æ¥æ‰§è¡Œæ ‡å‡†çš„æµ‹è¯•å¹¶å®‰è£… @command{gawk} éœ€è¦ä¸€äº›å…¶ä»–çš„ç±» Unix çš„å·¥å…·ï¼Œè¿™äº›å·¥å…·åŒ…æ‹¬ @command{sh}ï¼Œ@command{sed} ä»¥åŠ @command{cp}ã€‚ä¸ºäº†è¦æ‰§è¡Œæµ‹è¯•ï¼Œ@file{test/*.ok} æ–‡ä»¶å¿…é¡»è¦è¿›è¡Œç›¸åº”çš„æ›´æ”¹ï¼Œè¿™æ ·å®ƒä»¬å°±æœ‰é€šå¸¸çš„ MS-DOS é£æ ¼çš„æ¢è¡Œæ ‡å¿—ã€‚å¦å¤–ï¼Œå¯ä»¥æ‰§è¡Œ @command{make check CMP="diff -a"} æ¥åœ¨æ–‡æœ¬æ¨¡å¼ä¸‹ä½¿ç”¨ GNU çš„ @command{diff} å·¥å…·è€Œä¸æ˜¯ @command{cmp} æ¥æ¯”è¾ƒç»“æœæ–‡ä»¶ã€‚

@ifclear FOR_PRINT
å¤§å¤šæ•°çš„æµ‹è¯•åœ¨ Stewartson çš„ shell ç¯å¢ƒä¸­éƒ½åº”è¯¥æ˜¯æˆåŠŸçš„ï¼Œè¿™ä¸ª Shell ä¸­å¸¦æœ‰ç›¸åº”çš„å·¥å…·ä»¥åŠé€‚å½“çš„ GNU å·¥å…·ã€‚ä½†æ˜¯ï¼Œéœ€è¦å¯¹ @file{test/Makefile} åšä¸€äº›ä¿®æ”¹ã€‚æˆ‘ä»¬å»ºè®®ä½ å¤åˆ¶ @file{pc/Makefile.tst} æ–‡ä»¶åˆ° @file{test/Makefile} ä¸­è¿›è¡Œæ›¿æ¢ã€‚ç›¸å…³çš„ç»†èŠ‚å¯ä»¥åœ¨ @file{README_d/README.pc} æ–‡ä»¶ä»¥åŠ @file{pc/Makefile.tst} æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚

åœ¨ OS/2 ä¸­ï¼Œç”±äºä½¿ç”¨äº† @code{spawnl()} è€Œä¸æ˜¯ @code{fork()}/@code{execl()} æ¥å¼€å¯å­è¿›ç¨‹ï¼Œæ‰€ä»¥ @code{pid} æµ‹è¯•ä¼šå¤±è´¥ã€‚ç”±äºæ‰€éœ€è¦çš„å¤šå­—èŠ‚å‡½æ•°ä¸å¯ç”¨ï¼Œæ‰€ä»¥ @code{mbfw1} ä¸ @code{mbprintf1} æµ‹è¯•ä¹Ÿä¼šå¤±è´¥ã€‚
@end ifclear

@node PC Using
@appendixsubsubsec åœ¨ PC æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨ @command{gawk}
@cindex operating systems, PC, @command{gawk} on
@cindex PC operating systems, @command{gawk} on

åœ¨ MS-DOS ä¸ MS-Windows å¹³å°ä¸‹ï¼ŒCygwin ä¸ MinGW ç¯å¢ƒæ”¯æŒ @samp{|&} æ“ä½œç¬¦ä¸ TCP/IP ç½‘ç»œï¼ˆæŸ¥çœ‹ @pxref{TCP/IP Networking}ï¼‰ã€‚
@ifclear FOR_PRINT
EMX (ä»… OS/2)è‡³å°‘æ”¯æŒ @samp{|&} æ“ä½œç¬¦ã€‚
@end ifclear

@cindex search paths
@cindex search paths, for source files
@cindex @command{gawk}, MS-DOS version of
@cindex @command{gawk}, MS-Windows version of
@cindex @code{;} (semicolon), @env{AWKPATH} variable and
@cindex semicolon (@code{;}), @env{AWKPATH} variable and
@cindex @env{AWKPATH} environment variable
MS-DOS ä¸ MS-Windows ç‰ˆæœ¬çš„ @command{gawk} ä¼šæœç´¢åœ¨ @ref{AWKPATH Variable}ï¼Œä¸­æè¿°çš„ç¨‹åºæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œæ˜¯ç”¨åˆ†å·ï¼ˆè€Œä¸æ˜¯å†’å·ï¼‰æ¥åˆ†éš” @env{AWKPATH} å˜é‡ä¸­çš„å…ƒç´ ã€‚å¦‚æœæ²¡æœ‰è®¾ç½® @env{AWKPATH} æˆ–è€…ä¸ºç©ºï¼Œåˆ™é»˜è®¤çš„æœç´¢è·¯å¾„æ˜¯ @samp{@w{.;c:/lib/awk;c:/gnu/lib/awk}}ã€‚

@ifclear FOR_PRINT
@cindex @command{gawk}, OS/2 version of
@cindex @code{UNIXROOT} variable, on OS/2 systems
å¯¹äº OS/2(32ä½ï¼ŒEMXï¼‰çš„æœç´¢è·¯å¾„æ˜¯å‰ç¼€è·¯å¾„æ¥ç¡®å®šï¼ˆå¤šä¸º @file{/usr} æˆ–è€… @file{c:/usr}ï¼‰ï¼Œåœ¨ Unix ç‰ˆæœ¬çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå‰ç¼€å·²ç»åœ¨ @command{configure} é…ç½®æ—¶çš„ä¸€ä¸ªé€‰é¡¹ä¸­è¿›è¡Œäº†æŒ‡å®šã€‚å¦‚æœ @file{c:/usr} æ˜¯ç›®å½•ç¼€ï¼Œåˆ™é»˜è®¤çš„æœç´¢è·¯å¾„åŒ…å« @file{.} ä¸ @file{c:/usr/share/awk}ã€‚å¦å¤–ï¼Œä¸ºäº†æ”¯æŒåœ¨ OS/2 ç³»ç»Ÿä¸­çš„äºŒè¿›åˆ¶å‘å¸ƒï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Š @samp{c:} åˆ†åŒºæœ‰å¯èƒ½ä¸æ”¯æŒé•¿@value{FN}æˆ–è€…ï¼Œæˆ–è€…æ ¹æœ¬å°±ä¸å­˜åœ¨ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ã€‚å¦‚æœ @env{UNIXROOT} æŒ‡å®šäº†ä¸€ä¸ªé©±åŠ¨å™¨ï¼Œè¿™ä¸ªé©±åŠ¨å™¨ä¹Ÿä¼šè¿›è¡Œç¨‹åºæ–‡ä»¶çš„æœç´¢ã€‚æ¯”å¦‚ï¼Œå¦‚æœ @env{UNIXROOT} è¢«è®¾ç½®ä¸º @file{e:}ï¼Œåˆ™å®Œå…¨çš„é»˜è®¤æœç´¢è·¯å¾„ä¸º @samp{@w{.;c:/usr/share/awk;e:/usr/share/awk}}ã€‚

å¦‚åƒ @command{sh} æ ·çš„ shellï¼ˆç›¸æ¯”äº MS-DOS ä¸­çš„ @command{command.com} æˆ–è€… MS Windows æˆ–è€… OS/2 ä¸­çš„ @command{cmd.exe}ï¼‰å¯¹äº @command{awk} ç¼–è¯‘ä¼šå¤§æœ‰ç”¨å¤„ã€‚DJGPP å·¥å…·ç»„ä»¶
@footnote{å¯ä»¥ä» @uref{ftp://ftp.delorie.com/pub/djgpp/current/v2gnu/} è·å¾—ã€‚}
åŒ…å«äº†ä¸€ä¸ª MS-DOS ç‰ˆæœ¬çš„ Bashï¼Œä¹ŸåŒ…å«äº†å¤šä¸ªç”¨äº OS/2 ä¸­çš„ Shellï¼Œå¦‚ @code{ksh}ã€‚
@end ifclear
@ifset FOR_PRINT
å¦‚åƒ @command{sh} æ ·çš„ shellï¼ˆç›¸æ¯”äº MS-DOS ä¸­çš„ @command{command.com} æˆ–è€… MS Windows ä¸­çš„ @command{cmd.exe}ï¼‰å¯¹äº @command{awk} ç¼–è¯‘ä¼šå¤§æœ‰ç”¨å¤„ã€‚DJGPP å·¥å…·ç»„ä»¶
@footnote{å¯ä»¥ä» @uref{ftp://ftp.delorie.com/pub/djgpp/current/v2gnu/} è·å¾—ã€‚}
åŒ…å«äº†ä¸€ä¸ª MS-DOS ç‰ˆæœ¬çš„ Bashã€‚
@end ifset

@cindex common extensions, @code{BINMODE} variable
@cindex extensions, common@comma{} @code{BINMODE} variable
@cindex differences in @command{awk} and @command{gawk}, @code{BINMODE} variable
@cindex @code{BINMODE} variable
@ifclear FOR_PRINT
åœ¨ MS-Windowsï¼ŒOS/2 ä»¥åŠ MS-DOS ä¸­ï¼Œ
@end ifclear
@ifset FOR_PRINT
åœ¨ MS-Windows ä»¥åŠ MS-DOS ä¸­ï¼Œ
@end ifset
@command{gawk}ï¼ˆä»¥åŠå¾ˆå¤šçš„å…¶ä»–çš„æ–‡ä»¶ç¨‹åºï¼‰ä¼šé»˜é»˜åœ°å°† @samp{\r\n} è¿™æ ·çš„è¡Œå°¾è½¬æ¢æˆæˆ @samp{\n}ï¼Œæˆ–è€…å°†è¾“å…¥ä¸­çš„ @samp{\n} è½¬æ¢æˆ @samp{\r\n} è¾“å‡ºã€‚ç‰¹æ®Šå˜é‡ @code{BINMODE} @value{COMMONEXT} å¯ä»¥æ§åˆ¶è¿™æ ·çš„è½¬æ¢ï¼Œå¹¶åšå¦‚ä¸‹è§£é‡Šï¼š

@itemize @value{BULLET}
@item
å¦‚æœ @code{BINMODE} ä¸º @code{"r"} æˆ–è€… 1ï¼Œåˆ™äºŒè¿›åˆ¶æ¨¡å¼è¢«è®¾ç½®åœ¨â€œè¯»â€æ“ä½œä¸Šï¼ˆå³åœ¨è¯»æ—¶ä¸ä¼šè¿›è¡Œè½¬æ¢ï¼‰ã€‚

@item
å¦‚æœ @code{BINMODE} ä¸º @code{"w"} æˆ–è€… 2ï¼Œåˆ™äºŒè¿›åˆ¶æ¨¡å¼è®¾è®¡åœ¨â€œå†™â€æ“ä½œä¸Šï¼ˆå³å†™æ—¶ä¸ä¼šè¿›è¡Œè½¬æ¢ã€‚ï¼‰

@item
å¦‚æœ @code{BINMODE} ä¸º @code{"rw"} æˆ–è€… @code{"wr"} æˆ–è€… 3ï¼Œåˆ™äºŒè¿›åˆ¶æ¨¡å¼ä¼šè®¾ç½®åœ¨è¯»å†™æ“ä½œä¸Šã€‚

@item
@code{BINMODE=@var{non-null-string}} ä¸ @samp{BINMODE=3} ä¸€æ ·ï¼ˆå³ï¼Œåœ¨è¯»å†™æ—¶éƒ½ä¸è¿›è¡Œè½¬æ¢ï¼‰ã€‚ä½†æ˜¯ @command{gawk} ä¼šåœ¨å­—ä¸²ä¸æ˜¯ @code{"rw"} æˆ–è€… @code{"wr"} æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªå‘Šè­¦ä¿¡æ¯ã€‚
@end itemize

@noindent
æ ‡å‡†è¾“å…¥æˆ–è€…æ ‡å‡†è¾“å‡ºçš„æ¨¡å¼åªä¼šè®¾ç½®ä¸€æ¬¡ï¼ˆåœ¨è¯»å–å‘½ä»¤è¡Œä¹‹åï¼Œä½†æ˜¯åœ¨å¤„ç†ä»»ä½• @command{awk} ç¨‹åºä¹‹å‰ï¼‰ã€‚åœ¨å‘½ä»¤è¡Œä¸­ï¼Œä½¿ç”¨é€‚å½“çš„ @samp{-v BINMODE=@var{N}} çš„é€‰é¡¹æ¥è®¾ç½®æ ‡å‡†è¾“å‡ºä¸æ ‡å‡†è¾“å‡ºçš„ @code{BINMODE}ã€‚@code{BINMODE} åœ¨æ–‡ä»¶æˆ–è€…ç®¡é“æ‰“å¼€æ—¶ï¼Œå¹¶ä¸”åœ¨æµå¤„ç†è¿‡ç¨‹ä¸­ä¸èƒ½å¤Ÿæ”¹å˜ã€‚

@code{BINMODE} çš„åå­—çš„é€‰æ‹©ä¸ @command{mawk} åŒ¹é…ï¼ˆæŸ¥çœ‹ @pxref{Other Versions}ï¼‰ã€‚@command{mawk} ä¸ @command{gawk} å¤„ç† @code{BINMODE} æ˜¯ç±»ä¼¼çš„ï¼Œä½†æ˜¯ @command{mawk} æ·»åŠ äº†ä¸€ä¸ª @samp{-W BINMODE=@var{N}} é€‰é¡¹ä»¥åŠç¯å¢ƒå˜é‡æ¥è®¾ç½® @code{BINMODE}ï¼Œ@code{RS}ï¼Œä»¥åŠ @code{ORS}ã€‚æ–‡ä»¶ @file{binmode[1-3].awk}ï¼ˆä¸€äº›äºŒè¿›åˆ¶å‘å¸ƒç‰ˆæœ¬ä¼šåœ¨ç›®å½• @file{gnu/lib/awk} ä¸‹ï¼‰é€‰æ‹©ä¸ @command{mawk} çš„ @samp{-W
BINMODE=@var{N}} é€‰é¡¹åŒ¹é…ã€‚è¿™å³å¯ä»¥æ”¹å˜ä¹Ÿå¯ä»¥å–æ¶ˆã€‚ç‰¹åˆ«æ˜¯ å¯¹äº @code{RS} çš„è®¾ç½®å¸¦æ¥æœ€å°çš„â€œæƒŠå¥‡â€è¿˜åœ¨äº‰è®ºã€‚å¦‚æœäºŒè¿›åˆ¶æ¨¡å¼åœ¨è¯»æ“ä½œæ—¶è®¾ç½®äº†ï¼Œåˆ™ @command{mawk} ä¼šä½¿ç”¨ @samp{RS = "\r\n"}ï¼Œè¿™å¯¹äº MS-DOS é£æ ¼çš„è¡Œç»“å°¾çš„æ–‡ä»¶æ˜¯åˆé€‚çš„ã€‚

ä¸ºäº†è¯´æ˜ï¼Œä¸‹é¢çš„ä¾‹å­åœ¨å†™åˆ°æ ‡å‡†è¾“å‡ºåŠå…¶ä»–æ–‡ä»¶æ—¶è®¾ç½®äº†äºŒè¿›åˆ¶æ¨¡å¼ï¼Œå¹¶ä¸”å°† @code{ORS} è®¾ç½®æˆâ€œæ­£å¸¸â€çš„ MS-DOS é£æ ¼çš„è¡Œå°¾ã€‚

@example
gawk -v BINMODE=2 -v ORS="\r\n" @dots{}
@end example

@noindent
æˆ–è€…ï¼š

@example
gawk -v BINMODE=w -f binmode2.awk @dots{}
@end example

@noindent
è¿™ä¸ @command{mawk} ä¸­çš„ @samp{-W BINMODE=2} æœ‰ç›¸åŒçš„ç»“æœã€‚ä¸‹é¢å°†è®°å½•çš„åˆ†éš”ç¬¦æ”¹æˆ @code{"\r\n"} å¹¶è®¾ç½®è¯»çš„äºŒè¿›åˆ¶æ¨¡å¼ï¼Œä½†æ˜¯ä¸å½±å“æ ‡å‡†è¾“å…¥çš„æ¨¡å¼ï¼š

@example
gawk -v RS="\r\n" -e "BEGIN @{ BINMODE = 1 @}" @dots{}
@end example

@noindent
æˆ–è€…ï¼š

@example
gawk -f binmode1.awk @dots{}
@end example

@noindent
å¦‚æœå¼•å·æ°å½“ï¼Œç¬¬ä¸€ä¸ªä¾‹å­ä¸­å¯¹ @code{RS} çš„è®¾ç½®å¯ä»¥ç§»åˆ° @code{BEGIN} è§„åˆ™ä¸­ã€‚

@node Cygwin
@appendixsubsubsec åœ¨ Cygwin ä¸­ä½¿ç”¨ @command{gawk} 
@cindex compiling @command{gawk} for Cygwin

å¦‚æœä½ åœ¨ MS-Windows ç³»ç»Ÿä¸­ä½¿ç”¨ @uref{http://www.cygwin.com, Cygwin ç¯å¢ƒ}ï¼Œåˆ™ @command{gawk} å¯ä»¥æ„å»ºå®Œæˆåå³å¯ä½¿ç”¨ã€‚è¿™ä¸ªæä¾›äº†å¯¹ä½¿ç”¨ @code{Bash}ï¼ŒGCCï¼ŒGNU Make åŠå…¶ä»– GNU ç¨‹åºçš„ GNU/Linux ç³»ç»Ÿå¾ˆå¥½çš„æ¨¡æ‹Ÿç¯å¢ƒã€‚åœ¨ Cygwin ä¸Šç¼–è¯‘ä¸å®‰è£…ä¸åœ¨ Unix ç³»ç»Ÿä¸Šæ˜¯ä¸€æ ·çš„ï¼š

@example
tar -xvpzf gawk-@value{VERSION}.@value{PATCHLEVEL}.tar.gz
cd gawk-@value{VERSION}.@value{PATCHLEVEL}
./configure
make && make check
@end example

ä¸åŒä¸€ä¸ªç³»ç»Ÿä¸Šçš„ GNU/Linux ç›¸æ¯”ï¼Œ@samp{configure} åœ¨ Cygwin ä¸­è¦èŠ±é•¿å¾—å¤šçš„æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå®ƒä¸€æ—¦å®Œæˆï¼Œå°±å¯ä»¥åƒé€šå¸¸é‚£æ ·ä½¿ç”¨ @samp{make} ã€‚

@node MSYS
@appendixsubsubsec åœ¨ MSYS ç¯å¢ƒä¸­ä½¿ç”¨ @command{gawk} 

åœ¨ MS-Windows ç³»ç»Ÿä¸­çš„ @code{MSYS} ç¯å¢ƒï¼Œ@command{gawk} ä¼šè‡ªåŠ¨åœ°ä½¿ç”¨è¯»å†™äºŒè¿›åˆ¶æ¨¡å¼ã€‚æ‰€ä»¥ï¼Œæ²¡æœ‰å¿…è¦è®¾ç½® @code{BINMODE} å˜é‡ã€‚

å¯¹äºå…¶ä»–å·²ç§»æ¤åˆ° MS-Windows çš„ç±» Unix ç»„ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚å› ä¸ºå®ƒä»¬å¯èƒ½è®¤ä¸º @command{gawk} ä¼šè‡ªåŠ¨è½¬æ¢ @code{"\r\n"}ï¼Œä½†æ˜¯å®é™…ä¸Šå´æ²¡æœ‰ã€‚

@node VMS Installation
@appendixsubsec åœ¨ Vax/VMS ä»¥åŠ OpenVMS ç³»ç»Ÿä¸Šç¼–è¯‘å®‰è£… @command{gawk} 

@c based on material from Pat Rankin <rankin@eql.caltech.edu>
@c now rankin@pactechdata.com
@c now r.pat.rankin@gmail.com

@cindex @command{gawk}, VMS version of
@cindex installation, VMS
è¿™ä¸ª@value{SUBSECTION}æè¿°å¦‚ä½•æ¥ç¼–è¯‘å¹¶å®‰è£… @command{gawk} åˆ° VMS ä¸­ã€‚ä¸‹é¢ä½¿ç”¨â€œVMSâ€è¿™ä¸ªè€çš„æœ¯è¯­æ¥è¡¨ç¤º OpenVMSã€‚

@menu
* VMS Compilation::             How to compile @command{gawk} under VMS.
* VMS Dynamic Extensions::      Compiling @command{gawk} dynamic extensions on
                                VMS.
* VMS Installation Details::    How to install @command{gawk} under VMS.
* VMS Running::                 How to run @command{gawk} under VMS.
* VMS GNV::                     The VMS GNV Project.
* VMS Old Gawk::                An old version comes with some VMS systems.
@end menu

@node VMS Compilation
@appendixsubsubsec åœ¨ VMS ä¸Šç¼–è¯‘ @command{gawk} 
@cindex compiling @command{gawk} for VMS

ä¸ºäº†åœ¨ VMS ä¸‹ç¼–è¯‘ @command{gawk}ï¼Œæœ‰ä¸€ä¸ª DCL å‘½ä»¤è¿‡ç¨‹ä¼šå‘èµ·æ‰€æœ‰çš„ @code{CC} ä¸ @code{LINK} å‘½ä»¤ã€‚ä¹Ÿæœ‰ä¸€ä¸ª @file{Makefile} ä¸ @code{MMS} ä»¥åŠ @code{MMK} ä¸€èµ·ä½¿ç”¨ã€‚åœ¨æºä»£ç ç›®å½•ä¸‹ï¼Œä½¿ç”¨ï¼š

@example
$ @kbd{@@[.vms]vmsbuild.com}
@end example

@noindent
æˆ–è€…ï¼š

@example
$ @kbd{MMS/DESCRIPTION=[.vms]descrip.mms gawk}
@end example

@noindent
æˆ–è€…ï¼š

@example
$ @kbd{MMK/DESCRIPTION=[.vms]descrip.mms gawk}
@end example

@command{MMK} æ˜¯å¼€æºå…è´¹çš„ï¼Œå‡ ä¹æ˜¯ @command{MMS} çš„å…‹éš†ï¼Œå¹¶èƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç† ODS-5 ä¸­çš„å¤§å°å†™æ–‡ä»¶åã€‚@command{MMK} å¯ä»¥ä» @uref{https://github.com/endlesssoftware/mmk} å–å¾—ã€‚

åœ¨ ODS-5 å­˜å‚¨å’Œæ‰©å±•è§£æå¯ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦ç²¾ç¡®çš„ç›®æ ‡å‚æ•°ã€‚

@command{gawk} åœ¨ä½¿ç”¨ Compaq C V6.4 çš„ VAX/VMS 7.3 ä»¥åŠ Alpha/VMS 7.3-1ï¼ŒAlpha/VMS 7.3ï¼ŒAlpha/VMS 7.3-2ï¼Œä¸ IA64/VMS 8.3 ä¸Šéƒ½å·²ç»åšäº†ç›¸åº”çš„æµ‹è¯•ã€‚æœ€è¿‘çš„æ„å»ºä½¿ç”¨ Alpha VMS 8.3 ä¸Šçš„ HP C V7.3ï¼Œä»¥åŠä½¿ç”¨ HP C 7.3 çš„ Alpha ä¸ IA64ã€‚ 
@footnote{IA64 å¹³å°ä¹Ÿç§°ä¸º â€œItaniumâ€ã€‚}

æŸ¥çœ‹ @ref{VMS GNV}ï¼Œæ¥è·å–å°† @command{gawk} æ„å»ºæˆä¸ GNV äº§å“å…¼å®¹çš„ PCSI åŒ…ç›¸å…³çš„ä¿¡æ¯ã€‚

@node VMS Dynamic Extensions
@appendixsubsubsec åœ¨ VMS ç¼–è¯‘ @command{gawk} åŠ¨æ€æ‰©å±•

è¢«ç§»æ¤åˆ° VMS çš„æ‰©å±•å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä¹‹ä¸€æ¥è¿›è¡Œæ„å»º ï¼š

@example
$ @kbd{MMS/DESCRIPTION=[.vms]descrip.mms extensions}
@end example

@noindent
æˆ–è€…ï¼š

@example
$ @kbd{MMK/DESCRIPTION=[.vms]descrip.mms extensions}
@end example

@command{gawk} ä½¿ç”¨ @code{AWKLIBPATH} æ¥ä½œä¸ºç¯å¢ƒå˜é‡ï¼Œæˆ–è€…æ˜¯æŸ¥æ‰¾åŠ¨æ€æ‰©å±•çš„é€»è¾‘åã€‚

åŠ¨æ€æ‰©å±•éœ€è¦ä½¿ç”¨ä¸ç¼–è¯‘ @command{gawk} ä¸€æ ·çš„ç¼–è¯‘å™¨æ¥ç¼–è¯‘ï¼Œè¿™æ ·ä½¿ç”¨ä¸ @command{gawk} ä¸€æ ·çš„æ–¹å¼æ¥å¤„ç†æµ®ç‚¹æ•°ï¼ŒæŒ‡é’ˆå¤§å° ä»¥åŠç¬¦å·åã€‚Alpha ä¸ Itanium å¹³å°åº”è¯¥ä½¿ç”¨ IEEE æ¸…ç‚¹æ•°ã€‚æŒ‡é’ˆå¤§å°æ˜¯ 32 ä½ï¼Œè€Œç¬¦å·åå¤„ç†ä¼šä½¿ç”¨ CRC æ¥ç¼©çŸ­å¤§äº 32 ä½çš„ç¬¦å·ã€‚

å¯¹äº Alpha ä¸ Itanium å¹³å°ï¼š

@example
/name=(as_is,short)
/float=ieee/ieee_mode=denorm_results
@end example

å¯¹äº VAX å¹³å°ï¼š

@example
/name=(as_is,short)
@end example

ç¼–è¯‘æ—¶é—´å®éœ€è¦åœ¨ VMS æä¾›çš„å¤´æ–‡ä»¶è¢«åŒ…å«å‰è¿›è¡Œå®šä¹‰ï¼Œå¦‚ï¼š

@example
#if (__CRTL_VER >= 70200000) && !defined (__VAX)
#define _LARGEFILE 1
#endif

#ifndef __VAX
#ifdef __CRTL_VER
#if __CRTL_VER >= 80200000
#define _USE_STD_STAT 1
#endif
#endif
#endif
@end example

å¦‚æœä½ å†™äº†è‡ªå·±çš„æ‰©å±•è¿è¡Œåœ¨ VMS ä¸Šï¼Œä½ å¿…é¡»æä¾›è¿™äº›å®šä¹‰ã€‚@file{config.h} æ–‡ä»¶ä¼šåœ¨ VMS å¹³å°ä¸Šæ„å»º @command{gawk} æ—¶ä¸ºä½ å®Œæˆè¿™ä¸ªå·¥ä½œã€‚å¦‚æœä½ ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…ç±»ä¼¼çš„å…¶ä»–æ–‡ä»¶ï¼Œåˆ™ä½ å¿…é¡»è¦è®°ä½åœ¨è¦åŒ…å« VMS æ‰€æä¾›çš„å¤´æ–‡ä»¶ä¹‹å‰åŒ…å«å®ƒã€‚

@node VMS Installation Details
@appendixsubsubsec åœ¨VMS ä¸Šå®‰è£…@command{gawk} 

è¦ä½¿ç”¨ @command{gawk} ï¼Œä½ æ‰€éœ€è¦æ˜¯ä¸€ä¸ªâ€œå¤–éƒ¨â€å‘½ä»¤ï¼Œè¿™æ˜¯ä¸€ä¸ª DCL ç¬¦å·ï¼Œå®ƒçš„å€¼ä»¥ç¾å…ƒç¬¦å·å¼€å§‹ã€‚å¦‚ï¼š

@example
$ @kbd{GAWK :== $disk1:[gnubin]gawk}
@end example

@noindent
å°† @command{gawk.exe} çš„å®é™…è·¯å¾„æ›¿æ¢ @samp{$disk1:[gnubin]}ã€‚ç¬¦å·éœ€è¦åœ¨ä»»ä½•çš„æƒ³ä½¿ç”¨ @command{gawk} çš„ç”¨æˆ·çš„ @file{login.com} ä¸­æ›¿æ¢ï¼Œè¿™æ ·æ¯æ¬¡ç”¨æˆ·ç™»å½•æ—¶éƒ½ä¼šè¿›è¡Œå®šä¹‰ã€‚å¦å¤– ï¼Œç¬¦å·ä¹Ÿå¯ä»¥ç”¨å…¨ç³»ç»Ÿçš„ @file{sylogin.com} è¿‡ç¨‹æ¥æ›¿æ¢ï¼Œè¿™æ ·æ‰€æœ‰çš„ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ @command{gawk}ã€‚

å¦‚æœä½ çš„ @command{gawk} æ˜¯é€šè¿‡ PCSI åŒ…æ¥å®‰è£…åˆ° @file{GNV$GNU:} ç›®å½•æ ‘çš„ï¼Œç¨‹åºçš„åå­—åˆ™ä¸º @file{GNV$GNU:[bin]gnv$gawk.exe} ï¼Œå¸®åŠ©æ–‡ä»¶åˆ™ä¸º @file{GNV$GNU:[vms_help]gawk.hlp}ã€‚

PCSI åŒ…ä¹Ÿä¼šå®‰è£… @file{GNV$GNU:[vms_bin]gawk_verb.cld} æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥ç”¨æ¥å°†å°† @command{gawk} ä¸ @command{awk} ä¸º DCL å‘½ä»¤ã€‚

å¯¹äºå½“å‰çš„è¿‡ç¨‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼š

@example
$ @kbd{set command gnv$gnu:[vms_bin]gawk_verb.cld}
@end example

æˆ–è€…ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨ @file{GNV$GNU:[vms_bin]gawk_verb.cld} æ¥å°† @command{gawk} ä¸ @command{awk} åŠ åˆ°ç³»ç»Ÿçº§çš„ @samp{DCLTABLES} ä¸­ã€‚

DCL è¯­æ³•åœ¨ @file{gawk.hlp} æ–‡ä»¶ä¸­æœ‰è®°å½•ã€‚

å¦å¤–ï¼Œ@file{gawk.hlp} é¡¹å¯ä»¥è¢«åŠ å…¥åˆ° VMS å¸®åŠ©åº“ä¸­ï¼š

@example
$ @kbd{LIBRARY/HELP sys$help:helplib [.vms]gawk.hlp}
@end example

@noindent
ï¼ˆä½ å¯èƒ½æƒ³å°†ç‰¹å®šäºç«™ç‚¹çš„å¸®åŠ©åº“è¿›è¡Œæ›¿æ¢ï¼Œè€Œä¸æ˜¯æ ‡å‡†çš„ VMS åº“ @samp{HELPLIB}ï¼‰åœ¨è½½å…¥äº†å¸®åŠ©æ–‡ä»¶åï¼Œå‘½ä»¤ï¼š

@example
$ @kbd{HELP GAWK}
@end example

@noindent
æä¾›äº†å…³äº @command{gawk} å®ç° ä¸ @command{awk} ç¨‹åºè¯­è¨€çš„ä¿¡æ¯ã€‚

é€»è¾‘å @samp{AWK_LIBRARY} å¯ä»¥è®¾è®¾æˆ @command{awk} ç¨‹åºæ–‡ä»¶çš„é»˜è®¤ä½ç½®ã€‚å¯¹äº @option{-f} é€‰é¡¹ï¼Œå¦‚æœæ‰€æŒ‡å®šçš„@value{FN}æ²¡æœ‰è®¾å¤‡æˆ–è€…è·¯å¾„ä¿¡æ¯ï¼Œ@command{gawk} ä¼šåœ¨é¦–å…ˆåœ¨å½“å‰çš„ç›®å½•ä¸‹æœç´¢ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šåœ¨ç”± @samp{AWK_LIBRARY} æ‰€æŒ‡å®šè·¯å¾„ä¸‹æœç´¢ã€‚å¦‚æœåœ¨æœç´¢äº†ä¸¤ä¸ªç›®å½•ä¸‹ï¼Œæ–‡ä»¶è¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œ@command{gawk} ä¼šåŠ ä¸Š @samp{.awk} åç¼€åˆ°æ–‡ä»¶åä¸­ï¼Œå°†å†æ¬¡å°è¯•æœç´¢ã€‚å¦‚æœ @samp{AWK_LIBRARY} æ²¡æœ‰å®šä¹‰ï¼Œåˆ™ä¼šä½¿ç”¨ @samp{SYS$LIBRARY:} çš„å€¼ã€‚

@node VMS Running
@appendixsubsubsec åœ¨ VMS ä¸Šè¿è¡Œ @command{gawk} 

åœ¨ VMS ä¸Šï¼Œå‘½ä»¤è¡Œçš„åˆ†æä¸å¼•å·è§„èŒƒå®Œå…¨ä¸åŒï¼Œå› æ­¤è¿™æœ¬@value{DOCUMENT}ä¸­çš„ä¾‹å­ï¼Œæˆ–è€…å…¶ä»–çš„æºä»£ç è¦åšä¸€äº›å°å˜åŒ–ã€‚è™½ç„¶å°ï¼Œæ‰€æœ‰çš„ @command{awk} ç¨‹åºéƒ½åº”è¯¥æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„ã€‚

è¿™æ˜¯ä¸€äº›ç®€å•çš„æµ‹è¯•ï¼š

@example
$ @kbd{gawk -- "BEGIN @{print ""Hello, World!""@}"}
$ @kbd{gawk -"W" version}
! could also be -"W version" or "-W version"
@end example

@noindent
æ³¨æ„å¤§å°æ··ç”¨æ—¶ï¼Œæ–‡æœ¬å¿…é¡»å¼•èµ·æ¥ã€‚

@command{gawk} çš„ VMS ç§»æ¤ç‰ˆæœ¬åŒ…å«äº†ä¸€ä¸ª DCL é£æ ¼çš„æ¥å£ï¼Œä»¥åŠåŸå§‹ Shell é£æ ¼çš„æ¥å£ï¼ˆæŸ¥çœ‹ help é¡¹æ¥è·å–è¯¦ç»†ä¿¡æ¯ï¼‰ã€‚åŒè·¯å¾„è¡Œåˆ†æçš„å‰¯ä½œç”¨æ˜¯ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼ˆå¦‚ç¨‹åºä¸­å¼•èµ·æ¥çš„ç¨‹åºï¼‰ï¼Œåˆ™å‘½ä»¤åˆ™ä¼šæœ‰ä¸€ç‚¹æ¨¡æ£±ä¸¤å¯ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸¸è§„çš„å¯é€‰çš„ @option{--} æ ‡å¿—åˆ™ç”¨æ¥å¼ºåˆ¶ä½¿ç”¨ Unix é£æ ¼çš„åˆ†ææ–¹æ³•ï¼Œè€Œä¸æ˜¯ DCL çš„åˆ†ææ–¹æ³•ã€‚å¦‚æœè¿˜æœ‰å…¶ä»–ä»»ä½•çš„ â€œæ¨ªæ ç±»å‹â€çš„é€‰é¡¹ï¼ˆæˆ–è€…å¤šä¸ªå‚æ•°ï¼Œå¦‚è¦å¤„ç†çš„æ•°æ®æ–‡ä»¶ï¼‰ï¼Œåˆ™å°±ä¸ä¼šæœ‰äºŒä¹‰æ€§ï¼Œ@option{--} åˆ™å¯ä»¥çœç•¥æ‰ã€‚

@cindex exit status, of VMS
@code{exit} å€¼æ˜¯ä¸€ä¸ª Unix é£æ ¼çš„å€¼ï¼Œå½“ç¨‹åºé€€å‡ºæ—¶ï¼Œä¼šè¢«ç¼–ç ä¸º VMS çš„é€€å‡ºå€¼ã€‚

VMS çš„ä¸¥é‡ç¨‹åºä½ä¼šæ ¹æ® @code{exit} å€¼æ¥è¿›è¡Œè®¾ç½®ã€‚1 è¡¨ç¤ºå¤±è´¥ï¼ŒVMS ä¼šè®¾ç½® @code{ERROR} çŠ¶æ€ã€‚2 è¡¨ç¤ºè‡´å‘½é”™è¯¯ï¼ŒVMS ä¼šè®¾ç½® @code{FATAL} çŠ¶æ€ã€‚æ‰€æœ‰å…¶ä»–çš„å€¼éƒ½è¡¨ç¤º @code{SUCCESS} çŠ¶æ€ã€‚é€€å‡ºå€¼çš„ç¼–ç ç¬¦åˆ VMS çš„ç¼–ç æ ‡å‡†å¹¶ä½¿ç”¨@code{C_FACILITY_NO} å€¼ @code{0x350000} ä¸å¸¸é‡ @code{0xA0000} åŠ åˆ°ä¸ºè…¾å‡ºä¸¥é‡ç¨‹åº¦ç¼–ç ä½è€Œå·¦ç§»äº† 3 ä½çš„æ•°å€¼ä¸Šã€‚

ä» VMS çŠ¶æ€ç ä¸­æå–å®é™…çš„ @command{gawk} é€€å‡ºç ï¼Œä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼š

@example
unix_status = (vms_status .and. %x7f8) / 8
@end example

@noindent
ä½¿ç”¨ @code{exec()} çš„ C ç¨‹åºè°ƒç”¨ @command{gawk} ä¼šå¾—åˆ°æœ€åˆçš„ Unix é£æ ¼çš„é€€å‡ºå€¼ã€‚

ç”¨äº VMS çš„æ—§ç‰ˆ @command{gawk} ä¼šå°† Unix çš„é€€å‡ºç  0 å½“æˆ 1ï¼Œå¤±è´¥åˆ™ä¸º 2ï¼Œè‡´å‘½é”™è¯¯åˆ™ä¸º 4ï¼Œå…¶ä»–çš„å€¼åˆ™ç›´æ¥ä¼ é€’ã€‚è¿™è¿åäº† VMS çš„é€€å‡ºçŠ¶æ€ç¼–ç è¦æ±‚ã€‚

@cindex floating-point, VAX/VMS
VAX/VMS æµ®ç‚¹æ•°ä½¿ç”¨æ— å€¾å‘çš„èˆå…¥èˆå‡ºæ–¹æ¡ˆã€‚æŸ¥çœ‹ @ref{Round Function}ã€‚

VMS ä¼šç”¨ @code{GMT} çš„æ ¼å¼æŠ¥å‘Šæ—¶é—´ï¼Œé™¤éè®¾ç½®äº† @code{SYS$TIMEZONE_RULE} æˆ–è€… @code{TZ} é€»è¾‘åå­—ã€‚æ—§ç‰ˆæœ¬çš„ VMSï¼Œä¾‹å¦‚ VAX/VMS 7.3 ä¸è®¾ç½®è¿™äº›é€»è¾‘åå­—ã€‚

@c @cindex directory search
@c @cindex path, search
@cindex search paths
@cindex search paths, for source files
å½“æœç´¢ç”± @option{-f} æŒ‡å®šçš„ @command{awk} ç¨‹åºæ–‡ä»¶æ—¶ï¼Œé»˜è®¤çš„æœç´¢è·¯å¾„æ˜¯ @code{"SYS$DISK:[],AWK_LIBRARY:"}ã€‚é€»è¾‘åå­— @env{AWKPATH} å¯ä»¥ç”¨æ¥è¦†ç›–è¿™ä¸ªé»˜è®¤è®¾ç½®ã€‚@env{AWKPATH} çš„æ ¼å¼æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„ç›®å½•åˆ—è¡¨ã€‚å¦‚æœå®šä¹‰äº†è¿™ä¸ªå˜é‡ï¼Œå€¼åº”è¯¥è¢«å¼•èµ·æ¥ï¼Œè¿™æ ·å®ƒä¼šä¿ç•™ä¸ºç‹¬ç«‹è½¬æ¢ï¼Œè€Œä¸æ˜¯ @code{RMS} æœç´¢åˆ—è¡¨çš„å¤šè½¬æ¢ã€‚

@cindex redirection on VMS

è¿™ä¸ªé™åˆ¶ä¹Ÿé€‚ç”¨äºåœ¨ GNV ä¸‹è¿è¡Œ @command{gawk}ï¼Œåœ¨ GNV ä¸‹é‡å®šå‘æ€»æ˜¯æŒ‡å‘ä¸€ä¸ª DCL å‘½ä»¤ã€‚

å¦‚æœä½ è¦é‡å®šå‘æ•°æ®åˆ°ä¸€ä¸ª VMS å‘½ä»¤æˆ–å·¥å…·ï¼Œç›®å‰çš„å®ç°éœ€è¦è®¾ç½®ä¸€ä¸ª VMS å¤–éƒ¨å‘½ä»¤ï¼Œåœ¨è°ƒç”¨
@command{gawk} ä¹‹å‰ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šè¿è¡Œä¸€ä¸ªå‘½ä»¤æ–‡ä»¶ã€‚
ï¼ˆæœªæ¥ï¼Œè¿™ä¸ªé™åˆ¶å¯èƒ½ä¼šä» VMS ä¸Šçš„ @command{gawk} å‘è¡Œç‰ˆä¸­åˆ é™¤ã€‚ï¼‰

æ²¡æœ‰è¿™ä¸ªå‘½ä»¤æ–‡ä»¶ï¼Œè¾“å…¥æ•°æ®ä¹Ÿä¼šå‡ºç°åœ¨è¾“å‡ºæ–‡ä»¶çš„å‰é¢ã€‚

è¿™é‡Œä¹Ÿå…è®¸æ¨¡æ‹Ÿ VMS æˆ– GNV å·¥å…·ä¸­æ²¡æœ‰çš„ POSIX å‘½ä»¤ã€‚

ä¸‹é¢æ˜¯ @command{gawk} é‡å®šå‘æ•°æ®åˆ° VMS å‘½ä»¤ @command{sort} çš„ä¾‹å­ï¼š

@example
$ sort = "@@device:[dir]vms_gawk_sort.com"
@end example

å‘½ä»¤æ–‡ä»¶éœ€è¦æŒ‰ä¸‹é¢çš„ä¾‹å­çš„æ ¼å¼å†™ã€‚

ç¬¬ä¸€è¡Œé˜»ç¢äº†è¾“å‡ºæ•°æ®å‡ºç°åœ¨è¾“å‡ºæ•°æ®ä¸­å›½ã€‚å®ƒå¿…é¡»æ˜¯æŒ‰ç…§è¿™ä¸ªä¾‹å­ä¸­çš„æ ¼å¼å†™ã€‚

ä¸‹ä¸€è¡Œåˆ›é€ äº†ä¸€ä¸ªå¤–éƒ¨å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤é‡å†™äº†é˜»æ­¢å‘½ä»¤æ–‡ä»¶æ— é™é€’å½’çš„å¤–éƒ¨å‘½ä»¤ã€‚

ä¸‹ä¸€è¡Œåˆ°æœ€åä¸€è¡Œçš„å‘½ä»¤ï¼Œé‡å®šå‘ @code{sys$input} åˆ° @code{sys$command}ï¼Œä¸ºäº†é€‰æ‹©è¢«é‡å®šå‘åˆ°è¿™ä¸ªå‘½ä»¤çš„æ•°æ®ã€‚ 

æœ€åä¸€è¡Œè¿è¡ŒçœŸæ­£çš„å‘½ä»¤ã€‚å®ƒå¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‘½ä»¤ï¼Œå› ä¸ºå½“å‘½ä»¤æ–‡ä»¶è¯»å®Œçš„æ—¶å€™ï¼Œä» @command{gawk} é‡å®šå‘çš„æ•°æ®ä¼šè¢«è¯»å–ã€‚

@example
$!'f$verify(0,0)'
$ sort := sort
$ define/user sys$input sys$command:
$ sort sys$input: sys$output:
@end example


@node VMS GNV
@appendixsubsubsec VMS çš„ GNV é¡¹ç›®

VMS GNV åŒ…æä¾›äº†ä¸ POSIX ç±»ä¼¼çš„æ„å»ºç¯å¢ƒï¼Œå¹¶å¸¦äº†å¾ˆå¤šå¼€æºå·¥ä½œçš„ç§»æ¤ç‰ˆæœ¬ã€‚@command{gawk} å¯ä»¥åœ¨ GNV çš„åº“ä¸­æ‰¾åˆ°ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªæ—§ç§»æ¤ç‰ˆæœ¬ã€‚å½“å‰ï¼ŒGNU é¡¹ç›®è¢«é‡æ–°ç»„ç»‡äº†ï¼Œä»¥ä¸ºæ¯ä¸ªç»„ä»¶æä¾›å•ç‹¬çš„ PCSI åŒ…ã€‚æŸ¥çœ‹ @w{@uref{https://sourceforge.net/p/gnv/wiki/InstallingGNVPackages/}ã€‚}

@command{gawk} çš„å¸¸è§„çš„æ„å»ºè¿‡ç¨‹ä¼šç”Ÿæˆä¸€ä¸ªé€‚ç”¨äº GNV çš„ç¨‹åºã€‚

åœ¨å‘è¡Œç‰ˆä¸­çš„ @file{vms/gawk_build_steps.txt} æ–‡ä»¶è®°å½•äº†æ„å»ºä¸ GNV å…¼å®¹çš„ VMS PCSI åŒ…çš„è¿‡ç¨‹ã€‚

@ignore
@c The VMS POSIX product, also known as POSIX for OpenVMS, is long defunct
@c and building gawk for it has not been tested in many years, but these
@c old instructions might still work if anyone is still using it.

@node VMS POSIX
@appendixsubsubsec åœ¨ VMS POSIX ä¸Šæ„å»ºå’Œä½¿ç”¨ @command{gawk}

è™½ç„¶åœ¨å¸®åŠ©æ–‡æ¡£åº“ä¸­ä»ç„¶èƒ½æ‰¾åˆ° @file{vms/gawk.hlp} æ–‡æ¡£ï¼Œå¿½ç•¥ä¸Šé¢çš„å‘½ä»¤å§ã€‚æºæ ‘åº”è¯¥è§£åŒ…åˆ°ä¸€ä¸ªå®¹å™¨æ–‡ä»¶å­ç³»ç»Ÿï¼Œè€Œä¸æ˜¯é€šå¸¸çš„ VMS æ–‡ä»¶ç³»ç»Ÿã€‚
ç¡®è®¤è¿™ä¸¤ä¸ªè„šæœ¬æ˜¯å¯æ‰§è¡Œçš„ï¼š@file{configure} å’Œ @file{vms/posix-cc.sh}ï¼›å¦‚æœ‰å¿…è¦ï¼Œä½¿ç”¨ @samp{chmod +x} å‘½ä»¤ã€‚
ç„¶åæ‰§è¡Œä¸‹é¢ä¸¤ä¸ªå‘½ä»¤ï¼š

@example
psx> @kbd{CC=vms/posix-cc.sh configure}
psx> @kbd{make CC=c89 gawk}
@end example

@noindent
ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼Œä½¿ç”¨ä¸€ä¸ªè„šæœ¬ä½¿ C ç¼–è¯‘å™¨ç¬¦åˆ @command{configure} çš„éœ€è¦ï¼Œä»æ¨¡æ¿æ„å»º @file{config.h} å’Œ @file{Makefile} æ–‡ä»¶ã€‚
ç¬¬äºŒä¸ªå‘½ä»¤ï¼Œä½¿ç”¨ C ç¼–è¯‘å™¨ç›´æ¥ç¼–è¯‘å’Œé“¾æ¥ @command{gawk}ï¼›å¿½ç•¥æ¥è‡ª @command{make} çš„å…³äºä¸èƒ½é‡å®šä¹‰ @code{CC} çš„è­¦å‘Šã€‚
@command{configure} éœ€è¦å¾ˆé•¿çš„æ—¶é—´æ¥æ‰§è¡Œï¼Œä¸è¿‡è‡³å°‘å®ƒä¼šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æä¾›ä¸€ä¸ªå¢é‡çš„åé¦ˆã€‚

è¿™æ›¾åœ¨ VAX/VMS V6.2ï¼ŒVMS POSIX V2.0 å’Œ DEC C V5.2.ä¸‹æµ‹è¯•è¿‡ã€‚

ä¸€æ—¦æ„å»ºå®Œï¼Œ@command{gawk} åƒå…¶ä»–çš„ shell å·¥å…·ä¸€æ ·å·¥ä½œã€‚ä¸åƒé€šå¸¸çš„ @command{gawk} ç«¯å£ï¼Œåœ¨ VMS POSIX ç¯å¢ƒä¸­ä¸éœ€è¦ç‰¹æ®Šçš„å‘½ä»¤è¡Œæ“ä½œã€‚
@end ignore

@node VMS Old Gawk
@appendixsubsubsec æœ‰ä¸€äº› VMS ç³»ç»Ÿæœ‰æ—§ç‰ˆæœ¬çš„ @command{gawk} 

@c Thanks to "gerard labadie" <gerard.labadie@gmail.com>

æœ‰ä¸€äº› VMS çš„ç‰ˆæœ¬å¸¦æœ‰æ—§çš„ @command{gawk} ç‰ˆæœ¬ã€‚ä¸ºäº†è®¿é—®å®ƒï¼Œå®šä¹‰å¦‚ä¸‹çš„ç¬¦å·ï¼š

@example
$ @kbd{gawk :== $sys$common:[syshlp.examples.tcpip.snmp]gawk.exe}
@end example

è¿™ä¸ªç‰ˆæœ¬æ˜¯ @value{PVERSION} 2.15.6ï¼Œç›¸å½“çš„è€ã€‚æˆ‘ä»¬å»ºè®®ä½ ç¼–è¯‘ä¸ä½¿ç”¨å½“å‰çš„ç‰ˆæœ¬ã€‚


@node Bugs
@appendixsec æŠ¥å‘Šé—®é¢˜ä¸ BUG 
@cindex archaeologists
@quotation
@i{
æ²¡æœ‰ä»€ä¹ˆæ¯”ä¸€ä¸ªæ— èŠçš„è€ƒå¤å­¦å®¶æ›´å±é™©ã€‚
}
@author Douglas Adams, @cite{The Hitchhiker's Guide to the Galaxy}
@end quotation
@c the radio show, not the book. :-)

@cindex debugging @command{gawk}, bug reports
@cindex troubleshooting, @command{gawk}, bug reports
å¦‚æœä½ çš„ @command{gawk} æœ‰é—®é¢˜ï¼Œæˆ–è€…ä½ è®¤ä¸ºä½ æ‰¾åˆ°äº†ä¸€ä¸ª Bugï¼Œè¯·å°†å®ƒæŠ¥å‘Šç»™å¼€å‘è€…ï¼Œæˆ‘ä»¬ä¸æ‰¿è¯ºåšä»»ä½•äº‹æƒ…ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ˜¯æƒ³è¦ä¿®å¤å®ƒçš„ã€‚

åœ¨æŠ¥å‘Š Bug ä¹‹å‰ï¼Œç¡®è®¤ä½ ç¡®å®æ˜¯æ‰¾åˆ°äº†ä¸€ä¸ªçœŸçš„ Bugã€‚ä»”ç»†é‡è¯»æ–‡æ¡£ï¼Œçœ‹æ˜¯å¦ä½ å°è¯•è¦åšçš„äº‹ã€‚å¦‚æœä¸æ˜¯å¾ˆæ¸…æ¥šä½ åº”è¯¥åšäº›ä»€ä¹ˆï¼Œä¹Ÿè¯·æŠ¥å‘Šå‡ºæ¥ã€‚è¿™æ˜¯æ–‡æ¡£ä¸­çš„ä¸€ä¸ª Bugã€‚

åœ¨æŠ¥å‘Š Bug æˆ–è€…ä½ è‡ªå·±å°è¯•ä¿®å¤å®ƒä¹‹å‰ï¼Œå°è¯•åˆ†ç¦»å‡ºèƒ½å¤ç°é—®é¢˜çš„æœ€å°çš„ @command{awk} ç¨‹åºå’Œè¾“å…¥@value{DF}ã€‚
ç„¶åå°†ä¸‹åˆ—ä¿¡æ¯å‘ç»™æˆ‘ä»¬ï¼šç¨‹åºä»£ç å’Œ@value{DF}ï¼Œä½ ä½¿ç”¨çš„ Unix ç³»ç»Ÿçš„ç§ç±»ï¼Œä½ ç”¨æ¥ç¼–è¯‘ @command{gawk} çš„ç¼–è¯‘å™¨ï¼Œä»¥åŠä½ çš„ @command{gawk} æ‰€è¿”å›æ¥çš„ç¡®åˆ‡çš„ç»“æœã€‚ä½ ä¹Ÿå¯ä»¥è¯´ä¸€ä¸‹ä½ é¢„æœŸçš„ç»“æœï¼›è¿™ä¼šå¸®åŠ©æˆ‘ä»¬å†³å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦çœŸçš„åœ¨æ–‡æ¡£é‡Œã€‚

ç¡®ä¿åŒ…å«ä½ æ‰€ä½¿ç”¨çš„ @command{gawk} çš„ç‰ˆæœ¬å·ã€‚ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è·å– @samp{gawk --version}ã€‚

@cindex @code{bug-gawk@@gnu.org} bug reporting address
@cindex email address for bug reports, @code{bug-gawk@@gnu.org}
@cindex bug reports, email address, @code{bug-gawk@@gnu.org}
ä¸€æ—¦ä½ çš„é—®é¢˜æœ‰äº†å…¨é¢ç²¾ç¡®çš„æè¿°ï¼Œä½ å°±å¯ä»¥ç»™ @EMAIL{bug-gawk@@gnu.org,bug-gawk at gnu dot org} å‘é€é‚®ä»¶ã€‚

@command{gawk} çš„ç»´æŠ¤è€…ä¼šè®¢é˜…è¿™ä¸ªé‚®ä»¶åœ°å€ï¼Œå› æ­¤ä»–ä»¬ä¼šæ”¶åˆ°ä½ çš„ Bug æŠ¥å‘Šã€‚å°½ç®¡ä½ å¯ä»¥ç›´æ¥ç»™ç»´æŠ¤è€…å‘é€é‚®ä»¶ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯ä½¿ç”¨ä¸“ç”¨çš„æŠ¥å‘Šåœ°å€ï¼Œå› æ­¤é‚®ä»¶åœ°å€åœ¨ GNU é¡¹ç›®ä¸­æ˜¯æœ‰çš„ã€‚@emph{æ‰€æœ‰çš„é‚®ä»¶éƒ½ç”¨è‹±è¯­ã€‚è¿™æ˜¯å”¯ä¸€è¢«æ‰€æœ‰ç»´æŠ¤è€…éƒ½ç†è§£çš„è¯­è¨€ã€‚}
å¦å¤–ï¼Œè¯·ç¡®ä¿æ‰€æœ‰çš„é‚®ä»¶æ˜¯ç”¨çº¯æ–‡æœ¬å†™çš„ï¼Œä¸è¦ç”¨ï¼ˆæˆ–è€…ä¸è¦ä»…ä»…ç”¨ï¼‰HTMLã€‚

@cindex @code{comp.lang.awk} newsgroup
@quotation æ³¨æ„
@emph{ä¸è¦}å°† @command{gawk} çš„ Bug æŠ¥å‘Šåˆ°ç”± @code{comp.lang.awk} æ‰€æŒ‡å‘çš„ Usenet/Internet æ–°é—»ç»„ã€‚@command{gawk} çš„å¼€å‘è€…å¶å°”æ‰ä¼šå»çœ‹è¿™ä¸ªæ–°é—»ç»„ï¼Œä½†æ˜¯ä¸ä¿è¯æˆ‘ä»¬å¯ä»¥çœ‹å¾—åˆ°ä½ æäº¤çš„å†…å®¹ã€‚è¿™é‡Œæ‰€æè¿°çš„æ­¥éª¤æ˜¯å®˜æ–¹è®¤å¯çš„ç»„ç»‡æ–¹å¼ã€‚çœŸçš„ã€‚
@end quotation

@ignore
Date: Sun, 17 May 2015 19:50:14 -0400
From: Chet Ramey <chet.ramey@case.edu>
Reply-To: chet.ramey@case.edu
Organization: ITS, Case Western Reserve University
To: Aharon Robbins <arnold@skeeve.com>
CC: chet.ramey@case.edu

....
I gave up on usenet a couple of years ago and haven't really looked back.
It's like sports talk radio -- you feel smarter for not having read it.

And another one:

Date: Thu, 11 Jun 2015 09:00:56 -0400
From: Chet Ramey <chet.ramey@case.edu>

My memory was imperfect.  Back in June 2009, I wrote:

"That's the nice thing about open source, right?  You can take your ball
and run to another section of the playground.  Then, if you like mixing
metaphors, you can throw rocks from there."
@end ignore

@quotation æç¤º
å¾ˆå¤šçš„ GNU/Linux ä»¥åŠä¸åŒçš„åŸºäº BSD çš„æ“ä½œç³»ç»Ÿå‘å¸ƒç‰ˆæœ‰ä»–ä»¬è‡ªå·±çš„ Bug æŠ¥å‘Šç³»ç»Ÿã€‚å¦‚æœä½ ä½¿ç”¨è¿™äº›å‘å¸ƒç‰ˆçš„ Bug æŠ¥å‘Šç³»ç»Ÿï¼Œä½ ä¹Ÿè¦å‘é€ä¸€ä¸ªå¤æœ¬åˆ° @EMAIL{bug-gawk@@gnu.org,bug-gawk at gnu dot org}ã€‚

è¿™æœ‰ä¸¤ä¸ªåŸå› ã€‚é¦–å…ˆï¼Œå°½ç®¡ä¸€äº›å‘å¸ƒç‰ˆæœ¬å°† Bug æŠ¥å‘Šæ¨é€åˆ° GNU é‚®ä»¶åˆ—è¡¨ï¼Œä½†æ˜¯å¾ˆå¤šçš„éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥å¾ˆæœ‰å¯èƒ½ @command{gawk} çš„ç»´æŠ¤è€…å¾ˆæœ‰å¯èƒ½çœ‹ä¸åˆ°ä½ çš„æŠ¥å‘Šã€‚å…¶æ¬¡ï¼Œå‘é€åˆ° GNU é‚®ä»¶åˆ—è¡¨çš„é‚®ä»¶ä¼šè¢«å½’æ¡£ï¼Œå°†æ‰€æœ‰çš„å…³ä¸œè¥¿éƒ½æ”¾åœ¨ GNU é¡¹ç›®ä¸­ï¼Œä½¿å¾—å…¶æ˜¯è‡ªè¯´æ˜çš„ï¼Œè€Œä¸ä¾èµ–äºå…¶ä»–çš„ç»„ç»‡ã€‚
@end quotation

é Bug å»ºè®®ä¹Ÿæ˜¯å—æ¬¢è¿çš„ã€‚å¦‚æœä½ çœ‹åˆ°æ–‡æ¡£ä¸­çš„ä¸œè¥¿è¯´æ˜ä¸æ¸…ï¼Œæˆ–è€…ä¸ç†è§£å…¶ä¸­çš„ç‰¹æ€§ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ Bug åˆ—è¡¨ä¸­è¿›è¡Œæé—®ï¼Œæˆ‘ä»¬ä¼šå°½å¯èƒ½åœ°å¸®åŠ©ä½ ã€‚

å¦‚æœä½ åœ¨ä¸€ä¸ªé Unix ç§»æ¤ç‰ˆæœ¬ä¸­å‘ç° Bug ï¼Œä¹Ÿå°†é‚®ä»¶å‘é€åˆ° Bug åˆ—è¡¨ï¼Œå¹¶æŠ„é€ç»™ç»´æŠ¤è¿™ä¸ªç§»æ¤ç‰ˆæœ¬çš„äººã€‚ç»´æŠ¤è€…åœ¨ä¸‹é¢åœ¨çš„åˆ—è¡¨ä¸­ï¼Œä¹Ÿå­˜ @command{gawk} å‘å¸ƒç‰ˆä¸­çš„ @file{README} æ–‡ä»¶é‡Œã€‚@file{README} æ–‡ä»¶ä¸­çš„ä¿¡æ¯å¦‚æœä¸æœ¬@value{DOCUMENT}ä¸­çš„æœ‰å†²çªï¼Œé‚£é‡Œçš„ä¿¡æ¯ä¼šæ›´åŠ æƒå¨ã€‚

ç»´æŠ¤ä¸åŒçš„ç§»æ¤ç‰ˆæœ¬çš„äººå¦‚ä¸‹ï¼š

@c put the index entries outside the table, for docbook
@cindex Buening, Andreas
@cindex Deifik, Scott
@cindex Malmberg, John
@cindex Pitts, Dave
@cindex G., Daniel Richard
@cindex Robbins, Arnold
@cindex Zaretskii, Eli
@multitable {MS-Windows with MinGW} {123456789012345678901234567890123456789001234567890}
@item Unix and POSIX systems @tab Arnold Robbins, @EMAIL{arnold@@skeeve.com,arnold at skeeve dot com}

@c @item MS-DOS with DJGPP @tab Scott Deifik, @EMAIL{scottd.mail@@sbcglobal.net,scottd dot mail at sbcglobal dot net}

@item MS-Windows with MinGW @tab Eli Zaretskii, @EMAIL{eliz@@gnu.org,eliz at gnu dot org}

@c Leave this in the print version on purpose.
@c OS/2 is not mentioned anywhere else in the print version though.
@item OS/2 @tab Andreas Buening, @EMAIL{andreas.buening@@nexgo.de,andreas dot buening at nexgo dot de}

@item VMS @tab John Malmberg, @EMAIL{wb8tyw@@qsl.net,wb8tyw at qsl.net}

@item z/OS (OS/390) @tab Daniel Richard G.@: @EMAIL{skunk@@iSKUNK.ORG,skunk at iSKUNK.ORG}
@item  @tab Dave Pitts (Maintainer Emeritus), @EMAIL{dpitts@@cozx.com,dpitts at cozx dot com}
@end multitable

å¦‚æœ Bug åœ¨ Unix ä¸‹ä¹Ÿæ˜¯å¯é‡ç°çš„ï¼Œä¹ŸæŠ„é€ä¸€ä»½æŠ¥å‘Šç»™ @EMAIL{bug-gawk@@gnu.org,bug-gawk at gnu dot org} é‚®ä»¶åˆ—è¡¨ã€‚

DJGPP ç«¯å£ä¸å†æ”¯æŒï¼›å®ƒä»ä¼šåœ¨ä»£ç åº“ä¸­ä¸€æ®µæ—¶é—´ï¼Œä»¥é˜²æœ‰å¿—æ„¿è€…æ„¿æ„æ¥ç®¡å®ƒã€‚å¦‚æœæ²¡äººæ„¿æ„æ¥ç®¡ï¼Œæœ€ç»ˆè¿™ä¸ªç«¯å£çš„ä»£ç ä¼šè¢«åˆ é™¤ã€‚

@node Other Versions
@appendixsec å…¶ä»–å¯è‡ªç”±è·å–çš„ @command{awk}
@cindex @command{awk}, implementations
@ignore
From: emory!amc.com!brennan (Michael Brennan)
Subject: C++ comments in awk programs
To: arnold@gnu.ai.mit.edu (Arnold Robbins)
Date: Wed, 4 Sep 1996 08:11:48 -0700 (PDT)

@end ignore
@cindex Brennan, Michael
@ifnotdocbook
@quotation
@i{å¦‚æœåœ¨ @command{awk} ä»£ç ä¸­è¿™æ ·æ¥è¾“å…¥æ³¨é‡Šå°±æœ‰å‘³äº†ï¼š}@*
@ @ @ @ @ @ @code{// C++ ç±»å‹çš„æ³¨é‡Šå¯ç”¨ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯ï¼šå½“ç„¶å¯ä»¥å•¦ã€‚}
@author Michael Brennan
@end quotation
@end ifnotdocbook

@docbook
<blockquote><attribution>Michael Brennan</attribution>
<literallayout><emphasis>å¦‚æœåœ¨ @command{awk} ä»£ç ä¸­è¿™æ ·æ¥è¾“å…¥æ³¨é‡Šå°±æœ‰å‘³äº†ã€‚</emphasis>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<literal>// C++ ç±»å‹çš„æ³¨é‡Šå¯ç”¨ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯ï¼šå½“ç„¶å¯ä»¥å•¦ã€‚</literal></literallayout>
</blockquote>
@end docbook

è¿˜æœ‰å¾ˆå¤šçš„å¯ä»¥å…è´¹è·å–çš„ @command{awk} å®ç°ç‰ˆæœ¬ï¼Œè¿™ä¸€@value{SECTION}ç®€å•åœ°è¿›è¡Œè¯´æ˜å¦‚ä½•æ¥è·å–å®ƒä»¬ï¼š

@table @asis
@cindex Kernighan, Brian
@cindex source code, Brian Kernighan's @command{awk}
@cindex @command{awk}, versions of, See Also Brian Kernighan's @command{awk}
@cindex Brian Kernighan's @command{awk}, source code
@item Unix @command{awk}
Brian Kernighan æ˜¯ Unix @command{awk} çš„æœ€åˆè®¾è®¡è€…ï¼Œå°†ä»–è‡ªå·±çš„ @command{awk} å¼€å‘å‡ºæ¥äº†ã€‚
ä½ å¯ä»¥é€šè¿‡@uref{http://www.cs.princeton.edu/~bwk, ä»–çš„ä¸»é¡µ}æ¥è·å–ï¼Œå¯ä»¥æœ‰å‡ ç§æ–‡æ¡£æ ¼å¼ï¼š

@table @asis
@item Shell archive
@uref{http://www.cs.princeton.edu/~bwk/btl.mirror/awk.shar}

@item Compressed @command{tar} file
@uref{http://www.cs.princeton.edu/~bwk/btl.mirror/awk.tar.gz}

@item Zip file
@uref{http://www.cs.princeton.edu/~bwk/btl.mirror/awk.zip}
@end table

@cindex @command{git} utility
ä½ ä¹Ÿå¯ä»¥ä» GitHub ä¸Šå–å¾—ï¼š

@example
git clone git://github.com/onetrueawk/awk bwkawk
@end example

@noindent
è¿™ä¸ªå‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªåä¸º @file{bwkawk} çš„ @uref{http://git-scm.com, Git} åº“çš„å¤æœ¬ã€‚å¦‚æœä½ å°†è¿™ä¸ªå‚æ•°åœ¨ @command{git} å‘½ä»¤é‡Œçœç•¥ï¼Œåˆ™ @command{git} åº“çš„å¤æœ¬ä¼šåˆ›å»ºåœ¨åå­—ä¸º @file{awk} çš„ç›®å½•ä¸­ã€‚

è¿™ä¸ªç‰ˆæœ¬éœ€è¦ ISO Cï¼ˆ1990 æ ‡å‡†ï¼‰çš„ç¼–è¯‘å™¨ï¼Œæ¥è‡ªäº GCCï¼ˆGNU Compiler Collectionï¼‰çš„ C ç¼–è¯‘å™¨å¯ä»¥å·¥ä½œå¾—å¾ˆå¥½ã€‚

æŸ¥çœ‹ @ref{Common Extensions}ï¼Œæ¥è·å–è¿™ä¸ª @command{awk} æ‰©å±•åˆ—è¡¨ï¼Œè¿™äº›æ‰©å±•ä¸åœ¨ POSIX @command{awk} ä¸­ã€‚

å¦å¤–ï¼ŒDan Bornstein åˆ›å»ºäº†ä¸€ä¸ª Git ä»“åº“ï¼Œè¿½è¸ªäº†æ‰€æœ‰ä»–èƒ½æ‰¾åˆ°çš„ BWK @command{awk} ç‰ˆæœ¬ã€‚åœ¨ @uref{git://github.com/danfuzz/one-true-awk} å¯ä»¥è®¿é—®ã€‚

@cindex Brennan, Michael
@cindex @command{mawk} utility
@cindex source code, @command{mawk}
@item @command{mawk}
Michael Brennan å®ç°äº†ä¸€ä¸ªç‹¬ç«‹çš„ @command{awk}ï¼Œç§°ä¸º @command{mawk}ã€‚
è¿™å¯ä»¥ä»¥
@ifclear FOR_PRINT
GPL (@pxref{Copying}),
@end ifclear
@ifset FOR_PRINT
GPL,
@end ifset
çš„æ–¹å¼è·å–ï¼Œå¦‚ @command{gawk} ä¸€æ ·ã€‚

@command{mawk} æºä»£ç çš„æœ€åˆçš„å‘å¸ƒåœ°å€ä¸­å·²ç»ä¸å†æœ‰ @command{mawk}ï¼Œå¯ä»¥åœ¨ @uref{http://www.skeeve.com/gawk/mawk1.3.3.tar.gz} å–å¾—ã€‚

2009 å¹´ï¼ŒThomas Dickey è´Ÿè´£èµ· @command{mawk} çš„ç»´æŠ¤å·¥ä½œã€‚åŸºæœ¬çš„ä¿¡æ¯å¯ä»¥åœ¨@uref{http://www.invisible-island.net/mawk, å®ƒçš„é¡¹ç›®ç½‘ç«™}ä¸­å¯ä»¥å¾—åˆ°ã€‚
ä¸‹è½½åœ°å€ä¸º @url{http://invisible-island.net/datafiles/release/mawk.tar.gz}ã€‚

ä¸€æ—¦å–å¾—åï¼Œç”¨ @command{gunzip} æ¥è§£å‹è¿™ä¸ªæ–‡ä»¶ã€‚å®‰è£…ä¸ @command{gawk} çš„ç›¸åŒï¼ˆæŸ¥çœ‹ @pxref{Unix Installation}ï¼‰ã€‚

æŸ¥çœ‹ @ref{Common Extensions}ï¼Œè·å–ä¸åœ¨ POSIX @command{awk} ä¸­çš„ @command{mawk} æ‰©å±•åˆ—è¡¨ã€‚

@cindex Sumner, Andrew
@cindex @command{awka} compiler for @command{awk}
@cindex source code, @command{awka}
@item @command{awka}
ç”± Andrew Sumner ç¼–å†™ï¼Œ@command{awka} å°† @command{awk} ç¨‹åºè½¬æ¢ä¸º C ç¨‹åºï¼Œç„¶åç¼–è¯‘ï¼Œå°†ä»–ä»¬ä¸æä¾›äº† @command{awk} æ ¸å¿ƒåŠŸèƒ½çš„åº“è¿›è¡Œè¿æ¥ã€‚å®ƒä¹Ÿæœ‰å¾ˆå¤šçš„æ‰©å±•ã€‚

@command{awk} ç¿»è¯‘å™¨ä¹Ÿåœ¨ GPL è®¸å¯ä¸‹å‘å¸ƒï¼Œè€Œåº“åˆ™åœ¨ LGPL ä¸‹å‘å¸ƒã€‚

è¦è·å– @command{awka}ï¼Œè¯·è¿›å…¥ @url{http://sourceforge.net/projects/awka}ã€‚
@c You can reach Andrew Sumner at @email{andrew@@zbcom.net}.
@c andrewsumner@@yahoo.net

é¡¹ç›®çœ‹èµ·æ¥å·²ç»å†»ç»“èµ·æ¥äº†ï¼Œä» 2001 å¹´èµ·å¥½åƒå°±æ²¡æœ‰æ–°ä»£ç çš„å˜åŠ¨äº†ã€‚

@cindex Beebe, Nelson H.F.@:
@cindex @command{pawk} (profiling version of Brian Kernighan's @command{awk})
@cindex source code, @command{pawk}
@item @command{pawk}
Utah å¤§å­¦çš„ Nelson H.F.@: Beebe ä¿®æ”¹äº† BWK @command{awk} æ¥æä¾›è®¡æ—¶ä¸é‡‡æ ·ä¿¡æ¯ã€‚å®ƒä¸ @command{gawk} çš„ @option{--profile} ï¼ˆæŸ¥çœ‹ @pxref{Profiling}ï¼‰æ˜¯ä¸åŒçš„ï¼Œå…¶ä¸åŒåœ¨äº @code{pawk} ä¸­ä½¿ç”¨çš„æ˜¯åŸºäº CPU çš„é‡‡æ ·ï¼Œè€Œä¸æ˜¯åŸºäºè¡Œçš„é‡‡æ ·ã€‚
ä½ å¯ä»¥åœ¨ @uref{ftp://ftp.math.utah.edu/pub/pawk/pawk-20030606.tar.gz} æˆ–è€… @uref{http://www.math.utah.edu/pub/pawk/pawk-20030606.tar.gz} æ¥è·å–ã€‚

@item BusyBox @command{awk}
@cindex BusyBox Awk
@cindex source code, BusyBox Awk
BusyBox æ˜¯ä¸€ä¸ª GPL æˆæƒçš„ç¨‹åºï¼Œåœ¨å•ç‹¬çš„æ‰§è¡Œä½“ä¸­æä¾›äº†å¾ˆå¤šåº”ç”¨çš„å°ç‰ˆæœ¬ã€‚å…¶ç›®æ ‡æ˜¯åµŒå…¥å¼ç³»ç»Ÿã€‚å®ƒåŒ…å«äº† POSIX @command{awk} çš„å®Œæ•´å®ç°ã€‚
å½“æ„å»ºæ—¶ï¼Œä¸è¦ä½¿ç”¨ @samp{make install}ï¼Œå› ä¸ºå®ƒä¼šè¦†ç›– @file{/usr/local/bin} ç›®å½•ä¸‹çš„å…¶ä»–å¤æœ¬ç¨‹åºã€‚
å¯ä»¥æµè§ˆ@uref{http://busybox.net, å®ƒçš„ä¸»é¡µ}æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚

@cindex OpenSolaris
@cindex Solaris, POSIX-compliant @command{awk}
@cindex source code, Solaris @command{awk}
@item The OpenSolaris POSIX @command{awk}
åœ¨ Solaris ç³»ç»Ÿä¸­ @file{/usr/xpg4/bin} ä¸ @file{/usr/xpg6/bin} ä¸‹çš„ @command{awk} å¤šå¤šå°‘å°‘ä¸ POSIX æ˜¯å…¼å®¹çš„ã€‚å®ƒä»¬æ˜¯åŸºäº PC ç‰ˆçš„ Mortice Kern Systems ä¸­çš„ @command{awk} ç‰ˆæœ¬ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ GNU/Linux ä¸‹ç”¨ä¸€ä¸¤ä¸ªå°æ—¶æ¥ç¼–è¯‘å®ƒçš„æºä»£ç ã€‚è¦å°†å®ƒå¼„å¾—æ›´å¯ç§»æ¤ï¼ˆä½¿ç”¨ GNU Autoconf ä¸/æˆ– Automakeï¼‰éœ€è¦å¾ˆå¤šçš„å·¥ä½œï¼Œè€Œä¸”è¿˜æ²¡æœ‰å®Œæˆï¼Œè‡³å°‘ä»¥æˆ‘ä»¬ç°æœ‰çš„äº†è§£çœ‹æ¥æ˜¯è¿™æ ·çš„ã€‚

@cindex Illumos
@cindex Illumos, POSIX-compliant @command{awk}
@cindex source code, Illumos @command{awk}
å®ƒçš„æºä»£ç è¿‡å»åœ¨ OpenSolaris ç«™ç‚¹é‡Œã€‚ä½†æ˜¯ï¼Œé‚£ä¸ªé¡¹ç›®å·²ç»ç»“æŸï¼Œç½‘ç«™å·²ç»å…³é—­ã€‚å¹¸è¿çš„æ˜¯ @uref{http://wiki.illumos.org/display/illumos/illumos+Home, Illumos project} é¡¹ç›®è®©è¿™ä¸ªå®ç°å†æ¬¡å¯ç”¨ã€‚
ä½ å¯ä»¥è®¿é—® @uref{https://github.com/joyent/illumos-joyent/blob/master/usr/src/cmd/awk_xpg4} æ¥æŸ¥çœ‹å…¶ä¸­çš„æ–‡ä»¶ã€‚

@cindex @command{jawk}
@cindex Java implementation of @command{awk}
@cindex source code, @command{jawk}
@item @command{jawk}
è¿™æ˜¯ç”¨ Java å†™çš„ @command{awk} è§£é‡Šå™¨ã€‚å®ƒå£°ç§°å®Œå…¨æ˜¯è§£é‡Šå™¨ï¼Œå°½ç®¡å› ä¸ºå®ƒä½¿ç”¨ @code{Java} çš„å·¥å…·æ¥è¿›è¡Œ I/O ä»¥åŠæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œå®ƒæ‰€æ”¯æŒçš„è¯­è¨€ä¸ POSIX @command{awk} æ˜¯ä¸åŒçš„ã€‚å¯ä»¥åœ¨@uref{http://jawk.sourceforge.net, ç½‘é¡µ}ä¸Šè·å–æ›´å¤šçš„ä¿¡æ¯ã€‚

@item Libmawk
@cindex libmawk
@cindex source code, libmawk
è¿™æ˜¯å¯åµŒå…¥çš„ @command{awk} è§£é‡Šå™¨ï¼Œæ¥è‡ªäº @command{mawk}ã€‚è¦äº†è§£ä¿¡æ¯ï¼Œè¯·æµè§ˆ @uref{http://repo.hu/projects/libmawk/}ã€‚

@item @code{pawk}
@cindex source code, @command{pawk} (Python version)
@cindex @code{pawk}, @command{awk}-like facilities for Python
è¿™æ˜¯ä¸€ä¸ª Python æ¨¡å¼ï¼Œå®ƒå£°ç§°å°† @command{awk} ç±»ä¼¼çš„ç‰¹æ€§åŠ å…¥åˆ° Python ä¸­ã€‚æŸ¥çœ‹ @uref{https://github.com/alecthomas/pawk} æ¥è·å–æ›´å¤šä¿¡æ¯ï¼ˆè¿™ä¸ªä¸æ—©å‰æ‰€è¯´çš„ Nelson Beebe çš„ BWK @command{awk} ç‰ˆæœ¬æ²¡æœ‰å…³ç³»ã€‚ï¼‰

@item @w{QSE @command{awk}}
@cindex QSE @command{awk}
@cindex source code, QSE @command{awk}
è¿™æ˜¯ä¸€ä¸ªå¯åµŒå…¥çš„ @command{awk} è§£é‡Šå™¨ã€‚æ›´å¤šæˆ‘ä¿¡æ¯è¯·çœ‹ @uref{http://code.google.com/p/qse/} ä»¥åŠ @uref{http://awk.info/?tools/qse}ã€‚

@item @command{QTawk}
@cindex QuikTrim Awk
@cindex source code, QuikTrim Awk
è¿™ä¸ªæ˜¯ç‹¬ç«‹å®ç°çš„ï¼Œåœ¨ GPL è®¸å¯ä¸‹å‘å¸ƒçš„ @command{awk}ã€‚å®ƒæœ‰æ¯”æ ‡å‡† @command{awk} å¤šå¾—å¤šçš„æ‰©å±•ï¼Œæœ‰å¯èƒ½å¹¶ä¸æ˜¯ 100% ä¸ @command{awk} è¯­æ³•å…¼å®¹ã€‚æŸ¥çœ‹ @uref{http://www.quiktrim.org/qtawk.html} è·å–æ›´å¤šä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬æ‰‹å†Œã€‚
é‡Œé¢çš„ä¸‹è½½é“¾æ¥å·²ç»è¿‡æ—¶äº†ï¼›æŸ¥çœ‹ @uref{http://www.quiktrim.org/#AdditionalResources} è·å–æœ€æ–°çš„ä¸‹è½½é“¾æ¥ã€‚

è¿™ä¸ªé¡¹ç›®å¯èƒ½ä¹Ÿå·²ç»å†»ç»“äº†ï¼Œä»å¤§çº¦ 2014 å¹´èµ·ï¼Œå°±æ²¡æœ‰æ–°ä»£ç å˜æ›´äº†ã€‚

@item Other versions
æŸ¥çœ‹ @uref{http://en.wikipedia.org/wiki/Awk_language#Versions_and_implementations,
Wikipedia article} ä¸­çš„ â€œVersions and implementationsâ€ èŠ‚æ¥è·å–å…¶ä»–ç‰ˆæœ¬çš„ä¿¡æ¯ã€‚

@end table

@node Installation summary
@appendixsec æ€»ç»“

@itemize @value{BULLET}
@item
@command{gawk} å‘å¸ƒç‰ˆæœ¬å¯ä»¥ä» GNU é¡¹ç›®çš„ä¸»å‘å¸ƒç«™ç‚¹ @code{ftp.gnu.org} è·å–åˆ°ã€‚æ­£è§„çš„æ„å»ºè¿‡ç¨‹æ˜¯ï¼š

@example
wget http://ftp.gnu.org/gnu/gawk/gawk-@value{VERSION}.@value{PATCHLEVEL}.tar.gz
tar -xvpzf gawk-@value{VERSION}.@value{PATCHLEVEL}.tar.gz
cd gawk-@value{VERSION}.@value{PATCHLEVEL}
./configure && make && make check
@end example

@item
@command{gawk} å¯ä»¥æ„å»ºåœ¨é POSIX ç³»ç»Ÿä¸Šã€‚å½“å‰æ”¯æŒçš„ç³»ç»ŸåŒ…å«ä½¿ç”¨ DJGPPï¼ŒMSYSï¼ŒMinGW ä»¥åŠ Cygwin çš„ MS-Windowsï¼Œ
@ifclear FOR_PRINT
ä½¿ç”¨ EMX çš„ OS/2ï¼Œ
@end ifclear
ä»¥åŠ @code{Vax}/VMS ä¸ OpenVMSã€‚åœ¨ç›¸åº”ç³»ç»Ÿä¸Šçš„æŒ‡å¯¼ä¹Ÿåœ¨è¿™ä¸ª@value{APPENDIX}ä¸­äº†ã€‚

@item
Bug æŠ¥å‘Šåº”è¯¥é€šè¿‡é‚®ä»¶å‘é€ç»™ @email{bug-gawk@@gnu.org}ã€‚Bug æŠ¥å‘Šåº”è¯¥ä½¿ç”¨è‹±è¯­ï¼Œå¹¶åŒ…å« @command{gawk} çš„ç‰ˆæœ¬ï¼Œå¦‚ä½•è¿›è¡Œç¼–è¯‘çš„ï¼Œä»¥åŠä¸€ä¸ªçŸ­ç¨‹åºä¸@value{DF}æ¥è¯´æ˜å…¶ä¸­çš„é—®é¢˜ã€‚

@item
å¾ˆå¤šçš„çš„è‡ªç”±è·å– @command{awk} å®ç°ï¼Œå¾ˆå¤šä¸ POSIX å…¼å®¹ï¼Œæœ‰çš„åˆ™å…¼å®¹å¾—è¾ƒå°‘ã€‚

@end itemize


@ifclear FOR_PRINT
@node Notes
@appendix å®ç°æç¤º
@cindex @command{gawk}, implementation issues
@cindex implementation issues, @command{gawk}

è¿™ä¸ªé™„å½•ä¸­åŒ…å«äº†ä¸»å¯¹æ˜¯ @command{gawk} çš„å®ç°ä¸ç»´æŠ¤è€…æ„Ÿå…´è¶£çš„å†…å®¹ã€‚é‡Œé¢çš„ä¸œè¥¿éƒ½åªé’ˆå¯¹ @command{gawk} è€Œä¸æ˜¯å…¶ä»–çš„å®ç°ã€‚

@menu
* Compatibility Mode::          How to disable certain @command{gawk}
                                extensions.
* Additions::                   Making Additions To @command{gawk}.
* Future Extensions::           New features that may be implemented one day.
* Implementation Limitations::  Some limitations of the implementation.
* Extension Design::            Design notes about the extension API.
* Old Extension Mechanism::     Some compatibility for old extensions.
* Notes summary::               Summary of implementation notes.
@end menu

@node Compatibility Mode
@appendixsec åå‘å…¼å®¹ä¸è°ƒè¯• 
@cindex @command{gawk}, implementation issues, downward compatibility
@cindex @command{gawk}, implementation issues, debugging
@cindex troubleshooting, @command{gawk}
@cindex implementation issues@comma{} @command{gawk}, debugging

æŸ¥çœ‹ @ref{POSIX/GNU}ï¼Œæ¥è·å– GNU å¯¹äº @command{awk} è¯­è¨€ä¸ç¨‹åºçš„æ‰©å±•çš„æ¦‚å†µã€‚æ‰€æœ‰çš„è¿™äº›ç‰¹æ€§éƒ½å¯ä»¥é€šè¿‡ä»¥ @option{--traditional} æˆ–è€… @option{--posix} é€‰é¡¹æ¥è°ƒç”¨ @command{gawk} è€Œè¿›è¡Œå…³é—­ã€‚

å¦‚æœ @command{gawk} æ˜¯ä½¿ç”¨ @samp{-DDEBUG} è¿›è¡Œç¼–è¯‘çš„ï¼Œåˆ™ä¼šåœ¨å‘½ä»¤è¡Œä¸Šæœ‰é¢å¤–çš„ä¸€ä¸ªå¯ç”¨çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼š

@table @code
@item -Y
@itemx --parsedebug
å¦‚æœç¨‹åºæ­£åœ¨è¢«åˆ†ææ—¶ï¼Œåˆ™æ‰“å°å‡ºåˆ†ææ ˆä¿¡æ¯ã€‚
@end table

è¿™ä¸ªé€‰é¡¹çš„ç›®çš„ä»…ç”¨äºå¾ˆæ­£å¼çš„ @command{gawk} å¼€å‘è€…ï¼Œè€Œä¸ç”¨äºæ™®é€šç”¨æˆ·ã€‚æœ‰å¯èƒ½éƒ½æ²¡æœ‰ç¼–è¯‘è¿›ä½ çš„ @command{gawk} ç‰ˆæœ¬ï¼Œå› æ­¤å®ƒä¼šé™ä½æ‰§è¡Œçš„é€Ÿåº¦ã€‚

@node Additions
@appendixsec @command{gawk} æ·»åŠ åŠŸèƒ½

å¦‚æœä½ å‘ç°ä½ æƒ³ä»¥ä¸€ç§ç‰¹åˆ«çš„æ–¹å¼å¢å¼º @command{gawk}ï¼Œé‚£éšæ„å¥½äº†ã€‚é‚£æ­£æ˜¯è‡ªç”±è½¯ä»¶çš„ç›®çš„ï¼Œæºä»£ç æ˜¯å¯ä»¥è·å–çš„ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‰ä½ çš„æ–¹å¼æ¥æ”¹å˜ï¼ˆæŸ¥çœ‹ @pxref{Copying}ï¼‰ã€‚

è¿™ä¸€@value{SECTION}è®¨è®ºä½ æ›´æ”¹ @command{gawk} çš„æ–¹å¼ä»¥åŠéœ€è¦ä½ åŒæ—¶è®°ä½çš„ä¸€äº›ç‚¹ã€‚

@menu
* Accessing The Source::        Accessing the Git repository.
* Adding Code::                 Adding code to the main body of
                                @command{gawk}.
* New Ports::                   Porting @command{gawk} to a new operating
                                system.
* Derived Files::               Why derived files are kept in the Git
                                repository.
@end menu

@node Accessing The Source
@appendixsubsec è®¿é—® @command{gawk} çš„ Git ä»“åº“ 

å› ä¸º @command{gawk} æ˜¯ä¸€ä¸ªå…è´¹è½¯ä»¶ï¼Œæ€»æ˜¯å¯ä»¥è·å–åˆ°å®ƒçš„æºä»£ç ã€‚@ref{Gawk Distribution}ï¼Œä¸­æè¿°äº†å¦‚ä½•æ¥è·å–åŠæ„å»º @command{gawk} å‘å¸ƒç‰ˆæœ¬ã€‚

@cindex @command{git} utility
ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³ä¿®æ”¹ @command{gawk} å¹¶ä¸”å°†è¿™äº›ä¿®æ”¹å‘å¸ƒï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨å¼€å‘ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œä½ éœ€è¦è®¿é—® @command{gawk} çš„æºä»£ç åº“ã€‚ä»£ç æ˜¯ä½¿ç”¨ @uref{http://git-scm.com, Git åˆ†å¸ƒå¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ} æ¥è¿›è¡Œç»´æŠ¤çš„ã€‚å¦‚æœä½ çš„ç³»ç»Ÿä¸Šæ²¡æœ‰ï¼Œåˆ™å…ˆéœ€è¦å®‰è£…å®ƒã€‚å®Œæˆåï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š

@example
git clone git://git.savannah.gnu.org/gawk.git
@end example

@noindent
è¿™ä¸ªå¤åˆ¶ @command{gawk} çš„åº“ã€‚å¦‚æœä½ åœ¨é˜²ç«å¢™åé¢ï¼Œè€Œä¸è®¸ä½¿ç”¨ Git çš„æœ¬åœ°åè®®ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ¥è®¿é—®åº“ï¼š

@example
git clone http://git.savannah.gnu.org/r/gawk.git
@end example

ä¸€æ—¦ä½ åšäº†ä¿®æ”¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ @samp{git diff} æ¥äº§ç”Ÿä¸€ä¸ª patchï¼Œç„¶åå‘é€ç»™ @command{gawk} çš„ç»´æŠ¤è€…ï¼ŒæŸ¥çœ‹ @ref{Bugs}ï¼Œæ¥è·å–å¦‚ä½•åšã€‚

ä¹‹å‰æœ‰ä¸€æ®µæ—¶é—´æœ‰ Git--CVS ç½‘å…³å¯ä»¥è¢«é‚£äº›æ²¡æœ‰å®‰è£…çš„ Git çš„äººä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªç½‘å…³å·²ç»ä¸å†å·¥ä½œäº†ï¼Œå› æ­¤ä½ æœ€å¥½ä¸€äº›æ›´åŠ ç°ä»£çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¦‚ Bazaarï¼Œå®ƒæœ‰ä¸€ä¸ª Git æ’ä»¶å¯ä»¥ç”¨äº Git åº“ã€‚

@node Adding Code
@appendixsubsec æ·»åŠ æ–°ç‰¹æ€§

@cindex adding, features to @command{gawk}
@cindex features, adding to @command{gawk}
@cindex @command{gawk}, features, adding
ä½ å¯ä»¥è‡ªç”±åœ°å°†æ–°ç‰¹æ€§åŠ å…¥åˆ° @command{gawk} ä¸­ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³å°†ä½ çš„æ”¹å˜åŠ å…¥åˆ° @command{gawk} å‘å¸ƒç‰ˆä¸­ï¼Œæœ‰å‡ ä¸ªæ­¥éª¤å¯ä»¥è®©ä½ æœ‰å¯èƒ½å°†å®ƒä»¬åŠ å…¥åˆ° @command{gawk} ä¸­ï¼š

@enumerate 1
@item
åœ¨æ„å»ºæ–°çš„ç‰¹æ€§åˆ° @command{gawk} å‰ï¼Œå…ˆè€ƒè™‘å°†å…¶å†™æˆä¸€ä¸ªæ‰©å±•ï¼ˆæŸ¥çœ‹ @pxref{Dynamic Extensions}ï¼‰ã€‚å¦‚æœä¸å¯èƒ½ï¼Œåˆ™å¾€ä¸‹èµ°ã€‚

@item
å‡†å¤‡ç­¾ç½²åˆé€‚çš„åè®®ã€‚ä¸ºäº†è®© FSF èƒ½å¤Ÿå‘å¸ƒä½ çš„ä¿®æ”¹ï¼Œä½ å¿…é¡»è¦ä¹ˆå°†è¿™äº›ä¿®æ”¹å‘å¸ƒåˆ°å…¬å…±åŸŸé‡Œï¼Œå¹¶æäº¤ä¸€ä¸ªç­¾ç½²æœ‰ç›¸åŒæ•ˆæœçš„åè®®ï¼Œæˆ–è€…å°†ç‰ˆæœ¬èµ‹ç»™ FSFã€‚è¿™ä¸¤ä¸ªåšæ³•éƒ½æ˜¯å¾ˆå®¹æ˜“å®Œæˆçš„ï¼Œ@emph{å¾ˆå¤š}çš„äººéƒ½å·²ç»è¿™ä¹ˆåšäº†ã€‚å¦‚æœæœ‰é—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ï¼ˆæŸ¥çœ‹ @pxref{Bugs}ï¼‰ï¼Œæˆ–è€…æ˜¯ @EMAIL{assign@@gnu.org,assign at gnu dot org}ã€‚

@item
è·å–æœ€æ–°ç‰ˆæœ¬ã€‚
å¯¹æˆ‘è€Œè¨€ï¼Œå¦‚æœè¿™äº›æ›´æ”¹ç›¸å…³äºæœ€æ–°çš„ @command{gawk} ç‰ˆæœ¬è€Œå˜ï¼Œæˆ‘å°±å¾ˆå®¹æ˜“è¿›è¡Œåˆå¹¶ã€‚æœ€å¥½çš„æ˜¯ï¼Œä½ çš„æ›´æ”¹æ˜¯ç›¸å¯¹äº Git åº“çš„æœ€æ–°ä»£ç ã€‚å¦‚æœä½ çš„ @command{gawk} ç‰ˆæœ¬éå¸¸è€ï¼Œæˆ‘å°±æ ¹æœ¬æ²¡æ³•å°†å®ƒä»¬åˆå¹¶äº†ã€‚ï¼ˆæŸ¥çœ‹ @ref{Getting}ï¼Œæ¥äº†è§£å¦‚ä½•è·å–æœ€æ–°çš„ @command{gawk} ç‰ˆæœ¬ã€‚ï¼‰

@item
@ifnotinfo
éµå®ˆ @cite{gnu coding standards} çš„ä»£ç æ ‡å‡†ã€‚
@end ifnotinfo
@ifinfo
æŸ¥çœ‹ @inforef{Top, , Version, standards, GNU Coding Standards}.
@end ifinfo
è¿™ä¸ªæ–‡æ¡£æè¿°å¦‚ä½•æ¥å†™ GNU è½¯ä»¶ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰è¯»è¿‡ï¼Œè¯·å…ˆè¯»ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¿®æ”¹ @command{gawk} @emph{ä¹‹å‰}ï¼ˆ@cite{GNU Coding Standards} å¯ä»¥ä» @uref{http://www.gnu.org/prep/standards/, GNU é¡¹ç›®çš„ç«™ç‚¹} ä¸Šè·å–ã€‚ä¹Ÿå¯ä»¥è·å–åˆ° Texinfoï¼ŒInfoï¼ŒDVI çš„ç‰ˆæœ¬ã€‚ï¼‰

@cindex @command{gawk}, coding style in
@item
ä½¿ç”¨ @command{gawk} ç¼–ç é£æ ¼ã€‚
@command{gawk} çš„ C ä»£ç éµå®ˆ GNU ç¼–è¯‘æ ‡å‡†ä¸­çš„æŒ‡å¯¼ï¼Œåªæœ‰ä¸€äº›å°ä¾‹å¤–ã€‚ä»£ç ä½¿ç”¨ä¼ ç»Ÿçš„ â€œK&Râ€ é£æ ¼ï¼Œç‰¹åˆ«åœ¨æ›¿æ¢èŠ±æ‹¬å·ä»¥åŠ TABs çš„ä½¿ç”¨ä¸Šè¦æ³¨æ„ã€‚ç®€å•åœ°è¯´ï¼Œä»£ç è§„åˆ™å¦‚ä¸‹ï¼š

@itemize @value{BULLET}
@item
ä½¿ç”¨ ANSI/ISO é£æ ¼ï¼ˆåŸå‹ï¼‰å‡½æ•°æ¥å®šä¹‰å‡½æ•°ã€‚

@item
å°†å‡½æ•°æ”¾åœ¨ä¸€è¡Œçš„å‰é¢ã€‚

@item
ä½¿ç”¨ @samp{#elif} ä»£æ›¿ @samp{#else} ä¸­åµŒå¥—çš„ @samp{#if}ã€‚

@item
å°†å‡½æ•°çš„è¿”å›å€¼ï¼Œå³ä½¿æ˜¯ @code{int} æ”¾åœ¨æœ‰å‚æ•°çš„å‡½æ•°åå­—çš„ä¸Šä¸€è¡Œã€‚

@item
åœ¨æ§åˆ¶ç»“æ„ä¸æ‹¬å·ä¹‹é—´æ”¾ä¸€ä¸ªç©ºæ ¼ï¼ˆ@code{if}ï¼Œ@code{while}ï¼Œ@code{for}ï¼Œ@code{do}ï¼Œ@code{switch}ï¼Œ ä»¥åŠ @code{return}ï¼‰ã€‚

@item
åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¸è¦åœ¨æ‹¬å·ä¹‹å‰æ”¾ç©ºæ ¼ã€‚

@item
åœ¨æ‰€ä»¥çš„ C æ“ä½œç¬¦å‰åå’Œå‡½æ•°è°ƒç”¨ä¸­çš„é€—å·åï¼ŒåŠ ä¸Šç©ºæ ¼ã€‚

@item
ä¸è¦ä½¿ç”¨é€—å·æ“ä½œç¬¦æ¥äº§ç”Ÿå¤šç§å‰¯ä½œç”¨ï¼Œé™¤éåœ¨ @code{for} å¾ªç¯ä¸­åˆå§‹åŒ–ä¸é€’å¢çš„éƒ¨åˆ†ï¼Œä»¥åŠåœ¨å®å®šä¹‰é‡Œã€‚

@item
ä½¿ç”¨çœŸæ­£çš„ TABs æ¥è¿›è¡Œç¼©è¿›ï¼Œè€Œä¸æ˜¯ç©ºæ ¼ã€‚

@item
ä½¿ç”¨ â€œK&Râ€ é£æ ¼çš„èŠ±æ‹¬å·å¸ƒå±€é£æ ¼ã€‚

@item
åœ¨ @code{if}ï¼Œ@code{while}ï¼Œä»¥åŠ @code{for} è¯­å¥çš„æ¡ä»¶ä¸­ï¼Œä½¿ç”¨ä¸ @code{NULL} ä¸ @code{'\0'} çš„æ¯”è¾ƒï¼Œåœ¨ @code{switch} è¯­å¥ä¸­ä¹Ÿæ˜¯ä¸€æ ·ï¼Œè€Œä¸è¦ä½¿ç”¨å…‰æŒ‡é’ˆä¸å­—ç¬¦å€¼ã€‚

@item
ä½¿ç”¨ @code{true} ä¸ @code{false} æ¥ç”¨äº @code{bool} å€¼ï¼Œ@code{NULL} ç¬¦å·å¸¸é‡æ˜¯ç”¨äºæŒ‡é’ˆå€¼çš„ï¼Œè€Œå­—ç¬¦å¸¸é‡åˆ™ç”¨ @code{'\0'}ï¼Œè€Œä¸æ˜¯ @code{1} ä¸ @code{0}ã€‚

@item
å¯¹æ¯ä¸ªå‡½æ•°éƒ½æä¾›ä¸€è¡Œæè¿°æ€§çš„æ³¨é‡Šã€‚

@item
ä¸è¦ä½¿ç”¨ @code{alloca()} å‡½æ•°ç”¨è¿›è¡Œæ ˆå†…çš„å†…å­˜åˆ†é…ã€‚å®ƒçš„ä½¿ç”¨ä¼šå¯¼è‡´ç§»æ¤æ€§é—®é¢˜ï¼Œè€Œå¸¦æ¥çš„ä¸€ç‚¹å¥½å¤„å°±æ˜¯ä¸ç”¨è¿›è¡Œå†…å­˜é‡Šæ”¾ã€‚è¦ä½¿ç”¨ @code{malloc()} ä¸ @code{free()}ã€‚

@item
ä¸è¦ä½¿ç”¨ @samp{! strcmp(a, b)} ç±»ä¼¼çš„æ¯”è¾ƒã€‚Henry Spencer è¯´è¿‡ï¼Œâ€œ@code{strcmp()} ä¸æ˜¯å¸ƒå°”å€¼â€ï¼Œç›¸åï¼Œè¦ä½¿ç”¨ @samp{strcmp(a, b) == 0}ã€‚

@item
å¦‚æœæ·»åŠ äº†æ–°çš„ä½æ ‡å¿—å€¼ï¼Œè¦ä½¿ç”¨æ˜¾å¼çš„åå…­è¿›åˆ¶å¸¸é‡ï¼ˆ@code{0x001}, @code{0x002}, @code{0x004} ç­‰ç­‰ï¼‰ï¼Œè€Œä¸è¦ä½¿ç”¨å¯¹ 1 è¿›è¡Œè¿ç»­çš„å·¦ç§»ï¼ˆ@samp{(1<<0)}, @samp{(1<<1)} ç­‰ç­‰ï¼‰ã€‚
@end itemize

@quotation æç¤º
å¦‚æœæˆ‘è¦ä¿®æ”¹äº†ä½ çš„ä»£ç æ¥éµå®ˆ @command{gawk} ä¸­çš„ä»£ç é£æ ¼ï¼Œæ˜¯æˆ‘æ ¹æœ¬å°±ä¸ä¼šå°†ä½ çš„æ›´æ”¹æ•´åˆè¿›å»çš„ã€‚
@end quotation

@cindex Texinfo
@item
æ›´æ–°æ–‡æ¡£ã€‚
è·Ÿä½ çš„ä»£ç ä¸€èµ·ï¼Œè¯·æä¾›æ–°çš„ç« èŠ‚åˆ°æœ¬@value{DOCUMENT}ä¸­ã€‚å¦‚æœæœ‰å¯èƒ½ï¼Œè¯·ä½¿ç”¨çœŸæ­£çš„ Texinfoï¼Œè€Œä¸æ˜¯æä¾›ä¸€äº›æœªæ ¼å¼åŒ–çš„ ASCII æ–‡æœ¬ï¼ˆå°½ç®¡æœ‰æ–‡æ¡£è¦æ¯”æ²¡æ–‡æ¡£è¦å¥½ï¼‰ã€‚è¯·éµå®ˆ @cite{@value{TITLE}} ä¸­çš„è§„åˆ™ï¼Œç”±åœ¨ Texinfo æºæ–‡ä»¶å°¾éƒ¨çš„ @samp{@@bye} æ‰€æä¾›ã€‚
å¦‚æœå¯èƒ½ï¼Œè¯·ä¹Ÿè¯·æ›´æ–° @command{man} æ‰‹å†Œé¡µã€‚

ä½ å¯¹ä½ çš„æ–‡æ¡£ä¹Ÿéœ€è¦ç­¾ç½²ç›¸åº”çš„åè®®ã€‚

@cindex @command{git} utility
@item
ä½¿ç”¨ç»Ÿä¸€çš„ diffs æ¥æä¾›æ›´æ”¹ã€‚ä½¿ç”¨ @samp{diff -u -r -N} æ¥æ¯”è¾ƒæœ€åˆçš„ @command{gawk} æºä»£ç ä¸ä½ çš„ä»£ç å˜åŒ–ã€‚æˆ‘å»ºè®®ä½¿ç”¨ GNU ç‰ˆæœ¬çš„ @command{diff} æˆ–è€…æœ€å¥½ï¼Œç›´æ¥ä½¿ç”¨ @samp{git diff} æˆ–è€… @samp{git format-patch}ã€‚å°† @command{diff} äº§ç”Ÿçš„è¾“å‡ºå‘é€ç»™æˆ‘ã€‚ï¼ˆæŸ¥çœ‹ @ref{Bugs}ï¼Œæ¥è·å¾—ç”µå­é‚®ä»¶ä¿¡æ¯ã€‚ï¼‰

ä½¿ç”¨è¿™æ ·çš„æ ¼å¼ï¼Œæˆ‘å¾ˆå®¹æ˜“å°†ä½ çš„æ›´æ”¹åˆå¹¶åˆ° @command{gawk} çš„ä¸»ç‰ˆæœ¬çš„æºä»£ç ä¸­ï¼ˆä½¿ç”¨ @code{patch}ï¼‰ã€‚å¦‚æœæˆ‘å¿…é¡»è¦ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰‹åŠ¨æ›´æ”¹ï¼Œæˆ‘å¯èƒ½ä¸è¿™ä¹ˆåšï¼Œç‰¹åˆ«æ˜¯æœ‰å¾ˆå¤šçš„å˜åŒ–æ—¶ã€‚

@item
åœ¨ @file{ChangeLog} æ–‡ä»¶ä¸­åŒ…å«ä¸€é¡¹ï¼Œä¸ä½ çš„æ›´æ”¹ä¸€èµ·æäº¤ã€‚è¿™å¯ä»¥å¸®åŠ©è¿›ä¸€æ­¥æœ€å°åŒ–æˆ‘çš„å·¥ä½œï¼Œè¿™æ ·æˆ‘å°±æ¯”è¾ƒå®¹æ˜“æ¥å—è¡¥ä¸ã€‚å¦‚æœä½ åªä½¿ç”¨ä½ çš„ diff çš„è¿™éƒ¨åˆ†ï¼Œé‚£å°±æ˜¯æœ€ç®€å•çš„äº†ã€‚
@end enumerate

è¿™å¬èµ·æ¥è¦åšå¾ˆå¤šçš„äº‹æƒ…ï¼Œä½†æ˜¯è¯·è®°ä½å½“ä½ å†™äº†æ–°ä»£ç ï¼Œè€Œæˆ‘å°±å¾—ç»´æŠ¤å¹¶ä¸”æ”¯æŒå®ƒã€‚å¦‚æœå¯¹æˆ‘è€Œè¨€ä¸èƒ½æœ€å°åŒ–è¿™äº›é¢å¤–å·¥ä½œï¼Œæˆ‘å¯èƒ½å°±ä¸ä¼šåšã€‚

@node New Ports
@appendixsubsec å°† @command{gawk} ç§»æ¤åˆ°æ–°ç³»ç»Ÿä¸­ 
@cindex portability, @command{gawk}
@cindex operating systems, porting @command{gawk} to

@cindex porting @command{gawk}
å¦‚æœä½ æƒ³å°† @command{gawk} ç§»æ¤åˆ°æ–°çš„æ“ä½œç³»ç»Ÿï¼Œä¸‹é¢æ˜¯ç›¸åº”çš„æ­¥éª¤ï¼š

@enumerate 1
@item
éµå®ˆ
@ifinfo
@ref{Adding Code},
@end ifinfo
@ifnotinfo
ä¸Šä¸€@value{SECTION}
@end ifnotinfo
æ‰€è¯´çš„ä»£ç è§„èŒƒï¼Œæä¾› diff ç­‰ç­‰ã€‚

@item
å‡†å¤‡ç­¾ç½²ç›¸åº”çš„æ–‡ä»¶ã€‚è¿™æ · FSF å¯ä»¥å‘å¸ƒä½ çš„ä»£ç ï¼Œä½ è¦ä¹ˆå°†ä½ çš„ä»£ç æ”¾åœ¨å…¬å…±åŸŸé‡Œï¼Œè¦ä¹ˆç­¾ç½²ä¸€ä¸ªç­‰åŒäºç›¸åº”æ•ˆæœçš„æ–‡ä»¶ï¼Œæˆ–è€…å°†ç‰ˆæœ¬èµ‹ç»™ FSFã€‚è¿™ä¸¤ä¸ªå·¥ä½œéƒ½æ˜¯å®¹æ˜“åšçš„ï¼Œ@emph{å¾ˆå¤šäºº}ä¹Ÿè¿™ä¹ˆåšäº†ã€‚å¦‚æœä½ æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ï¼Œæˆ–è€… @email{gnu@@gnu.org}ã€‚

@item
å½“å®Œæˆäº†ä¸€ä¸ªç§»æ¤ï¼Œè¦è®°ä½ä½ çš„ä»£ç è¦ä¸ @command{gawk} å…¶ä»–çš„éƒ¨åˆ†ä¸€èµ·å…±å­˜ã€‚é¿å…å¯¹ç³»ç»Ÿæ— å…³çš„ä»£ç éƒ¨åˆ†åšæ— è°“çš„ä¿®æ”¹ã€‚å¦‚æœå¯èƒ½ï¼Œè¯·ä¸è¦åœ¨ä½ çš„éƒ¨åˆ†é‡Œåˆ°å¤„åŠ  @samp{#ifdef}ã€‚

å¦‚æœæ”¹å˜éœ€è¦ä¸€ç§ç‰¹å®šç³»ç»Ÿç‰¹æ€§ï¼Œä¼šå½±å“å¤ªå¤šçš„ä»£ç ï¼Œæˆ‘å¯èƒ½ä¸ä¼šæ¥å—å®ƒä»¬ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä½ å½“ç„¶å¯ä»¥è‡ªå·±æ¥å‘å¸ƒä½ çš„æ›´æ”¹ï¼Œåªè¦ä½ ç¬¦åˆ GPL å³å¯ï¼ˆæŸ¥çœ‹ @pxref{Copying}ï¼‰ã€‚

@item
å¾ˆå¤š @command{gawk} å¸¦æœ‰çš„æ–‡ä»¶æ˜¯è¢«å…¶ä»–çš„ç”¨äººç»´æŠ¤çš„ã€‚æ‰€ä»¥ï¼Œä½ ä¸å¯ä»¥æ›´æ”¹å®ƒä»¬ï¼Œé™¤éæœ‰å¾ˆå¥½çš„ç†ç”±ã€‚å³ï¼Œä¿®æ”¹å®ƒä»¬ä¸æ˜¯ç»å¯¹ä¸è¡Œï¼Œä½†æ˜¯å¯¹è¿™äº›æ–‡ä»¶çš„ä¿®æ”¹ä¹Ÿè¦é¢å¤–çš„ä»”ç»†ã€‚
è¿™äº›æ–‡ä»¶æ˜¯ 
@file{dfa.c}ï¼Œ
@file{dfa.h}ï¼Œ
@file{getopt.c}ï¼Œ
@file{getopt.h}ï¼Œ
@file{getopt1.c}ï¼Œ
@file{getopt_int.h}ï¼Œ
@file{gettext.h}ï¼Œ
@file{regcomp.c}ï¼Œ
@file{regex.c}ï¼Œ
@file{regex.h}ï¼Œ
@file{regex_internal.c}ï¼Œ
@file{regex_internal.h}ï¼Œ
å’Œ
@file{regexec.c}ã€‚

@item
æœ‰å¾ˆå¤šæ–‡ä»¶æ˜¯ç”± GNU Autotools æä¾›çš„ï¼ˆAutoconfï¼ŒAutomake åŠ GNU @command{gettext}ï¼‰ã€‚ä½ ä¹Ÿä¸å¯ä»¥æ›´æ”¹å®ƒä»¬ï¼Œé™¤éæœ‰å¥½çš„ç†ç”±ã€‚
è¿™äº›æ–‡ä»¶æ˜¯ 
@file{ABOUT-NLS}ï¼Œ
@file{config.guess}ï¼Œ
@file{config.rpath}ï¼Œ
@file{config.sub}ï¼Œ
@file{depcomp}ï¼Œ
@file{INSTALL}ï¼Œ
@file{install-sh}ï¼Œ
@file{missing}ï¼Œ
@file{mkinstalldirs}ï¼Œ
@file{xalloc.h}ï¼Œ
å’Œ
@file{ylwrap}ã€‚

@item
è¦æ„¿æ„æŒç»­ç»´æŠ¤è¿™ä¸ªç§»æ¤ç‰ˆæœ¬ã€‚é Unix çš„æ“ä½œç³»ç»Ÿæ˜¯ç”±å¿—æ„¿è€…æ¥ç»´æŠ¤çš„ï¼Œä»–ä»¬ç»´æŠ¤éœ€è¦åœ¨ä»–ä»¬çš„ç³»ç»Ÿä¸­çš„ä»£ç çš„ç»´æŠ¤åŠè¿è¡Œã€‚å¦‚æœæ²¡æœ‰äººæ„¿æ„ç»´æŠ¤è¿™ä¸ªç§»æ¤ç‰ˆæœ¬ï¼Œä¼šæˆä¸ºä¸å—æ”¯æŒçš„ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½æœ‰å¿…è¦ä»å‘è¡Œç‰ˆæœ¬ä¸­ç§»é™¤æ‰ã€‚

@item
æä¾›åˆé€‚çš„ @file{gawkmisc.???} æ–‡ä»¶ã€‚æ¯ä¸ªç§»æ¤ç‰ˆæœ¬éƒ½æœ‰è‡ªå·±çš„ @file{gawkmisc.???} æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å®ç°äº†ç‰¹å®šäºæ“ä½œç³»ç»Ÿçš„å‡½æ•°ã€‚è¿™ä¸ªæ¯”åœ¨ä»£ç ä¸­ç”¨å¤§é‡çš„ @samp{#ifdef} è¦æ›´åŠ æ¸…æ™°ã€‚åœ¨æºä»£ç ä¸»ç›®å½•ä¸­çš„ @file{gawkmisc.c} åŒ…å«äº†ç›¸åº”çš„ @file{gawkmisc.???} æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ¥è‡ªäºå…¶å­ç›®å½•ã€‚è®°å¾—ä¹Ÿè¦æ›´æ–°ã€‚

æ¯ä¸ªç§»æ¤ç‰ˆæœ¬çš„ @file{gawkmisc.???} æ–‡ä»¶æœ‰ä¸€ä¸ªåç¼€æ¥è¡¨ç¤ºæœºå™¨ä»¥åŠæ“ä½œç³»ç»Ÿï¼Œå¦‚ @file{pc/gawkmisc.pc} å’Œ @file{vms/gawkmisc.vms}ã€‚
ä½¿ç”¨å…¶ä»–çš„åç¼€ï¼Œè€Œä¸æ˜¯æ™®é€šçš„ @file{gawkmisc.c}ï¼Œä½¿å…¶æœ‰å¯èƒ½å°†æ–‡ä»¶ä»ç§»æ¤ç‰ˆæœ¬çš„å­ç›®å½•è¡Œè‰²ç§»åˆ°ä¸»çº¿å­ç›®å½•ï¼Œè€Œä¸ä¼šå¯¼è‡´å¶ç„¶çš„å¯¹ @file{gawkmisc.c} æ–‡ä»¶çš„ç ´åã€‚ï¼ˆå½“å‰ï¼Œè¿™ä¸ªåªå¯¹ PC æ“ä½œç³»ç»Ÿç§»æ¤æ‰ä¼šæ˜¯é—®é¢˜ã€‚ï¼‰

@item
æä¾›å¿…è¦çš„ @file{Makefile} ç”¨äºä½ çš„æ“ä½œç³»ç»Ÿã€‚ä½ çš„æ‰€æœ‰ä»£ç éƒ½åº”è¯¥åœ¨ä¸€ä¸ªå•ç‹¬çš„å­ç›®å½•ä¸‹ï¼Œåå­—å¯ä»¥ä¸æ“ä½œç³»ç»Ÿåå­—ç›¸åŒï¼Œæˆ–è€…æ˜¯æ“ä½œç³»ç»Ÿåå­—ä¸€éƒ¨åˆ†ã€‚å¦‚æœå¯èƒ½ï¼Œå°†äº‹æƒ…ç»“æ„åŒ–ï¼Œè¿™æ ·æ²¡æœ‰å¿…é¡»å°†æ–‡ä»¶ä»å­ç›®å½•ä¸­ç§»åŠ¨åˆ°ä¸»å­ç›®å½•ä¸‹ã€‚å¦‚æœä¸å¯èƒ½ï¼Œåˆ™è¦ç¡®ä¿ä½¿ç”¨ä½ çš„æ–‡ä»¶çš„åå­—ä¸ä¼šä¸ä¸»æºä»£ç ç›®å½•ä¸‹çš„æ–‡ä»¶ç›¸åŒã€‚

@item
æ›´æ–°æ–‡æ¡£ã€‚
å†™ä¸ºæœ¬@value{DOCUMENT}å†™ä¸€ä¸ªå°èŠ‚ï¼ˆæˆ–è€…å¤šä¸ªå°èŠ‚ï¼‰æ¥æè¿°å…¶å®‰è£…ä¸ç¼–è¯‘æ­¥éª¤ï¼Œè¿™æ ·å¯ä»¥åœ¨ä½ çš„ç³»ç»Ÿä¸Šç¼–è¯‘ä¸å®‰è£… @command{gawk}ã€‚
@end enumerate

æŒ‰è¿™æ ·çš„æ­¥éª¤ï¼Œå¯ä»¥ä½¿å…¶å®¹æ˜“æ¥å°†ä½ çš„å˜åŒ–æ•´åˆåˆ° @command{gawk} ä¸­ï¼Œå¹¶ä½¿å…¶ä¸å…¶ä»–çš„å·²ç»å­˜åœ¨æ“ä½œç³»ç»Ÿä»£ç å’Œå¹³å…±å¤„ã€‚

åœ¨ä½ æä¾›ä¸ç»´æŠ¤çš„ä»£ç ä¸­ï¼Œå¯ä»¥è‡ªç”±ä½¿ç”¨ä½ çš„é£æ ¼ä»¥åŠæ‹¬å·å¸ƒå±€ã€‚

@node Derived Files
@appendixsubsec ä¸ºä»€ä¹ˆè‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶è¦æ”¾åœ¨ Git ä¸­ 

@cindex Git, use of for @command{gawk} source code
@c From emails written March 22, 2012, to the gawk developers list.

å¦‚æœä½ æŸ¥çœ‹  Git åº“ä¸­çš„ @command{gawk} æºä»£ç ï¼Œä½ ä¼šæ³¨æ„åˆ°é‡Œé¢åŒ…å«äº†ç”± GNU åŸºç¡€å·¥ä½œè‡ªåŠ¨åŠ›ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå¦‚ @file{Makefile.in} ç”± Automake ç”Ÿæˆï¼Œç”šè‡³æ˜¯ç”± Autoconf ç”Ÿæˆçš„ @file{configure} ã€‚

è¿™ä¸ªä¸åŒäºä¸å­˜å‚¨è¡ç”Ÿæ–‡ä»¶å…¶ä»–è‡ªç”±è½¯ä»¶é¡¹ç›®ï¼Œå› ä¸ºè¿™ä½¿å¾—åº“ä¸ä¼šè¿™ä¹ˆæ··ä¹±ï¼Œè€Œä¸”æ›´å®¹æ˜“åœ¨æ¯”è¾ƒåœ¨ä¸åŒæäº¤ä¹‹é—´çš„çœŸæ­£æ”¹å˜ã€‚

ä½†æ˜¯ï¼Œæœ‰å‡ ä¸ªåŸå› ï¼Œä½¿å¾— @command{gawk} è¦æŠŠæ‰€æœ‰çš„ä¸œè¥¿æ”¾åœ¨åº“ä¸­ã€‚

é¦–å…ˆï¼Œè¿™æ›´å®¹æ˜“ç”Ÿæˆå®Œæ•´çš„ç‰ˆæœ¬ï¼Œè€Œä¸ä¾èµ–äºå…¶ä»–å·¥ä½œçš„èƒ½åŠ›ï¼ˆæœ‰ä¸€äº›è€çš„ï¼Œè¢«ä¸¢å¼ƒï¼Œç”šè‡³æ²¡åŠæ³•æ‰¾å¾—åˆ°ã€‚ï¼‰

ä¸€ä¸ªæç«¯ä¾‹å­æ˜¯ï¼Œå¦‚æœä½ æƒ³ç¼–è¯‘ï¼Œæ¯”æ–¹è¯´ V7 çš„ @command{awk}ï¼Œä½ ä¼šå‘ç°ä½ ä¸ä»…è¦ç”¨ V7 çš„ @code{yacc} æ¥å¤„ç†ï¼Œè¿˜éœ€è¦ V7 çš„ @code{lex}ã€‚å¯¹äºåè€…ï¼Œåœ¨ç°ä»£çš„ GNU/Linux ç³»ç»Ÿæ ¹æœ¬æ²¡æœ‰ã€‚ 
@footnote{æˆ‘ä»¬è¯•è¿‡ï¼Œä½†æ˜¯éå¸¸ç—›è‹¦ã€‚}

ï¼ˆæˆ–è€…è¯´ï¼Œ@command{gawk} 1.2 æ‰€éœ€è¦ 1989 å¹´ä¸­çš„ @command{bison} ä»€ä¹ˆä»€ä¹ˆçš„ï¼Œåœ¨åº“ä¸­æ²¡æœ‰ @file{awkgram.c} è¿™ä¸ªæ–‡ä»¶ã€‚æœ‰ä¿è¯è¯´æˆ‘ä»¬å¯ä»¥æ‰¾åˆ° @command{bison} ç‰ˆæœ¬ï¼Ÿæˆ–è€…@emph{å®ƒ}å¯ä»¥æ„å»ºä¹ˆï¼Ÿï¼‰

å¦‚æœåº“æœ‰éƒ½æœ‰ç”Ÿæˆçš„æ–‡ä»¶ï¼Œåˆ™å¾ˆå®¹æ˜“æ£€æŸ¥å¹¶æ„å»ºã€‚ï¼ˆæˆ–è€…ï¼Œä¾èµ–äºæˆ‘ä»¬æ‰€å›åˆ°çš„ä½ç½®å¯èƒ½æ›´å®¹æ˜“ã€‚ï¼‰

è¿™ä½¿å¾—æˆ‘ä»¬æœ‰ç¬¬äºŒä¸ªç†ç”±ï¼ˆæ›´å¼ºçš„ï¼‰ä¸ºä»€ä¹ˆæŠŠæ‰€æœ‰çš„æ–‡ä»¶éƒ½æ”¾åœ¨ Git ä¸­ã€‚ç®€å•åœ°è¯´å°±æ˜¯ä½ è®©è°å¼€å¿ƒâ€”â€”æ˜¯ @command{gawk} çš„å¼€å‘è€…ï¼Œè¿˜æ˜¯ä»…æƒ³å–æŸä¸ªç‰ˆæœ¬ç„¶åè¯•è¯•å®ƒçš„ç”¨æˆ·ï¼Ÿ

@command{gawk} çš„ç»´æŠ¤ç»´æŠ¤è€…æƒ³å…¨ä¸–ç•Œæ‰€æœ‰çš„å¯¹ @command{awk} æœ‰å…´è¶£çš„ç”¨æˆ·ï¼Œåªè¦å…‹éš†åº“ï¼Œç„¶åæ£€å‡ºæ‰€æ„Ÿå…´è¶£çš„åˆ†æ”¯æ„å»ºå³å¯ã€‚è€Œä¸éœ€è¦ä»–ä»¬å¿…é¡»æœ‰æ­£ç¡®çš„ @code{autotools} ç‰ˆæœ¬ã€‚
@footnote{æœ‰ä¸€ä¸ª GNU ç¨‹åºï¼Œï¼ˆä»¥æˆ‘ä»¬çš„è§‚ç‚¹çœ‹ï¼‰å¾ˆéš¾ä» Git åº“ä¸­ç”Ÿæˆã€‚æ¯”å¦‚ï¼Œåœ¨ä½œè€…çš„æ—§çš„ï¼ˆä½†æ˜¯è¿˜å·¥ä½œï¼‰çš„ PowerPC Macintosh ï¼Œå®‰è£…çš„æ˜¯ Mac OS X 10.5ï¼Œå¾ˆæœ‰å¿…è¦ä» Git åº“æœ¬èº«ç”Ÿæˆå’Œå¾ˆå¤šè½¯ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿä¸æœ€æ–°çš„ä»£ç ä¸€èµ·å·¥ä½œã€‚è¿™ä¸€ç‚¹ä¹Ÿä¸è®©äººæ„Ÿè§‰æ„‰å¿«ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€äº›è€æ—§çš„ç³»ç»Ÿä¸­ï¼Œè¿™ç®€ç›´å°±æ˜¯æµªè´¹æ—¶é—´ã€‚

ä½¿ç”¨æœ€æ–°çš„ tarball ä¹Ÿä¸éœ€è¦æ‹…å¿ƒã€‚ç»´æŠ¤éƒ½å·²ç»ä¸ç”¨ @file{.gz} ä¸ @file{.bz2} æ–‡ä»¶äº†ï¼Œè€Œåªå‘å¸ƒ @file{.tar.xz} æ–‡ä»¶ã€‚æœ‰å¿…è¦å…ˆå®‰è£… @command{xz}ã€‚}
è¿™ä¹Ÿæ˜¯ @file{bootstrap.sh} æ–‡ä»¶çš„ç›®çš„ã€‚å®ƒä»¥æ­£ç¡®çš„é¡ºåºæ¥å¤„ç†ä¸åŒçš„æ–‡ä»¶ï¼Œè¿™æ ·ï¼š

@example
# The canonical incantation for building GNU software:
./bootstrap.sh && ./configure && make
@end example

@noindent
ä¹Ÿ@emph{å¯ä»¥å·¥ä½œ}ã€‚

è¿™å¯¹äº @code{master} ä¸»å¹²ä»¥åŠ @code{gawk-@var{X}.@var{Y}-stable} åˆ†æ”¯æ¥è¯´å°¤å…¶é‡è¦ã€‚

å†è€…ï¼Œ@command{gawk} çš„ç»´æŠ¤è€…ä¹Ÿè§‰å¾—è¿™å¯¹äº @command{gawk} çš„å¼€å‘è€…ä¹Ÿéå¸¸é‡è¦ã€‚å½“æŸäººå°è¯•æ£€å‡º @code{xgawk} çš„åˆ†æ”¯
@footnote{ä¸€ä¸ªç”±å…¶ä»–å¼€å‘è€…ç”Ÿæˆçš„åˆ†æ”¯ï¼ˆå·²ç»åˆ é™¤ï¼‰ï¼Œå¹¶æ²¡æœ‰åŒ…å«æ‰€ç”Ÿæˆçš„æ–‡ä»¶ã€‚}
æ¥æ„å»ºæ—¶ï¼Œå´å‘ç°ä¸èƒ½ã€‚ï¼ˆæ²¡æœ‰ @file{ltmain.sh} æ–‡ä»¶ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•æ¥ç”Ÿæˆï¼Œå¹¶ä¸”è¿™ä¹Ÿä¸æ˜¯å”¯ä¸€çš„é—®é¢˜ã€‚ï¼‰

æ­¤äººä¼šæ„Ÿè§‰@emph{ç²¾ç–²åŠ›å°½}ã€‚å¯¹äºç›¸åº”çš„åˆ†æ”¯ï¼Œç»´æŠ¤è€…ä¸ @code{Jane} è¿™æ ·çš„æƒ³æ„å»ºä»åº“ä¸­å–å¾—çš„ @code{gawk-4.1-stable} æˆ–è€… @code{master} ç”¨æˆ·æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚

å› æ­¤ï¼Œç»´æŠ¤è€…è§‰å¾—å¯¹äºä»»ä½•åˆ†æ”¯è€Œè¨€ï¼Œä¸Šé¢çš„ä»£ç @emph{èƒ½å·¥ä½œ}ï¼Œè¿™æ ·ä¸ä»…æ˜¯é‡è¦ï¼Œè€Œä¸”éå¸¸å…³é”®ã€‚

@c Added 9/2014:
ç¬¬ä¸‰ä¸ªåŸå› æ˜¯ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›æ–‡ä»¶ï¼Œä½¿ç”¨ @samp{git
bisect} æ¥æŸ¥æ‰¾å¼•å…¥ bug çš„æäº¤ä¼šå˜æˆç›¸å½“å›°éš¾ã€‚ç»´æŠ¤è€…ä¼šåœ¨å…¶ä»–çš„é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªé¡¹ç›®éœ€è¦è¿è¡Œè‡ªä¸¾è„šæœ¬ï¼Œä»¥åˆ›å»º @command{configure} ç­‰æ–‡ä»¶ï¼Œè¿™ç›¸å½“ç—›è‹¦ã€‚å½“åº“è‡ªå·±æ˜¯è‡ªåŒ…å«çš„ï¼Œä½¿ç”¨ @command{git bisect} å°±ç›¸åº”å®¹æ˜“äº†ã€‚

@c So - that's my reasoning and philosophy.

æœ‰ä»€ä¹ˆç»“æœä¸/æˆ–è€…é‡‡å–ä»€ä¹ˆè¡ŒåŠ¨å‘¢ï¼Ÿ

@enumerate 1
@item
æˆ‘ä»¬ä¸ä»‹æ„åœ¨ä¸åŒçš„åˆ†æ”¯ä¸‹æœ‰ä¸åŒçš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸åŒçš„ autotools ç‰ˆæœ¬çš„ç»“æœã€‚

@enumerate A
@item
åˆå¹¶ä¸å¤„ç†ï¼Œè¿™æ˜¯ç»´æŠ¤è€…çš„äº‹ã€‚

@item
ä¸ºäº†æ£€æŸ¥ä»£ç ï¼Œç»´æŠ¤è€…ä¼šä½¿ç”¨ @samp{git diff x y > /tmp/diff1 ; gvim /tmp/diff1} æ¥ç§»é™¤ä¸æ„Ÿå…´è¶£çš„å·®åˆ«ï¼Œä»–åœ¨è¿™æ–¹é¢ç¡®å®éå¸¸æ‹¿æ‰‹ã€‚
@end enumerate

@item
å¦‚æœæ‰€æœ‰çš„äººéƒ½ä½¿ç”¨ä¸ç»´æŠ¤è€…ä¸€æ ·çš„ GNU tools çš„è¯ï¼Œè‚¯å®šä¼šæœ‰å¸®åŠ©ï¼Œä¸€èˆ¬æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ Automakeï¼ŒAutoconfï¼Œ@command{bison} ä»¥åŠ GNU @command{gettext}ã€‚

@ignore
If it would help if I sent out an ``I just upgraded to version x.y
of tool Z'' kind of message to this list, I can do that.  Up until
now it hasn't been a real issue since I'm the only one who's been
dorking with the configuration machinery.
@end ignore

@c @enumerate A
@c @item
ä»æºä»£ç å®‰è£…éå¸¸å®¹æ˜“ã€‚å‡ å¹´æ¥ç»´æŠ¤è€…éƒ½æ˜¯è¿™ä¹ˆåšçš„ï¼ˆè€Œä¸”è¿˜åœ¨è¿™ä¹ˆåšï¼‰ã€‚åªéœ€è¦å°† @file{/usr/local/bin} æ”¾åœ¨ @env{PATH} çš„å‰é¢ï¼Œç„¶åæ‰§è¡Œï¼š

@example
wget http://ftp.gnu.org/gnu/@var{package}/@var{package}-@var{x}.@var{y}.@var{z}.tar.gz
tar -xpzvf @var{package}-@var{x}.@var{y}.@var{z}.tar.gz
cd @var{package}-@var{x}.@var{y}.@var{z}
./configure && make && make check
make install    # as root
@end example

@c @item
@ignore
These days the maintainer uses Ubuntu 12.04 which is medium current, but
he is already doing the above for Automake, Autoconf, and @command{bison}.
@end ignore

@ignore
(C. Rant: Recent Linux versions with GNOME 3 really suck. What
    are all those people thinking?  Fedora 15 was such a bust it drove
    me to Ubuntu, but Ubuntu 11.04 and 11.10 are totally unusable from
    a UI perspective. Bleah.)
@end ignore
@c @end enumerate

@ignore
@item
If someone still feels really strongly about all this, then perhaps they
can have two branches, one for their development with just the clean
changes, and one that is buildable (xgawk and xgawk-buildable, maybe).
Or, as I suggested in another mail, make commits in pairs, the first with
the "real" changes and the second with "everything else needed for
 building".
@end ignore
@end enumerate

ä¸Šé¢å¤§å¤šæ•°ä¸€å¼€å§‹æ˜¯ç”±å…¶ä»–çš„ @command{gawk} ç»´æŠ¤è€…å†™çš„ã€‚æœ‰ä¸€ä¸ªå¼€å‘è€…æå‡ºçš„åå¯¹æ„è§â€œ@dots{} ä» Git åº“ä¸­æå–æºä»£ç çš„äººå¹¶ä¸éƒ½æ˜¯ç»ˆç«¯ç”¨æˆ·ã€‚â€

ä½†æ˜¯ï¼Œäº‹æƒ…ä¸æ˜¯è¿™ä¹ˆå›äº‹ã€‚æœ‰â€œå¤§ç‰›çº§çš„ @command{awk} ç”¨æˆ·â€ï¼Œä»–ä»¬å¯ä»¥æ„å»º @command{gawk}ï¼ˆä½¿ç”¨ä¹‹å‰æ‰€åˆ—çš„ä»£ç ï¼‰ï¼Œä½†æ˜¯ä»–ä»¬æ²¡åŠæ³•ç”¨ C å†™ç¨‹åºã€‚æ‰€ä»¥ï¼Œä¸»è¦çš„åˆ†æ”¯åº”è¯¥ä¸€ç›´ä¿æŒæ˜¯å¯æ„å»ºçš„ã€‚

ç„¶åå»ºè®®ï¼Œåº”è¯¥æœ‰ä¸€ä¸ª @command{cron} ä»»åŠ¡æ¥æ¯æ™šæ¥åˆ›å»ºæ‰€æœ‰ä»£ç çš„ tar ballã€‚è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œæœ‰ä¸åŒåˆ†æ”¯çš„ä»£ç çº¿ï¼Œå› æ­¤ï¼Œæ¯æ™šçš„ tar ball ä¸æ˜¯æœ€ç»ˆè§£å†³æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯åº“æœ‰å¯èƒ½å‡ å‘¨éƒ½ä¸ä¼šæœ‰å¤§çš„å˜åŒ–ã€‚

å¹¸è¿çš„æ˜¯ï¼ŒGit æœåŠ¡å™¨å¯ä»¥æ¥æ»¡è¶³è¿™æ ·çš„éœ€è¦ã€‚å¯¹äºæ¯ä¸€ä¸ªåå­—ä¸º @var{branchname} çš„åˆ†æ”¯ï¼Œä½¿ç”¨ï¼š

@example
wget http://git.savannah.gnu.org/cgit/gawk.git/snapshot/gawk-@var{branchname}.tar.gz
@end example

@noindent
æ¥è¿”å›æ‰€æŒ‡å®šåˆ†æ”¯çš„å¿«ç…§ã€‚

@node Future Extensions
@appendixsec åç»­å¯èƒ½çš„æ‰©å±•
@ignore
From emory!scalpel.netlabs.com!lwall Tue Oct 31 12:43:17 1995
Return-Path: <emory!scalpel.netlabs.com!lwall>
Message-Id: <9510311732.AA28472@scalpel.netlabs.com>
To: arnold@skeeve.atl.ga.us (Arnold D. Robbins)
Subject: Re: May I quote you?
In-Reply-To: Your message of "Tue, 31 Oct 95 09:11:00 EST."
             <m0tAHPQ-00014MC@skeeve.atl.ga.us>
Date: Tue, 31 Oct 95 09:32:46 -0800
From: Larry Wall <emory!scalpel.netlabs.com!lwall>

: Greetings. I am working on the release of gawk 3.0. Part of it will be a
: thoroughly updated manual. One of the sections deals with planned future
: extensions and enhancements.  I have the following at the beginning
: of it:
:
: @cindex PERL
: @cindex Wall, Larry
: @display
: @i{AWK is a language similar to PERL, only considerably more elegant.} @*
: Arnold Robbins
: @sp 1
: @i{Hey!} @*
: Larry Wall
: @end display
:
: Before I actually release this for publication, I wanted to get your
: permission to quote you.  (Hopefully, in the spirit of much of GNU, the
: implied humor is visible... :-)

I think that would be fine.

Larry
@end ignore
@cindex Perl
@cindex Wall, Larry
@cindex Robbins, Arnold
@quotation
@i{
@code{AWK} æ˜¯åƒ @code{PERL} è¯­è¨€ä¸€æ ·ï¼Œåªæ˜¯è¦æ¯”å®ƒä¼˜ç¾å¾—å¤šäº†ã€‚
}
@author Arnold Robbins
@end quotation

@quotation
@i{
å˜¿ï¼Œæ€ä¹ˆè¯´çš„ï¼
}
@author Larry Wall
@end quotation

åœ¨ Git åº“ä¸­çš„ @command{gawk} çš„ @code{master} ä¸»åˆ†æ”¯ä¸­çš„ @file{TODO} æ–‡ä»¶åˆ—å‡ºæ¥æœªæ¥å¯èƒ½çš„å¢åŠ ã€‚æœ‰ä¸€äº›ä¸æºä»£ç ç›¸å…³ï¼Œå…¶ä»–çš„æ˜¯ä¸€äº›æ–°ç‰¹æ€§ã€‚è¯·æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶æ¥è·å–ç›¸å…³åˆ—è¡¨ã€‚å¦‚æœä½ æœ‰å…´è¶£è·Ÿè¸ªåˆ—åœ¨å…¶ä¸­çš„é¡¹ç›®ï¼Œè¯·æŸ¥çœ‹ @ref{Additions}ã€‚

@node Implementation Limitations
@appendixsec å®ç°çš„ä¸€äº›é™åˆ¶

ä¸‹è¡¨æè¿°äº† @command{gawk} åœ¨ç±» Unix ç³»ç»Ÿä¸­çš„ä¸€äº›é™åˆ¶ï¼ˆå°½ç®¡è¿˜ä¼šæœ‰å˜é‡ï¼‰ã€‚å…¶ä»–çš„ç³»ç»Ÿå¯èƒ½è¿˜æœ‰ä¸åŒçš„é™åˆ¶ã€‚

@multitable @columnfractions .40 .60
@headitem é¡¹ @tab é™åˆ¶
@item å­—ç¬¦ç±»å†…çš„å­—ç¬¦æ•° @tab 2^(æ¯å­—èŠ‚çš„ä½æ•°)
@item è¾“å…¥è®°å½•çš„é•¿åº¦ @tab @code{MAX_INT}
@item è¾“å‡ºè®°å½•çš„é•¿åº¦ @tab Unlimited
@item æºä»£ç é•¿åº¦ @tab Unlimited
@item è®°å½•ä¸­çš„åŸŸæ•° @tab @code{MAX_LONG}
@item æ–‡ä»¶é‡å®šå‘æ•° @tab Unlimited
@item ä¸€ä¸ªæ–‡ä»¶ä¸­çš„è®°å½•æ•° @tab @code{MAX_LONG}
@item æ€»æ˜¯è¾“å…¥è®°å½•æ•° @tab @code{MAX_LONG}
@item é‡å®šå‘ç®¡é“æ•° @tab min(æ¯ç”¨è¿›ç¨‹æ•°ï¼Œ æ‰“å¼€æ–‡ä»¶æ•°)
@item æ•°å€¼ @tab åŒç²¾åº¦æµ®ç‚¹æ•° (å¦‚æœæ²¡æœ‰ä½¿ç”¨ MPFR)
@item åŸŸå¤§å° @tab @code{MAX_INT}
@item å­—ä¸²å¤§å° @tab @code{MAX_INT}
@item printf å­—ä¸²å¤§å° @tab @code{MAX_INT}
@end multitable

@node Extension Design
@appendixsec æ‰©å±• API è®¾è®¡ 

è¿™ä¸€@value{SECTION}ï¼Œè®°å½•äº†æ‰©å±• API çš„è®¾è®¡ï¼ŒåŒ…æ‹¬ä¸€äº›éœ€è¦è§£å†³çš„å†å²é—®é¢˜çš„è®¨è®ºã€‚

ç”¨äº @command{gawk} ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„æ‰©å±•åœ¨ 1990 å¹´ä»£ä¸­æœŸå¼€å‘ï¼Œå¹¶ä¸ @command{gawk} 3.1 ä¸€èµ·å‘å¸ƒã€‚15 å¹´æ¥åŸºæœ¬çš„æœºåˆ¶å¹¶æ²¡æœ‰ä»€ä¹ˆå˜é‡ï¼Œç›´åˆ° 2012 å¹´ã€‚

æ—§æ‰©å±•çš„æœºåˆ¶ä½¿ç”¨ä½¿ç”¨æ¥è‡ª @command{gawk} çš„æ•°æ®ç±»å‹ä¸å‡½æ•°ï¼Œé€šè¿‡â€œèªæ˜é»‘å®¢â€æ‰‹æ®µæ¥å®‰è£…æ‰©å±•å‡½æ•°ã€‚

@command{gawk} åŒ…å«äº†ä¸€äº›æ‰©å±•ï¼Œå¾ˆå¤šéƒ½å¾ˆæœ‰ç”¨ã€‚ä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œä»ä¸€å¼€å§‹æ‰©å±•æœºåˆ¶éƒ½åªå¼ºåˆ¶ä¸€è¾¹ï¼Œè€Œæ²¡æœ‰ç»è¿‡è¯¦ç»†æ€è€ƒã€‚

@menu
* Old Extension Problems::           Problems with the old mechanism.
* Extension New Mechanism Goals::    Goals for the new mechanism.
* Extension Other Design Decisions:: Some other design decisions.
* Extension Future Growth::          Some room for future growth.
@end menu

@node Old Extension Problems
@appendixsubsec æ—§æœºåˆ¶çš„é—®é¢˜

æ—§çš„æ‰©å±•æœºåˆ¶æœ‰ä¸‹é¢çš„å‡ ä¸ªé—®é¢˜ï¼š

@itemize @value{BULLET}
@item
ä¸¥é‡ä¾èµ–äº @command{gawk} çš„å†…éƒ¨å®ç°ã€‚@code{NODE} ç»“ç‚¹ç»“æ„
@footnote{@command{gawk} ä¸­çš„å…³é”®çš„æ ¸å¿ƒæ•°ç»„ç»“æ„ã€‚}
ä¸€æ—¦å˜åŒ–ï¼Œæ‰©å±•å°±å¾—é‡æ–°ç¼–è¯‘ã€‚è€Œä¸”ï¼Œè¦çœŸå†™ä¸€æ‰©å±•ï¼Œéœ€è¦äº†è§£ @command{gawk} å†…éƒ¨åŠŸèƒ½çš„ä¸€äº›ä¸œè¥¿ã€‚è¿™é‡Œé¢æœ‰ä¸€äº›è®°å½•åœ¨æœ¬@value{DOCUMENT}é‡Œï¼Œä½†æ˜¯ç›¸å½“æœ‰é™ã€‚

@item
è¦èƒ½å¤Ÿä»æ‰©å±•è°ƒç”¨åˆ° @command{gawk}ï¼Œè¿™éœ€è¦è¿æ¥å·¥å…·åœ¨ Unix æ´¾ç”Ÿå‡ºæ¥çš„ç³»ç»Ÿä¸­æ˜¯å¾ˆé€šç”¨çš„ï¼Œä½†æ˜¯åœ¨ MS-Windows ä¸Šå´ä¸æ˜¯ï¼Œç”¨æˆ·åœ¨ MS-Windows ä¸Šçš„æ‰©å±•éœ€è¦é™æ€åœ°è¿æ¥åˆ° @command{gawk} ä¸­ï¼Œå°½ç®¡ MS-Windows ä¹Ÿæ”¯æŒåŠ¨æ€è£…è½½å…±äº«å¯¹è±¡ã€‚

@item
å½“ @command{gawk} å˜åŒ–æ—¶ï¼ŒAPI ä¹Ÿä¼šå¶å°”å˜é‡ï¼Œå¹¶ä¸”ä¸åŒçš„ç‰ˆæœ¬ä¹‹é—´ä¸å…¼å®¹ï¼Œä¹Ÿæ²¡æœ‰ç›¸åº”çš„è®¡åˆ’æ¥å…¼å®¹ã€‚
@end itemize

å°½ç®¡æœ‰è¿™ä¹ˆäº›ç¼ºé™·ï¼Œ@command{xgawk} é¡¹ç›®çš„å¼€å‘è€…å¤åˆ¶äº† @command{gawk} å¹¶ä¸”å¼€å‘äº†å‡ ä¸ªå¾ˆå¥½çš„æ‰©å±•ã€‚å®ƒä»¬ä¹Ÿå¢å¼ºäº† @command{gawk} ä¸­ä¸æ–‡ä»¶åŒ…å«ä¸å…±äº«å¯¹è±¡è®¿é—®çš„åŠŸèƒ½ã€‚

æ–°çš„ API ç»è¿‡çš„é•¿æ—¶é—´çš„è®¾è®¡ï¼Œç›´åˆ° 2012 å¹´ï¼Œ@command{gawk} çš„ç»´æŠ¤è€…ä¸å¼€å‘è€…æœ€ç»ˆæ‰å¼€å§‹å®ç°ã€‚å…³äº @command{xgawk} é¡¹ç›®çš„ä¿¡æ¯åœ¨ @ref{gawkextlib}ï¼Œè¿™é‡Œæä¾›ã€‚

@node Extension New Mechanism Goals
@appendixsubsec æ–°æœºåˆ¶çš„ç›®æ ‡ 

æ–° API çš„ç›®æ ‡æ˜¯ï¼š

@itemize @value{BULLET}
@item
API åº”è¯¥ç‹¬ç«‹äº @command{gawk} çš„å†…éƒ¨å®ç°ã€‚@command{gawk} çš„å†…éƒ¨å®ç°çš„å˜æ›´ä¸å¯¹äºæ‰©å±•å‡½æ•°çš„å®ç°è€…æ˜¯ä¸å¯è§çš„ã€‚

@item
API åº”è¯¥æä¾›@emph{äºŒè¿›åˆ¶}å…¼å®¹æ€§ï¼Œåªè¦ @command{gawk} çš„å‘è¡Œç‰ˆæœ¬ä¹‹é—´ API æ²¡æœ‰å˜æ›´ã€‚

@item
API åº”è¯¥å¯ä»¥ç”¨ C æˆ–è€… C++ æ¥å†™ï¼Œä½¿å…¶ä¸ @command{awk} å±‚çš„ä»£ç æœ‰ä¸€æ ·çš„â€œå¤–è§‚â€ï¼Œå°±åƒ @command{awk} å‡½æ•°ä¸€æ ·ã€‚è¿™å°±æ˜¯è¯´ï¼Œæ‰©å±•åº”è¯¥ï¼š

@itemize @value{MINUS}
@item
æœ‰èƒ½åŠ›è®¿é—®å‡½æ•°å‚æ•°ã€‚

@item
æœ‰èƒ½åŠ›å°†ä¸€ä¸ªæœªå®šä¹‰çš„å‡½æ•°è½¬æ¢ä¸ºæ•°ç»„ï¼ˆé€šè¿‡å¼•ç”¨è°ƒç”¨ï¼‰ã€‚

@item
æœ‰èƒ½åŠ›åˆ›å»ºï¼Œè®¿é—®ä¸æ›´æ–°å…¨å±€å˜é‡ã€‚

@item
æ–¹ä¾¿ä¸€æ¬¡æ€§è®¿é—®æ•°ç»„çš„æ‰€æœ‰å…ƒç´ ï¼ˆâ€œæ•°ç»„æ‰å¹³åŒ–â€ï¼‰ï¼Œä½¿å…¶å¯ä»¥ç”¨ C ä»£ç çš„å¾ªç¯å°±å¯ä»¥è¿­ä»£æ•°ç»„ä¸­çš„æ‰€æœ‰çš„å…ƒç´ ã€‚

@item
æœ‰èƒ½åŠ›åˆ›å»ºæ•°ç»„ï¼ˆåŒ…å« @command{gawk} çœŸæ­£çš„æ•°ç»„ä¹‹æ•°ç»„ï¼‰ã€‚
@end itemize
@end itemize

å…¶ä»–çš„é‡è¦ç›®æ ‡æ˜¯ï¼š

@itemize @value{BULLET}
@item
API åº”è¯¥åªä½¿ç”¨ ISO C 90 çš„ç‰¹æ€§ï¼Œè¿™æ ·æ‰©å±•å¯ä»¥ä½¿ç”¨æœ€å¹¿æ³›çš„ C ä¸ C++ ç¼–è¯‘å™¨ã€‚å¤´æ–‡ä»¶åº”è¯¥åŒ…å«é€‚å½“çš„ @samp{#ifdef __cplusplus} ä¸ @samp{extern "C"} ç­‰ä»£ç ï¼Œè¿™æ ·å¯ä»¥ä½¿ç”¨ C++ ç¼–è¯‘å™¨ã€‚ï¼ˆå¦‚æœä½¿ç”¨ C++ æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿè¦è¶³å¤Ÿèªæ˜æ¥è°ƒç”¨ä»»ä½•çš„æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°ï¼Œå› ä¸º @command{gawk} æ˜¯ä¸€ä¸ª C ç¨‹åºã€‚åœ¨å†™æœ¬ä¹¦æ—¶ï¼Œè¿™è¿˜æ²¡æœ‰æµ‹è¯•è¿‡ã€‚ï¼‰

@item
æ— è®ºæ˜¯ç¼–è¯‘æ—¶è¿˜æ˜¯åŠ¨æ€è¿æ¥æ—¶ï¼ŒAPI æœºåˆ¶åº”è¯¥ä¸éœ€è¦è®¿é—® @command{gawk} çš„ç¬¦å·ã€‚
@footnote{@dfn{ç¬¦å·}æ˜¯å®šä¹‰åœ¨ @command{gawk} ä¸­çš„å˜é‡ä¸å‡½æ•°ã€‚åœ¨ @command{gawk} å¤–éƒ¨çš„è¿è¡Œæ—¶åŠ¨æ€è£…è½½ä»£ç ä¸­å¯¹è¿™äº›ç¬¦å·çš„è®¿é—®åœ¨ MS-Windows å¹³å°ä¸Šæ˜¯æœ‰é—®é¢˜çš„ã€‚}
è¿™æ ·åˆ›å»ºçš„æ‰©å±•ä¹Ÿå¯ä»¥ç”¨åœ¨ MS-Windows å¹³å°ä¸Šã€‚
@end itemize

åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œè¶Šæ¥è¶Šæ¸…æ™°çš„æ˜¯æœ‰ä¸€äº›ç‰¹æ€§éœ€è¦æä¾›ç»™æ‰©å±•ï¼Œåé¢ä¹Ÿæä¾›äº†ï¼š

@itemize @value{BULLET}
@item
æ‰©å±•åº”è¯¥æœ‰èƒ½åŠ›å°†å‹¾å­æ‰“å…¥ @command{gawk} çš„ I/O é‡å‘æœºåˆ¶ä¸­ã€‚ç‰¹åˆ«æ˜¯ @command{xgawk} çš„å¼€å‘è€…æä¾›äº†ä¸€ç§æ‰€è°“çš„â€œå¼€æ”¾å‹¾å­â€æ¥è¯»å–è®°å½•ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ‰©å±•å¯¹äºè¾“å…¥å¤„ç†ã€è¾“å‡ºå¤„ç†ä»¥åŠåŒè·¯ I/O çš„å‹¾å­éƒ½è¿›äº†ä¸€èˆ¬åŒ–ã€‚

@item
æ‰©å±•åº”è¯¥å¯ä»¥æä¾›å›è°ƒå‡½æ•°æ¥æ‰§è¡Œ @command{gawk} é€€å‡ºæ—¶çš„æ¸…ç†åŠ¨ä½œã€‚

@item
æ‰©å±•åº”è¯¥å¯ä»¥æä¾›ç‰ˆæœ¬å­—ä¸²ï¼Œè¿™æ · @command{gawk} çš„ @option{--version} é€‰é¡¹å¯ä»¥æä¾›æ‰©å±•çš„ç›¸å…³ä¿¡æ¯ã€‚
@end itemize

åˆçœ‹èµ·æ¥ï¼Œé¿å…è®¿é—® @command{gawk} çš„ç¬¦å·æ˜¯æ¯”è¾ƒéš¾å®ç°çš„ä¸€ä¸ªã€‚

åœ¨è®¾è®¡ä¸Šï¼Œå¾ˆæ˜æ˜¾ Perl ä¸ Ruby ä»¥åŠå…¶ä»–çš„è¯­è¨€ï¼Œå¯ä»¥ä½¿ä¸»çº¿çš„ @command{gawk} ä»£ç æˆä¸ºä¸€ä¸ªåº“ï¼Œ@command{gawk} ä½¿ç”¨å°çš„ C @code{main()} å‡½æ•°æ¥è¿æ¥è¿™ä¸ªåº“ã€‚

è¿™çœ‹èµ·æ¥åƒæ‘‡ç€å°¾å·´çš„ç‹—ï¼Œä¼šå¯¼è‡´æ„å»ºä¸å®‰è£…å¤æ‚åŒ–ï¼Œä½¿å¾—åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­ï¼ˆæˆ–è€…åŒä¸€ä¸ªç³»ç»Ÿä¸­çš„ä¸åŒåœ°æ–¹ï¼‰éƒ½ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„ @command{gawk} æ‰§è¡Œæ–‡ä»¶ã€‚

æˆ‘ä»¬æ¥å—äº† Pat Rankin æå‡ºçš„å»ºè®®ã€‚æŸ¥çœ‹ @ref{Extension Mechanism Outline}ï¼Œæ¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚

@node Extension Other Design Decisions
@appendixsubsec å…¶ä»–çš„è®¾è®¡å†³ç­–

ä½œä¸ºä»»æ„çš„è®¾è®¡å†³ç­–ï¼Œæ‰©å±•å¯ä»¥è¯»å–é¢„å®šä¹‰å˜é‡ä¸æ•°ç»„çš„å€¼ï¼ˆå¦‚ @code{ARGV} ä¸ @code{FS}ï¼‰ï¼Œä½†æ˜¯ä¸å¯ä»¥æ”¹å˜å®ƒä»¬ï¼Œé™¤äº† @code{PROCINFO} å¤–ã€‚

åŸå› æ˜¯ä¸ºäº†æ‰©å±•å‡½æ•°å½±å“ @command{awk} ç¨‹åºæµï¼Œä½¿å…¶ä¸å¯æŒ‰ã€‚è€Œä¸€ä¸ªçœŸæ­£çš„ @command{awk} å‡½æ•°å¯ä»¥åšå®ƒè‡ªå·±æƒ³åšçš„äº‹æƒ…ï¼Œè¿™ä¸ªåˆ™ç”±ç¨‹åºå‘˜è‡ªå·±æ¥åˆ¤æ–­ã€‚æ‰©å±•å‡½æ•° åº”è¯¥æä¾›ä¸€ä¸ªæœåŠ¡æˆ–è€…ä½¿ C API å¯ä»¥åœ¨ @command{awk} ä¸­å¯ä»¥ä½¿ç”¨ã€‚è€Œä¸æ˜¯å°† @code{FS}ï¼Œ@code{ARGC} ä»¥åŠ @code{ARGV} å¼„ä¹±ã€‚

å¦å¤–ï¼Œå¾ˆå®¹æ˜“å°±å¯ä»¥åœ¨ä¸€ä¸ªæ»‘æ»‘çš„æ–œå¡ä¸Šå¼€å¤´ï¼ˆå³ä¸€æ—¦å¼€å¯åˆ¹ä¸ä½â€”â€”è¯‘è€…æ³¨ï¼‰ã€‚æ‰©å±•åˆ°åº•éœ€è¦è®¿é—®å¤šå°‘çš„ @command{gawk} å·¥å…·ï¼Ÿå®ƒä»¬æ˜¯å¦éœ€è¦ @code{getline}ï¼Ÿæ˜¯å¦å¯ä»¥è°ƒç”¨ @code{gsub()} æˆ–è€…ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ï¼Ÿç›´æ¥è°ƒç”¨ @command{awk} å‡½æ•°å¦‚ä½•ï¼Ÿï¼ˆ@emph{è¿™}ä¼šå¼„å¾—ä¹±ä¹±çš„ï¼‰

ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œ@command{gawk} å¼€å‘è€…ä»¥æœ€å®¹æ˜“çš„ï¼Œæœ€åŸºç¡€çš„ä½†æ˜¯ç¡®å®æœ‰ç”¨çš„å¼€å§‹ã€‚

å¦ä¸€ä¸ªå†³ç­–æ˜¯ï¼Œå°½ç®¡ @command{gawk} æä¾›äº†åƒ  MPFR è¿™æ ·çš„å¥½ä¸œè¥¿ï¼Œå†…éƒ¨ä½¿ç”¨æ•´æ•°ç´¢å¼•çš„æ•°ç»„ï¼Œè¿™äº›ç‰¹æ€§å¹¶æ²¡æœ‰å¼€æ”¾å‡ºæ¥ï¼Œä¸ºçš„æ˜¯ä¿è¯äº‹æƒ…çš„ç®€å•ï¼Œå¹¶å°é—­ @command{awk} çš„ä¼ ç»Ÿçš„è¯­ä¹‰ï¼ˆä¸æ‰©å¼ å…¶è¯­ä¹‰èŒƒå›´ï¼Œå¦‚ @command{gawk} æ˜¯ç”¨æ¥åšå­—ç¬¦å¤„ç†çš„å·¥å…·ï¼Œè€Œä¸æ˜¯æ•°å­¦è¿ç®—çš„å·¥å…·â€”â€”è¯‘è€…æ³¨ï¼‰ã€‚ï¼ˆäº‹å®ä¸Šï¼Œå†…éƒ¨ä½¿ç”¨æ•´æ•°æ¥ç´¢å¼•æ•°ç»„å¦‚æ­¤é€æ˜ï¼Œåœ¨æ–‡æ¡£ä¸­éƒ½æ²¡æœ‰è®°å½•ï¼ï¼‰

å…¶æ¬¡ï¼Œåœ¨ API ä¸­çš„æ‰€æœ‰å‡½æ•°éƒ½è¦æ£€æŸ¥å®ƒä»¬çš„æŒ‡é’ˆè¾“å…¥å‚æ•°æ˜¯ä¸æ˜¯éƒ½ä¸æ˜¯ @code{NULL}ã€‚å¦‚æœæ˜¯ï¼Œå°±è¿”å›é”™è¯¯ã€‚ï¼ˆå¯¹äºæ‰©å±•ä»£ç æ¥è¯´ï¼ŒéªŒè¯ä» @command{gawk} è¿”å›çš„æŒ‡é’ˆæ˜¯ä¸æ˜¯ @code{NULL} ä¹Ÿæ˜¯ä¸ªå¥½ä¸»æ„ã€‚è¿™æ ·çš„äº‹æƒ…ä¸ä¼šå‘ç”Ÿï¼Œä½†æ˜¯ @command{gawk} å¼€å‘è€…ä¹Ÿæ˜¯äººï¼Œä»–ä»¬æ®çŸ¥ä¸€ç›´ä»¥æ¥ä¹Ÿä¼šå¶å°”çŠ¯é”™è¯¯ã€‚ï¼‰

éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒAPI ä¹Ÿä¼šæ¼”åŒ–ï¼Œ@command{gawk} å¼€å‘è€…å¸Œæœ›è¿™å¯ä»¥ç”±ç”¨æˆ·çš„éœ€è¦æ¥é©±åŠ¨ã€‚ç›®å‰ï¼Œå½“å‰çš„ API çœ‹èµ·æ¥æ˜¯æä¾›äº†æœ€å°çš„ï¼Œä½†æ˜¯åŠŸèƒ½å¼ºå¤§çš„ç”¨æ¥åˆ›å»ºæ‰©å±•çš„ç‰¹æ€§é›†åˆã€‚

@node Extension Future Growth
@appendixsubsec æœªæ¥çš„å¢é•¿ç©ºé—´ 

åé¢ API å¯ä»¥ä¸¤ç§æ–¹å¼è¢«æ‰©å±•ï¼š

@itemize @value{BULLET}
@item
åœ¨ç¬¬ä¸€æ¬¡è£…è½½æ—¶ï¼Œ@command{gawk} ä¼ é€’ä¸€ä¸ªâ€œæ‰©å±• idâ€åˆ°æ‰©å±•ä¸­ã€‚ç›¸åº”çš„æ‰©å±•ç„¶ååœ¨æ¯ä¸ªå‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼ é€’è¿™ä¸ª id å› @command{gawk}ã€‚è¿™ä¸ªæœºåˆ¶å¯ä»¥ä½¿ @command{gawk} æ¥åŒºåˆ«è°ƒç”¨å®ƒçš„æ‰©å±•ï¼Œè€Œå®ƒä¹Ÿåº”è¯¥çŸ¥é“ã€‚

@item
ç±»ä¼¼çš„ï¼Œåœ¨æ³¨å†Œæ—¶ï¼Œæ‰©å±•ä¼ é€’ä¸€ä¸ªâ€œname spaceâ€åˆ° @command{gawk} ä¸­ã€‚è¿™ä¸ªå¯ä»¥å®ç°ä¸€ä¸ªæœªæ¥çš„æœºåˆ¶ï¼Œå¦‚å¯¹æ‰©å±•åŠŸèƒ½è¿›è¡Œåˆ†ç»„ï¼Œä»¥é¿å…åå­—çš„å†²çªã€‚
@end itemize

å½“ç„¶ï¼Œåœ¨å†™è¿™ä¸ªæ–‡å­—çš„æ—¶å€™ï¼Œå¯¹ä¸Šé¢çš„ä¸œè¥¿éƒ½è¿˜æ²¡æœ‰åšç›¸åº”çš„å†³ç­–ã€‚

@node Old Extension Mechanism
@appendixsec å¯¹æ—§æ‰©å±•çš„å…¼å®¹æ€§ 

åœ¨ @ref{Dynamic Extensions}ï¼Œä¸­æè¿°äº†æ‰€æ”¯æŒ API ä»¥åŠä¸º @command{gawk} å†™æ‰©å±•çš„æœºåˆ¶ã€‚è¿™ä¸ª API åœ¨ 4.1 @value{PVERSION}ä¸­å¼•å…¥ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šå¹´ä»¥æ¥ï¼Œ@command{gawk} æä¾›çš„æ‰©å±•æœºåˆ¶éƒ½éœ€è¦äº†è§£ @command{gawk} çš„å†…éƒ¨ï¼Œè¿™è®¾è®¡å¾—å¹¶ä¸å¥½ã€‚

ä¸ºäº†æä¾›ä¸€ä¸ªè½¬æ¢æ—¶æœŸï¼Œ@command{gawk} @value{PVERSION} 4.1 è¿˜ä¼šæ”¯æŒæœ€åˆçš„æ‰©å±•æœºåˆ¶ã€‚è¿™å¯¹äºä¸€ä¸ªä¸»è¦çš„å‘è¡Œç‰ˆæœ¬å‘¨æœŸæ˜¯è¿™æ ·çš„ã€‚åœ¨ä¸‹ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œè¿™ä¸ªæ”¯æŒä¹Ÿä¼šè¢«ä¸¢å¼ƒï¼Œå¹¶ä¸”ä»æºä»£ç ä¸­ç§»é™¤ã€‚

ç®€å•åœ°è¯´ï¼Œåˆå§‹é£æ ¼çš„æ‰©å±•å¯ä»¥åŒ…å« @file{awk.h} æ¥è¿›è¡Œç¼–è¯‘ã€‚å¦å¤–ï¼Œä½ å¿…é¡»åœ¨æ„å»ºæ—¶å®šä¹‰æ ‡è¯†ç¬¦ @samp{GAWK}ï¼ˆåœ¨ Unix é£æ ¼çš„ç¼–è¯‘å™¨ä¸­ä½¿ç”¨ @samp{-DGAWK}ï¼‰ã€‚å¦åˆ™ï¼Œåœ¨ @file{gawkapi.h} ä¸­çš„å®šä¹‰ä¼šä¸ @file{awk.h} ä¸­çš„å®šä¹‰ç›¸å†²çªï¼Œä½ çš„æ‰©å±•å°±æ²¡åŠæ³•æˆåŠŸç¼–è¯‘ã€‚

å¦‚å‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œä½ ä½¿ç”¨ @code{extension()} å†…ç½®å‡½æ•°æ¥è£…è½½ä¸€ä¸ªæ—§é£æ ¼çš„æ‰©å±•ï¼ˆè¿™ä¸ªå¹¶æ²¡æœ‰æ–‡æ¡£ï¼‰ã€‚è¿™ä¸ªå‡½æ•°ç„¶åæ‰¾åˆ°å¹¶è£…è½½åŒ…å«äº†æ‰©å±•çš„å…±äº«å¯¹è±¡æ–‡ä»¶ï¼Œå¹¶è°ƒç”¨ @code{dl_load()} C å‡½æ•°ã€‚

å› ä¸ºåˆå§‹é£æ ¼ä¸æ–°é£æ ¼çš„æ‰©å±•ä½¿ç”¨ä¸åŒçš„åˆå§‹åŒ–å‡½æ•°ï¼ˆ@code{dl_load()} ä¸ @code{dlload()}ï¼‰ä»–ä»¬å¯ä»¥å®‰å…¨åœ°è£…è½½åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼ˆå¯ä»¥åœ¨ @env{AWKLIBPATH} ä¸­æ‰¾åˆ°ï¼‰è€Œæ²¡æœ‰å†²çªã€‚

@command{gawk} çš„å¼€å‘å›¢é˜Ÿå¼ºçƒˆå»ºè®®ä½ å°†æ—§çš„æ‰©å±•è¿›è¡Œè½¬æ¢ï¼Œè¿™æ ·ä¸å¾—ä¸ä½¿ç”¨æ–°çš„ APIï¼Œå®ƒä»¬éƒ½åœ¨ @ref{Dynamic Extensions} ä¸­è¿›è¡Œäº†æè¿°ã€‚

@node Notes summary
@appendixsec æ€»ç»“

@itemize @value{BULLET}
@item
@command{gawk} çš„æ‰©å±•å¯ä»¥ä½¿ç”¨ @option{--traditional} æˆ–è€… @option{--posix} é€‰é¡¹è¢«ç¦ç”¨ã€‚å¦‚æœ @command{gawk} è¢«ç¼–è¯‘æ—¶ä½¿ç”¨äº† @samp{-DDEBUG}ï¼Œåˆ™ @option{--parsedebug} é€‰é¡¹ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚

@item
@command{gawk} çš„æºä»£ç é€šè¿‡å…¬å…±çš„ Git åº“è¿›è¡Œç»´æŠ¤ã€‚æ‰€æœ‰äººéƒ½å¯ä»¥æ£€å‡ºå¹¶æŸ¥çœ‹ä»£ç ã€‚

@item
æ¬¢è¿å¯¹ @command{gawk} ä½œå‡ºè´¡çŒ®ã€‚æœ¬@value{CHAPTER}ä¸­éšåçš„æ­¥éª¤æŒ‡å‡ºæ­¥éª¤å¯ä»¥è®©ä½ çš„è´¡çŒ®æ›´å®¹æ˜“åœ°ä¸ä»£ç åº“è¿›è¡Œæ•´åˆã€‚å¯¹å³å¯ç”¨äºæ–°ç‰¹æ€§çš„è´¡çŒ®ï¼Œä¹Ÿç”¨äºå°† @command{gawk} ç§»æ¤åˆ°å…¶ä»–çš„ç³»ç»Ÿã€‚

@item
@command{gawk} æœ‰ä¸€äº›é™åˆ¶â€”â€”ä¸€èˆ¬éƒ½æ˜¯ç”±æœºå™¨çš„æ¶æ„æ‰€å¯¼è‡´çš„ã€‚

@item
æ‰©å±• API çš„è®¾ç½®ç›®æ ‡æ˜¯è§£å†³å‰ä¸€ä¸ªæ‰©å±•æœºåˆ¶çš„å¤§é‡é—®é¢˜ï¼Œå¯ç”¨ @code{xgawk} é¡¹ç›®æ‰€éœ€è¦çš„ç‰¹æ€§ï¼Œå¹¶æä¾›åå‘çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚

@item
ä¹‹å‰çš„æ‰©å±•æœºåˆ¶åœ¨ @command{gawk} 4.1 @value{PVERSION}è¿˜æ˜¯æ”¯æŒçš„ï¼Œä½†æ˜¯@emph{ä¼š}åœ¨ä¸‹ä¸€ä¸ªä¸»è¦å‘å¸ƒç‰ˆæœ¬ä¸­ç§»é™¤ã€‚

@end itemize


@node Basic Concepts
@appendix åŸºæœ¬ç¼–ç¨‹æ¦‚å¿µ
@cindex programming, concepts
@cindex programming, concepts

è¿™ä¸€@value{APPENDIX}ä¸­å°è¯•å®šä¹‰ä¸€äº›åŸºæœ¬çš„æ¦‚å¿µä¸æœ¯è¯­ï¼Œå®ƒä»¬ä¼šåœ¨æœ¬@value{DOCUMENT}ä¸­ä½™ä¸‹éƒ¨åˆ†ä½¿ç”¨åˆ°ã€‚ç”±äºæœ¬ä¹¦æ˜¯ä¸€å…³äº @command{awk} çš„@value{DOCUMENT}ï¼Œè€Œä¸æ˜¯è®¡ç®—é€šç”¨ç¼–ç¨‹çš„@value{DOCUMENT}ï¼Œè¿™é‡Œæ‰€åŒ…å«çš„å†…å®¹ç›¸å½“ç²—ç³™ç®€å•ã€‚ï¼ˆå¦‚æœéœ€è¦æ›´å¤šçš„èƒŒæ™¯ï¼Œä½ å¯ä»¥å‚è€ƒæ›´å¤šå…¥é—¨æ€§è´¨çš„å†…å®¹ã€‚ï¼‰

@menu
* Basic High Level::            The high level view.
* Basic Data Typing::           A very quick intro to data types.
@end menu

@node Basic High Level
@appendixsec ç¨‹åºåšçš„æ˜¯ä»€ä¹ˆ

@cindex processing data
æœ€åŸºæœ¬çš„ï¼Œç¨‹åºçš„ä»»åŠ¡æ˜¯å¤„ç†è¾“å…¥æ•°æ®ï¼Œç„¶åäº§ç”Ÿè¾“å‡ºç»“æœã€‚

@ifnotdocbook
å¦‚å›¾ @ref{figure-general-flow}.
@end ifnotdocbook
@ifdocbook
å¦‚å›¾ @inlineraw{docbook, <xref linkend="figure-general-flow"/>}.
@end ifdocbook

@ifnotdocbook
@float Figure,figure-general-flow
@caption{é€šç”¨çš„ç¨‹åºæµç¨‹}
@center @image{general-program, , , General program flow}
@end float
@end ifnotdocbook

@docbook
<figure id="figure-general-flow" float="0">
<title>General Program Flow</title>
<mediaobject>
<imageobject role="web"><imagedata fileref="general-program.png" format="PNG"/></imageobject>
</mediaobject>
</figure>
@end docbook

@cindex compiled programs
@cindex interpreted programs
å›¾ä¸­çš„â€œç¨‹åºâ€å¯ä»¥æ˜¯ä¸€ä¸ªç¼–è¯‘å‹ç¨‹åº
@footnote{ç¼–è¯‘å‹ç¨‹åºä¸€èˆ¬ä½¿ç”¨ä½é˜¶è¯­è¨€æ¥å†™ï¼Œå¦‚ C ï¼ŒC++ æˆ–è€… Adaï¼Œç„¶åè¢«ç¿»è¯‘æˆ–è€…è¯´æ˜¯@dfn{ç¼–è¯‘}ä¸ºè®¡ç®—æœºå¯ç›´æ¥æ‰§è¡Œçš„å½¢å¼ã€‚}
ï¼ˆå¦‚ @command{ls}ï¼‰ï¼Œæˆ–è€…æ˜¯@dfn{è§£é‡Šå‹}ç¨‹åºã€‚åè€…ä¸­ï¼Œç‰¹å®šæœºå™¨ä¸Šçš„å¯æ‰§è¡Œç¨‹åºï¼Œå¦‚ @command{awk} è¯»å…¥ä½ çš„ç¨‹åºï¼Œç„¶åä½¿ç”¨ä½ ç¨‹åºä¸­çš„æŒ‡ä»¤æ¥å¤„ç†æ•°æ®ã€‚

@cindex programming, basic steps
å½“å†™ç¨‹åºæ—¶ï¼Œå…¶åŒ…å«å¦‚ä¸‹æœ€åŸºæœ¬çš„æ­¥éª¤ï¼Œ
When you write a program, it usually consists
of the following, very basic set of steps,
@ifnotdocbook
å¦‚å›¾ @ref{figure-process-flow}:
@end ifnotdocbook
@ifdocbook
å¦‚å›¾ @inlineraw{docbook, <xref linkend="figure-process-flow"/>}:
@end ifdocbook

@ifnotdocbook
@float Figure,figure-process-flow
@caption{Basic Program Steps}
@center @image{process-flow, , , Basic Program Stages}
@end float
@end ifnotdocbook

@docbook
<figure id="figure-process-flow" float="0">
<title>Basic Program Stages</title>
<mediaobject>
<imageobject role="web"><imagedata fileref="process-flow.png" format="PNG"/></imageobject>
</mediaobject>
</figure>
@end docbook

@table @asis
@item åˆå§‹åŒ–
è¿™æ˜¯åœ¨ç¨‹åºå¼€å§‹å¤„ç†æ•°æ®ä¹‹å‰æ‰€è¦åšçš„äº‹æƒ…ï¼Œå¦‚æ£€æŸ¥å‚æ•°ï¼Œåˆå§‹åŒ–éœ€è¦ä½¿ç”¨çš„æ•°æ®ç­‰ç­‰ã€‚è¿™ä¸ªæ­¥éª¤å¯¹åº”äº @command{awk} çš„ @code{BEGIN} è§„åˆ™ï¼ˆæŸ¥çœ‹ @pxref{BEGIN/END}ï¼‰ã€‚

å°±åƒä½ çƒ¤è›‹ç³•ï¼Œè¿™å¯èƒ½åŒ…å«å°†æ‰€æœ‰çš„ä¸åŒçš„ç¢—ä¸çƒ¤ç®±æ‘†æ”¾å¥½ï¼Œå¹¶ç¡®ä¿å‡†å¤‡å¥½æ‰€æœ‰çš„åŸæ–™ã€‚

@item å¤„ç†
è¿™é‡Œæ‰§è¡Œå®é™…å·¥ä½œã€‚ä½ çš„ç¨‹åºè¯»æ•°æ®ï¼Œä¸€æ¬¡ä¸€ä¸ªé€»è¾‘å—ï¼Œç„¶åå¤„ç†å®ƒã€‚

åœ¨å¤šæ•°çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä½ éœ€è¦æ‰‹å·¥ç®¡ç†æ•°æ®çš„è¯»å–ï¼Œæ£€æŸ¥çœ‹æ˜¯å¦ä¸€æ¬¡è¯»å–äº†å¤šå—ã€‚@command{awk} çš„æ¨¡å¼-åŠ¨ä½œèŒƒå›´ï¼ˆæŸ¥çœ‹ @pxref{Getting Started}ï¼‰å¸®ä½ å¤„ç†äº†è¿™ä¸ªæœºåˆ¶ã€‚

åœ¨çƒ¤é¢åŒ…ä¸­ï¼Œå¤„ç†å¯¹åº”äºå®é™…çš„åŠ³åŠ¨ï¼šæ‰“è›‹ï¼Œå’Œé¢ã€æ°´åŠå…¶ä»–åŸæ–™ï¼Œå¹¶ä¸”å°†å®ƒä»¬æ”¾åˆ°çƒ¤ç®±ä¸­ã€‚

@item Clean Up
ä¸€æ—¦å¤„ç†å®Œäº†æ‰€æœ‰çš„æ•°æ®ï¼Œä½ é€€å‡ºå‰ä½ è¿˜éœ€è¦åšä¸€äº›äº‹æƒ…ã€‚è¿™ä¸€ä¸ªæ­¥éª¤å¯¹åº”äº @command{awk} ä¸­çš„ @code{END} è§„åˆ™ï¼ˆæŸ¥çœ‹ @pxref{BEGIN/END}ï¼‰ã€‚

å½“è›‹ç³•ä»çƒ¤ç®±ä¸­å–å‡ºåï¼Œä½ è¿˜éœ€è¦å°†ä»–ä»¬æ”¾åˆ°å¡‘æ–™ç›’ä¸­ä»¥é˜²åˆ«æ˜¯æŸ“æŒ‡ï¼Œå¹¶æ´—å¹²å‡€ç¢—åŠå…¶ä»–å™¨çš¿ã€‚
@end table

@cindex algorithms
@dfn{ç®—æ³•}æ˜¯è¯¦ç»†çš„æŒ‡ä»¤é›†ï¼Œç”±æ­¤æ¥å®Œæˆå·¥ä½œæˆ–è€…å¤„ç†æ•°æ®ã€‚è¿™ä¸ªä¸çƒ¤è›‹ç³•çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚ç¨‹åºå®ç°äº†ç®—æ³•ã€‚é€šå¸¸ï¼Œæ˜¯ç”±ä½ æ¥è®¾è®¡å¹¶å®ç°ç®—æ³•ã€‚

@cindex records
@cindex fields
æˆ‘ä»¬åœ¨å‰é¢æ‰€è¯´çš„â€œé€»è¾‘å—â€ç§°ä¸º@dfn{è®°å½•}ï¼Œå¦‚ä¸€ä¸ªå…¬å¸å¯¹å‘˜å·¥æ‰€åšçš„è®°å½•ï¼Œæˆ–è€…å­¦æ ¡å¯¹å­¦ç”Ÿçš„è®°å½•ï¼Œæˆ–è€…åŒ»ç”Ÿå¯¹ç—…äººæ‰€åšçš„è®°å½•ç±»ä¼¼ã€‚æ¯ä¸ªè®°å½•éƒ½æœ‰å¾ˆå¤šç»„ä»¶ï¼Œå¦‚åä¸å§“ï¼Œç”Ÿæ—¥ï¼Œåœ°å€ç­‰ç­‰ã€‚ç»„ä»¶æŒ‡çš„æ˜¯è®°å½•ä¸­çš„@dfn{åŸŸ}ã€‚

è¯»å–æ•°æ®çš„åŠ¨ä½œç§°ä¸º@dfn{è¾“å…¥}ï¼Œæ¯«æ— ç–‘é—®ï¼Œäº§ç”Ÿç»“æœç§°ä¸º@dfn{è¾“å‡º}ã€‚å®ƒä»¬ä¸€èˆ¬åˆç§°ä¸ºâ€œè¾“å…¥/è¾“å‡ºâ€ï¼Œæ›´å¸¸ç”¨çš„æ˜¯ â€œI/Oâ€çš„ç®€ç§°ï¼ˆä½ ä¹Ÿå¯ä»¥çœ‹åˆ°å°† â€œè¾“å…¥â€ä¸â€œè¾“å‡ºâ€å½“æˆåŠ¨è¯ä½¿ç”¨ã€‚ï¼‰

@cindex data-driven languages
@cindex languages@comma{} data-driven
@command{awk} ç®€å•æ•°æ®çš„è¯»å–ï¼Œä»¥åŠå°†è®°å½•åˆ†æ‹†æˆåŸŸã€‚ä½ çš„ç¨‹åºçš„ä»»åŠ¡å°±æ˜¯å‘Šè¯‰ @command{awk} å¦‚ä½•æ¥å¤„ç†æ•°æ®ã€‚ä½ é€šè¿‡æè¿°è¦æŸ¥æ‰¾æ•°æ®çš„@dfn{æ¨¡å¼}ï¼Œä»¥åŠå½“å‘ç°è¿™äº›æ¨¡å¼çš„è®°å½•æ—¶æ‰€åšçš„@dfn{åŠ¨ä½œ}æ¥å®Œæˆä½ æ‰€è¦å®Œæˆçš„ä»»åŠ¡ã€‚è¿™æ˜¯ @command{awk} ç¨‹åº@dfn{æ•°æ®é©±åŠ¨}çš„ç‰¹ç‚¹ï¼Œå› æ­¤ä½¿ç”¨è¿™äº›ç¨‹åºæ˜“å†™æ˜“è¯»ã€‚

@node Basic Data Typing
@appendixsec è®¡ç®—æœºä¸­æ•°æ®çš„å€¼

@cindex variables
åœ¨ç¨‹åºä¸­ï¼Œä½ ä¼šè·Ÿè¸ªäº‹ä»¶çš„å€¼ä¸ä¿¡æ¯ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º@dfn{å˜é‡}ã€‚ä¸€ä¸ªå˜é‡åªæ˜¯ä¸€ä¸ªç»™å®šçš„å€¼çš„åå­—ï¼Œä¾‹å¦‚ @code{first_name},
@code{last_name}, @code{address} ç­‰ç­‰ã€‚å¯¹äºå½“å‰çš„è¾“å…¥è®°å½•ä»¥åŠè®°å½•çš„åŸŸæœ‰ç‰¹æ®Šçš„åå­—ã€‚ä½ å¯ä»¥å°†ä¸€ç»„æœ‰å…³çš„å€¼ç»„åˆåœ¨ä¸€èµ·è€Œæˆä¸ºæ•°ç»„ã€‚

@cindex values, numeric
@cindex values, string
@cindex scalar values
æ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨ @command{awk} ä¸­ï¼Œç”±æ•°ç»„ï¼Œå¦‚ 42 æˆ–è€… 3.1415927 æˆ–è€…å­—ä¸²ç»„æˆã€‚å­—ä¸²å®è´¨ä¸Šæ˜¯éæ•°å€¼å¤–çš„ä¸€åˆ‡ï¼Œä¾‹å¦‚ä¸€ä¸ªåå­—ã€‚å­—ä¸²æœ‰æ—¶æŒ‡@dfn{å­—ç¬¦å€¼}ï¼Œå› ä¸ºä»¬æ¯å­˜å‚¨ç»„æˆå­—ä¸²çš„å•ä¸ªçš„å­—ç¬¦ã€‚å•ä¸ªçš„å˜é‡ï¼ŒåŒ…å«æ•°ç»„ä¸å­—ä¸²å˜é‡éƒ½æŒ‡çš„æ˜¯@dfn{æ ‡é‡å€¼}ã€‚ä¸€ç»„å€¼ï¼Œå¦‚æ•°ç»„ï¼Œå°±ä¸æ˜¯æ ‡é‡ã€‚

åœ¨ @ref{Computer Arithmetic} ä¸­æä¾›äº†æ•°å€¼ç±»å‹ï¼ˆæ•´æ•°ä¸æµ®ç‚¹æ•°ï¼‰çš„åŸºæœ¬ä»‹ç»ï¼Œä»¥åŠå®ƒä»¬åœ¨è®¡ç®—æœºä¸­å¦‚ä½•è¢«ä½¿ç”¨ã€‚è¯·å‚è€ƒé‚£é‡Œçš„ä¿¡æ¯ï¼Œå…¶ä¸­ä¹ŸåŒ…å«ä¸€äº›æ³¨æ„äº‹é¡¹ã€‚

@cindex null strings
å½“ä½ å¯èƒ½ä¹ æƒ¯äºæ²¡æœ‰æ•°æ²¡æœ‰å€¼ï¼ˆå¦‚ 0ï¼‰çš„æ¦‚å¿µæ—¶ï¼Œä½ è¦ä¹ æƒ¯äºé›¶é•¿åº¦çš„å­—ç¬¦æ•°ç»„å¯èƒ½è¦å¤šè´¹ç‚¹åŠŸå¤«ã€‚ä½†æ˜¯ï¼Œç¡®å®å­˜åœ¨è¿™æ ·çš„äº‹æƒ…ã€‚å®ƒè¢«ç§°ä¸ºç©ºä¸²ã€‚@dfn{ç©ºä¸²}æ˜¯å­—ç¬¦æ•°æ®ä¸­æ²¡æœ‰å€¼ã€‚å°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ç©ºçš„ã€‚å®ƒåœ¨ @command{awk} ç¨‹åºä¸­å†™æˆï¼š@code{""}ã€‚

äººç±»ä¹ æƒ¯äºä»¥åè¿›åˆ¶ï¼Œå¦‚ä»¥ 10 ä¸ºåº•ï¼Œåœ¨ä»¥ 10 ä¸ºåº•çš„æƒ…å†µä¸‹ï¼Œæ•°å­—ä» 0 åˆ° 9ï¼Œç„¶åè¿›è¡Œè¿›ä½åˆ°ä¸‹ä¸€ä¸ªæ•°å­—ä½ã€‚ï¼ˆè¿˜è®°å¾—å­¦æ ¡é‡Œçš„ 42 = 4 x 10 + 2 å—ï¼Ÿï¼‰

æœ‰å…¶ä»–çš„æ•°å€¼åº•æ•°ã€‚è®¡ç®—ä¸€èˆ¬ä½¿ç”¨åº•æ•°ä¸º 2ï¼Œæˆ–è€…@dfn{äºŒè¿›åˆ¶}ï¼Œåº•æ•°ä¸º 8 æˆ–è€…@dfn{å…«è¿›åˆ¶}ï¼Œä»¥åŠåº•æ•°ä¸º 16 æˆ–è€…@dfn{åå…­è¿›åˆ¶}ã€‚åœ¨äºŒè¿›åˆ¶ä¸­ï¼Œæ¯ä¸€ä¸ªæ•°å€¼ä½è¡¨ç¤º 2 ä¹˜ä»¥æ‰€åœ¨æ•°å­—åˆ—çš„å€¼ã€‚æ¯ä¸ªä½è¦ä¹ˆåŒ…å« 0ï¼Œè¦ä¹ˆåŒ…å« 1ã€‚å› æ­¤äºŒè¿›åˆ¶ 1010 è¡¨ç¤º  (1 x 8) + (0 x 4) + (1 x 2) + (0 x 1)ï¼Œæˆ–è€…åè¿›åˆ¶çš„ 10ã€‚å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶åœ¨è¿™é‡Œæœ‰æ›´å¤šçš„è®¨è®º @ref{Nondecimal-numbers}ã€‚

åœ¨å¾ˆåº•å±‚çš„å±‚çº§ä¸Šï¼Œè®¡ç®—æœºéƒ½å°†å€¼å­˜æˆä¸€ç»„äºŒè¿›åˆ¶æ•°å­—ï¼Œæˆ–è€…æ˜¯@dfn{ä½}ã€‚ç°ä»£è®¡ç®—æœºå°†è¿™äº›ä½ç»„æˆåœ¨ 8 ä½ä¸€ç»„ï¼Œç§°ä¸º@dfn{å­—èŠ‚}ã€‚é«˜çº§çš„åº”ç”¨ç¨‹åºæœ‰æ—¶éœ€è¦ç›´æ¥å¤„ç†ä½æ“ä½œï¼Œ@command{gawk} ä¹Ÿæä¾›äº†è¿™äº›çš„æ“ä½œå‡½æ•°ã€‚

ç¨‹åºç”¨ç¨‹åºè¯­è¨€å†™æˆã€‚å¦‚æœæ²¡æœ‰ä¸Šåƒï¼Œä¹Ÿæ˜¯æˆç™¾çš„ç¨‹åºè¯­è¨€å­˜åœ¨ã€‚æœ€æµè¡Œçš„æ˜¯ C ç¨‹åºè¯­è¨€ã€‚C è¯­è¨€å¯¹äº @command{awk} è¯­è¨€çš„è®¾è®¡æœ‰å·¨å¤§çš„å½±å“ã€‚

@cindex Kernighan, Brian
@cindex Ritchie, Dennis
æœ‰å‡ ä¸ªç‰ˆæœ¬çš„ C è¯­è¨€ã€‚ç¬¬ä¸€ä¸ªç§°ä¸º â€œK&Râ€ Cï¼Œç”± Brian Kernighan ä¸ Dennis Ritchie å‘æ˜ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æœ¬å…³äº C è¯­è¨€ä¹¦çš„ä½œè€…ã€‚ï¼ˆDennis Ritchie åˆ›é€ äº†è¿™ä¸ªè¯­è¨€ï¼ŒBrian Kernighan æ˜¯ @command{awk} çš„ä½œè€…ä¹‹ä¸€ã€‚ï¼‰

åœ¨ 1980 å¹´ä»£ä¸­æœŸï¼Œäººä»¬å¼€å§‹åŠªåŠ›å½¢æˆä¸€ä¸ª C çš„å›½é™…æ ‡å‡†ã€‚è¿™ä¸ªå·¥ä½œåœ¨ 1989 å¹´å®Œæˆï¼Œäº§ç”Ÿäº† C çš„ ANSI æ ‡å‡†ã€‚è¿™ä¸ªæ ‡å‡†åœ¨ 1990 å¹´æˆä¸º ISO æ ‡å‡†ã€‚1999 å¹´ï¼Œä¸€ä¸ªä¿®è®¢ç‰ˆçš„ ISO C æ ‡å‡†æå‡ºå¹¶å‘å¸ƒã€‚å› æ­¤ ï¼ŒPOSIX @command{awk} æ˜¯ä¸ ISO 1999 çš„ C çš„å…¼å®¹çš„ã€‚


@node Glossary
@unnumbered åè¯è§£é‡Š

@table @asis
@item Actionï¼ˆåŠ¨ä½œï¼‰
ä¸€è¿ä¸²çš„é™„åŠ åˆ°è§„åˆ™ä¸­çš„è¯­åã€‚å¦‚æœè§„åˆ™çš„æ¨¡å¼åŒ¹é…äºè¾“å…¥è®°å½•ï¼Œåˆ™ @command{awk} ä¼šæ‰§è¡Œè§„åˆ™çš„åŠ¨ä½œã€‚åŠ¨ä½œæ€»æ˜¯åŒ…å«åœ¨èŠ±æ‹¬å·ä¸­ã€‚ï¼ˆæŸ¥çœ‹ @ref{Action Overview}ï¼‰

@cindex Ada programming language
@cindex programming languages, Ada
@item Ada
ä¸€ç§æœ€åˆç”±ç¾å›½å›½é˜²éƒ¨å®šä¹‰çš„ç¼–ç¨‹è¯­è¨€ã€‚å®ƒè®¾è®¡ç”¨æ¥å¼ºåˆ¶ä½¿ç”¨ä¸€ç§å¥½çš„è½¯ä»¶å·¥ç¨‹å®è·µã€‚

@cindex Spencer, Henry
@cindex @command{sed} utility
@cindex amazing @command{awk} assembler (@command{aaa})
@item Amazing @command{awk} Assembler
æ¥è‡ªå¤šä¼¦å¤šå¤§å­¦çš„ Henry Spencer å†™äº†ä¸€ä¸ªå¯é‡å®šç›®æ ‡æœºå™¨çš„æ±‡ç¼–å™¨ä½œä¸º @command{sed} ä¸ @command{awk} çš„è„šæœ¬ã€‚å®ƒåªæœ‰å‡ åƒè¡Œï¼ŒåŒ…å«äº†å‡ ä¸ª 8 ä½çš„å¾®å‹è®¡ç®—æœºçš„æœºå™¨æè¿°ã€‚å®ƒåº”è¯¥æ˜¯ç”¨å¦ä¸€ä¸ªè¯­è¨€å†™æˆçš„å¾ˆå¥½çš„ç¨‹åºä¾‹å­ã€‚ä½ å¯ä»¥ä»è¿™é‡Œå–å¾—ï¼š@uref{http://awk.info/?awk100/aaa}ã€‚

@cindex amazingly workable formatter (@command{awf})
@cindex @command{awf} (amazingly workable formatter) program
@item Amazingly Workable Formatter (@command{awf})
æ¥è‡ªå¤šä¼¦å¤šå¤§å­¦çš„ Henry Spencer ç”¨ @command{awk} ä¸ @command{sh} å†™äº†ä¸€ä¸ªæ ¼å¼åŒ–å™¨ï¼Œå¯ä»¥æ¥å— @samp{nroff -ms} ä¸ @samp{nroff -man} æ ¼å¼å‘½ä»¤çš„å¾ˆå¤§çš„å­é›†ã€‚å¯ä»¥ä»è¿™é‡Œè·å–ï¼š@uref{http://awk.info/?tools/awf}

@item Anchorï¼ˆé”šï¼‰
æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦ @samp{^} ä¸ @samp{$}ï¼Œç”¨æ¥å¼ºåˆ¶åŒ¹é…ä¸²çš„å¼€å§‹ä¸ç»“æŸã€‚

@cindex ANSI
@item ANSI
ç¾å›½å›½å®¶æ ‡å‡†å­¦ä¼šã€‚è¿™ä¸ªç»„ç»‡äº§ç”Ÿäº†å¾ˆå¤šçš„æ ‡å‡†ï¼Œå®ƒä»¬ä¸­æœ‰ C ä¸ C++ çš„ç¼–è¯‘è¯­è¨€æ ‡å‡†ã€‚è¿™äº›æ ‡å‡†é€šå¸¸ä¹Ÿä¼šæˆä¸ºå›½é™…æ ‡å‡†ã€‚æŸ¥çœ‹ â€œISO.â€ã€‚

@item Argumentï¼ˆå‚æ•°ï¼‰
å‚æ•°å¯ä»¥è¡¨ç¤ºä¸¤ä¸ªä¸åŒçš„ä¸œè¥¿ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªé€‰é¡¹æˆ–è€…æ˜¯ä¼ é€’åˆ°ä¸€ä¸ªä»å‘½ä»¤è¡Œä¸­è°ƒç”¨çš„å‘½ä»¤çš„@value{FN}ï¼Œæˆ–è€…æ˜¯ä¼ é€’åˆ°ç¨‹åºï¼Œå¦‚åœ¨ @command{awk} ä¸­@dfn{å‡½æ•°}ä¸­çš„ä»»ä½•ä¸œè¥¿ã€‚

åœ¨åä¸€ç§æƒ…å†µï¼Œå‚æ•°å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥ä¼ é€’ã€‚ä¸€ç§æ˜¯å°†å€¼ä¼ é€’ç»™è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå¦‚å˜é‡çš„ä¸€ä¸ªå¤æœ¬å¯ä»¥åœ¨è¢«è°ƒç”¨çš„å‡½æ•°ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯åŸå§‹çš„å€¼ä¸å¯ä»¥è¢«å‡½æ•°æ›´æ”¹ï¼›æˆ–è€…æ˜¯é€šè¿‡å¼•ç”¨æ¥ä¼ é€’ï¼Œå¦‚ä¸€ä¸ªå˜é‡çš„æŒ‡é’ˆä¼ é€’ç»™å‡½æ•°ï¼Œè¿™æ ·ï¼Œå‡½æ•°å°±å¯ä»¥ç›´æ¥ä¿®æ”¹å®ƒã€‚åœ¨ @command{awk} ä¸­ï¼Œæ ‡é‡éƒ½æ˜¯é€šè¿‡å€¼ä¼ é€’ï¼Œè€Œæ•°ç»„æ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’ã€‚æŸ¥çœ‹ â€œä»¥å€¼/å¼•ç”¨ä¼ é€’â€ã€‚

@item Arrayï¼ˆæ•°ç»„ï¼‰
åŒä¸€ä¸ªåå­—ä¸‹çš„ä¸€ç»„æ•°å€¼ã€‚å¾ˆå¤šçš„è¯­è¨€åªæä¾›é¡ºåºæ•°ç»„ã€‚@command{awk} æä¾›å…³è”æ•°ç»„ã€‚

@item Assertionï¼ˆæ–­è¨€ï¼‰
åœ¨ç¨‹åºä¸­çš„è¯­å¥æŒ‡å‡ºç¨‹åºåœ¨ä¸­æŸç‚¹ä¸Šæ¡ä»¶ä¸ºçœŸã€‚å¯¹äºåˆç†åŒ–ç¨‹åºçš„è¡Œä¸ºå¾ˆæœ‰ç”¨ã€‚

@item Assignmentï¼ˆèµ‹å€¼ï¼‰
ä¸€ä¸ª @command{awk} è¡¨è¾¾å¼ï¼Œç”¨ä¸€å¡Œç³Šæ¶‚æ”¹å˜ @command{awk} å˜é‡æˆ–è€…æ•°æ®å¯¹è±¡çš„å€¼ã€‚ä¸€ä¸ªå¯¹è±¡å¯è¢«èµ‹å€¼åˆ™ç§°ä¸º @dfn{lvalue}ã€‚è¢«èµ‹çš„å€¼ç§°ä¸º @dfn{rvalue}ã€‚æŸ¥çœ‹ @ref{Assignment Ops}ã€‚

@item Associative Arrayï¼ˆå…³è”æ•°ç»„ï¼‰
æ•°ç»„çš„ç´¢å¼•å¯ä»¥æ˜¯æ•°å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ä¸²ï¼Œä¸ä»…ä»…æ˜¯å›ºå®šé•¿åº¦çš„é¡ºåºæ•´æ•°ã€‚

@item @command{awk} Languageï¼ˆ@command{awk} è¯­è¨€ï¼‰
@command{awk} ç¨‹åºæ‰€ä½¿ç”¨çš„è¯­è¨€ã€‚

@item @command{awk} Programï¼ˆ@command{awk} ç¨‹åºï¼‰
@command{awk} ç¨‹åºç”±ä¸€è¿ç»­çš„@dfn{æ¨¡å¼}ä¸@dfn{åŠ¨ä½œ}ç»„æˆã€‚è¿™äº›åŠ¨ä½œç»Ÿç§°ä¸º@dfn{è§„åˆ™}ã€‚å¯¹äºæ¯ä¸ªè¾“å…¥çš„ç¨‹åºçš„è®°å½•ï¼Œç¨‹åºçš„è§„åˆ™ä¼šé¡ºåºå¤„ç†ã€‚@command{awk} ç¨‹åºä¹ŸåŒ…å«å®šä¹‰çš„å‡½æ•°ã€‚

@item @command{awk} Scriptï¼ˆ@command{awk} è„šæœ¬ï¼‰ 
@command{awk} ç¨‹åºçš„åˆ«ä¸€ä¸ªåå­—ã€‚

@item Bash
GNU ç‰ˆçš„æ ‡å‡† Shell
The GNU version of the standard shell
@ifnotinfo
(the @b{B}ourne-@b{A}gain @b{SH}ell).
@end ifnotinfo
@ifinfo
(the Bourne-Again SHell).
@end ifinfo
æŸ¥çœ‹ â€œBourne Shellâ€ã€‚

@item Binary
åŸºäºä¸¤ä¸ªç¬¦å·ï¼Œå…¶å€¼ä¸º @code{0}--@code{1}ã€‚å› ä¸ºç”µè·¯â€œè‡ªç„¶åœ°â€ä»¥ 2 ä¸ºåº•è¿›è¡Œå·¥ä½œï¼ˆå¯ä»¥ç›¸åƒæˆå¼€ä¸å…³ï¼‰ï¼Œåœ¨è®¡ç®—æœºçš„æ‰€æœ‰ä¸œè¥¿éƒ½ä»¥ 2 ä¸ºåº•è¿›è¡Œè®¡ç®—ã€‚æ¯ä¸€ä½éƒ½è¡¨ç¤º 2 çš„å¹‚ï¼Œè¢«ç§°ä¸º@dfn{ä½}ã€‚æ‰€ä»¥ï¼Œä»¥ 2 ä¸ºåº•çš„å€¼ 10101 ä¸åè¿›åˆ¶çš„ 21 ((1 x 16) + (1 x 4) + (1 x 1)) ç›¸åŒã€‚

ç”±äºä»¥ 2 ä¸ºåº•çš„æ•°å€¼å¾ˆå¿«å˜å¾—å¤ªé•¿è€Œéš¾äºè¯»å†™ï¼Œå®ƒä»¬ä¸€èˆ¬è¢«æŒ‰ 3 ä½è¿›è¡Œåˆ†ç»„ï¼ˆå³å®ƒä»¬å¯ä»¥æŒ‰å…«è¿›åˆ¶æ¥è¯»ï¼‰ï¼Œæˆ–è€…æŒ‰ 4 ä½è¿›è¡Œåˆ†ç»„ï¼ˆå³å®ƒä»¬å¯ä»¥æŒ‰åå…­è¿›åˆ¶æ¥è¯»ï¼‰ã€‚åœ¨ C ç¨‹åºæ²¡æœ‰ç›´æ¥çš„æ–¹å¼æ¥æ’å…¥ä»¥ 2 ä¸ºåº•çš„æ•°ã€‚å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ä»¥ 2 ä¸ºåº•ç”¨æ¥è¡¨ç¤ºè®¡ç®—æœºä¸­çš„æ•´æ•°ï¼Œå¯ä»¥ç›´æ¥è¡¨ç¤ºäº†è®¡ç®—æœºçš„å¤„ç†èƒ½åŠ›ã€‚ç°ä»¤çš„å¤§å¤šæ•°è®¡ç®—æœºä½¿ç”¨ 64 ä½æ¥è¡¨ç¤ºæ•´æ•°ï¼Œä½†æ˜¯è¿‡å»å¾ˆå¤šä½¿ç”¨ 32 ä½ï¼Œ16 ä½æˆ–è€… 8 ä½ã€‚æŸ¥çœ‹ @ref{Nondecimal-numbers}ã€‚

@item Bitï¼ˆä½ï¼‰
â€œäºŒè¿›åˆ¶æ•°å­—â€çš„ç®€ç§°ã€‚åœ¨è®¡ç®—æœºå†…å­˜ä¸­çš„æ‰€æœ‰å€¼æœ€ç»ˆéƒ½æˆä¸ºäºŒè¿›åˆ¶æ•°å­—ï¼šè¦ä¹ˆæ˜¯ 1 è¦ä¹ˆæ˜¯ 0ã€‚ä¸€ç»„ä½åˆ™å¯ä»¥æœ‰ä¸åŒçš„è§£é‡Šâ€”â€”å½“æˆæ•´æ•°ï¼Œæµ®ç‚¹æ•°ï¼Œå­—ç¬¦ï¼Œå¦ä¸€ä¸ªå†…å­˜å¯¹è±¡çš„åœ°å€ç­‰ç­‰ã€‚@command{awk} å¯ä»¥è®©ä½ å¤„ç†æµ®ç‚¹æ•°ä¸å­—ä¸²ã€‚@command{gawk} å¯ä»¥è®©ä½ ç”¨ä½æ“ä½œå‡½æ•°æ¥æ“ä½œä½ï¼ˆæŸ¥çœ‹ @ref{Bitwise Functions}ï¼‰ã€‚

è®¡ç®—æœºä¸€èˆ¬éƒ½æ˜¯ä»¥ç”¨å¤šå°‘ä½æ¥è¡¨ç¤ºæ•´æ•°æ¥å®šä¹‰çš„ã€‚å…¸å‹çš„ç³»ç»Ÿæœ‰ 32 ä½ç³»ç»Ÿï¼Œä½†æ˜¯ 64 ä½ç³»ç»Ÿä¹Ÿèµ·æ¥è¶Šæµè¡Œï¼Œ16 ä½çš„ç³»ç»Ÿä¼šæ…¢æ…¢æ¶ˆå¤±ã€‚

@item Boolean Expressionï¼ˆå¸ƒæ—è¡¨è¾¾å¼ï¼‰
ä»¥è‹±å›½æ•°æ•°å®¶ Boole æ¥å‘½åï¼ŒæŸ¥çœ‹â€œé€»è¾‘è¡¨è¾¾å¼â€ã€‚

@item Bourne Shell
åœ¨ Unix æˆ–è€…ç±» Unix ç³»ç»Ÿä¸Šçš„æ ‡å‡† Shellï¼ˆ@file{/bin/sh}ï¼‰ï¼Œæœ€åˆç”±è´å°”å®éªŒå®¤çš„ Steven  R.@: Bourne å†™æˆã€‚å¾ˆå¤šçš„ Shell ï¼ˆBash, @command{ksh}, @command{pdksh}, @command{zsh}ï¼‰éƒ½ä¸ Bourne  Shell å…¼å®¹ã€‚

@item Bracesï¼ˆèŠ±æ‹¬å·ï¼‰
å­—ç¬¦ @samp{@{} ä¸ @samp{@}}ã€‚èŠ±æ‹¬å·ç”¨åœ¨ @command{awk} ç”¨äºåŒºåˆ†ç”±è¯­å¥ä¸å‡½æ•°ä½“ç»„æˆçš„åŠ¨ä½œã€‚

@item Bracket Expressionï¼ˆæ–¹æ‹¬å·è¡¨è¾¾å¼ï¼‰
åœ¨@dfn{æ­£åˆ™è¡¨è¾¾å¼}ä¸­ï¼ŒåŒ…å«åœ¨æ–¹æ‹¬å·ä¸­çš„è¡¨è¾¾å¼ï¼Œç”¨æ¥ä»£è¡¨å±äºæŸä¸ªå­—ç¬¦ç±»çš„å­—ç¬¦ã€‚æ–¹æ‹¬å·è¡¨è¾¾å¼å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦çš„åˆ—è¡¨ï¼Œå¦‚ @samp{[abc]}ï¼Œæˆ–è€…å­—ç¬¦èŒƒå›´ï¼Œå¦‚ @samp{[A-Z]}ï¼Œæˆ–è€…ä¸€ä¸ªç”¨ @samp{:} åˆ†å‰²çš„åå­—ï¼Œå…¶è¡¨ç¤ºä¸€ä¸ªå·²çŸ¥çš„å­—ç¬¦é›†ï¼Œå¦‚ @samp{[:digit:]}ã€‚åŒ…å«åœ¨ @samp{:} ä¹‹é—´çš„è¡¨è¾¾å¼çš„æ–¹æ‹¬å·è¡¨è¾¾å¼å½¢å¼ä¸å­—ç¬¦æœ¬èº«çš„è¡¨ç¤ºæ˜¯æ— å…³çš„ï¼Œå¯ä»¥æ˜¯ ASCII  ï¼Œä¹Ÿå¯ä»¥ECBDIC ï¼Œè¿˜å¯ä»¥æ˜¯ Unicode  ç¼–ç é›†ï¼Œåˆ™è¦è§†è®¡ç®—ç³»ç»Ÿçš„æ¶æ„ä¸æœ¬åœ°é…ç½®ã€‚æŸ¥çœ‹â€œæ­£åˆ™è¡¨è¾¾å¼â€ã€‚

@item Built-in Functionï¼ˆå†…ç½®å‡½æ•°ï¼‰
@command{awk} è¯­è¨€æä¾›äº†å†…ç½®å‡½æ•°æ¥æ‰§è¡Œå„ç§æ•°å€¼ã€I/Oç›¸å…³ã€å­—ä¸²è®¡ç®—ç­‰æ“ä½œã€‚ä¾‹å­æœ‰ @code{sqrt()}ï¼ˆç”¨æ¥è®¡ç®—æ•°ç»„çš„å¹³æ–¹æ ¹ï¼‰ä¸ @code{substr()}ï¼ˆç”¨æ¥å–å­—ä¸²çš„å­ä¸²ï¼‰ã€‚@command{gawk} æä¾›äº†ç”¨äºæ—¶é—´æˆ³å¤„ç†ï¼Œä½æ“ä½œï¼Œæ•°ç»„æ’åºï¼Œç±»å‹æ£€æŸ¥ä»¥åŠè¿è¡Œæ—¶å­—ä¸²ç¿»è¯‘çš„å‡½æ•°ã€‚ï¼ˆæŸ¥çœ‹ @ref{Built-in}ã€‚ï¼‰

@item Built-in Variableï¼ˆå†…ç½®å˜é‡ï¼‰
@code{ARGC},
@code{ARGV},
@code{CONVFMT},
@code{ENVIRON},
@code{FILENAME},
@code{FNR},
@code{FS},
@code{NF},
@code{NR},
@code{OFMT},
@code{OFS},
@code{ORS},
@code{RLENGTH},
@code{RSTART},
@code{RS}
å’Œ
@code{SUBSEP}
æ˜¯å¯¹ @command{awk} éƒ½æœ‰ç‰¹æ®Šçš„å«ä¹‰çš„å˜é‡ã€‚å¦å¤–ï¼Œ
@code{ARGIND},
@code{BINMODE},
@code{ERRNO},
@code{FIELDWIDTHS},
@code{FPAT},
@code{IGNORECASE},
@code{LINT},
@code{PROCINFO},
@code{RT}
å’Œ
@code{TEXTDOMAIN}
æ˜¯å¯¹äº @command{gawk} æœ‰ç‰¹æ®Šå«ä¹‰çš„å˜é‡ã€‚å¯¹äº›å˜é‡çš„æ›´æ”¹ï¼Œä¼šå½±å“ @command{awk} çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚ï¼ˆæŸ¥çœ‹ @ref{Built-in Variables}ï¼‰

@item C
å¾ˆå¤šçš„ GNU è½¯ä»¶éƒ½ä½¿ç”¨å…¶ç¼–å†™çš„ä¸€ç§ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ã€‚@command{awk} ç¼–ç¨‹è¯­è¨€æœ‰ C é£æ ¼çš„è¯­æ³•ï¼Œæœ¬@value{DOCUMENT}ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆé€‚çš„æ—¶å€™ä¹Ÿæå‡ºäº† @command{awk} ä¸ C ä¹‹é—´çš„å·®å¼‚ã€‚

ä¸€èˆ¬æ¥è®²ï¼Œ@command{gawk} å°è¯•ä½¿å…¶ä¸ 1990 å¹´çš„ ISO C ç‰ˆæœ¬ç›¸ä¼¼è¿˜æœ‰æœ‰æ„ä¹‰çš„ã€‚

@item C Shell
C Shellï¼ˆ@command{csh} æˆ–è€…å…¶å¢å¼ºç‰ˆæœ¬ @command{tcsh}ï¼‰æ˜¯ä¸€ä¸ª Unix Shellï¼Œç”± Bill Joy åœ¨ 1970 å¹´æ™šäº›æ—¶å€™ç¼–å†™ã€‚C Shell ä¸å…¶ä»–çš„ Shell ä¹‹é—´çš„ä¸åŒåœ¨äºå…¶äº¤äº’ç‰¹æ€§ä»¥æ•´ä½“é£æ ¼ï¼Œå®ƒçœ‹èµ·æ¥æ›´åƒ Cã€‚C Shell æ²¡æœ‰å‘åå…¼å®¹ Bourne Shellï¼Œæ‰€ä»¥ï¼Œå°†å…¶ä»–çš„ Unix Shell å†™çš„è„šæœ¬è½¬æ¢æˆ C Shell çš„æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå˜é‡çš„ç®¡ç†ã€‚æŸ¥çœ‹â€œBourne Shellâ€ã€‚

@item C++
ç”± C è¡ç”Ÿå‡ºæ¥çš„ä¸€ç§é¢å‘å¯¹è±¡çš„å¾ˆæµè¡Œçš„ç¼–ç¨‹è¯­è¨€ã€‚

@item Character Class
æŸ¥çœ‹â€œæ–¹æ‹¬å·è¡¨è¾¾å¼â€ã€‚

@item Character List
æŸ¥çœ‹â€œæ–¹æ‹¬å·è¡¨è¾¾å¼â€ã€‚

#TODO
@cindex ASCII
@cindex ISO 8859-1
@cindex ISO Latin-1
@cindex character sets (machine character encodings)
@cindex Unicode
@item å­—ç¬¦é›†
ç”±è®¡ç®—æœºç³»ç»Ÿç”¨æ¥è¡¨ç¤ºç‰¹å®šå›½å®¶æˆ–è€…åœ°åŒºçš„å­—ç¬¦ï¼ˆå­—æ¯ï¼Œæ•°å­—ï¼Œæ ‡ç‚¹ç­‰ï¼‰çš„æ•°å€¼ç¼–ç é›†åˆã€‚ç›®å‰ä½¿ç”¨æœ€å¤šçš„å¸¸ç”¨å­—ç¬¦é›†æ˜¯ ASCIIï¼ˆç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ç¼–ç ï¼‰ã€‚å¾ˆå¤šçš„æ¬§æ´²å›½å®¶ä½¿ç”¨ ASCII çš„æ‰©å±•é›†ï¼ŒISO-8859-1ï¼ˆISO-Latin-1ï¼‰ã€‚@uref{http://www.unicode.org, Unicode å­—ç¬¦é›†}ä½¿ç”¨å¾—è¶Šæ¥è¶Šæ™®éï¼Œå¹¶å½¢æˆç›¸åº”çš„æ ‡å‡†ï¼Œç‰¹åˆ«æ˜¯åœ¨ GNU/Linux ç³»ç»Ÿä¸Šè¢«å¹¿æ³›åœ°ä½¿ç”¨ã€‚


@cindex Kernighan, Brian
@cindex Bentley, Jon
@cindex @command{chem} utility
@item CHEM
@command{pic} çš„é¢„å¤„ç†å™¨ï¼Œç”¨æ¥è¯»å–åˆ†å­çš„æè¿°å¹¶äº§ç”Ÿ @command{pic} è¾“å…¥ï¼Œç”¨äºæè¿°ã€‚å®ƒç”± Brian Kernighan ä¸ Jon Bentley ç”¨ @command{awk} å†™æˆã€‚å¹¶åœ¨æ­¤å¯å¾—åˆ°ï¼š@uref{http://netlib.org/typesetting/chem}ã€‚

@item Comparison Expressionï¼ˆæ¯”è¾ƒè¡¨è¾¾å¼ï¼‰
ç»“æœä¸º true æˆ–è€… false çš„å…³ç³»ï¼Œå¦‚ @samp{a < b}ã€‚æ¯”è¾ƒè¡¨è¾¾å¼ä½¿ç”¨åœ¨ @code{if}, @code{while}, @code{do} ä¸ @code{for} è¯­å¥ä¸­ï¼Œä»¥åŠæ¨¡å¼ä¸­ç”¨æ¥ä»è¾“å…¥è®°å½•ä¸­é€‰æ‹©è®°å½•è¿›è¡Œå¤„ç†ã€‚ï¼ˆæŸ¥çœ‹ @ref{Typing and Comparison}ã€‚ï¼‰

@cindex compiled programs
@item Compilerï¼ˆç¼–è¯‘å™¨ï¼‰
ç”¨æ¥å°†äººå¯è¯»çš„æºä»£ç ç¿»è¯‘æˆæœºå™¨å¯æ‰§è¡Œå¯¹è±¡ä»£ç çš„ç¨‹åºã€‚å¯¹è±¡ä»£ç ç„¶åç›´æ¥è¢«è®¡ç®—æœºæ‰§è¡Œã€‚æŸ¥çœ‹â€œè§£é‡Šå™¨â€ã€‚

@item Complemented Bracket Expressionï¼ˆè¡¥æ–¹æ‹¬å·è¡¨è¾¾å¼ï¼‰
@dfn{æ–¹æ‹¬å·è¡¨è¾¾å¼}çš„åé¢ã€‚è¡¨ç¤ºæ‰€æœ‰çš„@emph{æ²¡æœ‰}åœ¨ç»™å®šçš„æ–¹æ‹¬å·è¡¨è¾¾å¼çš„ä¸œè¥¿ã€‚ç¬¦å· @samp{^} æ”¾åœ¨åæ–¹æ‹¬å·è¡¨è¾¾å¼çš„å‰é¢ã€‚å¦‚ï¼š@samp{[[^:digit:]} è¡¨ç¤ºæ‰€æœ‰çš„éæ•°å­—å­—ç¬¦ã€‚@samp{[^bad]} è¡¨ç¤ºä¸æ˜¯ @samp{b}, @samp{a} æˆ– @samp{d} çš„æ‰€æœ‰å­—ç¬¦ã€‚æŸ¥çœ‹â€œæ–¹æ‹¬å·è¡¨è¾¾å¼â€ã€‚

@item Compound Statementï¼ˆå¤åˆè¯­å¥ï¼‰
è¿ç»­çš„åŒ…å«åœ¨èŠ±æ‹¬å·ä¸­çš„ @command{awk} è¯­å¥ã€‚å¤åˆè¯­å¥å¯ä»¥å†…åµŒã€‚ï¼ˆæŸ¥çœ‹ @ref{Statements}ã€‚ï¼‰

@item Computed Regexpsï¼ˆè®¡ç®—å‹æ­£åˆ™è¡¨è¾¾å¼ï¼‰
æŸ¥çœ‹ â€œåŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼â€ã€‚

@item Concatenationï¼ˆè¿æ¥ï¼‰
å°†ä¸¤ä¸ªå­—ä¸²è¿›è¡Œè¿æ¥è¡¨ç¤ºå°†å®ƒä»¬åˆæˆä¸€å—ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªï¼Œæ¥äº§ç”Ÿä¸€ä¸ªæ–°çš„ä¸²ã€‚å¦‚ä¸² @samp{foo} ä¸ä¸² @samp{bar} è¿›è¡Œè¿æ¥ï¼Œä¼šäº§ç”Ÿä¸² @samp{foobar}ã€‚ï¼ˆæŸ¥çœ‹ @ref{Concatenation}.ã€‚ï¼‰

@item Conditional Expressionï¼ˆæ¡ä»¶è¡¨è¾¾å¼ï¼‰
ä½¿ç”¨ @samp{?:} ä¸‰å…ƒæ“ä½œç¬¦çš„è¡¨è¾¾å¼ï¼Œå¦‚ @samp{@var{expr1} ? @var{expr2} : @var{expr3}}ã€‚è¡¨è¾¾å¼ @var{expr1} æ±‚å€¼ï¼Œå¦‚æœç»“æœä¸º trueï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ä¸º @var{expr2} çš„å€¼ï¼Œå¦åˆ™ä¸º @var{expr3} çš„å€¼ã€‚åœ¨æ¯ç§æƒ…å†µä¸‹ï¼Œåªä¼šå¯¹ @var{expr2} æˆ–è€… @var{expr3} ä¹‹ä¸€è¿›è¡Œæ±‚å€¼ã€‚ï¼ˆæŸ¥çœ‹ @ref{Conditional Exp}ã€‚ï¼‰

@item Control Statementï¼ˆæ§åˆ¶è¯­å¥ï¼‰
æ§åˆ¶è¯­å¥æ˜¯ @command{awk} ç¨‹åºä¸­çš„ï¼Œå¦‚æœæ¡ä»¶ä¸º trueï¼Œåˆ™ä¼šæ‰§è¡Œä¸€ä¸ªæ‰§è¡Œç»™å®šæ“ä½œæˆ–è€…æ“ä½œé›†çš„æŒ‡ä»¤ã€‚æ§åˆ¶è¯­å¥æœ‰ï¼š@code{if}ï¼Œ@code{for}ï¼Œ@code{while}ï¼Œä»¥åŠ @code{do}ï¼ˆæŸ¥çœ‹ @pxref{Statements}ï¼‰ã€‚

@cindex McIlroy, Doug
@cindex cookie
@item Cookie
ä¸€ç§ç‰¹æ®Šçš„ç”œç‚¹ç¬¦å·ï¼Œç”±ç¨‹åºäº§ç”Ÿæˆ–è€…ä¼ é€’ç»™ç¨‹åºçš„å½±åƒã€‚ï¼ˆæ„Ÿè°¢ Doug McIlroy æ•™æˆã€‚ï¼‰
@ignore
From: Doug McIlroy <doug@cs.dartmouth.edu>
Date: Sat, 13 Oct 2012 19:55:25 -0400
To: arnold@skeeve.com
Subject: Re: origin of the term "cookie"?

I believe the term "cookie", for a more or less inscrutable
saying or crumb of information, was injected into Unix
jargon by Bob Morris, who used the word quite frequently.
It had no fixed meaning as it now does in browsers.

The word had been around long before it was recognized in
the 8th edition glossary (earlier editions had no glossary):

cookie   a peculiar goodie, token, saying or remembrance
returned by or presented to a program. [I would say that
"returned by" would better read "produced by", and assume
responsibility for the inexactitude.]

Doug McIlroy

From: Doug McIlroy <doug@cs.dartmouth.edu>
Date: Sun, 14 Oct 2012 10:08:43 -0400
To: arnold@skeeve.com
Subject: Re: origin of the term "cookie"?

> Can I forward your email to Eric Raymond, for possible addition to the
> Jargon File?

Sure. I might add that I don't know how "cookie" entered Morris's
vocabulary. Certainly "values of beta give rise to dom!" (see google)
was an early, if not the earliest Unix cookie.  The fact that it was
found lying around on a model 37 teletype (which had Greek beta in
its type box) suggests that maybe it was seen to be like milk and
cookies laid out for Santa Claus. Morris was wont to make such
connections.

Doug
@end ignore

@item Coprocessï¼ˆå¹¶ç¨‹ï¼‰
ä¸€ç§å­ç¨‹åºï¼Œé€šè¿‡å®ƒå¯è¿›è¡Œä¸¤è·¯é€šä¿¡ã€‚

@item Curly Bracesï¼ˆæ›²æ‹¬å·ï¼‰
æŸ¥çœ‹â€œèŠ±æ‹¬å·â€ã€‚

@cindex dark corner
@item Dark Cornerï¼ˆæš—è§’ï¼‰
è¯­è¨€è§„èŒƒä¸­å¸¸å¸¸ï¼ˆæˆ–è€…ä¾ç„¶ï¼‰ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œä»è€Œå¯¼è‡´éæœŸæœ›æˆ–è€…ä¸æƒ³è¦çš„è¡Œä¸ºã€‚è¿™äº›åœ°æ–¹åœ¨æœ¬@value{DOCUMENT}ä¸­é€šè¿‡åœ¨é¡µè¾¹ç©ºç™½ç”¨
@iftex
æ‰‹ç”µå›¾æ ‡
@end iftex
@ifnottex
æ–‡æœ¬ä¸­çš„ ``(d.c.)'' 
@end ifnottex
æ ‡å¿—å‡ºæ¥ï¼Œå¹¶åœ¨â€œæš—è§’â€æ®µä¸­è¿›è¡Œäº†ç´¢å¼•ã€‚

@item Data Drivenï¼ˆæ•°æ®é©±åŠ¨ï¼‰
@command{awk} ç¨‹åºçš„æè¿°ï¼Œè¡¨ç¤ºä½ æŒ‡å®šä½ æ„Ÿå…´è¶£çš„æ•°æ®æ¥è¿›è¡Œå¤„ç†ï¼Œä»¥åŠåœ¨å‘ç°è¿™äº›æ•°æ®æ—¶æ‰€æ‰§è¡Œçš„åŠ¨ä½œã€‚

@item Data Objectsï¼ˆæ•°æ®å¯¹è±¡ï¼‰
ä¸ºæ•°å€¼æˆ–è€…å­—ç¬¦ä¸²ã€‚åœ¨éœ€è¦çš„æ—¶å€™ï¼Œæ•°å€¼è¢«è½¬æ¢æˆå­—ä¸²ï¼Œæˆ–è€…åä¹‹ã€‚ï¼ˆæŸ¥çœ‹ @ref{Conversion}.ã€‚ï¼‰

@item Deadlockï¼ˆæ­»é”ï¼‰
ä¸¤ä¸ªé€šä¿¡çš„è¿›ç¨‹ç›¸äº’åœ¨ç­‰å¾…å¯¹æ–¹æ‰§è¡ŒæŸç§åŠ¨ä½œçš„çŠ¶æ€ã€‚

@item Debuggerï¼ˆè°ƒè¯•å™¨ï¼‰
ç”¨æ¥å¸®åŠ©å¼€å‘è€…ä»ç¨‹åºä¸­å»æ‰ Bugï¼ˆdebugï¼‰çš„ç¨‹åºã€‚

@item Double Precisionï¼ˆåŒç²¾åº¦ï¼‰
æ•°å€¼çš„å†…éƒ¨è¡¨è¾¾ï¼Œè¿™ä¸ªè¡¨å¼å¯ä»¥æœ‰åˆ†æ•°éƒ¨åˆ†ã€‚åŒç²¾åº¦æ•°å¯ä»¥æ¯”å•ç²¾åº¦è·Ÿè¸ªæ›´å¤šçš„æ•°å€¼ä½ï¼Œä½†æ˜¯å¯¹ä»–ä»¬çš„æ“ä½œçš„ä»£ç ä¹Ÿæ›´é«˜ã€‚è¿™æ˜¯ @command{awk} å­˜å‚¨æ•°æ®çš„æ–¹å¼ã€‚å®ƒçš„ç±»å‹ä¸º C çš„ @code{double} ç±»å‹ã€‚

@item Dynamic Regular Expressionï¼ˆåŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼ï¼‰
åŠ¨æ€æ­£åˆ™è¡¨è¾¾å¼æ˜¯å†™åœ¨å¸¸è§„è¡¨è¾¾å¼çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå­—ä¸²å¸¸é‡ï¼Œå¦‚ @code{"foo"}ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ˜¯åŸºå€¼å¯ä»¥å˜åŒ–çš„è¡¨è¾¾å¼ã€‚ï¼ˆæŸ¥çœ‹ @ref{Computed Regexps}ã€‚ï¼‰

@item Empty String
See ``Null String.''
æŸ¥çœ‹â€œ@code{Null} @code{String}â€

@item Environmentï¼ˆç¯å¢ƒï¼‰
å­—ä¸²çš„é›†åˆï¼Œå…¶æ ¼å¼ä¸º @samp{@var{name}=@var{val}}ï¼Œæ¯ä¸ªç¨‹åºéƒ½å¯ä»¥å–å¾—å®ƒã€‚ç”¨æˆ·é€šå¸¸å°†å€¼æ”¾åˆ°ç¯å¢ƒä¸­ï¼Œä»¥å‘ä¸åŒçš„ç¨‹åºä¼ é€’ä¿¡æ¯ã€‚å…¸å‹çš„ä¾‹å­æ˜¯ç¯å¢ƒå˜é‡ @env{HOME} ä¸ @env{PATH}ã€‚

@cindex epoch, definition of
@item Epoch
ç”¨æ¥è¡¨ç¤ºæ—¶é—´æˆ³çš„â€œå¼€å§‹æ—¶é—´â€çš„æ—¥æœŸã€‚å¤§å¤šæ•°ç³»ç»Ÿä¸­çš„æ—¶é—´å€¼éƒ½ç”¨ä» epoch å¼€å§‹çš„ç§’æ¥è¡¨ç¤ºã€‚ä½¿ç”¨åº“çš„å‡½æ•°å¯å°†è¿™äº›å€¼è½¬æ¢ä¸ºæ ‡å‡†æ—¥æœŸä»¥åŠæ—¶é—´æ ¼å¼ã€‚

Unix ä¸ POSIX ç³»ç»Ÿä¸Šçš„ epoch æ˜¯ 1970-01-01 00:00:00 UTCã€‚æŸ¥çœ‹ â€œGMTâ€ ä¸ â€œUTCâ€ã€‚

@item Escape Sequences
ç‰¹æ®Šå­—ç¬¦åºåˆ—ç”¨æ¥æè¿°éæ‰“å°å­—ç¬¦ï¼Œå¦‚ @samp{\n} ç”¨æ¥è¡¨ç¤ºæ¢è¡Œè¡Œç¬¦ï¼Œæˆ–è€… @samp{\033} ç”¨æ¥è¡¨ç¤º ASCII ä¸­çš„ ESCï¼ˆEscapeï¼‰å­—ç¬¦ã€‚ï¼ˆæŸ¥çœ‹ @ref{Escape Sequences}ã€‚ï¼‰

@item Extensionï¼ˆæ‰©å±•ï¼‰
é¢å¤–çš„ç‰¹æ€§ï¼Œæˆ–è€…æˆä¸ºç¼–ç¨‹è¯­è¨€æˆ–è€…å·¥å…·ï¼Œä½†æœªè¢«ç›¸åº”è¯­è¨€ä»¥åŠå·¥å…·æ ‡å‡†æ‰€å®šä¹‰ã€‚@command{gawk} ï¼ˆä¹Ÿï¼‰æœ‰è®¸å¤šçš„åœ¨POSIX @command{awk} ä¹‹å¤–çš„æ‰©å±•ã€‚

@item FDL
æŸ¥çœ‹ â€œè‡ªç”±æ–‡æ¡£è®¸å¯â€ã€‚

@item Fieldï¼ˆåŸŸï¼‰
å½“ @command{awk} è¯»å–ä¸€ä¸ªè¾“å…¥è®°å½•æ—¶ï¼Œå®ƒå°†è®°å½•åˆ†å‰²ä¸ºç”±ç©ºç™½ï¼ˆæˆ–è€…é€šè¿‡æ”¹å˜é¢„å®šä¹‰çš„ @code{FS} å˜é‡è€Œå°†æ­£åˆ™è¡¨è¾¾å¼è®¾ç½®æˆçš„åˆ†å‰²ç¬¦ï¼‰åˆ†å‰²çš„ç‰‡æ®µã€‚è¿™äº›ç‰‡æ®µè¢«ç§°ä¸ºåŸŸã€‚å¦‚æœç‰‡æ®µæ˜¯å›ºå®šé•¿åº¦çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨å†…ç½®å˜é‡ @code{FIELDWIDTHS} æ¥æè¿°å®ƒä»¬çš„é•¿åº¦ã€‚
å¦‚æœä½ å¸Œæœ›æŒ‡å®šåŸŸçš„å†…å®¹è€Œä¸æ˜¯åŸŸåˆ†å‰²ç¬¦ï¼Œä½ å¯ä»¥ä½¿ç”¨å³å®šä¹‰çš„å˜é‡ @code{FPAT} æ¥å¤„ç†ã€‚ï¼ˆæŸ¥çœ‹ @ref{Field Separators}ï¼Œ@ref{Constant Size}ï¼Œä¸ @ref{Splitting By Content}ã€‚ï¼‰

@item Flagï¼ˆæ ‡å¿—ï¼‰
ä¸€ä¸ªå˜é‡ï¼Œå…¶çœŸå€¼è¡¨ç¤ºæŸç§æ¡ä»¶æ˜¯å­˜åœ¨è¿˜æ˜¯ä¸å­˜åœ¨ã€‚

@item Floating-Point Numberï¼ˆæµ®ç‚¹æ•°ï¼‰
åœ¨æ•°å­¦çš„æœ¯è¯­ä¸­å¸¸æŒ‡ä¸ºâ€œæœ‰ç†æ•°â€æˆ–è€…å®æ•°ï¼Œè¿™åªæ˜¯ä¸€ä¸ªæœ‰å°æ•°éƒ¨åˆ†çš„æ•°ã€‚æŸ¥çœ‹â€œåŒç²¾åº¦â€ä¸â€œå•ç²¾åº¦â€ã€‚

@item Formatï¼ˆæ ¼å¼ï¼‰
æ ¼å¼ä¸²æ§åˆ¶ @code{strftime()} ä¸ @code{sprintf()} å‡½æ•°çš„è¾“å‡ºæ ·å¼ï¼ŒåŒæ—¶ä¹Ÿä¼šæ§åˆ¶ @code{printf} è¯­å¥ä¸­çš„æ ·å¼ã€‚å¦å¤–ï¼Œå°†æ•°å€¼è½¬æ¢ä¸ºå­—ä¸²çš„è½¬æ¢ä¹Ÿç”±é¢„å®šä¹‰çš„å˜é‡ @code{CONVFMT} ä¸ @code{OFMT} çš„æ ¼å¼ä¸²æ¥æ§åˆ¶ã€‚ï¼ˆæŸ¥çœ‹ @ref{Control Letters}ã€‚ï¼‰

@item Fortran
FORmula TRANslator çš„ç¼©å†™ï¼Œç¬¬ä¸€ä¸ªç”¨äºç§‘å­¦è®¡ç®—çš„ç¼–ç¨‹è¯­è¨€ã€‚ç”± John Backus åˆ›å»º ï¼Œå¹¶åœ¨ 1957 å¹´å°±å‘å¸ƒï¼Œç›®å‰ä¾ç„¶è¿˜åœ¨ä½¿ç”¨ã€‚

@item Free Documentation Licenseï¼ˆè‡ªç”±æ–‡æ¡£è®¸å¯ï¼‰
è¿™ä¸ªæ–‡æ¡£æè¿°äº†ä¸€äº›æ¡æ¬¾ï¼Œæœ¬@value{DOCUMENT}ä¹Ÿåœ¨è¿™äº›æ¡æ¬¾ä¸‹è¿›è¡Œå‘å¸ƒï¼Œä¹Ÿå¯ä»¥å¤åˆ¶ã€‚ï¼ˆæŸ¥çœ‹ @ref{GNU Free Documentation License}.ã€‚ï¼‰

@cindex FSF (Free Software Foundation)
@cindex Free Software Foundation (FSF)
@cindex Stallman, Richard
@item Free Software Foundationï¼ˆè‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šï¼‰
ä¸€ä¸ªéç›ˆåˆ©æ€§ç»„ç»‡ï¼Œå…¶è‡´åŠ›äºç”Ÿäº§ä¸å‘å¸ƒè‡ªç”±å‘å¸ƒçš„è½¯ä»¶ã€‚ç”± Richard M.@: Stallmanï¼Œå³ Emacs ç¼–è¾‘å™¨çš„æœ€åˆä½œè€…åˆ›ç«‹ã€‚GNU Emacs æ˜¯ç›®å‰ä½¿ç”¨æœ€å¤šçš„ Emacs ç‰ˆæœ¬ã€‚

@item FSF
æŸ¥çœ‹â€œè‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šâ€ã€‚

@item Functionï¼ˆå‡½æ•°ï¼‰
æ˜¯ @command{awk} ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­çš„ä»»ä½•ä½ç½®è¿›è¡Œè°ƒç”¨ï¼Œä»¥æ‰§è¡ŒæŸä¸ªä»»åŠ¡ã€‚@command{awk} æœ‰å¤šä¸ªå†…ç½®å‡½æ•°ã€‚ç”¨æˆ·å¯ä»¥å®šä¹‰ä»–ä»¬è‡ªå·±çš„å‡½æ•°ï¼Œå¯ä»¥æ”¾åœ¨ç¨‹åºä¸­çš„ä»»ä½•ä½ç½®ã€‚å‡½æ•°å¯ä»¥æ˜¯é€’å½’çš„ï¼Œå³å®ƒä»¬å¯ä»¥è°ƒç”¨è‡ªå·±ã€‚
æŸ¥çœ‹ @ref{Functions}ã€‚åœ¨ @command{gawk} ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„ç¨‹åºä¸­å…±äº«å‡½æ•°ï¼Œåœ¨éœ€è¦çš„ç¨‹åºä¸­ä½¿ç”¨ @code{@@include} æŒ‡ä»¤æ¥åŒ…å«ï¼ˆæŸ¥çœ‹ @pxref{Include Files}ï¼‰ã€‚
åœ¨ @command{gawk} ä¸­ï¼Œå¯ä»¥è°ƒç”¨çš„å‡½æ•°çš„åå­—å¯ä»¥åœ¨è¿è¡Œæ—¶ç”Ÿæˆï¼Œå³åŠ¨æ€ç”Ÿæˆã€‚@command{gawk} æ‰©å±• API æä¾›äº†æ„é€ å‡½æ•°ï¼ˆæŸ¥çœ‹ @pxref{Constructor Functions}ï¼‰ã€‚


@item @command{gawk}
@command{awk} çš„ GNU ç‰ˆæœ¬ã€‚

@cindex GPL (General Public License)
@cindex General Public License (GPL)
@cindex GNU General Public License
@item General Public Licenseï¼ˆé€šç”¨å…¬å…±è®¸å¯ï¼‰
è¿™äº›æ–‡ä»¶æè¿°çš„ä¸€äº›æ¡æ¬¾ï¼Œ@command{gawk} ä»¥åŠå®ƒçš„åŸä»£ç åœ¨è¿™äº›æ¡æ¬¾ä¸‹å‘å¸ƒã€‚ï¼ˆæŸ¥çœ‹ @ref{Copying}ã€‚ï¼‰

@item GMT
â€œGreenwich Mean Timeâ€ï¼ˆæ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ï¼‰ã€‚è¿™æ˜¯ @code{UTC} çš„æ—§æœ¯è¯­ã€‚å®ƒæ˜¯ Unix ä¸ POSIX ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„æ—¶æœŸæ—¶é—´ã€‚æŸ¥çœ‹ â€œEpochâ€ ä¸ â€œUTCâ€ã€‚

@cindex FSF (Free Software Foundation)
@cindex Free Software Foundation (FSF)
@cindex GNU Project
@item GNU
â€œGNU's not Unixâ€ã€‚æ˜¯ä¸€ä¸ªæŒç»­è¿è¡Œçš„è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šçš„é¡¹ç›®ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªå®Œå…¨çš„ï¼Œè‡ªç”±å‘å¸ƒçš„ POSIX å…¼å®¹çš„è®¡ç®—ç¯å¢ƒã€‚

@item GNU/Linux
æ˜¯ä½¿ç”¨ Linux Kernel çš„ GNU ç³»ç»Ÿçš„å˜ä½“ï¼Œè€Œä¸æ˜¯è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šçš„ Hurd å†…æ ¸ã€‚Linux å†…æ ¸æ˜¯ä¸€ä¸ªç¨³å®šï¼Œé«˜æ•ˆï¼Œå…¨åŠŸèƒ½çš„ Unix å…‹éš†ï¼Œå…¶è¢«ç§»æ¤åˆ°ä¸å„ç§ä¸åŒçš„æ„æ¶ä¸­ã€‚å®ƒæ˜¯æœ€æµè¡Œçš„ PC çº§çš„ç³»ç»Ÿï¼Œä½†æ˜¯ä¹Ÿåœ¨å…¶ä»–çš„ç³»ç»Ÿä¸­è¿è¡Œã€‚Linux å†…æ ¸æºä»£ç å¯ä»¥åœ¨ GNU é€šç”¨å…¬å…±è®¸å¯çš„æ¡æ¬¾ä¸‹è·å–ï¼Œè¿™å¯èƒ½æ˜¯å…¶æœ€é‡è¦æ–¹é¢ã€‚

@item GPL
æŸ¥çœ‹â€œé€šç”¨å…¬å…±è®¸å¯â€ã€‚

@item Hexadecimalï¼ˆåå…­è¿›åˆ¶ï¼‰
ä»¥ 16 ä¸ºåº•çš„è¡¨ç¤ºæ³•ï¼Œå…¶æ•°å­—ä¸º @code{0}--@code{9} ä»¥åŠ @code{A}--@code{F}ï¼Œ@samp{A} è¡¨ç¤º 10ï¼Œ@samp{B} è¡¨ç¤º 11ï¼Œç­‰ç­‰ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ @samp{F} è¡¨ç¤º 15ã€‚åå…­è¿›åˆ¶æ•°ç»„åœ¨ C ä¸­ä»¥ @samp{0x} å¼€å¤´ä»¥è¡¨ç¤ºå…¶åº•æ•°ã€‚å› æ­¤ @code{0x12} ä¸º 18((1 x 16) + 2)ã€‚æŸ¥çœ‹ @ref{Nondecimal-numbers}ã€‚

@item I/O
â€œInput/Outputâ€ çš„ç¼©å†™ï¼Œæ˜¯å°†æ•°æ®ç§»å…¥æˆ–è€…ç§»å‡ºæ‰§è¡Œç¨‹åºçš„åŠ¨ä½œã€‚

@item Input Recordï¼ˆè¾“å…¥è®°å½•ï¼‰
ç”± @command{awk} è¯»å–çš„ä¸€å—æ•°æ®ã€‚é€šå¸¸ï¼Œä¸€ä¸ª @command{awk} è¾“å…¥è®°å½•ç”±ä¸€è¡Œæ–‡æœ¬æ„æˆã€‚ï¼ˆæŸ¥çœ‹ @ref{Records}ã€‚ï¼‰

@item Integerï¼ˆæ•´æ•°ï¼‰
å®Œæ•´ä¹‹æ•°ï¼Œå³æ²¡æœ‰åŒ…å«å°æ•°éƒ¨åˆ†çš„æ•°å€¼ã€‚

@item Internationalizationï¼ˆå›½é™…åŒ–ï¼‰
ç¼–å†™æˆ–è€…ä¿®æ”¹ç¨‹åºçš„è¿‡ç¨‹ï¼Œä½¿å…¶å¯ä»¥åœ¨å¤šç§è¯­è¨€ä¸‹ä½¿ç”¨ï¼Œè€Œä¸ç”¨ä¿®æ”¹æºä»£ç ã€‚

@cindex interpreted programs
@item Interpreterï¼ˆè§£é‡Šå™¨ï¼‰
è¯»å–äººå¯è¯»çš„æºä»£ç ï¼Œç„¶åä½¿ç”¨å…¶å†…éƒ¨çš„æŒ‡ä»¤æ¥å¤„ç†æ•°æ®å¹¶äº§ç”Ÿç»“æœçš„ç¨‹åºã€‚@command{awk} å…¸å‹çš„æƒ…å†µä¸‹ï¼ˆä½†å¹¶ä¸æ€»æ˜¯ï¼‰å®ç°ä¸ºè§£é‡Šå™¨ã€‚æŸ¥çœ‹â€œç¼–è¯‘å™¨â€ã€‚

@item Interval Expressionï¼ˆåŒºé—´è¡¨è¾¾å¼ï¼‰
æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥è®©ä½ é‡å¤åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„æŸä¸ªéƒ¨åˆ†ã€‚åŒºé—´è¡¨è¾¾å¼æœ€åˆåœ¨ @command{awk} ç¨‹åºä¸­ä¸å¯ç”¨ã€‚

@cindex ISO
@item ISO
æ ‡å‡†åŒ–çš„å›½é™…ç»„ç»‡ã€‚è¿™ä¸ªç»„ç»‡ä¸ºå„ä¸ªæ–¹é¢äº§ç”Ÿå›½é™…æ ‡å‡†ï¼ŒåŒ…å«ç¨‹åºè¯­è¨€ï¼Œå¦‚ C ä¸ C++ã€‚åœ¨è®¡ç®—æ—¶ä»£ï¼Œé‡è¦çš„æ ‡å‡†è¯¸å¦‚ Cï¼ŒC++ ä»¥åŠ POSIX å³æˆä¸ºç¾å›½ç¾æ ‡ï¼Œä¹Ÿä¼šåŒæ—¶æˆä¸º ISO çš„å›½é™…æ ‡å‡†ã€‚æœ¬@value{DOCUMENT}æ‰€æŒ‡çš„æ ‡å‡† C å‡ä¸º â€œISO Câ€ã€‚æŸ¥çœ‹ @uref{http://www.iso.org/iso/home/about.htm, ISO çš„ç«™ç‚¹}æ¥è·å–æ›´å¤šçš„ç»„ç»‡åå­—åŠå…¶è¯­è¨€æ— å…³çš„ä¸‰å­—æ¯åŒæ„è¯ã€‚

@cindex Java programming language
@cindex programming languages, Java
@item Java
ä¸€ä¸ªç”± Sun Microsystemsï¼ˆç°åœ¨ä¸º Oracleï¼‰å¼€å‘çš„ç°ä»£ç¼–ç¨‹è¯­è¨€ï¼Œå…¶æ”¯æŒé¢å‘å¯¹è±¡çš„ç¨‹åºæ–¹å¼ã€‚å°½ç®¡é€šå¸¸é€šè¿‡ç¼–è¯‘ä¸ºæ ‡å‡†è™šæ‹ŸæœºæŒ‡ä»¤çš„æ–¹å¼æ¥å®ç°ï¼ˆJVMï¼‰ï¼Œè¿™ä¸ªè¯­è¨€ä¹Ÿå¯ä»¥ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ã€‚

@item Keywordï¼ˆå…³é”®è¯ï¼‰
åœ¨ @command{awk} è¯­è¨€ä¸­ï¼Œå…³é”®è¯æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚å…³é”®è¯æ˜¯ä¿ç•™çš„ï¼Œä¸å¯ä»¥ä½¿ç”¨çš„å˜é‡åã€‚@command{gawk} çš„å…³é”®è¯æœ‰ï¼š
@code{BEGIN},
@code{BEGINFILE},
@code{END},
@code{ENDFILE},
@code{break},
@code{case},
@code{continue},
@code{default}
@code{delete},
@code{do@dots{}while},
@code{else},
@code{exit},
@code{for@dots{}in},
@code{for},
@code{function},
@code{func},
@code{if},
@code{next},
@code{nextfile},
@code{switch},
å’Œ
@code{while}.

@item Korn Shell
@code{Korn} Shellï¼ˆ@command{ksh}ï¼‰æ˜¯ç”±åœ¨è´å°”å®éªŒå®¤çš„ David Korn åœ¨ 1980 å¹´ä»£æ—©æœŸå¼€å‘çš„ã€‚Korn Shell ä¸ Bourne Shell ä»¥åŠå¾ˆå¤šçš„ C shell ç‰¹æ€§æ˜¯åå‘å…¼å®¹çš„ã€‚æŸ¥çœ‹ â€œBourne Shellâ€ã€‚

@cindex LGPL (Lesser General Public License)
@cindex Lesser General Public License (LGPL)
@cindex GNU Lesser General Public License
@item Lesser General Public Licenseï¼ˆæ¬¡é€šç”¨å…¬å…±è®¸å¯ï¼‰
è¿™ä¸ªæ–‡æ¡£æè¿°äº†ç›¸åº”æ¡æ¬¾ï¼Œåœ¨æ­¤æ¡æ¬¾ä¸‹å¯ä»¥å‘å¸ƒäºŒè¿›åˆ¶æ–‡æ¡£æˆ–è€…å…±äº«å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥å‘å¸ƒç›¸åº”çš„æºä»£ç ã€‚

@item LGPL
æŸ¥çœ‹â€œæ¬¡é€šç”¨å…¬å…±è®¸å¯â€ã€‚

@item Linux
æŸ¥çœ‹ â€œGNU/Linuxâ€ã€‚

@item Localizationï¼ˆæœ¬åœ°åŒ–ï¼‰
The process of providing the data necessary for an
internationalized program to work in a particular language.

@item Logical Expressionï¼ˆé€»è¾‘è¡¨è¾¾å¼ï¼‰
ä½¿ç”¨é€»è¾‘æ“ä½œç¬¦ ANDï¼ŒOR ä¸ NOT çš„è¡¨è¾¾å¼ï¼Œåœ¨ @command{awk} ä¸­åˆ†åˆ«å†™åœ¨ @samp{&&}, @samp{||}, ä»¥åŠ @samp{!}ã€‚é€šå¸¸ä¹Ÿç§°ä¸ºå¸ƒå°”è¡¨è¾¾å¼ã€‚ä»¥å¼€åˆ›è¿™ç§æ•°å­¦é€»è¾‘çš„æ•°å­¦å®¶æ¥å‘½ä»¤ã€‚

@item Lvalueï¼ˆå·¦å€¼ï¼‰
å¯ä»¥å‡ºç°åœ¨èµ‹å€¼è¡¨è¾¾å¼å·¦è¾¹çš„è¡¨è¾¾å¼ã€‚åœ¨å¾ˆå¤šè¯­è¨€ä¸­ï¼Œå·¦å€¼ï¼ˆ@code{lvalue}ï¼‰å¯ä»¥æ˜¯å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°ç»„å…ƒç´ ã€‚åœ¨ @command{awk} ä¸­ï¼ŒåŸŸå¼•ç”¨ä¹Ÿå¯ä»¥ç”¨ä½œå·¦å€¼ã€‚

@item Matchingï¼ˆåŒ¹é…ï¼‰
å°†ä¸€ä¸ªå­—ä¸²ä¸æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæµ‹è¯•çš„åŠ¨ä½œã€‚å¦‚æœæ­£åˆ™è¡¨è¾¾å¼æè¿°äº†å­—ä¸²çš„å†…å®¹ï¼Œåˆ™è¯´æ˜¯@dfn{åŒ¹é…}çš„ã€‚

@item Metacharactersï¼ˆå…ƒå­—ç¬¦ï¼‰
åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å¹¶ä¸ç”¨ä½œä¸ºå…¶è‡ªèº«çš„é‚£äº›å­—ç¬¦ã€‚ç›¸åï¼Œå®ƒä»¬ä»£è¡¨æ­£åˆ™è¡¨è¾¾å¼æ“ä½œï¼Œå¦‚é‡å¤ï¼Œç»„åˆï¼Œé€‰æ‹©ç­‰ã€‚

@item Nestingï¼ˆå†…åµŒï¼‰
å†…åµŒæŒ‡çš„æ˜¯ä¿¡æ¯ä»¥å±‚çš„æ–¹å¼è¿›è¡Œç»„ç»‡ï¼Œæˆ–è€…å¯¹è±¡åŒ…å«äº†ç±»ä¼¼çš„å¯¹è±¡ã€‚åœ¨ @command{gawk} ä¸­ï¼Œ@code{@@include} æŒ‡ä»¤å¯ä»¥å†…åµŒã€‚ç®—æœ¯ä¸é€»è¾‘æ“ä½œâ€œè‡ªç„¶çš„â€å†…åµŒå¯ä»¥é€šè¿‡æ‹¬å·æ¥æ”¹å˜ï¼ˆæŸ¥çœ‹ @pxref{Precedence}ã€‚ï¼‰

@item No-op
ä»€ä¹ˆä¹Ÿä¸åšçš„æ“ä½œã€‚

@item Null String
æ²¡æœ‰å­—ç¬¦çš„ä¸²ã€‚åœ¨ @command{awk} ç¨‹åºä¸­ï¼Œå…¶ç”±ä¸¤ä¸ªç´§é‚»çš„å¼•å·ï¼ˆ@code{""}ï¼‰æ¥è¡¨ç¤ºã€‚å®ƒä¼šå‡ºç°åœ¨ä¸¤ä¸ªç´§é‚»çš„åŸŸåˆ†éš”ç¬¦é—´ã€‚

@item Numberï¼ˆæ•°å€¼ï¼‰
ä¸€ä¸ªæ•°å€¼æ•°æ®å¯¹è±¡ã€‚ç°ä»£çš„ @command{awk} å®ç°ä½¿ç”¨åŒç²¾åº¦æµ®ç‚¹æ•°æ¥è¡¨ç¤ºæ•°å€¼ã€‚å¤è‘£çº§çš„ @command{awk} å®ç°ä½¿ç”¨å•ç²’åº¦æµ®ç‚¹æ•°ã€‚

@item Octalï¼ˆå…«è¿›åˆ¶ï¼‰
ä»¥ 8 ä¸ºåº•çš„è¡¨ç¤ºæ³•ï¼Œå…¶æ•°å­—ä¸º @code{0}--@code{7}ã€‚å…«è¿›åˆ¶åœ¨ C ä¸­ä½¿ç”¨å‰å¯¼çš„ @samp{0} æ¥è¡¨ç¤ºå…¶åº•æ•°ã€‚å› æ­¤ï¼Œ@code{013} è¡¨ç¤º 11 ((1 x 8) + 3)ã€‚æŸ¥çœ‹ @ref{Nondecimal-numbers}ã€‚

@item Output Recordï¼ˆè¾“å‡ºè®°å½•ï¼‰
ç”± @command{awk} è¾“å‡ºçš„ä¸€å—æ•°æ®ã€‚é€šå¸¸ @command{awk} è¾“å…¥ç”±ä¸€åˆ°å¤šè¡Œçš„æ–‡æœ¬ç»„æˆã€‚æŸ¥çœ‹ @ref{Records}ã€‚

@item Patternï¼ˆæ¨¡å¼ï¼‰
æ¨¡å¼å‘Šè¯‰ @command{awk} è¾“å…¥è®°å½•ä¸­å“ªäº›æ˜¯è§„åˆ™æ‰€æ„Ÿå…´è¶£çš„ã€‚

æ¨¡å¼æ˜¯ä»»æ„çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œç”¨äºå¯¹è¾“å…¥è®°å½•è¿›è¡Œæµ‹è¯•ã€‚å¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œåˆ™è¯´æ¨¡å¼ä¸è¾“å…¥è®°å½•æ˜¯@dfn{åŒ¹é…}çš„ã€‚ä¸€ä¸ªå…¸å‹çš„æ¨¡å¼ä¼šå°†è¾“å…¥è®°å½•ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ï¼ˆæŸ¥çœ‹ @ref{Pattern Overview}ã€‚ï¼‰

@item PEBKAC
æ˜¯è®¡ç®—æœºä½¿ç”¨é—®é¢˜æœ€å¯èƒ½çš„æ¥æºçš„åŒä¹‰è¯ã€‚(Problem Exists Between
Keyboard And Chair.)

@item Plug-inï¼ˆæ’ä»¶ï¼‰
æŸ¥çœ‹â€œæ‰©å±•â€ã€‚

@item POSIX
æŒ‡å®šäº†å¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ï¼ˆPortable Operating System interfaceï¼‰ä¸€ç³»åˆ—æ ‡å‡†åå­—ã€‚â€œIXâ€è¡¨ç¤ºè¿™äº›æ ‡å‡†æ¥è‡ªäº Unixã€‚@command{awk} ç”¨æˆ·æ„Ÿå…´è¶£çš„ä¸»è¦æ ‡å‡†æ˜¯ç”¨äºä¿¡æ¯æŠ€æœ¯çš„ IEEE æ ‡å‡†ï¼Œ1003.1-2008 æ ‡å‡†ã€‚2008 POSIX æ ‡å‡†å¯ä»¥åœ¨çº¿è®¿é—®ï¼š@url{http://www.opengroup.org/onlinepubs/9699919799/}

@item Precedenceï¼ˆä¼˜å…ˆçº§ï¼‰
å½“æ“ä½œç¬¦ä½¿ç”¨æ—¶æ²¡æœ‰æ˜¾å¼çš„æ‹¬å·æ—¶ï¼Œæ“ä½œç¬¦çš„æ‰§è¡Œé¡ºåºã€‚

@item Privateï¼ˆç§æœ‰ï¼‰
ç”±åº“å‡½æ•°è€Œä¸æ˜¯ä¸» @command{awk} ç¨‹åºä½¿ç”¨çš„å˜é‡ä¸/æˆ–è€…å‡½æ•°ã€‚å¯¹è¿™äº›å˜é‡ä¸å‡½æ•°çš„å‘½ä»¤è¦ç‰¹åˆ«æ³¨æ„ã€‚ï¼ˆæŸ¥çœ‹ @ref{Library Names}ã€‚ï¼‰

@item Range (of input lines)ï¼ˆï¼ˆè¾“å…¥è¡Œçš„ï¼‰èŒƒå›´ï¼‰
ä»è¾“å…¥æ–‡ä»¶ä¸­è¾“å…¥äº†ä¸€è¿ä¸²çš„è¿ç»­è¡Œã€‚ä¸€ä¸ªæ¨¡å¼å¯ä»¥æŒ‡å®šè¾“å…¥è¡ŒèŒƒå›´ï¼Œä½¿ @command{awk} å¯ä»¥å¤„ç†ï¼Œæˆ–è€…å®ƒä¹Ÿå¯ä»¥æŒ‡å®šå•ç‹¬çš„è¡Œã€‚ï¼ˆæŸ¥çœ‹ @ref{Pattern Overview}ã€‚ï¼‰

@item Recordï¼ˆè®°å½•ï¼‰
æŸ¥çœ‹â€œè¾“å…¥è®°å½•â€ä¸â€œè¾“å…¥è®°å½•â€ã€‚

@item Recursionï¼ˆé€’å½’ï¼‰
å‡½æ•°ç›´æ¥æˆ–è€…é—´æ¥è°ƒç”¨å®ƒè‡ªå·±ã€‚å¦‚æœè¿™éå¸¸æ¸…æ¥šï¼Œåˆ™åœæ­¢ï¼Œå¹¶è¿›å…¥ä¸‹ä¸€ä¸ªè¯æ¡ã€‚å¦åˆ™å‚è€ƒâ€œé€’å½’â€é¡¹ã€‚ï¼ˆè¿™æ˜¯ä½œç”¨åœ¨ç”¨é€’å½’æ–¹å¼æè¿°è¿™ä¸ªè¯æ¡â€”â€”è¯‘è€…æ³¨ï¼‰

@item Redirectionï¼ˆé‡å®šå‘ï¼‰
é‡å®šå‘è¡¨ç¤ºä»å…¶ä»–çš„åœ°æ–¹è€Œä¸æ˜¯æ ‡å‡†è¾“å…¥æ¥æ‰§è¡Œè¾“å…¥ï¼Œæˆ–è€…è¾“å‡ºåˆ°å…¶ä»–åœ°æ–¹è€Œä¸æ˜¯æ ‡å‡†è¾“å‡ºã€‚

ä½ å¯ä»¥ä½¿ç”¨ @samp{<}, @samp{|}, and @samp{|&} æ“ä½œç¬¦å°†è¾“å…¥é‡å®šå‘åˆ° @code{getline} è¯­å¥ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ @samp{>}, @samp{>>}, @samp{|}, ä¸ @samp{|&}æ“ä½œç¬¦å°† @code{print} ä¸ @code{printf} è¯­å¥çš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶æˆ–è€…ä¸€ä¸ªç³»ç»Ÿå‘½ä»¤ã€‚ï¼ˆæŸ¥çœ‹ @ref{Getline} ä¸ @ref{Redirection}ã€‚ï¼‰

@item Reference Countsï¼ˆå‚è€ƒè®°æ•°ï¼‰
åœ¨ @command{gawk} ä¸­çš„ä¸€ç§å†…éƒ¨æœºåˆ¶ï¼Œä»¥æœ€å°åŒ–å†…å­˜ä½¿ç”¨æ¥å­˜å‚¨å­—ä¸²å˜é‡çš„å€¼ã€‚å¦‚æœå€¼æ‰€å‡è®¾çš„å˜é‡çš„å€¼åœ¨å¤šäºä¸€ä¸ªåœ°æ–¹ä½¿ç”¨ï¼Œåªä¼šæœ‰ä¸€ä¸ªå¤æœ¬ä¿ç•™ï¼Œå½“ç›¸åº”çš„å€¼è¢«å¦ä¸€ä¸ªå˜é‡ä½¿ç”¨æ—¶ï¼Œåˆ™å‚è€ƒè®¡æ•°ä¼šè¢«é€’å¢ï¼Œå¹¶ä¸”åœ¨ç›¸å…³çš„å˜é‡ä¸å†ä½¿ç”¨æ—¶ï¼Œåˆ™é€’å‡å®ƒã€‚å½“å‚è€ƒè®¡ç®—å˜ä¸º 0 æ—¶ï¼Œå­˜å‚¨å˜é‡å€¼çš„å†…å­˜ç©ºé—´ä¼šè¢«é‡Šæ”¾æ‰ã€‚

@item Regexp
æŸ¥çœ‹â€œæ­£åˆ™è¡¨è¾¾å¼â€ã€‚

@item Regular Expressionï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
æ­£åˆ™è¡¨è¾¾å¼ï¼ˆâ€œregexpâ€ä¸ºç®€ç§°ï¼‰æ˜¯ä¸€ç§æ¨¡å¼ï¼Œç”¨æ¥è¡¨ç¤ºå­—ä¸²é›†ï¼Œæœ‰å¯èƒ½æ˜¯æ— é™é›†ã€‚ä¾‹å¦‚ï¼Œæ­£åˆ™è¡¨è¾¾å¼ @samp{R.*xp} åŒ¹é…ä»¥å­—æ¯ @samp{R} å¼€å¤´ï¼Œå¹¶ä»¥ @samp{xp} ç»“å°¾çš„æ‰€æœ‰å­—ä¸²ã€‚åœ¨ @command{awk} ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨åœ¨æ¨¡å¼ä»¥åŠæ¡ä»¶è¡¨è¾¾å¼ä¸­ã€‚æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åŒ…å«è½¬ä¹‰åºåˆ—ã€‚ï¼ˆæŸ¥çœ‹ @ref{Regexp}ã€‚ï¼‰

@item Regular Expression Constant
æ­£åˆ™è¡¨è¾¾å¼å¸¸é‡æ˜¯ä¸€ä¸ªå†™åœ¨æ–œæ ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚ @code{/foo/}ã€‚è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å†™ @command{awk} ç¨‹åºæ—¶å°±å·²ç»é€‰å®šï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸å¯ä»¥æ›´æ”¹ã€‚ï¼ˆæŸ¥çœ‹ @ref{Regexp Usage}ã€‚ï¼‰

@item Regular Expression Operatorsï¼ˆæ­£åˆ™è¡¨è¾¾å¼æ“ä½œç¬¦ï¼‰
æŸ¥çœ‹â€œå…ƒå­—ç¬¦â€ã€‚

@item Roundingï¼ˆèˆå…¥èˆå‡ºï¼‰
å¯¹ç®—æœ¯æ“ä½œçš„ç»“æœè¿›è¡Œèˆå…¥èˆå‡ºä¼šæœ‰è¯¡å¼‚ã€‚æœ‰å¤šäºä¸€ç§çš„èˆå…¥èˆå‡ºæ–¹å¼ï¼Œåœ¨ @command{gawk} ä¸­ï¼Œå¯ä»¥é€‰æ‹©å…¶ä¸­ä¸€ç§ç”¨åœ¨ç¨‹åºä¸­ã€‚æŸ¥çœ‹ @ref{Setting the rounding mode}ã€‚

@item Ruleï¼ˆè§„åˆ™ï¼‰
@command{awk} ç¨‹åºä¸­çš„ä¸€æ®µï¼Œç”¨æ¥æŒ‡å®šå¦‚ä½•æ¥å¤„ç†å•ä¸ªçš„è¾“å…¥è®°å½•ã€‚ä¸€ä¸ªè§„åˆ™ç”±ä¸€ä¸ª@dfn{æ¨¡å¼}ä¸ä¸€ä¸ª@dfn{åŠ¨ä½œ}ç»„æˆã€‚@command{awk} è¯»å–è¾“å…¥è®°å½•ï¼Œç„¶åé’ˆå¯¹æ¯ä¸€ä¸ªè§„åˆ™ï¼Œå¦‚æœè¾“å…¥è®°å½•æ»¡è¶³è§„åˆ™çš„æ¨¡å¼ï¼Œåˆ™ @command{awk} ä¼šæ‰§è¡Œè§„åˆ™çš„åŠ¨ä½œã€‚å¦åˆ™ï¼Œè§„åˆ™ä¸ä¼šå¯¹è¾“å…¥è®°å½•åšä»»ä½•æ“ä½œã€‚

@item Rvalueï¼ˆå³å€¼ï¼‰
å¯ä»¥å‡ºç°åœ¨èµ‹å€¼æ“ä½œç¬¦å³è¾¹çš„å€¼ã€‚åœ¨ @command{awk} ä¸­ï¼Œæœ¬è´¨ä¸Šæ¯ä¸€ä¸ªè¡¨è¾¾å¼éƒ½æœ‰ä¸€ä¸ªå€¼ï¼Œè¿™äº›å€¼å°±æ˜¯å³å€¼ã€‚

@item Scalarï¼ˆæ ‡é‡ï¼‰
å•ä¸€çš„å€¼ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ•°å€¼æˆ–è€…æ˜¯ä¸€ä¸ªå­—ä¸²ã€‚å¸¸è§„çš„å˜é‡æ˜¯æ ‡é¢˜ï¼Œæ•°ç»„ä¸å‡½æ•°åˆ™ä¸æ˜¯ã€‚

@item Search Pathï¼ˆæœç´¢è·¯å¾„ï¼‰
åœ¨ @command{gawk} ä¸­ï¼Œæ˜¯ç”¨äº @command{awk} ç¨‹åºæœç´¢æ–‡ä»¶çš„ç›®å½•åˆ—è¡¨ã€‚åœ¨ Shell ä¸­ï¼Œæ˜¯ç”¨æ¥æœç´¢å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„çš„åˆ—è¡¨ã€‚

@item @command{sed}
æŸ¥çœ‹â€œæµç¼–è¾‘å™¨â€ã€‚

@item Seed
ä¸€ç³»åˆ—éšæœºæ•°çš„åˆå§‹å€¼ï¼Œæˆ–è€…å¼€å§‹å€¼ã€‚

@item Shell
ç”¨äº Unix æˆ–è€… POSIX å…¼å®¹ç³»ç»Ÿçš„å‘½ä»¤è§£é‡Šå™¨ã€‚Shell å³å¯ä»¥ç”¨äºäº¤äº’å¼ï¼Œä¹Ÿå¯ä»¥ç”¨äºæŒ‡å¤„ç†æ–‡ä»¶æˆ–è€… Shell è„šæœ¬çš„ç¼–ç¨‹è¯­è¨€ã€‚

@item Short-Circuitï¼ˆçŸ­è·¯ï¼‰
@command{awk} é€»è¾‘æ“ä½œç¬¦ @samp{&&} ä¸ @samp{||} çš„è‡ªç„¶ç‰¹æ€§ã€‚å¦‚æœæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼åªéœ€è¦å¯¹æ“ä½œç¬¦çš„å·¦è¾¹çš„è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼å°±å¯ä»¥ç¡®å®šï¼Œè€Œå³è¾¹çš„è¡¨è¾¾å¼åˆ™ä¸ä¼šè¢«æ±‚å€¼ã€‚ï¼ˆæŸ¥çœ‹ @ref{Boolean Ops}ã€‚ï¼‰

@item Side Effectï¼ˆå‰¯ä½œç”¨ï¼‰
å¦‚æœä¸€ä¸ªè¡¨è¾¾å¼ä»…äº§ç”Ÿä¸€ä¸ªå€¼åˆ™æœ‰ä¸€ä¸ªå…¶ä»–çš„æ•ˆæœä¼šéšç€å‘ç”Ÿï¼Œåˆ™å°±ä¼šå‘ç”Ÿå‰¯ä½œç”¨ã€‚èµ‹å€¼è¡¨è¾¾å¼ï¼Œé€’å¢ä¸é€’å‡è¡¨è¾¾å¼ï¼Œè¿˜æœ‰å‡½æ•°è°ƒç”¨éƒ½æœ‰å‰¯ä½œç”¨ã€‚ï¼ˆæŸ¥çœ‹ @ref{Assignment Ops}ã€‚ï¼‰

@item Single Precisionï¼ˆå•ç²¾åº¦ï¼‰
æ•°å€¼çš„å†…éƒ¨è¡¨ç¤ºï¼Œå…¶å¯ä»¥æœ‰å°æ•°éƒ¨åˆ†ã€‚å•ç²¾åº¦çš„æ•°å€¼æ‰€è·Ÿè¸ªçš„æ•°å€¼ä½è¦æ¯”åŒç²¾åº¦çš„æ•°å€¼å°‘ï¼Œä½†æ˜¯å¯¹è¿™äº›æ•°å€¼çš„æ“ä½œæŒ‰ CPU æ—¶é—´ä¹Ÿä¼šå°‘å¾—å¤šã€‚è¿™ç§ç±»å‹è¢«ä¸€äº›å¾ˆè€çš„ @command{awk} ç‰ˆæœ¬ç”¨æ¥å­˜å‚¨æ•°å€¼å€¼ã€‚å®ƒçš„ç±»å‹æ˜¯ C çš„ @code{float}ã€‚

@item Spaceï¼ˆç©ºæ ¼ï¼‰
æ•²å‡»é”®ç›˜ä¸Šçš„ç©ºæ ¼é”®è€Œäº§ç”Ÿçš„å­—ç¬¦ã€‚

@item Special Fileï¼ˆç‰¹æ®Šæ–‡ä»¶ï¼‰
@value{FN}ç”± @command{gawk} åœ¨å†…éƒ¨è¿›è¡Œè§£é‡Šï¼Œè€Œä¸æ˜¯è¢«æ“ä½œç³»ç»Ÿæ¥ç›´æ¥å¤„ç†ï¼Œæ¯”å¦‚ï¼Œ@file{/dev/stderr}ã€‚ï¼ˆæŸ¥çœ‹ @ref{Special Files}ã€‚ï¼‰

@item Statementï¼ˆè¯­å¥ï¼‰
@command{awk} ç¨‹åºä¸­æ¨¡å¼-åŠ¨ä½œè§„åˆ™ä¸­çš„åŠ¨ä½œéƒ¨åˆ†ä¸­çš„è¡¨è¾¾å¼ï¼Œæˆ–è€… @command{awk} å‡½æ•°ä¸­çš„è¡¨è¾¾å¼ã€‚ä¸€ä¸ªè¯­å¥å¯ä»¥æ˜¯ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œä¸€ä¸ªæ•°ç»„æ“ä½œï¼Œæˆ–è€…ä¸€ä¸ªå¾ªç¯ç­‰ç­‰ã€‚

@item Stream Editorï¼ˆæµç¼–è¾‘å™¨ï¼‰
ä»è¾“å…¥æµä¸­è¯»å–è®°å½•ï¼Œç„¶åä¸€æ¬¡ä¸€ä¸ªè¿›è¡Œå¤„ç†çš„ç¨‹åºã€‚è¿™ä¸ªæ˜¯æ‰¹å¤„ç†ç¨‹åºçš„åé¢ã€‚åœ¨æ‰¹å¤„ç†æ–‡ä»¶ä¸­ï¼Œå®ƒå¸Œæœ›å®ƒçš„æ‰€æœ‰è¾“å…¥æ–‡ä»¶åœ¨å¼€å§‹å¤„ç†ä¹‹å‰æ˜¯å®Œæ•´çš„ï¼ŒåŒæ—¶äº¤äº’å¼çš„ç¨‹åºåˆ™è¦æ±‚ä»ç”¨æˆ·ä¸­è¾“å…¥æ•°æ®ã€‚

@item Stringï¼ˆå­—ä¸²ï¼‰
ç”±ä¸€ä¸²å­—ç¬¦æ‰€ç»„æˆçš„æ•°æ®ï¼Œå¦‚ @samp{I am a string}ã€‚åœ¨ @command{awk} ä¸­ï¼Œå¸¸é‡å­—ä¸²å†™åœ¨åŒå¼•å·ä¸­ï¼Œå¹¶ä¸”å¯èƒ½åŒ…å«è½¬ä¹‰å­—ç¬¦ã€‚ï¼ˆæŸ¥çœ‹ @ref{Escape Sequences}ã€‚ï¼‰

@item Tab
ç”±æ•²å‡»è§£ç›˜çš„ @kbd{TAB} é”®è€Œäº§ç”Ÿçš„å­—ç¬¦ã€‚å®ƒåœ¨è¾“å‡ºä¸­é€šå¸¸å±•å¼€ä¸º 8 ä¸ªç©ºæ ¼ã€‚

@item Text Domainï¼ˆæ–‡æœ¬åŸŸï¼‰
ä¸€ä¸ªæ ‡è¯†ä¸€ç§åº”ç”¨çš„å”¯ä¸€çš„åå­—ã€‚ç”¨æ¥åœ¨è¿è¡Œæ—¶å°†ç¿»è¯‘çš„æ¶ˆæ¯åˆ†ç»„åˆ°æœ¬åœ°è¯­è¨€ä¸­ã€‚

@item Timestampï¼ˆæ—¶é—´æˆ³ï¼‰
ä¸€ä¸ªâ€œä» epoch ä»¥æ¥çš„ç§’æ•°â€æ ¼å¼çš„å€¼ï¼Œç”¨åœ¨ Unix ä¸ POSIX ç³»ç»Ÿä¸­ã€‚è¢«ç”¨åœ¨ @command{gawk} ä¸­çš„å‡½æ•°ä¸­ï¼Œå¦‚ @code{mktime()}ï¼Œ @code{strftime()}ï¼Œ ä¸ @code{systime()}ã€‚æŸ¥çœ‹ â€œEpochâ€ï¼Œâ€œGMTâ€ä¸â€œUTCâ€ã€‚

@cindex Linux
@cindex GNU/Linux
@cindex Unix
@cindex BSD-based operating systems
@cindex NetBSD
@cindex FreeBSD
@cindex OpenBSD
@item Unix
ä¸€ç§è®¡ç®—æœºæ“ä½œç³»ç»Ÿï¼Œåœ¨ 1970 å¹´ä»£æœ€åˆç”± AT&T è´å°”å®éªŒå®¤å¼€å‘ã€‚ä¸€å¼€å§‹å…¶åœ¨å…¨ä¸–ç•Œçš„å¤§å­¦éå¸¸æµè¡Œï¼Œç„¶åè¿›è¡Œäº†å•†ç”¨åŒ–ï¼Œä½œä¸ºè½¯ä»¶å¼€å‘ç³»ç»Ÿä»¥åŠç½‘ç»œæœåŠ¡å™¨ç³»ç»Ÿã€‚æœ‰å¾ˆå¤šç‰ˆæœ¬çš„ Unixï¼Œä¹Ÿæœ‰å‡ ä¸ªç±»å‹ç›¸ä¼¼çš„å¯è‡ªç”±è·å–çš„ Unix ç‰ˆæœ¬çš„æºä»£ç ï¼ˆå¦‚ GNU/Linuxï¼Œ@uref{http://www.netbsd.org, NetBSD}ï¼Œ@uref{http://www.freebsd.org, FreeBSD} ä»¥åŠ @uref{http://www.openbsd.org, OpenBSD}ï¼‰ã€‚

@item UTC
å·²ç»è¢«æˆå—ä¸ºâ€œUniversal Coordinated Timeï¼ˆç»Ÿä¸€åè°ƒæ—¶ï¼‰â€çš„ç¼©å†™ã€‚è¿™æ˜¯è‹±æ ¼å…°æ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ï¼Œç”¨äºæ—¶é—´ä¸æ—¥æœŸè®¡ç®—çš„å‚è€ƒæ—¶é—´ã€‚æŸ¥çœ‹ â€œEpochâ€ä¸â€œGMTâ€ã€‚

@item Variableï¼ˆå˜é‡ï¼‰
å€¼çš„åå­—ã€‚åœ¨ @command{awk} ä¸­å˜é‡å¯ä»¥æ˜¯æ ‡é‡ï¼Œä¹Ÿå¯æ˜¯æ˜¯æ•°ç»„ã€‚

@item Whitespaceï¼ˆç©ºç™½ï¼‰
ä¸€è¿ä¸²çš„ç©ºæ ¼ï¼ŒTABï¼Œæˆ–è€…æ¢è¡Œç¬¦å‡ºç°åœ¨è¾“å…¥è®°å½•æˆ–è€…å­—ä¸²ä¸­ã€‚

@end table

@end ifclear

@c The GNU General Public License.
@node Copying
@unnumbered GNU General Public License
@ifnotdocbook
@center Version 3, 29 June 2007
@end ifnotdocbook
@docbook
<subtitle>Version 3, 29 June 2007</subtitle>
@end docbook

@c This file is intended to be included within another document,
@c hence no sectioning command or @node.

@display
Copyright @copyright{} 2007 Free Software Foundation, Inc. @url{http://fsf.org/}

Everyone is permitted to copy and distribute verbatim copies of this
license document, but changing it is not allowed.
@end display

@c fakenode --- for prepinfo
@heading Preamble

The GNU General Public License is a free, copyleft license for
software and other kinds of works.

The licenses for most software and other practical works are designed
to take away your freedom to share and change the works.  By contrast,
the GNU General Public License is intended to guarantee your freedom
to share and change all versions of a program---to make sure it remains
free software for all its users.  We, the Free Software Foundation,
use the GNU General Public License for most of our software; it
applies also to any other work released this way by its authors.  You
can apply it to your programs, too.

When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
them if you wish), that you receive source code or can get it if you
want it, that you can change the software or use pieces of it in new
free programs, and that you know you can do these things.

To protect your rights, we need to prevent others from denying you
these rights or asking you to surrender the rights.  Therefore, you
have certain responsibilities if you distribute copies of the
software, or if you modify it: responsibilities to respect the freedom
of others.

For example, if you distribute copies of such a program, whether
gratis or for a fee, you must pass on to the recipients the same
freedoms that you received.  You must make sure that they, too,
receive or can get the source code.  And you must show them these
terms so they know their rights.

Developers that use the GNU GPL protect your rights with two steps:
(1) assert copyright on the software, and (2) offer you this License
giving you legal permission to copy, distribute and/or modify it.

For the developers' and authors' protection, the GPL clearly explains
that there is no warranty for this free software.  For both users' and
authors' sake, the GPL requires that modified versions be marked as
changed, so that their problems will not be attributed erroneously to
authors of previous versions.

Some devices are designed to deny users access to install or run
modified versions of the software inside them, although the
manufacturer can do so.  This is fundamentally incompatible with the
aim of protecting users' freedom to change the software.  The
systematic pattern of such abuse occurs in the area of products for
individuals to use, which is precisely where it is most unacceptable.
Therefore, we have designed this version of the GPL to prohibit the
practice for those products.  If such problems arise substantially in
other domains, we stand ready to extend this provision to those
domains in future versions of the GPL, as needed to protect the
freedom of users.

Finally, every program is threatened constantly by software patents.
States should not allow patents to restrict development and use of
software on general-purpose computers, but in those that do, we wish
to avoid the special danger that patents applied to a free program
could make it effectively proprietary.  To prevent this, the GPL
assures that patents cannot be used to render the program non-free.

The precise terms and conditions for copying, distribution and
modification follow.

@c fakenode --- for prepinfo
@heading TERMS AND CONDITIONS

@enumerate 0
@item Definitions.

``This License'' refers to version 3 of the GNU General Public License.

``Copyright'' also means copyright-like laws that apply to other kinds
of works, such as semiconductor masks.

``The Program'' refers to any copyrightable work licensed under this
License.  Each licensee is addressed as ``you''.  ``Licensees'' and
``recipients'' may be individuals or organizations.

To ``modify'' a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of
an exact copy.  The resulting work is called a ``modified version'' of
the earlier work or a work ``based on'' the earlier work.

A ``covered work'' means either the unmodified Program or a work based
on the Program.

To ``propagate'' a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy.  Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.

To ``convey'' a work means any kind of propagation that enables other
parties to make or receive copies.  Mere interaction with a user
through a computer network, with no transfer of a copy, is not
conveying.

An interactive user interface displays ``Appropriate Legal Notices'' to
the extent that it includes a convenient and prominently visible
feature that (1) displays an appropriate copyright notice, and (2)
tells the user that there is no warranty for the work (except to the
extent that warranties are provided), that licensees may convey the
work under this License, and how to view a copy of this License.  If
the interface presents a list of user commands or options, such as a
menu, a prominent item in the list meets this criterion.

@item Source Code.

The ``source code'' for a work means the preferred form of the work for
making modifications to it.  ``Object code'' means any non-source form
of a work.

A ``Standard Interface'' means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that
is widely used among developers working in that language.

The ``System Libraries'' of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that
Major Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form.  A
``Major Component'', in this context, means a major essential component
(kernel, window system, and so on) of the specific operating system
(if any) on which the executable work runs, or a compiler used to
produce the work, or an object code interpreter used to run it.

The ``Corresponding Source'' for a work in object code form means all
the source code needed to generate, install, and (for an executable
work) run the object code and to modify the work, including scripts to
control those activities.  However, it does not include the work's
System Libraries, or general-purpose tools or generally available free
programs which are used unmodified in performing those activities but
which are not part of the work.  For example, Corresponding Source
includes interface definition files associated with source files for
the work, and the source code for shared libraries and dynamically
linked subprograms that the work is specifically designed to require,
such as by intimate data communication or control flow between those
subprograms and other parts of the work.

The Corresponding Source need not include anything that users can
regenerate automatically from other parts of the Corresponding Source.

The Corresponding Source for a work in source code form is that same
work.

@item Basic Permissions.

All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met.  This License explicitly affirms your unlimited
permission to run the unmodified Program.  The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work.  This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.

You may make, run and propagate covered works that you do not convey,
without conditions so long as your license otherwise remains in force.
You may convey covered works to others for the sole purpose of having
them make modifications exclusively for you, or provide you with
facilities for running those works, provided that you comply with the
terms of this License in conveying all material for which you do not
control copyright.  Those thus making or running the covered works for
you must do so exclusively on your behalf, under your direction and
control, on terms that prohibit them from making any copies of your
copyrighted material outside their relationship with you.

Conveying under any other circumstances is permitted solely under the
conditions stated below.  Sublicensing is not allowed; section 10
makes it unnecessary.

@item Protecting Users' Legal Rights From Anti-Circumvention Law.

No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article
11 of the WIPO copyright treaty adopted on 20 December 1996, or
similar laws prohibiting or restricting circumvention of such
measures.

When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such
circumvention is effected by exercising rights under this License with
respect to the covered work, and you disclaim any intention to limit
operation or modification of the work as a means of enforcing, against
the work's users, your or third parties' legal rights to forbid
circumvention of technological measures.

@item Conveying Verbatim Copies.

You may convey verbatim copies of the Program's source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice;
keep intact all notices stating that this License and any
non-permissive terms added in accord with section 7 apply to the code;
keep intact all notices of the absence of any warranty; and give all
recipients a copy of this License along with the Program.

You may charge any price or no price for each copy that you convey,
and you may offer support or warranty protection for a fee.

@item Conveying Modified Source Versions.

You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the
terms of section 4, provided that you also meet all of these
conditions:

@enumerate a
@item
The work must carry prominent notices stating that you modified it,
and giving a relevant date.

@item
The work must carry prominent notices stating that it is released
under this License and any conditions added under section 7.  This
requirement modifies the requirement in section 4 to ``keep intact all
notices''.

@item
You must license the entire work, as a whole, under this License to
anyone who comes into possession of a copy.  This License will
therefore apply, along with any applicable section 7 additional terms,
to the whole of the work, and all its parts, regardless of how they
are packaged.  This License gives no permission to license the work in
any other way, but it does not invalidate such permission if you have
separately received it.

@item
If the work has interactive user interfaces, each must display
Appropriate Legal Notices; however, if the Program has interactive
interfaces that do not display Appropriate Legal Notices, your work
need not make them do so.
@end enumerate

A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work,
and which are not combined with it such as to form a larger program,
in or on a volume of a storage or distribution medium, is called an
``aggregate'' if the compilation and its resulting copyright are not
used to limit the access or legal rights of the compilation's users
beyond what the individual works permit.  Inclusion of a covered work
in an aggregate does not cause this License to apply to the other
parts of the aggregate.

@item  Conveying Non-Source Forms.

You may convey a covered work in object code form under the terms of
sections 4 and 5, provided that you also convey the machine-readable
Corresponding Source under the terms of this License, in one of these
ways:

@enumerate a
@item
Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by the
Corresponding Source fixed on a durable physical medium customarily
used for software interchange.

@item
Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by a written
offer, valid for at least three years and valid for as long as you
offer spare parts or customer support for that product model, to give
anyone who possesses the object code either (1) a copy of the
Corresponding Source for all the software in the product that is
covered by this License, on a durable physical medium customarily used
for software interchange, for a price no more than your reasonable
cost of physically performing this conveying of source, or (2) access
to copy the Corresponding Source from a network server at no charge.

@item
Convey individual copies of the object code with a copy of the written
offer to provide the Corresponding Source.  This alternative is
allowed only occasionally and noncommercially, and only if you
received the object code with such an offer, in accord with subsection
6b.

@item
Convey the object code by offering access from a designated place
(gratis or for a charge), and offer equivalent access to the
Corresponding Source in the same way through the same place at no
further charge.  You need not require recipients to copy the
Corresponding Source along with the object code.  If the place to copy
the object code is a network server, the Corresponding Source may be
on a different server (operated by you or a third party) that supports
equivalent copying facilities, provided you maintain clear directions
next to the object code saying where to find the Corresponding Source.
Regardless of what server hosts the Corresponding Source, you remain
obligated to ensure that it is available for as long as needed to
satisfy these requirements.

@item
Convey the object code using peer-to-peer transmission, provided you
inform other peers where the object code and Corresponding Source of
the work are being offered to the general public at no charge under
subsection 6d.

@end enumerate

A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be
included in conveying the object code work.

A ``User Product'' is either (1) a ``consumer product'', which means any
tangible personal property which is normally used for personal,
family, or household purposes, or (2) anything designed or sold for
incorporation into a dwelling.  In determining whether a product is a
consumer product, doubtful cases shall be resolved in favor of
coverage.  For a particular product received by a particular user,
``normally used'' refers to a typical or common use of that class of
product, regardless of the status of the particular user or of the way
in which the particular user actually uses, or expects or is expected
to use, the product.  A product is a consumer product regardless of
whether the product has substantial commercial, industrial or
non-consumer uses, unless such uses represent the only significant
mode of use of the product.

``Installation Information'' for a User Product means any methods,
procedures, authorization keys, or other information required to
install and execute modified versions of a covered work in that User
Product from a modified version of its Corresponding Source.  The
information must suffice to ensure that the continued functioning of
the modified object code is in no case prevented or interfered with
solely because modification has been made.

If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied
by the Installation Information.  But this requirement does not apply
if neither you nor any third party retains the ability to install
modified object code on the User Product (for example, the work has
been installed in ROM).

The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or
updates for a work that has been modified or installed by the
recipient, or for the User Product in which it has been modified or
installed.  Access to a network may be denied when the modification
itself materially and adversely affects the operation of the network
or violates the rules and protocols for communication across the
network.

Corresponding Source conveyed, and Installation Information provided,
in accord with this section must be in a format that is publicly
documented (and with an implementation available to the public in
source code form), and must require no special password or key for
unpacking, reading or copying.

@item Additional Terms.

``Additional permissions'' are terms that supplement the terms of this
License by making exceptions from one or more of its conditions.
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law.  If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by
this License without regard to the additional permissions.

When you convey a copy of a covered work, you may at your option
remove any additional permissions from that copy, or from any part of
it.  (Additional permissions may be written to require their own
removal in certain cases when you modify the work.)  You may place
additional permissions on material, added by you to a covered work,
for which you have or can give appropriate copyright permission.

Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders
of that material) supplement the terms of this License with terms:

@enumerate a
@item
Disclaiming warranty or limiting liability differently from the terms
of sections 15 and 16 of this License; or

@item
Requiring preservation of specified reasonable legal notices or author
attributions in that material or in the Appropriate Legal Notices
displayed by works containing it; or

@item
Prohibiting misrepresentation of the origin of that material, or
requiring that modified versions of such material be marked in
reasonable ways as different from the original version; or

@item
Limiting the use for publicity purposes of names of licensors or
authors of the material; or

@item
Declining to grant rights under trademark law for use of some trade
names, trademarks, or service marks; or

@item
Requiring indemnification of licensors and authors of that material by
anyone who conveys the material (or modified versions of it) with
contractual assumptions of liability to the recipient, for any
liability that these contractual assumptions directly impose on those
licensors and authors.
@end enumerate

All other non-permissive additional terms are considered ``further
restrictions'' within the meaning of section 10.  If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term.  If a license document contains
a further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms
of that license document, provided that the further restriction does
not survive such relicensing or conveying.

If you add terms to a covered work in accord with this section, you
must place, in the relevant source files, a statement of the
additional terms that apply to those files, or a notice indicating
where to find the applicable terms.

Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions; the
above requirements apply either way.

@item Termination.

You may not propagate or modify a covered work except as expressly
provided under this License.  Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).

However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.

Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.

@item Acceptance Not Required for Having Copies.

You are not required to accept this License in order to receive or run
a copy of the Program.  Ancillary propagation of a covered work
occurring solely as a consequence of using peer-to-peer transmission
to receive a copy likewise does not require acceptance.  However,
nothing other than this License grants you permission to propagate or
modify any covered work.  These actions infringe copyright if you do
not accept this License.  Therefore, by modifying or propagating a
covered work, you indicate your acceptance of this License to do so.

@item Automatic Licensing of Downstream Recipients.

Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License.  You are not responsible
for enforcing compliance by third parties with this License.

An ``entity transaction'' is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations.  If propagation of a covered
work results from an entity transaction, each party to that
transaction who receives a copy of the work also receives whatever
licenses to the work the party's predecessor in interest had or could
give under the previous paragraph, plus a right to possession of the
Corresponding Source of the work from the predecessor in interest, if
the predecessor has it or can get it with reasonable efforts.

You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License.  For example, you may
not impose a license fee, royalty, or other charge for exercise of
rights granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that
any patent claim is infringed by making, using, selling, offering for
sale, or importing the Program or any portion of it.

@item Patents.

A ``contributor'' is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based.  The
work thus licensed is called the contributor's ``contributor version''.

A contributor's ``essential patent claims'' are all patent claims owned
or controlled by the contributor, whether already acquired or
hereafter acquired, that would be infringed by some manner, permitted
by this License, of making, using, or selling its contributor version,
but do not include claims that would be infringed only as a
consequence of further modification of the contributor version.  For
purposes of this definition, ``control'' includes the right to grant
patent sublicenses in a manner consistent with the requirements of
this License.

Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor's essential patent claims, to
make, use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.

In the following three paragraphs, a ``patent license'' is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement).  To ``grant'' such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.

If you convey a covered work, knowingly relying on a patent license,
and the Corresponding Source of the work is not available for anyone
to copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients.  ``Knowingly relying'' means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient's use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.

If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify
or convey a specific copy of the covered work, then the patent license
you grant is automatically extended to all recipients of the covered
work and works based on it.

A patent license is ``discriminatory'' if it does not include within the
scope of its coverage, prohibits the exercise of, or is conditioned on
the non-exercise of one or more of the rights that are specifically
granted under this License.  You may not convey a covered work if you
are a party to an arrangement with a third party that is in the
business of distributing software, under which you make payment to the
third party based on the extent of your activity of conveying the
work, and under which the third party grants, to any of the parties
who would receive the covered work from you, a discriminatory patent
license (a) in connection with copies of the covered work conveyed by
you (or copies made from those copies), or (b) primarily for and in
connection with specific products or compilations that contain the
covered work, unless you entered into that arrangement, or that patent
license was granted, prior to 28 March 2007.

Nothing in this License shall be construed as excluding or limiting
any implied license or other defenses to infringement that may
otherwise be available to you under applicable patent law.

@item No Surrender of Others' Freedom.

If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot convey
a covered work so as to satisfy simultaneously your obligations under
this License and any other pertinent obligations, then as a
consequence you may not convey it at all.  For example, if you agree
to terms that obligate you to collect a royalty for further conveying
from those to whom you convey the Program, the only way you could
satisfy both those terms and this License would be to refrain entirely
from conveying the Program.

@item Use with the GNU Affero General Public License.

Notwithstanding any other provision of this License, you have
permission to link or combine any covered work with a work licensed
under version 3 of the GNU Affero General Public License into a single
combined work, and to convey the resulting work.  The terms of this
License will continue to apply to the part which is the covered work,
but the special requirements of the GNU Affero General Public License,
section 13, concerning interaction through a network will apply to the
combination as such.

@item Revised Versions of this License.

The Free Software Foundation may publish revised and/or new versions
of the GNU General Public License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.

Each version is given a distinguishing version number.  If the Program
specifies that a certain numbered version of the GNU General Public
License ``or any later version'' applies to it, you have the option of
following the terms and conditions either of that numbered version or
of any later version published by the Free Software Foundation.  If
the Program does not specify a version number of the GNU General
Public License, you may choose any version ever published by the Free
Software Foundation.

If the Program specifies that a proxy can decide which future versions
of the GNU General Public License can be used, that proxy's public
statement of acceptance of a version permanently authorizes you to
choose that version for the Program.

Later license versions may give you additional or different
permissions.  However, no additional obligations are imposed on any
author or copyright holder as a result of your choosing to follow a
later version.

@item Disclaimer of Warranty.

THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM ``AS IS'' WITHOUT
WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND
PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE PROGRAM PROVE
DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR
CORRECTION.

@item Limitation of Liability.

IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR
CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES
ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT
NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR
LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM
TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER
PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.

@item Interpretation of Sections 15 and 16.

If the disclaimer of warranty and limitation of liability provided
above cannot be given local legal effect according to their terms,
reviewing courts shall apply local law that most closely approximates
an absolute waiver of all civil liability in connection with the
Program, unless a warranty or assumption of liability accompanies a
copy of the Program in return for a fee.

@end enumerate

@c fakenode --- for prepinfo
@heading END OF TERMS AND CONDITIONS

@c fakenode --- for prepinfo
@heading How to Apply These Terms to Your New Programs

If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these
terms.

To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
state the exclusion of warranty; and each file should have at least
the ``copyright'' line and a pointer to where the full notice is found.

@smallexample
@var{one line to give the program's name and a brief idea of what it does.}
Copyright (C) @var{year} @var{name of author}

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or (at
your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see @url{http://www.gnu.org/licenses/}.
@end smallexample

Also add information on how to contact you by electronic and paper mail.

If the program does terminal interaction, make it output a short
notice like this when it starts in an interactive mode:

@smallexample
@var{program} Copyright (C) @var{year} @var{name of author}
This program comes with ABSOLUTELY NO WARRANTY; for details type @samp{show w}.
This is free software, and you are welcome to redistribute it
under certain conditions; type @samp{show c} for details.
@end smallexample

The hypothetical commands @samp{show w} and @samp{show c} should show
the appropriate parts of the General Public License.  Of course, your
program's commands might be different; for a GUI interface, you would
use an ``about box''.

You should also get your employer (if you work as a programmer) or school,
if any, to sign a ``copyright disclaimer'' for the program, if necessary.
For more information on this, and how to apply and follow the GNU GPL, see
@url{http://www.gnu.org/licenses/}.

The GNU General Public License does not permit incorporating your
program into proprietary programs.  If your program is a subroutine
library, you may consider it more useful to permit linking proprietary
applications with the library.  If this is what you want to do, use
the GNU Lesser General Public License instead of this License.  But
first, please read @url{http://www.gnu.org/philosophy/why-not-lgpl.html}.

@ifclear FOR_PRINT
@c The GNU Free Documentation License.
@node GNU Free Documentation License
@unnumbered GNU Free Documentation License
@ifnotdocbook
@center Version 1.3, 3 November 2008
@end ifnotdocbook

@docbook
<subtitle>Version 1.3, 3 November 2008</subtitle>
@end docbook

@cindex FDL (Free Documentation License)
@cindex Free Documentation License (FDL)
@cindex GNU Free Documentation License

@c This file is intended to be included within another document,
@c hence no sectioning command or @node.

@display
Copyright @copyright{} 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
@uref{http://fsf.org/}

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
@end display

@enumerate 0
@item
PREAMBLE

The purpose of this License is to make a manual, textbook, or other
functional and useful document @dfn{free} in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it,
with or without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible
for modifications made by others.

This License is a kind of ``copyleft'', which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.

We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.

@item
APPLICABILITY AND DEFINITIONS

This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License.  Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein.  The ``Document'', below,
refers to any such manual or work.  Any member of the public is a
licensee, and is addressed as ``you''.  You accept the license if you
copy, modify or distribute the work in a way requiring permission
under copyright law.

A ``Modified Version'' of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.

A ``Secondary Section'' is a named appendix or a front-matter section
of the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document's overall
subject (or to related matters) and contains nothing that could fall
directly within that overall subject.  (Thus, if the Document is in
part a textbook of mathematics, a Secondary Section may not explain
any mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.

The ``Invariant Sections'' are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.  If a
section does not fit the above definition of Secondary then it is not
allowed to be designated as Invariant.  The Document may contain zero
Invariant Sections.  If the Document does not identify any Invariant
Sections then there are none.

The ``Cover Texts'' are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.  A Front-Cover Text may
be at most 5 words, and a Back-Cover Text may be at most 25 words.

A ``Transparent'' copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, that is suitable for revising the document
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup, or absence of markup, has been arranged to thwart
or discourage subsequent modification by readers is not Transparent.
An image format is not Transparent if used for any substantial amount
of text.  A copy that is not ``Transparent'' is called ``Opaque''.

Examples of suitable formats for Transparent copies include plain
@sc{ascii} without markup, Texinfo input format, La@TeX{} input
format, @acronym{SGML} or @acronym{XML} using a publicly available
@acronym{DTD}, and standard-conforming simple @acronym{HTML},
PostScript or @acronym{PDF} designed for human modification.  Examples
of transparent image formats include @acronym{PNG}, @acronym{XCF} and
@acronym{JPG}.  Opaque formats include proprietary formats that can be
read and edited only by proprietary word processors, @acronym{SGML} or
@acronym{XML} for which the @acronym{DTD} and/or processing tools are
not generally available, and the machine-generated @acronym{HTML},
PostScript or @acronym{PDF} produced by some word processors for
output purposes only.

The ``Title Page'' means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, ``Title Page'' means
the text near the most prominent appearance of the work's title,
preceding the beginning of the body of the text.

The ``publisher'' means any person or entity that distributes copies
of the Document to the public.

A section ``Entitled XYZ'' means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language.  (Here XYZ stands for a
specific section name mentioned below, such as ``Acknowledgements'',
``Dedications'', ``Endorsements'', or ``History''.)  To ``Preserve the Title''
of such a section when you modify the Document means that it remains a
section ``Entitled XYZ'' according to this definition.

The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document.  These Warranty
Disclaimers are considered to be included by reference in this
License, but only as regards disclaiming warranties: any other
implication that these Warranty Disclaimers may have is void and has
no effect on the meaning of this License.

@item
VERBATIM COPYING

You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.

You may also lend copies, under the same conditions stated above, and
you may publicly display copies.

@item
COPYING IN QUANTITY

If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document's license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.

If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.

If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a computer-network location from which the general network-using
public has access to download using public-standard network protocols
a complete Transparent copy of the Document, free of added material.
If you use the latter option, you must take reasonably prudent steps,
when you begin distribution of Opaque copies in quantity, to ensure
that this Transparent copy will remain thus accessible at the stated
location until at least one year after the last time you distribute an
Opaque copy (directly or through your agents or retailers) of that
edition to the public.

It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.

@item
MODIFICATIONS

You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:

@enumerate A
@item
Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions
(which should, if there were any, be listed in the History section
of the Document).  You may use the same title as a previous version
if the original publisher of that version gives permission.

@item
List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified
Version, together with at least five of the principal authors of the
Document (all of its principal authors, if it has fewer than five),
unless they release you from this requirement.

@item
State on the Title page the name of the publisher of the
Modified Version, as the publisher.

@item
Preserve all the copyright notices of the Document.

@item
Add an appropriate copyright notice for your modifications
adjacent to the other copyright notices.

@item
Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the
terms of this License, in the form shown in the Addendum below.

@item
Preserve in that license notice the full lists of Invariant Sections
and required Cover Texts given in the Document's license notice.

@item
Include an unaltered copy of this License.

@item
Preserve the section Entitled ``History'', Preserve its Title, and add
to it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page.  If
there is no section Entitled ``History'' in the Document, create one
stating the title, year, authors, and publisher of the Document as
given on its Title Page, then add an item describing the Modified
Version as stated in the previous sentence.

@item
Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise
the network locations given in the Document for previous versions
it was based on.  These may be placed in the ``History'' section.
You may omit a network location for a work that was published at
least four years before the Document itself, or if the original
publisher of the version it refers to gives permission.

@item
For any section Entitled ``Acknowledgements'' or ``Dedications'', Preserve
the Title of the section, and preserve in the section all the
substance and tone of each of the contributor acknowledgements and/or
dedications given therein.

@item
Preserve all the Invariant Sections of the Document,
unaltered in their text and in their titles.  Section numbers
or the equivalent are not considered part of the section titles.

@item
Delete any section Entitled ``Endorsements''.  Such a section
may not be included in the Modified Version.

@item
Do not retitle any existing section to be Entitled ``Endorsements'' or
to conflict in title with any Invariant Section.

@item
Preserve any Warranty Disclaimers.
@end enumerate

If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version's license notice.
These titles must be distinct from any other section titles.

You may add a section Entitled ``Endorsements'', provided it contains
nothing but endorsements of your Modified Version by various
parties---for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.

You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.

The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.

@item
COMBINING DOCUMENTS

You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice, and that you preserve all their Warranty Disclaimers.

The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.

In the combination, you must combine any sections Entitled ``History''
in the various original documents, forming one section Entitled
``History''; likewise combine any sections Entitled ``Acknowledgements'',
and any sections Entitled ``Dedications''.  You must delete all
sections Entitled ``Endorsements.''

@item
COLLECTIONS OF DOCUMENTS

You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.

You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.

@item
AGGREGATION WITH INDEPENDENT WORKS

A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, is called an ``aggregate'' if the copyright
resulting from the compilation is not used to limit the legal rights
of the compilation's users beyond what the individual works permit.
When the Document is included in an aggregate, this License does not
apply to the other works in the aggregate which are not themselves
derivative works of the Document.

If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one half of
the entire aggregate, the Document's Cover Texts may be placed on
covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form.
Otherwise they must appear on printed covers that bracket the whole
aggregate.

@item
TRANSLATION

Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License, and all the license notices in the
Document, and any Warranty Disclaimers, provided that you also include
the original English version of this License and the original versions
of those notices and disclaimers.  In case of a disagreement between
the translation and the original version of this License or a notice
or disclaimer, the original version will prevail.

If a section in the Document is Entitled ``Acknowledgements'',
``Dedications'', or ``History'', the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual
title.

@item
TERMINATION

You may not copy, modify, sublicense, or distribute the Document
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense, or distribute it is void, and
will automatically terminate your rights under this License.

However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.

Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, receipt of a copy of some or all of the same material does
not give you any rights to use it.

@item
FUTURE REVISIONS OF THIS LICENSE

The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
@uref{http://www.gnu.org/copyleft/}.

Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this
License ``or any later version'' applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.  If the Document
specifies that a proxy can decide which future versions of this
License can be used, that proxy's public statement of acceptance of a
version permanently authorizes you to choose that version for the
Document.

@item
RELICENSING

``Massive Multiauthor Collaboration Site'' (or ``MMC Site'') means any
World Wide Web server that publishes copyrightable works and also
provides prominent facilities for anybody to edit those works.  A
public wiki that anybody can edit is an example of such a server.  A
``Massive Multiauthor Collaboration'' (or ``MMC'') contained in the
site means any set of copyrightable works thus published on the MMC
site.

``CC-BY-SA'' means the Creative Commons Attribution-Share Alike 3.0
license published by Creative Commons Corporation, a not-for-profit
corporation with a principal place of business in San Francisco,
California, as well as future copyleft versions of that license
published by that same organization.

``Incorporate'' means to publish or republish a Document, in whole or
in part, as part of another Document.

An MMC is ``eligible for relicensing'' if it is licensed under this
License, and if all works that were first published under this License
somewhere other than this MMC, and subsequently incorporated in whole
or in part into the MMC, (1) had no cover texts or invariant sections,
and (2) were thus incorporated prior to November 1, 2008.

The operator of an MMC Site may republish an MMC contained in the site
under CC-BY-SA on the same site at any time before August 1, 2009,
provided the MMC is eligible for relicensing.

@end enumerate

@c fakenode --- for prepinfo
@unnumberedsec ADDENDUM: How to use this License for your documents

To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and
license notices just after the title page:

@smallexample
@group
  Copyright (C)  @var{year}  @var{your name}.
  Permission is granted to copy, distribute and/or modify this document
  under the terms of the GNU Free Documentation License, Version 1.3
  or any later version published by the Free Software Foundation;
  with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
  Texts.  A copy of the license is included in the section entitled ``GNU
  Free Documentation License''.
@end group
@end smallexample

If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
replace the ``with@dots{}Texts.'' line with this:

@smallexample
@group
    with the Invariant Sections being @var{list their titles}, with
    the Front-Cover Texts being @var{list}, and with the Back-Cover Texts
    being @var{list}.
@end group
@end smallexample

If you have Invariant Sections without Cover Texts, or some other
combination of the three, merge those two alternatives to suit the
situation.

If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of
free software license, such as the GNU General Public License,
to permit their use in free software.

@end ifclear

@ifnotdocbook
@node Index
@unnumbered Index
@end ifnotdocbook
@printindex cp

@bye

Unresolved Issues:
------------------
1. From ADR.

   Robert J. Chassell points out that awk programs should have some indication
   of how to use them.  It would be useful to perhaps have a "programming
   style" section of the manual that would include this and other tips.

Consistency issues:
	/.../ regexps are in @code, not @samp
	".." strings are in @code, not @samp
	no @print before @dots
	values of expressions in the text (@code{x} has the value 15),
		should be in roman, not @code
	Use   TAB   and not   tab
	Use   ESC   and not   ESCAPE
	Use   space and not   blank	to describe the space bar's character
	The term "blank" is thus basically reserved for "blank lines" etc.
	To make dark corners work, the @value{DARKCORNER} has to be outside
		closing `.' of a sentence and after (pxref{...}).
	" " should have an @w{} around it
	Use "non-" only with language names or acronyms, or the words bug and option and null
	Use @command{ftp} when talking about anonymous ftp
	Use uppercase and lowercase, not "upper-case" and "lower-case"
		or "upper case" and "lower case"
	Use "single precision" and "double precision", not "single-precision" or "double-precision"
	Use alphanumeric, not alpha-numeric
	Use POSIX-compliant, not POSIX compliant
	Use --foo, not -Wfoo when describing long options
	Use "Bell Laboratories", but not "Bell Labs".
	Use "behavior" instead of "behaviour".
	Use "coprocess" instead of "co-process".
	Use "zeros" instead of "zeroes".
	Use "nonzero" not "non-zero".
	Use "runtime" not "run time" or "run-time".
	Use "command-line" as an adjective and "command line" as a noun.
	Use "online" not "on-line".
	Use "whitespace" not "white space".
	Use "Input/Output", not "input/output". Also "I/O", not "i/o".
	Use "lefthand"/"righthand", not "left-hand"/"right-hand".
	Use "workaround", not "work-around".
	Use "startup"/"cleanup", not "start-up"/"clean-up"
	Use "filesystem", not "file system"
	Use @code{do}, and not @code{do}-@code{while}, except where
		actually discussing the do-while.
	Use "versus" in text and "vs." in index entries
	Use @code{"C"} for the C locale, not ``C'' or @samp{C}.
	The words "a", "and", "as", "between", "for", "from", "in", "of",
		"on", "that", "the", "to", "with", and "without",
		should not be capitalized in @chapter, @section etc.
		"Into" and "How" should.
	Search for @dfn; make sure important items are also indexed.
	"e.g." should always be followed by a comma.
	"i.e." should always be followed by a comma.
	The numbers zero through ten should be spelled out, except when
		talking about file descriptor numbers. > 10 and < 0, it's
		ok to use numbers.
	For most cases, do NOT put a comma before "and", "or" or "but".
		But exercise taste with this rule.
	Don't show the awk command with a program in quotes when it's
		just the program.  I.e.

			{
				....
			}

		not
			awk '{
				...
			}'

	Do show it when showing command-line arguments, data files, etc, even
		if there is no output shown.

	Use numbered lists only to show a sequential series of steps.

	Use @code{xxx} for the xxx operator in indexing statements, not @samp.
	Use MS-Windows not MS Windows
	Use MS-DOS not MS-DOS
	Use an empty set of parentheses after built-in and awk function names.
	Use "multiFOO" without a hyphen.

Date: Wed, 13 Apr 94 15:20:52 -0400
From: rms@gnu.org (Richard Stallman)
To: gnu-prog@gnu.org
Subject: A reminder: no pathnames in GNU

It's a GNU convention to use the term "file name" for the name of a
file, never "pathname".  We use the term "path" for search paths,
which are lists of file names.  Using it for a single file name as
well is potentially confusing to users.

So please check any documentation you maintain, if you think you might
have used "pathname".

Note that "file name" should be two words when it appears as ordinary
text.  It's ok as one word when it's a metasyntactic variable, though.

------------------------
ORA uses filename, thus the macro.

Suggestions:
------------

Better sidebars can almost sort of be done with:

	@ifdocbook
	@macro @sidebar{title, content}
	@inlinefmt{docbook, <sidebar><title>}
	\title\
	@inlinefmt{docbook, </title>}
	\content\
	@inlinefmt{docbook, </sidebar>}
	@end macro
	@end ifdocbook


	@ifnotdocbook
	@macro @sidebar{title, content}
	@cartouche
	@center @b{\title\}

	\content\
	@end cartouche
	@end macro
	@end ifnotdocbook

But to use it you have to say

	@sidebar{Title Here,
	@include file-with-content
	}

which sorta sucks.

TODO:
Check that all dark corners are indexed properly.
